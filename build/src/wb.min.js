'use strict';class VirtualclassKeyboard{init(c){c=document.querySelector(`#canvasWrapper${c}`);c.tabIndex=1E3;c.addEventListener("keydown",this.constructor.handlerKeyDown,!1)}static handlerKeyDown(c){8!==c.keyCode&&46!==c.keyCode||WhiteboardUtility.deleteActiveObject(c,virtualclass.gObj.currWb)}};const screenDecodeBlob=URL.createObjectURL(new Blob(["(",function(){function c(b){myLoop=4*b.length;k=new Uint8ClampedArray(myLoop);for(let a=0;a<myLoop;a++)k[4*a]=36.5*(b[a]>>5),k[4*a+1]=36.5*((b[a]&28)>>2),k[4*a+2]=85*(b[a]&3),k[4*a+3]=255}function b(b,a,d,c,f){const k=g.width;let m=0;for(let n=a;n<c+a;n++)for(let a=b;a<d+b;a++){const b=4*(n*k+a);g.data[b]=f[m++];g.data[b+1]=f[m++];g.data[b+2]=f[m++];g.data[b+3]=f[m++]}}function a(b,a){b=d(b);a=d(a);return parseInt(b+a)}function d(b){b=b.toString();
if(1==b.length)return`0${b}`;if(2==b.length)return b}function f(d){let f=7;for(let g=0;g+7<=d.length;g=l+1)x=a(d[g+1],d[g+2]),y=a(d[g+3],d[g+4]),h=parseInt(d[g+5]),w=parseInt(d[g+6]),l=f+h*w-1,recmsg=d.subarray(f,l+1),c(recmsg),b(x,y,w,h,k),f=l+7+1;m&&clearTimeout(m);m=setTimeout(()=>{postMessage({globalImageData:g,dtype:"drgb"})},100)}let g={},k,m;onmessage=function(b){if(Object.prototype.hasOwnProperty.call(b.data,"dtype"))if("drgb"==b.data.dtype){var a=b.data.encodeArr,d=b.data.uid;g=new ImageData(b.data.cw,
b.data.ch);b=4*a.length;for(let d=0;d<b;d++)g.data[4*d]=36.5*(a[d]>>5),g.data[4*d+1]=36.5*((a[d]&28)>>2),g.data[4*d+2]=85*(a[d]&3),g.data[4*d+3]=255;postMessage({globalImageData:g,dtype:"drgb",stype:"full",uid:d})}else f(b.data.data_pack)}}.toString(),")()"],{type:"application/javascript"})),sdworker=new Worker(screenDecodeBlob);const screenWorkerBlob=URL.createObjectURL(new Blob(["(",function(){function c(b,a){b=b.toString();let d;for(d=b.length;d<a;d++)b=`0${b}`;return b.match(/[\S]{1,2}/g)||[]}function b(b){0===k?d=a=0:(f=k%b.data.resB,g=Math.floor(k/b.data.resB),a=f*b.data.dw,d=g*b.data.dh);return{x:a,y:d,w:b.data.dw,h:b.data.dh}}let a,d,f,g,k,m=0,n,r,t,z,v=null,u=[],p,q,A;const D=function(b,a,d,c,f,g,k){g=new Uint8ClampedArray(d*c);let m=0;for(let n=a;n<c+a;n+=1)for(let a=b;a<d+b;a+=1){const b=n*f+a;g[m++]=k[b]}return g},
F=function(b,a,d){const c=a.length;let f;if(a.length!==b.length)return!1;for(f=0;f<c;f+=1){if(a[f]!==b[f])return!1;f+=d}for(f=0;f<c;--f)if(f+=d,a[f]!==b[f])return!1;for(f=0;f<c;f+=7)if(a[f]!==b[f])return!1;return!0};onmessage=function(a){if(Object.prototype.hasOwnProperty.call(a.data,"initPrevImg"))u=[],v=null;else if(Object.prototype.hasOwnProperty.call(a.data,"resize"))for(k=0;k<a.data.resA*a.data.resB;k++)t=b(a),u[k]=D(t.x,t.y,t.w,t.h,a.data.offsetWidth,a.data.offsetHeight,a.data.img);else{{var d=
a.data.img,f=d.length/4;let b;var g;if(null===v||v.length!==f)v=new Uint8ClampedArray(f);for(g=0;g<f;g++){var G=d[4*g];var I=d[4*g+1];b=d[4*g+2];G=(Math.round(G/36.5)<<5)+(Math.round(I/36.5)<<2)+Math.round(b/85);v[g]=G}}for(k=0;k<a.data.resA*a.data.resB;k++)if(t=b(a),z=D(t.x,t.y,t.w,t.h,a.data.offsetWidth,a.data.offsetHeight,v),"undefined"!==typeof u[k]){if(n=F(z,u[k],t.w),!n){if(u[k].length!==z.length)u[k]=z;else for(d=0;d<z.length;d++)u[k][d]=z[d];d=z;f=t;g=a.data.type;I=c(f.x,4);G=c(f.y,4);g=new Uint8ClampedArray(["ss"===
g?103:203,I[0],I[1],G[0],G[1],f.h,f.w]);f=new Uint8ClampedArray(d.length+g.length);f.set(g);f.set(d,g.length);d=f;null===r||void 0===r?r=d:(f=new Uint8ClampedArray(r.length+d.length),f.set(r),f.set(d,r.length),r=f)}}else console.log("====> screen share need full screen "),u[k]=z,m=1;r?(q=c(a.data.uid,8),p=new Uint8ClampedArray(["103","123",q[0],q[1],q[2],q[3]]),A=new Uint8ClampedArray(r.length+p.length),A.set(p),A.set(r,p.length),postMessage({sendMasterSlice:A,needFullScreen:m},[A.buffer]),A=null):
postMessage({masterSlice:null,needFullScreen:m});m=0;r=null}}}.toString(),")()"],{type:"application/javascript"})),sworker=new Worker(screenWorkerBlob);const dtConWorkerBlob=URL.createObjectURL(new Blob(["(",function(){const c=function(){function b(b,a){b=b.replace(/[^A-Za-z0-9\+\/]/g,"");const d=b.length;a=a?Math.ceil((3*d+1>>2)/a)*a:3*d+1>>2;const c=new Uint8Array(a);for(var f,n=0,r=0,t=0;t<d;t++){f=t&3;var z=b.charCodeAt(t);n|=(64<z&&91>z?z-65:96<z&&123>z?z-71:47<z&&58>z?z+4:43===z?62:47===z?63:0)<<6*(3-f);if(3===f||1===d-t){for(f=0;3>f&&r<a;f++,r++)c[r]=n>>>(16>>>f&24)&255;n=0}}return c}function a(b){return 26>b?b+65:52>b?b+71:62>b?b-4:62===
b?43:63===b?47:65}return{base64EncArrInt(b){const a=new Uint8Array(b.length);for(let d=0;d<b.length;d++)a[d]=0>b[d]?-1*b[d]+127:b[d];return this.base64EncArr(a)},base64EncArr(b){let d=2,c="";for(let f=b.length,g=0,n=0;n<f;n++)if(d=n%3,0<n&&0===4*n/3%76&&(c+="\r\n"),g|=b[n]<<(16>>>d&24),2===d||1===b.length-n)c+=String.fromCharCode(a(g>>>18&63),a(g>>>12&63),a(g>>>6&63),a(g&63)),g=0;return c.substr(0,c.length-2+d)+(2===d?"":1===d?"=":"==")},base64DecToArrInt(a){a=b(a);const d=new Int8Array(a.length);
for(let b=0;b<a.length;b++)d[b]=128<=a[b]?-1*(a[b]-127):a[b];return d},base64DecToArrclm(a){a=b(a);return new Uint8ClampedArray(a.buffer)}}}();onmessage=function(b){if(Object.prototype.hasOwnProperty.call(b.data,"dt")){if("a"==b.data.dt)var a=c.base64EncArrInt(b.data.msg);else"c"==b.data.dt&&(a=c.base64EncArr(b.data.msg));postMessage({dt:b.data.dt,msg:a})}}}.toString(),")()"],{type:"application/javascript"})),dtConWorker=new Worker(dtConWorkerBlob);/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file sends/receives packet to/from  Server through websocket
*/
const workerIOBlob=URL.createObjectURL(new Blob(["(",function(){const c={workerAudioRec:!1,workerAudioSend:!1,binMsgQueue:[],recBinMsgQueue:[],packetQueue:[],init(b){this.cfg=b;this.wsconnect()},userauthenticate(){const b=`F-AH-${JSON.stringify({authuser:this.cfg.authuser,authpass:this.cfg.authpass})}`;this.finallySend(b)},addclient(){const b=`F-JR-${JSON.stringify({client:this.cfg.userid,roomname:this.cfg.room,user:this.cfg.userobj})}`;this.finallySend(b)},wsconnect(){c.wsuri=this.cfg.rid;"undefined"!==
typeof WebSocket?this.sock=new WebSocket(c.wsuri):(console.log("Browser does not support WebSocket!"),this.error=virtualclass.lang.getString("wserror"));const b=this;this.sock.onopen=function(){b.userauthenticate();b.addclient();postMessage({cmd:"connectionopen",msg:{type:"connectionopen"}})};this.sock.binaryType="arraybuffer";this.sock.onmessage=function(b){if(b.data instanceof ArrayBuffer)c.onRecBinary(b);else postMessage({cmd:"receivedJson",msg:b.data})};this.sock.onerror=function(a){b.error=a;
postMessage({cmd:"error",msg:a.reason})};this.sock.onclose=function(b){postMessage({cmd:"close",msg:b.reason})}},disconnect(){this.sock.onclose=function(){};this.sock.close();postMessage({cmd:"iamclosing"})},onRecBinary(b){if(b.data instanceof ArrayBuffer){var a=new Uint8Array(b.data);if(0==a[1]){b=101==a[2]?new Int8Array(a):new Uint8ClampedArray(a);postMessage({cmd:"stBinary",msg:b});a=a.subarray(2);var d=101==a[0]?new Int8Array(a):new Uint8ClampedArray(a);101==a[0]?this.workerAudioRec?this.workerAudioRec.postMessage({cmd:"ad",
msg:a},[a.buffer]):postMessage({cmd:"initAudioWorklet"}):postMessage({cmd:"notaudio",msg:d.buffer})}else if(1==a[1])this.recBinMsgQueue=[],this.recBinMsgQueue[0]=a.subarray(2);else if(2==a[1])0<this.recBinMsgQueue.length&&this.recBinMsgQueue.push(a.subarray(2));else if(3==a[1]&&0<this.recBinMsgQueue.length){this.recBinMsgQueue.push(a.subarray(2));for(b=d=0;b<this.recBinMsgQueue.length;b++)d+=this.recBinMsgQueue[b].length;d=101==a[0]?new Int8Array(d):new Uint8ClampedArray(d);for(a=b=0;b<this.recBinMsgQueue.length;b++)d.set(this.recBinMsgQueue[b],
a),a+=this.recBinMsgQueue[b].length;postMessage({cmd:"endBinary",msg:d})}}},finallySend(b){this.sock.readyState&&this.sock.send(b)},sendStream(b){var a=new b.constructor(b.length+2);a.set([b[0],0]);a.set(b,2);this.finallySend(a.buffer);postMessage({cmd:"stBinary",msg:a})},sendBinary(b){if(this.sock.readyState&&b.length)if(6E5>=b.length){var a=new b.constructor(b.length+2);a.set([b[0],0]);a.set(b,2);this.finallySend(a.buffer);postMessage({cmd:"stBinary",msg:a})}else{this.binMsgQueue=[];for(let d=0,
c=0;d<b.length;c++)a=b.slice(d,d+55E4),b.constructor===Int8Array?this.binMsgQueue[c]=new Int8Array(a.length+2):b.constructor===Uint8ClampedArray&&(this.binMsgQueue[c]=new Uint8ClampedArray(a.length+2)),this.binMsgQueue[c].set([b[0],2]),this.binMsgQueue[c].set(a,2),a.length&&(d+=a.length);this.binMsgQueue[0][1]=1;this.binMsgQueue[this.binMsgQueue.length-1][1]=3;for(b=0;b<this.binMsgQueue.length;b++)this.finallySend(this.binMsgQueue[b].buffer),postMessage({cmd:"stBinary",msg:this.binMsgQueue[b]});this.binMsgQueue=
[]}},onMessage(b){switch(b.data.cmd){case "init":this.init(b.data.msg);break;case "wsconnect":this.wsconnect();break;case "disconnect":this.disconnect();break;case "sessionEndClose":this.sock&&this.sock.close();break;case "workerAudioRec":this.workerAudioRec=b.ports[0];this.workerAudioRec.onmessage=function(b){Object.prototype.hasOwnProperty.call(b.data,"dest")&&"mainthread"==b.data.dest&&postMessage(b.data)};break;case "send":if(this.sock.readyState){if(0<c.packetQueue.length){for(let b=0;b<c.packetQueue.length;b++)this.finallySend(c.packetQueue[b]);
c.packetQueue.length=0}this.finallySend(b.data.msg)}else c.packetQueue.push(b.data.msg);break;case "sendBinary":this.sendBinary(b.data.msg);break;case "workerAudioSend":this.workerAudioSend=b.ports[0];this.workerAudioSend.onmessage=this.fromWorkerAudioSend.bind(this);break;case "onRecBinary":this.onRecBinary({data:b.data.msg});break;case "sendStream":this.sendStream(b.data.msg);break;default:this.finallySend(b.data.msg)}},fromWorkerAudioSend(b){Object.prototype.hasOwnProperty.call(b.data,"cmd")&&
this.sendBinary(b.data.msg)}};onmessage=function(b){c.onMessage(b)}}.toString(),")()"],{type:"application/javascript"})),workerIO=new Worker(workerIOBlob);/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file receives the audio from workerio and
 decode the audio and send this to reciever audio worklert(worklet-audio-rec.js)
*/
const workerAudioRecBlob=URL.createObjectURL(new Blob(["(",function(){importScripts("https://cdn.congrea.net/build/src/audio-g711-and-resampler.min.js");const c={workletAudioRec:null,workerIO:null,samples:null,allAudioArr:{},audioToBePlay:{},gAudio:{},adSign:{},resamplerdecode:{},mergeAllAudioSend:[],allAudioSend:[],supportAudioWorklet:!1,sampleRate:null,extractData(b){b=new Int8Array(b);return[this.numValidateFour(b[1],b[2],b[3],b[4]),b.subarray(5,b.length)]},numValidateFour(b,a,d,c){b=this.preNumValidateTwo(b);
a=this.preNumValidateTwo(a);d=this.preNumValidateTwo(d);c=this.preNumValidateTwo(c);return parseInt(b+a+d+c)},numValidateTwo(b,a){b=this.preNumValidateTwo(b);a=this.preNumValidateTwo(a);return parseInt(b+a)},preNumValidateTwo(b){b=b.toString();if(1==b.length)return`0${b}`;if(2==b.length)return b},resample(b,a){Object.prototype.hasOwnProperty.call(this.audioToBePlay,a)||(this.audioToBePlay[a]=[]);this.samples=G711.decode(b,{floating_point:!0,Eight:!0});"object"!==typeof this.resamplerdecode[a]&&(this.resamplerdecode[a]=
new Resampler(8E3,this.sampleRate,1,32768));return this.samples=this.resamplerdecode[a].resampler(this.samples)},onMessage(b){if(Object.prototype.hasOwnProperty.call(b.data,"cmd"))switch(b.data.cmd){case "workerIO":this.workerIO=b.ports[0];this.sampleRate=b.data.sampleRate;this.workerIO.onmessage=this.fromworkerIO.bind(this);break;case "workletAudioRec":this.workletAudioRec=b.ports[0];this.workletAudioRec.onmessage=this.fromworkletAudioRec.bind(this);break;case "audioWorklet":this.supportAudioWorklet=
b.data.msg}},fromworkletAudioRec(){},fromworkerIO(b){if(Object.prototype.hasOwnProperty.call(b.data,"msg")){({msg:b}=b.data);var a=this.extractData(b);b=a[0];Object.prototype.hasOwnProperty.call(this.adSign,b)||(this.adSign[b]={},this.adSign[b].ad=!0,this.workerIO.postMessage({cmd:"firstAudio",msg:{userId:b},dest:"mainthread"}));a=this.resample(a[1],b);this.supportAudioWorklet?this.workletAudioRec.postMessage({cmd:"audio",msg:{data:a,uid:b}}):postMessage({cmd:"noAudioWorklet",msg:{data:a,uid:b}})}}};
onmessage=function(b){c.onMessage(b)}}.toString(),")()"],{type:"application/javascript"})),workerAudioRec=new Worker(workerAudioRecBlob);/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file recevied the audio from audio worker send (worker-audio-send),
 encode the audio and send it to io worker(worker-io.js)
*/
const workerAudioSendBlob=URL.createObjectURL(new Blob(["(",function(){importScripts("https://cdn.congrea.net/build/src/audio-g711-and-resampler.min.js");const c={audioWorkletSend:null,workerIO:null,gObjUid:null,audMouseDown:!1,precheck:!1,repMode:!1,minthreshold:65535,audioWasSent:0,preAvg:0,curAvg:0,maxthreshold:0,convertFloat32ToInt16(b){let a=b.length;const d=new Int16Array(a);for(;a--;)d[a]=32767*Math.min(1,b[a]);return d},encodeAudio(b){return G711.encode(b,{alaw:!0})},breakintobytes(b,a){b=
b.toString();for(let d=b.length;d<a;d++)b=`0${b}`;return b.match(/[\S]{1,2}/g)||[]},sendBinary(b){null!=this.workerIO&&this.workerIO.postMessage({cmd:"sendBinary",msg:b})},audioSend(b,a){if(this.audMouseDown&&!this.precheck){a=this.breakintobytes(this.gObjUid,8);a=new Int8Array([101,a[0],a[1],a[2],a[3]]);const d=new Int8Array(b.length+a.length);d.set(a);d.set(b,a.length);this.sendBinary(d)}},silenceDetection(b,a){let d,c=sum=rate=0;for(i=0;i<a.length;i++)d=Math.abs(a[i]),c<d&&(c=d),sum+=d;this.curAvg=
sum/a.length;rate=Math.abs(this.curAvg^2-this.preAvg^2);this.preAvg=this.curAvg;5>rate&&(this.minthreshold=c);this.minthreshold>c&&(this.minthreshold=c);this.maxthreshold<c&&(this.maxthreshold=c);20*this.minthreshold<this.maxthreshold&&(this.minthreshold*=5);this.maxthreshold/20>this.minthreshold&&(this.maxthreshold/=5);10<g&&(this.maxthreshold*=.8);var g=this.maxthreshold/this.minthreshold;a=c/this.minthreshold;0!==c&&postMessage({cmd:"unMuteAudio"});isFinite(g)&&20<=g||2<a||rate>this.minthreshold||
25<rate||c>2*this.minthreshold||4>=g?(this.audioSend(b,"sending"),this.audioWasSent=6):0<this.audioWasSent?(this.audioSend(b,"sending"),this.audioWasSent--):2>g?this.audioSend(b,"sending"):0===c&&postMessage({cmd:"muteAudio"});return b},recorderProcess(b){if(!this.repMode&&this.audMouseDown&&!this.precheck){b=this.resampler.resampler(b);b=this.convertFloat32ToInt16(b);const a=this.encodeAudio(b);this.silenceDetection(a,b)}},onMessage(b){switch(b.data.cmd){case "workerIO":this.workerIO=b.ports[0];
this.resampler=new Resampler(b.data.sampleRate,8E3,1,4096);this.workerIO.onmessage=function(b){};this.gObjUid=b.data.uid;break;case "audioWorkletSend":this.audioWorkletSend=b.ports[0];this.repMode=b.data.msg.repMode;this.audioWorkletSend.onmessage=this.formAudioWorkletSend.bind(this);break;case "audioMouseDown":this.audMouseDown=b.data.msg.adMouseDown;break;case "precheck":this.precheck=b.data.msg.precheck;break;case "rawAudio":this.recorderProcess(b.data.msg)}},formAudioWorkletSend(b){Object.prototype.hasOwnProperty.call(b.data,
"cmd")&&"rawAudio"==b.data.cmd&&this.recorderProcess(b.data.msg)}};onmessage=function(b){c.onMessage(b)}}.toString(),")()"],{type:"application/javascript"})),workerAudioSend=new Worker(workerAudioSendBlob);/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file(Audio worklet) plays the received Audio from received audio worker(worker-audio-rec.js)
*/
const workletAudioRecBlob=URL.createObjectURL(new Blob(["(",function(){function c(a){Object.prototype.hasOwnProperty.call(a.data,"cmd")&&"workerAudioRec"===a.data.cmd&&(m=a.ports[0],m.onmessage=b)}function b(b){if(Object.prototype.hasOwnProperty.call(b.data,"cmd")&&"audio"===b.data.cmd){var d=b.data.msg.data;b=b.data.msg.uid;null==a[b]&&(a[b]=[]);null==g[b]&&(g[b]=[]);for(let a=0;a<d.length;a++)g[b].push(d[a]);for(;128<=g[b].length;)d=g[b].splice(0,128),a[b].push(new Float32Array(d))}}const a={},
d={};let f=0;const g={};let k,m;const n=[];let r=0;class t extends AudioWorkletProcessor{constructor(){super();this.port.onmessage=c}process(b,c){r=n.length=0;for(k in a){b:{b=k;if(null!==a){if(288<=a[b].length){for(;96<=a[b].length;)a[b].shift();d[b]=!0;b=a[b].shift();break b}if(64<=a[b].length){d[b]=!0;b=a[b].shift();break b}if(0<a[b].length&&!0===d[b]){d[b]=!0;b=a[b].shift();break b}d[b]=!1;0===a[b].length&&delete a[b]}b=void 0}if(null!=b)if(r++,1===r)for(var g=0;128>g;g++)n[g]=b[g];else for(g=
0;128>g;g++)n[g]+=b[g]}if(1===r)b=n;else if(1<r){for(b=0;128>b;b++)n[b]/=r;b=n}else b=void 0;if(null!=b)c[0][0].set(b,0),f=b[127];else if(null!==f)for(b=0;128>b;b++)c[0][0][b]=f;return!0}}registerProcessor("worklet-audio-rec",t)}.toString(),")()"],{type:"application/javascript"}));/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file gets audio continuously from getUserMedia, and
 send it to send audio worker (worker-audio-send.js)
*/
const workletAudioSendBlob=URL.createObjectURL(new Blob(["(",function(){class c extends AudioWorkletProcessor{constructor(){super();this.audios=new Float32Array(4096);this.position=0;const b=this;this.port.onmessage=function(a){Object.prototype.hasOwnProperty.call(a.data,"cmd")&&"workerAudioSend"==a.data.cmd&&(b.workerAudioSend=a.ports[0],b.workerAudioSend.onmessage=b.fromworkerAudioSend)}}fromworkerAudioSend(){}process(b,a){b=b[0][0];this.audios.set(b,this.position);this.position+=b.length;4096<=
this.position&&(Object.prototype.hasOwnProperty.call(this,"workerAudioSend")&&this.workerAudioSend.postMessage({cmd:"rawAudio",msg:this.audios}),this.audios=new Float32Array(4096),this.position=0);return!0}}registerProcessor("worklet-audio-send",c)}.toString(),")()"],{type:"application/javascript"}));function Resampler(c,b,a,d,f){this.fromSampleRate=c;this.toSampleRate=b;this.channels=a|0;this.outputBufferSize=d;this.noReturn=!!f;this.initialize()}
Resampler.prototype.initialize=function(){if(0<this.fromSampleRate&&0<this.toSampleRate&&0<this.channels)this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1):(this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.initializeBuffers());else throw Error("Invalid settings specified for the resampler.");
};Resampler.prototype.compileLinearInterpolationFunction=function(){let c=`var bufferLength = buffer.length;\
	var outLength = this.outputBufferSize;\
	if ((bufferLength % ${this.channels}) == 0) {\
		if (bufferLength > 0) {\
			var ratioWeight = this.ratioWeight;\
			var weight = this.lastWeight;\
			var firstWeight = 0;\
			var secondWeight = 0;\
			var sourceOffset = 0;\
			var outputOffset = 0;\
			var outputBuffer = this.outputBuffer;\
			for (; weight < 1; weight += ratioWeight) {\
				secondWeight = weight % 1;\
				firstWeight = 1 - secondWeight;`;for(var b=0;b<this.channels;++b)c+=`outputBuffer[outputOffset++] = (this.lastOutput[${b}] * firstWeight) + (buffer[${b}] * secondWeight);`;c+=`}\
			weight -= 1;\
			for (bufferLength -= ${this.channels}, sourceOffset = Math.floor(weight) * ${this.channels}; outputOffset < outLength && sourceOffset < bufferLength;) {\
				secondWeight = weight % 1;\
				firstWeight = 1 - secondWeight;`;for(b=0;b<this.channels;++b)c+=`outputBuffer[outputOffset++] = (buffer[sourceOffset${0<b?` + ${b}`:""}] * firstWeight) + (buffer[sourceOffset + ${this.channels+b}] * secondWeight);`;c+=`weight += ratioWeight;\
				sourceOffset = Math.floor(weight) * ${this.channels};\
			}`;for(b=0;b<this.channels;++b)c+=`this.lastOutput[${b}] = buffer[sourceOffset++];`;this.resampler=Function("buffer",c+'this.lastWeight = weight % 1;\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};Resampler.prototype.compileMultiTapFunction=function(){let c=`var bufferLength = buffer.length;\
	var outLength = this.outputBufferSize;\
	if ((bufferLength % ${this.channels}) == 0) {\
		if (bufferLength > 0) {\
			var ratioWeight = this.ratioWeight;\
			var weight = 0;`;for(var b=0;b<this.channels;++b)c+=`var output${b} = 0;`;c+="var actualPosition = 0;\t\t\tvar amountToNext = 0;\t\t\tvar alreadyProcessedTail = !this.tailExists;\t\t\tthis.tailExists = false;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tvar outputOffset = 0;\t\t\tvar currentPosition = 0;\t\t\tdo {\t\t\t\tif (alreadyProcessedTail) {\t\t\t\t\tweight = ratioWeight;";for(b=0;b<this.channels;++b)c+=`output${b} = 0;`;c+="}\t\t\t\telse {\t\t\t\t\tweight = this.lastWeight;";for(b=0;b<
this.channels;++b)c+=`output${b} = this.lastOutput[${b}];`;c+="alreadyProcessedTail = true;\t\t\t\t}\t\t\t\twhile (weight > 0 && actualPosition < bufferLength) {\t\t\t\t\tamountToNext = 1 + actualPosition - currentPosition;\t\t\t\t\tif (weight >= amountToNext) {";for(b=0;b<this.channels;++b)c+=`output${b} += buffer[actualPosition++] * amountToNext;`;c+="currentPosition = actualPosition;\t\t\t\t\t\tweight -= amountToNext;\t\t\t\t\t}\t\t\t\t\telse {";for(b=0;b<this.channels;++b)c+=`output${b} += buffer[actualPosition${0<
b?` + ${b}`:""}] * weight;`;c+="currentPosition += weight;\t\t\t\t\t\tweight = 0;\t\t\t\t\t\tbreak;\t\t\t\t\t}\t\t\t\t}\t\t\t\tif (weight == 0) {";for(b=0;b<this.channels;++b)c+=`outputBuffer[outputOffset++] = output${b} / ratioWeight;`;c+="}\t\t\t\telse {\t\t\t\t\tthis.lastWeight = weight;";for(b=0;b<this.channels;++b)c+=`this.lastOutput[${b}] = output${b};`;this.resampler=Function("buffer",c+'this.tailExists = true;\t\t\t\t\tbreak;\t\t\t\t}\t\t\t} while (actualPosition < bufferLength && outputOffset < outLength);\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.bypassResampler=function(c){return this.noReturn?(this.outputBuffer=c,c.length):c};Resampler.prototype.bufferSlice=function(c){if(this.noReturn)return c;try{return this.outputBuffer.subarray(0,c)}catch(b){try{return this.outputBuffer.length=c,this.outputBuffer}catch(a){return this.outputBuffer.slice(0,c)}}};
Resampler.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch(c){this.outputBuffer=[],this.lastOutput=[]}};/*
 g711
 Copyright(c) 2011 Jo?o Martins <madjackoo@gmail.com>
 MIT Licensed
*/
const G711={BIAS:132,CLIP:32635,tables:{alaw:{compress:[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],decompress:[-5504,-5248,-6016,-5760,-4480,-4224,-4992,-4736,-7552,-7296,-8064,-7808,-6528,-6272,-7040,-6784,-2752,-2624,-3008,-2880,-2240,-2112,-2496,-2368,-3776,-3648,-4032,-3904,-3264,-3136,
-3520,-3392,-22016,-20992,-24064,-23040,-17920,-16896,-19968,-18944,-30208,-29184,-32256,-31232,-26112,-25088,-28160,-27136,-11008,-10496,-12032,-11520,-8960,-8448,-9984,-9472,-15104,-14592,-16128,-15616,-13056,-12544,-14080,-13568,-344,-328,-376,-360,-280,-264,-312,-296,-472,-456,-504,-488,-408,-392,-440,-424,-88,-72,-120,-104,-24,-8,-56,-40,-216,-200,-248,-232,-152,-136,-184,-168,-1376,-1312,-1504,-1440,-1120,-1056,-1248,-1184,-1888,-1824,-2016,-1952,-1632,-1568,-1760,-1696,-688,-656,-752,-720,
-560,-528,-624,-592,-944,-912,-1008,-976,-816,-784,-880,-848,5504,5248,6016,5760,4480,4224,4992,4736,7552,7296,8064,7808,6528,6272,7040,6784,2752,2624,3008,2880,2240,2112,2496,2368,3776,3648,4032,3904,3264,3136,3520,3392,22016,20992,24064,23040,17920,16896,19968,18944,30208,29184,32256,31232,26112,25088,28160,27136,11008,10496,12032,11520,8960,8448,9984,9472,15104,14592,16128,15616,13056,12544,14080,13568,344,328,376,360,280,264,312,296,472,456,504,488,408,392,440,424,88,72,120,104,24,8,56,40,216,
200,248,232,152,136,184,168,1376,1312,1504,1440,1120,1056,1248,1184,1888,1824,2016,1952,1632,1568,1760,1696,688,656,752,720,560,528,624,592,944,912,1008,976,816,784,880,848]}},encode:function(c,b){c.constructor==Array&&(c.byteLength=2*c.length);b=new ArrayBuffer(c.byteLength/2);b=new Int8Array(b);for(let k=0;k<c.byteLength/2;k++){var a=new ArrayBuffer(2),d=new ArrayBuffer(1),f=new Int16Array(a);a=new Int8Array(d);d=~c[k]>>8&128;128!=d&&(f[0]=-c[k],c[k]=f[0]);c[k]>G711.CLIP&&(c[k]=G711.CLIP);if(256<=
c[k]){f=G711.tables.alaw.compress[c[k]>>8&127];var g=c[k]>>f+3&15;a[0]=f<<4|g}else a[0]=c[k]>>4;a[0]=a[0]^d^85;b[k]=a[0]}return b},decode:function(c,b){b=b||{};"undefined"===typeof c.byteLength&&(c.byteLength=c.length);var a=new ArrayBuffer(c.byteLength*(b.floating_point?4:2));b=new Float32Array(a);for(let d=0;d<c.byteLength;d++){a=new ArrayBuffer(2);a=new Int8Array(a);const f=G711.tables.alaw.decompress[c[d]&255];a[0]=f;a[1]=f>>8;a=(new Int16Array(a.buffer))[0];b[d]=a/32768}return b}};const webpToPngBlob=URL.createObjectURL(new Blob(["(",function(){importScripts("https://cdn.congrea.net/build/src/video-libwebp-0.1.3.min.js");onmessage=function(c){if(c.data.hasOwnProperty("vdata")){{var b=c.data.vdata;c=c.data.canid;const g=new WebPDecoder;b=convertBinaryToArray(b);const k=g.WebPDecoderConfig;var a=k.output,d=k.input;if(g.WebPInitDecoderConfig(k)){k.options.no_fancy_upsampling=0;k.options.bypass_filtering=0;k.options.use_cropping=0;k.options.crop_left=0;k.options.crop_top=0;k.options.crop_width=
0;k.options.crop_height=0;var f=g.VP8StatusCode;if(0<b.length&&(d=g.WebPGetFeatures(b,b.length,d),d!=f.VP8_STATUS_OK&&alert("error"),a.colorspace=g.WEBP_CSP_MODE.MODE_RGBA,0<b.length))if(d=parseInt(g.WebPDecode(b,b.length,k),10),d!=f.VP8_STATUS_OK)alert("Decoding of %s failed.\n");else if(b=a.u.RGBA.rgba)f=a.height,a=a.width,b.pop(),postMessage({vdata:new Uint8ClampedArray(b),bh:f,bw:a,canid:c})}else alert("Library version mismatch!\n")}}}}.toString(),")()"],{type:"application/javascript"})),webpToPng=
new Worker(webpToPngBlob);/*
  2014 Suman Bogati, Pinky Sharma and Jai Gupta  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
*/
var io={cfg:{},sock:null,wsuri:null,error:null,uniquesids:null,serial:null,globallock:!1,readyToSend:!1,globalmsgjson:[],packetQueue:[],binMsgQueue:[],jsnMsgQueue:[],recBinMsgQueue:[],recjsnMsgQueue:null,stockReadyState:!1,workerIOOnmessage:!1,sessionSet:!1,recordingSet:!1,init(c){this.cfg=c;"use strict";ioInit.sendToWorker({cmd:"init",msg:c})},send(c,b,a){Object.prototype.hasOwnProperty.call(c,"m")&&"all"===c.m.user&&alert("som packet are sending");c={cfun:b,arg:{msg:c}};a&&(c.arg.touser=a);if(this.webSocketConnected()){if(0<
io.packetQueue.length){for(a=0;a<io.packetQueue.length;a++)b=JSON.parse(io.packetQueue[a]),this.realSend(b);io.packetQueue.length=0}this.realSend(c)}else a=JSON.stringify(c),io.packetQueue.push(a)},realSend(c){if("undefined"!==typeof c.arg.touser&&null!=io.uniquesids&&(c.arg.touser=io.uniquesids[c.arg.touser],"undefined"===typeof c.arg.touser))return;var b={userid:wbUser.id};switch(c.cfun){case "broadcastToAll":if("undefined"===typeof c.arg.touser){var a={user:{userid:b.userid},m:c.arg.msg};b={user:b,
m:c.arg.msg};Object.prototype.hasOwnProperty.call(c.arg.msg,"serial")&&ioStorage.storeCacheAllData(b,[virtualclass.gObj.uid,c.arg.msg.serial]);c=`F-BR-{"0${JSON.stringify(a)}`}else{b={user:b,m:c.arg.msg,userto:c.arg.touser};for({touser:a}=c.arg;12>a.length;)a=`0${a}`;Object.prototype.hasOwnProperty.call(c.arg.msg,"userSerial")&&ioStorage.storeCacheOutData(b,[c.arg.touser,c.arg.msg.userSerial]);c=`F-BRU-{"${a}{"0${JSON.stringify(b)}`}break;case "ping":b={type:"PONG",m:c.arg.msg};c=`F-PI-${JSON.stringify(b)}`;
break;case "speed":c=`F-SPE-{"${c.arg.msg}`;break;case "session":c=`F-SS-{"${c.arg.msg}`;break;case "recording":c=`F-SR-{"${c.arg.msg}`;break;default:c=JSON.stringify(c)}if(6E5>=c.length)workerIO.postMessage({cmd:"send",msg:c});else{if(this.jsnMsgQueue=this.chunkSubstr(c,55E4))for(c=0;c<this.jsnMsgQueue.length;c++)workerIO.postMessage({cmd:"send",msg:this.jsnMsgQueue[c]});this.jsnMsgQueue=[]}},chunkSubstr(c,b){if(c.startsWith('F-BR-{"0')){var a='F-BR-{"';c=c.replace('F-BR-{"0',"")}else if(c.startsWith('F-BRU-{"'))a=
c.substring(0,22),c=c.substring(23,c.length);else return!1;const d=Math.ceil(c.length/b),f=Array(d);for(let g=0,k=0;g<d;++g,k+=b)f[g]=c.substr(k,b),f[g]=0===g?`${a}1${f[g]}`:g<d-1?`${a}2${f[g]}`:`${a}3${f[g]}`;return f},cleanRecJson(c){if(!(c.startsWith('{"0{"')||c.startsWith('{"1{"')||c.startsWith('{"2')||c.startsWith('{"3')))return c;if(c.startsWith('{"0{"'))return c=c.replace('{"0{"','{"');if(c.startsWith('{"1{"'))this.recjsnMsgQueue=c.replace('{"1{"','{"');else if(c.startsWith('{"2'))0<this.recjsnMsgQueue.length&&
(this.recjsnMsgQueue+=c.replace('{"2',""));else if(c.startsWith('{"3')){if(0<this.recjsnMsgQueue.length)return this.recjsnMsgQueue+=c.replace('{"3',"")}else this.recjsnMsgQueue="";return!1},sendBinary(c){workerIO.postMessage({cmd:"sendBinary",msg:c})},sendStream(c){workerIO.postMessage({cmd:"sendStream",msg:c})},onRecMessage(c){if(c.data instanceof ArrayBuffer)workerIO.postMessage({cmd:"onRecBinary",msg:c.data});else ioInit.onmessage({data:{cmd:"receivedJson",msg:c.data}})},webSocketConnected(){return roles.hasControls()&&
!io.sessionSet||virtualclass.settings.recording.enableRecording&&!io.recordingSet||!io.readyToSend?!1:io.stockReadyState},onRecJson(c){if(!1===io.globallock)if(0<io.globalmsgjson.length)for(;0<io.globalmsgjson.length&&!1===io.globallock;)c=io.globalmsgjson.shift(),io.onRecJsonIndividual(c);else if(null!=c&&!1===io.globallock&&0===io.globalmsgjson.length)io.onRecJsonIndividual(c);else null!=c&&io.globalmsgjson.push(c);else null!=c&&io.globalmsgjson.push(c)},onRecJsonIndividual(c){var b="";switch(c.type){case "joinroom":Object.prototype.hasOwnProperty.call(c,
"users")&&ioAdapter.setRecording();io.readyToSend=!0;b=null;if(null!=io.uniquesids)for(var a in c.clientids)null==io.uniquesids[a]&&(b=a);io.uniquesids=c.clientids;a={type:"member_added",newuser:b,joinUser:c.action};Object.prototype.hasOwnProperty.call(c,"users")?(a.message=c.users,a.users=!0):Object.prototype.hasOwnProperty.call(c,"user")&&(a.message=c.user,a.user=!0);(!virtualclass.vutil.isPlayMode()||Object.prototype.hasOwnProperty.call(c,"clientids")&&!Object.prototype.hasOwnProperty.call(virtualclass,
"connectedUsers")||Object.prototype.hasOwnProperty.call(virtualclass,"connectedUsers")&&!Object.prototype.hasOwnProperty.call(c,"clientids"))&&virtualclass.ioEventApi.readyto_member_add(a);break;case "broadcastToAll":case "broadcast":case "b":null!==c&&(null!=c.userto&&(b=c.userto),virtualclass.ioEventApi.newmessage({type:"newmessage",message:c.m,fromUser:c.user,toUser:virtualclass.vutil.getUserAllInfo(b,virtualclass.connectedUsers)}));break;case "userleft":if(null!=io.uniquesids)for(const b in c.action)delete io.uniquesids[b];
virtualclass.ioEventApi.readyto_user_logout(c);break;case "Unauthenticated":virtualclass.ioEventApi.authentication_failed({type:"authentication_failed",message:"Authentication failed"});break;case "Multiple_login":virtualclass.ioEventApi.Multiple_login({type:"Multiple_login"});break;case "PONG":virtualclass.ioEventApi.PONG({type:"PONG",message:c.m});break;case "Text_Limit_Exeed":virtualclass.ioEventApi.Text_Limit_Exeed({type:"Text_Limit_Exeed"});break;case "Binary_Limit_Exeed":virtualclass.ioEventApi.Binary_Limit_Exeed({type:"Binary_Limit_Exeed"});
break;case "Max_rooms":virtualclass.ioEventApi.Max_rooms({type:"Max_rooms"});break;case "Max_users":virtualclass.ioEventApi.Max_users({type:"Max_users"});break;case "chvs":console.log("Case:- chvs",c.m);c.message={fileName:c.f};virtualclass.liveStream.onMessage(c);break;case "setSession":roles.hasControls()&&ioAdapter.initSetSession(c.session)}},disconnect(){workerIO.postMessage({cmd:"disconnect"})}};workerIO.onmessage=function(c){ioInit.onmessage(c)};
var ioInit={sendToWorker(c){workerIO.postMessage(c)},async onmessage(c){switch(c.data.cmd){case "connectionopen":io.stockReadyState=!0;virtualclass.ioEventApi.connectionopen(c.data.msg);break;case "receivedJson":var b=io.cleanRecJson(c.data.msg);if(b)if(c=JSON.parse(b),!Object.prototype.hasOwnProperty.call(c,"type")&&Object.prototype.hasOwnProperty.call(c,"user")&&(c.type="broadcastToAll","undefined"===typeof virtualclass.gObj.allUserObj[c.user.userid]&&(virtualclass.gObj.allUserObj[c.user.userid]=
{},virtualclass.gObj.allUserObj[c.user.userid].userid=c.user.userid,virtualclass.gObj.allUserObj[c.user.userid].lname=" ",virtualclass.gObj.allUserObj[c.user.userid].name="student",virtualclass.gObj.allUserObj[c.user.userid].role="s"),virtualclass.gObj.allUserObj[c.user.userid].userid===c.user.userid&&(c.user.lname=virtualclass.gObj.allUserObj[c.user.userid].lname,c.user.name=virtualclass.gObj.allUserObj[c.user.userid].name,c.user.role=virtualclass.gObj.allUserObj[c.user.userid].role)),this.recjsnMsgQueue=
"",Object.prototype.hasOwnProperty.call(c,"m"))if(Object.prototype.hasOwnProperty.call(c.m,"serial"))await ioMissingPackets.checkMissing(c);else if(Object.prototype.hasOwnProperty.call(c.m,"reqMissPac"))Object.prototype.hasOwnProperty.call(virtualclass.recorder,"startUpload")||ioMissingPackets.sendMissedPackets(c);else if(Object.prototype.hasOwnProperty.call(c.m,"missedpackets"))ioMissingPackets.fillExecutedStore(c);else if(Object.prototype.hasOwnProperty.call(c.m,"userSerial"))ioMissingPackets.userCheckMissing(c);
else if(Object.prototype.hasOwnProperty.call(c.m,"userReqMissPac"))Object.prototype.hasOwnProperty.call(virtualclass.recorder,"startUpload")||ioMissingPackets.userSendMissedPackets(c);else if(Object.prototype.hasOwnProperty.call(c.m,"userMissedpackets"))ioMissingPackets.userFillExecutedStore(c);else io.onRecJson(c);else io.onRecJson(c);break;case "onRecBinary":io.onRecBinary(c);break;case "iamclosing":io.stockReadyState=!1;io.sessionSet=!1;io.recordingSet=!1;break;case "error":io.stockReadyState=
!1;io.sessionSet=!1;io.recordingSet=!1;virtualclass.ioEventApi.error({type:"error",message:c.data.msg});break;case "close":io.stockReadyState=!1;io.sessionSet=!1;io.recordingSet=!1;virtualclass.ioEventApi.connectionclose({type:"connectionclose",message:c.data.msg});setTimeout(()=>{Object.prototype.hasOwnProperty.call(virtualclass.gObj,"endSession")||Object.prototype.hasOwnProperty.call(virtualclass.gObj,"downloadProgress")||virtualclass.recorder.uploadInProcess||Object.prototype.hasOwnProperty.call(virtualclass.gObj,
"invalidlogin")&&virtualclass.gObj.invalidlogin||workerIO.postMessage({cmd:"wsconnect"})},5E3);break;case "initAudioWorklet":Object.prototype.hasOwnProperty.call(virtualclass.gObj,"isAudioContextReady")&&!virtualclass.gObj.audioRecWorkerReady&&(virtualclass.media.detectAudioWorklet()?virtualclass.media.audio.initPlay():virtualclass.media.audio.initPlayWithFallback());break;case "stBinary":Object.prototype.hasOwnProperty.call(c.data,"triggerBinRec")&&virtualclass.ioEventApi.binrec({type:"binrec",message:c.data.msg.buffer});
break;case "notaudio":virtualclass.ioEventApi.binrec({type:"binrec",message:c.data.msg});break;case "endBinary":({msg:c}=c.data);c.constructor===Int8Array?b=new Int8Array(c.length+2):c.constructor===Uint8ClampedArray&&(b=new Uint8ClampedArray(c.length+2));b[0]=c[0];b[1]=0;b.set(c,2);virtualclass.ioEventApi.binrec({type:"binrec",message:c.buffer});break;case "firstAudio":var a=virtualclass.user.control.updateUser(c.data.msg.userId,"ad",!0);virtualclass.user.control.audioSign(a,"create");break;case "audioSign":virtualclass.user.control.audioSign(a,
"create")}}};/*
 modernizr 3.5.0 (Custom Build) | MIT *
 https://modernizr.com/download/?-webp-setclasses ! */
!function(c,b,a){function d(b){let a=t.className;const d=n._config.classPrefix||"";if(z&&(a=a.baseVal),n._config.enableJSClass)a=a.replace(new RegExp(`(^|\\s)${d}no-js(\\s|$)`),`$1${d}js$2`);n._config.enableClasses&&(a+=` ${d}${b.join(` ${d}`)}`,z?t.className.baseVal=a:t.className=a)}function f(b,a){if("object"===typeof b)for(var c in b)r(b,c)&&f(c,b[c]);else{b=b.toLowerCase();c=b.split(".");let f=n[c[0]];if(2==c.length&&(f=f[c[1]]),"undefined"!==typeof f)return n;a="function"===typeof a?a():a;1==
c.length?n[c[0]]=a:(!n[c[0]]||n[c[0]]instanceof Boolean||(n[c[0]]=new Boolean(n[c[0]])),n[c[0]][c[1]]=a);d([(a&&0!=a?"":"no-")+c.join("-")]);n._trigger(b,a)}return n}var g=[],k=[];const m={_version:"3.5.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on(b,a){const d=this;setTimeout(()=>{a(d[b])},0)},addTest(b,a,d){k.push({name:b,fn:a,options:d})},addAsyncTest(b){k.push({name:null,fn:b})}};var n=function(){};n.prototype=m;n=new n;let r;var t=b.documentElement,z="svg"===
t.nodeName.toLowerCase();!function(){const b={}.hasOwnProperty;r="undefined"===typeof b||"undefined"===typeof b.call?function(b,a){return a in b&&"undefined"===typeof b.constructor.prototype[a]}:function(a,d){return b.call(a,d)}}();m._l={};m.on=function(b,a){this._l[b]||(this._l[b]=[]);this._l[b].push(a);Object.prototype.hasOwnProperty.call(n,b)&&setTimeout(()=>{n._trigger(b,n[b])},0)};m._trigger=function(b,a){if(this._l[b]){const d=this._l[b];setTimeout(()=>{let b;for(b=0;b<d.length;b++)(0,d[b])(a)},
0);delete this._l[b]}};n._q.push(()=>{m.addTest=f});n.addAsyncTest(()=>{function b(b,a,d){function c(a){const c=a&&"load"===a.type?1==g.width:!1;f(b,"webp"===b&&c?new Boolean(c):c);d&&d(a)}var g=new Image;g.onerror=c;g.onload=c;g.src=a}const a=[{uri:"data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",name:"webp"},{uri:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==",name:"webp.alpha"},
{uri:"data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA",name:"webp.animation"},{uri:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",name:"webp.lossless"}],d=a.shift();b(d.name,d.uri,d=>{if(d&&"load"===d.type)for(d=0;d<a.length;d++)b(a[d].name,a[d].uri)})});(function(){let b,a;var d;let c;for(const m in k)if(Object.prototype.hasOwnProperty.call(k,m)){if(b=[],a=k[m],a.name&&(b.push(a.name.toLowerCase()),
a.options&&a.options.aliases&&a.options.aliases.length))for(d=0;d<a.options.aliases.length;d++)b.push(a.options.aliases[d].toLowerCase());d="function"===typeof a.fn?a.fn():a.fn;for(c=0;c<b.length;c++){var f=b[c];f=f.split(".");1===f.length?n[f[0]]=d:(!n[f[0]]||n[f[0]]instanceof Boolean||(n[f[0]]=new Boolean(n[f[0]])),n[f[0]][f[1]]=d);g.push((d?"":"no-")+f.join("-"))}}})();d(g);delete m.addTest;delete m.addAsyncTest;for(b=0;b<n._q.length;b++)n._q[b]();c.Modernizr=n}(window,document);const roles={isTeacher(){return"t"===virtualclass.gObj.uRole},isStudent(){return"s"===virtualclass.gObj.uRole},isPresenter(){return"p"===virtualclass.gObj.uRole},isEducator(){return"e"===virtualclass.gObj.uRole},hasControls(){return"t"===virtualclass.gObj.uRole||"p"===virtualclass.gObj.uRole},hasAdmin(){return"t"===virtualclass.gObj.uRole||"e"===virtualclass.gObj.uRole},hasView(){return"s"===virtualclass.gObj.uRole||"e"===virtualclass.gObj.uRole}};const ioStorage={storeCacheAllDataSend(c,b){c={user:{userid:wbUser.id},m:c.arg.msg};c.user.lname=virtualclass.gObj.allUserObj[virtualclass.gObj.uid].lname;c.user.name=virtualclass.gObj.allUserObj[virtualclass.gObj.uid].name;c.user.role=virtualclass.gObj.allUserObj[virtualclass.gObj.uid].role;c.type="broadcastToAll";virtualclass.storage.storeCacheAll(JSON.stringify(c),b)},storeCacheAllData(c,b){c=ioStorage.addUserObj(c);virtualclass.storage.storeCacheAll(JSON.stringify(c),b)},storeCacheOutData(c,b){c=
ioStorage.addUserObj(c);virtualclass.storage.storeCacheOut(JSON.stringify(c),b)},addUserObj(c){!Object.prototype.hasOwnProperty.call(c,"type")&&Object.prototype.hasOwnProperty.call(c,"user")&&(c.type="broadcastToAll","undefined"===typeof virtualclass.gObj.allUserObj[c.user.userid]&&(virtualclass.gObj.allUserObj[c.user.userid]={},virtualclass.gObj.allUserObj[c.user.userid].userid=c.user.userid,virtualclass.gObj.allUserObj[c.user.userid].lname=" ",virtualclass.gObj.allUserObj[c.user.userid].name="student",
virtualclass.gObj.allUserObj[c.user.userid].role="s"),virtualclass.gObj.allUserObj[c.user.userid].userid===c.user.userid&&(c.user.lname=virtualclass.gObj.allUserObj[c.user.userid].lname,c.user.name=virtualclass.gObj.allUserObj[c.user.userid].name,c.user.role=virtualclass.gObj.allUserObj[c.user.userid].role));return c},storeCacheInData(c,b){virtualclass.storage.storeCacheIn(JSON.stringify(c),b)}};var ioMissingPackets={executedStore:[],executedSerial:{},missRequest:[],aheadPackets:[],missRequestFlag:0,executedUserStore:[],executedUserSerial:{},missUserRequest:[],aheadUserPackets:[],missUserRequestFlag:0,validateAllVariables(c){if("undefined"===typeof this.executedSerial||null==this.executedSerial)this.executedSerial={};"undefined"===typeof this.executedSerial[c]&&(this.executedSerial[c]=-1);"undefined"===typeof this.missRequest[c]&&(this.missRequest[c]=0);"undefined"===typeof this.executedStore[c]&&
(this.executedStore[c]=[]);"undefined"===typeof this.aheadPackets[c]&&(this.aheadPackets[c]=[])},validateAllUserVariables(c){if("undefined"===typeof this.executedUserSerial||null==this.executedUserSerial)this.executedUserSerial={};"undefined"===typeof this.executedUserSerial[c]&&(this.executedUserSerial[c]=-1);"undefined"===typeof this.missUserRequest[c]&&(this.missUserRequest[c]=0);"undefined"===typeof this.executedUserStore[c]&&(this.executedUserStore[c]=[]);"undefined"===typeof this.aheadUserPackets[c]&&
(this.aheadUserPackets[c]=[])},async checkMissing(c){if(virtualclass.isPlayMode)io.onRecJson(c);else{var b=c.user.userid;this.validateAllVariables(b);if("t"===c.user.role&&Object.prototype.hasOwnProperty.call(c.m,"ping")&&Object.prototype.hasOwnProperty.call(c.m,"session")){const b=localStorage.getItem("mySession");if(null!=b&&c.m.session!==b){virtualclass.isPlayMode?virtualclass.config.setNewSession("thisismyplaymode"):(localStorage.removeItem("mySession"),await virtualclass.config.endSession(),
virtualclass.config.setNewSession(c.m.session));return}}1===c.m.missedpackets?this.fillExecutedStore(c):"undefined"!==typeof c.m.serial&&null!=c.m.serial&&(c.m.serial===this.executedSerial[b]+1||0===c.m.serial?(this.executedSerial[b]=c.m.serial,this.executedStore[b][c.m.serial]=c,ioStorage.storeCacheAllData(c,[c.user.userid,c.m.serial]),io.onRecJson(c)):c.m.serial>this.executedSerial[b]+1?this.requestMissedPackets(this.executedSerial[b]+1,c.m.serial,c,b):this.executedStore[b][c.m.serial]=c)}},userCheckMissing(c){const b=
c.user.userid;this.validateAllUserVariables(b);1===c.m.missedpackets?this.fillExecutedStore(c):"undefined"!==typeof c.m.userSerial&&null!=c.m.userSerial&&(c.m.userSerial===this.executedUserSerial[b]+1||0===c.m.userSerial?(this.executedUserSerial[b]=c.m.userSerial,io.onRecJson(c),this.executedUserStore[b][c.m.userSerial]=c,ioStorage.storeCacheInData(c,[b,c.m.userSerial])):c.m.userSerial>this.executedUserSerial[b]+1?this.userRequestMissedPackets(this.executedUserSerial[b]+1,c.m.userSerial,c,b):this.executedUserStore[b][c.m.userSerial]=
c)},requestMissedPackets(c,b,a,d){0>c&&(c=0);"use strict";0===this.missRequest[d]?(this.aheadPackets[d].unshift(a.m.serial),this.executedStore[d][a.m.serial]=a,b--,this.waitAndResetmissRequest(d),ioAdapter.sendUser({reqMissPac:1,from:c,till:b},d)):(this.aheadPackets[d].unshift(a.m.serial),this.executedStore[d][a.m.serial]=a)},userRequestMissedPackets(c,b,a,d){0>c&&(c=0);"use strict";0===this.missUserRequest[d]?(this.aheadUserPackets[d].unshift(a.m.userSerial),this.executedUserStore[d][a.m.userSerial]=
a,b--,this.userWaitAndResetmissUserRequest(d),ioAdapter.sendUser({userReqMissPac:1,from:c,till:b},d)):(this.aheadUserPackets[d].unshift(a.m.userSerial),this.executedUserStore[d][a.m.userSerial]=a)},waitAndResetmissRequest(c){ioMissingPackets.missRequest[c]=1;ioMissingPackets.missRequestFlag=1;setTimeout(()=>{ioMissingPackets.missRequest[c]=0;ioMissingPackets.missRequestFlag=0},15E3)},userWaitAndResetmissUserRequest(c){ioMissingPackets.missUserRequest[c]=1;ioMissingPackets.missUserRequestFlag=1;setTimeout(()=>
{ioMissingPackets.missUserRequest[c]=0;ioMissingPackets.missUserRequestFlag=0},15E3)},sendMissedPackets(c){this.validateAllVariables(c.user.userid);var {from:b}=c.m;0>b&&(b=0);b={missedpackets:1,data:ioAdapter.adapterMustData.slice(b,c.m.till+1)};ioAdapter.sendUser(b,c.user.userid)},userSendMissedPackets(c){var b=c.user.userid;this.validateAllUserVariables(b);let {from:a}=c.m;0>a&&(a=0);b={userMissedpackets:1,data:ioAdapter.userAdapterMustData[b].slice(a,c.m.till+1)};ioAdapter.sendUser(b,c.user.userid)},
fillExecutedStore(c){const b=c.user.userid;this.validateAllVariables(b);const a=c.m.data.length;let d;for(d=0;d<a;d++)if(null!=c.m.data[d]&&"undefined"!==typeof c.m.data[d].m.serial&&null!=c.m.data[d].m.serial){this.executedSerial[b]=c.m.data[d].m.serial;c.m.data[d].user=c.user;ioStorage.storeCacheAllData(c.m.data[d],[b,c.m.data[d].m.serial]);this.executedStore[b][c.m.data[d].m.serial]=c.m.data[d];try{io.onRecJson(c.m.data[d])}catch(f){}}for(this.aheadPackets[b]=this.aheadPackets[b].sort((b,a)=>a-
b);c=this.aheadPackets[b].pop();)if("undefined"!==typeof c&&null!=c)if("undefined"!==typeof this.executedStore[b][c])this.executedSerial[b]=c,ioStorage.storeCacheAllData(this.executedStore[b][c],[b,this.executedStore[b][c].m.serial]),io.onRecJson(this.executedStore[b][c]);else return;this.missRequest[b]=0;ioMissingPackets.missRequestFlag=0;virtualclass.vutil.initCommonSortingChat()},userFillExecutedStore(c){const b=c.user.userid;this.validateAllUserVariables(b);const a=c.m.data.length;let d;for(d=
0;d<a;d++)if(null!=c.m.data[d]&&"undefined"!==typeof c.m.data[d].m.userSerial&&null!=c.m.data[d].m.userSerial){this.executedUserSerial[b]=c.m.data[d].m.userSerial;c.m.data[d].user=c.user;c.m.data[d].userto=c.userto;ioStorage.storeCacheInData(c.m.data[d],[b,c.m.data[d].m.userSerial]);try{io.onRecJson(c.m.data[d])}catch(f){}this.executedUserStore[b][c.m.data[d].m.userSerial]=c.m.data[d]}for(this.aheadUserPackets[b]=this.aheadUserPackets[b].sort((b,a)=>a-b);c=this.aheadUserPackets[b].pop();)"undefined"!==
typeof c&&null!=c&&(this.executedUserSerial[b]=c,io.onRecJson(this.executedUserStore[b][c]));this.missUserRequest[b]=0;ioMissingPackets.missUserRequestFlag=0;virtualclass.vutil.initCommonSortingChat()}};var ioAdapter={adapterMustData:[],serial:-1,userSerial:[],userAdapterMustData:[],sendWithDelayIdentifier:{},validateAllVariables(c){if("undefined"===typeof this.userSerial||null==this.userSerial)this.userSerial=[];"undefined"===typeof this.userSerial[c]&&(this.userSerial[c]=-1);if("undefined"===typeof this.userAdapterMustData||null==this.userAdapterMustData)this.userAdapterMustData=[];"undefined"===typeof this.userAdapterMustData[c]&&(this.userAdapterMustData[c]=[])},sendWithDelayAndDrop(c,b,a,d,
f){null!=c&&null!=a&&(null==d&&(d=0),null==f&&(f=1E3),Object.prototype.hasOwnProperty.call(this.sendWithDelayIdentifier,d)&&ioAdapter.sendWithDelayIdentifier[d]&&(clearTimeout(ioAdapter.sendWithDelayIdentifier[d]),ioAdapter.sendWithDelayIdentifier[d]=0),ioAdapter.sendWithDelayIdentifier[d]=setTimeout(()=>{ioAdapter[a](c);ioAdapter.sendWithDelayIdentifier[d]=0},f))},mustSend(c){virtualclass.config.makeWebSocketReady&&(this.serial++,c.serial=this.serial,this.adapterMustData[this.serial]={type:"broadcast",
m:c},this.send(c),c.cf&&"wb"===c.cf&&virtualclass.vutil.storeWhiteboardAtInlineMemory(c.repObj))},send(c){virtualclass.config.makeWebSocketReady&&io.send(c,"broadcastToAll",null)},mustSendAll(c){virtualclass.config.makeWebSocketReady&&(this.mustSendUser(c,virtualclass.gObj.uid),this.mustSend(c))},mustSendUser(c,b){virtualclass.config.makeWebSocketReady&&(this.validateAllVariables(b),"undefined"!==typeof c.serial&&c.serial&&(c.serial=null),this.userSerial[b]++,c.userSerial=this.userSerial[b],this.userAdapterMustData[b][c.userSerial]=
{type:"broadcastToAll",m:c},this.sendUser(c,b))},sendUser(c,b){virtualclass.config.makeWebSocketReady&&io.send(c,"broadcastToAll",b)},sendPing(c){io.send(c,"ping")},sendSpeed(c){console.log("===send speed ",c);virtualclass.gObj.currentSendSpeed=c;ioAdapter.sendWithDelayAndDrop(c,null,"realSendSpeed","sendSpeed",1E3)},realSendSpeed(c){io.send(c,"speed")},sendBinary(c){io.sendBinary(c)},sendStream(c){io.sendStream(c)},setRecording(){if(!virtualclass.isPlayMode&&virtualclass.settings.info.enableRecording&&
(roles.hasControls()||virtualclass.settings.info.attendeerecording)){var c={cfun:"recording",arg:{msg:virtualclass.settings.recording.sendYesOrNo()}};io.realSend(c);io.recordingSet=!0}},setSession(c){io.realSend({cfun:"session",arg:{msg:c}})},initSetSession(c){const b=localStorage.getItem("mySession");null===b?(console.log("====> congrea session 1, from server"),localStorage.setItem("mySession",c),virtualclass.gObj.currentSession=c,io.sessionSet=!0):b!==c?(console.log("====> congrea session 1, from local storage, does not respect server session"),
this.setSession(b)):(console.log("====> congrea session 1, from local storage"),io.sessionSet=!0)},sync(c){io.send(c,"broadcastToAll",null)}};const ioPingPong={ping(c){"member_added"===c.type&&roles.hasAdmin()&&(c={ping:"ping",cf:"pong",session:virtualclass.config.sessionName()},ioAdapter.sendWithDelayAndDrop(c,null,"mustSend","pingAll",3E3))},async pong(c){c.toUser?ioAdapter.mustSendUser({ping:"pong",cf:"pongAck"},c.fromUser.userid):await virtualclass.config.verifySession(c)},pongAck(c){}};(function(c){c.congreaLanguages={};c.virtualclass=function(){const b=wbUser.virtualclassPlay?parseInt(wbUser.virtualclassPlay,10):0;let a=localStorage.getItem("studentSSstatus");a=null!=a?JSON.parse(localStorage.getItem("studentSSstatus")):{sharing:!1,mesharing:!1,shareToAll:!1};return{isPlayMode:b,apps:{wb:"Whiteboard",ss:"ScreenShare",yt:"Yts",er:"EditorRich",ec:"EditorCode",sp:"SharePresentation",poll:"Poll",vid:"Video",ds:"DocumentShare",quiz:"Quiz",mv:"MultiVideo"},appSessionEnd:"virtualclassSessionEnd",
appAudioTest:"virtualclassAudioTest",rWidgetConfig:{id:"virtualclassAppRightPanel"},wb:"",ss:"",wss:"",rw:"",poll:"",quiz:"",raiseHand:"",error:[],pdfRender:{},clearGlobalLock:"",queueCreatePrefetchLink:[],pqueueCreatePrefetchLink:[],countCreatePrefetchLink:0,gObj:{SCALE_FACTOR:1.02,nextPdf:{},uid:c.wbUser.id,uRole:c.wbUser.role,uName:c.wbUser.name,tempReplayObjs:{},commandToolsWrapperId:{},resize:!1,has_ts_capability:!(1!==wbUser.ts&&!0!==wbUser.ts),meetingMode:0,chromeExt:!1,pdfdebugg:!0,wbInitHandle:!1,
wbCount:0,prvWindowSize:!1,wIds:[0],wbRearrang:!1,currSlide:null!=localStorage.getItem("currSlide")?localStorage.getItem("currSlide"):0,currIndex:null!=localStorage.getItem("currIndex")?localStorage.getItem("currIndex"):1,uploadingFiles:[],fetchedData:!1,wbNavtime:50,studentSSstatus:a,screenRh:60,isReadyForVideo:!0,defaultApp:"Whiteboard",chatIconColors:{},prevApp:null,myworker:null,requestToScriptNode:null,readyToCommunicate:!1,tempPrefix:"dest_temp/templates",allUserObj:{},docPdfFirstTime:!1,defalutStrk:"1",
defalutFont:"25",defalutFntOptn:"1",defaultcolor:"#0000ff",sendAudioStatus:!1,audioRecWorkerReady:!1,wbTool:{},fullScreenMode:!1,rightbarFullScreenMode:!1,hideRightbar:JSON.parse(localStorage.getItem("hideRightbar")),lastmousemovetime:null,CDTimer:null,wbData:{},screenShareVersion:123},enablePreCheck:!0,async clearSession(){c.pageEnter=(new Date).getTime();"undefined"===typeof notSend&&virtualclass.vutil.beforeSend({sEnd:!0,cf:"sEnd"},null,!0);"object"===typeof virtualclass.videoUl&&"object"===typeof virtualclass.videoUl.player&&
"undefined"!==typeof virtualclass.videoUl.player.dispose&&virtualclass.videoUl.destroyPlayer();await virtualclass.config.endSession();Object.prototype.hasOwnProperty.call(virtualclass,"prevScreen")&&Object.prototype.hasOwnProperty.call(virtualclass.prevScreen,"currentStream")&&virtualclass.prevScreen.unShareScreen();virtualclass.previrtualclass=`virtualclass${virtualclass.gObj.defaultApp}`},createPrefetchLink(b){if(b){for(let a=0;a<virtualclass.pqueueCreatePrefetchLink.length;a+=1)if(virtualclass.pqueueCreatePrefetchLink[a]===
b)return;virtualclass.queueCreatePrefetchLink.push(b);virtualclass.pqueueCreatePrefetchLink.push(b)}if(0<virtualclass.queueCreatePrefetchLink.length){for(b=0;b<virtualclass.queueCreatePrefetchLink.length;b+=1)if(20>virtualclass.countCreatePrefetchLink)virtualclass.createPrefetchLinkActual(virtualclass.queueCreatePrefetchLink.shift());else break;virtualclass.delaycreatePrefetchLink&&(clearTimeout(virtualclass.delaycreatePrefetchLink),virtualclass.delaycreatePrefetchLink=0);virtualclass.delaycreatePrefetchLink=
setTimeout(()=>{document.getElementsByTagName("head")[0].appendChild(virtualclass.linkFragment);virtualclass.linkFragment=document.createDocumentFragment();virtualclass.countCreatePrefetchLink=0;virtualclass.createPrefetchLink()},2E3)}},createPrefetchLinkActual(b){virtualclass.linkFragment||(virtualclass.linkFragment=document.createDocumentFragment());const a=document.createElement("link");a.setAttribute("rel","prefetch");a.setAttribute("crossOrigin","use-credentials");a.setAttribute("href",b);virtualclass.linkFragment.appendChild(a);
virtualclass.countCreatePrefetchLink+=1},init(b,a){c.innerWidth>c.innerHeight&&(virtualclass.gObj.initHeight=c.innerHeight);b=document.getElementById("virtualclassCont");b.classList.add("loading");const {wbUser:d}=c;virtualclass.uInfo={userid:d.id,sid:d.sid,rid:d.path,authuser:d.auth_user,authpass:d.auth_pass,userobj:{userid:d.id,name:d.name,lname:d.lname,img:d.imageurl,role:null!=localStorage.getItem("uRole")?localStorage.getItem("uRole"):d.role},room:d.room};this.gObj.congCourse="undefiend"!==typeof c.congCourse?
c.congCourse:0;this.wbConfig={id:`virtualclass${virtualclass.apps.wb}`,classes:"appOptions"};this.ssConfig={id:`virtualclass${virtualclass.apps.ss}`,classes:"appOptions"};this.edConfig={id:`virtualclass${virtualclass.apps.er}`,classes:"appOptions"};this.edCodeConfig={id:`virtualclass${virtualclass.apps.ec}`,classes:"appOptions"};this.ptConfig={id:`virtualclass${virtualclass.apps.sp}`,classes:"appOptions"};this.plConfig={id:`virtualclass${virtualclass.apps.poll}`,classes:"appOptions"};this.viConfig=
{id:`virtualclass${virtualclass.apps.vid}`,classes:"appOptions"};this.dtsConfig={id:`virtualclass${virtualclass.apps.ds}`,classes:"appOptions"};this.qzConfig={id:`virtualclass${this.apps.quiz}`,classes:"appOptions"};this.mvConfig={id:`virtualclass${this.apps.mv}`,classes:"appOptions"};this.sharePt=c.sharePt;this.fineUploader=c.fineUploader;this.converter=converter;this.clear="";this.currApp=this.vutil.capitalizeFirstLetter(a);this.dashboard=dashboard;this.multiVideo=c.MultiVideo;this.vutil.isChromeExtension();
this.pageNavigation=c.pageIndexNav;this.modal=c.modal;this.zoom=c.zoomWhiteboard();this.pageIndexNav=c.pageIndexNav;"Quiz"!==this.currApp&&null!=virtualclass.gObj.CDTimer&&clearInterval(null!=virtualclass.gObj.CDTimer);this.wbWrapper=new WhiteboardWrapper;virtualclass.modernizr=Modernizr;this.system.webpInit();this.dirtyCorner=c.dirtyCorner;this.html.init(this);this.adapter=c.adapter;virtualclass.api=api;this.keyboard=new VirtualclassKeyboard;virtualclass.vutil.initOnBeforeUnload(virtualclass.system.mybrowser.name);
virtualclass.xhr=c.xhr;virtualclass.xhr.init();virtualclass.xhrn=c.xhrn;virtualclass.xhrn.init();virtualclass.xhrn.getAccess();virtualclass.vutil.isPlayMode()&&virtualclass.popup.loadingWindow();virtualclass.chat.init();virtualclass.dtCon=virtualclass.converter();virtualclass.pbar=progressBar;virtualclass.editorRich=c.editor("editorRich","virtualclassEditorRich","virtualclassEditorRichBody");virtualclass.editorCode=c.editor("editorCode","virtualclassEditorCode","virtualclassEditorCodeBody");virtualclass.poll=
c.poll();virtualclass.quiz=c.quiz();virtualclass.videoUl=c.videoUl();virtualclass.videoHost=c.videoHost;virtualclass.precheck=preCheck;virtualclass.page=page;virtualclass.userInteractivity=new UserInteractivity;virtualclass.userInteractivity.init();virtualclass.isPlayMode&&virtualclass.userInteractivity.initFirebaseOperatoin();virtualclass.rightbar=new Rightbar;this.orderList={};if(virtualclass.vutil.isSessionEnded())return!0;virtualclass.network=new Network;virtualclass.gesture=gesture;this.serverData=
serverData;this.view=c.view;this.liveStream=new LiveStream;null!=localStorage.uRole&&(virtualclass.gObj.uRole=localStorage.uRole,b.classList.add(virtualclass.vutil.getClassName(virtualclass.gObj.uRole)));this.makeAppReady({app:a,cusEvent:"byclick"});this.system.check();this.vutil.isSystemCompatible();this.pageVisible=virtualclass.vutil.pageVisible();virtualclass.user.readyLeftBar(virtualclass.gObj.uRole,a);this.media=new c.media;virtualclass.makePreCheckAvailable?virtualclass.precheck.init():(virtualclass.makeReadySocket(),
virtualclass.isPlayMode||virtualclass.gesture.initClassJoin());b.classList.remove("loading");virtualclass.gObj.precheckScrn=!1;virtualclass.gObj.meetingMode||virtualclass.videoHost.init(320,240);virtualclass.vutil.videoController();document.getElementById("precheckBtn").addEventListener("click",()=>{virtualclass.gObj.precheckScrn=!0;virtualclass.precheck.init(virtualclass.precheck)});this.appSetting=c.appSetting;this.appSetting.init();virtualclass.colorSelector=c.colorSelector;virtualclassSetting.theme.selectedColor&&
this.colorSelector.makeThemeReady();a=document.getElementById("virtualclassCont");null!=a&&a.classList.add(virtualclass.system.mybrowser.name);a=document.getElementById("fullScreenButton");null!=a&&a.addEventListener("click",virtualclass.vutil.Fullscreen);a=document.getElementById("fullScreenExitButton");null!=a&&a.addEventListener("click",virtualclass.vutil.closeFullscreen);a=document.getElementById("askFullscreen");null!=a&&a.addEventListener("click",virtualclass.vutil.Fullscreen);a=document.getElementById("askExitFullscreen");
null!=a&&a.addEventListener("click",virtualclass.vutil.closeFullscreen);a=document.getElementById("butInstall");null!=document.getElementById("installContainer")&&a.addEventListener("click",virtualclass.vutil.installPwaBtn);const f=document.getElementById("chat_div");a=document.getElementById("sidebarButton");null!=a&&a.addEventListener("click",function(){const b=document.getElementById("virtualclassApp");b.classList.contains("openRightbar")?(b.classList.remove("openRightbar"),b.classList.add("collapsedRightbar"),
f.classList.add("collapsedRightbar"),localStorage.setItem("hideRightbar",!0),virtualclass.gObj.hideRightbar=localStorage.getItem("hideRightbar"),roles.isStudent()&&ioAdapter.sendSpeed(3)):(localStorage.removeItem("hideRightbar"),localStorage.setItem("hideRightbar",!1),virtualclass.gObj.hideRightbar=localStorage.getItem("hideRightbar"),b.classList.remove("collapsedRightbar"),b.classList.add("openRightbar"),f.classList.remove("collapsedRightbar"),roles.isStudent()&&("desktop"===virtualclass.system.device?
ioAdapter.sendSpeed(1):null!=document.querySelector("#techVideo.active")&&virtualclass.vutil.sendSpeedByMobile(1),"Poll"===virtualclass.currApp&&virtualclass.poll.makeGraphResponsive()));if("ScreenShare"===virtualclass.currApp){if(roles.isStudent()&&!virtualclass.gObj.studentSSstatus.mesharing||roles.isTeacher()&&virtualclass.gObj.studentSSstatus.mesharing)virtualclass.studentScreen.doOpposite=!0,virtualclass.studentScreen.triggerFitControl(),virtualclass.ss.triggerFitToScreen()}else virtualclass.zoom.doOpposite=
!0,virtualclass.zoom.triggerFitToScreen()});a=document.getElementById("virtualclassApp");virtualclass.gObj.hideRightbar?(a.classList.remove("openRightbar"),a.classList.add("collapsedRightbar"),f.classList.add("collapsedRightbar"),ioAdapter.sendSpeed(3)):"mobTab"===virtualclass.system.device&&null==document.querySelector("#techVideo.active")&&virtualclass.vutil.sendSpeedByMobile(3);document.addEventListener("fullscreenchange",()=>{virtualclass.onfullscreenchange()},!1);document.addEventListener("mozfullscreenchange",
()=>{virtualclass.onfullscreenchange()},!1);document.addEventListener("webkitfullscreenchange",()=>{virtualclass.onfullscreenchange()},!1);document.addEventListener("msfullscreenchange",()=>{virtualclass.onfullscreenchange()},!1);virtualclass.isPlayMode?virtualclass.settings.triggerSettings():virtualclass.vutil.checkUserRole()&&virtualclass.settings.triggerSettings()},onfullscreenchange(){"virtualclassAppRightPanel"==event.target.id?virtualclass.gObj.rightbarFullScreenMode?(document.getElementById("virtualclassAppRightPanel").classList.contains("fullScreenMode")&&
document.getElementById("virtualclassAppRightPanel").classList.remove("fullScreenMode"),virtualclass.gObj.rightbarFullScreenMode=!1,virtualclass.gObj.ignoreFullScreen||document.querySelector("html").classList.contains("pwaRunning")||virtualclass.vutil.showFullScreenButton()):virtualclass.gObj.rightbarFullScreenMode=!0:virtualclass.gObj.fullScreenMode?virtualclass.vutil.showFullScreenButton():virtualclass.vutil.hideFullScreenButton();delete virtualclass.gObj.ignoreFullScreen},makeReadySocket(){virtualclass.vutil.isPlayMode()||
!virtualclass.config.makeWebSocketReady||virtualclass.gObj.initsocketws||(virtualclass.gObj.initsocketws=!0,this.initSocketConn())},initSocketConn(){this.system.webSocket&&(io.init(virtualclass.uInfo),c.userdata=virtualclass.uInfo)},html:{id:"virtualclassCont",optionsClass:"appOptions",init(b){this.virtualclass=b},leftAppBar(){if(!(0<document.getElementsByClassName("appOptions").length)){document.querySelector("#virtualclassApp #virtualclassAppLeftPanel");var b=virtualclass.getTemplate("appTools")();
virtualclass.vutil.insertAppLayout(b);Object.prototype.hasOwnProperty.call(virtualclass.gObj,"errNotScreenShare")&&virtualclass.view.disableSSUI();Object.prototype.hasOwnProperty.call(virtualclass.gObj,"errAppBar")&&virtualclass.view.disableLeftAppBar()}},createDiv(b,a,c,k,m){const d=document.createElement("a");d.href="#";const f=document.createElement("div");f.id=b;"undefined"!==typeof k&&(f.className=k);k=document.createElement("span");k.className=`icon-${a}`;d.appendChild(k);d.dataset.title=virtualclass.lang.getString(a);
d.className="tooltip";"virtualclassWhiteboardTool"===b&&(d.dataset.doc=`${"_doc_0_"}${virtualclass.gObj.wbCount}`);f.appendChild(d);"undefined"!==typeof m?(b=document.getElementById("virtualclassScreenShareTool"),c.replaceChild(f,b)):c.appendChild(f)},createElement(b,a,c){b=document.createElement(b);"undefined"!==typeof a&&(b.id=a);if("undefined"!==typeof c&&1<c.length)for(a=0;a<c.length;a++)b.className+=`${c[a]} `;return b}},dispvirtualclassLayout(b){if("undefined"!==typeof this.previous)if(this.previous.toUpperCase()!==
`virtualclass${this.currApp}`.toUpperCase()){var a=document.getElementById(virtualclass.previous);null!=a&&(a.style.display="none");"undefined"!==typeof b&&"EDITORRICH"===b.toUpperCase()&&(a=document.getElementById("virtualclassEditorCode"),null!=a&&(a.style.display="none"))}else{a=document.getElementById("virtualclassCont").getElementsByClassName("virtualclass");for(let b=0;b<a.length;b++)a[b].style.display="none"}"undefined"!==typeof b&&(b=`virtualclass${b.charAt(0).toUpperCase()+b.slice(1)}`);
b=document.getElementById(b);null!=b&&(b.style.display="block")},makeAppReady(b){roles.hasControls()&&virtualclass.vutil.triggerFinalizeTextIfAny();virtualclass.gObj.studentSSstatus.receivedScreenShareRequest&&(virtualclass.popup.closeElem(),delete virtualclass.gObj.studentSSstatus.receivedScreenShareRequest);let a;let d;b.app&&(a=b.app);if(b.cusEvent)var c=b.cusEvent;b.data&&(d=b.data);virtualclass.dashboard.close();var m=virtualclass.vutil.capitalizeFirstLetter(a);"ScreenShare"!==m&&(this.currApp=
m);"DocumentShare"!==a&&(virtualclass.gObj.docPdfFirstTime=!1);roles.hasControls()&&Object.prototype.hasOwnProperty.call(virtualclass,"previrtualclass")&&(a!==virtualclass.apps.ss||virtualclass.gObj.studentSSstatus.mesharing&&"ScreenShare"===virtualclass.apps.ss)&&virtualclass.vutil.makeActiveApp(`virtualclass${a}`,virtualclass.previrtualclass);"undefined"!==typeof this.previous&&("virtualclassEditorRich"===this.previous?(m=this.previous.split("virtualclass")[1],this.user.control.toggleDisplayEditorController(m,
"none")):"virtualclassSharePresentation"===virtualclass.previous?virtualclass.sharePt.remvovePLayClass():"virtualclassVideo"===virtualclass.previous&&(m=document.querySelector("#listvideo .playing"),null!=m&&m.classList.remove("playing"),virtualclass.videoUl.videoUrl="",virtualclass.liveStream.mediaRecorder&&(m=document.getElementById("startLiveStream"),null!=m&&(m.dataset.sharinglivestream="0"),virtualclass.liveStream.stop())));if(a!==virtualclass.apps.ss){this.dispvirtualclassLayout(a);m=document.getElementById("virtualclassCont");
virtualclass.vutil.setCurrApp(m,this.currApp);const b=document.querySelector("#virtualclassApp");null!==b&&("DocumentShare"===this.currApp||"SharePresentation"===this.currApp||"Video"===this.currApp?virtualclass.vutil.setCurrApp(b,m.dataset.currapp):b.dataset.currapp="")}"undefined"!==typeof this.prevScreen&&Object.prototype.hasOwnProperty.call(this.prevScreen,"currentStream")&&this.prevScreen.unShareScreen();if("SharePresentation"===a)`virtualclass${a}`!==virtualclass.previous&&this.appInitiator[a].call(virtualclass,
b);else if("DocumentShare"===a)this.appInitiator[a].call(virtualclass,b),roles.hasControls()?(virtualclass.serverData.syncComplete?virtualclass.vutil.triggerDashboard(a,"hidepopup"):virtualclass.vutil.triggerDashboard(a),virtualclass.dts.noteExist()&&virtualclass.zoom.normalRender()):virtualclass.dts.noteExist()||virtualclass.vutil.hidePageNumber();else if("Whiteboard"===a)"object"!==typeof this.orderList[a]&&(this.orderList[a]=new OrderedList),this.handleWhiteboardReady(a,c,d),"Whiteboard"===virtualclass.currApp&&
(virtualclass.zoom.normalRender(),virtualclass.zoom.fitToElementTooltip("fitToScreen"));else{var n;c=Array.prototype.slice.call(arguments)[2];this.appInitiator[a].call(virtualclass,b);c&&c.init&&c.init.videoUrl&&c.fromReload&&(n=!0);roles.hasControls()&&"Video"===a&&(`virtualclass${a}`!==virtualclass.previous&&(c=document.querySelector("#dashboardnav button"),null!=c&&(c.setAttribute("data-currapp","Video"),c.classList.contains("clicked")&&c.classList.remove("clicked"))),virtualclass.vutil.triggerDashboard(a,
n))}this.previrtualclass=this.previous;"Video"!==a&&Object.prototype.hasOwnProperty.call(virtualclass,"videoUl")&&Object.prototype.hasOwnProperty.call(virtualclass.videoUl,"player")&&virtualclass.videoUl.destroyPlayer();roles.hasControls()&&(n=Array.prototype.slice.call(arguments)[2],"ScreenShare"===a||"SharePresentation"!==virtualclass.currApp&&"Video"!==virtualclass.currApp?"DocumentShare"!==virtualclass.currApp&&virtualclass.vutil.removeDashboardNav():virtualclass.dashboard.initDashboardNav(n))},
handleWhiteboardReady(b,a,c){this.appInitiator.Whiteboard.call(virtualclass,{app:b,cusEvent:a,data:void 0!==c?c:"_doc_0_0",container:"virtualclassWhiteboard"})},whitboardWrapper(b){const a=document.createElement("div");a.className="whiteboard";a.dataset.wid=b;a.id=`cont${a.dataset.wid}`;b=b.split("_");b=document.querySelector(`.note[data-slide='${`${b[2]}_${b[3]}`}']`);null!=b&&b.insertBefore(a,b.firstChild)},appInitiator:{Whiteboard(b){let a,d,c,m;({app:a,cusEvent:d,position:m,...b}=b);b.data&&(c=
b.data);virtualclass.gObj.currWb=c;"object"===typeof this.orderList[virtualclass.currApp]&&-1>=this.orderList[virtualclass.currApp].ol.order.indexOf(virtualclass.gObj.currWb)&&"DocumentShare"!==virtualclass.currApp&&10>=virtualclass.gObj.currWb.length&&(void 0!=m?this.orderList[virtualclass.currApp].insert(virtualclass.gObj.currWb,null,m):this.orderList[virtualclass.currApp].insert(virtualclass.gObj.currWb,null));"Whiteboard"===virtualclass.currApp&&(virtualclass.gObj.currentWbSlide=virtualclass.gObj.currWb);
Object.prototype.hasOwnProperty.call(virtualclass.gObj,"getDocumentTimeout")&&clearTimeout(virtualclass.gObj.getDocumentTimeout);virtualclass.isPlayMode?virtualclass.gObj.getDocumentTimeout=setTimeout(()=>{"DocumentShare"===a&&this.whitboardWrapper(c);this.appInitiator.whiteboardActual.call(this,a,d,c);virtualclass.gObj.getDocumentTimer=!1},100):null==virtualclass.gObj.getDocumentTimer||!1===virtualclass.gObj.getDocumentTimer?(virtualclass.gObj.getDocumentTimer=!0,"DocumentShare"===a&&this.whitboardWrapper(c),
this.appInitiator.whiteboardActual.call(this,a,d,c),virtualclass.gObj.getDocumentTimeout=setTimeout(()=>{virtualclass.gObj.getDocumentTimer=!1},1E3)):virtualclass.gObj.getDocumentTimeout=setTimeout(()=>{"DocumentShare"===a&&this.whitboardWrapper(c);this.appInitiator.whiteboardActual.call(this,a,d,c);virtualclass.gObj.getDocumentTimer=!1},300);this.previous=this.wbConfig.id},whiteboardActual(b,a,g){virtualclass.gObj.readyToCreate=!0;let d;d="Whiteboard"===b?document.querySelector("#virtualclassWhiteboard .whiteboardContainer"):
document.getElementById(`cont${g}`);if(null!=d){"object"===typeof this.ss&&(this.ss.prevStream=!1);roles.hasControls()&&"undefined"!==typeof this.previous&&"undefined"!==typeof a&&"byclick"===a&&roles.hasControls()&&"Whiteboard"===b&&virtualclass.vutil.beforeSend({dispWhiteboard:!0,cf:"dispWhiteboard",d:g});virtualclass.gObj.currWb=g;"object"!==typeof this.pdfRender[g]&&(this.pdfRender[g]=c.pdfRender());if("undefined"!==typeof g)if("object"!==typeof this.wb[g])if("object"!==typeof this.wb&&(this.wb=
{}),virtualclass.gObj.commandToolsWrapperId[g]=`commandToolsWrapper${g}`,this.wb[g]={},virtualclass.gObj.tempReplayObjs[g]=[],this.wb[g]=new Whiteboard(this.wbConfig,g),"Whiteboard"===b&&roles.hasControls()&&!virtualclass.gObj.wbInitHandle&&(virtualclass.wbCommon.initNavHandler(),virtualclass.gObj.wbInitHandle=!0),null!==d){if(null===document.querySelector(`vcanvas${g}`)){this.wbWrapper.init(g,b);var f=document.querySelector(`#canvas${g}`)}virtualclass.wb[g].init(g);"DocumentShare"===b?({currNote:a}=
virtualclass.dts.docs.note,virtualclass.pdfRender[g].init(f,a)):virtualclass.pdfRender[g].init(f)}else alert("whiteboard container is null");else f=`commandToolsWrapper${g}`,null==document.getElementById(`commandToolsWrapper${g}`)&&roles.hasControls()&&virtualclass.wb[g].attachToolFunction(f,!0,g);else alert("id is undefined");virtualclass.zoom.init();roles.hasControls()?virtualclass.vutil.attachWhiteboardPopupHandler(g):roles.isStudent()&&"Whiteboard"===b&&virtualclass.wbCommon.setCurrSlideNumber(g);
"Whiteboard"===b&&("undefined"===typeof virtualclass.wbCommon.indexNav&&(virtualclass.wbCommon.indexNav=new pageIndexNav("WB")),virtualclass.gObj.wbRearrang||(b=this.orderList.Whiteboard.ol.order,null!==b&&0<b.length&&(virtualclass.wbCommon.readyElements(b),virtualclass.gObj.wbRearrang=!0)),virtualclass.wbCommon.initNav(virtualclass.orderList.Whiteboard.ol.order),roles.hasControls()&&(virtualclass.gObj.wbRearrang&&virtualclass.wbCommon.indexNav.addActiveNavigation(g),virtualclass.wbCommon.identifyFirstNote(g),
virtualclass.wbCommon.identifyLastNote(g)),virtualclass.wbCommon.indexNav.updateNavigation());"Whiteboard"===virtualclass.currApp&&virtualclass.userInteractivity.makeReadyContext()}},ScreenShare(b){b=b.app;"object"!==typeof this.ss&&(this.ss=new c.screenShare(virtualclass.ssConfig));this.ss.init({type:"ss",app:b})},Yts(b,a,c){"undefined"!==typeof c&&null!=c?virtualclass.yts.init(c):null==document.querySelector("iframe#player")&&virtualclass.yts.init();this.previous=virtualclass.ytsConfig.id},EditorRich(b){this.appInitiator.editor.call(virtualclass,
b)},EditorCode(b){this.appInitiator.editor.call(virtualclass,b)},SharePresentation(b){let a,d;b.app&&(a=b.app);b.cusEvent&&(d=b.cusEvent);"object"===typeof this.ss&&(this.ss.prevStream=!1);this.sharePt=new c.sharePt;this.sharePt.init(a,d);this.previous=virtualclass.ptConfig.id;virtualclass.sharePt.attachMessageEvent("message",virtualclass.sharePt.pptMessageEventHandler)},Poll(){this.userListEnable();virtualclass.poll.init()},Quiz(){this.userListEnable();virtualclass.quiz.init()},Video(b,a,c){"undefined"!==
typeof c&&null!=c?"undefined"===typeof c.type?virtualclass.videoUl.init(c):virtualclass.videoUl.init():virtualclass.videoUl.init()},editor(b){b=b.app;this.user.control.toggleDisplayEditorController(b.substring(b.indexOf("virtualclass"),b.length),"block");var a=[];b===virtualclass.apps.er?(virtualclass.editorRich.init(0,a,"",""),this.previous=virtualclass.edConfig.id):(virtualclass.editorCode.init(0,a,"",""),this.previous=virtualclass.edCodeConfig.id);a=virtualclass.editorRich?virtualclass.editorRich.editorStatus:
!1;if(roles.isStudent()){const d=virtualclass.vutil.smallizeFirstLetter(b);a?this[d].cm.setOption("readOnly",!1):this[d].cm.setOption("readOnly","nocursor");this.user.control.toggleDisplayWriteModeMsgBox(b,a);virtualclass.vutil.setReadModeWhenTeacherIsDisConn(d)}},makeReadyDocumentShare(){if(Object.prototype.hasOwnProperty.call(virtualclass.dts.docs,"currDoc")){roles.hasControls()&&ioAdapter.mustSend({dts:{init:"studentlayout"},cf:"dts"});const b=virtualclass.dts.docs.currNote;"undefined"!==typeof b&&
virtualclass.vutil.updateCurrentDoc(b)}virtualclass.previous=virtualclass.dtsConfig.id},DocumentShare(b){let a;b.data&&(a=b.data);Object.prototype.hasOwnProperty.call(virtualclass,"dts")&&null!=virtualclass.dts?(virtualclass.dts.indexNav.init(),null!=a&&(a.slideTo?(b=document.getElementById(a.slideTo),virtualclass.dts.docs.note.getScreen(b)):!a.init||0===virtualclass.dts.docs.currNote||virtualclass.dts.pdfRender&&"object"===typeof virtualclass.dts.pdfRender[`_doc_${virtualclass.dts.docs.currNote}_${virtualclass.dts.docs.currNote}`]||
(b=document.getElementById(`note${virtualclass.dts.docs.currNote}`),null!=b&&virtualclass.dts.docs.note.getScreen(b)))):virtualclass.dts=c.documentShare();"undefined"===typeof virtualclass.dts.indexNav&&(virtualclass.dts.indexNav=new virtualclass.pageIndexNav("documentShare"));Object.prototype.hasOwnProperty.call(virtualclass.gObj,"docs")&&(virtualclass.appInitiator.makeReadyDocumentShare(),virtualclass.dashboard.initDashboardNav(),virtualclass.serverData.syncComplete&&!virtualclass.dts.noteExist()&&
null!=document.querySelector("#dashboardnav button")&&virtualclass.dashboard.open(),null!=virtualclass.gObj.currWb&&"undefined"!==typeof virtualclass.pdfRender[virtualclass.gObj.currWb]&&"DocumentShare"===virtualclass.currApp&&0<virtualclass.orderList.DocumentShare.ol.order.length&&(roles.hasControls()?(virtualclass.dts.indexNav.createIndex(),virtualclass.userInteractivity.makeReadyContext()):virtualclass.dts.indexNav.studentDocNavigation(virtualclass.dts.docs.currNote)));(b=document.querySelector("#virtualclassAppLeftPanel .zoomControler .reloadNote span"))&&
b.setAttribute("data-title",virtualclass.lang.getString("reloadDoc"))},MultiVideo(){const b=this;Object.prototype.hasOwnProperty.call(b.multiVideo,"initDone")?b.multiVideo._init():setTimeout(()=>{b.appInitiator.MultiVideo.apply(virtualclass)},2E3);this.previous=virtualclass.mvConfig.id}},attachFunction(){let b;const a=document.getElementsByClassName("appOptions");for(let d=0;d<a.length;d++){const c=a[d].getElementsByTagName("a")[0];"virtualclassEditorCodeTool"!==a[d].id&&(b=this,c.onclick=function(){b.initlizer(this)})}},
initlizer(b){b=b.parentNode.id.split("virtualclass")[1];if("SessionEndTool"===b)virtualclass.popup.confirmInput(virtualclass.lang.getString("startnewsession"),b=>{b&&(virtualclass.gObj.endSession=!0,localStorage.clear(),(new Promise(b=>{virtualclass.gObj.sessionEndResolve=b;virtualclass.clearSession()})).then(()=>{delete virtualclass.gObj.sessionEndResolve;virtualclass.popup.sesseionEndWindow()},b=>{}))});else if(b=b.substring(0,b.indexOf("Tool")),this.PrvAndCurrIsWss(this.previous,b))alert(virtualclass.lang.getString("screensharealready"));
else{"DocumentShare"===virtualclass.currApp&&(virtualclass.gObj.screenRh=160);const a={app:b,cusEvent:"byclick"};if("Whiteboard"===b)a.data=virtualclass.gObj.currentWbSlide;else if("DocumentShare"===b){const b=document.querySelector("#screen-docs .note.current");null!==b&&"object"!==typeof virtualclass.pdfRender[`_doc_${b.dataset.slide}_${b.dataset.slide}`]&&(a.data={slideTo:b.id})}this.makeAppReady(a);setTimeout(()=>{virtualclass.gObj.screenRh=60},1500)}"ScreenShare"!==b&&virtualclass.vutil.removeClass("audioWidget",
"fixed")},PrvAndCurrIsWss(b,a){return!("virtualclassWholeScreenShare"!==b||a!==virtualclass.apps.yt)},setPrvUser(){localStorage.setItem("prvUser",JSON.stringify({id:wbUser.id,room:wbUser.room,role:wbUser.role,settings:virtualclassSetting.settings}))},registerPartial(){const b={whiteboardPath},a="precheck rightBarHeader teacherVideo audioWidget appTools popupCont appToolsMeeting appSettingDetail joinclass".split(" "),c={hasControl:roles.hasControls()};let k;for(let d=0;d<a.length;d++)k=null,"precheck"===
a[d]||"popupCont"===a[d]?k=b:"audioWidget"===a[d]?(k=virtualclassSetting,k.isControl=roles.hasControls(),k.isMettingMode=virtualclass.gObj.meetingMode&&roles.isStudent()):"teacherVideo"===a[d]||"appTools"===a[d]||"appSettingDetail"===a[d]?k=c:"rightBarHeader"===a[d]&&(k={std:roles.isStudent(),isPlayMode:virtualclass.isPlayMode}),this.makeReadyTemplate(a[d],k);Handlebars.registerPartial({docNotesMain:this.getTemplate("notesMain","documentSharing"),whiteboardToolbar:this.getTemplate("toolbar","whiteboard"),
rightBar:this.getTemplate("rightBar"),recordingControl:this.getTemplate("recordingControl"),leftBar:this.getTemplate("leftBar"),footerBar:this.getTemplate("footerBar"),mobileLandscapeWarn:this.getTemplate("mobileLandscapeWarn"),main:this.getTemplate("main"),whiteboard:this.getTemplate("main","whiteboard"),dashboardCont:this.getTemplate("dashboardCont"),multiVideo:this.getTemplate("multiVideo")})},registerHelper(){Handlebars.registerHelper("getString",b=>virtualclass.lang.getString(b));Handlebars.registerHelper("debug",
function(b){});Handlebars.registerHelper("getVideoType",b=>virtualclass.gObj.meetingMode?"multiVideo":"teacherVideo")},createMainContainer(){const b=document.querySelector(`#${virtualclass.html.id}`);this.registerHelper();this.registerPartial();var a=this.getTemplate("main");const c={isPlay:virtualclass.isPlayMode,hasControls:roles.hasControls(),meetingMode:virtualclass.gObj.meetingMode};a=a(c);b.insertAdjacentHTML("afterbegin",a)},makeReadyTemplate(b,a){Handlebars.registerPartial(b,(0,JST[`${virtualclass.gObj.tempPrefix}/${b}.hbs`])(a))},
getTemplate(b,a){return"undefined"===typeof a?JST[`${virtualclass.gObj.tempPrefix}/${b}.hbs`]:JST[`${virtualclass.gObj.tempPrefix}/${a}/${b}.hbs`]},isMiniFileIncluded(b){b=new RegExp(`${b}.js?=\*([0-9]*)`);const a=document.getElementsByTagName("script");for(let d=0;d<a.length;d++)if(b.test(a[d].src))return!0;return!1},stickybarWidth(){const b=document.querySelector("#virtualclassApp #virtualclassAppLeftPanel").offsetWidth+"px";document.querySelector("#stickybar").style.width=b},removeSharingClass(){const b=
document.querySelector("#virtualclassCont");b&&(b.classList.remove("studentScreenSharing"),document.querySelector("#chat_div").classList.remove("studentScreenSharing"))},clearAllChat(){localStorage.removeItem(virtualclass.gObj.uid);localStorage.clear("chatroom");null!=virtualclass.chat&&(virtualclass.chat.idList.length=0);clearAllChatBox();const b=document.getElementById("chatWidget").getElementsByClassName("ui-chatbox-msg");if(0<b.length)for(;null!=b[0];)b[0].parentNode.removeChild(b[0])},userListEnable(){const b=
document.querySelector("#user_list");b&&b.click()}}}})(window);class Whiteboard{constructor(){this.selectedTool=this.canvas=null;this.rectangleObj=new WhiteboardRectangle("rectangle");this.activeAllObj=new WhiteboardActiveAll;this.freeDrawingObj=new WhiteboardFreeDrawing("freeDrawing");this.lineObj=new WhiteboardLine("line");this.triangleObj=new WhiteboardTriangle("triangle");this.circleObj=new WhiteboardCircle("circle");this.textObj=new WhiteboardText("text");this.gObj={}}init(c){this.wbId=c;delete virtualclass.wbWrapper.gObj.textSelected;this.textObj.textEditing=
!1;this.attachToolbarHandler(c);virtualclass.wbWrapper.util.createFabricNewInstance(c);virtualclass.keyboard.init(c)}attachToolbarHandler(c){c=document.querySelectorAll(`#commandToolsWrapper${c} .tool a`);for(let b=0;b<c.length;b+=1)c[b].addEventListener("click",this.toolbarHandler.bind(this))}attachMouseMovementHandlers(){this.canvas.on("selection:created",this.handlerSelection.bind(this));this.canvas.on("selection:cleared",this.handlerSelection.bind(this));this.canvas.on("mouse:down",this.handlerMouseDown.bind(this));
this.canvas.on("mouse:move",this.handlerMouseMove.bind(this));this.canvas.on("mouse:up",this.handlerMouseUp.bind(this));this.canvas.on("text:editing:entered",this.handlePlaceHolder.bind(this));this.canvas.on("text:editing:exited",c=>{setTimeout(()=>{this.textObj.finalizeText(c)},0)})}handlePlaceHolder(c){"i-text"===c.target.type&&c.target.text===this.textObj.placeHolder&&(c.target.text="",c.target.hiddenTextarea.value="",this.canvas.renderAll())}handlerSelection(c){c.selected&&"activeAll"===this.selectedTool?
this.activeAllObj.activeDown=!0:c.selected&&"i-text"===c.selected[0].type?virtualclass.wbWrapper.gObj.textSelected=c.selected[0]:c.deselected&&(this.activeAllObj.activeDown=!1,virtualclass.wbWrapper.gObj.textSelected=!1)}triggerGetPointer(c){return this.canvas.getPointer(c)}handlerMouseDown(c){if(c.e.isTrusted&&this.selectedTool&&this[`${this.selectedTool}Obj`]){this.mousedown=!0;const b=this.triggerGetPointer(c.e);this[`${this.selectedTool}Obj`].mouseDown(b,this,c)}}handlerMouseMove(c){if(c.e.isTrusted){var b=
this.triggerGetPointer(c.e);this.mousedown&&this.selectedTool&&this[`${this.selectedTool}Obj`].mouseMove(b,this,c);virtualclass.wbWrapper.cursor.handle(c.e)}}handlerMouseUp(c){if(c.e.isTrusted){var b=this.triggerGetPointer(c.e);this.mousedown&&this.selectedTool&&this[`${this.selectedTool}Obj`].mouseUp(b,this,c);this.mousedown=!1}}toolbarHandler(c){({parentNode:c}=c.currentTarget);this.innerToolbarHandler(c.dataset.tool,virtualclass.gObj.currWb);if(0<virtualclass.wb[virtualclass.gObj.currWb].canvas.getActiveObjects().length){virtualclass.wb[virtualclass.gObj.currWb].canvas.discardActiveObject();
virtualclass.wb[virtualclass.gObj.currWb].canvas.renderAll();const b=virtualclass.wbWrapper.protocol.encode("ds",virtualclass.gObj.currWb);WhiteboardMessage.send(b)}(virtualclass.wbWrapper.shapes.includes(c.dataset.tool)||"activeAll"===c.dataset.tool)&&virtualclass.wbWrapper.util.makeActiveTool(c.id,virtualclass.gObj.currWb)}selectTool(c){-1<virtualclass.wbWrapper.mouseTool.indexOf(c)&&(this.selectedTool=c);"stroke"!==c&&"font"!==c&&"activeAll"!==c&&"color"!==c&&("text"===c?WhiteboardUtility.fontSizeSelector():
"clearAll"!==c&&WhiteboardUtility.strokeSizeSelector())}innerToolbarHandler(c,b){WhiteboardUtility.closeTray();this.selectTool(c);if("rectangle"!==c&&"line"!==c&&"circle"!==c&&"triangle"!==c&&"text"!==c)this[c](b);else"text"===c?(this.activeAllObj.enable(b,"i-text"),this.activeAllObj.disableBut(b,"i-text"),delete virtualclass.wbWrapper.gObj.textSelected,this.textObj.textEditing=!1):this.activeAllObj.disable(b);"activeAll"===c?this.activeAllObj.makeTextUnEditable(b):"text"===c&&this.activeAllObj.makeTextEditable(b)}shapes(){const c=
document.querySelector(`#shapes${this.wbId}`);virtualclass.wbWrapper.util.handleTrayDisplay(c)}stroke(){const c=document.querySelector(`#commandToolsWrapper${this.wbId} .strkSizeList`);virtualclass.wbWrapper.util.handleTrayDisplay(c);virtualclass.wbWrapper.util.initActiveElement(`#t_strk${this.wbId} ul`,{type:"strk",prop:"stroke"})}font(){const c=document.querySelector(`#commandToolsWrapper${this.wbId} .fontSizeList`);virtualclass.wbWrapper.util.handleTrayDisplay(c);virtualclass.wbWrapper.util.initActiveElement(`#t_font${this.wbId} ul`,
{type:"font",prop:"font"})}color(){const c=document.querySelector(`#commandToolsWrapper${this.wbId} .table`);virtualclass.wbWrapper.util.handleTrayDisplay(c);virtualclass.wbWrapper.util.initActiveElement(`#colorList${this.wbId}`,{type:"color",prop:"color"})}freeDrawing(c){this.activeAllObj.disable(c)}activeAll(c){this.activeAllObj.enable(c);console.log("====> I am being active here ")}clearAll(c){const b=virtualclass.lang.getString("clearAllWarnMessageW");virtualclass.popup.confirmInput(b,b=>{b&&
(this.clear(),b=virtualclass.wbWrapper.protocol.encode("cr",c),WhiteboardMessage.send(b))})}clear(){this.canvas.clear();this.replayObjs=[];this.canvas._objects=[];delete virtualclass.wbWrapper.gObj.textSelected;this.textObj.textEditing=!1}};class WhiteboardUtility{static storeAtMemory(c,b,a){virtualclass.wb[b].replayObjs||(virtualclass.wb[b].replayObjs=[]);let d=c;a&&(d=WhiteboardProtocol.generateFreeDrawingData(a));if(Array.isArray(c))for(c=0;c<d.length;c+=1)virtualclass.wb[b].replayObjs.push(d[c]);else virtualclass.wb[b].replayObjs.push(c)}createFabricNewInstance(c,b){virtualclass.wb[c].canvas&&virtualclass.wb[c].canvas.upperCanvasEl&&virtualclass.wb[c].canvas.dispose();delete virtualclass.wb[c].canvas;const a={selection:!1};b&&(a.width=
b.width,a.height=b.height);virtualclass.wb[c].canvas=new fabric.Canvas(`canvas${c}`,a);roles.hasControls()&&(virtualclass.wb[c].attachMouseMovementHandlers(),console.log("=====> attach handlers with whiteboard id ",c));this.constructor.createCanvasPdfInstance(c,virtualclass.wb[c].canvas.upperCanvasEl)}static createCanvasPdfInstance(c,b){if(null==document.querySelector(`#canvas${c}_pdf`)){const a=document.createElement("canvas");a.id=`canvas${c}_pdf`;a.className="pdfs";a.width=b.width;a.height=b.height;
b.parentNode.parentNode.insertBefore(a,b.parentNode)}}static fitWhiteboardAtScale(c){virtualclass.wb[c].canvas.setZoom(virtualclass.zoom.canvasScale);"object"===typeof virtualclass.wb[c]&&(delete virtualclass.wb[c].myPencil,virtualclass.wb[c].replayObjs&&0<virtualclass.wb[c].replayObjs.length&&virtualclass.wbWrapper.replay.replayFromLocalStroage(virtualclass.wb[c].replayObjs,c))}static readyMouseEvent(c,b){return new MouseEvent(c,{clientX:b.x,clientY:b.y,buttons:1,bubbles:!0,which:1,composed:!0})}closeShapeContainer(c){this.selectedTool=
null;if(c=c||document.querySelector(`#shapes${virtualclass.gObj.currWb}`))c.classList.remove("open"),c.classList.add("close")}static closeTray(){const c=document.querySelector(`#commandToolsWrapper${virtualclass.gObj.currWb} .openTray`);c&&c.classList.remove("openTray")}static openTray(c){c&&c.classList.add("openTray")}handleTrayDisplay(c){c.classList.contains("openTray")?(this.selectedTool=null,this.constructor.closeTray()):this.constructor.openTray(c)}openShapeContainer(c){this.selectedTool=null;
if(c=c||document.querySelector(`#shapes${virtualclass.gObj.currWb}`))c.classList.remove("close"),c.classList.add("open")}initActiveElement(c,b){c=document.querySelector(c);"undefined"===typeof virtualclass.gObj.wbTool[virtualclass.gObj.currWb]&&(virtualclass.gObj.wbTool[virtualclass.gObj.currWb]={});"undefined"===typeof virtualclass.gObj.wbTool[virtualclass.gObj.currWb][b.type]&&(c.addEventListener("click",this.activeElementHandler.bind(this,b)),virtualclass.gObj.wbTool[virtualclass.gObj.currWb][b.type]=
!0)}activeElementHandler(c,b){this.activeElement(b,c)}activeElement(c,b){const a=virtualclass.gObj.currWb;var d=document.querySelector(`#t_${b.type}${a} .selected`);null!=d&&d.classList.remove("selected");d=c.target.dataset[b.prop];null!=d&&(c.target.classList.add("selected"),this.constructor.updateToolStyle(b.type,d,a),"color"===b.type&&(document.querySelector(`#t_color${a} .disActiveColor`).style.backgroundColor=virtualclass.wb[a].toolColor),c=virtualclass.wbWrapper.protocol.encode("ot",{type:b.type,
value:d}),WhiteboardMessage.send(c))}makeActiveTool(c,b){const a=document.getElementById(c);if(a){var d=b||virtualclass.gObj.currWb,f=document.querySelectorAll(`#commandToolsWrapper${d} .tool.active`);for(let b=0;b<f.length;b+=1)f[b].classList.remove("active");roles.hasControls()&&(f=document.getElementById(c).dataset.tool,document.querySelector(`#tool_wrapper${b}`).dataset.currtool=f);this.constructor.themeColorShapes(c,d);a.classList.add("active")}}handleActivateTool(c){var b=localStorage.getItem("activeTool");
null!==b&&-1<b.indexOf(c)?(this.makeActiveTool(b,c),b=b.split("_")[1],virtualclass.wb[c].selectedTool=b,"activeAll"!==virtualclass.wb[c].selectedTool&&virtualclass.wb[c].activeAllObj.disable(c)):virtualclass.wb[c].selectedTool&&(b=`t_${virtualclass.wb[c].selectedTool}${c}`,this.makeActiveTool(b,c),"activeAll"!==virtualclass.wb[c].selectedTool&&virtualclass.wb[c].activeAllObj.disable(c));virtualclass.wb[c].selectedTool&&"text"===virtualclass.wb[c].selectedTool?WhiteboardUtility.fontSizeSelector(c):
-1<virtualclass.wbWrapper.shapes.indexOf(virtualclass.wb[c].selectedTool)&&WhiteboardUtility.strokeSizeSelector(c);virtualclass.wb[c].toolColor&&(console.log("====> apply color background"),document.querySelector(`#t_color${c} .disActiveColor`).style.backgroundColor=virtualclass.wb[c].toolColor)}static updateToolStyle(c,b,a){a||(a=virtualclass.gObj.currWb);"color"===c?virtualclass.wb[a].toolColor=b:"strk"===c?virtualclass.wb[a].strokeSize=b:"font"===c&&(virtualclass.wb[a].fontSize=b)}static strokeSizeSelector(c){c=
c||virtualclass.gObj.currWb;var b=document.querySelector(`#t_font${c}`);null!=b&&(b.classList.remove("show"),b.classList.add("hide"));b=document.querySelector(`#t_strk${c}`);null!=b&&(b.classList.remove("hide"),b.classList.add("show"));WhiteboardUtility.fontAndStrokeSizeUi("strk",c,"stroke","li",virtualclass.wb[c].strokeSize)}static fontAndStrokeSizeUi(c,b,a,d,f){const g=document.querySelector(`#t_${c}${b} ${d}.selected`);null!=g&&g.classList.remove("selected");c=document.querySelector(`#t_${c}${b} ${d}[data-${a}='${f}']`);
null!=c&&c.classList.add("selected")}static fontSizeSelector(c){c=c||virtualclass.gObj.currWb;var b=document.querySelector(`#t_strk${c}`);null!=b&&(b.classList.remove("show"),b.classList.add("hide"));b=document.querySelector(`#t_font${c}`);null!=b&&(b.classList.remove("hide"),b.classList.add("show"));WhiteboardUtility.fontAndStrokeSizeUi("font",c,"font","span",virtualclass.wb[c].fontSize)}static themeColorShapes(c,b){c=c.split(/_doc_*/)[0];b=document.querySelector(`#tool_wrapper${b}.shapesToolbox`);
"t_line"===c||"t_circle"===c||"t_rectangle"===c||"t_triangle"===c?b.classList.add("active"):b.classList.remove("active")}static deleteActiveObject(c,b){b=virtualclass.wb[b];const a=b.canvas.getActiveObject();b.canvas.discardActiveObject();b.canvas.remove(a);c&&(c=virtualclass.wbWrapper.protocol.encode("da",virtualclass.gObj.currWb),WhiteboardMessage.send(c))}};class WhiteboardActiveAll{generateData(c,b,a){c=b.canvas.getPointer(c,!0);return virtualclass.wbWrapper.protocol.encode("ac",{event:a,x:c.x,y:c.y})}enable(c,b){c=b?virtualclass.wb[c].canvas.getObjects(b):virtualclass.wb[c].canvas.getObjects();for(b=0;b<c.length;b+=1)console.log("====> active all"),c[b].set("selectable",!0)}makeTextUnEditable(c){c=virtualclass.wb[c].canvas.getObjects("i-text");for(let b=0;b<c.length;b+=1)console.log("====> active all"),c[b].set("editable",!1)}makeTextEditable(c){c=
virtualclass.wb[c].canvas.getObjects("i-text");for(let b=0;b<c.length;b+=1)c[b].set("editable",!0)}disable(c,b){c=b?virtualclass.wb[c].canvas.getObjects(b):virtualclass.wb[c].canvas.getObjects();for(b=0;b<c.length;b+=1)c[b].set("selectable",!1)}disableBut(c,b){c=virtualclass.wb[c].canvas.getObjects();for(let a=0;a<c.length;a+=1)c[a].type!==b&&c[a].set("selectable",!1)}disableLastElement(c){c=virtualclass.wb[c].canvas.getObjects();c[c.length-1].set("selectable",!1)}mouseDown(c,b,a){c=b.canvas.getPointer(a,
!0);console.log("==== convert actives all mouse down",c.x,c.y);a.e.isTrusted&&(this.down=!0,this.activeDown&&(virtualclass.wbWrapper.gObj.lastSentDataTime=(new Date).getTime()),b=this.generateData(a,b,"d"),virtualclass.wbWrapper.gObj.previousData=b,WhiteboardMessage.send(b))}mouseMove(c,b,a){a.e.isTrusted&&this.activeDown&&this.down&&(c=this.generateData(a,b,"m"),virtualclass.wbWrapper.msg.optimizeToSend(c,2E3))}mouseUp(c,b,a){c=b.canvas.getPointer(a,!0);console.log("==== actives all mouse up",c.x,
c.y);a.e.isTrusted&&this.activeDown&&this.down&&(this.down=!1,WhiteboardMessage.send(virtualclass.wbWrapper.gObj.previousData),b=this.generateData(a,b,"u"),WhiteboardMessage.send(b))}};class WhiteboardReplay{init(c){this.objs=virtualclass.wb[c].vcanMainReplayObjs;this.objNo=0}renderObj(c){const b=virtualclass.wbWrapper.protocol.decode(this.objs[this.objNo],c);switch(b.action){case "sp":virtualclass.wb[c].selectedTool=b.tool;var a=b.event;var d=`${b.shape}Obj`;virtualclass.wb[c][d][a](b.actual,virtualclass.wb[c]);break;case "ac":a=virtualclass.wb[c].canvas;virtualclass.wb[c].selectedTool=b.tool;b.event&&"mousedown"===b.event&&virtualclass.wb[c].innerToolbarHandler(virtualclass.wbWrapper.keyMap[b.action],
c);d=WhiteboardUtility.readyMouseEvent(b.event,b.actual);d.wId=c;a.upperCanvasEl.dispatchEvent(d);b.event&&"mousedown"===b.event&&(c=a._getEventPrefix(),fabric.util.removeListener(fabric.document,`${c}move`,a._onMouseMove,{passive:!1}),fabric.util.removeListener(fabric.document,`${c}up`,a._onMouseUp,{passive:!1}),fabric.util.addListener(a.upperCanvasEl,`${c}move`,a._onMouseMove,{passive:!1}),fabric.util.addListener(a.upperCanvasEl,`${c}up`,a._onMouseUp,{passive:!1}));break;case "cr":virtualclass.wb[b.actual].clear();
break;case "ds":virtualclass.wb[b.actual].canvas.discardActiveObject();virtualclass.wb[b.actual].canvas.renderAll();break;case "da":WhiteboardUtility.deleteActiveObject(!1,c);break;case "ot":WhiteboardUtility.updateToolStyle(b.tool,b.actual.value,c);break;case "tx":virtualclass.wb[c].selectedTool=b.tool;virtualclass.wb[c].textObj.renderText(b.actual,virtualclass.wb[c]);break;default:console.log("====> do nothing")}}replayInit(c){this.init(c);this.renderObj(c)}replayData(c,b){virtualclass.wb[b].vcanMainReplayObjs=
[];0<c.length&&(virtualclass.wb[b].vcanMainReplayObjs=c,this.replayInit(b))}replayFromLocalStroage(c,b){"undefined"!==typeof Storage&&(virtualclass.wb[b].clear(b),virtualclass.wb[b].replayObjs=[],delete virtualclass.wb[b].strokeSize,delete virtualclass.wb[b].toolColor,virtualclass.wb[b].gObj.tempRepObjs=c,0<c.length&&this.triggerReplay(c,b))}triggerReplay(c,b){for(let a=0;a<c.length;a+=1)WhiteboardUtility.storeAtMemory([c[a]],b),this.replayData([c[a]],b)}};class WhiteboardProtocol{encode(c,b){return this.constructor[c](b,"encode")}decode(c,b){c=c.split("_");return this.constructor[c[0]](c,"decode",b)}static sp(c,b){let a={};"encode"===b?a={wb:[`sp_${virtualclass.wbWrapper.keyMap[`${c.name}Short`]}_${c.event}_${c.x}_${c.y}`],cf:"wb"}:"decode"===b&&(a={},a.action=c[0],a.tool=virtualclass.wbWrapper.keyMap[c[1]],a.shape=virtualclass.wbWrapper.keyMap[c[1]],a.event=virtualclass.wbWrapper.keyMap[c[2]],a.actual={x:+c[3],y:+c[4]});return a}static changeWithScale(c,
b){const a={};"divide"===c?(a.x=b.x/virtualclass.zoom.canvasScale,a.y=b.y/virtualclass.zoom.canvasScale):(a.x=+b.x*virtualclass.zoom.canvasScale,a.y=+b.y*virtualclass.zoom.canvasScale);return a}static ac(c,b,a){const d={};"encode"===b?(a=WhiteboardProtocol.changeWithScale("divide",c),d.wb=[`ac_${c.event}_${a.x}_${a.y}`],d.cf="wb"):"decode"===b&&(d.action=c[0],d.tool=virtualclass.wbWrapper.keyMap[c[0]],3<c.length&&(d.event=virtualclass.wbWrapper.keyMap[`ac${c[1]}`],c=WhiteboardProtocol.changeWithScale("multiply",
{x:c[2],y:c[3]}),d.actual={x:c.x,y:c.y},roles.hasControls()&&(c=document.getElementById(`commandToolsWrapper${a}`),d.actual.y+=c?c.offsetHeight:44,c=document.getElementById("virtualclassAppOptionsCont"),d.actual.x+=c?c.offsetWidth:55),a=document.querySelector(`#canvasWrapper${a}`),d.actual.x-=a.scrollLeft,d.actual.y-=a.scrollTop));return d}static generateWhiteboardId(c,b){"encode"===b?(b=c.split("_"),c=10<c.length?`${b[b.length-2]}::${b[b.length-1]}`:b[b.length-1]):10<c[c.length-1].length?(c=c[c.length-
1].split("::"),c=`${c[c.length-2]}_${c[c.length-1]}`,c=`_doc_${c}_${c}`):c=`_doc_0_${c[c.length-1]}`;return c}static cr(c,b){const a=WhiteboardProtocol.generateWhiteboardId(c,b);return"encode"===b?{wb:[`cr_${a}`],cf:"wb"}:{action:c[0],actual:a}}static sf(c,b){let a;if("encode"===b)for(a={wb:["sf"],cf:"wb",v:[]},b=0;b<c.length;b+=1)a.v.push(c[b]);return a}static generateFreeDrawingData(c){const b=[];let a,d,f;for(let g=0;g<c.length;g+=1)a=c[g].split("_"),d=+a[0],f=+a[1],2<a.length?b.push(`sp_f_${a[2]}_${d}_${f}`):
b.push(`sp_f_m_${d}_${f}`);return b}static tx(c,b){"encode"===b?(b=`tx_${c.x}_${c.y}_${c.text}`,b=null!=c.index?b+`_${c.index}`:b+"_-1",b=c.fontSize?b+`_${c.fontSize}`:b+"_0",b=c.fontColor?b+`_${c.fontColor}`:b+"_0",b={wb:[b],cf:"wb"}):(b={action:"tx",tool:"text",shape:"text",event:"mousedown",actual:{x:+c[1],y:+c[2],value:c[3]}},-1!==+c[4]&&(b.actual.index=c[4]),0!==+c[5]&&(b.actual.fontSize=+c[5]),0!==+c[6]&&(b.actual.fontColor=c[6]));return b}static ds(c,b){const a=WhiteboardProtocol.generateWhiteboardId(c,
b);return"encode"===b?{wb:[`ds_${a}`],cf:"wb"}:{action:c[0],actual:a}}static da(c,b){const a=WhiteboardProtocol.generateWhiteboardId(c,b);return"encode"===b?{wb:[`da_${a}`],cf:"wb"}:{action:c[0],actual:a}}static ot(c,b){return"encode"===b?{wb:[`ot_${virtualclass.wbWrapper.keyMap[c.type]}_${c.value}`],cf:"wb"}:{action:c[0],tool:virtualclass.wbWrapper.keyMap[c[1]],actual:{value:c[2]}}}};class WhiteboardWrapper{constructor(){this.gObj={};this.keyMap={triangle:"Triangle",oval:"Circle",rectangle:"Rect",line:"Line",text:"Text",circle:"Circle",r:"rectangle",f:"freeDrawing",l:"line",c:"circle",tr:"triangle",d:"innerMouseDown",m:"innerMouseMove",u:"innerMouseUp",mousedown:"d",mousemove:"m",mouseup:"u",acd:"mousedown",acm:"mousemove",acu:"mouseup",ovalShort:"o",rectangleShort:"r",freeDrawingShort:"f",lineShort:"l",textShort:"t",triangleShort:"tr",circleShort:"c",sp:"shape",ac:"activeAll",
cl:"color",cw:"clear",sk:"strk",ft:"font",font:"ft",strk:"sk",color:"cl"};this.shapes="rectangle triangle text freeDrawing circle line".split(" ");this.mouseTool="rectangle triangle circle line freeDrawing activeAll text".split(" ")}init(c,b){this.constructor.createWhiteboardContainerHtml(c,b);this.replay=new WhiteboardReplay;this.util=new WhiteboardUtility;this.protocol=new WhiteboardProtocol;this.cursor=new WhiteboardCursor;this.cursor.init();this.msg=new WhiteboardMessage}static createWhiteboardContainerHtml(c,
b){let a;var d=virtualclass.getTemplate("main","whiteboard");a="Whiteboard"===b?document.querySelector("#virtualclassWhiteboard .whiteboardContainer"):document.getElementById(`cont${c}`);if("Whiteboard"===b){virtualclass.wbCommon.hideElement();const f=`note${c}`;b=document.querySelector(`#${f}`);null!==b?(b.classList.add("canvasContainer","current"),d=d({cn:c,hasControl:roles.hasControls()}),b.innerHTML=d):(d=`<div id='${f}' data-wb-id='${c}' class='canvasContainer current'>${d({cn:c,hasControl:roles.hasControls()})}</div>`,
"_doc_0_0"!==c?a.insertAdjacentHTML("beforeend",d):(a.innerHTML=d,c=document.querySelector("#note_doc_0_0"),null!==c&&c.classList.add("current")))}else d=d({cn:c,hasControl:roles.hasControls()}),a.innerHTML=d}};class WhiteboardCommonShape{constructor(c){this.name=c;this.default={rotatingPointOffset:40,cornerSize:13,strokeWidth:1,stroke:"#00f"};this.coreObj={angle:0,selectable:!1,fill:"none",transparentCorners:!1,width:0,height:0,backgroundColor:"transparent"}}sendMouseDownData(c){virtualclass.wbWrapper.gObj.lastSentDataTime=(new Date).getTime();c={event:"d",name:this.name,x:c.x,y:c.y};const b=virtualclass.wbWrapper.protocol.encode("sp",c);WhiteboardMessage.send(b);virtualclass.wbWrapper.gObj.previousData=
c}sendMouseMoveData(c){virtualclass.gObj.lastSendDataTime||(virtualclass.gObj.lastSendDataTime=(new Date).getTime());virtualclass.wbWrapper.msg.optimizeToSend({event:"m",name:this.name,x:c.x,y:c.y},2E3,"sp")}mouseDown(c,b,a){this.innerMouseDown(c,b,a);a.e.isTrusted&&(virtualclass.wbWrapper.gObj.lastSentDataTime=(new Date).getTime(),"freeDrawing"===this.name?(this.mousedown=!0,this.chunks.push(`${c.x}_${c.y}_d`),virtualclass.wbWrapper.gObj.previousData=c):this.sendMouseDownData(c))}innerMouseDown(c,
b,a){let d=a;this.mousedown=!0;"freeDrawing"===this.name?(b.myPencil||(b.myPencil=new fabric.PencilBrush(b.canvas),b.myPencil.width=this.default.strokeWidth,b.strokeSize&&(b.myPencil.width=+b.strokeSize),b.myPencil.color=this.default.stroke,b.toolColor&&(b.myPencil.color=b.toolColor)),a||(d={e:{isPrimary:!0}}),b.myPencil.onMouseDown(c,d)):(this.startLeft=c.x,this.startTop=c.y,this.coreObj.left=this.startLeft,this.coreObj.top=this.startTop,this.coreObj.width=1,this.coreObj.height=1,this.coreObj.rotatingPointOffset=
this.default.rotatingPointOffset*virtualclass.zoom.canvasScale,this.coreObj.cornerSize=this.default.cornerSize*virtualclass.zoom.canvasScale,this.coreObj.strokeWidth=this.default.strokeWidth,this.coreObj.stroke=this.default.stroke,b.strokeSize&&(this.coreObj.strokeWidth=+b.strokeSize),b.toolColor&&(this.coreObj.stroke=b.toolColor),a=virtualclass.wbWrapper.keyMap[this.name],"line"===this.name?(this.coreObj.points=[c.x,c.y,c.x,c.y],this[this.name]=new fabric[a](this.coreObj.points,this.coreObj)):this[this.name]=
new fabric[a](this.coreObj),b.canvas.add(this[this.name]))}mouseUp(c,b,a){if("freeDrawing"===this.name){this.innerMouseUp(c,b,a);if(!a.e.isTrusted)return;virtualclass.wbWrapper.gObj.previousData&&(virtualclass.wbWrapper.gObj.lastSentDataTime=(new Date).getTime(),this.chunks.push(`${c.x}_${c.y}_u`),c=virtualclass.wbWrapper.protocol.encode("sf",this.chunks),WhiteboardMessage.send(c),this.chunks.length=0);this.mousedown=!1}else{this.innerMouseUp(c,b,!0);if(!a.e.isTrusted)return;virtualclass.wbWrapper.gObj.previousData&&
(c=virtualclass.wbWrapper.protocol.encode("sp",virtualclass.wbWrapper.gObj.previousData),WhiteboardMessage.send(c),c=virtualclass.wbWrapper.protocol.encode("sp",{event:"u",name:this.name,x:virtualclass.wbWrapper.gObj.previousData.x,y:virtualclass.wbWrapper.gObj.previousData.y}),WhiteboardMessage.send(c))}delete virtualclass.wbWrapper.gObj.previousData;delete this.freeDrawPrevious;delete virtualclass.gObj.lastSendDataTime}innerMouseUp(c,b,a){c=a;this.mousedown=!1;"freeDrawing"!==this.name?this[this.name].setCoords():
(a||(c={isPrimary:!0}),b.myPencil.onMouseUp(c),a=b.canvas.getObjects(),a[a.length-1].set({rotatingPointOffset:this.default.rotatingPointOffset*virtualclass.zoom.canvasScale,cornerSize:this.default.cornerSize*virtualclass.zoom.canvasScale}),b.activeAllObj.disableLastElement(b.wbId?b.wbId:virtualclass.gObj.currWb));delete b.myPencil}};class WhiteboardCircle extends WhiteboardCommonShape{constructor(c){super(c);this.name=c}mouseDown(c,b,a){this.innerMouseDown(c,b,a);a.e.isTrusted&&this.sendMouseDownData(c)}innerMouseDown(c,b){this.mousedown=!0;this.startLeft=c.x;this.startTop=c.y;this.coreObj.left=this.startLeft;this.coreObj.top=this.startTop;this.coreObj.rx=c.x-this.startLet;this.coreObj.ry=c.y-this.startTop;this.coreObj.angle=0;this.coreObj.stroke=this.default.stroke;this.coreObj.strokeWidth=this.default.strokeWidth;this.coreObj.rotatingPointOffset=
this.default.rotatingPointOffset*virtualclass.zoom.canvasScale;this.coreObj.cornerSize=this.default.cornerSize*virtualclass.zoom.canvasScale;this.coreObj.strokeWidth=this.default.strokeWidth;b.toolColor&&(this.coreObj.stroke=b.toolColor);b.strokeSize&&(this.coreObj.strokeWidth=+b.strokeSize);this[this.name]=new fabric.Ellipse(this.coreObj);b.canvas.add(this[this.name])}mouseMove(c,b){this.sendMouseMoveData(c);this.innerMouseMove(c,b)}innerMouseMove(c,b){let a=Math.abs(this.startLeft-c.x)/2,d=Math.abs(this.startTop-
c.y)/2;a>this.circle.strokeWidth&&(a-=this.circle.strokeWidth/2);d>this.circle.strokeWidth&&(d-=this.circle.strokeWidth/2);this.circle.set({rx:a,ry:d});this.startLeft>c.x?this.circle.set({originX:"right"}):this.circle.set({originX:"left"});this.startTop>c.y?this.circle.set({originY:"bottom"}):this.circle.set({originY:"top"});b.canvas.renderAll()}};class WhiteboardCursor{init(){this.arrImg||(this.arrImg=new Image,this.arrImg.src="https://cdn.congrea.net/resources/images/arrow.png",this.arrImgDraw=!1,this.arrImg.onload=()=>{this.arrImgDraw=!0})}send(c){this.lastarrowtime||(this.lastarrowtime=(new Date).getTime());this.presentarrowtime=(new Date).getTime();100<=this.presentarrowtime-this.lastarrowtime&&!virtualclass.wb[virtualclass.gObj.currWb].mousedown&&(ioAdapter.send(c),this.lastarrowtime=(new Date).getTime())}handle(c){c.isTrusted&&(c=virtualclass.wb[virtualclass.gObj.currWb].canvas.getPointer(c,
!0),c=WhiteboardProtocol.changeWithScale("divide",c),this.send({msg:`${c.x}_${c.y}`,cf:"ca"}))}onMessage(c){const b={};c=c.msg.split("_");b.x=c[0];b.y=c[1];this.create(b)}create(c){const b=virtualclass.gObj.currWb;c={x:c.x*virtualclass.zoom.canvasScale,y:c.y*virtualclass.zoom.canvasScale};virtualclass.posY=c.y;virtualclass.posX=c.x;this.draw(c,b);null!=virtualclass.pdfRender[b].scroll.Y&&virtualclass.pdfRender[b].customMoustPointer({y:virtualclass.posY},"Y",virtualclass.posY);null!=virtualclass.pdfRender[b].scroll.X&&
virtualclass.pdfRender[b].customMoustPointer({x:virtualclass.posX},"X",virtualclass.posX)}draw(c,b){const a=this.arrImg,d=virtualclass.wb[b].canvas.getContext("2d");d.clearRect(0,0,virtualclass.wb[b].canvas.width,virtualclass.wb[b].canvas.height);virtualclass.wb[b].canvas.renderAll();d.save();d.beginPath();d.translate(c.x,c.y);d.drawImage(a,-3,-3,18,24);d.closePath();d.restore()}};class WhiteboardMessage{static send(c){roles.hasControls()&&(ioAdapter.mustSend(c),"sf"===c.wb[0].substring(0,2)?WhiteboardUtility.storeAtMemory(c.wb,virtualclass.gObj.currWb,c.v):WhiteboardUtility.storeAtMemory(c.wb,virtualclass.gObj.currWb))}onMessage(c){if("sf"===c.message.wb[0].substring(0,2)){var b=c.fromUser.role;c=WhiteboardProtocol.generateFreeDrawingData(c.message.v,c.message.s,!0);let a;for(let d=0;d<c.length;d+=1)a={message:{wb:c[d]},fromUser:{role:b}},this.onMessage(a)}else Array.isArray(c.message.wb)||
(c.message.wb=[c.message.wb]),b=c.message.wb,virtualclass.vutil.storeWhiteboardAtInlineMemory(c.message.wb),virtualclass.zoom.canvasScale&&virtualclass.gObj.currWb&&"object"===typeof virtualclass.wb[virtualclass.gObj.currWb]&&"t"===c.fromUser.role&&virtualclass.wbWrapper.replay.triggerReplay(b,virtualclass.gObj.currWb)}optimizeToSend(c,b,a){virtualclass.wbWrapper.gObj.previousData=c;virtualclass.wbWrapper.gObj.presentSendDataTime=(new Date).getTime();virtualclass.wbWrapper.gObj.presentSendDataTime-
virtualclass.wbWrapper.gObj.lastSentDataTime>=b&&(a&&(c=virtualclass.wbWrapper.protocol.encode(a,c),this.constructor.send(c)),virtualclass.wbWrapper.gObj.lastSentDataTime=(new Date).getTime(),"sf"===a&&(virtualclass.wb[virtualclass.gObj.currWb].freeDrawingObj.chunks.length=0))}};(function(c){c.congreaLanguages.en={ActiveAll:"Active all",addcontext:"Add bookmark",Addoption:"Add option",addnew:"Add new",adminusr:"Admin user",appPrerequites:"Validate system requirements",assign:"Assign",assignDisable:"Reclaim controls",askplayMessage:'<span id="askplaymsg"> Should we start playing the session?</span><br /><span id="remaingmsg">Remaining data will be downloaded in the background.</span>',askplaymsg:'<span id="askplaymsg"> "Downloading in progress, click Play to begin </span>"',
audioInput:"Audio input",audiolatency:"Audio latency",audioOutput:"Audio output",audioDisable:"Unmute",audioEnable:"Mute",addQuestion:"Add question",addContext:"Add Bookmark",answer:"Answers",action:"Actions",audioTest:"Your voice will be recorded and played back to you. \n Press Ok and speak something for few seconds.",Back:"Back",vote:"Vote",bandfast:"Optimum network connectivity",bandmedium:"Slow network connectivity",bandslow:"Network connectivity failure",bandwitdhImageNotFound:'Image downloading failed, please click "Next" button to continue.',
becomeTeacher:"Become teacher",Binary_Limit_Exeed:"Warning: High BN usage",bulkUserActions:"Bulk user actions",ByInstructor:"By instructor",ByTimer:"By timer",cancel:"Cancel",canvasDrawMsg:"You can click on any tool for drawingclick and hold the left mouse button to draw",canvasmissing:"Canvas is missing in your browser. Please update your browser to the latest version.",chatEnable:"Disable chat",Chatroom:"Chatroom",Circle:"Circle",ClearAll:"Clear all",clickheretoplay:"Click Here To Play",clicktoplay:"Play",
chatDisable:"Enable chat",chFireBrowsersIssue:"Your browser {virtualclass1} {virtualclass2} needs updation, Congrea support Chrome 40+ and Firefox 35+.",clearAllWarnMessageW:"Do you really want to clear this whiteboard?",clearAllWarnMessageD:"Do you really want to clear this drawings?",closedsDbheading:"Close document dashboard",closeSharePresentationdbHeading:"Close presentation dashboard",closevideoDashboard:"Close video dashboard",closeVoting:"Close voting",cnmissing:"Chunk number is missing",
CodeEditor:"Code editor",cof:"Connection off",collaborate:"Collaborate",commonChat:"Common chat",commonBrowserIssue:"Your browser {virtualclass1} {virtualclass2} is not supported, Use latest version of Chrome and Firefox.",congreainchrome:"Your browser is compatible.",confirmCancel:"No",confirmOk:"Yes",connectionClose:"Connection is closed ({virtualclass1}).",connectionClosec310:"The free plan does not support recording functionality, kindly upgrade your plan or disable the recording.",continueToLiveStream:"Click ok to continue live stream",
Controls:"Controls",coursePoll:"Course level poll",Cpoll:"Course poll",Cquiz:"Close quiz",createnewpoll:"Create new poll",Creator:"Creator",comment:"Comments",dap:"false",delete:"Delete",delblank:"Remove the blank option",Delete:"Delete",DevicesNotFoundError:"Webcam is not available, or not connected properly.",deletepopup:"Are you sure to delete ?",disable:"Disable",disabled:"disabled",disableAllVideo:"Disable all video",dltDisabled:"Can be deleted  by creator of the poll",documentShare:"Share document",
DocumentSharing:"Document sharing",DocumentSharedbHeading:"Document dashboard",docUploadSuccess:"Document uploaded successfully",download:"Download",downloadFile:"Download file",downloadsession:"Please wait while the recording is downloaded",drawArea:"Draw area",dropfilehere:"Drop files here",duplicateUploadMsg:"This file already exists, please upload new file.",edit:"Edit",editorCode:"Code editor",edittitle:"Edit title",editorRichDisable:"Write mode",editorRichEnable:"Read only",educator:"Educator",
EHTMLPresentUrl:"Enter HTML5 presentation URL",enable:"Enable",enablehistory:'"Browser history" should be enabled during the session.',enableAllVideo:"Enable all video",enteryouryoutubeurl:"Enter YouTube/online video URL",etDisabledA:"Can\u2019t edit, poll attempted",etDisabledCr:"Can be edited by creator of the poll",ETime:"Elapsed time",TimeRemaining:"Time remaining",QuestionsOverview:"Questions overview",UsersAttempted:"Users attempted",gRname:"Name",gRtimeTaken:"Time taken",gRgrade:"Grade",gRQAttempted:"Q. attempted",
gRCorrect:"Correct",FF2:"Fast forward 2",FF8:"Fast forward 8",filenotsave:"Your file could not be saved.",filetsaveTS:"The session is ready to save.",Finish:"Finish",fitToPage:"Fit to page",fitToScreen:"Fit to screen",Freehand:"Free hand",general:"General",Greport:"Grade report",highBandWidthSpeed:"Your bandwidth is good enough.",httpsmissing:"Only secure origins(https) are allowed for screen sharing.",ieBrowserIssue:"Internet Explorer is not supported, Congrea fully support Chrome  and Firefox.",
ios7support:"For Apple, Virtual Class supports iOS 8 and higher versions.",iosAudEnable:"Tap here to enable the audio",InternalError:"Please ensure that same webcam is not being used <br /> in multiple browsers or multiple applications. ",invalidcmid:"Invalid course module Id.",invalidurl:"Invalid URL",indvprogress:"Current task",InsertimageURL:"Insert image URL",JoinClassMsg:"Join ClassRoom",JoinSession:"Join session",keymissing:"Your software(LMS/CMS)'s key is is missing",Line:"Line",livestream:"Live Stream",
lowBandWidthSpeed:"Your bandwidth is too low, we are stopping video playback. You will still be able to hear audio and view screen.",maxCommonChat:"Show chat window",Max_rooms:"Error: Max rooms limit reached",Max_users:"Error: Max users limit reached",media:"Media",mediumBandWidthSpeed:"Your bandwidth is limited, we are reducing video quality based on your available bandwidth.",minCommonChat:"Hide chat window",minoption:"Enter at least two options",microphoneNotConnected:"Microphone is not available, or not connected properly",
mictesting:"Microphone is working, if above audio bar fluctuates <br />and you are able to hear your own voice, while you speak",minute:"Minute",ModeclosingPoll:"Mode of closing Poll :",msgForDownloadStart:"Unable to save data. <br /> Preparing data for download",msgForReload:"Please reload this page to continue editing.",msgForWhiteboard:"Empty whiteboard.",msgStudentForReload:"Please reload this page.",Multiple_login:"Error: Access denied, multiple logins",muteAll:"Mute all",muteAllAudio:"Mute all audio",
mybsharedoc:"Document will shared shortly",NAME:"NAME",Next:"Next",note:"Add note",notePlaceholder:"Write your note here",page:"Page",of:"of",typeQuestion:"Type question",typeOption:"Type option",dropVideosHere:"Drop videos here",nomdlroot:"There is no url for momodle root.",normalView:"Normal view",noResultStd:"You are not permitted to see the result",NotAllowedError:"Webcam is disabled",NotFoundError:"Webcam is not available, or not connected properly.",NotReadableError:"Please ensure that same webcam is not being used <br /> in multiple browsers or multiple applications.",
notsupportbrowser:"{virtualclass1} is not fully compatible. For the best experience, use Google Chrome.",NotSupportedError:"Only secure origins(https) are allowed for audio and video",notSupportIphone:"Sorry. Virtual class doesn't support mobile phones.",noPoll:"There is no question available for poll. Go to \u2018Add new\u2019 to create question.",noPollNoAdmin:"There is no question available for site poll .Only admin can create site level poll.",noQuiz:"There is no Quiz available. Add quiz from your Moodle.\n    Congrea Supports only multiple choice questions.",
Novote:"No vote received for this poll",nowebcam:"Webcam is not available, or not connected properly.",nowebcamconnectedyet:"Congrea does not receives any user input yet.",notcompatiblecpu:"Processing power (CPU) in this system is low. <br /> We recommend working with modern CPU.",notcompatibleram:"RAM in this system is low. <br /> We recommend 4GB of RAM.",offcollaboration:"Collaboration off",oncollaboration:"Collaboration on",opendsDbheading:"Document dashboard",openSharePresentationdbHeading:"Presentation dashboard",
openvideoDashboard:"Video dashboard",operaBrowserIssue:"Your browser {virtualclass1} {virtualclass2} is partially supported. You will not be able to share your screen, Congrea fully support chrome and Firefox",Options:"Options",optselectd:"OPTION SELECTED",Oval:"Oval",overallprogress:"Overall progress",Pause:"Pause",pclosetag:"<span>Are you sure to close this poll?  </span>",pclose:"Are you sure to close voting?",Pclosed:"Poll closed",pdfnotrender:"There is problem with loading window, please reload browser.",
Pdsuccess:"Poll deleted successfully",PEdit:"Poll edit",PermissionDeniedError:"Webcam access has been denied.",PERMISSION_DENIED:"You denied access to your Webcam(camera/microphone).",Play:"Play",playsessionmsg:"Click \u2018play\u2019 to start the session.",pleasewaitWhSynNewCont:"Please wait a while. Syncing new content.",plswaitwhile:"Please wait....",poll:"Poll",pollblank:"Question can not be left blank",pollCancel:"Close",pollDel:"Are you sure to delete this poll?",pollHead:"Vote this poll",pollmaybeshown:"Poll will be published",
pollmybpublish:"Poll will be published shortly",pollresult:"Previous result",ppoll:"Publish poll",PQuestions:"Poll questions",PQuiz:"Publish quiz",Precheck:"Precheck",precheckStart:"Pre-check",prechkcmplt:"Precheck complete",Presult:"Poll result",preWllBshortly:"Presentation will be shared shortly",Prev:"Prev",proposedspeed:"Proposed speed",PSetting:"Poll setting",Publish:"Publish",QClosed:"Quiz closed",Question:"Question",QTquestions:"Total no of questions",QMaximumMark:"Maximum mark",QCorrectAnswers:"Correct answers",
QQuestionsAttempted:"Questions attempted",QYouScored:"You Scored",Quiz:"Quiz","Quiz/page":"Quiz / page",Quizes:"Quizzes",quizSubmit:"Submit",quizmayshow:"Get ready for a quiz",quizreviewpublish:"Review & publish quiz",RaiseHandStdDisabled:"Undo raise hand",RaiseHandEnable:"Hand raised",raiseHandNotify:"Student(s) raised hand",RaiseHandStdEnabled:"Raise hand",readonlymode:"Read only",receivedVotes:"Received votes",reclaim:"Reclaim",Rectangle:"Rectangle",rejected:"Another application on your computer might be using your webcam. Kindly close all other applications",
reload:"Reload",reloadDoc:"Reload document",removeContext:"Remove Bookmark",replay:"Re-play",Replay:"Replay from start.",replay_message:"Thanks for watching.",requestScreenShare:"Request screen share",requestedScreenShare:"Screen share is requested",Reset:"Reset",Rtime:"Remaining time",rusureCquiz:"<span>Are you sure to close this quiz? </span>",rvtu:"Votes received/ total users",reply:"Reply",safariBrowserIssue:"Your browser Safari {virtualclass1} is not supported, We fully support Chrome  and Firefox",
Save:"Save",savesession:"Do you want to save current session?",savesessionTechSupport:"Do you want to save current session? <br /> Once you download the session, Updates won't be available on re-downloading of same session.",screensharealready:"The screen is being shared.",ScreenShare:"Screen share",screensharemsg:"The above screen is being shared.",screensharenotsupport:"Screen share is not supported",screensharedenied:"User denied to share screen",second:"Second",selfview:"Disable public view",
SetTimer:"Set timer",sesseionkeymissing:"Session key is missing from Front End.",sentPackets:"Sent <br/><span>Packets</span>",SessionEnd:"Session end",sessionexpired:"Session Expired",sessionendmsg:"Session has been closed. You may now close your browser.",setting:"Setting",Searchuser:"Search user",sendMessage:"Send Message",share:"Share",ShareVideo:"Share video",shareAnotherYouTubeVideo:"Share another YouTube video",SharePresentation:"Share presentation",SharePresentationdbHeading:"Presentation dashboard",
sharetoall:"Enable public view",Showresulttostudents:"Show result to students",sitePoll:"Site level poll",Skip:"Close",someproblem:"There is some problem in uploading file. Please try again.",SourceUnavailableError:"Please ensure that same webcam is not being used in multiple browsers or multiple applications.",speakerTest:"If you can hear music, speakers are working.",Spoll:"Site poll",ssBtn:"Stop sharing",ssStop:"Stop screen sharing",startnewsession:"Do you really want to end this session?",status:"Status",
stdPublish:"stdPublish",stdscreenshare:"Do you want to share your screen ?",studentAudEnable:"Student audio enabled",studentSafariBrowserIssue:"Your browser {virtualclass1} {virtualclass2} cannot  share your webcam with other users, Congrea fully support Chrome  and Firefox.",supportDesktop:"Virtual Class does not support tablets or mobiles. To present please use a desktop.",supportDesktopOnly:"Sorry, presenter mode only supports desktops. Tablets and Mobile devices are not supported.",teacherSafariBrowserIssue:"Safari does not support presenter functionality. Please switch to Chrome or Firefox.",
techsupport:"Tech support",testingbrowser:"Testing browser compatibility",testinginternetspeed:"Testing internet speed",testingmichrophone:"Testing microphone",testingspeaker:"Testing speaker",testingwebcam:"Testing webcam",Text:"Text",Text_Limit_Exeed:"Warning: High TX usage",TextEditor:"Text editor",textPlaceholder:"Enter text here",Time:"Time",Tmyclose:"Teacher may close this poll at any time",total:"Total",totalprogress:"Total progress",tpAudioTest:"Test audio",transferControls:"Transfer controls",
Triangle:"Triangle",Udocument:"Upload document",Unauthenticated:"Error: Access invalid",unmuteAll:"Unmute all",uploadsession:"Please wait until processing is complete",uploadvideo:"Upload video",uploadedsession:"Your session has ended. You may now close the window  or close this popup to start a new session.",usermissing:"User is missing",userList:"User's list",upvote:"Upvote",instructorVideo:"Teacher Video",validateurlmsg:"Invalid URL",VCE2:"No permission to recording session",VCE4:"Record data is missing",
VCE5:"Unable to Record Data.",VCE6:"Course module is missing.",VideodbHeading:"Video dashboard",videoInput:"Video input",videooff:"Video off",videoon:"Video on",videoquality:"Video quality",virtualclassnoteHeader:"Add Note",VotedSoFar:"Votes received so far",votesuccess:"Your vote has been submitted successfully. Result will be displayed shortly.",votesuccessPbt:"Vote submitted successfully, you are not permitted to see the result.",Vwllbshrshortly:"Video will be shared shortly",viewall:"View all",
waitmsgconnect:"Please wait a while. Application is trying to connect.",watstdrespo:"Waiting for student\u2019s response",wbrtcMsgChrome:"You can click the deny button for not sharing your microphone and camera  with Congrea.or click allow button to share them.",wbrtcMsgFireFox:'You can click on  "Share Selected Devices" to share your mic and camera feed with other users',webcamerainfo:"If video is visible, webcam is working.",Whiteboard:"Whiteboard",writemode:"Write mode",youtubeshare:"YouTube video share",
youTubeUrl:"Enter YouTube video URL",zoomIn:"Zoom in",zoomOut:"Zoom out",noain:"No audio input",noaout:"No audio output",novideo:"No video",enableAllAudio:"Unmute all",disableAllAudio:"Mute all",colorSelector:"Color",strk:"Stroke size",font:"Font size",size:"Size",fullScreen:"Full screen",exitFullScreen:"Exit full screen",recordingText:"Rec",recordingStopped:"Recording Stopped",recordingStarted:"Recording Started",continueText:"Click here to continue",continue:"Continue",moveSidebar:"Move Sidebar",
timeLimit:"Time limit",noOfQuestions:"No of questions",online:"Online users",whos:"Who's online",chatroom_header:"Common chat",error:"Something bad happend. Sorry!",wserror:"Browser does not support WebSocket",sterror:"This browser doesn't support Web Storage standard",black:"black","dark-gray-4":"dark gray 4","dark-gray-3":"dark gray 3","dark-gray-2":"dark gray 2","dark-gray-1":"dark gray 1",gray:"gray","light-gray-1":"light gray 1","light-gray-2":"light gray 2","light-gray-3":"light gray 3",white:"white",
"red-berry":"red berry",red:"red",orange:"orange",yellow:"yellow",green:"green",cyan:"cyan","cornflower-blue":"cornflower blue",blue:"blue",purple:"purple",magenta:"magenta","light-red-berry-3":"light red berry 3","light-red-berry-2":"light red berry 2","light-red-berry-1":"light red berry 1","dark-red-berry-1":"dark red berry 1","dark-red-berry-2":"dark red berry 2","dark-red-berry-3":"dark red berry 3","light-red-3":"light red 3","light-red-2":"light red 2","light-red-1":"light red 1","dark-red-1":"dark red 1",
"dark-red-2":"dark red 2","dark-red-3":"dark red 3","light-orange-3":"light orange 3","light-orange-2":"light orange 2","light-orange-1":"light orange 1","dark-orange-1":"dark orange 1","dark-orange-2":"dark orange 2","dark-orange-3":"dark orange 3","light-yellow-3":"light yellow 3","light-yellow-2":"light yellow 2","light-yellow-1":"light yellow 1","dark-yellow-1":"dark yellow 1","dark-yellow-2":"dark yellow 2","dark-yellow-3":"dark yellow 3","light-green-3":"light green 3","light-green-2":"light green 2",
"light-green-1":"light green 1","dark-green-1":"dark green 1","dark-green-2":"dark green 2","dark-green-3":"dark green 3","light-cyan-3":"light cyan 3","light-cyan-2":"light cyan 2","light-cyan-1":"light cyan 1","dark-cyan-1":"dark cyan 1","dark-cyan-2":"dark cyan 2","dark-cyan-3":"dark cyan 3","light-cornflower-blue-3":"light cornflower blue 3","light-cornflower-blue-2":"light cornflower blue 2","light-cornflower-blue-1":"light cornflower blue 1","dark-cornflower-blue-1":"dark cornflower blue 1",
"dark-cornflower-blue-2":"dark cornflower blue 2","dark-cornflower-blue-3":"dark cornflower blue 3","light-blue-3":"light blue 3","light-blue-2":"light blue 2","light-blue-1":"light blue 1","dark-blue-1":"dark blue 1","dark-blue-2":"dark blue 2","dark-blue-3":"dark blue 3","light-purple-3":"light purple 3","light-purple-2":"light purple 2","light-purple-1":"light purple 1","dark-purple-1":"dark purple 1","dark-purple-2":"dark purple 2","dark-purple-3":"dark purple 3","light-magenta-3":"light magenta 3",
"light-magenta-2":"light magenta 2","light-magenta-1":"light magenta 1","dark-magenta-1":"dark magenta 1","dark-magenta-2":"dark magenta 2","dark-magenta-3":"dark magenta 3",Shapes:"Shapes",disableAllChat:"Disable private chat",enableAllChat:"Enable private chat",disableAllGroupChat:"Disable common chat",enableAllGroupChat:"Enable common chat",disableAllRaisehand:"Disable raise hand",enableAllRaisehand:"Enable raise hand",disableAllAskQuestion:"Disable Raise question",enableAllAskQuestion:"Enable Raise question",
disableAllQaMarkNotes:"Disable marks & notes",enableAllQaMarkNotes:"Enable marks & notes",disableAllUserlist:"Disable user list",enableAllUserlist:"Enable user list",Audio:"audio",Video:"video",Chat:"private chat",GroupChat:"common chat",RaiseHand:"raise hand",UserList:"user list",uploading:"Processing...",userListHeader:"Users ",commonChatHeader:"Chat Room",teacherVideoHeader:"Teacher Video",askQuestionHeader:"Raise Question",questionLable:"Question",answerLable:"Answer",commentLable:"Comment",markAnswer:"Mark As Answer",
markNotes:"Marks & Notes",askQuestionTimeExceed:"Unable to edit/delete as you have exceeded the time limit",upvoted:"Unable to edit/delete as upvote has been added",enterText:"Enter the text before posting",more:"...More",less:"Less",askQuestion:"Raise question",MarksAndNotes:"Marks & Notes",markAnswerUnmark:"You need to first unmark the already marked answer",PermissionDeniedErrorExt:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top right of the screen <br /> Click on "Always allow..." option and select the camera option <br />  Click on done and refresh the screen  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',
SecurityErrorExt:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top right of the screen <br /> Click on "Always allow..." option and select the camera option <br />  Click on done and refresh the screen  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',nopermissionExt:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top right of the screen <br /> Click on "Always allow..." option and select the camera option <br />  Click on done and refresh the screen  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',
chromeExtMiss:"Congrea needs 'Desktop Selector' plugin to share the Screen.<br />You can download this from <a href='https://chrome.google.com/webstore/detail/desktop-selector/ijhofagnokdeoghaohcekchijfeffbjl' target='_blank'>HERE.</a>",PermissionDeniedErrorExtFF:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top left of the screen <br /> Click on "Share Selected Device." option.<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',
screensharereload:"Screen is not being shared. Please reload for the sharing.",SecurityErrorExtFF:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top left of the screen <br /> Click on "Share Selected Device." option.<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',nopermissionExtFF:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top left of the screen <br /> Click on "Share Selected Device." option.<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',
TypeError:"Your webcam is not initialized properly. Please reload the page.",newPage:"Insert page"}})(window);(function(c){c.congreaLanguages.pt_br={ActiveAll:"Ativar todos",addcontext:"Adicionar marcador de p\u00e1ginas",Addoption:"Adicionar op\u00e7\u00e3o",addnew:"Adicionar novo",adminusr:"Usu\u00e1rio admin",appPrerequites:"Validar requerimentos do sistema",assign:"Atribuir",assignDisable:"Retomar controles",askplayMessage:'<span id="askplaymsg"> Devemos come\u00e7ar a sess\u00e3o?</span><br /><span id="remaingmsg">Os dados restantes ser\u00e3o baixados em paralelo.</span>',askplaymsg:'<span id="askplaymsg"> "Download em progresso, clique Play para iniciar </span>"',
audioInput:"Entrada de \u00e1udio",audiolatency:"Lat\u00eancia de \u00e1udio",audioOutput:"Sa\u00edda de \u00e1udio",audioDisable:"Desmutar",audioEnable:"Mutar",addQuestion:"Adicionar quest\u00e3o",addContext:"Adicionar Marcador de P\u00e1ginas",answer:"Respostas",action:"A\u00e7\u00f5es",audioTest:"Sua voz ser\u00e1 gravada e tocada de volta para voc\u00ea. \n Pressione Ok e fale algo por uns segundos.",Back:"Voltar",vote:"Voto",bandfast:"Conectividade de rede \u00f3tima",bandmedium:"Conectividade de rede devagar",
bandslow:"Falha na conectividade de rede",bandwitdhImageNotFound:'Download da imagem falhou, por favor clique em "Pr\u00f3ximo" para continuar.',becomeTeacher:"Virar professor",Binary_Limit_Exeed:"Alerta: Alto uso BN",bulkUserActions:"A\u00e7\u00f5es em massa do usu\u00e1rio",ByInstructor:"Pelo instrutor",ByTimer:"Pelo cron\u00f4metro",cancel:"Cancelar",canvasDrawMsg:"Voc\u00ea pode clicar em qualquer ferramenta de desenho clique e segure o bot\u00e3o esquerdo do mouse para desenhar",canvasmissing:"Canvas est\u00e1 faltando no seu browser. Favor atualizar seu browser para a \u00faltima vers\u00e3o.",
chatEnable:"Desabilitar bate-papo",Chatroom:"Sala de bate-papo",Circle:"C\u00edrculo",ClearAll:"Limpar tudo",clickheretoplay:"Clique aqui para dar Play",clicktoplay:"Play",chatDisable:"Habilitar bate-papo",chFireBrowsersIssue:"Seu browser {virtualclass1} {virtualclass2} precisa atualizar. Congrea suporta Chrome 40+ e Firefox 35+.",clearAllWarnMessageW:"Voc\u00ea realmente quer limpar este quadro branco?",clearAllWarnMessageD:"Voc\u00ea realmente quer limpar estes desenhos?",closedsDbheading:"Fechar o painel de documento",
closeSharePresentationdbHeading:"Fechar o painel de apresenta\u00e7\u00e3o",closevideoDashboard:"Fechar painel de v\u00eddeo",closeVoting:"Fechar vota\u00e7\u00e3o",cnmissing:"N\u00famero de peda\u00e7o est\u00e1 faltando",CodeEditor:"Editor de c\u00f3digo",cof:"Conex\u00e3o desligada",collaborate:"Colaborar",commonChat:"Bate-papo comum",commonBrowserIssue:"Seu browser {virtualclass1} {virtualclass2} n\u00e3o \u00e9 suportado. Use a \u00faltima vers\u00e3o do Chrome ou Firefox.",congreainchrome:"Seu browser \u00e9 compat\u00edvel.",
confirmCancel:"N\u00e3o",confirmOk:"Sim",connectionClose:"Conex\u00e3o est\u00e1 fechada ({virtualclass1}).",connectionClosec310:"O plano gratuito n\u00e3o suporta a funcionalidade de grava\u00e7\u00e3o, atualize seu plano ou desative a grava\u00e7\u00e3o.",continueToLiveStream:"Haga clic en Aceptar para continuar la transmisi\u00f3n en vivo",Controls:"Controles",coursePoll:"Enquete a n\u00edvel do curso",Cpoll:"Enquete do curso",Cquiz:"Fechar quiz",createnewpoll:"Criar nova enquete",Creator:"Criador",
comment:"Coment\u00e1rios",dap:"falso",delete:"Deletar",delblank:"Remover a op\u00e7\u00e3o em branco",Delete:"Deletar",DevicesNotFoundError:"Webcam n\u00e3o est\u00e1 dispon\u00edvel, ou n\u00e3o est\u00e1 conectada corretamente.",deletepopup:"Tem certeza que deseja deletar ?",disable:"Desabilitar",disabled:"desabilitado",disableAllVideo:"Desabilitar todo v\u00eddeo",dltDisabled:"Pode ser deletado pelo criador da enquete",documentShare:"Compartilhar documento",DocumentSharing:"Compartilhamento de documento",
DocumentSharedbHeading:"Painel de documento",docUploadSuccess:"Documento enviado com sucesso",download:"Baixar",downloadFile:"Baixar arquivo",downloadsession:"Favor aguardar enquanto a grava\u00e7\u00e3o \u00e9 baixada",drawArea:"\u00c1rea de desenho",dropfilehere:"Solte os arquivos aqui",duplicateUploadMsg:"Este arquivo j\u00e1 existe, por favor envie um novo arquivo.",edit:"Editar",editorCode:"Editor de c\u00f3digo",edittitle:"Editar t\u00edtulo",editorRichDisable:"Modo de escrita",editorRichEnable:"Apenas leitura",
educator:"Educador",EHTMLPresentUrl:"Inserir URL da apresenta\u00e7\u00e3o HTML5",enable:"Habilitar",enablehistory:'"Hist\u00f3rico do navegador" precisa estar habilitado durante a sess\u00e3o.',enableAllVideo:"Habilitar todo v\u00eddeo",enteryouryoutubeurl:"Inserir URL de v\u00eddeo online ou YouTube",etDisabledA:"N\u00e3o pode editar, enquete j\u00e1 foi tentada",etDisabledCr:"Pode ser editada pelo criador da enquete",ETime:"Tempo decorrido",TimeRemaining:"Tempo restante",QuestionsOverview:"Vis\u00e3o geral das perguntas",
UsersAttempted:"Usu\u00e1rios tentaram",gRname:"Nome",gRtimeTaken:"Tempo gasto",gRgrade:"Grau",gRQAttempted:"Q. tentativa",gRCorrect:"Corrigir",FF2:"Acelerar x2",FF8:"Acelerar x8",filenotsave:"Seu arquivo n\u00e3o pode ser salvo.",filetsaveTS:"A sess\u00e3o est\u00e1 pronta para salvar.",Finish:"Finalizar",fitToPage:"Ajustar \u00e0 p\u00e1gina",fitToScreen:"Ajustar \u00e0 tela",Freehand:"M\u00e3o livre",general:"Geral",Greport:"Relat\u00f3rio de nota",highBandWidthSpeed:"Sua banda larga \u00e9 boa o suficiente.",
httpsmissing:"Apenas origens seguras(https) s\u00e3o permitidas para compartilhamento de tela.",ieBrowserIssue:"Internet Explorer n\u00e3o \u00e9 suportado, Congrea suporta completamente Chrome  e Firefox.",ios7support:"Para Apple, Sala Virtual suporta iOS 8 e vers\u00f5es superiores.",iosAudEnable:"Toque aqui para habilitar \u00e1udio",InternalError:"Por favor, certifique-se que a mesma webcam n\u00e3o est\u00e1 sendo usada <br /> em m\u00faltiplos browsers ou m\u00faltiplas aplica\u00e7\u00f5es. ",
invalidcmid:"Id de m\u00f3dulo do curso inv\u00e1lido.",invalidurl:"URL inv\u00e1lida",indvprogress:"Tarefa atual",InsertimageURL:"Inserir URL da imagem",JoinClassMsg:"Juntar-se \u00e0 Sala de Aula",JoinSession:"Juntar-se \u00e0 sess\u00e3o",keymissing:"A chave do seu software(LMS/CMS) est\u00e1 faltando",Line:"Linha",livestream:"Transmiss\u00e3o ao vivo",lowBandWidthSpeed:"Sua banda larga \u00e9 muito baixa, n\u00f3s vamos parar o v\u00eddeo. Voc\u00ea ainda poder\u00e1 ouvir o \u00e1udio e ver a tela.",
maxCommonChat:"Mostrar janela de bate-papo",Max_rooms:"Erro: Limite de m\u00e1ximo de salas alcan\u00e7ado",Max_users:"Erro: Limite de m\u00e1ximo de usu\u00e1rios alcan\u00e7ado",media:"M\u00eddia",mediumBandWidthSpeed:"Sua banda larga \u00e9 limitada, n\u00f3s vamos reduzir a qualidade do v\u00eddeo de acordo com a banda larga dispon\u00edvel.",minCommonChat:"Esconder janela de bate-papo",minoption:"Inserir pelo menos duas op\u00e7\u00f5es",microphoneNotConnected:"Microfone n\u00e3o est\u00e1 dispon\u00edvel, ou n\u00e3o est\u00e1 devidamente conectado",
mictesting:"Seu microfone est\u00e1 funcionando se a barra de \u00e1udio acima oscilar <br />e voc\u00ea conseguir ouvir sua pr\u00f3pria voz, enquanto fala",minute:"Minuto",ModeclosingPoll:"Modo de fechamento de Enquete :",msgForDownloadStart:"Incapaz de salvar os dados. <br /> Preparando dados para download",msgForReload:"Favor recarregar esta p\u00e1gina para continuar editando.",msgForWhiteboard:"Quadro branco vazio.",msgStudentForReload:"Favor recarregar esta p\u00e1gina.",Multiple_login:"Erro: Acesso negado, m\u00faltiplos logins",
muteAll:"Mutar todos",muteAllAudio:"Mutar todo \u00e1udio",mybsharedoc:"Documento ser\u00e1 compartilhado logo",NAME:"NOME",Next:"Pr\u00f3ximo",note:"Adicionar anota\u00e7\u00e3o",notePlaceholder:"Escreva aqui a sua nota",page:"P\u00e1gina",of:"do",typeQuestion:"Digite a pergunta",typeOption:"Op\u00e7\u00e3o de tipo",dropVideosHere:"Solte v\u00eddeos aqui",nomdlroot:"N\u00e3o h\u00e1 url para a ra\u00edz momodle.",normalView:"Visualiza\u00e7\u00e3o normal",noResultStd:"Voc\u00ea n\u00e3o tem permiss\u00e3o para ver o resultado",
NotAllowedError:"Webcam est\u00e1 desabilitada",NotFoundError:"Webcam n\u00e3o est\u00e1 dispon\u00edvel, ou n\u00e3o est\u00e1 devidamente conectada.",NotReadableError:"Favor certifique-se que a mesma webcam n\u00e3o est\u00e1 sendo usada <br /> em m\u00faltiplos browsers ou m\u00faltiplas aplica\u00e7\u00f5es.",notsupportbrowser:"{virtualclass1} n\u00e3o \u00e9 completamente compat\u00edvel. Para a melhor experi\u00eancia, use o Google Chrome.",NotSupportedError:"Somente origens seguras(https) s\u00e3o permitidas para \u00e1udio e v\u00eddeo",
notSupportIphone:"Desculpe. A sala virtual n\u00e3o suporta smartphones.",noPoll:"N\u00e3o h\u00e1 nenhuma quest\u00e3o dispon\u00edvel para a enquete. V\u00e1 em \u2018Adicionar novo\u2019 para criar uma quest\u00e3o.",noPollNoAdmin:"N\u00e3o h\u00e1 nenhuma quest\u00e3o dispon\u00edvel para a enquete de site. S\u00f3 o admin pode criar enquete a n\u00edvel de site.",noQuiz:"N\u00e3o h\u00e1 nenhum Quiz dispon\u00edvel. Adicione um quiz do seu Moodle.\n    Congrea suporta apenas quest\u00f5es de m\u00faltipla escolha.",
Novote:"Nenhum voto recebido para esta enquete",nowebcam:"Webcam n\u00e3o est\u00e1 dispon\u00edvel, ou n\u00e3o est\u00e1 devidamente conectada.",nowebcamconnectedyet:"Congrea n\u00e3o recebeu nenhuma entrada do usu\u00e1rio ainda.",notcompatiblecpu:"Poder de processamento (CPU) no sistema \u00e9 baixo. <br /> N\u00f3s recomendamos usar uma CPU moderna.",notcompatibleram:"RAM no sistema \u00e9 baixo. <br /> N\u00f3s recomendamos 4GB de RAM.",offcollaboration:"Colabora\u00e7\u00e3o desligada",oncollaboration:"Colabora\u00e7\u00e3o ligada",
opendsDbheading:"Painel de documento",openSharePresentationdbHeading:"Painel de apresenta\u00e7\u00e3o",openvideoDashboard:"Painel de v\u00eddeo",operaBrowserIssue:"Seu browser {virtualclass1} {virtualclass2} \u00e9 parcialmente suportado. Voc\u00ea n\u00e3o poder\u00e1 compartilhar sua tela. Congrea suporta completamente Chrome e Firefox",Options:"Op\u00e7\u00f5es",optselectd:"OP\u00c7\u00c3O SELECIONADA",Oval:"Oval",overallprogress:"Progresso geral",Pause:"Pausar",pclosetag:"<span>Tem certeza que deseja fechar esta enquete?  </span>",
pclose:"Tem certeza que deseja fechar a vota\u00e7\u00e3o?",Pclosed:"Enquete fechada",pdfnotrender:"H\u00e1 um problema no carregamento da janela, favor recarregar browser.",Pdsuccess:"Enquete deletada com sucesso",PEdit:"Editar enquete",PermissionDeniedError:"Acesso \u00e0 Webcam foi negado.",PERMISSION_DENIED:"Voc\u00ea negou acesso \u00e0 sua Webcam(c\u00e2mera/microfone).",Play:"Toque",playsessionmsg:"Clique \u2018Play\u2019 para iniciar a sess\u00e3o.",pleasewaitWhSynNewCont:"Favor aguardar. Sincronizando novo conte\u00fado.",
plswaitwhile:"Favor aguardar....",poll:"Enquete",pollblank:"Quest\u00e3o n\u00e3o pode ser deixada em branco",pollCancel:"Fechar",pollDel:"Tem certeza que deseja deletar esta enquete?",pollHead:"Votar nesta enquete",pollmaybeshown:"Enquete ser\u00e1 publicada",pollmybpublish:"Enquete ser\u00e1 publicada em breve",pollresult:"Resultado anterior",ppoll:"Publicar enquete",PQuestions:"Quest\u00f5es da enquete",PQuiz:"Publicar quiz",Precheck:"Pr\u00e9-checagem",precheckStart:"Pr\u00e9-checagem",prechkcmplt:"Pr\u00e9-checagem completa",
Presult:"Resultado da enquete",preWllBshortly:"Apresenta\u00e7\u00e3o ser\u00e1 compartilhada em breve",Prev:"Ant",proposedspeed:"Velocidade proposta",PSetting:"Configura\u00e7\u00e3o da enquete",Publish:"Publicar",QClosed:"Quiz fechado",Question:"Quest\u00e3o",QTquestions:"N\u00famero total de perguntas",QMaximumMark:"Nota m\u00e1xima",QCorrectAnswers:"Respostas corretas",QQuestionsAttempted:"Perguntas tentadas",QYouScored:"Voc\u00ea pontuou",Quiz:"Question\u00e1rio","Quiz/page":"Question\u00e1rio / p\u00e1gina",
Quizes:"Quizzes",quizSubmit:"Enviar",quizmayshow:"Prepare-se para um quiz",quizreviewpublish:"Revisar e publicar quiz",RaiseHandStdDisabled:"Abaixar m\u00e3o",RaiseHandEnable:"M\u00e3o levantada",raiseHandNotify:"Estudante(s) com m\u00e3o levantada",RaiseHandStdEnabled:"Levantar m\u00e3o",readonlymode:"Apenas leitura",receivedVotes:"Votos recebidos",reclaim:"Retomar",Rectangle:"Ret\u00e2ngulo",rejected:"Outra aplica\u00e7\u00e3o no seu computador pode estar usando sua Webcam. Favor fechar todas as outras aplica\u00e7\u00f5es",
recarregar:"Recarregar",reloadDoc:"Recarregar documento",removeContext:"Remover Marcador de P\u00e1ginas",replay:"Replay",Replay:"Replay do come\u00e7o.",replay_message:"Obrigado por assistir.",requestScreenShare:"Pedir compartilhamento de tela",requestedScreenShare:"Compartilhamento de tela foi pedido",Reset:"Redefinir",Rtime:"Tempo restante",rusureCquiz:"<span>Tem certeza que deseja fechar o quiz? </span>",rvtu:"Votos recebidos/ total de usu\u00e1rios",reply:"Responder",safariBrowserIssue:"Seu browser Safari {virtualclass1} n\u00e3o \u00e9 suportado. N\u00f3s suportamos completamente o Chrome e o Firefox",
Save:"Salvar",savesession:"Deseja salvar a sess\u00e3o atual?",savesessionTechSupport:"Deseja salvar a sess\u00e3o atual? <br /> Uma vez baixada a sess\u00e3o, atualiza\u00e7\u00f5es n\u00e3o ser\u00e3o dispon\u00edveis ao baixar novamente a mesma sess\u00e3o.",screensharealready:"A tela est\u00e1 sendo compartilhada.",ScreenShare:"Compartilhamento de tela",screensharemsg:"A tela acima est\u00e1 sendo compartilhada.",screensharenotsupport:"Compartilhamento de tela n\u00e3o \u00e9 suportado",screensharedenied:"Usu\u00e1rio negou o compartilhamento de tela",
second:"Segundo",selfview:"Desabilitar visualiza\u00e7\u00e3o p\u00fablica",SetTimer:"Definir cron\u00f4metro",sesseionkeymissing:"A chave da sess\u00e3o est\u00e1 faltando no Front End.",sentPackets:"Enviar <br/><span>Pacotes</span>",SessionEnd:"Fim da sess\u00e3o",sessionexpired:"Sess\u00e3o vencida",sessionendmsg:"Sess\u00e3o foi fechada. Voc\u00ea pode fechar seu browser agora.",setting:"Configura\u00e7\u00e3o",Searchuser:"Buscar usu\u00e1rio",sendMessage:"Enviar mensagem",compartilhar:"Compartilhar",
ShareVideo:"Compartilhar v\u00eddeo",shareAnotherYouTubeVideo:"Compartilhar outro v\u00eddeo do YouTube",SharePresentation:"Compartilhar apresenta\u00e7\u00e3o",SharePresentationdbHeading:"Painel de apresenta\u00e7\u00e3o",sharetoall:"Habilitar visualiza\u00e7\u00e3o p\u00fablica",Showresulttostudents:"Mostrar resultado aos estudantes",sitePoll:"Enquete a n\u00edvel de site",Skip:"Fechar",someproblem:"H\u00e1 um problema no envio do arquivo. Favor tentar novamente.",SourceUnavailableError:"Favor certifique-se que a mesma Webcam n\u00e3o est\u00e1 sendo usada em m\u00faltiplos browsers ou m\u00faltiplas aplica\u00e7\u00f5es.",
speakerTest:"Se voc\u00ea consegue ouvir m\u00fasica, as caixas de som est\u00e3o funcionando.",Spoll:"Enquete de site",ssBtn:"Parar compartilhamento",ssStop:"Parar compartilhamento de tela",startnewsession:"Voc\u00ea realmente quer encerrar esta sess\u00e3o?",status:"Status",stdPublish:"stdPublish",stdscreenshare:"Deseja compartilhar sua tela?",studentAudEnable:"\u00c1udio do estudante habilitado",studentSafariBrowserIssue:"Seu browser {virtualclass1} {virtualclass2} n\u00e3o pode compartilhar sua Webcam com outros usu\u00e1rios. Congrea suporta completamente Chrome e Firefox.",
supportDesktop:"Sala Virtual n\u00e3o suporta tablets nem smartphones. Para apresentar, favor usar um computador.",supportDesktopOnly:"Desculpe, o modo de apresentador s\u00f3 suporta computadores. Tablets e smartphones n\u00e3o s\u00e3o suportados.",teacherSafariBrowserIssue:"Safari n\u00e3o suporta a funcionalidade de apresentador. Favor trocar para Chrome ou Firefox.",techsupport:"Suporte t\u00e9cnico",testingbrowser:"Testando compatibilidade com o browser",testinginternetspeed:"Testando velocidade da internet",
testingmichrophone:"Testando microfone",testingspeaker:"Testando caixa de som",testingwebcam:"Testando Webcam",Text:"Texto",Text_Limit_Exeed:"Alerta: Alto uso TX",TextEditor:"Editor de texto",textPlaceholder:"Inserir texto aqui",Time:"Tempo",Tmyclose:"Professor pode fechar esta enquete a qualquer momento",total:"Total",totalprogress:"Progresso total",tpAudioTest:"Testar \u00e1udio",transferControls:"Transferir controles",Triangle:"Tri\u00e2ngulo",Udocument:"Upload de documento",Unauthenticated:"Erro: Acesso inv\u00e1lido",
unmuteAll:"Desmutar todos",uploadsession:"Favor aguarde at\u00e9 o processamento acabar",uploadvideo:"Upload de v\u00eddeo",uploadedsession:"Sua sess\u00e3o se encerrou. Voc\u00ea j\u00e1 pode fechar sua janela  ou fechar este popup para iniciar uma nova sess\u00e3o.",usermissing:"Usu\u00e1rio est\u00e1 faltando",userList:"Lista de usu\u00e1rios",upvote:"Votar a favor",instructorVideo:"V\u00eddeo do professor",validateurlmsg:"URL inv\u00e1lida",VCE2:"Sem permiss\u00e3o para gravar sess\u00e3o",VCE4:"Dados de registro est\u00e3o faltando",
VCE5:"Incapaz de Registrar Dados.",VCE6:"M\u00f3dulo de curso est\u00e1 faltando.",VideodbHeading:"Painel de v\u00eddeo",videoInput:"Entrada de v\u00eddeo",videooff:"V\u00eddeo desligado",videoon:"V\u00eddeo ligado",videoquality:"Qualidade do v\u00eddeo",virtualclassnoteHeader:"Adicionar Anota\u00e7\u00e3o",VotedSoFar:"Votos recebidos at\u00e9 agora",votesuccess:"Seu voto foi enviado com sucesso. O resultado ser\u00e1 mostrado em breve.",votesuccessPbt:"Voto enviado com sucesso. Voc\u00ea n\u00e3o tem permiss\u00e3o para ver o resultado.",
Vwllbshrshortly:"V\u00eddeo ser\u00e1 compartilhado em breve",viewall:"Ver tudo",waitmsgconnect:"Favor aguarde um pouco. A aplica\u00e7\u00e3o est\u00e1 tentando se conectar.",watstdrespo:"Esperando a resposta do estudante",wbrtcMsgChrome:"Voc\u00ea pode clicar no bot\u00e3o de nega\u00e7\u00e3o para n\u00e3o compartilhar seu microfone e c\u00e2mera com o Congrea.ou clicar no bot\u00e3o de permitir para compartilh\u00e1-los.",wbrtcMsgFireFox:'Voc\u00ea pode clicar em "Compartilhar Dispositivos Selecionados" para compartilhar seu microfone e c\u00e2mera com outros usu\u00e1rios',
webcamerainfo:"Se v\u00eddeo est\u00e1 vis\u00edvel, a Webcam est\u00e1 funcionando.",Whiteboard:"Quadro branco",writemode:"Modo de escrita",youtubeshare:"Compartilhar v\u00eddeo do YouTube",youTubeUrl:"Inserir URL de v\u00eddeo do YouTube",zoomIn:"Mains zoom",zoomOut:"Menos zoom",noain:"Sem entrada de \u00e1udio",noaout:"Sem sa\u00edda de \u00e1udio",novideo:"Sem v\u00eddeo",enableAllAudio:"Desmutar tudo",disableAllAudio:"Mutar tudo",colorSelector:"Cor",strk:"Tamanho do pincel",font:"Tamanho da fonte",
size:"Tamanho",fullScreen:"Tela cheia",exitFullScreen:"Sair da tela cheia",recordingText:"gravando",recordingStopped:"Grava\u00e7\u00e3o parada",recordingStarted:"Grava\u00e7\u00e3o iniciada",continueText:"Clique aqui para continuar",continue:"Continuar",moveSidebar:"Mover barra lateral",timeLimit:"Prazo",noOfQuestions:"N\u00ba de perguntas",online:"Usu\u00e1rios online",whos:"Quem est\u00e1 online",chatroom_header:"Bate-papo comum",error:"Algo de errado ocorreu. Desculpe!",wserror:"Browser n\u00e3o suporta WebSocket",
sterror:"Este browser n\u00e3o suporta o padr\u00e3o de Armazenamento Web",black:"preto","dark-gray-4":"cinza escuro 4","dark-gray-3":"cinza escuro 3","dark-gray-2":"cinza escuro 2","dark-gray-1":"cinza escuro 1",gray:"cinza","light-gray-1":"cinza claro 1","light-gray-2":"cinza claro 2","light-gray-3":"cinza claro 3",white:"branco","red-berry":"vermelho cereja",red:"vermelho",orange:"laranja",yellow:"amarelo",green:"verde",cyan:"ciano","cornflower-blue":"azul flor de milho",blue:"azul",purple:"roxo",
magenta:"magenta","light-red-berry-3":"vermelho cereja claro 3","light-red-berry-2":"vermelho cereja claro 2","light-red-berry-1":"vermelho cereja claro 1","dark-red-berry-1":"vermelho cereja escuro 1","dark-red-berry-2":"vermelho cereja escuro 2","dark-red-berry-3":"vermelho cereja escuro 3","light-red-3":"vermelho claro 3","light-red-2":"vermelho claro 2","light-red-1":"vermelho claro 1","dark-red-1":"vermelho escuro 1","dark-red-2":"vermelho escuro 2","dark-red-3":"vermelho escuro 3","light-orange-3":"laranja claro 3",
"light-orange-2":"laranja claro 2","light-orange-1":"laranja claro 1","dark-orange-1":"laranja escuro 1","dark-orange-2":"laranja escuro 2","dark-orange-3":"laranja escuro 3","light-yellow-3":"amarelo claro 3","light-yellow-2":"amarelo claro 2","light-yellow-1":"amarelo claro 1","dark-yellow-1":"amarelo escuro 1","dark-yellow-2":"amarelo escuro 2","dark-yellow-3":"amarelo escuro 3","light-green-3":"verde claro 3","light-green-2":"verde claro 2","light-green-1":"verde claro 1","dark-green-1":"verde escuro 1",
"dark-green-2":"verde escuro 2","dark-green-3":"verde escuro 3","light-cyan-3":"ciano claro 3","light-cyan-2":"ciano claro 2","light-cyan-1":"ciano claro 1","dark-cyan-1":"ciano escuro 1","dark-cyan-2":"ciano escuro 2","dark-cyan-3":"ciano escuro 3","light-cornflower-blue-3":"azul flor do milho claro 3","light-cornflower-blue-2":"azul flor do milho claro 2","light-cornflower-blue-1":"azul flor do milho claro 1","dark-cornflower-blue-1":"azul flor do milho escuro 1","dark-cornflower-blue-2":"azul flor do milho escuro 2",
"dark-cornflower-blue-3":"azul flor do milho escuro 3","light-blue-3":"azul claro 3","light-blue-2":"azul claro 2","light-blue-1":"azul claro 1","dark-blue-1":"azul escuro 1","dark-blue-2":"azul escuro 2","dark-blue-3":"azul escuro 3","light-purple-3":"roxo claro 3","light-purple-2":"roxo claro 2","light-purple-1":"roxo claro 1","dark-purple-1":"roxo escuro 1","dark-purple-2":"roxo escuro 2","dark-purple-3":"roxo escuro 3","light-magenta-3":"magenta claro 3","light-magenta-2":"magenta claro 2","light-magenta-1":"magenta claro 1",
"dark-magenta-1":"magenta escuro 1","dark-magenta-2":"magenta escuro 2","dark-magenta-3":"magenta escuro 3",Shapes:"Formas",disableAllChat:"Desabilitar bate-papo privado",enableAllChat:"Habilitar bate-papo privado",disableAllGroupChat:"Desabilitar bate-papo comum",enableAllGroupChat:"Habilitar bate-papo comum",disableAllRaisehand:"Desabilitar levantar m\u00e3o",enableAllRaisehand:"Habilitar levantar m\u00e3o",disableAllAskQuestion:"Desabilitar levantar quest\u00e3o",enableAllAskQuestion:"Habilitar levantar quest\u00e3o",
disableAllQaMarkNotes:"Desabilitar marca\u00e7\u00f5es e anota\u00e7\u00f5es",enableAllQaMarkNotes:"Habilitar marca\u00e7\u00f5es e anota\u00e7\u00f5es",disableAllUserlist:"Desabilitar lista de usu\u00e1rios",enableAllUserlist:"Habilitar lista de usu\u00e1rios",Audio:"\u00e1udio",Video:"v\u00eddeo",Chat:"bate-papo privado",GroupChat:"bate-papo comum",RaiseHand:"levantar m\u00e3o",UserList:"lista de usu\u00e1rios",uploading:"Processando...",userListHeader:"Usu\u00e1rios ",commonChatHeader:"Sala de Bate-papo",
teacherVideoHeader:"V\u00eddeo do professor",askQuestionHeader:"Levantar Quest\u00e3o",questionLable:"Quest\u00e3o",answerLable:"Resposta",commentLable:"Coment\u00e1rio",markAnswer:"Marcar como Resposta",markNotes:"Marca\u00e7\u00f5es e Anota\u00e7\u00f5es",askQuestionTimeExceed:"Incapaz de editar/deletar pois voc\u00ea j\u00e1 excedeu o tempo limite",upvoted:"Incapaz de editar/deletar pois um voto a favor j\u00e1 foi adicionado",enterText:"Inserir o texto antes de postar",more:"...Mais",less:"Menos",
askQuestion:"Levantar quest\u00e3o",MarksAndNotes:"Marca\u00e7\u00f5es e Anota\u00e7\u00f5es",markAnswerUnmark:"Voc\u00ea precisa primeiro desmarcar a resposta j\u00e1 marcada",PermissionDeniedErrorExt:'<div class="errorMsg"> Acesso \u00e0 c\u00e2mera foi bloqueado. Para providenciar acesso \u00e0 Webcam, favor seguir os procedimentos abaixo <br />V\u00e1 para o \u00edcone de c\u00e2mera no topo direito da tela <br /> Clique na op\u00e7\u00e3o "Sempre permitir..." e selecione a op\u00e7\u00e3o de c\u00e2mera <br />  Clique em finalizado e recarregue a tela  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-v\u00eddeo.png" > <figcaption>Chrome</figcaption> </figure></div>',
SecurityErrorExt:'<div class="errorMsg"> Acesso \u00e0 c\u00e2mera foi bloqueado. Para providenciar acesso \u00e0 Webcam, favor seguir os procedimentos abaixo <br />V\u00e1 para o \u00edcone de c\u00e2mera no topo direito da tela <br /> Clique na op\u00e7\u00e3o "Sempre permitir..." e selecione a op\u00e7\u00e3o de c\u00e2mera <br />  Clique em finalizado e recarregue a tela  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-v\u00eddeo.png" > <figcaption>Chrome</figcaption> </figure></div>',
nopermissionExt:'<div class="errorMsg"> Acesso \u00e0 c\u00e2mera foi bloqueado. Para providenciar acesso \u00e0 Webcam, favor seguir os procedimentos abaixo <br />V\u00e1 para o \u00edcone de c\u00e2mera no topo direito da tela <br /> Clique na op\u00e7\u00e3o "Sempre permitir..." e selecione a op\u00e7\u00e3o de c\u00e2mera <br />  Clique em finalizado e recarregue a tela  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-v\u00eddeo.png" > <figcaption>Chrome</figcaption> </figure></div>',
chromeExtMiss:"Congrea precisa do plugin 'Desktop Selector' para compartilhar a Tela.<br />Voc\u00ea pode baix\u00e1-lo <a href='https://chrome.google.com/webstore/detail/desktop-selector/ijhofagnokdeoghaohcekchijfeffbjl' target='_blank'>AQUI.</a>",PermissionDeniedErrorExtFF:'<div class="errorMsg"> Acesso \u00e0 c\u00e2mera foi bloqueado. Para providenciar acesso \u00e0 Webcam, favor seguir os procedimentos abaixo <br />V\u00e1 para o \u00edcone de c\u00e2mera no topo esquerdo da tela <br /> Clique na op\u00e7\u00e3o "Compartilhar Dispositivo Selecionado"<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',
screensharereload:"Screen is not being compartilhada. Favor recarregar for the compartilhamento.",SecurityErrorExtFF:'<div class="errorMsg"> Acesso \u00e0 c\u00e2mera foi bloqueado. Para providenciar acesso \u00e0 Webcam, favor seguir os procedimentos abaixo <br />V\u00e1 para o \u00edcone de c\u00e2mera no topo esquerdo da tela <br /> Clique na op\u00e7\u00e3o "Compartilhar Dispositivo Selecionado"<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',
nopermissionExtFF:'<div class="errorMsg"> Acesso \u00e0 c\u00e2mera foi bloqueado. Para providenciar acesso \u00e0 Webcam, favor seguir os procedimentos abaixo <br />V\u00e1 para o \u00edcone de c\u00e2mera no topo esquerdo da tela <br /> Clique na op\u00e7\u00e3o "Compartilhar Dispositivo Selecionado"<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',TypeError:"Sua Webcam n\u00e3o foi inicializada corretamente. Favor recarregar a p\u00e1gina.",
newPage:"Inserir p\u00e1gina"}})(window);(function(c){c.congreaLanguages.es={ActiveAll:"Activar todo",addcontext:"A\u00f1adir marcador",Addoption:"A\u00f1adir opci\u00f3n",addnew:"A\u00f1adir nuevo",adminusr:"Administrador",appPrerequites:"Validar requisitos del sistema",assign:"Asignar",assignDisable:"Recuperar controles",askplayMessage:'<span id="askplaymsg"> \u00bfDeber\u00edamos empezar la sesi\u00f3n?</span><br /><span id="remaingmsg">Los datos restantes se descargar\u00e1n en segundo plano.</span>',askplaymsg:'<span id="askplaymsg"> "Descarga en curso, haga clic en Reproducir para comenzar </span>"',
audioInput:"Entrada de audio",audiolatency:"Latencia de audio",audioOutput:"Salida de audio",audioDisable:"Dejar de silenciar",audioEnable:"Silenciar",addQuestion:"A\u00f1adir pregunta",addContext:"A\u00f1adir marcador",answer:"Respuestas",action:"Acciones",audioTest:"Su voz ser\u00e1 grabada y reproducida para usted. \n Presione Ok y hable durante unos segundos.",Back:"Atr\u00e1s",vote:"Votar",bandfast:"Conexi\u00f3n de red \u00f3ptima",bandmedium:"Conexi\u00f3n de red lenta",bandslow:"Fallo en la conexi\u00f3n de red",
bandwitdhImageNotFound:'Error al descargar la imagen, haga clic en el bot\u00f3n "Siguiente" para continuar.',becomeTeacher:"Convertirse en docente",Binary_Limit_Exeed:"Advertencia: Alto uso de BN",bulkUserActions:"Acciones masivas de usuario",ByInstructor:"Por instructor",ByTimer:"Por tiempo",cancel:"Cancelar",canvasDrawMsg:"Puede hacer clic en cualquier herramienta para dibujarhaga clic y mantenga presionado el bot\u00f3n izquierdo del mouse para dibujar",canvasmissing:"Falta el Canvas en su navegador. Actualice su navegador a la \u00faltima versi\u00f3n.",
chatEnable:"Chat desactivado",Chatroom:"Sala de chat",Circle:"Circulo",ClearAll:"Limpiar todo",clickheretoplay:"Haga clic aqu\u00ed para comenzar",clicktoplay:"Reproducir",chatDisable:"Activar chat",chFireBrowsersIssue:"Su navegador {virtualclass1} {virtualclass2} necesita actualizarse, Congrea admite Chrome 40+ y Firefox 35+.",clearAllWarnMessageW:"\u00bfDe verdad quieres limpiar esta pizarra?",clearAllWarnMessageD:"\u00bfDe verdad quieres limpiar estos dibujos?",closedsDbheading:"Cerrar el panel de documentos",
closeSharePresentationdbHeading:"Cerrar el panel de presentaci\u00f3n",closevideoDashboard:"Cerrar el panel de v\u00eddeo",closeVoting:"Votaci\u00f3n cerrada",cnmissing:"Falta el n\u00famero de fragmento",CodeEditor:"Editar c\u00f3digo",cof:"Conexi\u00f3n desactivada",collaborate:"Colaborar",commonChat:"Chat com\u00fan",commonBrowserIssue:"Su navegador {virtualclass1} {virtualclass2} no es compatible, utilice la \u00faltima versi\u00f3n de Chrome y Firefox.",congreainchrome:"Tu navegador es compatible.",
confirmCancel:"No",confirmOk:"Si",connectionClose:"La conexi\u00f3n est\u00e1 cerrada ({virtualclass1}).",connectionClosec310:"El plan gratuito no admite la funcionalidad de grabaci\u00f3n, por favor, actualice su plan o desactive la grabaci\u00f3n.",continueToLiveStream:"Haga clic en Aceptar para continuar la transmisi\u00f3n en vivo",Controls:"Controles",coursePoll:"Encuesta de nivel de curso",Cpoll:"Encuesta del curso",Cquiz:"Cerrar cuestionario",createnewpoll:"Crear nueva encuesta",Creator:"Creador",
comment:"Comentarios",dap:"Falso",delete:"Eliminar",delblank:"Eliminar la opci\u00f3n en blanco",Delete:"Eliminar",DevicesNotFoundError:"La webcam no se encuentra disponible, o no est\u00e1 conectada correctamente.",deletepopup:"\u00bfEst\u00e1s seguro de eliminar? ?",disable:"Desactivar",disabled:"Desactivar",disableAllVideo:"Desactivar todo el video",dltDisabled:"Puede ser eliminado por el creador de la encuesta.",documentShare:"Compartir documento",DocumentSharing:"Compartiendo documentos",DocumentSharedbHeading:"Panel de documentos",
docUploadSuccess:"Documento cargado exitosamente",download:"Descargar",downloadFile:"Descargar archivo",downloadsession:"Por favor espere mientras se descarga la grabaci\u00f3n",drawArea:"\u00c1rea de dibujo",dropfilehere:"Suelta los archivos aqu\u00ed",duplicateUploadMsg:"Este archivo ya existe, cargue un archivo nuevo.",edit:"Editar",editorCode:"Editor de c\u00f3digo",edittitle:"Editar t\u00edtulo",editorRichDisable:"Modo de escritura",editorRichEnable:"Solo lectura",educator:"Educador",EHTMLPresentUrl:"Ingrese la URL de presentaci\u00f3n HTML5",
enable:"Activar",enablehistory:'"Historial del navegador" debe habilitarse durante la sesi\u00f3n.',enableAllVideo:"Activar todo el video",enteryouryoutubeurl:"Ingrese la URL de Youtube",etDisabledA:"No se puede editar, intento de encuesta",etDisabledCr:"Puede ser editado por el creador de la encuesta.",ETime:"Tiempo transcurrido",TimeRemaining:"Tiempo restante",QuestionsOverview:"Resumen de preguntas",UsersAttempted:"Los usuarios intentaron",gRname:"Nombre",gRtimeTaken:"Tiempo tomado",gRgrade:"Grado",
gRQAttempted:"Q. intento",gRCorrect:"Correcto",FF2:"Avance r\u00e1pido 2",FF8:"Avance r\u00e1pido 8",filenotsave:"Su archivo no se pudo guardar.",filetsaveTS:"La sesi\u00f3n est\u00e1 lista para guardarse.",Finish:"Finalizado",fitToPage:"Ajustar a la p\u00e1gina",fitToScreen:"Ajustar la pantalla",Freehand:"A mano",general:"General",Greport:"Informe de calificaciones",highBandWidthSpeed:"Su ancho de banda es lo suficientemente bueno.",httpsmissing:"Solo se permiten or\u00edgenes seguros (https) para compartir la pantalla.",
ieBrowserIssue:"Internet Explorer no es compatible, Congrea es totalmente compatible con Chrome y Firefox.",ios7support:"Para Apple, Virtual Class es compatible con iOS 8 y versiones superiores.",iosAudEnable:"Toque aqu\u00ed para habilitar el audio.",InternalError:"Aseg\u00farese de que no se est\u00e9 utilizando la misma c\u00e1mara web <br /> en varios navegadores o varias aplicaciones. ",invalidcmid:"ID del m\u00f3dulo del curso no v\u00e1lido",invalidurl:"URL inv\u00e1lida",indvprogress:"Tarea actual",
InsertimageURL:"Insertar URL de la imagen",JoinClassMsg:"\u00danete al aula",JoinSession:"\u00danete a la session",keymissing:"Su software(LMS/CMS)'s falta la Key",Line:"L\u00ednea",livestream:"Transmisi\u00f3n en vivo",lowBandWidthSpeed:"Su ancho de banda es demasiado bajo, estamos deteniendo la reproducci\u00f3n de video. A\u00fan podr\u00e1 escuchar el audio y ver la pantalla.",maxCommonChat:"Mostrar ventana de chat",Max_rooms:"Error: L\u00edmite m\u00e1ximo de salas alcanzado",Max_users:"Error: L\u00edmite m\u00e1ximo de usuarios alcanzado",
media:"Media",mediumBandWidthSpeed:"Su ancho de banda es limitado, estamos reduciendo la calidad de video en funci\u00f3n de su ancho de banda disponible.",minCommonChat:"Ocultar ventana de chat",minoption:"Ingrese al menos dos opciones",microphoneNotConnected:"El micr\u00f3fono no est\u00e1 disponible o no est\u00e1 conectado correctamente",mictesting:"El micr\u00f3fono funciona, si la barra de audio anterior fluct\u00faa <br />y puedes escuchar tu propia voz mientras hablas",minute:"Minuto",ModeclosingPoll:"Modo de cerrar la encuesta :",
msgForDownloadStart:"No se pueden guardar los datos. <br /> Preparando datos para descargar",msgForReload:"Vuelva a cargar esta p\u00e1gina para continuar editando.",msgForWhiteboard:"Pizarra vac\u00eda.",msgStudentForReload:"Por favor, vuelva a cargar esta p\u00e1gina.",Multiple_login:"Error: Acceso denegado, m\u00faltiples inicios de sesi\u00f3n",muteAll:"Silenciar todo",muteAllAudio:"Silenciar todo el audio",mybsharedoc:"El documento se compartir\u00e1 en breve.",NAME:"NOMBRE",Next:"Siguiente",
note:"A\u00f1adir nota",notePlaceholder:"Escribe tu nota aqu\u00ed",page:"P\u00e1gina",of:"de",typeQuestion:"Escriba pregunta",typeOption:"Opci\u00f3n de tipo",dropVideosHere:"Suelta videos aqu\u00ed",nomdlroot:"No hay URL para Moodle.",normalView:"Vista normal",noResultStd:"No tiene permiso para ver el resultado.",NotAllowedError:"Webcam desactivada",NotFoundError:"La Webcam no est\u00e1 disponible o no est\u00e1 conectada correctamente.",NotReadableError:"Aseg\u00farese de que no se est\u00e9 utilizando la misma webcam <br /> en varios navegadores o varias aplicaciones.",
notsupportbrowser:"{virtualclass1} no es totalmente compatible. Para la mejor experiencia, use Google Chrome.",NotSupportedError:"Solo se permiten or\u00edgenes seguros (https) para audio y video",notSupportIphone:"Lo siento. La clase virtual no es compatible con tel\u00e9fonos m\u00f3viles.",noPoll:'No hay preguntas disponibles para la encuesta. Vaya a "Agregar nuevo" para crear una pregunta.',noPollNoAdmin:"No hay preguntas disponibles para la encuesta del sitio. Solo el administrador puede crear una encuesta a nivel del sitio.",
noQuiz:"No hay cuestionario disponible. Agregue un cuestionario en su Moodle. Congrea solo admite preguntas de opci\u00f3n m\u00faltiple.",Novote:"No se recibi\u00f3 voto para esta encuesta.",nowebcam:"Webcam no disponible o no est\u00e1 conectada correctamente.",nowebcamconnectedyet:"Congrea a\u00fan no recibi\u00f3 ninguna acceso de usuario.",notcompatiblecpu:"La potencia del procesador en este sistema es baja. <br /> Es aconsejable trabajar con un procesador m\u00e1s potente",notcompatibleram:"Su sistema no dispone de suficiente memoria ram. <br /> Es recomendable disponer al menos de 4GB.",
offcollaboration:"Colaboraci\u00f3n descactivada",oncollaboration:"Colaboraci\u00f3n activada",opendsDbheading:"Panel de documento",openSharePresentationdbHeading:"Panel de Presentaci\u00f3n",openvideoDashboard:"Panel de V\u00eddeo",operaBrowserIssue:"Su navegador {virtualclass1} {virtualclass2} no es totalmente compatible. No podr\u00e1 compartir su pantalla, Congrea es totalmente compatible con Chrome y Firefox",Options:"Opciones",optselectd:"SELECCIONAR OPCI\u00d3N",Oval:"\u00d3valo",overallprogress:"Progreso general",
Pause:"Pausar",pclosetag:"<span>\u00bfEst\u00e1s seguro de cerrar esta encuesta?  </span>",pclose:"\u00bfEst\u00e1s seguro de cerrar la votaci\u00f3n?",Pclosed:"Encuesta cerrada",pdfnotrender:"Hay un problema con la ventana de carga, actualice la ventana del navegador.",Pdsuccess:"Encuesta eliminada exitosamente",PEdit:"Editar encuesta",PermissionDeniedError:"Se ha denegado el acceso a la webcam.",PERMISSION_DENIED:"Deneg\u00f3 el acceso a su webcam (c\u00e1mara/micr\u00f3fono).",Play:"Reproducir",
playsessionmsg:"Haga clic en \u2018reproducir\u2019 para comenzar la sesi\u00f3n.",pleasewaitWhSynNewCont:"Por favor, espere un momento. Estamos sincronizando nuevo contenido.",plswaitwhile:"Por favor espere....",poll:"Encuesta",pollblank:"La pregunta no puede dejarse en blanco",pollCancel:"Cerrar",pollDel:"\u00bfEst\u00e1s seguro de eliminar esta encuesta?",pollHead:"Vota esta encuesta",pollmaybeshown:"La encuesta ser\u00e1 publicada",pollmybpublish:"La encuesta se publicar\u00e1 en breve.",pollresult:"Resultado anterior",
ppoll:"Publicar encuesta",PQuestions:"Preguntas de la encuesta",PQuiz:"Publicar examen",Precheck:"Precomprobaci\u00f3n",precheckStart:"Precomprobar",prechkcmplt:"Precomprobaci\u00f3n completa",Presult:"Resultado de la encuesta",preWllBshortly:"La presentaci\u00f3n se compartir\u00e1 en breve.",Prev:"Anterior",proposedspeed:"Velocidad propuesta",PSetting:"Configurar encuesta",Publish:"Publicar",QClosed:"Examen cerrado",Question:"Pregunta",QTquestions:"No total de preguntas",QMaximumMark:"Marca m\u00e1xima",
QCorrectAnswers:"Respuestas correctas",QQuestionsAttempted:"Preguntas intentadas",QYouScored:"Has anotado",Quiz:"Examen","Quiz/page":"Examen / p\u00e1gina",Quizes:"Ex\u00e1menes",quizSubmit:"Enviar",quizmayshow:"Prep\u00e1rate para una prueba",quizreviewpublish:"Revisar y publicar examen",RaiseHandStdDisabled:"Bajar la mano",RaiseHandEnable:"Levantar la mano",raiseHandNotify:"Alumno(s) levant\u00f3 la mano",RaiseHandStdEnabled:"Mano levantada",readonlymode:"Solo lectura",receivedVotes:"Votos recibidos",
reclaim:"Reclamar",Rectangle:"Rect\u00e1ngulo",rejected:"Otra aplicaci\u00f3n en su computadora podr\u00eda estar usando su c\u00e1mara web. Debe cerrar las dem\u00e1s aplicaciones",reload:"Recargar",reloadDoc:"Recargar documento",removeContext:"Eliminar marcador",replay:"Repetir",Replay:"Repetir desde el inicio.",replay_message:"Gracias por visualizarlo.",requestScreenShare:"Solicitar compartir pantalla",requestedScreenShare:"Se solicita compartir pantalla",Reset:"Restablecer",Rtime:"Tiempo restante",
rusureCquiz:"<span>\u00bfEst\u00e1s seguro de cerrar este cuestionario? </span>",rvtu:"Votos recibidos/ usuarios totales",reply:"Repetir",safariBrowserIssue:"Su navegador Safari {virtualclass1} no es compatible. Es aconsejable usar Chrome y Firefox",Save:"Grabar",savesession:"\u00bfQuieres guardar la sesi\u00f3n actual?",savesessionTechSupport:"\u00bfQuieres guardar la sesi\u00f3n actual? <br /> Una vez que descargue la sesi\u00f3n, las actualizaciones no estar\u00e1n disponibles al volver a cargarla.",
screensharealready:"La pantalla se est\u00e1 compartiendo.",ScreenShare:"Compartir pantalla",screensharemsg:"La pantalla de arriba se est\u00e1 compartiendo.",screensharenotsupport:"Pantalla compartida no soportada",screensharedenied:"El usuario rechaz\u00f3 compartir su pantalla",second:"Segundo",selfview:"Deshabilitar vista p\u00fablica",SetTimer:"Establecer tiempo",sesseionkeymissing:"Falta la KEY de la interfaz",sentPackets:"Enviar <br/><span>Paquetes</span>",SessionEnd:"Sesi\u00f3n finalizada",
sessionexpired:"La sesi\u00f3n ha expirado",sessionendmsg:"La sesi\u00f3n ha sido cerrada. Puede cerrar su navegador.",setting:"Configuraci\u00f3n",Searchuser:"Buscar usuario",sendMessage:"Enviar mensaje",share:"Compartir",ShareVideo:"Compartir v\u00eddeo",shareAnotherYouTubeVideo:"Compartir otro v\u00eddeo de YouTube",SharePresentation:"Compartir presentaci\u00f3n",SharePresentationdbHeading:"Panel de Presentaci\u00f3n",sharetoall:"Habilitar vista p\u00fablica",Showresulttostudents:"Mostrar resultados de los alumnos",
sitePoll:"Encuesta nivel del centro",Skip:"Cerrar",someproblem:"Hubo alg\u00fan problema al cargar el archivo. Int\u00e9ntelo de nuevo.",SourceUnavailableError:"Por favor, aseg\u00farese de que no se est\u00e9 utilizando la misma webcam en otros navegadores o aplicaciones.",speakerTest:"Si puedes escuchar m\u00fasica, los altavoces est\u00e1n funcionando.",Spoll:"Encuesta del centro",ssBtn:"Deja de compartir",ssStop:"Dejar de compartir pantalla",startnewsession:"\u00bfSeguro qu\u00e9 quieres finalizar esta sesi\u00f3n?",
status:"Estado",stdPublish:"stdPublicado",stdscreenshare:"\u00bfQuieres compartir tu pantalla?",studentAudEnable:"Audio del alumno activado",studentSafariBrowserIssue:"Su navegador {virtualclass1} {virtualclass2} no puede ,compartir su webcam con otros usuarios Congrea solo es compatible con Chrome y Firefox.",supportDesktop:"La clase virtual no es compatible con dispositivos m\u00f3viles. Es aconsejable usar un pc o port\u00e1til.",supportDesktopOnly:"Lo sentimos, el modo de presentaci\u00f3n solo es compatible con pcs o port\u00e1tiles. Los dispositivos m\u00f3viles no son totalmente compatibles.",
teacherSafariBrowserIssue:"El navegador Safari no admite la funcionalidad de presentaci\u00f3n. Por favor, use Chrome o Firefox.",techsupport:"Apoyo t\u00e9cnico",testingbrowser:"Test de compatibilidad del navegador",testinginternetspeed:"Test de velocidad de conexi\u00f3n",testingmichrophone:"Test de micr\u00f3fono",testingspeaker:"Test de altavoces",testingwebcam:"Test de webcam",Text:"Texto",Text_Limit_Exeed:"Advertencia: Demasiado texto",TextEditor:"Editor de texto",textPlaceholder:"Introducir texto aqu\u00ed",
Time:"Tiempo",Tmyclose:"El docente puede cerrar esta encuesta en cualquier momento.",total:"Total",totalprogress:"Progreso total",tpAudioTest:"Test de audio",transferControls:"Controles de transferencia",Triangle:"Tri\u00e1ngulo",Udocument:"Subir documento",Unauthenticated:"Error: Acceso no v\u00e1lido",unmuteAll:"Dejar de silenciar todo",uploadsession:"Por favor espere a que finalice todo el proceso",uploadvideo:"Subir v\u00eddeo",uploadedsession:"Su sesi\u00f3n ha finalizado. Puede cerrar la ventana.  o cierre esta ventana emergente para comenzar una nueva sesi\u00f3n.",
usermissing:"Falta el alumno",userList:"Lista de usuarios",upvote:"Voto a favor",instructorVideo:"Video del docente",validateurlmsg:"URL no v\u00e1lida",VCE2:"No tiene permiso para grabar esta sesi\u00f3n",VCE4:"Faltan datos de registro",VCE5:"Incapaz de registrar datos.",VCE6:"Falta el m\u00f3dulo del curso.",VideodbHeading:"Panel del v\u00eddeo",videoInput:"Entrada de V\u00eddeo",videooff:"V\u00eddeo desactivado",videoon:"V\u00eddeo activado",videoquality:"Calidad de video",virtualclassnoteHeader:"A\u00f1adir nota",
VotedSoFar:"Votos recibidos hasta ahora",votesuccess:"Su voto ha sido enviado con \u00e9xito. El resultado se mostrar\u00e1 en breve.",votesuccessPbt:"Voto enviado con \u00e9xito, no se le permite ver el resultado.",Vwllbshrshortly:"El video se compartir\u00e1 en breve",viewall:"Ver todo",waitmsgconnect:"Por favor, espere un momento. La aplicaci\u00f3n est\u00e1 intentando conectarse.",watstdrespo:"Esperando la respuesta del alumno",wbrtcMsgChrome:"Puede hacer clic en el bot\u00f3n denegar para no compartir su micr\u00f3fono y c\u00e1mara con Congrea.o haga clic en el bot\u00f3n Permitir para compartirlo.",
wbrtcMsgFireFox:'Puedes hacer clic en  "Compartir dispositivos seleccionados" para compartir tu micr\u00f3fono y c\u00e1mara con otros usuarios.',webcamerainfo:"Si el video es visible, la webcam est\u00e1 funcionando correctamente.",Whiteboard:"Pizarra",writemode:"Modo de escritura",youtubeshare:"Compartir video de YouTube",youTubeUrl:"Introducir URL del v\u00eddeo de YouTube",zoomIn:"M\u00e1s Zoom",zoomOut:"Menos Zoom",noain:"Sin entrada de audio",noaout:"Sin salida de audio",novideo:"No hay video",
enableAllAudio:"Activar todo el audio",disableAllAudio:"Silenciar todo el audio",colorSelector:"Color",strk:"Tama\u00f1o del trazo",font:"Tama\u00f1o de la fuente",size:"Talla",fullScreen:"Pantalla completa",exitFullScreen:"Salir de pantalla completa",recordingText:"Rec",recordingStopped:"Grabaci\u00f3n detenida",recordingStarted:"Grabaci\u00f3n iniciada",continueText:"Clic aqu\u00ed para continuar",continue:"Seguir",moveSidebar:"Mover barra lateral",timeLimit:"L\u00edmite de tiempo",noOfQuestions:"No de preguntas",
online:"Usuarios en l\u00ednea",whos:"Qui\u00e9n est\u00e1 en l\u00ednea",chatroom:"Sala de chat",chatroom_header:"Chat com\u00fan",error:"Ha ocurrido un error. Lo sentimos!",wserror:"Su navegador no es compatible con WebSocket",sterror:"Su navegador no es compatible con el est\u00e1ndar de almacenamiento web",black:"negro","dark-gray-4":"dark gray 4","dark-gray-3":"dark gray 3","dark-gray-2":"dark gray 2","dark-gray-1":"dark gray 1",gray:"gris","light-gray-1":"light gray 1","light-gray-2":"light gray 2",
"light-gray-3":"light gray 3",white:"blanco","red-berry":"red berry",red:"rojo",orange:"naranja",yellow:"amarillo",green:"verde",cyan:"cian","cornflower-blue":"cornflower blue",blue:"azul",purple:"morado",magenta:"fucsia","light-red-berry-3":"light red berry 3","light-red-berry-2":"light red berry 2","light-red-berry-1":"light red berry 1","dark-red-berry-1":"dark red berry 1","dark-red-berry-2":"dark red berry 2","dark-red-berry-3":"dark red berry 3","light-red-3":"light red 3","light-red-2":"light red 2",
"light-red-1":"light red 1","dark-red-1":"dark red 1","dark-red-2":"dark red 2","dark-red-3":"dark red 3","light-orange-3":"light orange 3","light-orange-2":"light orange 2","light-orange-1":"light orange 1","dark-orange-1":"dark orange 1","dark-orange-2":"dark orange 2","dark-orange-3":"dark orange 3","light-yellow-3":"light yellow 3","light-yellow-2":"light yellow 2","light-yellow-1":"light yellow 1","dark-yellow-1":"dark yellow 1","dark-yellow-2":"dark yellow 2","dark-yellow-3":"dark yellow 3",
"light-green-3":"light green 3","light-green-2":"light green 2","light-green-1":"light green 1","dark-green-1":"dark green 1","dark-green-2":"dark green 2","dark-green-3":"dark green 3","light-cyan-3":"light cyan 3","light-cyan-2":"light cyan 2","light-cyan-1":"light cyan 1","dark-cyan-1":"dark cyan 1","dark-cyan-2":"dark cyan 2","dark-cyan-3":"dark cyan 3","light-cornflower-blue-3":"light cornflower blue 3","light-cornflower-blue-2":"light cornflower blue 2","light-cornflower-blue-1":"light cornflower blue 1",
"dark-cornflower-blue-1":"dark cornflower blue 1","dark-cornflower-blue-2":"dark cornflower blue 2","dark-cornflower-blue-3":"dark cornflower blue 3","light-blue-3":"light blue 3","light-blue-2":"light blue 2","light-blue-1":"light blue 1","dark-blue-1":"dark blue 1","dark-blue-2":"dark blue 2","dark-blue-3":"dark blue 3","light-purple-3":"light purple 3","light-purple-2":"light purple 2","light-purple-1":"light purple 1","dark-purple-1":"dark purple 1","dark-purple-2":"dark purple 2","dark-purple-3":"dark purple 3",
"light-magenta-3":"light magenta 3","light-magenta-2":"light magenta 2","light-magenta-1":"light magenta 1","dark-magenta-1":"dark magenta 1","dark-magenta-2":"dark magenta 2","dark-magenta-3":"dark magenta 3",Shapes:"Formas",disableAllChat:"Desactivar chat privado",enableAllChat:"Activar chat privado",disableAllGroupChat:"Desactivar chat com\u00fan",enableAllGroupChat:"Activar chat com\u00fan",disableAllRaisehand:"Desactivar manos levantadas",enableAllRaisehand:"Activar manos levantadas",disableAllAskQuestion:"Desactivar plantear pregunta",
enableAllAskQuestion:"Activar plantear pregunta",disableAllQaMarkNotes:"Desactivar marcas y notas",enableAllQaMarkNotes:"Activar marcas y notas",disableAllUserlist:"Deshabilitar lista de usuarios",enableAllUserlist:"Habilitar lista de usuarios",Audio:"Audio",Video:"V\u00eddeo",Chat:"Chat privado",GroupChat:"Chat com\u00fan",RaiseHand:"Levantar mano",UserList:"Lista de usuarios",uploading:"Procesando...",userListHeader:"Usuarios ",commonChatHeader:"Sala de chat",teacherVideoHeader:"V\u00eddeo del docente",
askQuestionHeader:"Plantear una duda",questionLable:"Preguntar",answerLable:"Responder",commentLable:"Comentar",markAnswer:"Marcar como respuesta",markNotes:"Marcas y notas",askQuestionTimeExceed:"No se puede editar o eliminar, se ha excedido el l\u00edmite de tiempo",upvoted:"No se puede editar o eliminar, se ha agregado un voto positivo",enterText:"Introduzca el texto antes de publicar",more:"...M\u00e1s",less:"Menos",askQuestion:"Plantear la pregunta",MarksAndNotes:"Marcas y notas",markAnswerUnmark:"Primero debe desmarcar la respuesta ya marcada",
PermissionDeniedErrorExt:'<div class="errorMsg"> Se ha bloqueado el acceso a la c\u00e1mara. Para proporcionar acceso a la c\u00e1mara web, siga los siguiente pasos <br />Ir al \u00edcono de la c\u00e1mara en la esquina superior derecha de la pantalla <br /> Haga clic en "Permitir siempre..." y seleccione la opci\u00f3n de c\u00e1mara <br />  Acepte y actualice la pantalla  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',
SecurityErrorExt:'<div class="errorMsg"> Se ha bloqueado el acceso a la c\u00e1mara. Para proporcionar acceso a la c\u00e1mara web, siga los siguiente pasos <br />Ir al \u00edcono de la c\u00e1mara en la esquina superior derecha de la pantalla <br /> Haga clic en "Permitir siempre..." y seleccione la opci\u00f3n de c\u00e1mara <br />  Acepte y actualice la pantalla  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',
nopermissionExt:'<div class="errorMsg"> Se ha bloqueado el acceso a la c\u00e1mara. Para proporcionar acceso a la c\u00e1mara web, siga los siguiente pasos <br />Ir al \u00edcono de la c\u00e1mara en la esquina superior derecha de la pantalla <br /> Haga clic en "Permitir siempre..." y seleccione la opci\u00f3n de c\u00e1mara <br />  Acepte y actualice la pantalla  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',
chromeExtMiss:"Congrea necesita el plugin'Selector de escritorio' para compartir la pantalla.<br />Puedes descargarlo desde <a href='https://chrome.google.com/webstore/detail/desktop-selector/ijhofagnokdeoghaohcekchijfeffbjl'target='_blank'>AQU\u00cd.</a>",PermissionDeniedErrorExtFF:'<div class="errorMsg"> Se ha bloqueado el acceso a la c\u00e1mara. Para proporcionar acceso a la c\u00e1mara web, siga los siguiente pasos <br />Ir al \u00edcono de la c\u00e1mara en la parte superior izquierda de la pantalla <br /> Haga clic en "Compartir dispositivo seleccionado.".<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',
screensharereload:"La pantalla no se comparte. Vuelva a cargar para compartir.",SecurityErrorExtFF:'<div class="errorMsg"> Se ha bloqueado el acceso a la c\u00e1mara. Para proporcionar acceso a la c\u00e1mara web, siga los siguiente pasos <br />Ir al \u00edcono de la c\u00e1mara en la parte superior izquierda de la pantalla <br /> Haga clic en "Compartir dispositivo seleccionado.".<div class="screenImages"> <figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',
nopermissionExtFF:'<div class="errorMsg"> Se ha bloqueado el acceso a la c\u00e1mara. Para proporcionar acceso a la c\u00e1mara web, siga los siguiente pasos <br />Ir al \u00edcono de la c\u00e1mara en la parte superior izquierda de la pantalla <br /> Haga clic en "Compartir dispositivo seleccionado.".<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" ><figcaption>Chrome</figcaption> </figure></div>',TypeError:"Su webcam no est\u00e1 inicializada correctamente. Por favor recarga la p\u00e1gina.",
newPage:"Insertar p\u00e1gina"}})(window);(function(c){(function(b){"undefined"!==typeof b&&b&&"0"!=b||(b=c.navigator.language.toLowerCase(),b=b.replace(/-/g,"_"));Object.prototype.hasOwnProperty.call(c.congreaLanguages,b)||(4<=b.length?(b=b.substring(0,2),b=Object.prototype.hasOwnProperty.call(c.congreaLanguages,b)?b:"en"):b="en");c.message=c.congreaLanguages[b]})(wbUser.language);c.getString=function(b,a){b=c.virtualclass.lang.message[b];if("undefined"!==typeof a&&0<a.length)for(let d=0;d<a.length;d++)b=b.replace(new RegExp(`{virtualclass${d+
1}}`),a[d]);return b}})(window);(function(c){let b,a={init(){this.msgBoxClass="msgBox";this.window={};this.virtualWindow={};return this},displayMessage(b,a,c,k,m,n){b="undefined"===typeof m?this.createMsgBox(b,a,c):this.createMsgBox(b,a,c,m);a=document.getElementById(`vcanvas${n}`);"undefined"!==typeof k?document.getElementById(k+n).appendChild(b):a.insertBefore(b,a.childNodes[0])},createErrorMsg(b,a,c,k){if(null===document.querySelector("#errorContainer .notcompatiblecpu")){var d=document.getElementById(`main${a}`);null==d?(d=
document.createElement("div"),d.id=`main${a}`,a=document.getElementById(c),null!==a&&a.parentNode.insertBefore(d,a)):null!=k&&Object.prototype.hasOwnProperty.call(k,"className")&&(a=document.querySelector(`#main${a} .errorContainer.${k.className}`),null!=a&&a.parentNode.removeChild(a));for(a=document.querySelectorAll("#mainerrorContainer .errorContainer");2<a.length;)a[0].parentNode.removeChild(a[0]),a=document.querySelectorAll("#mainerrorContainer .errorContainer");a=document.createElement("div");
a.classList.add("errorContainer");k&&a.classList.add(k.className);k=document.createElement("span");k.className="error";k.innerHTML=b;b=document.createElement("span");b.className="close";b.innerHTML="x";b.onclick=b=>{b.target.parentNode.parentNode.removeChild(b.target.parentNode)};a.appendChild(k);a.appendChild(b);d.appendChild(a)}},createAskQuestionMsg(b,a,c,k){if(null===document.querySelector("#msgContainer")){var d="askQuestionMsg",f=document.getElementById(a);if(null==f)f=document.createElement("div"),
f.id=a;else if(null!=k&&Object.prototype.hasOwnProperty.call(k,"className")){const b=document.querySelector(`#${a}.${k.className}`);null!=b&&b.parentNode.removeChild(b);d+=` ${k.className}`}f.innerHTML=`<span className="${d}">${b}</span>`;b=document.querySelector("#closeAskQuestionMsg");null==b&&(b=document.createElement("span"),b.id="closeAskQuestionMsg",b.innerHTML="x",f.appendChild(b));b.onclick=function(){const b=document.querySelector(`#${a}`);b.parentNode.removeChild(b)};c=document.querySelector(`.${c}`);
null!==c&&c.parentNode.insertBefore(f,c);return f.id}},removeErrorMsg(b,a){b=document.getElementById(b);if("undefined"!==typeof a&&(a=b.innerHTML.split(/<br>|<br\\>/),1<a.length)){a.shift();b.innerHTML=a.join();return}b.parentNode.removeChild(b)},removeErrorContainer(b){b=document.getElementById(b);b.parentNode.removeChild(b)},customCreateElement(b,a,c){b=document.createElement(b);"undefined"!==typeof a&&a&&(b.id=a);"undefined"!==typeof c&&(b.className=c);return b},createMsgBox(b,a,c,k){const d=this.customCreateElement("div",
a,c);"undefined"===typeof k&&(c=this.customCreateElement("div",`${a}img`,`${c}img`),d.appendChild(c));a=this.customCreateElement("p",`${a}Para`);a.innerHTML=b;d.appendChild(a);return d},disappearBox(b){b=document.getElementsByClassName(this.msgBoxClass+b);null!=b[0]&&b[0].parentNode.removeChild(b[0])},multiMediaMsg(b){},canvasDrawMsg(b,a){let d;document.getElementById(`vcanvas${a}`).classList.add("canvasMsgBoxParent");"Firefox"===virtualclass.system.mybrowser.name?(d=virtualclass.lang.getString("canvasDrawMsg"),
this.displayMessage(d,"canvasDrawMsgContFirefox",this.msgBoxClass+b,"containerWb")):"Chrome"===virtualclass.system.mybrowser.name&&(d=virtualclass.lang.getString("canvasDrawMsg"),this.displayMessage(d,"canvasDrawMsgContChrome",this.msgBoxClass+b,"containerWb",null,a))},drawLabel(b,a){const d=virtualclass.lang.getString("drawArea");this.displayMessage(d,"canvasDrawArea",this.msgBoxClass+b,"containerWb",!1,a)},displayMsgBox(b,a){const d=this.customCreateElement("div",b),f=this.customCreateElement("p",
`${b}Para`);f.innerHTML=virtualclass.lang.getString(a);d.appendChild(f);a=this.customCreateElement("a",`${b}Anchor`);a.href="#";a.innerHTML=virtualclass.lang.getString("reload");a.onclick=function(){c.location.reload()};d.appendChild(a);b=document.getElementById("divForReloadMsg"===b?"virtualclassCont":"virtualclassAppLeftPanel");b.insertBefore(d,b.firstChild)},displayServerError(b,a){b=this.customCreateElement("div",b);b.innerHTML=a;a=document.getElementById("vcanvas");a.parentNode.insertBefore(b,
a)},removeElement(b){b=document.getElementById(b);null!=b&&b.parentNode.removeChild(b)},disableSSUI(){const b=document.getElementById("virtualclassScreenShareTool");null!=b&&(b.style.opacity="0.5",b.style.pointerEvents="none")},disableLeftAppBar(){const b=document.getElementById("virtualclassOptionsCont");null!=b&&(b.style.opacity="0.5",b.style.pointerEvents="none")}};a=a.init();a.window.resizeFinished=function(){let b=0;return function(a,d){clearTimeout(b);b=setTimeout(a,d)}}();a.window.resize=function(b){b=
virtualclass.system.measureResoultion({width:c.innerWidth,height:c.innerHeight});"DocumentShare"===virtualclass.currApp&&(b.width-=10,roles.hasControls()?b.height-=100:b.height-=40);b=virtualclass.gObj.currWb;"undefined"!==typeof b&&"undefined"!==typeof virtualclass.wb[b]&&Object.prototype.hasOwnProperty.call(virtualclass.wb[b],"vcan")&&virtualclass.wb[b].vcan.renderAll();a.windowResizeFinished()};a.windowResizeFinished=function(){clearTimeout(b);b=setTimeout(()=>{a.windowResizingFinished()},100)};
a.windowResizingFinished=function(){"mobTab"===virtualclass.system.device&&vhCheck();if(("Whiteboard"==virtualclass.currApp||"DocumentShare"===virtualclass.currApp)&&null!=virtualclass.gObj.currWb&&"undefined"!==typeof virtualclass.gObj.currWb||"ScreenShare"===virtualclass.currApp)Object.prototype.hasOwnProperty.call(virtualclass.gObj,"fitToScreenOnResize")&&clearTimeout(virtualclass.gObj.fitToScreenOnResize),virtualclass.gObj.fitToScreenOnResize=setTimeout(()=>{"ScreenShare"===virtualclass.currApp?
virtualclass.ss.triggerFitToScreen():null!=document.querySelector(".zoomControler .fitScreen")&&virtualclass.zoom.zoomAction("fitToScreen")},700);virtualclass.chat.calculateViewPortForMessageBox()};c.view=a})(window);(function(c){let b={init(){this.wbRtc={};this.wbRtc.className="webrtcCont";this.mybrowser={}},isCanvasSupport(b,d,f){return"MSIE"===d?9===f:!!c.CanvasRenderingContext2D},isWebSocketSupport(){return c.WebSocket&&("function"===typeof c.WebSocket||"object"===typeof c.WebSocket)&&Object.prototype.hasOwnProperty.call(c.WebSocket,"OPEN")},isLocalStorageSupport(){return void 0!==Storage},isGetUserMediaSupport(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||
navigator.msGetUserMedia;return!!navigator.getUserMedia},isIndexedDbSupport(){return!!(c.indexedDB||c.webkitIndexedDB||c.mozIndexedDB||c.msIndexedDB)},isWorkerSupport(){return!!c.Worker},isAudioApiSupport(){return!(!c.AudioContext&&!c.webkitAudioContext)},isTypedArraySupport(){return!!("ArrayBuffer"in c)},isMobile(){let b=!1;var d=navigator.userAgent||navigator.vendor||c.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(d)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(d.substr(0,
4)))b=!0;return b},isScreenShareSupport(b,d){return"Firefox"===b?34<=d:"Chrome"===b?39<=d:!1},setValue(b,d){this[b]=d},checkBrowserFunctions(b,d){this.setValue("canvas",this.isCanvasSupport());this.setValue("webSocket",this.isWebSocketSupport());this.setValue("getusermedia",this.isGetUserMediaSupport());this.setValue("indexeddb",this.isIndexedDbSupport());this.setValue("webworker",this.isWorkerSupport());this.setValue("webaudio",this.isAudioApiSupport());this.setValue("typedarray",this.isTypedArraySupport());
this.setValue("screenshare",this.isScreenShareSupport(b,d));this.setValue("localstorage",this.isLocalStorageSupport())},measureResoultion(b){if(!Object.prototype.hasOwnProperty.call(virtualclass.gObj,"measureDimension")){var a=document.getElementById("virtualclassCont");a=virtualclass.vutil.getElementOffset(a);const d=a.x;virtualclass.gObj.measureDimension={width:1024>b.width?1024-(d+10):b.width-(d+350),height:b.height-a.y}}return virtualclass.gObj.measureDimension},setDocCanvasDimension(b,d,c){c=
document.querySelector(`#canvas${c}`);null!=c&&(c.width=b,c.height=d)},reportBrowser(b){b=this.getErrors(b);1<b.length?virtualclass.error.push(`${b.join(",")} are disabled in your browser.`):1===b.length&&virtualclass.error.push(`${b} is disabled in your browser.`)},getErrors(b){const a=[],c="canvas webSocket getusermedia webaudio indexeddb localstorage typedarray".split(" ");"t"!==b&&"e"!==b||c.push("webworker","screenshare");for(b=0;b<c.length;b++)this[c[b]]||("screenshare"===c[b]&&(virtualclass.gObj.errNotScreenShare=
!0),a.push(virtualclass.lang.getString(`err${c[b]}`)));return a},check(){this.device="desktop";const b=document.getElementById("virtualclassCont");var d=this.mybrowser.detection();const c=d[0];d=parseFloat(d[1]);this.mobile=this.isMobile();this.mybrowser.name=c;this.mybrowser.version=d;this.checkBrowserFunctions(c,d);this.mobile?(console.log("====> is mobile true"),this.device="mobTab",b.classList.add("mobTab"),b.setAttribute("device","mobile"),"Chrome"===c&&(40>d?(this.mybrowser.notSuppport=!0,virtualclass.error.push(virtualclass.lang.getString("commonBrowserIssue",
[c,d])),virtualclass.vutil.initDisableVirtualClass()):40<=d&&67>d&&virtualclass.vutil.initDisableAudVid())):"Chrome"===c&&40<=d||"Firefox"===c&&35<=d||(roles.isStudent(),0)?this.reportBrowser(virtualclass.gObj.uRole):"Chrome"===c&&40>d||"Firefox"===c&&35>d||roles.isStudent()&&"OPR"===c&&26>d?(this.reportBrowser(virtualclass.gObj.uRole),virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",[c,d]))):"OPR"===c&&26<=d?(this.reportBrowser(virtualclass.gObj.uRole),roles.hasControls()&&
virtualclass.error.push(virtualclass.lang.getString("operaBrowserIssue",[c,d]))):this.mybrowser.detectIE()&&(virtualclass.gObj.errIE=!0,virtualclass.error.push(virtualclass.lang.getString("ieBrowserIssue")),virtualclass.vutil.initDisableVirtualClass());this.mybrowser.iOS=this.iOS()},mediaDevices:{webcamErr:[],async getMediaDeviceInfo(){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=async function(){return await navigator.mediaDevices.enumerateDevices()});
let b=[];const d="https:"===location.protocol;let f=!1;"undefined"!==typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?f=!0:navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(f=!0);let g=this.hasWebcam=this.hasSpeakers=this.hasMicrophone=!1,k=!1;const m=this;if(f)if(!navigator.enumerateDevices&&c.MediaStreamTrack&&c.MediaStreamTrack.getSources&&(navigator.enumerateDevices=c.MediaStreamTrack.getSources.bind(c.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&
(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices){b=[];try{var n=await navigator.enumerateDevices()}catch(r){}n.forEach(a=>{const c={};for(const b in a)c[b]=a[b];"audio"===c.kind&&(c.kind="audioinput");"video"===c.kind&&(c.kind="videoinput");let f;b.forEach(b=>{b.id===c.id&&b.kind===c.kind&&(f=!0)});f||(c.deviceId||(c.deviceId=c.id),c.id||(c.id=c.deviceId),c.label?("videoinput"!==c.kind||k||(k=!0),"audioinput"!==c.kind||g||(g=!0)):(c.label="Please invoke getUserMedia once.",
d||(c.label=`HTTPs is required to get label of this ${c.kind} device.`)),"audioinput"===c.kind&&(m.hasMicrophone=!0),"audiooutput"===c.kind&&(m.hasSpeakers=!0),"videoinput"===c.kind&&(m.hasWebcam=!0),b.push(c))})}else callback&&callback()}},webpInit(){virtualclass.modernizr.on("webp",b=>{virtualclass.system.webpSupport="Firefox"===virtualclass.system.mybrowser.name||"Edge"===virtualclass.system.mybrowser.name?!1:!!b})},initResize(){Object.prototype.hasOwnProperty.call(virtualclass.gObj,"measureDimension")&&
delete virtualclass.gObj.measureDimension;Object.prototype.hasOwnProperty.call(virtualclass.gObj,"initResize")&&clearTimeout(virtualclass.gObj.initResize);virtualclass.gObj.initResize=setTimeout(()=>{virtualclass.vutil.addClass("virtualclassCont","resizeWindow");virtualclass.view.window.resize()},50)},_initResize(){virtualclass.vutil.addClass("virtualclassCont","resizeWindow");virtualclass.view.window.resize()}};b.init();c.addEventListener("resize",()=>{b.initResize()});b.mybrowser.detectIE=function(){const b=
c.navigator.userAgent;var d=b.indexOf("MSIE ");if(0<d)return parseInt(b.substring(d+5,b.indexOf(".",d)),10);if(0<b.indexOf("Trident/"))return d=b.indexOf("rv:"),parseInt(b.substring(d+3,b.indexOf(".",d)),10);d=b.indexOf("Edge/");return 17<=d?!1:parseInt(b.substring(d+5,b.indexOf(".",d)),10)};b.mybrowser.detection=function(){let b;const d=navigator.userAgent;let c,g=d.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];/trident/i.test(g[1])&&(c=/\brv[ :]+(\d+)/g.exec(d)||[],b=
{name:"IE",version:c[1]||""});"Chrome"===g[1]&&(c=d.match(/\b(OPR|Edge)\/(\d+)/),null!=c&&(b={name:c[1].replace("OPR","Opera"),version:c[2]}));g=g[2]?[g[1],g[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(c=d.match(/version\/(\d+)/i))&&(g.splice(1,1,c[1]),b={name:g[0],version:g[1]});return"undefined"!==typeof b?[b.name,b.version]:g};b.isCompatibleCPU=function(){return c.navigator.hardwareConcurrency?!(4>c.navigator.hardwareConcurrency):!0};b.isCompatibleRAM=function(){return c.navigator.deviceMemory?
!(4>c.navigator.deviceMemory):!0};b.iOS=function(){return"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document};c.system=b})(window);class WhiteboardRectangle extends WhiteboardCommonShape{constructor(c){super(c);this.name=c}mouseMove(c,b){this.sendMouseMoveData(c);this.innerMouseMove(c,b)}innerMouseMove(c,b){if(this.mousedown){var a=c.x;c=c.y;var d=a-this.startLeft,f=c-this.startTop;0<d?this.rectangle.set("width",d):(this.rectangle.set("left",a),this.rectangle.set("width",-1*d));0<f?this.rectangle.set("height",f):(this.rectangle.set("top",c),this.rectangle.set("height",-1*f));b.canvas.renderAll()}}};class WhiteboardTriangle extends WhiteboardCommonShape{constructor(c){super(c);this.name=c}mouseMove(c,b){this.sendMouseMoveData(c);this.innerMouseMove(c,b)}innerMouseMove(c,b){if(this.mousedown){var a=c.x;c=c.y;var d=a-this.startLeft,f=c-this.startTop;0<d?this.triangle.set("width",d):this.triangle.set("width",-1*d);0<f?(this.triangle.set("angle",0),this.triangle.set("height",f),0<d?this.triangle.set("left",a-d):this.triangle.set("left",a)):(this.triangle.set("angle",180),this.triangle.set("height",
-1*f),this.triangle.set("top",c+-1*f),0<d?this.triangle.set("left",a):this.triangle.set("left",a+-1*d));b.canvas.renderAll()}}};class WhiteboardLine extends WhiteboardCommonShape{constructor(c){super(c);this.name=c}mouseMove(c,b){this.sendMouseMoveData(c);this.innerMouseMove(c,b)}innerMouseMove(c,b){this.mousedown&&(this.line.set({x2:c.x,y2:c.y}),b.canvas.renderAll())}};class WhiteboardText{constructor(c){this.placeHolder=virtualclass.lang.getString("textPlaceholder");this.name=c;this.default={rotatingPointOffset:40,cornerSize:13,fontSize:20,fill:"#00f"};this.coreObj={fontWeight:"normal",fontFamily:"arial",padding:7,editingBorderColor:"#08518f"}}isObjectInEditingMode(c){const b=c.canvas.getObjects("i-text");for(let a=0;a<b.length;a+=1)b[a].isEditing&&c.canvas.trigger("text:editing:exited",{target:b[a]})}mouseDown(c,b){virtualclass.wbWrapper.gObj.textSelected||this.textEditing?
virtualclass.wbWrapper.gObj.textSelected&&!b.activeAllObj.activeDown&&(virtualclass.wbWrapper.gObj.textSelected.enterEditing(),c=b.canvas.getObjects("i-text"),virtualclass.wbWrapper.gObj.textSelected.text.trim()!==this.placeHolder&&(this.editingIndex=c.indexOf(virtualclass.wbWrapper.gObj.textSelected)),b.activeAllObj.disable(virtualclass.gObj.currWb,"i-text"),this.textEditing=!0):this.renderText(c,b)}updateText(c,b,a){c.text?a.set("text",c.text):a.set("text",c.value);c.fontSize&&a.set("fontSize",
c.fontSize);c.fontColor&&a.set("fill",c.fontColor);b.canvas.renderAll()}renderText(c,b){var a=b.canvas.getObjects("i-text");0<a.length&&null!=c.index?(a=a[c.index])?this.updateText(c,b,a):this.createText(c,b):this.createText(c,b)}isEmptyText(c){c=c.canvas.getObjects("i-text");for(let b=0;b<c.length;b+=1)if(c[b].text===this.placeHolder)return!0;return!1}createText(c,b){""===c.value||this.isEmptyText(b)||(this.startLeft=c.x,this.startTop=c.y,this.coreObj.left=this.startLeft,this.coreObj.top=this.startTop,
c=c.value?c.value:this.placeHolder,this.coreObj.rotatingPointOffset=this.default.rotatingPointOffset*virtualclass.zoom.canvasScale,this.coreObj.cornerSize=this.default.cornerSize*virtualclass.zoom.canvasScale,this.coreObj.fontSize=this.default.fontSize,b.fontSize&&(this.coreObj.fontSize=+b.fontSize),this.coreObj.fill=this.default.fill,b.toolColor&&(this.coreObj.fill=b.toolColor),this[this.name]=new fabric.IText(c,this.coreObj),b.canvas.add(this[this.name]))}finalizeText(c){const b=virtualclass.wb[virtualclass.gObj.currWb];
this.textEditing=!1;if(!this.isDefault(c.target)){virtualclass.wbWrapper.gObj.lastSentDataTime=(new Date).getTime();var a={x:c.target.left,y:c.target.top,text:c.target.text};null!=this.editingIndex&&(a.index=this.editingIndex);+b.fontSize&&c.target.fontSize!==+b.fontSize&&(a.fontSize=b.fontSize);b.toolColor&&c.target.fill!==b.toolColor&&(a.fontColor=b.toolColor);virtualclass.wbWrapper.msg.optimizeToSend(a,0,"tx");delete this.editingIndex;b.activeAllObj.enable(virtualclass.gObj.currWb,"i-text");(a.fontColor||
a.fontSize)&&this.updateText(a,b,c.target)}}isDefault(c){return c.text.trim()===this.placeHolder}afterSelected(c){console.log("selected 1");virtualclass.wbWrapper.gObj.textSelected=c}afterDeSelected(){console.log("deselected 1");virtualclass.wbWrapper.gObj.textSelected=null}mouseMove(){}mouseUp(){}};class WhiteboardFreeDrawing extends WhiteboardCommonShape{constructor(c){super(c);this.name=c;this.chunks=[]}innerMouseMove(c,b,a){a||(a={e:{isPrimary:!0}});b.myPencil.onMouseMove(c,a)}mouseMove(c,b,a){this.innerMouseMove(c,b,a);a.e.isTrusted&&(this.collectingData(c),virtualclass.wbWrapper.msg.optimizeToSend(this.chunks,3E3,"sf"))}collectingData(c){c={x:c.x,y:c.y};if(!this.freeDrawPrevious||1<Math.abs(c.x-this.freeDrawPrevious.x)||1<Math.abs(c.y-this.freeDrawPrevious.y))this.freeDrawPrevious=c,this.chunks.push(`${c.x}_${c.y}`);
virtualclass.wbWrapper.gObj.previousData=c}};(function(c){(function(b){"object"===typeof exports&&"undefined"!==typeof module?module.exports=b():"function"===typeof define&&define.amd?define([],b):("undefined"!==typeof c?c:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).adapter=b()})(()=>function g(a,d,c){function f(k,r){if(!d[k]){if(!a[k]){const a="function"===typeof require&&require;if(!r&&a)return a(k,!0);if(m)return m(k,!0);r=Error(`Cannot find module '${k}'`);throw r.code="MODULE_NOT_FOUND",r;}r=d[k]={exports:{}};
a[k][0].call(r.exports,d=>f(a[k][1][d]||d),r,r.exports,g,a,d,c)}return d[k].exports}var m="function"===typeof require&&require;for(let a=0;a<c.length;a++)f(c[a]);return f}({1:[function(a,d,f){function g(a,d,c,f,g){d=p.writeRtpDescription(a.kind,d);d+=p.writeIceParameters(a.iceGatherer.getLocalParameters());d+=p.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":g||"active");d+=`a=mid:${a.mid}\r\n`;d=a.rtpSender&&a.rtpReceiver?d+"a=sendrecv\r\n":a.rtpSender?d+"a=sendonly\r\n":
a.rtpReceiver?d+"a=recvonly\r\n":d+"a=inactive\r\n";a.rtpSender&&(c=`msid:${f.id} ${a.rtpSender.track.id}\r\n`,d+=`a=${c}`,d+=`a=ssrc:${a.sendEncodingParameters[0].ssrc} ${c}`,a.sendEncodingParameters[0].rtx&&(d+=`a=ssrc:${a.sendEncodingParameters[0].rtx.ssrc} ${c}`,d+=`a=ssrc-group:FID ${a.sendEncodingParameters[0].ssrc} ${a.sendEncodingParameters[0].rtx.ssrc}\r\n`));d+=`a=ssrc:${a.sendEncodingParameters[0].ssrc} cname:${p.localCName}\r\n`;a.rtpSender&&a.sendEncodingParameters[0].rtx&&(d+=`a=ssrc:${a.sendEncodingParameters[0].rtx.ssrc} cname:${p.localCName}\r\n`);
return d}function k(a,d){let c=!1;a=JSON.parse(JSON.stringify(a));return a.filter(a=>{if(a&&(a.urls||a.url)){let f=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");const g="string"===typeof f;g&&(f=[f]);f=f.filter(a=>0!==a.indexOf("turn:")||-1===a.indexOf("transport=udp")||-1!==a.indexOf("turn:[")||c?0===a.indexOf("stun:")&&14393<=d&&-1===a.indexOf("?transport=udp"):c=!0);delete a.url;a.urls=g?f[0]:f;return!!f.length}})}function m(a,d){const c={codecs:[],
headerExtensions:[],fecMechanisms:[]},f=function(a,d){a=parseInt(a,10);for(let c=0;c<d.length;c++)if(d[c].payloadType===a||d[c].preferredPayloadType===a)return d[c]},g=function(a,d,c,g){a=f(a.parameters.apt,c);d=f(d.parameters.apt,g);return a&&d&&a.name.toLowerCase()===d.name.toLowerCase()};a.codecs.forEach(f=>{for(let k=0;k<d.codecs.length;k++){let m=d.codecs[k];if(f.name.toLowerCase()===m.name.toLowerCase()&&f.clockRate===m.clockRate&&("rtx"!==f.name.toLowerCase()||!f.parameters||!m.parameters.apt||
g(f,m,a.codecs,d.codecs))){m=JSON.parse(JSON.stringify(m));m.numChannels=Math.min(f.numChannels,m.numChannels);c.codecs.push(m);m.rtcpFeedback=m.rtcpFeedback.filter(a=>{for(let d=0;d<f.rtcpFeedback.length;d++)if(f.rtcpFeedback[d].type===a.type&&f.rtcpFeedback[d].parameter===a.parameter)return!0;return!1});break}}});a.headerExtensions.forEach(a=>{for(let f=0;f<d.headerExtensions.length;f++){const g=d.headerExtensions[f];if(a.uri===g.uri){c.headerExtensions.push(g);break}}});return c}function n(a,d,
c){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[d][a].indexOf(c)}function r(a,d){const c=a.getRemoteCandidates().find(a=>d.foundation===a.foundation&&d.ip===a.ip&&d.port===a.port&&d.priority===a.priority&&d.protocol===a.protocol&&d.type===a.type);c||a.addRemoteCandidate(d);return!c}function t(a,
d){d.addTrack(a);const c=new Event("addtrack");c.track=a;d.dispatchEvent(c)}function z(a,d){d.removeTrack(a);const c=new Event("removetrack");c.track=a;d.dispatchEvent(c)}function v(a,d,f,g){const k=new Event("track");k.track=d;k.receiver=f;k.transceiver={receiver:f};k.streams=g;c.setTimeout(()=>{a._dispatchEvent("track",k)})}function u(a,d){d=Error(d);d.name=a;return d}const p=a("sdp");d.exports=function(a,d){const c=function(c){const f=this,g=document.createDocumentFragment();["addEventListener",
"removeEventListener","dispatchEvent"].forEach(a=>{f[a]=g[a].bind(g)});this.canTrickleIceCandidates=null;this.needNegotiation=!1;this.localStreams=[];this.remoteStreams=[];this.remoteDescription=this.localDescription=null;this.signalingState="stable";this.iceGatheringState=this.iceConnectionState="new";c=JSON.parse(JSON.stringify(c||{}));this.usingBundle="max-bundle"===c.bundlePolicy;if("negotiate"===c.rtcpMuxPolicy)throw u("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");c.rtcpMuxPolicy||
(c.rtcpMuxPolicy="require");switch(c.iceTransportPolicy){case "all":case "relay":break;default:c.iceTransportPolicy="all"}switch(c.bundlePolicy){case "balanced":case "max-compat":case "max-bundle":break;default:c.bundlePolicy="balanced"}c.iceServers=k(c.iceServers||[],d);this._iceGatherers=[];if(c.iceCandidatePoolSize)for(let d=c.iceCandidatePoolSize;0<d;d--)this._iceGatherers=new a.RTCIceGatherer({iceServers:c.iceServers,gatherPolicy:c.iceTransportPolicy});else c.iceCandidatePoolSize=0;this._config=
c;this.transceivers=[];this._sdpSessionId=p.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=void 0;this._isClosed=!1};c.prototype.onicecandidate=null;c.prototype.onaddstream=null;c.prototype.ontrack=null;c.prototype.onremovestream=null;c.prototype.onsignalingstatechange=null;c.prototype.oniceconnectionstatechange=null;c.prototype.onicegatheringstatechange=null;c.prototype.onnegotiationneeded=null;c.prototype.ondatachannel=null;c.prototype._dispatchEvent=function(a,d){if(!this._isClosed&&
(this.dispatchEvent(d),"function"===typeof this[`on${a}`]))this[`on${a}`](d)};c.prototype._emitGatheringStateChange=function(){const a=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",a)};c.prototype.getConfiguration=function(){return this._config};c.prototype.getLocalStreams=function(){return this.localStreams};c.prototype.getRemoteStreams=function(){return this.remoteStreams};c.prototype._createTransceiver=function(a){var d=0<this.transceivers.length;a={track:null,
iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};this.usingBundle&&d?(a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport):(d=this._createIceAndDtlsTransports(),a.iceTransport=d.iceTransport,a.dtlsTransport=d.dtlsTransport);this.transceivers.push(a);
return a};c.prototype.addTrack=function(d,c){if(this.transceivers.find(a=>a.track===d))throw u("InvalidAccessError","Track already exists.");if("closed"===this.signalingState)throw u("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");let f;for(let a=0;a<this.transceivers.length;a++)this.transceivers[a].track||this.transceivers[a].kind!==d.kind||(f=this.transceivers[a]);f||(f=this._createTransceiver(d.kind));this._maybeFireNegotiationNeeded();-1===this.localStreams.indexOf(c)&&
this.localStreams.push(c);f.track=d;f.stream=c;f.rtpSender=new a.RTCRtpSender(d,f.dtlsTransport);return f.rtpSender};c.prototype.addStream=function(a){const c=this;if(15025<=d)a.getTracks().forEach(d=>{c.addTrack(d,a)});else{const d=a.clone();a.getTracks().forEach((a,c)=>{const f=d.getTracks()[c];a.addEventListener("enabled",a=>{f.enabled=a.enabled})});d.getTracks().forEach(a=>{c.addTrack(a,d)})}};c.prototype.removeTrack=function(d){if(!(d instanceof a.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");
const c=this.transceivers.find(a=>a.rtpSender===d);if(!c)throw u("InvalidAccessError","Sender was not created by this connection.");const {stream:f}=c;c.rtpSender.stop();c.rtpSender=null;c.track=null;c.stream=null;-1===this.transceivers.map(a=>a.stream).indexOf(f)&&-1<this.localStreams.indexOf(f)&&this.localStreams.splice(this.localStreams.indexOf(f),1);this._maybeFireNegotiationNeeded()};c.prototype.removeStream=function(a){const d=this;a.getTracks().forEach(a=>{const c=d.getSenders().find(d=>d.track===
a);c&&d.removeTrack(c)})};c.prototype.getSenders=function(){return this.transceivers.filter(a=>!!a.rtpSender).map(a=>a.rtpSender)};c.prototype.getReceivers=function(){return this.transceivers.filter(a=>!!a.rtpReceiver).map(a=>a.rtpReceiver)};c.prototype._createIceGatherer=function(d,c){const f=this;if(c&&0<d)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();const g=new a.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});
Object.defineProperty(g,"state",{value:"new",writable:!0});this.transceivers[d].candidates=[];this.transceivers[d].bufferCandidates=function(a){const c=!a.candidate||0===Object.keys(a.candidate).length;g.state=c?"completed":"gathering";null!==f.transceivers[d].candidates&&f.transceivers[d].candidates.push(a.candidate)};g.addEventListener("localcandidate",this.transceivers[d].bufferCandidates);return g};c.prototype._gather=function(d,c){const f=this,{iceGatherer:g}=this.transceivers[c];if(!g.onlocalcandidate){var {candidates:k}=
this.transceivers[c];this.transceivers[c].candidates=null;g.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates);g.onlocalcandidate=function(a){if(!(f.usingBundle&&0<c)){var k=new Event("icecandidate");k.candidate={sdpMid:d,sdpMLineIndex:c};var m=a.candidate;if(a=!m||0===Object.keys(m).length){if("new"===g.state||"gathering"===g.state)g.state="completed"}else"new"===g.state&&(g.state="gathering"),m.component=1,k.candidate.candidate=p.writeCandidate(m);m=p.splitSections(f.localDescription.sdp);
m[k.candidate.sdpMLineIndex+1]=a?m[k.candidate.sdpMLineIndex+1]+"a=end-of-candidates\r\n":m[k.candidate.sdpMLineIndex+1]+`a=${k.candidate.candidate}\r\n`;f.localDescription.sdp=m.join("");m=f.transceivers.every(a=>a.iceGatherer&&"completed"===a.iceGatherer.state);"gathering"!==f.iceGatheringState&&(f.iceGatheringState="gathering",f._emitGatheringStateChange());a||f._dispatchEvent("icecandidate",k);m&&(f._dispatchEvent("icecandidate",new Event("icecandidate")),f.iceGatheringState="complete",f._emitGatheringStateChange())}};
a.setTimeout(()=>{k.forEach(a=>{const d=new Event("RTCIceGatherEvent");d.candidate=a;g.onlocalcandidate(d)})},0)}};c.prototype._createIceAndDtlsTransports=function(){const d=this,c=new a.RTCIceTransport(null);c.onicestatechange=function(){d._updateConnectionState()};const f=new a.RTCDtlsTransport(c);f.ondtlsstatechange=function(){d._updateConnectionState()};f.onerror=function(){Object.defineProperty(f,"state",{value:"failed",writable:!0});d._updateConnectionState()};return{iceTransport:c,dtlsTransport:f}};
c.prototype._disposeIceAndDtlsTransports=function(a){var {iceGatherer:d}=this.transceivers[a];d&&(delete d.onlocalcandidate,delete this.transceivers[a].iceGatherer);({iceTransport:d}=this.transceivers[a]);d&&(delete d.onicestatechange,delete this.transceivers[a].iceTransport);({dtlsTransport:d}=this.transceivers[a]);d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[a].dtlsTransport)};c.prototype._transceive=function(a,c,f){const g=m(a.localCapabilities,a.remoteCapabilities);
c&&a.rtpSender&&(g.encodings=a.sendEncodingParameters,g.rtcp={cname:p.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(g.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(g));f&&a.rtpReceiver&&0<g.codecs.length&&("video"===a.kind&&a.recvEncodingParameters&&15019>d&&a.recvEncodingParameters.forEach(a=>{delete a.rtx}),a.recvEncodingParameters.length&&(g.encodings=a.recvEncodingParameters),g.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&
(g.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(g.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(g))};c.prototype.setLocalDescription=function(a){const d=this;if(!n("setLocalDescription",a.type,this.signalingState)||this._isClosed)return Promise.reject(u("InvalidStateError",`Can not set local ${a.type} in state ${d.signalingState}`));let c,f;if("offer"===a.type)c=p.splitSections(a.sdp),f=c.shift(),c.forEach((a,c)=>{a=p.parseRtpParameters(a);d.transceivers[c].localCapabilities=
a}),this.transceivers.forEach((a,c)=>{d._gather(a.mid,c)});else if("answer"===a.type){c=p.splitSections(d.remoteDescription.sdp);f=c.shift();const a=0<p.matchPrefix(f,"a=ice-lite").length;c.forEach((c,g)=>{const k=d.transceivers[g],{iceGatherer:n}=k,{iceTransport:A}=k,{dtlsTransport:r}=k,{localCapabilities:D}=k,{remoteCapabilities:q}=k;if(!(p.isRejected(c)&&0===p.matchPrefix(c,"a=bundle-only").length||k.isDatachannel)){const u=p.getIceParameters(c,f);c=p.getDtlsParameters(c,f);a&&(c.role="server");
d.usingBundle&&0!==g||(d._gather(k.mid,g),"new"===A.state&&A.start(n,u,a?"controlling":"controlled"),"new"===r.state&&r.start(c));g=m(D,q);d._transceive(k,0<g.codecs.length,!1)}})}this.localDescription={type:a.type,sdp:a.sdp};switch(a.type){case "offer":this._updateSignalingState("have-local-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError(`unsupported type "${a.type}"`);}return Promise.resolve()};c.prototype.setRemoteDescription=function(c){const f=
this;if(!n("setRemoteDescription",c.type,this.signalingState)||this._isClosed)return Promise.reject(u("InvalidStateError",`Can not set remote ${c.type} in state ${f.signalingState}`));const g={};this.remoteStreams.forEach(a=>{g[a.id]=a});const k=[],m=p.splitSections(c.sdp),A=m.shift(),D=0<p.matchPrefix(A,"a=ice-lite").length,q=0<p.matchPrefix(A,"a=group:BUNDLE ").length;this.usingBundle=q;const F=p.matchPrefix(A,"a=ice-options:")[0];this.canTrickleIceCandidates=F?0<=F.substr(14).split(" ").indexOf("trickle"):
!1;m.forEach((m,n)=>{var u=p.splitLines(m),v=p.getKind(m),F=p.isRejected(m)&&0===p.matchPrefix(m,"a=bundle-only").length,G=u[0].substr(2).split(" ")[2];u=p.getDirection(m,A);const C=p.parseMsid(m);var B=p.getMid(m)||p.generateIdentifier();if("application"===v&&"DTLS/SCTP"===G)f.transceivers[n]={mid:B,isDatachannel:!0};else{var H=p.parseRtpParameters(m);if(!F){var K=p.getIceParameters(m,A);var I=p.getDtlsParameters(m,A);I.role="client"}G=p.parseRtpEncodingParameters(m);var N=p.parseRtcpParameters(m),
O=0<p.matchPrefix(m,"a=end-of-candidates",A).length,M=p.matchPrefix(m,"a=candidate:").map(a=>p.parseCandidate(a)).filter(a=>1===a.component);("offer"===c.type||"answer"===c.type)&&!F&&q&&0<n&&f.transceivers[n]&&(f._disposeIceAndDtlsTransports(n),f.transceivers[n].iceGatherer=f.transceivers[0].iceGatherer,f.transceivers[n].iceTransport=f.transceivers[0].iceTransport,f.transceivers[n].dtlsTransport=f.transceivers[0].dtlsTransport,f.transceivers[n].rtpSender&&f.transceivers[n].rtpSender.setTransport(f.transceivers[0].dtlsTransport),
f.transceivers[n].rtpReceiver&&f.transceivers[n].rtpReceiver.setTransport(f.transceivers[0].dtlsTransport));if("offer"!==c.type||F)"answer"!==c.type||F||(E=f.transceivers[n],L=E.iceGatherer,v=E.iceTransport,B=E.dtlsTransport,J=E.rtpReceiver,F=E.sendEncodingParameters,m=E.localCapabilities,f.transceivers[n].recvEncodingParameters=G,f.transceivers[n].remoteCapabilities=H,f.transceivers[n].rtcpParameters=N,M.length&&"new"===v.state&&(!D&&!O||q&&0!==n?M.forEach(a=>{r(E.iceTransport,a)}):v.setRemoteCandidates(M)),
q&&0!==n||("new"===v.state&&v.start(L,K,"controlling"),"new"===B.state&&B.start(I)),f._transceive(E,"sendrecv"===u||"recvonly"===u,"sendrecv"===u||"sendonly"===u),!J||"sendrecv"!==u&&"sendonly"!==u?delete E.rtpReceiver:(u=J.track,C?(g[C.stream]||(g[C.stream]=new a.MediaStream),t(u,g[C.stream]),k.push([u,J,g[C.stream]])):(g.default||(g.default=new a.MediaStream),t(u,g.default),k.push([u,J,g.default]))));else{var E=f.transceivers[n]||f._createTransceiver(v);E.mid=B;E.iceGatherer||(E.iceGatherer=f._createIceGatherer(n,
q));M.length&&"new"===E.iceTransport.state&&(!O||q&&0!==n?M.forEach(a=>{r(E.iceTransport,a)}):E.iceTransport.setRemoteCandidates(M));m=a.RTCRtpReceiver.getCapabilities(v);15019>d&&(m.codecs=m.codecs.filter(a=>"rtx"!==a.name));F=E.sendEncodingParameters||[{ssrc:1001*(2*n+2)}];K=!1;if("sendrecv"===u||"sendonly"===u){K=!E.rtpReceiver;var J=E.rtpReceiver||new a.RTCRtpReceiver(E.dtlsTransport,v);if(K){u=J.track;if(!C||"-"!==C.stream)if(C){g[C.stream]||(g[C.stream]=new a.MediaStream,Object.defineProperty(g[C.stream],
"id",{get(){return C.stream}}));Object.defineProperty(u,"id",{get(){return C.track}});var L=g[C.stream]}else g.default||(g.default=new a.MediaStream),L=g.default;L&&(t(u,L),E.associatedRemoteMediaStreams.push(L));k.push([u,J,L])}}else E.rtpReceiver&&E.rtpReceiver.track&&(E.associatedRemoteMediaStreams.forEach(a=>{const d=a.getTracks().find(a=>a.id===E.rtpReceiver.track.id);d&&z(d,a)}),E.associatedRemoteMediaStreams=[]);E.localCapabilities=m;E.remoteCapabilities=H;E.rtpReceiver=J;E.rtcpParameters=
N;E.sendEncodingParameters=F;E.recvEncodingParameters=G;f._transceive(f.transceivers[n],!1,K)}}});void 0===this._dtlsRole&&(this._dtlsRole="offer"===c.type?"active":"passive");this.remoteDescription={type:c.type,sdp:c.sdp};switch(c.type){case "offer":this._updateSignalingState("have-remote-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError(`unsupported type "${c.type}"`);}Object.keys(g).forEach(d=>{const c=g[d];if(c.getTracks().length){if(-1===f.remoteStreams.indexOf(c)){f.remoteStreams.push(c);
const d=new Event("addstream");d.stream=c;a.setTimeout(()=>{f._dispatchEvent("addstream",d)})}k.forEach(a=>{c.id===a[2].id&&v(f,a[0],a[1],[c])})}});k.forEach(a=>{a[2]||v(f,a[0],a[1],[])});a.setTimeout(()=>{f&&f.transceivers&&f.transceivers.forEach(a=>{a.iceTransport&&"new"===a.iceTransport.state&&0<a.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),a.iceTransport.addRemoteCandidate({}))})},4E3);return Promise.resolve()};
c.prototype.close=function(){this.transceivers.forEach(a=>{a.iceTransport&&a.iceTransport.stop();a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&a.rtpReceiver.stop()});this._isClosed=!0;this._updateSignalingState("closed")};c.prototype._updateSignalingState=function(a){this.signalingState=a;a=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",a)};c.prototype._maybeFireNegotiationNeeded=function(){const d=this;"stable"===this.signalingState&&
!0!==this.needNegotiation&&(this.needNegotiation=!0,a.setTimeout(()=>{if(!1!==d.needNegotiation){d.needNegotiation=!1;var a=new Event("negotiationneeded");d._dispatchEvent("negotiationneeded",a)}},0))};c.prototype._updateConnectionState=function(){const a={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(d=>{a[d.iceTransport.state]++;a[d.dtlsTransport.state]++});a.connected+=a.completed;var d="new";if(0<a.failed)d="failed";else if(0<
a.connecting||0<a.checking)d="connecting";else if(0<a.disconnected)d="disconnected";else if(0<a.new)d="new";else if(0<a.connected||0<a.completed)d="connected";d!==this.iceConnectionState&&(this.iceConnectionState=d,d=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",d))};c.prototype.createOffer=function(c){const f=this;if(this._isClosed)return Promise.reject(u("InvalidStateError","Can not call createOffer after close"));let k=this.transceivers.filter(a=>"audio"===
a.kind).length,m=this.transceivers.filter(a=>"video"===a.kind).length;if(c){if(c.mandatory||c.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==c.offerToReceiveAudio&&(k=!0===c.offerToReceiveAudio?1:!1===c.offerToReceiveAudio?0:c.offerToReceiveAudio);void 0!==c.offerToReceiveVideo&&(m=!0===c.offerToReceiveVideo?1:!1===c.offerToReceiveVideo?0:c.offerToReceiveVideo)}for(this.transceivers.forEach(a=>{"audio"===a.kind?(k--,0>k&&(a.wantReceive=!1)):"video"===
a.kind&&(m--,0>m&&(a.wantReceive=!1))});0<k||0<m;)0<k&&(this._createTransceiver("audio"),k--),0<m&&(this._createTransceiver("video"),m--);let n=p.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.transceivers.forEach((c,g)=>{const {track:k}=c,{kind:m}=c;var n=p.generateIdentifier();c.mid=n;c.iceGatherer||(c.iceGatherer=f._createIceGatherer(g,f.usingBundle));n=a.RTCRtpSender.getCapabilities(m);15019>d&&(n.codecs=n.codecs.filter(a=>"rtx"!==a.name));n.codecs.forEach(a=>{"H264"===
a.name&&void 0===a.parameters["level-asymmetry-allowed"]&&(a.parameters["level-asymmetry-allowed"]="1")});g=c.sendEncodingParameters||[{ssrc:1001*(2*g+1)}];k&&15019<=d&&"video"===m&&!g[0].rtx&&(g[0].rtx={ssrc:g[0].ssrc+1});c.wantReceive&&(c.rtpReceiver=new a.RTCRtpReceiver(c.dtlsTransport,m));c.localCapabilities=n;c.sendEncodingParameters=g});"max-compat"!==this._config.bundlePolicy&&(n+=`a=group:BUNDLE ${this.transceivers.map(a=>a.mid).join(" ")}\r\n`);n+="a=ice-options:trickle\r\n";this.transceivers.forEach((a,
d)=>{n+=g(a,a.localCapabilities,"offer",a.stream,f._dtlsRole);n+="a=rtcp-rsize\r\n";!a.iceGatherer||"new"===f.iceGatheringState||0!==d&&f.usingBundle||(a.iceGatherer.getLocalCandidates().forEach(a=>{a.component=1;n+=`a=${p.writeCandidate(a)}\r\n`}),"completed"===a.iceGatherer.state&&(n+="a=end-of-candidates\r\n"))});c=new a.RTCSessionDescription({type:"offer",sdp:n});return Promise.resolve(c)};c.prototype.createAnswer=function(){const c=this;if(this._isClosed)return Promise.reject(u("InvalidStateError",
"Can not call createAnswer after close"));let f=p.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.usingBundle&&(f+=`a=group:BUNDLE ${this.transceivers.map(a=>a.mid).join(" ")}\r\n`);const k=p.splitSections(this.remoteDescription.sdp).length-1;this.transceivers.forEach((a,n)=>{if(!(n+1>k))if(a.isDatachannel)f+=`${"m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"}${a.mid}\r\n`;else{if(a.stream){let c;"audio"===a.kind?c=a.stream.getAudioTracks()[0]:"video"===a.kind&&
(c=a.stream.getVideoTracks()[0]);c&&15019<=d&&"video"===a.kind&&!a.sendEncodingParameters[0].rtx&&(a.sendEncodingParameters[0].rtx={ssrc:a.sendEncodingParameters[0].ssrc+1})}n=m(a.localCapabilities,a.remoteCapabilities);!n.codecs.filter(a=>"rtx"===a.name.toLowerCase()).length&&a.sendEncodingParameters[0].rtx&&delete a.sendEncodingParameters[0].rtx;f+=g(a,n,"answer",a.stream,c._dtlsRole);a.rtcpParameters&&a.rtcpParameters.reducedSize&&(f+="a=rtcp-rsize\r\n")}});const n=new a.RTCSessionDescription({type:"answer",
sdp:f});return Promise.resolve(n)};c.prototype.addIceCandidate=function(a){if(a&&""!==a.candidate)if(void 0!==a.sdpMLineIndex||a.sdpMid)if(this.remoteDescription){var {sdpMLineIndex:d}=a;if(a.sdpMid)for(var c=0;c<this.transceivers.length;c++)if(this.transceivers[c].mid===a.sdpMid){d=c;break}var f=this.transceivers[d];if(f){if(f.isDatachannel)return Promise.resolve();c=0<Object.keys(a.candidate).length?p.parseCandidate(a.candidate):{};if("tcp"===c.protocol&&(0===c.port||9===c.port)||c.component&&1!==
c.component)return Promise.resolve();if((0===d||0<d&&f.iceTransport!==this.transceivers[0].iceTransport)&&!r(f.iceTransport,c))return Promise.reject(u("OperationError","Can not add ICE candidate"));f=a.candidate.trim();0===f.indexOf("a=")&&(f=f.substr(2));a=p.splitSections(this.remoteDescription.sdp);a[d+1]+=`a=${c.type?f:"end-of-candidates"}\r\n`;this.remoteDescription.sdp=a.join("")}else return Promise.reject(u("OperationError","Can not add ICE candidate"))}else return Promise.reject(u("InvalidStateError",
"Can not add ICE candidate without a remote description"));else throw new TypeError("sdpMLineIndex or sdpMid required");else for(d=0;d<this.transceivers.length&&(this.transceivers[d].isDatachannel||(this.transceivers[d].iceTransport.addRemoteCandidate({}),a=p.splitSections(this.remoteDescription.sdp),a[d+1]+="a=end-of-candidates\r\n",this.remoteDescription.sdp=a.join(""),!this.usingBundle));d++);return Promise.resolve()};c.prototype.getStats=function(){const a=[];this.transceivers.forEach(d=>{["rtpSender",
"rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(c=>{d[c]&&a.push(d[c].getStats())})});return new Promise(d=>{const c=new Map;Promise.all(a).then(a=>{a.forEach(a=>{Object.keys(a).forEach(d=>{var f=a[d];a[d].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type;c.set(d,a[d])})});d(c)})})};let f=["createOffer","createAnswer"];f.forEach(a=>{const d=c.prototype[a];
c.prototype[a]=function(){const a=arguments;return"function"===typeof a[0]||"function"===typeof a[1]?d.apply(this,[arguments[2]]).then(d=>{"function"===typeof a[0]&&a[0].apply(null,[d])},d=>{"function"===typeof a[1]&&a[1].apply(null,[d])}):d.apply(this,arguments)}});f=["setLocalDescription","setRemoteDescription","addIceCandidate"];f.forEach(a=>{const d=c.prototype[a];c.prototype[a]=function(){const a=arguments;return"function"===typeof a[1]||"function"===typeof a[2]?d.apply(this,arguments).then(()=>
{"function"===typeof a[1]&&a[1].apply(null)},d=>{"function"===typeof a[2]&&a[2].apply(null,[d])}):d.apply(this,arguments)}});["getStats"].forEach(a=>{const d=c.prototype[a];c.prototype[a]=function(){const a=arguments;return"function"===typeof a[1]?d.apply(this,arguments).then(()=>{"function"===typeof a[1]&&a[1].apply(null)}):d.apply(this,arguments)}});return c}},{sdp:2}],2:[function(a,d,c){const f={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};f.localCName=f.generateIdentifier();
f.splitLines=function(a){return a.trim().split("\n").map(a=>a.trim())};f.splitSections=function(a){return a.split("\nm=").map((a,d)=>`${(0<d?`m=${a}`:a).trim()}\r\n`)};f.matchPrefix=function(a,d){return f.splitLines(a).filter(a=>0===a.indexOf(d))};f.parseCandidate=function(a){a=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");const d={foundation:a[0],component:parseInt(a[1],10),protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],port:parseInt(a[5],10),
type:a[7]};for(let c=8;c<a.length;c+=2)switch(a[c]){case "raddr":d.relatedAddress=a[c+1];break;case "rport":d.relatedPort=parseInt(a[c+1],10);break;case "tcptype":d.tcpType=a[c+1];break;case "ufrag":d.ufrag=a[c+1];d.usernameFragment=a[c+1];break;default:d[a[c]]=a[c+1]}return d};f.writeCandidate=function(a){const d=[];d.push(a.foundation);d.push(a.component);d.push(a.protocol.toUpperCase());d.push(a.priority);d.push(a.ip);d.push(a.port);const {type:c}=a;d.push("typ");d.push(c);"host"!==c&&a.relatedAddress&&
a.relatedPort&&(d.push("raddr"),d.push(a.relatedAddress),d.push("rport"),d.push(a.relatedPort));a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(d.push("tcptype"),d.push(a.tcpType));a.ufrag&&(d.push("ufrag"),d.push(a.ufrag));return`candidate:${d.join(" ")}`};f.parseIceOptions=function(a){return a.substr(14).split(" ")};f.parseRtpMap=function(a){a=a.substr(9).split(" ");const d={payloadType:parseInt(a.shift(),10)};a=a[0].split("/");d.name=a[0];d.clockRate=parseInt(a[1],10);d.numChannels=3===a.length?
parseInt(a[2],10):1;return d};f.writeRtpMap=function(a){let d=a.payloadType;void 0!==a.preferredPayloadType&&(d=a.preferredPayloadType);return`a=rtpmap:${d} ${a.name}/${a.clockRate}${1!==a.numChannels?`/${a.numChannels}`:""}\r\n`};f.parseExtmap=function(a){a=a.substr(9).split(" ");return{id:parseInt(a[0],10),direction:0<a[0].indexOf("/")?a[0].split("/")[1]:"sendrecv",uri:a[1]}};f.writeExtmap=function(a){return`a=extmap:${a.id||a.preferredId}${a.direction&&"sendrecv"!==a.direction?`/${a.direction}`:
""} ${a.uri}\r\n`};f.parseFmtp=function(a){const d={},c=a.substr(a.indexOf(" ")+1).split(";");for(let f=0;f<c.length;f++)a=c[f].trim().split("="),d[a[0].trim()]=a[1];return d};f.writeFmtp=function(a){let d="",c=a.payloadType;void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType);if(a.parameters&&Object.keys(a.parameters).length){const f=[];Object.keys(a.parameters).forEach(d=>{f.push(`${d}=${a.parameters[d]}`)});d+=`a=fmtp:${c} ${f.join(";")}\r\n`}return d};f.parseRtcpFb=function(a){a=a.substr(a.indexOf(" ")+
1).split(" ");return{type:a.shift(),parameter:a.join(" ")}};f.writeRtcpFb=function(a){let d="",c=a.payloadType;void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType);a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(a=>{d+=`a=rtcp-fb:${c} ${a.type}${a.parameter&&a.parameter.length?` ${a.parameter}`:""}\r\n`});return d};f.parseSsrcMedia=function(a){const d=a.indexOf(" "),c={ssrc:parseInt(a.substr(7,d-7),10)},f=a.indexOf(":",d);-1<f?(c.attribute=a.substr(d+1,f-d-1),c.value=a.substr(f+
1)):c.attribute=a.substr(d+1);return c};f.getMid=function(a){if(a=f.matchPrefix(a,"a=mid:")[0])return a.substr(6)};f.parseFingerprint=function(a){a=a.substr(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1]}};f.getDtlsParameters=function(a,d){return{role:"auto",fingerprints:f.matchPrefix(a+d,"a=fingerprint:").map(f.parseFingerprint)}};f.writeDtlsParameters=function(a,d){let c=`a=setup:${d}\r\n`;a.fingerprints.forEach(a=>{c+=`a=fingerprint:${a.algorithm} ${a.value}\r\n`});return c};f.getIceParameters=
function(a,d){a=f.splitLines(a);a=a.concat(f.splitLines(d));return{usernameFragment:a.filter(a=>0===a.indexOf("a=ice-ufrag:"))[0].substr(12),password:a.filter(a=>0===a.indexOf("a=ice-pwd:"))[0].substr(10)}};f.writeIceParameters=function(a){return`a=ice-ufrag:${a.usernameFragment}\r\n`+`a=ice-pwd:${a.password}\r\n`};f.parseRtpParameters=function(a){const d={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=f.splitLines(a)[0].split(" ");for(let k=3;k<c.length;k++){const m=c[k];var g=f.matchPrefix(a,
`a=rtpmap:${m} `)[0];if(g){g=f.parseRtpMap(g);const c=f.matchPrefix(a,`a=fmtp:${m} `);g.parameters=c.length?f.parseFmtp(c[0]):{};g.rtcpFeedback=f.matchPrefix(a,`a=rtcp-fb:${m} `).map(f.parseRtcpFb);d.codecs.push(g);switch(g.name.toUpperCase()){case "RED":case "ULPFEC":d.fecMechanisms.push(g.name.toUpperCase())}}}f.matchPrefix(a,"a=extmap:").forEach(a=>{d.headerExtensions.push(f.parseExtmap(a))});return d};f.writeRtpDescription=function(a,d){let c="";c+=`m=${a} `;c+=0<d.codecs.length?"9":"0";c+=" UDP/TLS/RTP/SAVPF ";
c+=`${d.codecs.map(a=>void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType).join(" ")}\r\n`;c+="c=IN IP4 0.0.0.0\r\n";c+="a=rtcp:9 IN IP4 0.0.0.0\r\n";d.codecs.forEach(a=>{c+=f.writeRtpMap(a);c+=f.writeFmtp(a);c+=f.writeRtcpFb(a)});let g=0;d.codecs.forEach(a=>{a.maxptime>g&&(g=a.maxptime)});0<g&&(c+=`a=maxptime:${g}\r\n`);c+="a=rtcp-mux\r\n";d.headerExtensions.forEach(a=>{c+=f.writeExtmap(a)});return c};f.parseRtpEncodingParameters=function(a){const d=[],c=f.parseRtpParameters(a),
g=-1!==c.fecMechanisms.indexOf("RED"),k=-1!==c.fecMechanisms.indexOf("ULPFEC");var z=f.matchPrefix(a,"a=ssrc:").map(a=>f.parseSsrcMedia(a)).filter(a=>"cname"===a.attribute);const v=0<z.length&&z[0].ssrc;let u;z=f.matchPrefix(a,"a=ssrc-group:FID").map(a=>{a=a.split(" ");a.shift();return a.map(a=>parseInt(a,10))});0<z.length&&1<z[0].length&&z[0][0]===v&&(u=z[0][1]);c.codecs.forEach(a=>{"RTX"===a.name.toUpperCase()&&a.parameters.apt&&(a={ssrc:v,codecPayloadType:parseInt(a.parameters.apt,10),rtx:{ssrc:u}},
d.push(a),g&&(a=JSON.parse(JSON.stringify(a)),a.fec={ssrc:u,mechanism:k?"red+ulpfec":"red"},d.push(a)))});0===d.length&&v&&d.push({ssrc:v});let p=f.matchPrefix(a,"b=");p.length&&(p=0===p[0].indexOf("b=TIAS:")?parseInt(p[0].substr(7),10):0===p[0].indexOf("b=AS:")?950*parseInt(p[0].substr(5),10)-16E3:void 0,d.forEach(a=>{a.maxBitrate=p}));return d};f.parseRtcpParameters=function(a){const d={};var c=f.matchPrefix(a,"a=ssrc:").map(a=>f.parseSsrcMedia(a)).filter(a=>"cname"===a.attribute)[0];c&&(d.cname=
c.value,d.ssrc=c.ssrc);c=f.matchPrefix(a,"a=rtcp-rsize");d.reducedSize=0<c.length;d.compound=0===c.length;a=f.matchPrefix(a,"a=rtcp-mux");d.mux=0<a.length;return d};f.parseMsid=function(a){const d=f.matchPrefix(a,"a=msid:");if(1===d.length)return a=d[0].substr(7).split(" "),{stream:a[0],track:a[1]};a=f.matchPrefix(a,"a=ssrc:").map(a=>f.parseSsrcMedia(a)).filter(a=>"msid"===a.attribute);if(0<a.length)return a=a[0].value.split(" "),{stream:a[0],track:a[1]}};f.generateSessionId=function(){return Math.random().toString().substr(2,
21)};f.writeSessionBoilerplate=function(a,d){d=void 0!==d?d:2;return`${"v=0\r\no=thisisadapterortc "}${a?a:f.generateSessionId()} ${d} IN IP4 127.0.0.1\r\n`+"s=-\r\nt=0 0\r\n"};f.writeMediaSection=function(a,d,c,g){d=f.writeRtpDescription(a.kind,d);d+=f.writeIceParameters(a.iceGatherer.getLocalParameters());d+=f.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":"active");d+=`a=mid:${a.mid}\r\n`;d=a.direction?d+`a=${a.direction}\r\n`:a.rtpSender&&a.rtpReceiver?d+"a=sendrecv\r\n":
a.rtpSender?d+"a=sendonly\r\n":a.rtpReceiver?d+"a=recvonly\r\n":d+"a=inactive\r\n";a.rtpSender&&(c=`msid:${g.id} ${a.rtpSender.track.id}\r\n`,d+=`a=${c}`,d+=`a=ssrc:${a.sendEncodingParameters[0].ssrc} ${c}`,a.sendEncodingParameters[0].rtx&&(d+=`a=ssrc:${a.sendEncodingParameters[0].rtx.ssrc} ${c}`,d+=`a=ssrc-group:FID ${a.sendEncodingParameters[0].ssrc} ${a.sendEncodingParameters[0].rtx.ssrc}\r\n`));d+=`a=ssrc:${a.sendEncodingParameters[0].ssrc} cname:${f.localCName}\r\n`;a.rtpSender&&a.sendEncodingParameters[0].rtx&&
(d+=`a=ssrc:${a.sendEncodingParameters[0].rtx.ssrc} cname:${f.localCName}\r\n`);return d};f.getDirection=function(a,d){a=f.splitLines(a);for(let d=0;d<a.length;d++)switch(a[d]){case "a=sendrecv":case "a=sendonly":case "a=recvonly":case "a=inactive":return a[d].substr(2)}return d?f.getDirection(d):"sendrecv"};f.getKind=function(a){return f.splitLines(a)[0].split(" ")[0].substr(2)};f.isRejected=function(a){return"0"===a.split(" ",2)[1]};f.parseMLine=function(a){a=f.splitLines(a)[0].split(" ");return{kind:a[0].substr(2),
port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}};"object"===typeof d&&(d.exports=f)},{}],3:[function(a,d,f){f="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof c?c:{};a=a("./adapter_factory.js");d.exports=a({window:f.window})},{"./adapter_factory.js":4}],4:[function(a,d,c){const f=a("./utils");d.exports=function(d,c){d=d&&d.window;const g={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var k in c)hasOwnProperty.call(c,k)&&(g[k]=c[k]);
c=f.log;k=f.detectBrowser(d);const m=a("./chrome/chrome_shim")||null,z=a("./edge/edge_shim")||null,v=a("./firefox/firefox_shim")||null,u=a("./safari/safari_shim")||null,p=a("./common_shim")||null,q={browserDetails:k,commonShim:p,extractVersion:f.extractVersion,disableLog:f.disableLog,disableWarnings:f.disableWarnings};switch(k.browser){case "chrome":if(!m||!m.shimPeerConnection||!g.shimChrome){c("Chrome shim is not included in this adapter release.");break}c("adapter.js shimming chrome.");q.browserShim=
m;p.shimCreateObjectURL(d);m.shimGetUserMedia(d);m.shimMediaStream(d);m.shimSourceObject(d);m.shimPeerConnection(d);m.shimOnTrack(d);m.shimAddTrackRemoveTrack(d);m.shimGetSendersWithDtmf(d);p.shimRTCIceCandidate(d);p.shimMaxMessageSize(d);p.shimSendThrowTypeError(d);break;case "firefox":if(!v||!v.shimPeerConnection||!g.shimFirefox){c("Firefox shim is not included in this adapter release.");break}c("adapter.js shimming firefox.");q.browserShim=v;p.shimCreateObjectURL(d);v.shimGetUserMedia(d);v.shimSourceObject(d);
v.shimPeerConnection(d);v.shimOnTrack(d);v.shimRemoveStream(d);p.shimRTCIceCandidate(d);p.shimMaxMessageSize(d);p.shimSendThrowTypeError(d);break;case "edge":if(!z||!z.shimPeerConnection||!g.shimEdge){c("MS edge shim is not included in this adapter release.");break}c("adapter.js shimming edge.");q.browserShim=z;p.shimCreateObjectURL(d);z.shimGetUserMedia(d);z.shimPeerConnection(d);z.shimReplaceTrack(d);p.shimMaxMessageSize(d);p.shimSendThrowTypeError(d);break;case "safari":if(!u||!g.shimSafari){c("Safari shim is not included in this adapter release.");
break}c("adapter.js shimming safari.");q.browserShim=u;p.shimCreateObjectURL(d);u.shimRTCIceServerUrls(d);u.shimCallbacksAPI(d);u.shimLocalStreamsAPI(d);u.shimRemoteStreamsAPI(d);u.shimTrackEventTransceiver(d);u.shimGetUserMedia(d);u.shimCreateOfferLegacy(d);p.shimRTCIceCandidate(d);p.shimMaxMessageSize(d);p.shimSendThrowTypeError(d);break;default:c("Unsupported browser!")}return q}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":10,"./safari/safari_shim":12,
"./utils":13}],5:[function(a,d,c){const f=a("../utils.js"),k=f.log;d.exports={shimGetUserMedia:a("./getusermedia"),shimMediaStream(a){a.MediaStream=a.MediaStream||a.webkitMediaStream},shimOnTrack(a){if("object"!==typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)"RTCRtpTransceiver"in a||f.wrapPeerConnectionEvent(a,"track",a=>{a.transceiver||(a.transceiver={receiver:a.receiver});return a});else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},
set(a){this._ontrack&&this.removeEventListener("track",this._ontrack);this.addEventListener("track",this._ontrack=a)}});const d=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){const c=this;c._ontrackpoly||(c._ontrackpoly=function(d){d.stream.addEventListener("addtrack",f=>{let g;g=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(a=>a.track&&a.track.id===f.track.id):{track:f.track};const k=new Event("track");k.track=f.track;
k.receiver=g;k.transceiver={receiver:g};k.streams=[d.stream];c.dispatchEvent(k)});d.stream.getTracks().forEach(f=>{let g;g=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(a=>a.track&&a.track.id===f.id):{track:f};const k=new Event("track");k.track=f;k.receiver=g;k.transceiver={receiver:g};k.streams=[d.stream];c.dispatchEvent(k)})},c.addEventListener("addstream",c._ontrackpoly));return d.apply(c,arguments)}}},shimGetSendersWithDtmf(a){if("object"===typeof a&&a.RTCPeerConnection&&!("getSenders"in
a.RTCPeerConnection.prototype)&&"createDTMFSender"in a.RTCPeerConnection.prototype){const d=function(a,d){return{track:d,get dtmf(){void 0===this._dtmf&&(this._dtmf="audio"===d.kind?a.createDTMFSender(d):null);return this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};const c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,f){let g=
c.apply(this,arguments);g||(g=d(this,a),this._senders.push(g));return g};const f=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){f.apply(this,arguments);const d=this._senders.indexOf(a);-1!==d&&this._senders.splice(d,1)}}const c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){const f=this;f._senders=f._senders||[];c.apply(f,[a]);a.getTracks().forEach(a=>{f._senders.push(d(f,a))})};const f=a.RTCPeerConnection.prototype.removeStream;
a.RTCPeerConnection.prototype.removeStream=function(a){const d=this;d._senders=d._senders||[];f.apply(d,[a]);a.getTracks().forEach(a=>{const c=d._senders.find(d=>d.track===a);c&&d._senders.splice(d._senders.indexOf(c),1)})}}else if("object"===typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){const d=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=
function(){const a=this,c=d.apply(a,[]);c.forEach(d=>{d._pc=a});return c};Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get(){void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null);return this._dtmf}})}},shimSourceObject(a){const d=a&&a.URL;"object"===typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get(){return this._srcObject},set(a){const c=this;this._srcObject=
a;this.src&&d.revokeObjectURL(this.src);a?(this.src=d.createObjectURL(a),a.addEventListener("addtrack",()=>{c.src&&d.revokeObjectURL(c.src);c.src=d.createObjectURL(a)}),a.addEventListener("removetrack",()=>{c.src&&d.revokeObjectURL(c.src);c.src=d.createObjectURL(a)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){const a=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};return Object.keys(this._shimmedLocalStreams).map(d=>
a._shimmedLocalStreams[d][0])};const d=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return d.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=d.apply(this,arguments);this._shimmedLocalStreams[c.id]?-1===this._shimmedLocalStreams[c.id].indexOf(f)&&this._shimmedLocalStreams[c.id].push(f):this._shimmedLocalStreams[c.id]=[c,f];return f};const c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=
function(a){const d=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};a.getTracks().forEach(a=>{if(d.getSenders().find(d=>d.track===a))throw new DOMException("Track already exists.","InvalidAccessError");});const f=d.getSenders();c.apply(this,arguments);const g=d.getSenders().filter(a=>-1===f.indexOf(a));this._shimmedLocalStreams[a.id]=[a].concat(g)};const f=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||
{};delete this._shimmedLocalStreams[a.id];return f.apply(this,arguments)};const g=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){const d=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};a&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const f=d._shimmedLocalStreams[c].indexOf(a);-1!==f&&d._shimmedLocalStreams[c].splice(f,1);1===d._shimmedLocalStreams[c].length&&delete d._shimmedLocalStreams[c]});return g.apply(this,arguments)}},shimAddTrackRemoveTrack(a){function d(a,
d){let {sdp:c}=d;Object.keys(a._reverseStreams||[]).forEach(d=>{d=a._reverseStreams[d];c=c.replace(new RegExp(a._streams[d.id].id,"g"),d.id)});return new RTCSessionDescription({type:d.type,sdp:c})}function c(a,d){let {sdp:c}=d;Object.keys(a._reverseStreams||[]).forEach(d=>{d=a._reverseStreams[d];c=c.replace(new RegExp(d.id,"g"),a._streams[d.id].id)});return new RTCSessionDescription({type:d.type,sdp:c})}const g=f.detectBrowser(a);if(a.RTCPeerConnection.prototype.addTrack&&65<=g.version)return this.shimAddTrackRemoveTrackWithNative(a);
const k=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){const a=this,d=k.apply(this);a._reverseStreams=a._reverseStreams||{};return d.map(d=>a._reverseStreams[d.id])};const m=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(d){const c=this;c._streams=c._streams||{};c._reverseStreams=c._reverseStreams||{};d.getTracks().forEach(a=>{if(c.getSenders().find(d=>d.track===a))throw new DOMException("Track already exists.",
"InvalidAccessError");});if(!c._reverseStreams[d.id]){const f=new a.MediaStream(d.getTracks());c._streams[d.id]=f;c._reverseStreams[f.id]=d;d=f}m.apply(c,[d])};const u=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};u.apply(this,[this._streams[a.id]||a]);delete this._reverseStreams[this._streams[a.id]?this._streams[a.id].id:a.id];delete this._streams[a.id]};a.RTCPeerConnection.prototype.addTrack=
function(d,c){const f=this;if("closed"===f.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var g=[].slice.call(arguments,1);if(1!==g.length||!g[0].getTracks().find(a=>a===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(f.getSenders().find(a=>a.track===d))throw new DOMException("Track already exists.","InvalidAccessError");
f._streams=f._streams||{};f._reverseStreams=f._reverseStreams||{};(g=f._streams[c.id])?(g.addTrack(d),Promise.resolve().then(()=>{f.dispatchEvent(new Event("negotiationneeded"))})):(g=new a.MediaStream([d]),f._streams[c.id]=g,f._reverseStreams[g.id]=c,f.addStream(g));return f.getSenders().find(a=>a.track===d)};["createOffer","createAnswer"].forEach(c=>{const f=a.RTCPeerConnection.prototype[c];a.RTCPeerConnection.prototype[c]=function(){const a=this,c=arguments;return arguments.length&&"function"===
typeof arguments[0]?f.apply(a,[function(f){f=d(a,f);c[0].apply(null,[f])},function(a){c[1]&&c[1].apply(null,a)},arguments[2]]):f.apply(a,arguments).then(c=>d(a,c))}});const p=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){if(!arguments.length||!arguments[0].type)return p.apply(this,arguments);arguments[0]=c(this,arguments[0]);return p.apply(this,arguments)};const q=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");
Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get(){const a=q.get.apply(this);return""===a.type?a:d(this,a)}});a.RTCPeerConnection.prototype.removeTrack=function(a){const d=this;if("closed"===d.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(a._pc!==d)throw new DOMException("Sender was not created by this connection.",
"InvalidAccessError");d._streams=d._streams||{};let c;Object.keys(d._streams).forEach(f=>{d._streams[f].getTracks().find(d=>a.track===d)&&(c=d._streams[f])});c&&(1===c.getTracks().length?d.removeStream(d._reverseStreams[c.id]):c.removeTrack(a.track),d.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection(a){const d=f.detectBrowser(a);if(!a.RTCPeerConnection&&a.webkitRTCPeerConnection)a.RTCPeerConnection=function(d,c){k("PeerConnection");d&&d.iceTransportPolicy&&(d.iceTransports=d.iceTransportPolicy);
return new a.webkitRTCPeerConnection(d,c)},a.RTCPeerConnection.prototype=a.webkitRTCPeerConnection.prototype,a.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get(){return a.webkitRTCPeerConnection.generateCertificate}});else{const d=a.RTCPeerConnection;a.RTCPeerConnection=function(a,c){if(a&&a.iceServers){const d=[];for(let c=0;c<a.iceServers.length;c++){let g=a.iceServers[c];!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(f.deprecated("RTCIceServer.url",
"RTCIceServer.urls"),g=JSON.parse(JSON.stringify(g)),g.urls=g.url,d.push(g)):d.push(a.iceServers[c])}a.iceServers=d}return new d(a,c)};a.RTCPeerConnection.prototype=d.prototype;Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get(){return d.generateCertificate}})}const c=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,d,f){const g=this,k=arguments;if(0<arguments.length&&"function"===typeof a)return c.apply(this,arguments);if(0===c.length&&(0===
arguments.length||"function"!==typeof arguments[0]))return c.apply(this,[]);const m=function(a){const d={};a.result().forEach(a=>{const c={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(d=>{c[d]=a.stat(d)});d[c.id]=c});return d},n=function(a){return new Map(Object.keys(a).map(d=>[d,a[d]]))};return 2<=arguments.length?c.apply(this,[function(a){k[1](n(m(a)))},arguments[0]]):(new Promise((a,d)=>{c.apply(g,[function(d){a(n(m(d)))},
d])})).then(d,f)};51>d.version&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(d=>{const c=a.RTCPeerConnection.prototype[d];a.RTCPeerConnection.prototype[d]=function(){const a=arguments,d=this,f=new Promise((f,g)=>{c.apply(d,[a[0],f,g])});return 2>a.length?f:f.then(()=>{a[1].apply(null,[])},d=>{3<=a.length&&a[2].apply(null,[d])})}});52>d.version&&["createOffer","createAnswer"].forEach(d=>{const c=a.RTCPeerConnection.prototype[d];a.RTCPeerConnection.prototype[d]=function(){const a=
this;if(1>arguments.length||1===arguments.length&&"object"===typeof arguments[0]){const d=1===arguments.length?arguments[0]:void 0;return new Promise((f,g)=>{c.apply(a,[f,g,d])})}return c.apply(this,arguments)}});["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(d=>{const c=a.RTCPeerConnection.prototype[d];a.RTCPeerConnection.prototype[d]=function(){arguments[0]=new ("addIceCandidate"===d?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]);return c.apply(this,arguments)}});
const g=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?g.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}},{"../utils.js":13,"./getusermedia":6}],6:[function(a,d,c){const f=a("../utils.js"),k=f.log;d.exports=function(a){const d=f.detectBrowser(a),c=a&&a.navigator,g=function(a){if("object"!==typeof a||a.mandatory||a.optional)return a;const d={};Object.keys(a).forEach(c=>{if("require"!==c&&
"advanced"!==c&&"mediaSource"!==c){var f="object"===typeof a[c]?a[c]:{ideal:a[c]};void 0!==f.exact&&"number"===typeof f.exact&&(f.min=f.max=f.exact);var g=function(a,d){return a?a+d.charAt(0).toUpperCase()+d.slice(1):"deviceId"===d?"sourceId":d};if(void 0!==f.ideal){d.optional=d.optional||[];let a={};"number"===typeof f.ideal?(a[g("min",c)]=f.ideal,d.optional.push(a),a={},a[g("max",c)]=f.ideal):a[g("",c)]=f.ideal;d.optional.push(a)}void 0!==f.exact&&"number"!==typeof f.exact?(d.mandatory=d.mandatory||
{},d.mandatory[g("",c)]=f.exact):["min","max"].forEach(a=>{void 0!==f[a]&&(d.mandatory=d.mandatory||{},d.mandatory[g(a,c)]=f[a])})}});a.advanced&&(d.optional=(d.optional||[]).concat(a.advanced));return d},m=function(a,f){if(61<=d.version)return f(a);if((a=JSON.parse(JSON.stringify(a)))&&"object"===typeof a.audio){var m=function(a,d,c){d in a&&!(c in a)&&(a[c]=a[d],delete a[d])};a=JSON.parse(JSON.stringify(a));m(a.audio,"autoGainControl","googAutoGainControl");m(a.audio,"noiseSuppression","googNoiseSuppression");
a.audio=g(a.audio)}if(a&&"object"===typeof a.video){let n=a.video.facingMode;n=n&&("object"===typeof n?n:{ideal:n});m=66>d.version;if(!(!n||"user"!==n.exact&&"environment"!==n.exact&&"user"!==n.ideal&&"environment"!==n.ideal||c.mediaDevices.getSupportedConstraints&&c.mediaDevices.getSupportedConstraints().facingMode&&!m)){delete a.video.facingMode;let d;if("environment"===n.exact||"environment"===n.ideal)d=["back","rear"];else if("user"===n.exact||"user"===n.ideal)d=["front"];if(d)return c.mediaDevices.enumerateDevices().then(c=>
{c=c.filter(a=>"videoinput"===a.kind);let m=c.find(a=>d.some(d=>-1!==a.label.toLowerCase().indexOf(d)));!m&&c.length&&-1!==d.indexOf("back")&&(m=c[c.length-1]);m&&(a.video.deviceId=n.exact?{exact:m.deviceId}:{ideal:m.deviceId});a.video=g(a.video);k(`chrome: ${JSON.stringify(a)}`);return f(a)})}a.video=g(a.video)}k(`chrome: ${JSON.stringify(a)}`);return f(a)},v=function(a){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",
ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[a.name]||a.name,message:a.message,constraint:a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};c.getUserMedia=function(a,d,f){m(a,a=>{c.webkitGetUserMedia(a,d,a=>{f&&f(v(a))})})};const u=function(a){return new Promise((d,f)=>{c.getUserMedia(a,d,f)})};c.mediaDevices||(c.mediaDevices={getUserMedia:u,
enumerateDevices(){return new Promise(d=>{const c={audio:"audioinput",video:"videoinput"};return a.MediaStreamTrack.getSources(a=>{d(a.map(a=>({label:a.label,kind:c[a.kind],deviceId:a.id,groupId:""})))})})},getSupportedConstraints(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}});if(c.mediaDevices.getUserMedia){const a=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(d){return m(d,d=>a(d).then(a=>{if(d.audio&&!a.getAudioTracks().length||
d.video&&!a.getVideoTracks().length)throw a.getTracks().forEach(a=>{a.stop()}),new DOMException("","NotFoundError");return a},a=>Promise.reject(v(a))))}}else c.mediaDevices.getUserMedia=function(a){return u(a)};"undefined"===typeof c.mediaDevices.addEventListener&&(c.mediaDevices.addEventListener=function(){k("Dummy mediaDevices.addEventListener called.")});"undefined"===typeof c.mediaDevices.removeEventListener&&(c.mediaDevices.removeEventListener=function(){k("Dummy mediaDevices.removeEventListener called.")})}},
{"../utils.js":13}],7:[function(a,d,c){const f=a("sdp"),k=a("./utils");d.exports={shimRTCIceCandidate(a){if(!(a.RTCIceCandidate&&"foundation"in a.RTCIceCandidate.prototype)){var d=a.RTCIceCandidate;a.RTCIceCandidate=function(a){"object"===typeof a&&a.candidate&&0===a.candidate.indexOf("a=")&&(a=JSON.parse(JSON.stringify(a)),a.candidate=a.candidate.substr(2));const c=new d(a);a=f.parseCandidate(a.candidate);const g=Object.assign(c,a);g.toJSON=function(){return{candidate:g.candidate,sdpMid:g.sdpMid,
sdpMLineIndex:g.sdpMLineIndex,usernameFragment:g.usernameFragment}};return g};k.wrapPeerConnectionEvent(a,"icecandidate",d=>{d.candidate&&Object.defineProperty(d,"candidate",{value:new a.RTCIceCandidate(d.candidate),writable:"false"});return d})}},shimCreateObjectURL(a){const d=a&&a.URL;if("object"===typeof a&&a.HTMLMediaElement&&"srcObject"in a.HTMLMediaElement.prototype&&d.createObjectURL&&d.revokeObjectURL){var c=d.createObjectURL.bind(d),f=d.revokeObjectURL.bind(d),g=new Map,m=0;d.createObjectURL=
function(a){if("getTracks"in a){const d=`polyblob:${++m}`;g.set(d,a);k.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream");return d}return c(a)};d.revokeObjectURL=function(a){f(a);g.delete(a)};var u=Object.getOwnPropertyDescriptor(a.HTMLMediaElement.prototype,"src");Object.defineProperty(a.HTMLMediaElement.prototype,"src",{get(){return u.get.apply(this)},set(a){this.srcObject=g.get(a)||null;return u.set.apply(this,[a])}});var p=a.HTMLMediaElement.prototype.setAttribute;a.HTMLMediaElement.prototype.setAttribute=
function(){2===arguments.length&&"src"===`${arguments[0]}`.toLowerCase()&&(this.srcObject=g.get(arguments[1])||null);return p.apply(this,arguments)}}},shimMaxMessageSize(a){if(!a.RTCSctpTransport&&a.RTCPeerConnection){var d=k.detectBrowser(a);"sctp"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp}});var c=function(a){a=f.splitSections(a.sdp);a.shift();return a.some(a=>(a=f.parseMLine(a))&&"application"===
a.kind&&-1!==a.protocol.indexOf("SCTP"))},g=function(a){a=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===a||2>a.length)return-1;a=parseInt(a[1],10);return a!==a?-1:a},m=function(a){let c=65536;"firefox"===d.browser&&(c=57>d.version?-1===a?16384:2147483637:57===d.version?65535:65536);return c},v=function(a,c){let g=65536;"firefox"===d.browser&&57===d.version&&(g=65535);a=f.matchPrefix(a.sdp,"a=max-message-size:");0<a.length?g=parseInt(a[0].substr(19),10):"firefox"===d.browser&&-1!==c&&(g=
2147483637);return g},u=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){this._sctp=null;if(c(arguments[0])){var a=g(arguments[0]),d=m(a);a=v(arguments[0],a);let c;c=0===d&&0===a?Number.POSITIVE_INFINITY:0===d||0===a?Math.max(d,a):Math.min(d,a);d={};Object.defineProperty(d,"maxMessageSize",{get(){return c}});this._sctp=d}return u.apply(this,arguments)}}},shimSendThrowTypeError(a){const d=a.RTCPeerConnection.prototype.createDataChannel;
a.RTCPeerConnection.prototype.createDataChannel=function(){const a=this,c=d.apply(a,arguments),f=c.send;c.send=function(){const d=arguments[0];if((d.length||d.size||d.byteLength)>a.sctp.maxMessageSize)throw new DOMException(`Message too large (can send a maximum of ${a.sctp.maxMessageSize} bytes)`,"TypeError");return f.apply(this,arguments)};return c}}}},{"./utils":13,sdp:2}],8:[function(a,d,c){const f=a("../utils"),k=a("rtcpeerconnection-shim");d.exports={shimGetUserMedia:a("./getusermedia"),shimPeerConnection(a){const d=
f.detectBrowser(a);if(a.RTCIceGatherer&&(a.RTCIceCandidate||(a.RTCIceCandidate=function(a){return a}),a.RTCSessionDescription||(a.RTCSessionDescription=function(a){return a}),15025>d.version)){const d=Object.getOwnPropertyDescriptor(a.MediaStreamTrack.prototype,"enabled");Object.defineProperty(a.MediaStreamTrack.prototype,"enabled",{set(a){d.set.call(this,a);const c=new Event("enabled");c.enabled=a;this.dispatchEvent(c)}})}!a.RTCRtpSender||"dtmf"in a.RTCRtpSender.prototype||Object.defineProperty(a.RTCRtpSender.prototype,
"dtmf",{get(){void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new a.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null));return this._dtmf}});a.RTCPeerConnection=k(a,d.version)},shimReplaceTrack(a){!a.RTCRtpSender||"replaceTrack"in a.RTCRtpSender.prototype||(a.RTCRtpSender.prototype.replaceTrack=a.RTCRtpSender.prototype.setTrack)}}},{"../utils":13,"./getusermedia":9,"rtcpeerconnection-shim":1}],9:[function(a,d,c){d.exports=function(a){a=a&&a.navigator;const d=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||
a.name,message:a.message,constraint:a.constraint,toString(){return this.name}}},c=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(a){return c(a).catch(a=>Promise.reject(d(a)))}}},{}],10:[function(a,d,c){const f=a("../utils");d.exports={shimGetUserMedia:a("./getusermedia"),shimOnTrack(a){"object"!==typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},
set(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly));this.addEventListener("track",this._ontrack=a);this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(d=>{const c=new Event("track");c.track=d;c.receiver={track:d};c.transceiver={receiver:c.receiver};c.streams=[a.stream];this.dispatchEvent(c)})}.bind(this))}});"object"===typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&
!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})},shimSourceObject(a){"object"===typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get(){return this.mozSrcObject},set(a){this.mozSrcObject=a}}))},shimPeerConnection(a){const d=f.detectBrowser(a);if("object"===typeof a&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){a.RTCPeerConnection||
(a.RTCPeerConnection=function(c,f){if(38>d.version&&c&&c.iceServers){const a=[];for(let d=0;d<c.iceServers.length;d++){const f=c.iceServers[d];if(f.hasOwnProperty("urls"))for(let d=0;d<f.urls.length;d++){const c={url:f.urls[d]};0===f.urls[d].indexOf("turn")&&(c.username=f.username,c.credential=f.credential);a.push(c)}else a.push(c.iceServers[d])}c.iceServers=a}return new a.mozRTCPeerConnection(c,f)},a.RTCPeerConnection.prototype=a.mozRTCPeerConnection.prototype,a.mozRTCPeerConnection.generateCertificate&&
Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get(){return a.mozRTCPeerConnection.generateCertificate}}),a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate);["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(d=>{const c=a.RTCPeerConnection.prototype[d];a.RTCPeerConnection.prototype[d]=function(){arguments[0]=new ("addIceCandidate"===d?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]);return c.apply(this,arguments)}});
var c=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var g=function(a){const d=new Map;Object.keys(a).forEach(c=>{d.set(c,a[c]);d[c]=a[c]});return d},k={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},z=a.RTCPeerConnection.prototype.getStats;
a.RTCPeerConnection.prototype.getStats=function(a,c,f){return z.apply(this,[a||null]).then(a=>{48>d.version&&(a=g(a));if(53>d.version&&!c)try{a.forEach(a=>{a.type=k[a.type]||a.type})}catch(A){if("TypeError"!==A.name)throw A;a.forEach((d,c)=>{a.set(c,Object.assign({},d,{type:k[d.type]||d.type}))})}return a}).then(c,f)}}},shimRemoveStream(a){!a.RTCPeerConnection||"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){const d=this;f.deprecated("removeStream",
"removeTrack");this.getSenders().forEach(c=>{c.track&&-1!==a.getTracks().indexOf(c.track)&&d.removeTrack(c)})})}}},{"../utils":13,"./getusermedia":11}],11:[function(a,d,c){const f=a("../utils"),k=f.log;d.exports=function(a){const d=f.detectBrowser(a),c=a&&a.navigator;a=a&&a.MediaStreamTrack;const g=function(a){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||
a.message,constraint:a.constraint,toString(){return this.name+(this.message&&": ")+this.message}}},m=function(a,f,m){const n=function(a){if("object"!==typeof a||a.require)return a;const d=[];Object.keys(a).forEach(c=>{if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var f=a[c]="object"===typeof a[c]?a[c]:{ideal:a[c]};void 0===f.min&&void 0===f.max&&void 0===f.exact||d.push(c);void 0!==f.exact&&("number"===typeof f.exact?f.min=f.max=f.exact:a[c]=f.exact,delete f.exact);if(void 0!==f.ideal){a.advanced=
a.advanced||[];const d={};d[c]="number"===typeof f.ideal?{min:f.ideal,max:f.ideal}:f.ideal;a.advanced.push(d);delete f.ideal;Object.keys(f).length||delete a[c]}}});d.length&&(a.require=d);return a};a=JSON.parse(JSON.stringify(a));38>d.version&&(k(`spec: ${JSON.stringify(a)}`),a.audio&&(a.audio=n(a.audio)),a.video&&(a.video=n(a.video)),k(`ff37: ${JSON.stringify(a)}`));return c.mozGetUserMedia(a,f,a=>{m(g(a))})},v=function(a){return new Promise((d,c)=>{m(a,d,c)})};c.mediaDevices||(c.mediaDevices={getUserMedia:v,
addEventListener(){},removeEventListener(){}});c.mediaDevices.enumerateDevices=c.mediaDevices.enumerateDevices||function(){return new Promise(a=>{a([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})};if(41>d.version){const a=c.mediaDevices.enumerateDevices.bind(c.mediaDevices);c.mediaDevices.enumerateDevices=function(){return a().then(void 0,a=>{if("NotFoundError"===a.name)return[];throw a;})}}if(49>d.version){const a=c.mediaDevices.getUserMedia.bind(c.mediaDevices);
c.mediaDevices.getUserMedia=function(d){return a(d).then(a=>{if(d.audio&&!a.getAudioTracks().length||d.video&&!a.getVideoTracks().length)throw a.getTracks().forEach(a=>{a.stop()}),new DOMException("The object can not be found here.","NotFoundError");return a},a=>Promise.reject(g(a)))}}if(!(55<d.version&&"autoGainControl"in c.mediaDevices.getSupportedConstraints())){const d=function(a,d,c){d in a&&!(c in a)&&(a[c]=a[d],delete a[d])},f=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=
function(a){"object"===typeof a&&"object"===typeof a.audio&&(a=JSON.parse(JSON.stringify(a)),d(a.audio,"autoGainControl","mozAutoGainControl"),d(a.audio,"noiseSuppression","mozNoiseSuppression"));return f(a)};if(a&&a.prototype.getSettings){const c=a.prototype.getSettings;a.prototype.getSettings=function(){const a=c.apply(this,arguments);d(a,"mozAutoGainControl","autoGainControl");d(a,"mozNoiseSuppression","noiseSuppression");return a}}if(a&&a.prototype.applyConstraints){const c=a.prototype.applyConstraints;
a.prototype.applyConstraints=function(a){"audio"===this.kind&&"object"===typeof a&&(a=JSON.parse(JSON.stringify(a)),d(a,"autoGainControl","mozAutoGainControl"),d(a,"noiseSuppression","mozNoiseSuppression"));return c.apply(this,[a])}}}c.getUserMedia=function(a,g,k){if(44>d.version)return m(a,g,k);f.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");c.mediaDevices.getUserMedia(a).then(g,k)}}},{"../utils":13}],12:[function(a,d,c){const f=a("../utils");d.exports={shimLocalStreamsAPI(a){if("object"===
typeof a&&a.RTCPeerConnection){"getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){this._localStreams||(this._localStreams=[]);return this._localStreams});"getStreamById"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getStreamById=function(a){let d=null;this._localStreams&&this._localStreams.forEach(c=>{c.id===a&&(d=c)});this._remoteStreams&&this._remoteStreams.forEach(c=>{c.id===a&&(d=c)});return d});if(!("addStream"in a.RTCPeerConnection.prototype)){const d=
a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]);-1===this._localStreams.indexOf(a)&&this._localStreams.push(a);const c=this;a.getTracks().forEach(f=>{d.call(c,f,a)})};a.RTCPeerConnection.prototype.addTrack=function(a,c){c&&(this._localStreams?-1===this._localStreams.indexOf(c)&&this._localStreams.push(c):this._localStreams=[c]);return d.call(this,a,c)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=
function(a){this._localStreams||(this._localStreams=[]);const d=this._localStreams.indexOf(a);if(-1!==d){this._localStreams.splice(d,1);var c=this,f=a.getTracks();this.getSenders().forEach(a=>{-1!==f.indexOf(a.track)&&c.removeTrack(a)})}})}},shimRemoteStreamsAPI(a){"object"===typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in a.RTCPeerConnection.prototype||
Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(a){const d=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly));this.addEventListener("addstream",this._onaddstream=a);this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(a=>{d._remoteStreams||(d._remoteStreams=[]);if(!(0<=d._remoteStreams.indexOf(a))){d._remoteStreams.push(a);var c=
new Event("addstream");c.stream=a;d.dispatchEvent(c)}})})}}))},shimCallbacksAPI(a){if("object"===typeof a&&a.RTCPeerConnection){({prototype:a}=a.RTCPeerConnection);var {createOffer:d}=a,{createAnswer:c}=a,{setLocalDescription:f}=a,{setRemoteDescription:g}=a,{addIceCandidate:k}=a;a.createOffer=function(a,c){const f=d.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!c)return f;f.then(a,c);return Promise.resolve()};a.createAnswer=function(a,d){const f=c.apply(this,[2<=arguments.length?
arguments[2]:arguments[0]]);if(!d)return f;f.then(a,d);return Promise.resolve()};var v=function(a,d,c){a=f.apply(this,[a]);if(!c)return a;a.then(d,c);return Promise.resolve()};a.setLocalDescription=v;v=function(a,d,c){a=g.apply(this,[a]);if(!c)return a;a.then(d,c);return Promise.resolve()};a.setRemoteDescription=v;v=function(a,d,c){a=k.apply(this,[a]);if(!c)return a;a.then(d,c);return Promise.resolve()};a.addIceCandidate=v}},shimGetUserMedia(a){const d=a&&a.navigator;d.getUserMedia||(d.webkitGetUserMedia?
d.getUserMedia=d.webkitGetUserMedia.bind(d):d.mediaDevices&&d.mediaDevices.getUserMedia&&(d.getUserMedia=function(a,c,f){d.mediaDevices.getUserMedia(a).then(c,f)}))},shimRTCIceServerUrls(a){const d=a.RTCPeerConnection;a.RTCPeerConnection=function(a,c){if(a&&a.iceServers){const d=[];for(let c=0;c<a.iceServers.length;c++){let g=a.iceServers[c];!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(f.deprecated("RTCIceServer.url","RTCIceServer.urls"),g=JSON.parse(JSON.stringify(g)),g.urls=g.url,delete g.url,
d.push(g)):d.push(a.iceServers[c])}a.iceServers=d}return new d(a,c)};a.RTCPeerConnection.prototype=d.prototype;"generateCertificate"in a.RTCPeerConnection&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get(){return d.generateCertificate}})},shimTrackEventTransceiver(a){"object"===typeof a&&a.RTCPeerConnection&&"receiver"in a.RTCTrackEvent.prototype&&!a.RTCTransceiver&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})},shimCreateOfferLegacy(a){const d=
a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){if(a){var c=this.getTransceivers().find(a=>a.sender.track&&"audio"===a.sender.track.kind);!1===a.offerToReceiveAudio&&c?"sendrecv"===c.direction?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":"recvonly"===c.direction&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):!0!==a.offerToReceiveAudio||c||this.addTransceiver("audio");c=this.getTransceivers().find(a=>a.sender.track&&
"video"===a.sender.track.kind);!1===a.offerToReceiveVideo&&c?"sendrecv"===c.direction?c.setDirection("sendonly"):"recvonly"===c.direction&&c.setDirection("inactive"):!0!==a.offerToReceiveVideo||c||this.addTransceiver("video")}return d.apply(this,arguments)}}}},{"../utils":13}],13:[function(a,d,f){function g(a,d,c){return(a=a.match(d))&&a.length>=c&&parseInt(a[c],10)}let k=!0,m=!0;d.exports={extractVersion:g,wrapPeerConnectionEvent:function(a,d,c){if(a.RTCPeerConnection){a=a.RTCPeerConnection.prototype;
var f=a.addEventListener;a.addEventListener=function(a,g){if(a!==d)return f.apply(this,arguments);const k=function(a){g(c(a))};this._eventMap=this._eventMap||{};this._eventMap[g]=k;return f.apply(this,[a,k])};var g=a.removeEventListener;a.removeEventListener=function(a,c){if(a!==d||!this._eventMap||!this._eventMap[c])return g.apply(this,arguments);const f=this._eventMap[c];delete this._eventMap[c];return g.apply(this,[a,f])};Object.defineProperty(a,`on${d}`,{get(){return this[`_on${d}`]},set(a){this[`_on${d}`]&&
(this.removeEventListener(d,this[`_on${d}`]),delete this[`_on${d}`]);a&&this.addEventListener(d,this[`_on${d}`]=a)}})}},disableLog(a){return"boolean"!==typeof a?Error(`Argument type: ${typeof a}. Please use a boolean.`):(k=a)?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings(a){if("boolean"!==typeof a)return Error(`Argument type: ${typeof a}. Please use a boolean.`);m=!a;return`adapter.js deprecation warnings ${a?"disabled":"enabled"}`},log(){"object"!==typeof c||k||"undefined"!==
typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)},deprecated(a,d){m&&console.warn(`${a} is deprecated, please use ${d} instead.`)},detectBrowser(a){const d=a&&a.navigator,c={browser:null,version:null};if("undefined"===typeof a||!a.navigator)return c.browser="Not a browser.",c;d.mozGetUserMedia?(c.browser="firefox",c.version=g(d.userAgent,/Firefox\/(\d+)\./,1)):d.webkitGetUserMedia?(c.browser="chrome",c.version=g(d.userAgent,/Chrom(e|ium)\/(\d+)\./,2)):d.mediaDevices&&
d.userAgent.match(/Edge\/(\d+).(\d+)$/)?(c.browser="edge",c.version=g(d.userAgent,/Edge\/(\d+).(\d+)$/,2)):d.mediaDevices&&d.userAgent.match(/AppleWebKit\/(\d+)\./)?(c.browser="safari",c.version=g(d.userAgent,/AppleWebKit\/(\d+)\./,1)):c.browser="Not a supported browser.";return c}}},{}]},{},[3])(3));c.adapter=function(){return{RTCPeerConnection:null,webrtcDetectedBrowser:null,init(b){virtualclass.system.getusermedia&&(b.mozGetUserMedia?this.attachMediaStream=function(a,b){this.videoAdd=!0;const d=
c.URL||c.webkitURL;a.src=d?d.createObjectURL(b):b;a.play()}:b.webkitGetUserMedia?(this.attachMediaStream=function(a,b){const d=c.URL||c.webkitURL;a.src=d?d.createObjectURL(b):b;a.play();this.videoAdd=!0},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=
function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})):b.mediaDevices&&(this.attachMediaStream=function(a,b){const d=c.URL||c.webkitURL;a.src=d?d.createObjectURL(b):b;a.play()}));return b}}}})(window);(function(c){let b,a,d,f,g;const k={},m={},n={};let r,t=[],z=0,v,u,p=b=!1,q;c.media=function(){return{isChannelReady:"",isStarted:"",pc:[],cn:0,ba:!1,bb:!1,bc:!1,bNotRender:!1,remoteStream:"",turnReady:"",videoControlId:"videoContainer",videoContainerId:"videos",CONFIG:{width:{max:268},height:{max:142},frameRate:{max:6}},audioPlayerNode:null,audioCreatorNode:null,util:{imageReplaceWithVideo(a,b){var d=chatContainerEvent.elementFromShadowDom(`#ml${a}`);chatContainerEvent.elementFromShadowDom(`#ml${a}`)&&
d.classList.remove("userImg");if(null!=d){a=d.getElementsByTagName("a")[0];d=a.getElementsByTagName("span")[0]||a.getElementsByTagName("img")[0];a.classList.contains("hasVideo")||(a.className+=" hasVideo");const c=a.querySelector(".videoWrapper");null==d&&null==d&&null!=c?(a.removeChild(c),a.appendChild(b)):a.replaceChild(b,d)}}},audioVisual:{init(){this.audioCtx=new (c.AudioContext||c.webkitAudioContext);this.analyser=this.audioCtx.createAnalyser();this.analyser.minDecibels=-90;this.analyser.maxDecibels=
-10;this.analyser.smoothingTimeConstant=.85;this.distortion=this.audioCtx.createWaveShaper();this.gainNode=this.audioCtx.createGain();this.biquadFilter=this.audioCtx.createBiquadFilter();this.convolver=this.audioCtx.createConvolver()},readyForVisual(a){this.source=this.audioCtx.createMediaStreamSource(a);this.source.connect(this.analyser);this.analyser.connect(this.distortion);this.distortion.connect(this.biquadFilter);this.biquadFilter.connect(this.convolver);this.convolver.connect(this.gainNode);
this.gainNode.connect(this.audioCtx.destination)}},workerAudioSendOnmessage(){workerAudioSend.onmessage=function(a){Object.prototype.hasOwnProperty.call(a.data,"cmd")&&("muteAudio"===a.data.cmd?g.audio.notifiyMuteAudio():"unMuteAudio"===a.data.cmd&&g.audio.notifiyUnmuteAudio())}},audio:{audioStreamArr:[],tempAudioStreamArr:[],recordingLength:0,bufferSize:0,encMode:"alaw",recordAudio:!1,rec:"",otherSound:!1,audioNodes:[],sdElem:"silenceDetect",snode:[],workletAudioRec:!1,aChunksPlay:!1,audioContextReady:!1,
init(){const a=document.getElementById("speakerPressOnce").dataset.audioPlaying;virtualclass.gObj.audMouseDown="true"===a;this.graph={height:56,width:4,average:0,display(){const a=g.video;roles.hasControls()&&this.initDisplay(a.tempVidCont,this.height-this.height*this.average/100)},initDisplay(a,b){a.beginPath();a.moveTo(this.width,this.height);a.lineTo(this.width,b);a.lineWidth=this.width;a.strokeStyle="rgba(32, 37, 247, 0.8)";a.closePath();a.stroke()}};this.attachFunctionsToAudioWidget()},initAudiocontext(){Object.prototype.hasOwnProperty.call(this,
"Html5Audio")||virtualclass.gObj.meetingMode||(this.Html5Audio={audioContext:new (c.AudioContext||c.webkitAudioContext)},null==virtualclass.media.audio.Html5Audio.audioContext&&alert("audio context is null"),this.resampler=new Resampler(virtualclass.media.audio.Html5Audio.audioContext.sampleRate,8E3,1,4096),this.audioContextReady=virtualclass.gObj.isAudioContextReady=!0,virtualclass.system.mediaDevices.hasMicrophone&&!virtualclass.isPlayMode&&null!=g.video.tempStream&&(virtualclass.media.stream=g.video.tempStream,
virtualclass.media.audio.actualManiPulateStream()))},initScriptNode(){for(let a=0;a<this.snode.length;a++)this.innerPlayWithFallback(this.snode[a]);this.snode=[]},attachAudioStopHandler(a){a=a.getAudioTracks()[0];null!=a&&(a.onended=this.notifiyMuteAudio,a.onmute=this.notifiyMuteAudio,a.onunmute=this.notifiyUnmuteAudio)},notifiyMuteAudio(){this.notifyAudioMute=!0;virtualclass.gObj.audMouseDown&&(virtualclass.gObj.mutedomop?Object.prototype.hasOwnProperty.call(virtualclass.gObj,"mutedomopto")&&null!==
virtualclass.gObj.mutedomopto||(virtualclass.gObj.mutedomopto=setTimeout(()=>{g.audio.notifiyMuteAudioDom()},2E3)):g.audio.notifiyMuteAudioDom())},notifiyUnmuteAudio(){this.notifyAudioMute=!1;virtualclass.gObj.mutedomop=!0;Object.prototype.hasOwnProperty.call(virtualclass.gObj,"mutedomopto")&&(clearTimeout(virtualclass.gObj.mutedomopto),virtualclass.gObj.mutedomopto=null);g.audio.notifiyUnmuteAudioDom()},notifiyUnmuteAudioDom(){Object.prototype.hasOwnProperty.call(this,"speakerPressOnce")&&null!=
this.speakerPressOnce&&this.speakerPressOnce.classList.contains("audioMute")&&this.speakerPressOnce.classList.remove("audioMute")},notifiyMuteAudioDom(){Object.prototype.hasOwnProperty.call(this,"speakerPressOnce")||(this.speakerPressOnce=document.querySelector("#speakerPressOnce"));null==this.speakerPressOnce||this.speakerPressOnce.classList.contains("audioMute")||this.speakerPressOnce.classList.add("audioMute")},muteButtonToogle(){const a=document.querySelector("#speakerPressOnce");null!=a&&a.dataset.audioPlaying&&
"true"===a.dataset.audioPlaying&&a.click()},audioSend(a,b){if(virtualclass.gObj.audMouseDown&&io.webSocketConnected()){var d=virtualclass.vutil.breakintobytes(virtualclass.gObj.uid,8);d=new Int8Array([101,d[0],d[1],d[2],d[3]]);const c=new Int8Array(a.length+d.length);c.set(d);c.set(a,d.length);ioAdapter.sendBinary(c);virtualclass.media.audio.setAudioStatus(b)}else virtualclass.media.audio.setAudioStatus("stop")},setAudioStatus(a){let b;"undefined"===typeof b&&(b=document.getElementById("audioWidget").getElementsByClassName(this.sdElem)[0]);
b.setAttribute("data-silence-detect",a)},makeIconNotDraggable(a,b){const d=document.getElementById(a,b).getContext("2d"),f=new Image;f.onload=function(){d.drawImage(f,0,0)};f.src=`${c.whiteboardPath}images/${b}`},attachFunctionsToAudioWidget(){const a=document.getElementById("audioWidget").getElementsByClassName("audioTool");for(let b=0;b<a.length;b++)"speakerPressOnce"!==a[b].id&&"speakerPressing"===a[b].id&&this.attachSpeakToStudent(a[b].id),"speakerPressing"!==a[b].id&&a[b].addEventListener("click",
this.audioToolInit)},audioToolInit(){if(virtualclass.gObj.meetingMode){var a=document.getElementById(this.id);"false"===a.getAttribute("data-audio-playing")&&"undefined"===typeof alwaysDisable?(virtualclass.vutil.audioStatus(a,"true"),a=!0):(virtualclass.vutil.audioStatus(a,"false"),a=!1);virtualclass.multiVideo.setAudioStatus(a)}else a=virtualclass.media.audio,"speakerPressOnce"===this.id?a.clickOnceSpeaker(this.id):"silenceDetect"===this.id&&(this.getElementsByTagName("a"),a.sd?(a.sd=!1,this.className=
`${this.className} sdDisable`):(a.sd=!0,this.className=`${this.className} sdEnable`))},attachSpeakToStudent(a){const b=this,d=document.getElementById(a);let c=!1;d.addEventListener("mousedown",()=>{if(!virtualclass.gObj.audMouseDown){b.studentSpeak(d);c=!0;var a=document.getElementById("speakerPressonceLabel");null!=a&&virtualclass.vutil.elemHasAnyClass("speakerPressonceLabel")&&a.classList.contains("silenceDetect")&&(a.removeAttribute("data-silence-detect"),a.classList.remove("silenceDetect"),0>=
a.classList.length&&a.removeAttribute("class"),a=a.getElementsByTagName("i")[0],null!=a&&(a.setAttribute("data-silence-detect","stop"),a.className+=" silenceDetect"))}});d.addEventListener("mouseup",()=>{if(c){b.studentNotSpeak(d);c=!1;const a=document.getElementById("speakerPressonceLabel"),f=a.getElementsByTagName("i")[0];"undefined"!==typeof f.classList&&f.classList.contains("silenceDetect")&&(f.classList.remove("silenceDetect"),0>=f.classList.length&&f.removeAttribute("class"),a.removeAttribute("data-silence-detect"));
null!==a&&(a.setAttribute("data-silence-detect","stop"),a.className=`${f.className} silenceDetect`)}})},attachAudioPressOnce(){const a=document.getElementById("speakerPressOnce");a.setAttribute("data-audio-playing","false");const b=this;a.addEventListener("click",()=>{b.clickOnceSpeaker.call(b,a.id)})},clickOnceSpeaker(a,b){a=document.getElementById(a);document.getElementById("speakerPressing");const d=a.getElementsByClassName("congtooltip")[0];"false"===a.getAttribute("data-audio-playing")&&"undefined"===
typeof b?(this.studentSpeak(),a.setAttribute("data-audio-playing","true"),d.setAttribute("data-title",virtualclass.lang.getString("audioEnable")),a.className="audioTool active"):(this.studentNotSpeak(),a.setAttribute("data-audio-playing","false"),d&&d.setAttribute("data-title",virtualclass.lang.getString("audioDisable")),a.className="audioTool deactive")},initProcessorEvent(){Object.prototype.hasOwnProperty.call(virtualclass.gObj,"initProcessorTime")&&clearInterval(virtualclass.gObj.initProcessorTime);
virtualclass.gObj.initProcessorTime=setInterval(()=>{g.audio.notifyAudioMute&&g.audio.notifiyMuteAudio()},2E3)},studentSpeak(a){this.notifyAudioMute=!0;this.initProcessorEvent();"undefined"!==typeof a&&(document.getElementById(`${a.id}Button`),a.classList.remove("deactive"),a.classList.add("active"));virtualclass.gObj.audMouseDown=!0;workerAudioSend.postMessage({cmd:"audioMouseDown",msg:{adMouseDown:virtualclass.gObj.audMouseDown}});virtualclass.vutil.beforeSend({sad:!0,cf:"sad"})},studentNotSpeak(a){Object.prototype.hasOwnProperty.call(virtualclass.gObj,
"audMouseDown")&&virtualclass.gObj.audMouseDown&&("undefined"!==typeof a&&(document.getElementById(`${a.id}Button`),a.classList.remove("active"),a.classList.add("deactive")),a=document.getElementById("speakerPressOnce"),a.setAttribute("data-audio-playing","false"),a.className="audioTool deactive",virtualclass.gObj.audMouseDown=!1,workerAudioSend.postMessage({cmd:"audioMouseDown",msg:{audMouseDown:virtualclass.gObj.audMouseDown}}),virtualclass.media.audio.setAudioStatus("stop"),virtualclass.vutil.beforeSend({sad:!1,
cf:"sad"},null,!0))},ab2str(a){return String.fromCharCode.apply(null,new Int8Array(a))},str2ab(a){var b=new ArrayBuffer(a.length);b=new Int8Array(b);for(let d=0,c=a.length;d<c;d++)b[d]=a.charCodeAt(d);return b},recorderProcess(d){(new Date).getTime();if(!b&&(this.recordAudio||(this.recordingLength+=this.bufferSize),virtualclass.gObj.audMouseDown&&io.webSocketConnected())){d=this.resampler.resampler(d);l=d.length;for(a=new Int16Array(l);l--;)a[l]=32767*Math.min(1,d[l]);d=a;const b=this.encodeAudio(d);
this.silenceDetection(b,d)}},recorderProcessFallback(a){workerAudioSend.postMessage({cmd:"rawAudio",msg:a.inputBuffer.getChannelData(0)})},encodeAudio(a){return G711.encode(a,{alaw:"alaw"===this.encMode})},audioForTesting(a){a=G711.encode(a,{alaw:"alaw"===this.encMode});virtualclass.gObj.audioForTest.push(a);virtualclass.gObj[virtualclass.gObj.uid]=!1},initPlayWithFallback(){Object.prototype.hasOwnProperty.call(this,"Html5Audio")||this.Html5Audio||(this.Html5Audio={audioContext:new (c.AudioContext||
c.webkitAudioContext)});if(!p){const a=new MessageChannel;workerIO.postMessage({cmd:"workerAudioRec"},[a.port1]);workerAudioRec.postMessage({cmd:"workerIO",sampleRate:this.Html5Audio.audioContext.sampleRate},[a.port2]);workerAudioRec.postMessage({cmd:"audioWorklet",msg:!1});workerAudioRec.onmessage=function(a){switch(a.data.cmd){case "noAudioWorklet":virtualclass.media.audio.queueWithFalback(a.data.msg.data,a.data.msg.uid),virtualclass.media.audio.playWithFallback(a.data.msg.uid)}};p=!0;virtualclass.gObj.audioRecWorkerReady=
!0}},initPlay(){this.addingWorkletPending||(console.log("audio init worklet suman b"),"undefined"!==typeof u&&(console.log("audio worklet disconnect"),u.disconnect()),Object.prototype.hasOwnProperty.call(this,"Html5Audio")||this.Html5Audio||(this.Html5Audio={audioContext:new (c.AudioContext||c.webkitAudioContext)}),this.addingWorkletPending=!0,g.audio.Html5Audio.audioContext.audioWorklet.addModule(workletAudioRecBlob).then(()=>{u=new AudioWorkletNode(g.audio.Html5Audio.audioContext,"worklet-audio-rec");
g.audio.Html5Audio.MediaStreamDest=g.audio.Html5Audio.audioContext.createMediaStreamDestination();u.connect(g.audio.Html5Audio.audioContext.destination);virtualclass.gObj.workletAudioRec=u;"Chrome"===virtualclass.system.mybrowser.name&&g.audio.bug_687574_callLocalPeers();var a=new MessageChannel;workerIO.postMessage({cmd:"workerAudioRec"},[a.port1]);workerAudioRec.postMessage({cmd:"workerIO",sampleRate:g.audio.Html5Audio.audioContext.sampleRate},[a.port2]);a=new MessageChannel;workerAudioRec.postMessage({cmd:"workletAudioRec"},
[a.port1]);u.port.postMessage({cmd:"workerAudioRec"},[a.port2]);workerAudioRec.postMessage({cmd:"audioWorklet",msg:!0});virtualclass.gObj.audioRecWorkerReady=!0;delete g.audio.addingWorkletPending}).catch(a=>{console.log("ERROR ",a)}))},playWithFallback(a){"suspended"===this.Html5Audio.audioContext.state?Object.prototype.hasOwnProperty.call(this,"audioSuspendTime")||(this.audioSuspendTime=setTimeout(()=>{"suspended"===this.Html5Audio.audioContext.state&&(this.snode.push(a),null===virtualclass.gObj.requestToScriptNode&&
(this.Html5Audio.audioContext.resume(),virtualclass.gesture.initAudioResume(a),virtualclass.gObj.requestToScriptNode=!0),delete this.audioSuspendTime)},2E3)):(this.innerPlayWithFallback(),this.audioSuspendTime&&delete this.audioSuspendTime)},innerPlayWithFallback(){const a=this;if(null===virtualclass.media.audioPlayerNode||"closed"===virtualclass.media.audioPlayerNode.context.state)null!==virtualclass.media.audioPlayerNode&&virtualclass.media.audioPlayerNode.disconnect(),virtualclass.media.audioPlayerNode=
this.Html5Audio.audioContext.createScriptProcessor(4096,1,1),q=0,virtualclass.media.audioPlayerNode.onaudioprocess=function(b){b=b.outputBuffer.getChannelData(0);var d=a.getMergedAudio();if(null!==d&&void 0!==d){for(let a=0;a<d.length;a++)b[a]=d[a];q=d[4095]}else for(d=0;d<b.length;d++)b[d]=q},virtualclass.media.audioPlayerNode.connect(this.Html5Audio.audioContext.destination)},queueWithFalback(a,b){null==k[b]&&(k[b]=[]);null==n[b]&&(n[b]=[]);for(let d=0;d<a.length;d++)n[b].push(a[d]);for(;4096<=
n[b].length;)a=n[b].splice(0,4096),k[b].push(new Float32Array(a))},getMergedAudio(){t=[];z=0;for(r in k){var a=this.getAudioChunks(r);if(null!=a)if(z++,1===z)for(var b=0;4096>b;b++)t[b]=a[b];else for(b=0;4096>b;b++)t[b]+=a[b]}if(1===z)return t;if(1<z){for(a=0;4096>a;a++)t[a]/=z;return t}},getAudioChunks(a){if(null!==k){if(9<=k[a].length){for(;3<=k[a].length;)k[a].shift();m[a]=!0;return k[a].shift()}if(2<=k[a].length||0<k[a].length&&!0===m[a])return m[a]=!0,k[a].shift();m[a]=!1;0===k[a].length&&delete k[a]}},
actualManiPulateStream(){this.triggermaniPulateStream=!0;const a=virtualclass.media;setTimeout(()=>{a.detectAudioWorklet()?a.audio.maniPulateStream():a.audio.maniPulateStreamWithFallback()},1E3)},maniPulateStream(){const {stream:a}=g;"undefined"!==typeof v&&v.disconnect();"undefined"!==typeof a&&null!=a&&g.audio.Html5Audio.audioContext.audioWorklet.addModule(workletAudioSendBlob).then(()=>{var d=g.audio.Html5Audio.audioContext.createMediaStreamSource(a);const c=g.audio.Html5Audio.audioContext.createBiquadFilter();
c.type="lowpass";c.frequency.value=2E3;d.connect(c);v=new AudioWorkletNode(g.audio.Html5Audio.audioContext,"worklet-audio-send");v.onprocessorerror=function(a){console.log("this is on process error");g.audio.notifiyMuteAudio();g.audio.isProcessError=!0};c.connect(v);v.connect(g.audio.Html5Audio.audioContext.destination);virtualclass.gObj.workletAudioSend=v;d=new MessageChannel;workerAudioSend.postMessage({cmd:"workerIO",sampleRate:this.Html5Audio.audioContext.sampleRate,uid:virtualclass.gObj.uid},
[d.port1]);workerIO.postMessage({cmd:"workerAudioSend"},[d.port2]);d=new MessageChannel;workerAudioSend.postMessage({cmd:"audioWorkletSend",msg:{repMode:b}},[d.port1]);v.port.postMessage({cmd:"workerAudioSend"},[d.port2]);g.workerAudioSendOnmessage()}).catch(a=>{g.audio.notifiyMuteAudio()})},maniPulateStreamWithFallback(){if("undefined"!==typeof g.stream&&null!=g.stream){var {stream:a}=g;a=g.audio.Html5Audio.audioContext.createMediaStreamSource(a);g.audio.bufferSize=4096;virtualclass.media.audioCreatorNode=
g.audio.Html5Audio.audioContext.createScriptProcessor(g.audio.bufferSize,1,1);virtualclass.media.audioCreatorNode.onaudioprocess=g.audio.recorderProcessFallback.bind(g.audio);const b=g.audio.Html5Audio.audioContext.createBiquadFilter();b.type="lowpass";b.frequency.value=2E3;a.connect(b);b.connect(virtualclass.media.audioCreatorNode);virtualclass.media.audioCreatorNode.connect(g.audio.Html5Audio.audioContext.destination);a=new MessageChannel;workerAudioSend.postMessage({cmd:"workerIO",uid:virtualclass.gObj.uid,
sampleRate:g.audio.Html5Audio.audioContext.sampleRate},[a.port1]);workerIO.postMessage({cmd:"workerAudioSend"},[a.port2]);g.workerAudioSendOnmessage()}},updateInfo(){this.audioStreamArr=[];b=this.recordAudio=!1},extractData(a){a=new Int8Array(a);return[virtualclass.vutil.numValidateFour(a[1],a[2],a[3],a[4]),a.subarray(5,a.length)]},removeAudioFromLocalStorage(){localStorage.removeItem("audEnable")},async bug_687574_callLocalPeers(){function a(a,b){if("connected"===b.currentTarget.connectionState)try{u.disconnect(),
u.connect(g.audio.Html5Audio.MediaStreamDest)}catch(N){}else if("disconnected"===b.currentTarget.connectionState){k.close();m.close();m=k=null;try{u.disconnect(),u.connect(g.audio.Html5Audio.audioContext.destination)}catch(N){}g.audio.bug_687574_callLocalPeers()}}async function b(a){try{await k.setLocalDescription(a),await m.setRemoteDescription(a)}catch(I){f()}try{const a=await m.createAnswer();await d(a)}catch(I){f()}}async function d(a){try{await m.setLocalDescription(a),await k.setRemoteDescription(a)}catch(I){f()}}
async function c(a,b){if(b.candidate&&"host"===b.candidate.type)try{await (a===k?m:k).addIceCandidate(b.candidate)}catch(N){f()}}function f(){try{u.connect(g.audio.Html5Audio.audioContext.destination),k.close(),m.close(),m=k=null}catch(K){m=k=null}}let k,m;k=new RTCPeerConnection;k.count=0;k.addEventListener("icecandidate",a=>c(k,a));k.addEventListener("connectionstatechange",b=>a(k,b));m=new RTCPeerConnection;m.count=0;m.addEventListener("icecandidate",a=>c(m,a));m.addEventListener("connectionstatechange",
b=>a(m,b));m.addEventListener("track",function(a){const b=document.createElement("audio");b.srcObject=a.streams[0];b.autoplay=!0});g.audio.Html5Audio.MediaStreamDest.stream.getTracks().forEach(a=>k.addTrack(a,g.audio.Html5Audio.MediaStreamDest.stream));try{const a=await k.createOffer();await b(a)}catch(K){f()}}},video:{width:75,height:56,tempVid:"",tempVidCont:"",myVideo:"",remoteVid:"",remoteVidCont:"",maxHeight:250,init(){this.videoCont=document.getElementById("allVideosCont");null!=this.videoCont&&
(this.videoCont.style.maxHeight=`${this.maxHeight}px`)},calcDimension(){this.myVideo.width=this.width;this.myVideo.height=this.height},removeUser(a){a=document.getElementById(`user${a}`);null!=a&&a.parentNode.removeChild(a)},createElement(a){const b=document.createElement("div");b.className="videoWrapper";const c=document.createElement("div");c.className="videoSubWrapper";c.id=`user${a.id}`;b.appendChild(c);d=a.id;const f=document.createElement("canvas");f.id=`video${d}`;f.className="userVideos";
f.width=this.width;f.height=this.height;f.muted="muted";c.appendChild(f);virtualclass.media.util.imageReplaceWithVideo(a.id,b)},updateHightInSideBar(a){const b=document.getElementById("widgetRightSide").offsetHeight;document.getElementById("chatContainer").style.height=`${b-a}px`},sendInBinary(a){io.webSocketConnected()&&ioAdapter.sendBinary(a)},send(){function a(){b.tempVidCont.clearRect(0,0,b.tempVid.width,b.tempVid.height);b.tempVidCont.drawImage(b.myVideo,0,0,b.width,b.height);roles.hasControls();
virtualclass.system.webpSupport?(d=b.tempVid.toDataURL("image/webp",.6),c=1):(d=b.tempVid.toDataURL("image/jpeg",.3),c=0);d=virtualclass.videoHost.convertDataURIToBinary(d);if(!virtualclass.videoHost.gObj.stdStopSmallVid&&(!roles.hasControls()||roles.hasControls()&&virtualclass.videoHost.gObj.videoSwitch)){var m=virtualclass.gObj.uid.toString();for(var n=m.length;8>n;n++)m=`0${m}`;m=m.match(/[\S]{1,2}/g)||[];m=new Uint8ClampedArray([11,m[0],m[1],m[2],m[3],c]);n=new Uint8ClampedArray(d.length+m.length);
n.set(m);n.set(d,m.length);k.sendInBinary(n)}clearInterval(virtualclass.media.smallVid);if(Object.prototype.hasOwnProperty.call(virtualclass,"connectedUsers"))if(m=f+2500*virtualclass.connectedUsers.length,g!==virtualclass.connectedUsers.length){g=virtualclass.connectedUsers.length;n=-1;for(var r=0;r<virtualclass.connectedUsers.length;r++)virtualclass.connectedUsers[0].userid===virtualclass.gObj.uid&&(n=r);r=m/g;0>n&&(n=0);virtualclass.media.smallVid=setInterval(a,m+n*r)}else virtualclass.media.smallVid=
setInterval(a,m)}Object.prototype.hasOwnProperty.call(virtualclass.media,"smallVid")&&clearInterval(virtualclass.media.smallVid);const b=this;let d,c;f=Math.floor(5001*Math.random()+3E3);let g=-1;const k=this;virtualclass.media.smallVid=setInterval(a,f)},startToStream(){g.video.calcDimension();g.video.send()},playWithoutSlice(a,b,d){this.remoteVid=document.getElementById(`video${a}`);null!=this.remoteVid&&(this.remoteVidCont=this.remoteVid.getContext("2d"),this.remoteVidCont.putImageData(imgData,
0,0))},drawReceivedImage(a,b,d,c){this.remoteVid=chatContainerEvent.elementFromShadowDom(`#video${c}`);if(null!=this.remoteVid)if(this.remoteVidCont=this.remoteVid.getContext("2d"),virtualclass.system.webpSupport||"jpeg"===b){const b=new Image,c=this;b.onload=function(){c.remoteVidCont.drawImage(b,d.x,d.y)};b.src=a}else loadfile(a,this.remoteVid,this.videoPartCont)},justForDemo(){let a=0,b=document.getElementById("allVideosCont");b.style.maxHeight="250px";setInterval(()=>{if(20>=++a){b=document.getElementById("allVideosCont");
const d=document.createElement("div");d.className="videoWrapper";const c=document.createElement("div");c.className="videoSubWrapper";c.setAttribute("data-uname",+a);d.appendChild(c);const f=document.createElement("video");f.className="userVideo";f.muted="muted";f.src="http://html5demos.com/assets/dizzy.mp4";c.appendChild(f);b.appendChild(d);250<=b.offsetHeight&&null!=b.style.overflowY&&"scroll"!==b.style.overflowY&&(b.style.overflowY="scroll",document.getElementById(virtualclass.gObj.chat.mainChatBoxId).style.borderTop=
"3px solid #bbb")}},200)},createVideoElement(){const a=document.createElement("div");a.className="videoWrapper";const b=document.createElement("div");b.className="videoSubWrapper";a.appendChild(b);const d=document.createElement("video");d.id=`video${virtualclass.gObj.uid}`;d.autoplay=!0;b.appendChild(d);return a},insertTempVideo(a){const b=document.createElement("canvas");b.id="tempVideo";a.parentNode.insertBefore(b,a)},tempVideoInit(){g.video.tempVid=chatContainerEvent.elementFromShadowDom("#tempVideo");
g.video.tempVid.width=g.video.width;g.video.tempVid.height=g.video.height;g.video.tempVidCont=g.video.tempVid.getContext("2d")},process(a){var b=new Uint8ClampedArray(a);a=virtualclass.vutil.numValidateFour(b[1],b[2],b[3],b[4]);var d={id:a};virtualclass.media.existVideoContainer(d)||virtualclass.media.video.createElement(d);d=b.subarray(6,b.length);1===b[5]?(b=`data:image/webp;base64,${btoa(virtualclass.videoHost.Uint8ToString(d))}`,d="webp"):(b=`data:image/jpeg;base64,${btoa(virtualclass.videoHost.Uint8ToString(d))}`,
d="jpeg");virtualclass.media.video.drawReceivedImage(b,d,{x:0,y:0},a)}},sessionConstraints(){let a=!!virtualclass.system.mediaDevices.hasWebcam;virtualclass.gObj.meetingMode&&a&&(a="mobTab"===virtualclass.system.device&&"iOS"===virtualclass.system.mybrowser.name||"Firefox"===virtualclass.system.mybrowser.name||"Safari"===virtualclass.system.mybrowser.name?!0:{width:{max:268},height:{max:142},frameRate:{max:6}});return[a,{video:a,audio:virtualclass.system.mediaDevices.hasMicrophone?{echoCancellation:!0,
autoGainControl:!0,channelCount:1,noiseSuppression:!0}:!1}]},async init(){g=this;virtualclass.gesture.classJoin&&(virtualclass.gesture.attachHandler(),delete virtualclass.gesture.classJoin);let a,b;[a,b]=this.sessionConstraints();g.video.init();virtualclass.user.control.audioDisable();virtualclass.user.control.videoDisable();if(!virtualclass.vutil.isPlayMode()){null==virtualclass.adpt&&(virtualclass.adpt=new virtualclass.adapter);if(null!=virtualclass.media.video.tempStream){var d=virtualclass.media.video.tempStream.getTracks();
for(var c=0;c<d.length;c++)d[c].stop()}d=virtualclass.adpt.init(navigator);c=null;try{c=await d.mediaDevices.getUserMedia(b)}catch(C){this.handleUserMediaError(C),this.audio.notifiyMuteAudio()}null!==c&&this.handleUserMedia(c)}virtualclass.system.wbRtc.peerCon&&"undefined"===typeof localStorage.wbrtcMsg&&(virtualclass.view.multiMediaMsg("WebRtc"),localStorage.wbrtcMsg=!0);!1===a&&(virtualclass.user.control.videoDisable(),virtualclass.vutil.addClass("virtualclassCont","nowebcam"))},handleUserMedia(a){localStorage.removeItem("dvid");
var b=localStorage.getItem("audEnable");if(roles.isStudent()&&virtualclass.system.mediaDevices.hasMicrophone)virtualclass.settings.userAudioIcon();else if(virtualclass.system.mediaDevices.hasMicrophone)if(null!=b)if(b=JSON.parse(b),"false"===b.ac||!1===b.ac)virtualclass.gObj.audioEnable=!1,virtualclass.user.control.audioDisable(!0);else{if("true"===b.ac||!0===b.ac)virtualclass.gObj.audioEnable=!0,virtualclass.user.control.audioWidgetEnable(!0)}else"undefined"!==typeof a&&virtualclass.user.control.audioWidgetEnable(!0);
else virtualclass.user.control.audioDisable();b=a.getVideoTracks()[0];"undefined"!==typeof b?b.onended=function(){if(roles.hasControls()){virtualclass.videoHost.clearTeacherVideoTime();virtualclass.system.mediaDevices.webcamErr.push("webcambusy");const a=document.getElementById("videoHostContainer");null!==a&&a.classList.add("displayInterrupt");ioAdapter.mustSend({cf:"videoStop"})}}:virtualclass.system.mediaDevices.webcamErr.push("nopermission");g.video.tempStream=a;g.audio.init();g.audio.attachAudioStopHandler(a);
b=chatContainerEvent.elementFromShadowDom(`#ml${virtualclass.gObj.uid}`);null!=b&&null!=b.getElementsByTagName("video")&&g.innerHandleUserMedia(virtualclass.gObj.uid);roles.hasAdmin()&&virtualclass.videoHost.isDomReady(()=>{virtualclass.videoHost.renderSelfVideo(a)});virtualclass.settings.userVideoIcon();null==localStorage.getItem("prevApp")&&(roles.hasControls()?virtualclass.vutil.videoHandler("off"===virtualclass.vutil.selfVideoStatus()?"on":"off",!0):virtualclass.gObj.meetingMode&&virtualclass.vutil.videoHandler("off"));
g.audio.audioContextReady&&!Object.prototype.hasOwnProperty.call(g.audio,"triggermaniPulateStream")&&(g.stream=g.video.tempStream,g.audio.actualManiPulateStream())},addUserRole(a,b){let d;a.dataset.role=b;"undefined"!==typeof b?(d="s"===b?"student":"teacher",a.classList.add(d)):a.classList.add("student");"t"===virtualclass.gObj.uRole&&"student"===d&&document.getElementById("virtualclassCont").classList.remove("student")},innerHandleUserMedia(a){if("undefined"!==typeof g&&(a=g.video.tempStream,"undefined"!==
typeof a&&virtualclass.system.mediaDevices.hasWebcam)){const b=g.video.createVideoElement();virtualclass.media.util.imageReplaceWithVideo(virtualclass.gObj.uid,b);g.video.insertTempVideo(b);g.video.tempVideoInit();g.video.myVideo=chatContainerEvent.elementFromShadowDom(`#video${virtualclass.gObj.uid}`);virtualclass.adpt.attachMediaStream(g.video.myVideo,a);g.video.myVideo.muted=!0;g.stream=g.video.tempStream;g.video.myVideo.onloadedmetadata=function(){g.video.startToStream()}}},updateVideoContHeight(){var a=
document.getElementById("virtualclassCont");virtualclass.vutil.getElementOffset(a);a=virtualclass.chat.boxHeight;const b=document.getElementById("chat_div");b.scrollHeight>=a+1&&(b.style.overflowY="scroll");b.style.maxHeight=`${a}px`;virtualclass.isPlayMode&&(b.style.maxHeight=`${a+64}px`)},close(){Object.prototype.hasOwnProperty.call(virtualclass.media,"smallVid")&&clearInterval(virtualclass.media.smallVid)},dispAllVideo(a){setTimeout(()=>{var b=document.getElementById(a);if(null!=b){b=b.getElementsByTagName("video");
for(let a=0;a<b.length;a++)b[a].play()}},1040)},existVideoContainer(a){const b=chatContainerEvent.elementFromShadowDom(".userVideos","all");for(let d=0;d<b.length;d++)if(b[d].id===`video${a.id}`)return!0;return!1},handleUserMediaError(a){var b=virtualclass.lang.getString(a);b="object"===typeof a?virtualclass.lang.getString(a.name):b;null==b?virtualclass.view.createErrorMsg(a,"errorContainer","virtualclassAppFooterPanel"):"object"===typeof a?virtualclass.view.createErrorMsg(b,"errorContainer","virtualclassAppFooterPanel",
{className:a.name}):virtualclass.view.createErrorMsg(b,"errorContainer","virtualclassAppFooterPanel");virtualclass.user.control.mediaWidgetDisable("vd");virtualclass.view.disappearBox("WebRtc");switch(a.name){case "NotFoundError":case "DevicesNotFoundError":a="nowebcam";break;case "SourceUnavailableError":a="webcambusy";break;case "PermissionDeniedError":case "SecurityError":a="nopermission";virtualclass.gObj.disableCamByUser=!0;break;case "NotAllowedError":a="nopermission";virtualclass.gObj.disableCamByUser=
!0;break;default:a="rejected"}virtualclass.system.mediaDevices.webcamErr.push(a)},detectAudioWorklet:()=>{if("undefined"===typeof OfflineAudioContext)return!1;const a=new OfflineAudioContext(1,1,44100);return!(!a.audioWorklet||"function"!==typeof a.audioWorklet.addModule)}}}})(window);(function(c){c.sharePt=function(){return{pptUrl:"",state:{},urlValue:"",localStoragFlag:!1,eventsObj:[],autoSlideTime:0,viewFlag:0,controlFlag:0,autoSlideFlag:0,autoSlideResumed:0,studentPpt:0,startFromFlag:0,startFrom:0,currId:"",order:[],init(b,a){virtualclass.orderList[virtualclass.currApp]||(virtualclass.orderList[virtualclass.currApp]=new OrderedList);this.pages={};this.order=[];this.autoSlideResumed=this.autoSlideTime=this.autoSlideFlag=0;"undefined"!==typeof virtualclass.previous&&"undefined"!==
typeof a&&"byclick"===a&&roles.hasControls()&&virtualclass.vutil.beforeSend({ppt:!0,init:"makeAppReady",cf:"ppt"});b=document.getElementById("virtualclassSharePresentation");null!==b&&b.parentNode.removeChild(b);this.UI.container();b=document.getElementById("pptMessageLayout");a=document.getElementById("urlcontainer");roles.hasControls()?(null!=b&&(b.style.display="none"),a&&(a.style.display="block"),virtualclass.vutil.requestOrder(()=>{}),this.getPptList()):(this.UI.messageDisplay(),b&&(b.style.display=
"block"),a&&(a.style.display="none"));virtualclass.sharePt.attachMessageEvent("message",virtualclass.sharePt.pptMessageEventHandler)},createPageModule(){virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&virtualclass.sharePt.ppts.forEach((b,a)=>{virtualclass.sharePt.pages[b.fileuuid]=new virtualclass.page("pptListContainer","ppt","virtualclassSharePresentation","sharePt",b.status)})},_rearrange(b){this.order=b;this.reArrangeElements(b);this.finallySendPptOrder(b)},sendOrder(b){virtualclass.vutil.xhrSendWithForm({content_order:b.toString(),
content_order_type:"3",live_class_id:virtualclass.gObj.congCourse},"congrea_page_order")},reArrangeElements(b){const a=document.getElementById("listppt"),d=document.createElement("div");d.id="listppt";d.className="ppts";let c=!1;for(var g=0;g<virtualclass.sharePt.activeppts.length;g++)-1>=b.indexOf(virtualclass.sharePt.activeppts[g].fileuuid)&&(b.push(virtualclass.sharePt.activeppts[g].fileuuid),c=!0);for(g=0;g<b.length;g++){const a=document.getElementById(`linkppt${b[g]}`);a&&d.appendChild(a)}a.parentNode.replaceChild(d,
a);c&&(virtualclass.orderList[virtualclass.currApp].ol.order=response,this.finallySendPptOrder())},finallySendPptOrder(){virtualclass.vutil.sendOrder("presentation",virtualclass.orderList[virtualclass.currApp].ol.order)},delete(b){const a=this;virtualclass.xhrn.vxhrn.post(virtualclass.api.UpdateDocumentStatus,{uuid:b,action:"delete",page:0}).then(d=>{a.afterDeletePtCallback(d.data,b)})},afterDeletePtCallback(b,a){"ERROR"!==b&&(b=document.getElementById(`linkppt${a}`))&&(b.parentNode.removeChild(b),
virtualclass.sharePt.ppts.length&&(virtualclass.sharePt.ppts.forEach((b,c)=>{b.fileuuid===a&&(b=virtualclass.sharePt.ppts.indexOf(b),0<=b&&virtualclass.sharePt.ppts.splice(b,1))}),b=virtualclass.orderList[virtualclass.currApp].ol.order.indexOf(a),0<=b&&(virtualclass.orderList[virtualclass.currApp].ol.order.splice(b,1),this.finallySendPptOrder(virtualclass.orderList[virtualclass.currApp].ol.order)),(b=document.querySelector(".congrea #pptiframe"))&&b.getAttribute("src")?virtualclass.vutil.showFinishBtn():
virtualclass.vutil.removeFinishBtn()),virtualclass.sharePt.currId===a&&(b=document.querySelector("#pptiframe")))&&(b.removeAttribute("src"),ioAdapter.mustSend({pptMsg:"deletePrt",cf:"ppt",currId:virtualclass.sharePt.currId}),virtualclass.sharePt.currId=null,virtualclass.sharePt.pptUrl=null,virtualclass.vutil.removeFinishBtn())},isPptEventDefined(b){return"undefined"!==typeof b.eventName&&"undefined"!==typeof virtualclass.sharePt[b.eventName]},pptMessageEventHandler(b){virtualclass.sharePt.actualPptMessageEventHandler(b)},
actualPptMessageEventHandler(b){if("SharePresentation"===virtualclass.currApp){b="string"===typeof b.data?JSON.parse(b.data):b.data;console.log("====> ppt event ",b.eventName);if("undefined"!==typeof b)Object.prototype.hasOwnProperty.call(b,"namespace")&&"reveal"===b.namespace&&(this.state=b.state),"ready"===b.eventName?(this.lastSlideChanged?this.setSlideState(this.lastSlideChanged):roles.hasControls()&&(this[b.eventName].call(this,b),this.state=b.state),roles.isStudent()&&this.removeControls()):
"slidechanged"===b.eventName&&roles.hasControls()&&virtualclass.config.makeWebSocketReady&&this.isPptEventDefined(b)&&(!this.lastSlideChanged||this.lastSlideChanged&&(this.isVerticalSlideChanged(b)||this.isHorizontalSlideChanged(b)))?(this[b.eventName].call(this,b),this.state=b.state,delete this.lastSlideChanged):roles.hasControls()&&this[b.eventName]&&this[b.eventName].call(this,b);else{const a=document.getElementById("pptiframe");null!==a&&a.removeAttribute("src")}"slidechanged"===b.eventName&&
virtualclass.userInteractivity.makeReadyContext()}},isVerticalSlideChanged(b){return virtualclass.sharePt.lastSlideChanged.state.indexh===b.state.indexh&&virtualclass.sharePt.lastSlideChanged.state.indexv!==b.state.indexv},isHorizontalSlideChanged(b){return virtualclass.sharePt.lastSlideChanged.state.indexv===b.state.indexv&&virtualclass.sharePt.lastSlideChanged.state.indexh!==b.state.indexh},setAutoSlideConfig(){localStorage.getItem("autoSlideTime")&&(virtualclass.sharePt.autoSlideTime=JSON.parse(localStorage.getItem("autoSlideTime")),
virtualclass.sharePt.autoSlideFlag=JSON.parse(localStorage.getItem("autoSlideFlag")))},onmessage(b){Object.prototype.hasOwnProperty.call(b,"autoSlide")&&(this.autoSlideTime=b.autoSlide);"undefined"!==typeof virtualclass.sharePt&&(this.onPptMsgReceive(b),b=document.getElementById(virtualclass.sharePt.UI.id),b.classList.contains("pptSharing")||b.classList.add("pptSharing"))},ready(b){ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},slidechanged(b){this.autoSlideFlag&&this.autoSlideResumed&&
!this.autoSlideTime&&this.calculateAutoSlideTime(b);ioAdapter.mustSend({pptMsg:b,cf:"ppt",autoSlide:this.autoSlideTime,cfpt:"setPEvent"})},calculateAutoSlideTime(b){this.eventsObj.push({name:b.eventName,time:Date.now()});2<=this.eventsObj.length&&("slidechanged"===this.eventsObj[0].name&&"slidechanged"===this.eventsObj[1].name?this.autoSlideTime=this.eventsObj[1].time-this.eventsObj[0].time:"autoslideresumed"===this.eventsObj[0].name&&"slidechanged"===this.eventsObj[1].name&&(this.autoSlideTime=this.eventsObj[1].time-
this.eventsObj[0].time))},autoslidepaused(b){this.autoSlideFlag=1;this.autoSlideResumed=0;ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},autoslideresumed(b){this.autoSlideResumed=this.autoSlideFlag=1;this.eventsObj=[];this.eventsObj.push({name:b.eventName,time:Date.now()});ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},fragmentshown(b){ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},fragmenthidden(b){ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},overviewshown(b){ioAdapter.mustSend({pptMsg:b,
cf:"ppt",cfpt:"setPEvent"})},overviewhidden(b){ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},paused(b){ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},resumed(b){ioAdapter.mustSend({pptMsg:b,cf:"ppt",cfpt:"setPEvent"})},removeControls(){setTimeout(()=>{document.getElementById("pptiframe").contentWindow.postMessage(JSON.stringify({method:"configure",args:[{controls:!1,autoSlide:0,keyboard:!1,progress:!1,touch:!1}]}),"*")},100)},cfpt:{displayframe(){this.displayFrame()},setUrl(b){virtualclass.sharePt.currId=
b.pptId;console.log("====> PPT SLIDE SET URL");virtualclass.sharePt.stateLocalStorage={};virtualclass.sharePt.state={indexh:0,indexv:0,indexf:0};this.setSlideUrl(b);const a=document.getElementById("pptiframe");a.onload=function(){roles.hasView()&&null!=a.contentWindow&&"undefined"!==typeof b.pptMsg.state&&a.contentWindow.postMessage(JSON.stringify({method:"setState",args:[b.pptMsg.state]}),"*");virtualclass.userInteractivity.makeReadyContext()}},setPEvent(b){null!=document.getElementById("pptiframe")&&
virtualclass.sharePt.setSlideState(b.pptMsg);this.state=b.pptMsg.state}},onPptMsgReceive(b){const a=document.getElementById("pptiframe"),d=document.getElementById("pptMessageLayout");"undefined"!==typeof b.ppt&&"undefined"!==typeof b.ppt.startFrom&&(virtualclass.sharePt.startFromFlag=1,null!==a&&(0>b.ppt.init.search("postMessage")?a.setAttribute("src",`${b.ppt.init}?postMessage=true&postMessageEvents=true`):a.setAttribute("src",b.ppt.init)));"undefined"!==typeof b.pptMsg&&("deletePrt"===b.pptMsg?
null!==a&&(a.removeAttribute("src"),virtualclass.sharePt.currId=null,virtualclass.sharePt.pptUrl=null,null!==d&&(d.style.display="block")):null!==a&&(a.onload=function(){!roles.hasView()&&virtualclass.gObj.makeWebSocketReady||null==a.contentWindow||"undefined"===typeof b.pptMsg.state||(a.contentWindow.postMessage(JSON.stringify({method:"setState",args:[b.pptMsg.state]}),"*"),virtualclass.userInteractivity.makeReadyContext())}),null!=d&&(d.style.display="none"),Object.prototype.hasOwnProperty.call(b,
"cfpt")&&"undefined"!==typeof b.cfpt&&"undefined"!==typeof virtualclass.sharePt.cfpt[b.cfpt]&&virtualclass.sharePt.cfpt[b.cfpt].call(virtualclass.sharePt,b))},displayFrame(){const b=document.getElementById(virtualclass.sharePt.UI.id);b.classList.contains("pptSharing")||(b.classList.add("pptSharing"),virtualclass.dashboard.close())},setSlideUrl(b){if(null!=b.pptMsg&&b.pptMsg){this.autoSlideTime=this.autoSlideFlag=this.viewFlag=virtualclass.sharePt.studentPpt=0;const a=document.getElementById("pptiframe");
null!=a&&a.parentNode.removeChild(a);this.UI.createIframe();document.getElementById("iframecontainer").style.display="block";document.getElementById("pptiframe").setAttribute("src",0>b.pptMsg.search("postMessage")?`${b.pptMsg}?postMessage=true&postMessageEvents=true`:b.pptMsg);this.pptUrl=b.pptMsg}virtualclass.sharePt.startFromFlag=0},setSlideState(b){const a=document.getElementById("pptiframe").contentWindow,d=[b.state.indexh,b.state.indexv,b.state.indexf],c=[b.state];switch(b.eventName){case "ready":a.postMessage(JSON.stringify({method:"setState",
args:c}),"*");break;case "slidechanged":console.log("===> slide being changed");virtualclass.sharePt.studentPpt=b;virtualclass.sharePt.lastSlideChanged=b;a.postMessage(JSON.stringify({method:"slide",args:d}),"*");break;case "autoslidepaused":this.autoSlideFlag=1;a.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*");break;case "autoslideresumed":this.autoSlideFlag=1;a.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*");break;case "fragmentshown":a.postMessage(JSON.stringify({method:"slide",
args:d}),"*");break;case "fragmenthidden":a.postMessage(JSON.stringify({method:"slide",args:d}),"*");break;case "overviewshown":a.postMessage(JSON.stringify({method:"setState",args:c}),"*");break;case "overviewhidden":a.postMessage(JSON.stringify({method:"setState",args:c}),"*"),a.postMessage(JSON.stringify({method:"slide",args:d}),"*")}},toProtocolRelativeUrl(){const b=virtualclass.sharePt.urlValue;return 0<=b.indexOf("http")?b.replace(/http:\/\/|https:\/\//,"//"):`//${b}`},validUrl(){return virtualclass.sharePt.isUrlip(virtualclass.sharePt.urlValue)?
virtualclass.sharePt.cleanupUrl(virtualclass.sharePt.urlValue):0<virtualclass.sharePt.urlValue.search("<iframe")?virtualclass.sharePt.extractUrl(virtualclass.sharePt.urlValue):virtualclass.sharePt.validURLWithDomain(virtualclass.sharePt.urlValue)?virtualclass.sharePt.completeUrl(virtualclass.sharePt.cleanupUrl(virtualclass.sharePt.urlValue)):!1},initNewPpt(){virtualclass.sharePt.urlValue=document.getElementById("presentationurl").value;virtualclass.sharePt.urlValue=virtualclass.sharePt.toProtocolRelativeUrl();
const b=virtualclass.sharePt.validUrl();b?(virtualclass.sharePt.savePptUrl(b),document.getElementById("presentationurl").value=""):virtualclass.popup.validateurlPopup("presentation")},savePptUrl(b){const a=virtualclass.vutil.createHashString(b)+virtualclass.vutil.randomString(32).slice(1,-1),d={};d.uuid=a;d.URL=b;d.title=b;b=virtualclass.api.addURL;d.type="presentation";const c=this;virtualclass.xhrn.vxhrn.post(b,d).then(()=>{if(Object.prototype.hasOwnProperty.call(virtualclass.sharePt,"activeppts")){const a=
virtualclass.sharePt.activeppts.map(a=>a.fileuuid);a.length!==virtualclass.orderList[virtualclass.currApp].ol.order.length&&(virtualclass.orderList[virtualclass.currApp].ol.order=a)}virtualclass.orderList[virtualclass.currApp].ol.order.push(d.uuid);c.finallySendPptOrder(virtualclass.orderList[virtualclass.currApp].ol.order);virtualclass.sharePt.getPptList();virtualclass.serverData.syncComplete=!1;virtualclass.serverData.syncAllData().then(()=>{virtualclass.sharePt.awsPresentationList(virtualclass.serverData.rawData.ppt)})})},
awsPresentationList(b){virtualclass.sharePt.ppts=[];virtualclass.sharePt.ppts=b;null==document.querySelector("#SharePresentationDashboard .dbContainer")&&(document.querySelector("#SharePresentationDashboard").innerHTML=virtualclass.vutil.getPptDashBoard("SharePresentation"),virtualclass.sharePt.attachEvent("submitpurl","click",virtualclass.sharePt.initNewPpt));virtualclass.sharePt.createPageModule();virtualclass.sharePt.showPpts();virtualclass.vutil.requestOrder(a=>{virtualclass.vutil.isResponseAvailable(a)&&
virtualclass.orderList[virtualclass.currApp].ol.order&&0<virtualclass.orderList[virtualclass.currApp].ol.order.length&&virtualclass.sharePt.reArrangeElements(virtualclass.orderList[virtualclass.currApp].ol.order)})},afterPptSaved(b){var a=b.fileuuid;Object.prototype.hasOwnProperty.call(b,"disabled")?b.status=0:b.status=1;this.pages[a]=new virtualclass.page("pptListContainer","ppt","virtualclassSharePresentation","sharePt",b.status);this.pages[a].init(a,b.URL);this.pptClickHandler(b);a=document.getElementById(`linkppt${b.fileuuid}`);
const d=document.getElementById(`pptTitle${b.fileuuid}`);var c=this.extractTitle(b.URL);d&&(c?d.innerHTML=c:(c=b.URL,c=`https:${c}`,c=c.match(/^(?:https?:\/\/)?(?:w{3}\.)?([a-z\d\.-]+)\.(?:[a-z\.]{2,10})(?:[/\w\.-]*)*/)[1],d.innerHTML=c));d.setAttribute("data-toogle","tooltip");d.setAttribute("data-placement","bottom");d.setAttribute("title",b.URL);Object.prototype.hasOwnProperty.call(b,"disabled")?(this.disable(b.fileuuid),a&&a.classList.add("disable")):(this.enable(b.fileuuid),a&&a.classList.add("enable"));
virtualclass.sharePt.currId===b.fileuuid&&a.classList.add("playing")},extractTitle(b){return-1<b.indexOf("//")?b.split("/")[4]:b.split("/")[2]},pptClickHandler(b){const a=document.getElementById(`mainpppt${b.fileuuid}`);a&&a.addEventListener("click",()=>{virtualclass.sharePt.playPptUrl(b.URL,b.fileuuid);virtualclass.dashboard.close();virtualclass.sharePt.currId=b.fileuuid;virtualclass.sharePt.activePrs(b.fileuuid)})},activePrs(b){const a=document.querySelectorAll("#virtualclassCont.congrea .linkppt");
for(let b=0;b<a.length;b++)a[b].classList.contains("playing")&&a[b].classList.remove("playing");(b=document.querySelector(`#virtualclassCont.congrea #linkppt${b}`))&&!b.classList.contains("playing")&&b.classList.add("playing")},disable(b){var a=document.getElementById(`mainpppt${b}`);a.style.opacity=.3;a.style.pointerEvents="none";a=document.querySelector(`#linkppt${b}`);a.classList.contains("enable")&&a.classList.remove("enable");a.classList.add("disable");virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&
virtualclass.sharePt.ppts.forEach((a,c)=>{a.fileuuid===b&&(a.disabled=0,a.status=0)})},enable(b){var a=document.querySelector(`#linkppt${b}`);a.classList.contains("disable")&&a.classList.remove("diable");a.classList.add("enable");if(a=document.getElementById(`mainpppt${b}`))a.style.opacity=1,a.style.pointerEvents="auto",virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&virtualclass.sharePt.ppts.forEach((a,c)=>{a.fileuuid===b&&(delete a.disabled,a.status=1)})},getPptList(){virtualclass.gObj.fetchedData?
virtualclass.sharePt.awsPresentationList(virtualclass.serverData.rawData.ppt):virtualclass.serverData.syncAllData().then(()=>{virtualclass.sharePt.awsPresentationList(virtualclass.serverData.rawData.ppt)})},showPpts(){var b=document.getElementById("listppt");if(b)for(let a=0;a<b.childNodes.length-1;a++)b.childNodes[a].parentNode.removeChild(b.childNodes[a]);virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&(virtualclass.sharePt.activeppts=[],virtualclass.sharePt.ppts.forEach((a,b)=>{Object.prototype.hasOwnProperty.call(a,
"deleted")||(virtualclass.sharePt.activeppts.push(a),b=document.querySelector(`#linkppt${a.fileuuid}`),null!=b&&b.classList.remove("noPpt"),virtualclass.sharePt.afterPptSaved(a))}),virtualclass.config.makeWebSocketReady&&this.finallySendPptOrder(virtualclass.orderList[virtualclass.currApp].ol.order));(b=document.querySelector(".congrea #pptiframe"))&&b.getAttribute("src")&&virtualclass.vutil.showFinishBtn();virtualclass.vutil.makeElementActive("#listvideo")},retrieveOrder(){const b=new FormData;b.append("live_class_id",
virtualclass.gObj.congCourse);b.append("content_order_type","3");this.requestOrder(b)},requestOrder(b){virtualclass.vutil.requestOrder(a=>{virtualclass.vutil.isResponseAvailable(a)&&0<virtualclass.orderList[virtualclass.currApp].ol.order.length&&virtualclass.sharePt.reArrangeElements(virtualclass.orderList[virtualclass.currApp].ol.order)})},playPptUrl(b,a){virtualclass.sharePt.autoSlideTime=0;virtualclass.sharePt.autoSlideFlag=0;virtualclass.sharePt.startFromFlag=0;virtualclass.sharePt.eventsObj=
[];virtualclass.sharePt.state={indexh:0,indexv:0,indexf:0};virtualclass.sharePt.stateLocalStorage={};localStorage.removeItem("autoSlideTime");localStorage.removeItem("autoSlideFlag");null==document.getElementById("iframecontainer")&&virtualclass.sharePt.UI.createIframe();const d=document.getElementById(virtualclass.sharePt.UI.id);d.classList.contains("pptSharing")||d.classList.add("pptSharing");virtualclass.sharePt.setPptUrl(b,a)},cleanupUrl(b){const a=b.search("#");0<a&&(b=b.slice(0,a));return b},
setPptUrl(b,a){console.log("===> ppt share ",b);document.getElementById("iframecontainer").style.display="block";const d=document.getElementById("pptiframe");virtualclass.sharePt.pptUrl=`${b}?postMessage=true&postMessageEvents=true`;d.setAttribute("src",virtualclass.sharePt.pptUrl);ioAdapter.mustSend({pptMsg:"displayframe",cf:"ppt",user:"all",cfpt:"displayframe"});ioAdapter.mustSend({pptMsg:b,cf:"ppt",user:"all",cfpt:"setUrl",pptId:a});d.style.display="visible";document.querySelector(".congrea  #dashboardContainer .modal-header button.enable")||
virtualclass.vutil.showFinishBtn();virtualclass.sharePt.currId=a;virtualclass.userInteractivity.makeReadyContext()},validURLWithDomain(b){return/^(?:\w+:)?\/\/([^\s\.]+\.\S{2}|localhost[:?\d]*)\S*$/.test(b)},completeUrl(b){0<b.search("slides.com")&&0>b.search("embed")&&(b+="/embed");return b},extractUrl(b){if(0<b.search("src")){const a=b.match(/"(.*?)"/);if(0<a.length)return JSON.parse(a[0])}return b},isUrlip(b){b.slice(0,2);return/(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)/.test(b)},
saveIntoLocalStorage(b){},initTeacherLayout(){var b=document.getElementById("pptiframe");if(null!=document.getElementById("pptiframe")){const a={controls:!0,keyboard:!0,progress:!0,touch:!0};let d;virtualclass.sharePt.autoSlideTime&&virtualclass.sharePt.autoSlideFlag?d=virtualclass.sharePt.autoSlideTime:virtualclass.sharePt.autoSlideFlag&&(d=6E3);"undefined"!==typeof d&&1E3<d&&(a.autoSlide=d);b.contentWindow.postMessage(JSON.stringify({method:"configure",args:[a]}),"*");b.contentWindow.postMessage(JSON.stringify({method:"toggleAutoSlide"}),
"*")}b=document.getElementById("pptMessageLayout");null!=b&&(b.style.display="none");document.getElementById("urlcontainer")&&(document.getElementById("urlcontainer").style.display="block");virtualclass.sharePt.eventsObj=[]},initStudentLayout(){const b=document.getElementById("pptiframe");virtualclass.sharePt.eventsObj=[];virtualclass.sharePt.UI.messageDisplay();null!=document.getElementById("pptiframe")?(b.src&&virtualclass.sharePt.hideElement("pptMessageLayout"),b.contentWindow.postMessage(JSON.stringify({method:"configure",
args:[{controls:!1,autoSlide:0,autoSlideStoppable:!0,keyboard:!1,progress:!1,touch:!1}]}),"*")):virtualclass.sharePt.displayElement("pptMessageLayout");virtualclass.sharePt.hideElement("urlcontainer")},hideElement(b){b=document.getElementById(b);null!=b&&(b.style.display="none")},displayElement(b){b=document.getElementById(b);null!=b&&(b.style.display="block")},attachEvent(b,a,d){b=document.getElementById(b);null!=b&&b.addEventListener(a,d)},attachMessageEvent(b,a){c.addEventListener(b,a)},UI:{id:"virtualclassSharePresentation",
class:"virtualclass",container(){const b={control:!!roles.hasControls()},a=virtualclass.getTemplate("ppt","ppt");virtualclass.vutil.insertAppLayout(a(b))},createIframe(){var b=document.getElementById("iframecontainer");null!=b&&b.parentNode.removeChild(b);b=virtualclass.getTemplate("pptiframe","ppt");document.querySelector("#virtualclassSharePresentation").insertAdjacentHTML("beforeend",b())},messageDisplay(){var b=document.getElementById("pptMessageLayout");b&&b.parentNode.removeChild(b);b=virtualclass.getTemplate("mszdisplay",
"ppt");document.querySelector("#virtualclassSharePresentation").insertAdjacentHTML("beforeend",b())},removeIframe(){const b=document.getElementById("pptiframe");b&&b.parentNode.removeChild(b)}},remvovePLayClass(){const b=document.querySelector("#listppt .playing");null!==b&&b.classList.remove("playing")}}}})(window);(function(c){c.response={clearAll(b){virtualclass.wb[b].tool=new virtualclass.wb[b].toolObj("t_clearall",b);virtualclass.wb[b].utility.t_clearallInit(b);virtualclass.wb[b].utility.makeDefaultValue(void 0,b)},replayAll(){virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs;virtualclass.wb[virtualclass.gObj.currWb].utility.clearAll(!1,virtualclass.gObj.currWb);virtualclass.wb[virtualclass.gObj.currWb].toolInit({cmd:"t_replay",fromWhere:"fromFile",
wbId:virtualclass.gObj.currWb})},createArrow(b){const a=virtualclass.gObj.currWb,d=virtualclass.wb[a].arrImg,c={};c.mp={x:b.x*virtualclass.zoom.canvasScale,y:b.y*virtualclass.zoom.canvasScale};virtualclass.posY=c.mp.y;virtualclass.posX=c.mp.x;virtualclass.wb[virtualclass.gObj.currWb].utility.drawArrowImg(d,c);null!=virtualclass.pdfRender[a].scroll.Y&&virtualclass.pdfRender[a].customMoustPointer({y:virtualclass.posY},"Y",virtualclass.posY);null!=virtualclass.pdfRender[a].scroll.X&&virtualclass.pdfRender[a].customMoustPointer({x:virtualclass.posX},
"X",virtualclass.posX)},replayObj(b,a){virtualclass.wb[a].vcan.main.replayObjs=[];0<b.length&&(virtualclass.wb[a].vcan.main.replayObjs=b,virtualclass.wb[a].toolInit({cmd:"t_replay",fromWhere:"fromBrowser",multiUser:!0,myfunc:virtualclass.wb[a].utility.triggerCanvasEnable,wbId:a}))}}})(window);var LZString={_f:String.fromCharCode,_keyStrBase64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_keyStrUriSafe:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",_getBaseValue(c,b){LZString._baseReverseDic||(LZString._baseReverseDic={});if(!LZString._baseReverseDic[c]){LZString._baseReverseDic[c]={};for(let a=0;a<c.length;a++)LZString._baseReverseDic[c][c[a]]=a}return LZString._baseReverseDic[c][b]},compressToBase64(c){if(null==c)return"";c=LZString._compress(c,
6,b=>LZString._keyStrBase64.charAt(b));switch(c.length%4){default:case 0:return c;case 1:return`${c}===`;case 2:return`${c}==`;case 3:return`${c}=`}},decompressFromBase64(c){return null==c?"":""==c?null:LZString._decompress(c.length,32,b=>LZString._getBaseValue(LZString._keyStrBase64,c.charAt(b)))},compressToUTF16(c){return null==c?"":`${LZString._compress(c,15,b=>String.fromCharCode(b+32))} `},decompressFromUTF16(c){return null==c?"":""==c?null:LZString._decompress(c.length,16384,b=>c.charCodeAt(b)-
32)},compressToUint8Array(c){c=LZString.compress(c);const b=new Uint8Array(2*c.length);for(let a=0,d=c.length;a<d;a++){const d=c.charCodeAt(a);b[2*a]=d>>>8;b[2*a+1]=d%256}return b},decompressFromUint8Array(c){if(null===c||void 0===c)return LZString.decompress(c);const b=Array(c.length/2);for(let a=0,f=b.length;a<f;a++)b[a]=256*c[2*a]+c[2*a+1];const a=[];b.forEach(b=>{a.push(String.fromCharCode(b))});return LZString.decompress(a.join(""))},compressToEncodedURIComponent(c){return null==c?"":LZString._compress(c,
6,b=>LZString._keyStrUriSafe.charAt(b))},decompressFromEncodedURIComponent(c){if(null==c)return"";if(""==c)return null;c=c.replace(/ /g,"+");return LZString._decompress(c.length,32,b=>LZString._getBaseValue(LZString._keyStrUriSafe,c.charAt(b)))},compress(c){return LZString._compress(c,16,b=>String.fromCharCode(b))},_compress(c,b,a){if(null==c)return"";let d,f;const g={},k={};let m,n,r="",t=2,z=3,v=2;const u=[];let p=0,q=0,A;for(A=0;A<c.length;A+=1)if(m=c[A],Object.prototype.hasOwnProperty.call(g,
m)||(g[m]=z++,k[m]=!0),n=r+m,Object.prototype.hasOwnProperty.call(g,n))r=n;else{if(Object.prototype.hasOwnProperty.call(k,r)){if(256>r.charCodeAt(0)){for(d=0;d<v;d++)p<<=1,q==b-1?(q=0,u.push(a(p)),p=0):q++;f=r.charCodeAt(0);for(d=0;8>d;d++)p=p<<1|f&1,q==b-1?(q=0,u.push(a(p)),p=0):q++,f>>=1}else{f=1;for(d=0;d<v;d++)p=p<<1|f,q==b-1?(q=0,u.push(a(p)),p=0):q++,f=0;f=r.charCodeAt(0);for(d=0;16>d;d++)p=p<<1|f&1,q==b-1?(q=0,u.push(a(p)),p=0):q++,f>>=1}t--;0==t&&(t=Math.pow(2,v),v++);delete k[r]}else for(f=
g[r],d=0;d<v;d++)p=p<<1|f&1,q==b-1?(q=0,u.push(a(p)),p=0):q++,f>>=1;t--;0==t&&(t=Math.pow(2,v),v++);g[n]=z++;r=String(m)}if(""!==r){if(Object.prototype.hasOwnProperty.call(k,r)){if(256>r.charCodeAt(0)){for(d=0;d<v;d++)p<<=1,q==b-1?(q=0,u.push(a(p)),p=0):q++;f=r.charCodeAt(0);for(d=0;8>d;d++)p=p<<1|f&1,q==b-1?(q=0,u.push(a(p)),p=0):q++,f>>=1}else{f=1;for(d=0;d<v;d++)p=p<<1|f,q==b-1?(q=0,u.push(a(p)),p=0):q++,f=0;f=r.charCodeAt(0);for(d=0;16>d;d++)p=p<<1|f&1,q==b-1?(q=0,u.push(a(p)),p=0):q++,f>>=1}t--;
0==t&&(t=Math.pow(2,v),v++);delete k[r]}else for(f=g[r],d=0;d<v;d++)p=p<<1|f&1,q==b-1?(q=0,u.push(a(p)),p=0):q++,f>>=1;t--;0==t&&v++}f=2;for(d=0;d<v;d++)p=p<<1|f&1,q==b-1?(q=0,u.push(a(p)),p=0):q++,f>>=1;for(;;)if(p<<=1,q==b-1){u.push(a(p));break}else q++;return u.join("")},decompress(c){return null==c?"":""==c?null:LZString._decompress(c.length,32768,b=>c.charCodeAt(b))},_decompress(c,b,a){const d=[];let f=4,g=4,k=3;const m=[];var n;let r,t,z,v;const u=LZString._f;var p=a(0),q=b,A=1;for(n=0;3>n;n+=
1)d[n]=n;r=0;z=Math.pow(2,2);for(v=1;v!=z;)t=p&q,q>>=1,0==q&&(q=b,p=a(A++)),r|=(0<t?1:0)*v,v<<=1;switch(r){case 0:r=0;z=Math.pow(2,8);for(v=1;v!=z;)t=p&q,q>>=1,0==q&&(q=b,p=a(A++)),r|=(0<t?1:0)*v,v<<=1;var D=u(r);break;case 1:r=0;z=Math.pow(2,16);for(v=1;v!=z;)t=p&q,q>>=1,0==q&&(q=b,p=a(A++)),r|=(0<t?1:0)*v,v<<=1;D=u(r);break;case 2:return""}n=d[3]=D;for(m.push(D);;){if(A>c)return"";r=0;z=Math.pow(2,k);for(v=1;v!=z;)t=p&q,q>>=1,0==q&&(q=b,p=a(A++)),r|=(0<t?1:0)*v,v<<=1;switch(D=r){case 0:r=0;z=Math.pow(2,
8);for(v=1;v!=z;)t=p&q,q>>=1,0==q&&(q=b,p=a(A++)),r|=(0<t?1:0)*v,v<<=1;d[g++]=u(r);D=g-1;f--;break;case 1:r=0;z=Math.pow(2,16);for(v=1;v!=z;)t=p&q,q>>=1,0==q&&(q=b,p=a(A++)),r|=(0<t?1:0)*v,v<<=1;d[g++]=u(r);D=g-1;f--;break;case 2:return m.join("")}0==f&&(f=Math.pow(2,k),k++);if(d[D])D=d[D];else if(D===g)D=n+n[0];else return null;m.push(D);d[g++]=n+D[0];f--;n=D;0==f&&(f=Math.pow(2,k),k++)}}};"undefined"!==typeof module&&null!=module&&(module.exports=LZString);window.addEventListener("message",c=>{if(c.origin===window.location.origin)if("gotScreen"===c.data.type){let b;if(""===c.data.sourceId){virtualclass.vutil.beforeSend({sd:!0,cf:"colorIndicator"});c=Error("NavigatorUserMediaError");c.name="PERMISSION_DENIED";if(Object.prototype.hasOwnProperty.call(virtualclass,"ss"))virtualclass.ss.onError(c);if("SharePresentation"===virtualclass.currApp||"DocumentShare"===virtualclass.currApp)c=document.querySelector("#dashboardnav button"),null!=c&&c.click();roles.hasControls()&&
virtualclass.vutil.initDefaultApp()}else b=b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:c.data.sourceId,maxWidth:1440,maxHeight:9999},optional:[{maxFrameRate:3},{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},virtualclass.adpt=new virtualclass.adapter,virtualclass.adpt.init(navigator).getUserMedia(b,a=>{virtualclass.ss.initInternal();virtualclass.ss.initializeRecorder.call(virtualclass.ss,a)},a=>{virtualclass.ss.onError.call(virtualclass.ss,a)});if(c=document.querySelector("#virtualclassScreenShareLocalSmall"))c.style.display=
"block"}else"getScreenPending"===c.data.type?window.clearTimeout(c.data.id):"yes"===c.data.type&&(virtualclass.gObj.ext=!0)});(function(c){c.dirtyCorner={decodeRGB(b,a,d){a=a.createImageData(d.width,d.height);for(d=0;d<4*b.length;d++)a.data[4*d]=36.5*(b[d]>>5),a.data[4*d+1]=36.5*((b[d]&28)>>2),a.data[4*d+2]=85*(b[d]&3),a.data[4*d+3]=255;return a},decodeRGBSlice(b,a,d){a=a.createImageData(d.w,d.h);for(d=0;d<4*b.length;d++)a.data[4*d]=36.5*(b[d]>>5),a.data[4*d+1]=36.5*((b[d]&28)>>2),a.data[4*d+2]=85*(b[d]&3),a.data[4*d+3]=255;return a},encodeRGB(b){const a=b.length/4,d=new Uint8ClampedArray(a);let c,g;for(let f=0;f<a;f++){var k=
b[4*f];c=b[4*f+1];g=b[4*f+2];k=(Math.round(k/36.5)<<5)+(Math.round(c/36.5)<<2)+Math.round(g/85);d[f]=k}return d},str2ImageData(b,a){a=context2.createImageData(a.w,a.h);var d=new ArrayBuffer(b.length);a.data=new Uint8Array(d);for(d=0;d<strLen;d++)a.data[d]=b.charCodeAt(d);return a},doClearCanvas(){context2.clearRect(0,0,canvas2.width,canvas2.height)}}})(window);(function(c){c.vutil={createDOM(b,a,d){b=document.createElement(b);"undefined"!==typeof a&&(b.id=a);if("undefined"!==typeof d){a="";if(0<d.length)for(let b=0;b<d.length;b++)a+=`${d[b]} `;b.className=a}return b},ab2str(b){return String.fromCharCode.apply(null,new Uint8ClampedArray(b))},str2ab(b){var a=new ArrayBuffer(b.length);a=new Uint8ClampedArray(a);for(let d=0,c=b.length;d<c;d++)a[d]=b.charCodeAt(d);return a},sidebarHeightInit(){document.getElementById("widgetRightSide").style.height=`${c.innerHeight}px`},
isSystemCompatible(){if(0<virtualclass.error.length){const b=1<virtualclass.error.length?virtualclass.error.join("<br />"):virtualclass.error[0];virtualclass.view.createErrorMsg(b,"errorContainer","virtualclassAppFooterPanel");Object.prototype.hasOwnProperty.call(virtualclass.gObj,"errIE")&&virtualclass.vutil.disableVirtualClass();Object.prototype.hasOwnProperty.call(virtualclass.gObj,"audIntDisable")&&virtualclass.user.control.mediaWidgetDisable();Object.prototype.hasOwnProperty.call(virtualclass.gObj,
"errNotDesktop")&&(virtualclass.user.control.mediaWidgetDisable(),virtualclass.vutil.disableVirtualClass())}else(Object.prototype.hasOwnProperty.call(virtualclass.gObj,"audIntDisable")||Object.prototype.hasOwnProperty.call(virtualclass.gObj,"vidIntDisable"))&&virtualclass.user.control.mediaWidgetDisable()},chkValueInLocalStorage(b){return null===localStorage.getItem(b)?!1:localStorage[b]},setScreenInnerTagsWidth(b){document.getElementById(b);document.getElementById(`${b}Local`);document.getElementById(`${b}LocalVideo`)},
makeActiveApp(b,a){if(b!==a&&"undefined"!==typeof a)a+="Tool",document.getElementById(a).className=virtualclass.vutil.removeClassFromElement(a,"active");else{a=document.getElementsByClassName("appOptions");for(let b=0;b<a.length;b++)a[b].classList.contains("active")&&a[b].classList.remove("active")}document.getElementById(`${b}Tool`).className+=" active"},initInstallChromeExt(b){"EXTENSION_UNAVAILABLE"===b.name&&this._inlineChomeExtensionStore()},_inlineChomeExtensionStore(){chrome.webstore.install("https://chrome.google.com/webstore/detail/ijhofagnokdeoghaohcekchijfeffbjl",
b=>{c.location.reload()},b=>{alert(b)})},removeAppPanel(){const b=document.getElementById("virtualclassOptionsCont");null!=b&&b.parentNode.removeChild(b)},removeTempVideo(b){b=document.getElementById(b);b.parentNode.removeChild(b)},createLocalTempVideo(b,a){let d;if("string"===typeof b||"String"===typeof b)d=document.getElementById(b);b=virtualclass.vutil.createDOM("div",a);a=virtualclass.vutil.createDOM("canvas",`${a}Video`);b.appendChild(a);d.appendChild(b)},initLocCanvasCont(b){let a;a="ScreenShare"===
virtualclass.currApp?"ss":"wss";virtualclass[a].localtempCanvas=document.getElementById(b);virtualclass[a].localtempCont=virtualclass[a].localtempCanvas.getContext("2d")},videoTeacher2Student(b,a){let d=b;const c=document.getElementById(`virtualclass${b}LocalVideo`);if(null!=c&&"VIDEO"===c.tagName){const f=document.createElement("canvas");f.id=c.id;f.width=c.offsetWidth;f.height=c.offsetHeight;c.parentNode.replaceChild(f,c);"ScreenShare"===d&&(d="ss");"undefined"!==typeof a||"undefined"===typeof d||
"ss"!==d&&"wss"!==d||(virtualclass[d].localCanvas=f,virtualclass[d].localCont=virtualclass[d].localCanvas.getContext("2d"),a=virtualclass[d].localtempCont.getImageData(0,0,virtualclass[d].localtempCanvas.width,virtualclass[d].localtempCanvas.height),virtualclass[d].localCont.putImageData(a,0,0));virtualclass.vutil.removeTempVideo(`virtualclass${b}LocalTemp`)}},clickOutSideCanvas(){this.exitTextWrapper()&&virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.textUtility(virtualclass.wb[virtualclass.gObj.currWb].gObj.spx,
virtualclass.wb[virtualclass.gObj.currWb].gObj.spy)},exitTextWrapper(){return 0<document.getElementsByClassName("textBoxContainer").length},attachClickOutSideCanvas(){function b(a){a=document.getElementById(a);null!=a&&(a.onclick=function(){roles.hasControls()&&virtualclass.vutil.clickOutSideCanvas()})}b("commandToolsWrapper");b("virtualclassOptionsCont");b("audioWidget");b("chatWidget")},dimensionMatch(b,a){b=document.getElementById(b).offsetWidth;const d=document.getElementById("virtualclassOptionsCont").offsetWidth;
a=document.getElementById(a);return null!=a?a.offsetWidth+d===b:!1},disableAppsBar(){const b=document.getElementById("virtualclassOptionsCont");null!=b&&(b.style.pointerEvents="none")},isObjectEmpty(b){for(const a in b)if(Object.prototype.hasOwnProperty.call(b,a))return!1;return!0},removeSessionTool(){if(!roles.hasAdmin()){const b=document.getElementById("virtualclassSessionEndTool");null!=b&&b.parentNode.removeChild(b)}},Fullscreen(b){b="askFullscreen"===b.target.id?document.getElementById("virtualclassAppRightPanel"):
document.documentElement;b.requestFullscreen?b.requestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen?b.webkitRequestFullscreen():b.msRequestFullscreen&&b.msRequestFullscreen();b.classList.add("fullScreenMode")},closeFullscreen(b){"askExitFullscreen"===b.target.id?(b=document.getElementById("virtualclassAppRightPanel"),virtualclass.gObj.ignoreFullScreen=!0):b=document.documentElement;document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?
document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();b.classList.remove("fullScreenMode")},installPwaBtn(){const b=document.getElementById("installContainer");console.log("\ud83d\udc4d","butInstall-clicked");const a=c.deferredPrompt;a?(a.prompt(),a.userChoice.then(a=>{console.log("\ud83d\udc4d","userChoice",a);c.deferredPrompt=null;"accepted"===a.outcome?(console.log("User accepted the install prompt"),
b.classList.toggle("hidden",!0),document.querySelector(".mobileLandscapeWarn").classList.add("pwaInstalled")):console.log("User dismissed the install prompt")})):console.log("App is already added to your home screen")},closedRightbar(){const b=document.getElementById("virtualclassApp");b.classList.remove("openRightbar");b.classList.add("collapsedRightbar");chat_div.classList.add("collapsedRightbar");localStorage.setItem("hideRightbar",!0);virtualclass.gObj.hideRightbar=localStorage.getItem("hideRightbar");
roles.isStudent()&&ioAdapter.sendSpeed(3)},openRightbar(){localStorage.removeItem("hideRightbar");const b=document.getElementById("virtualclassApp");localStorage.setItem("hideRightbar",!1);virtualclass.gObj.hideRightbar=localStorage.getItem("hideRightbar");b.classList.remove("collapsedRightbar");b.classList.add("openRightbar");chat_div.classList.remove("collapsedRightbar");roles.isStudent()&&("desktop"===virtualclass.system.device?ioAdapter.sendSpeed(1):null!=document.querySelector("#techVideo.active")&&
virtualclass.vutil.sendSpeedByMobile(1))},addClass(b,a){const d=document.getElementById(b);virtualclass.vutil.elemHasAnyClass(b)?d.classList.add(a):d.className=a},removeClass(b,a){const d=document.getElementById(b);virtualclass.vutil.elemHasAnyClass(b)&&d.classList.contains(a)&&d.classList.remove(a)},breakIntoBytes(b,a){b=b.toString();for(let d=b.length;d<a;d++)b=`0${b}`;return b.match(/[\S]{1,2}/g)||[]},numValidateFour(b,a,d,c){b=this.preNumValidateTwo(b);a=this.preNumValidateTwo(a);d=this.preNumValidateTwo(d);
c=this.preNumValidateTwo(c);return+(b+a+d+c)},numValidateTwo(b,a){b=this.preNumValidateTwo(b);a=this.preNumValidateTwo(a);return+(b+a)},preNumValidateTwo(b){b=b.toString();if(1===b.length)return`0${b}`;if(2===b.length)return b},elemHasAnyClass(b){b=document.getElementById(b);return null!=b?"undefined"!==typeof b.classList:!1},userIsOrginalTeacher(b){return roles.hasAdmin()},isUserTeacher(b){return roles.hasControls()},initDisableAudVid(){virtualclass.gObj.audIntDisable=!0;virtualclass.gObj.vidIntDisable=
!0},initDisableVirtualClass(){this.initDisableAudVid();virtualclass.gObj.errNotDesktop=!0;virtualclass.gObj.errNotScreenShare=!0;virtualclass.gObj.errAppBar=!0},disableVirtualClass(){const b=document.getElementById("virtualclassCont");b.style.opacity=.6;b.style.pointerEvents="none"},enableVirtualClass(){const b=document.getElementById("virtualclassCont");b.style.opacity=1;b.style.pointerEvents="visible"},firstiOSaudioCall(){Object.prototype.hasOwnProperty.call(virtualclass.gObj,"audioPlayMessage")&&
(virtualclass.gObj.iosIpadbAudTrue=!0,virtualclass.media.audio.receivedAudioProcess(virtualclass.gObj.audioPlayMessage))},async beforeLoad(){if(!virtualclass.isPlayMode)if(virtualclass.wb[virtualclass.gObj.currWb]&&virtualclass.wb[virtualclass.gObj.currWb].selectedTool&&(localStorage.activeTool=`t_${virtualclass.wb[virtualclass.gObj.currWb].selectedTool}${virtualclass.gObj.currWb}`,console.log("====> suman selected tool ",localStorage.activeTool)),roles.hasControls()&&null!==document.querySelector("#virtualclassAppRightPanel.vidShow")&&
ioAdapter.mustSend({congCtr:{videoSwitch:"off"},cf:"congController"}),virtualclass.gObj.prvRequestScreenUser&&virtualclass.config.makeWebSocketReady&&ioAdapter.mustSendUser({cancel:!0,cf:"reqscreen"},virtualclass.gObj.prvRequestScreenUser),virtualclass.userInteractivity.rendererObj.noteEvent&&(console.log("====> send note on page load"),virtualclass.userInteractivity.handler(virtualclass.userInteractivity.rendererObj.noteEvent)),virtualclass.gObj.windowLoading=!0,Object.prototype.hasOwnProperty.call(virtualclass.recorder,
"doSessionClear"))virtualclass.clearSession();else if(0===localStorage.length)virtualclass.storage.clearStorageData();else{localStorage.removeItem("otherRole");Object.prototype.hasOwnProperty.call(virtualclass.gObj,"audIntDisable")||virtualclass.media.audio.studentNotSpeak();virtualclass.vutil.clickOutSideCanvas();Object.prototype.hasOwnProperty.call(virtualclass,"editorRich")&&"object"===typeof virtualclass.editorRich.vcAdapter&&virtualclass.editorRich.saveIntoLocalStorage();Object.prototype.hasOwnProperty.call(virtualclass,
"editorCode")&&"object"===typeof virtualclass.editorCode.vcAdapter&&virtualclass.editorCode.saveIntoLocalStorage();var b={name:virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp)};if("ScreenShare"===virtualclass.currApp){b.name=virtualclass.gObj.defaultApp;var a=virtualclass.vutil.whoIsTeacher();virtualclass.gObj.studentSSstatus.mesharing&&roles.isStudent()?ioAdapter.mustSendUser({cf:"rmStdScreen"},a):roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing&&(a=document.querySelector("#virtualclassWhiteboard .canvasContainer.current"),
await ioAdapter.mustSend({dispWhiteboard:!0,cf:"dispWhiteboard",d:null!=a?a.dataset.wbId:"_doc_0_0"}),await ioAdapter.mustSend({unshareScreen:!0,st:"ss",cf:"unshareScreen"}));roles.isStudent()&&!virtualclass.gObj.studentSSstatus.mesharing||roles.hasControls()}else"Yts"===virtualclass.currApp?"undefined"!==typeof virtualclass.yts.videoId&&"object"===typeof virtualclass.yts.player&&(b.metaData={init:virtualclass.yts.videoId,startFrom:virtualclass.yts.player.getCurrentTime()}):"SharePresentation"===
virtualclass.currApp?"undefined"!==typeof virtualclass.sharePt&&"object"===typeof virtualclass.sharePt&&virtualclass.sharePt.pptUrl?(b.metaData={init:virtualclass.sharePt.pptUrl,startFrom:virtualclass.sharePt.state,currId:virtualclass.sharePt.currId},virtualclass.sharePt.saveIntoLocalStorage(b)):b.metaData=null:"Poll"!==virtualclass.currApp&&("Video"===virtualclass.currApp?(virtualclass.videoUl.player&&(a=virtualclass.videoUl.player.currentTime()),b.metaData={init:{videoId:virtualclass.videoUl.videoId,
videoUrl:virtualclass.videoUl.videoUrl,yts:virtualclass.videoUl.yts,online:virtualclass.videoUl.online,isPaused:virtualclass.videoUl.isPaused},startFrom:a,isAutoplay:virtualclass.videoUl.autoPlayFlag},roles.hasControls()&&!virtualclass.gObj.videoMode&&virtualclass.liveStream.mediaRecorder&&ioAdapter.mustSend({cf:"liveStream",stop:!0})):"DocumentShare"===virtualclass.currApp?(Object.prototype.hasOwnProperty.call(virtualclass.dts.docs,"currDoc")?({currDoc:a}=virtualclass.dts.docs,b.metaData=0<virtualclass.orderList.DocumentShare.ol.order.length?
{init:a,slideNumber:virtualclass.dts.docs.note.currNote,order:JSON.stringify(virtualclass.orderList.DocumentShare.ol.order)}:{init:"layout",slideNumber:null}):b.metaData={init:"layout",slideNumber:null},0<Object.keys(virtualclass.dts.pages).length&&(b.metaData.docs=virtualclass.dts.pages)):"Quiz"!==virtualclass.currApp&&"Whiteboard"===virtualclass.currApp&&(b={name:"Whiteboard",wbn:virtualclass.gObj.wbCount}));roles.hasControls();null!=virtualclass.zoom.canvasScale&&(virtualclass.vutil.isNumeric(+virtualclass.zoom.canvasScale),
Object.prototype.hasOwnProperty.call(virtualclass.zoom,"canvasDimension"));roles.hasView()&&"Yts"===virtualclass.currApp&&(b={name:"Yts",metaData:null});roles.hasControls()||(a=document.querySelector("#virtualclassCont.congrea #congAskQuestion.disable"))&&a.click();console.dir(`Previous object ${b}`);roles.hasControls();this.saveWbOrder();virtualclass.isPlayMode&&localStorage.clear();"DocumentShare"!==virtualclass.currApp&&io.disconnect()}},initOnBeforeUnload(b){"iOS"===b?document.body.onunload=function(){virtualclass.vutil.beforeLoad()}:
c.onbeforeunload=function(){const a=virtualclass.vutil.smallizeFirstLetter(virtualclass.currApp);virtualclass.vutil.beforeLoad();if(("editorRich"===a||"editorCode"===a)&&"Synchronized"!==virtualclass[a].cmClient.state.constructor.name)return virtualclass.lang.getString("editorinsync")}},isPlayMode(){return 1==c.wbUser.virtualclassPlay},progressBar(b,a,d,c){a>b&&(a=b,document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"));b=0===b&&0===a?0:Math.round(100*a/
b);document.getElementById(d).style.width=`${b}%`;document.getElementById(c).innerHTML=`${b}%`},hidePrevIcon(b){const a=document.getElementById(virtualclass.previous);null!=a&&(a.style.display="none","ss"===b?"object"===typeof virtualclass[b]&&(document.getElementById(virtualclass[b].id).style.display="block"):document.getElementById(virtualclass[b].id).style.display="block")},getUserInfo(b,a,d){if(null!=d)for(let c=0;c<d.length;c++)if(+d[c].userid===+a)return d[c][b]},getUserAllInfo(b,a){if("undefined"!==
typeof b&&"undefined"!==typeof a)for(let d=0;d<a.length;d++)if(+a[d].userid===+b)return a[d];return!1},smallizeFirstLetter(b){return b.charAt(0).toLowerCase()+b.slice(1)},capitalizeFirstLetter(b){return b.charAt(0).toUpperCase()+b.slice(1)},removeClassFromElement(b,a){b=document.getElementById(b);if(null!==b&&0<b.classList.length)return b.classList.remove(a),b.className},beforeSend(b,a,d){const c=virtualclass.gObj.currWb;Object.prototype.hasOwnProperty.call(b,"createArrow")?(b=JSON.stringify(b),virtualclass.wb[c].vcan.optimize.sendPacketWithOptimization(b,
300)):Object.prototype.hasOwnProperty.call(b,"repObj")&&"undefined"===typeof b.repObj[b.repObj.length-1]||(JSON.stringify(b),"undefined"!==typeof d&&!0===d?"undefined"===typeof a||!1===a||null===a?ioAdapter.send(b):ioAdapter.sendUser(b,a):"undefined"===typeof a||!1===a||null===a?ioAdapter.mustSend(b):ioAdapter.mustSendUser(b,a))},breakintobytes(b,a){b=b.toString();for(let d=b.length;d<a;d++)b=`0${b}`;return b.match(/[\S]{1,2}/g)||[]},createDiv(b,a,d,c){const f=virtualclass.lang.getString(a),k=document.createElement("a");
k.href="#";const m=document.createElement("div");m.id=b;"undefined"!==typeof c&&(m.className=c);m.dataset.tool=a;c=document.createElement("span");c.className=`icon-${a}`;k.appendChild(c);k.dataset.title=f;k.className="tooltip";m.appendChild(k);"t_reclaim"===b?(b=document.getElementById("virtualclassAppLeftPanel"),d.appendChild(m),b.insertBefore(d,b.firstChild)):d.appendChild(m)},renderWhiteboardObjectsIfAny(){"object"===typeof virtualclass.wb&&0<virtualclass.wb[virtualclass.gObj.currWb].vcan.main.children.length&&
virtualclass.wb[virtualclass.gObj.currWb].vcan.renderAll()},createCommandWrapper(b){var {vcan:a}=virtualclass.wb[b];const d=document.createElement("div");d.id=virtualclass.gObj.commandToolsWrapperId[b];d.className="commandToolsWrapper";a=document.getElementById(a.canvasWrapperId);null!=a?document.getElementById(`containerWb${b}`).insertBefore(d,a):document.getElementById(`containerWb${b}`).appendChild(d);return d},createRoleWrapper(){const b=document.createElement("div");b.id="commandToolsWrapper_doc_0_0";
b.className="commandToolsWrapper";return b},whoIsTeacher(){if(Object.prototype.hasOwnProperty.call(virtualclass,"connectedUsers"))for(let b=0;b<virtualclass.connectedUsers.length;b++)if("t"===virtualclass.connectedUsers[b].role)return virtualclass.connectedUsers[b].userid},getTeacherInstance(){if(Object.prototype.hasOwnProperty.call(virtualclass,"connectedUsers"))for(let b=0;b<virtualclass.connectedUsers.length;b++)if("t"===virtualclass.connectedUsers[b].role)return virtualclass.connectedUsers[b];
return 0},getMySelf(){if(Object.prototype.hasOwnProperty.call(virtualclass,"connectedUsers"))for(let b=0;b<virtualclass.connectedUsers.length;b++)if(virtualclass.connectedUsers[b].userid===virtualclass.gObj.uid)return virtualclass.connectedUsers[b]},enablePresentatorEditors(b){b={toUser:b,status:!0};virtualclass.user.control.receivedEditorRich(b);virtualclass.user.control.receivedEditorCode(b)},getClassName(b){let a;"t"===b?a="teacher":"e"===b?a="educator":"s"===b?a="student":"p"===b&&(a="presenter");
return a},isPresenterExist(){for(let b=0;b<virtualclass.connectedUsers.length;b++)if("p"===virtualclass.connectedUsers[b].role)return!0;return!1},setReadModeWhenTeacherIsDisConn(b){if(!roles.hasAdmin()){let a=localStorage.getItem("oTDisconn");null!=a&&(a=JSON.parse(a))&&Object.prototype.hasOwnProperty.call(virtualclass,b)&&"object"===typeof virtualclass[b].cm&&virtualclass[b].cm.setOption("readOnly","nocursor")}},setReadModeWhenTeacherIsConn(b){localStorage.removeItem("oTDisconn");const a=document.getElementById(`${virtualclass.vutil.capitalizeFirstLetter(b)}writeModeBox`);
null!=a&&("true"===a.getAttribute("data-write-mode")?virtualclass[b].cm.setOption("readOnly",!1):virtualclass[b].cm.setOption("readOnly","nocursor"))},isTeacherAlreadyExist(b){if(Object.prototype.hasOwnProperty.call(virtualclass,"connectedUsers"))for(let a=0;a<virtualclass.connectedUsers.length;a++)if(("t"===virtualclass.connectedUsers[a].role||"e"===virtualclass.connectedUsers[a].role)&&virtualclass.connectedUsers[a].userid!==b)return!0;return!1},getPresenterId(){if(Object.prototype.hasOwnProperty.call(virtualclass,
"connectedUsers"))for(let b=0;b<virtualclass.connectedUsers.length;b++)if("p"===virtualclass.connectedUsers[b].role)return virtualclass.connectedUsers[b].userid;return!1},isEducatorAlreadyExist(b){if(Object.prototype.hasOwnProperty.call(virtualclass,"connectedUsers"))for(let a=0;a<virtualclass.connectedUsers.length;a++)if("e"===virtualclass.connectedUsers[a].role&&virtualclass.connectedUsers[a].userid!==b)return!0;return!1},isOrginalTeacherExist(b){if(Object.prototype.hasOwnProperty.call(virtualclass,
"connectedUsers"))for(let a=0;a<virtualclass.connectedUsers.length;a++)if("t"===virtualclass.connectedUsers[a].role&&virtualclass.connectedUsers[a].userid!==b)return!0;return!1},createBecomeTeacherWidget(){if(null==document.getElementById("beTeacher")){const a=document.createElement("div");a.id="beTeacher";var b=document.createElement("a");b.id=`${a.id}Anchor`;b.innerHTML=virtualclass.lang.getString("becomeTeacher");a.appendChild(b);b=document.getElementById("virtualclassCont");b.insertBefore(a,b.firstChild);
a.addEventListener("click",virtualclass.vutil.initTeacherRole);a.style.pointerEvents="none";a.style.opacity="0.5";setTimeout(()=>{a.style.pointerEvents="visible";a.style.opacity="1"},6E4)}},removeBecomeTeacherWidget(){const b=document.getElementById("beTeacher");null!=b&&b.parentNode.removeChild(b)},initTeacherRole(){ioAdapter.send({cf:"bt"});virtualclass.vutil.removeBecomeTeacherWidget();setTimeout(()=>{virtualclass.vutil.isOrginalTeacherExist(virtualclass.jId)||virtualclass.vutil.overrideRoles("t");
c.location.reload()},virtualclass.gObj.mySetTime)},overrideRoles(b){virtualclass.uInfo.userobj.role=b;virtualclass.gObj.uRole=virtualclass.uInfo.userobj.role;wbUser.role=virtualclass.uInfo.userobj.role;const a=document.getElementById("virtualclassCont");virtualclass.vutil.overrideRolesFromElem(a,b)},overrideRolesFromElem(b,a){"s"===a?(b.classList.remove("teacher"),b.classList.remove("orginalTeacher"),b.classList.remove("presenter"),b.classList.remove("educator"),virtualclassCont.classList.add("student")):
"p"===a?(b.classList.remove("teacher"),b.classList.remove("orginalTeacher"),b.classList.remove("educator"),virtualclassCont.classList.add("student"),virtualclassCont.classList.add("presenter")):"e"===a?(b.classList.add("teacher"),b.classList.remove("student"),b.classList.remove("presenter"),b.classList.add("educator"),b.classList.add("orginalTeacher")):"t"===a&&(b.classList.remove("student"),b.classList.remove("educator"),b.classList.remove("presenter"),b.classList.add("teacher"),b.classList.add("orginalTeacher"))},
sesionEndMsgBoxIsExisting(){const b=document.getElementById("sessionEndMsgCont");return b.hasAttribute("data-displaying")&&"true"===b.dataset.displaying},removeVideoHostContainer(){const b=document.getElementById("videoHostContainer");null!=b&&b.parentNode.removeChild(b)},createDummyUser(b){let a=b;a=a?b:5E3;let d,c=0,g=31;const k=setInterval(()=>{c>a?clearInterval(k):(g+=c,d={joinUser:{key:g},message:[{lname:" ",name:`User${g}`,role:"s",userid:g}],newuser:null,type:"member_added",user:!0},c++,virtualclass.ioEventApi.readyto_member_add(d))},
1)},getVisibleHeightElem(b){var a=$(b);b=$(c).scrollTop();const d=b+$(c).height(),f=a.offset().top;a=f+a.outerHeight();return(a>d?d:a)-(f<b?b:f)},applyHeight(b){b=document.getElementById("virtualclassAppRightPanel");const a=this.getVisibleHeightElem("virtualclassCont");b.style.height=null!=a?a:c.innerHeight},insertIntoLeftBar(b){const a=document.querySelector("#virtualclassApp #virtualclassAppLeftPanel");null!=a?a.appendChild(b):alert("Error:- There is no Element to insert it.")},getWhiteboardId(b){b=
b.closest(".vcanvas");if(null!=b)return b.dataset.wbId;alert("doc element is null")},getElementOffset(b){let a=0,d=0;do a+=b.offsetTop||0,d+=b.offsetLeft||0,b=b.offsetParent;while(b);return{x:d,y:a}},updateCurrentDoc(b){virtualclass.gObj.currWb=`_doc_${b}_${b}`},getParentTag(b,a){return b.closest(a)},attachEventToUploadTab(b,a,d){b=document.getElementById("newDocBtn");null!=b&&(b.removeEventListener("click",virtualclass.vutil._attachEventToUploadTab),b.addEventListener("click",virtualclass.vutil._attachEventToUploadTab))},
_attachEventToUploadTab(){var b=document.querySelector("#DocumentShareDashboard .qq-upload-button-selector.qq-upload-button input");if(null!=b){if(b.click(),b=document.querySelector("#DocumentShareDashboard .qq-upload-list-selector.qq-upload-list"))b.style.display="block"}else alert("Element is null")},attachEventToUpload(b,a,d){b=document.getElementById("uploadVideo");null!=b&&b.addEventListener("click",()=>{const a=document.querySelector("#VideoDashboard .qq-upload-button-selector.qq-upload-button input");
null!=a?a.click():alert("Element is null")})},modalPopup(b,a){const d={};if("video"===b){const a=document.querySelector("#listvideo .playing");a&&(this.currPlaying=a.getAttribute("data-rid"));d.validation="mp4 avi wmv mov webm mkv vob mpeg".split(" ");d.cb=virtualclass.videoUl.afterUploadVideo;d.cthis="video";d.maxSize=512E6;d.requesteEndPoint=`${c.webapi}&methodname=file_save&live_class_id=${virtualclass.gObj.congCourse}&status=1&content_type_id=2&user=${virtualclass.gObj.uid}`}else d.validation=
"doc docx txt html csv pdf ppt pptx xls xlsx xlt png jpg gif svg tiff rtf xpm".split(" "),d.cb=virtualclass.dts.onAjaxResponse,d.cthis="docs",d.maxSize=1E8,d.requesteEndPoint=`${c.webapi}&methodname=congrea_image_converter&live_class_id=${virtualclass.gObj.congCourse}&status=1&content_type_id=1&user=${virtualclass.gObj.uid}`;d.multiple=!1;d.wrapper=document.getElementById(a[0]);virtualclass.fineUploader.uploaderFn(d);"video"!==b&&(b=document.querySelector("#DocumentShareDashboard #docsUploadMsz"),
a=document.createElement("div"),b&&b.appendChild(a))},async xhrSendWithForm(b,a){const d=new FormData;for(const a in b)d.append(a,b[a]);return await this.vxhr.post("undefined"===typeof a?c.webapi:`${c.webapi}&methodname=${a}&user=${virtualclass.gObj.uid}`,d)},createSaveButton(){const b=document.createElement("div");b.id="tech_support_save";const a=document.createElement("span");a.innerHTML="Save Session";b.appendChild(a);return b},setChatContHeight(b){},setChatHeight(b){},alreadyConnected(b){return 0<
virtualclass.connectedUsers.length?0<virtualclass.connectedUsers.filter(a=>a.userid==b).length:!1},miliSecondsToFormatedTime(b){return[Math.floor(b/36E5%24),Math.floor(b/6E4%60),Math.floor(b/1E3%60)]},localToUTC(){var b=new Date;b=Date.UTC(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate(),b.getUTCHours(),b.getUTCMinutes(),b.getUTCSeconds());return new Date(b)},UTCtoLocalTimeToSeconds(b){return(new Date(b)).getTime()},appIsForEducator(b){for(const a in virtualclass.apps)if(virtualclass.apps[a]===b)return!1;
return!0},getDocsDashBoard(b){const a=virtualclass.getTemplate("dashboard","documentSharing");b={app:b,hasControls:roles.hasControls()};return a(b)},getPptDashBoard(b){const a=virtualclass.getTemplate("dashboard","ppt");b={app:b,hasControls:roles.hasControls()};return a(b)},removeDashboardNav(){const b=document.querySelector("#dashboardnav");null!=b&&b.parentNode.removeChild(b)},makeElementDeactive(b){b=document.querySelector(b);null!=b&&(b.style.pointerEvents="none")},makeElementActive(b){b=document.querySelector(b);
null!=b&&(b.style.pointerEvents="visible")},initCommonSortingChat(){setTimeout(()=>{sortCommonChat()},800)},triggerDashboard(b,a){"DocumentShare"===b?null==document.querySelector("#screen-docs .note.current")&&(a?virtualclass.dashboard.init(b,a):virtualclass.dashboard.init(b)):"Video"===b?a?virtualclass.dashboard.init(b,a):virtualclass.dashboard.init(b):virtualclass.dashboard.init(b)},trimExtension(b){return b.replace(/\.[^/.]+$/,"")},hideUploadMsg(b){b=document.querySelector(`#${b} .qq-uploader-selector.qq-uploader.qq-gallery`);
null!=b&&b.setAttribute("qq-drop-area-text","")},showUploadMsg(b){b=document.querySelector(`#${b} .qq-uploader-selector.qq-uploader.qq-gallery`);null!=b&&b.setAttribute("qq-drop-area-text",virtualclass.lang.getString("dropfilehere"))},audioStatus(b,a){const d=b.getElementsByClassName("congtooltip")[0];"true"===a?(b.setAttribute("data-audio-playing","true"),d.setAttribute("data-title",virtualclass.lang.getString("audioEnable")),b.className="audioTool active"):(b.setAttribute("data-audio-playing","false"),
d&&d.setAttribute("data-title",virtualclass.lang.getString("audioDisable")),b.className="audioTool deactive")},selfVideoStatus(){const b=document.querySelector(".congrea .videoSwitchCont #videoSwitch");if(b.classList.contains("off"))return"off";if(b.classList.contains("on"))return"on"},videoController(){const b=document.querySelector(".congrea .videoSwitchCont");b&&b.addEventListener("click",()=>{virtualclass.vutil.videoHandler("off"===virtualclass.vutil.selfVideoStatus()?"on":"off")})},videoHandler(b,
a){let d;var c=document.querySelector(".congrea .videoSwitchCont #videoSwitch");if("on"===b){c.classList.remove("off");c.classList.add("on");d="on";c=document.querySelector(".videoSwitchCont");c.dataset.title=virtualclass.lang.getString("videooff");roles.hasControls()?virtualclass.videoHost.gObj.videoSwitch=1:virtualclass.videoHost.gObj.stdStopSmallVid=!1;c=chatContainerEvent.elementFromShadowDom(`#ml${virtualclass.gObj.uid} .user-details a span`);const a=chatContainerEvent.elementFromShadowDom(`#ml${virtualclass.gObj.uid} .user-details a img`);
c||a?virtualclass.videoHost.removeUserIcon(virtualclass.gObj.uid):virtualclass.gObj.delayVid="hide";roles.hasControls()&&virtualclass.videoHost.UI.displayTeacherVideo();const b=document.querySelector(`#ml${virtualclass.gObj.uid} video`);null!=b&&setTimeout(()=>{b.srcObject=virtualclass.media.stream},100)}else"off"===b&&(c.classList.remove("on"),c.classList.add("off"),d="off",c=document.querySelector(".videoSwitchCont"),c.dataset.title=virtualclass.lang.getString("videoon"),virtualclass.videoHost&&
(roles.hasControls()?virtualclass.videoHost.gObj.videoSwitch=0:virtualclass.videoHost.gObj.stdStopSmallVid=!0),chatContainerEvent.elementFromShadowDom(`#ml${virtualclass.gObj.uid} .user-details a .videoWrapper`)?virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid):virtualclass.gObj.delayVid="display",roles.hasControls()&&virtualclass.videoHost.UI.hideTeacherVideo());"undefined"===typeof a&&(virtualclass.gObj.meetingMode?virtualclass.multiVideo.setVideoStatus("off"!==b):virtualclass.gObj.uid===
virtualclass.vutil.whoIsTeacher()&&ioAdapter.mustSend({congCtr:{videoSwitch:d},cf:"congController"}),roles.hasControls()||ioAdapter.mustSend({stdVideoCtr:{videoSwitch:virtualclass.videoHost.gObj.stdStopSmallVid},cf:"stdVideoCtrl"}))},isChromeExtension(){c.postMessage({type:"isInstalled",id:1},"*");c.addEventListener("message",b=>{"yes"===b.data.type&&(virtualclass.gObj.chromeExt=!0)})},setWidth(b,a,d){document.querySelector(`#canvas${b}`).width=d},setHeight(b,a,d){document.querySelector(`#canvas${b}`).height=
d},getWidth(b){return b.width},getHeight(b){return b.height},getValueWithoutPixel(b){return parseInt(b,10)},removeDecimal(b){return b.toFixed(2)},getElemM(b,a){let d;"Y"===a?d=document.querySelector(`#${b}`).offsetHeight:"X"===a&&(d=document.querySelector(`#${b}`).offsetWidth);return this.getValueWithoutPixel(d)},getElemM2(b,a){let d;"Y"===a?d=document.querySelector(`#${b}`).offsetHeight:"X"===a&&(d=document.querySelector(`#${b}`).offsetWidth);return this.getValueWithoutPixel(d)},getElemHeight(b){b=
document.querySelector(`#${b}`).offsetHeight;return this.getValueWithoutPixel(b)},getElemWidth(b){b=document.querySelector(`#${b}`).offsetWidth;return this.getValueWithoutPixel(b)},visibleElementHeighOldt(b,a){let d=0;for(b=document.getElementById(b);b.offsetParent&&b.offsetParent.id!==a;)d+=b.offsetTop,b=b.offsetParent;return b.offsetHeight-d},elementIsVisible2(b){const a=b.getBoundingClientRect().top;b=b.getBoundingClientRect().bottom;return 0<=a&&b<=c.innerHeight},elementIsVisible(b){b=b.getBoundingClientRect();
const a=Math.max(document.documentElement.clientHeight,c.innerHeight);return!(0>b.bottom||0<=b.top-a)},getVisibleHeight(b){var a=$(`#${b}`);b=$(c).scrollTop();const d=b+$(c).height(),f=a.offset().top;a=f+a.outerHeight();return(a>d?d:a)-(f<b?b:f)},isNumeric(b){return!isNaN(parseFloat(b))&&isFinite(b)},setContainerDimension(b,a){},setDefaultScroll(){if(roles.hasControls()&&("Whiteboard"===virtualclass.currApp||"DocumentShare"===virtualclass.currApp)){const b=virtualclass.gObj.currWb;null!=b&&"object"===
typeof virtualclass.pdfRender[b]&&null!=virtualclass.pdfRender[b].canvasWrapper&&(virtualclass.pdfRender[b].canvasWrapper.scrollTop=1)}},createWhiteBoard(b,a){virtualclass.appInitiator.Whiteboard.call(virtualclass,{app:virtualclass.currApp,cusEvent:"byclick",data:b,position:a})},createHashString(b){let a=0;const d=b.length;for(let c=0;c<d;c++)a=31*a+b.charCodeAt(c),a&=a;return a},randomString(b){let a="";for(;0<b;--b)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*
Math.random())];return a},isBulkDataFetched(){return 0<virtualclass.serverData.rawData.video.length||0<virtualclass.serverData.rawData.docs.length||0<virtualclass.serverData.rawData.ppt.length},sendOrder(b,a){virtualclass.orderList["vid"===b?"Video":"docs"===b?"DocumentShare":"presentation"===b?"SharePresentation":virtualclass.currApp].ol.order=a;virtualclass.config.makeWebSocketReady&&(b={order:JSON.stringify(virtualclass.orderList)},virtualclass.xhrn.vxhrn.post(virtualclass.api.UpdateRoomMetaData,
b).then(a=>{console.log(a)}))},saveWbOrder(b){},requestOrder(b){virtualclass.config.makeWebSocketReady&&virtualclass.xhrn.vxhrn.post(virtualclass.api.GetRoomMetaData,{noting:!0}).then(a=>{if(null!=a.data.Item&&a.data.Item.order.S&&virtualclass.vutil.IsJsonString(a.data.Item.order.S)){a=JSON.parse(a.data.Item.order.S);for(const b in a)if("SharePresentation"===b||"DocumentShare"===b||"Video"===b)"object"!==typeof virtualclass.orderList[b]&&(virtualclass.orderList[b]=new OrderedList),virtualclass.orderList[b].ol=
a[b].ol;b("ok")}})},IsJsonString(b){try{JSON.parse(b)}catch(a){return!1}return!0},removeChildrens(b){b=document.querySelectorAll(b);for(let a=0;a<b.length;a++)b[a].parentNode.removeChild(b[a])},initAcitveElement(){let b,a;"Video"===virtualclass.currApp?(b="#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery",a="#listvideo"):"DocumentShare"===virtualclass.currApp&&(b="#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery",a="#listdocs");const d=document.querySelector(`#${virtualclass.currApp}Dashboard`);
null==d||d.classList.contains("uploading")?virtualclass.vutil.makeElementDeactive(b):(virtualclass.vutil.makeElementActive(b),virtualclass.vutil.makeElementDeactive(a))},isResponseAvailable(b){return null!=b&&"undefined"!==typeof b&&null!=b},navWhiteboard(b,a,d){const c=virtualclass.gObj.currWb;virtualclass.vutil.isTextWrapperExist()&&virtualclass.wb[c].obj.drawTextObj.finalizeTextIfAny(void 0,c);"undefined"!==typeof d?a.call(b,d):a.call(b)},removeAllTextWrapper(){const b=document.querySelectorAll(".canvasWrapper .textBoxContainer");
for(let a=0;a<b.length;a++)b[a].parentNode.removeChild(b[a])},isDashboardOpened(b){b=document.querySelector("#dashboardnav button");return null!=b&&b.classList.contains("clicked")},stopConnection(){io.webSocketConnected()&&io.disconnect();virtualclass.gObj.invalidlogin=!0},initDefaultApp:()=>{const b=document.querySelector(`#virtualclass${virtualclass.gObj.defaultApp}Tool a`);null!=b&&b.click(b)},initssSharing:b=>{virtualclass.gObj.whoIsSharing=b;b=chatContainerEvent.elementFromShadowDom(`#ml${b} .icon-stdscreenImg`);
null!=b&&b.setAttribute("data-dcolor","green")},removeSSsharing:()=>{const b=document.querySelector("#chat_div .controleCont.ssSharing");null!=b&&b.classList.remove("ssSharing");delete virtualclass.gObj.whoIsSharing;virtualclass.vutil.removeStudenScreenStatus()},informIamSharing:()=>{const b=virtualclass.vutil.whoIsTeacher();roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing&&ioAdapter.mustSendUser({cf:"sshare_user"},b)},resizeWindowIfBigger(){var {currWb:b}=virtualclass.gObj;b=document.querySelector(`#canvasWrapper${b}`);
null!=b&&60<c.innerWidth-(b.offsetWidth+320)&&system.initResize()},isTextWrapperExist(){return 0<document.querySelectorAll(".canvasWrapper .textBoxContainer").length},insertAppLayout:b=>{$("#virtualclassAppContainer").append(b)},prechkScrnShare(){document.getElementById("preCheckcontainer").style.display="none";document.getElementById("virtualclassApp").style.display="flex";localStorage.getItem("precheck")?virtualclass.videoHost._resetPrecheck():(virtualclass.popup.waitMsg(),virtualclass.makeReadySocket(),
virtualclass.videoHost.afterSessionJoin());virtualclass.gObj.precheckScrn=!1},showFinishBtn(){var b=document.querySelector(".congrea #dashboardContainer .modal-header button");b&&b.classList.add("enable");"DocumentShare"===virtualclass.currApp&&(b=document.querySelector("#virtualclassAppLeftPanel"),b.classList.add("showZoom"),b.classList.remove("hideZoom"))},removeFinishBtn(){var b=document.querySelector(".congrea.teacher  #dashboardContainer .modal-header button.enable");b&&b.classList.remove("enable");
"DocumentShare"===virtualclass.currApp&&(b=document.querySelector("#virtualclassAppLeftPanel"),b.classList.add("hideZoom"),b.classList.remove("showZoom"))},addNoteClass(){if(roles.isStudent()){const b=document.querySelector("#docScreenContainer");null!=b&&b.classList.add("noteDisplay")}},calcBrightness(b){b=chroma(b).rgb();return Math.round((299*+b[0]+587*+b[1]+114*+b[2])/1E3)},removeStudenScreenStatus(){const b=chatContainerEvent.elementFromShadowDom(".stdscreenImg","all");for(let a=0;a<b.length;a++)b[a].dataset.dcolor=
""},insertAfter(b,a){a.parentNode.insertBefore(b,a.nextSibling)},triggerMouseEvent(b,a){if(null!=b){const d=document.createEvent("MouseEvents");d.initEvent(a,!0,!0);b.dispatchEvent(d)}},getCookie(b){return(b=document.cookie.match(RegExp(`(?:^|;\\s*)${b.replace(/([.*+?\^${}()|\[\]\/\\])/g,"\\$1")}=([^;]*)`)))?b[1]:null},sendCurrAppOnUserJoin(){},setCurrApp(b,a){b.dataset.currapp=a;b=document.getElementById("chat_div");null!=b&&(b.dataset.currapp=a)},selfJoin(b){return b===virtualclass.gObj.uid?(ioAdapter.sendSpeed(virtualclass.videoHost.gObj.MYSPEED),
!0):!1},getUrlVars(b){const a=[],d=b.slice(b.indexOf("?")+1).split("&");for(let c=0;c<d.length;c++)b=d[c].split("="),a.push(b[0]),a[b[0]]=b[1];return a},clearSyncTimeInterval(){Object.prototype.hasOwnProperty.call(virtualclass.videoUl,"syncTimeInterval")&&clearInterval(virtualclass.videoUl.syncTimeInterval)},pageVisible(){let b,a;const d={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(b in d)if(b in document){a=d[b];
break}return function(d){d&&document.addEventListener(a,d);return!document[b]}},showZoom(){const b=document.querySelector("#virtualclassAppLeftPanel.hideZoom");b&&(b.classList.remove("hideZoom"),b.classList.add("showZoom"))},removeBackgroundVideoApp(){virtualclass.videoUl.videoId="";var b=document.getElementById("dispVideo_Youtube_api");b&&b.contentWindow&&b.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*");if(b=document.querySelector(".congrea #dispVideo"))b.style.display=
"none",(b=document.querySelector(".congrea #dispVideo video"))&&b.setAttribute("src","");(b=document.querySelector("#listvideo .playing"))&&b.classList.remove("playing");(b=document.querySelector("#listvideo .removeCtr"))&&b.classList.remove("removeCtr");roles.hasControls()||(Object.prototype.hasOwnProperty.call(virtualclass.gObj,"videoPauseTime")&&clearTimeout(virtualclass.gObj.videoPauseTime),"object"===typeof virtualclass.videoUl.player&&null!=virtualclass.videoUl.player.player_&&virtualclass.videoUl.player.paused()&&
virtualclass.videoUl.player.pause());"object"===typeof virtualclass.videoUl.player&&delete virtualclass.videoUl.player},removeSessionEndTool(){const b=document.getElementById("virtualclassSessionEndTool");null!=b&&b.parentNode.removeChild(b)},WebPDecodeAndDraw(b,a,d){c.Worker&&webpToPng.postMessage({vdata:b,canid:a.id});c.Worker&&(webpToPng.onmessage=function(a){var b="videoParticipate"===a.data.canid?document.querySelector(`#${a.data.canid}`):chatContainerEvent.elementFromShadowDom(`#${a.data.canid}`);
const d=b.getContext("2d"),c=d.createImageData(b.width,b.height);b.height=a.data.bh;b.width=a.data.bw;c.data.set(a.data.vdata);d.putImageData(c,0,0);virtualclass.gObj.isReadyForVideo=!0})},isSessionEnded(){if(!virtualclass.isPlayMode&&virtualclass.endSession)return localStorage.clear(),!0},afterPdfPrefetch(b,a){virtualclass.gObj.nextPdf={};virtualclass.gObj.nextPdf[b]=a},getCurrentFormattedTime(b){b=this.UTCtoLocalTimeToSeconds(b);var a=new Date(b);b=a.getHours();a=`0${a.getMinutes()}`;return`${b}:${a.substr(-2)}`},
hideFullScreenButton(){console.log("=====> full screen show hide");document.querySelector("#fullScreenButton").style.display="none";document.querySelector("#fullScreenExitButton").style.display="block";virtualclass.gObj.fullScreenMode=!0;virtualclass.gObj.notHandleInputFocusHandler=!0},showFullScreenButton(){console.log("=====> full screen show show");document.querySelector("#fullScreenButton").style.display="block";document.querySelector("#fullScreenExitButton").style.display="none";virtualclass.gObj.fullScreenMode=
!1;virtualclass.gObj.notHandleInputFocusHandler=!0},showFullScreenButtonIfNeed(){console.log("====> show video full screen 1");virtualclass.gObj.fullScreenMode&&this.showFullScreenButton()},storeWhiteboardAtInlineMemory(b){const a=virtualclass.gObj.currWb;"object"!==typeof virtualclass.gObj.wbData[a]&&(virtualclass.gObj.wbData[a]=[]);virtualclass.gObj.wbData[a]=virtualclass.gObj.wbData[a].concat(b)},attachWhiteboardPopupHandler(b){c.addEventListener("mouseup",a=>{roles.hasControls()&&WhiteboardUtility.closeTray();
virtualclass.userInteractivity.event.moreControlsCloseTray()})},setScreenShareDefualtColor(){var b=virtualclass.gObj.prvRequestScreenUser;virtualclass.gObj.prvRequestScreenUser&&(b=chatContainerEvent.elementFromShadowDom(`#ml${b} .icon-stdscreenImg`),null!==b&&(b.setAttribute("data-dcolor","black"),b.parentNode.setAttribute("data-title",virtualclass.lang.getString("requestScreenShare"))))},hidePageNumber(){const b=document.querySelector("#docShareNav");null!==b&&(b.classList.add("hide"),b.classList.remove("show"))},
sendSpeedByMobile(b){"mobTab"===virtualclass.system.desktop&&ioAdapter.sendSpeed(b)},isRefreshMode(){return virtualclass.config.makeWebSocketReady},triggerFinalizeTextIfAny(b){},checkUserRole(){return virtualclass.isPlayMode?"t"===wbUser.orginalUserRole:"t"===virtualclass.gObj.uRole||"p"===virtualclass.gObj.uRole},closeElement(b){b.classList.contains("open")&&(b.classList.remove("open"),b.classList.add("close"))},canvasDimensionFromPixel(b){const a=parseFloat(c.getComputedStyle(b).width);b=parseFloat(c.getComputedStyle(b).height);
return{width:a,height:b}},loadFile(b,a){if("js"===a){var d=document.createElement("script");d.setAttribute("type","text/javascript");d.setAttribute("src",b)}"undefined"!=typeof d&&document.getElementsByTagName("head")[0].appendChild(d)}}})(window);let globalImageData={};
(function(c){let b,a,d,f,g,k,m,n,r;const t=function(a){null==k&&(k=document.querySelector("#virtualclassScreenShareLocal"));null==m&&(m=document.createElement("canvas"),m.id="virtualclassScreenShareLocalVideoNew",k.appendChild(m),m=document.querySelector("#virtualclassScreenShareLocalVideoNew"));m.width=a.width;m.height=a.height;0>=virtualclass.studentScreen.base.width&&(virtualclass.studentScreen.base.width=m.width,virtualclass.studentScreen.base.height=m.height);null==n&&(n=document.querySelector("#virtualclassScreenShareLocalVideoNew").getContext("2d"));
n.putImageData(a,0,0);virtualclass.ss.localCont.save();virtualclass.ss.localCont.clearRect(0,0,c.innerWidth-300,c.innerHeight);virtualclass.ss.localCont.scale(virtualclass.studentScreen.scale,virtualclass.studentScreen.scale);virtualclass.ss.localCont.drawImage(m,0,0);virtualclass.ss.localCont.restore()};c.Worker&&(sdworker.onmessage=function(a){"drgb"===a.data.dtype&&(r=globalImageData=a.data.globalImageData,Object.prototype.hasOwnProperty.call(a.data,"stype")?(virtualclass.studentScreen.base.width=
0,virtualclass.studentScreen.setDimension(),t(r),virtualclass.studentScreen.triggerNormalView(a.data.stype),(a=virtualclass.vutil.getUserAllInfo(a.data.uid,virtualclass.connectedUsers))&&"t"!==a.role&&roles.isStudent()&&!virtualclass.gObj.studentSSstatus.shareToAll&&receiveFunctions.sview({message:"firstSs"})):t(r))});c.studentScreen=function(){return{scale:1,SCALE_FACTOR:1.04,szoom:!1,base:{width:0,height:0},ssProcess(a,b,d){a=new Uint8ClampedArray(a);let c,f;switch(a[0]){case 102:case 202:if(a[1]===
virtualclass.gObj.screenShareVersion){var g=virtualclass.vutil.numValidateFour(a[2],a[3],a[4],a[5]);var k=virtualclass.vutil.numValidateTwo(a[6],a[7]);var m=virtualclass.vutil.numValidateTwo(a[8],a[9]);a=a.subarray(10,a.length);this.initStudentScreen(a,{w:k,h:m},b,d,g)}else k=virtualclass.vutil.numValidateTwo(a[1],a[2]),m=virtualclass.vutil.numValidateTwo(a[3],a[4]),a=a.subarray(5,a.length),this.initStudentScreen(a,{w:k,h:m},b,d);break;case 103:case 203:"object"===typeof virtualclass.ss&&(a[1]===
virtualclass.gObj.screenShareVersion?(b=a.subarray(6,a.length),this.drawImageThroughWorker(b)):this.drawImageThroughWorker(a));break;case 104:case 204:a[1]===virtualclass.gObj.screenShareVersion?(m=virtualclass.vutil.numValidateFour(a[2],a[3],a[4],a[5]),k=virtualclass.vutil.numValidateTwo(a[6],a[7]),g=virtualclass.vutil.numValidateTwo(a[8],a[9]),c=virtualclass.vutil.numValidateTwo(a[10],a[11]),f=virtualclass.vutil.numValidateTwo(a[12],a[13]),a=a.subarray(14,a.length),k={d:{w:k,h:g},vc:{w:c,h:f}},
this.initStudentScreen(a,k,b,d,m)):(k=virtualclass.vutil.numValidateTwo(a[1],a[2]),g=virtualclass.vutil.numValidateTwo(a[3],a[4]),c=virtualclass.vutil.numValidateTwo(a[5],a[6]),f=virtualclass.vutil.numValidateTwo(a[7],a[8]),a=a.subarray(9,a.length),k={d:{w:k,h:g},vc:{w:c,h:f}},this.initStudentScreen(a,k,b,d))}},triggerNormalView(a){"full"===a&&1===virtualclass.studentScreen.scale&&(virtualclass.studentScreen.scale=1,virtualclass.studentScreen.normalView())},initStudentScreen(b,d,c,f,k){+virtualclass.vutil.whoIsTeacher()===
k&&(virtualclass.gObj.studentSSstatus.shareToAll=!0);g=c;c=document.getElementById(`virtualclass${virtualclass.apps.ss}`);"object"!==typeof virtualclass[g]||null==c?("undefined"!==typeof vtype&&(virtualclass.recorder.recImgPlay=!0),virtualclass.makeAppReady({app:"ScreenShare"})):("ScreenShare"!==virtualclass.currApp&&virtualclass.vutil.hidePrevIcon(g),virtualclass.currApp=f,f=document.getElementById("virtualclassCont"),virtualclass.vutil.setCurrApp(f,virtualclass.currApp));if(Object.prototype.hasOwnProperty.call(d,
"d"))virtualclass[g].dimensionStudentScreenResize(d),virtualclass[g].dim=!0;else{if(!virtualclass[g].dim||"undefined"!==typeof a&&a!==d.w&&!Object.prototype.hasOwnProperty.call(d,"x"))virtualclass[g].dim=!0,virtualclass[g].dimensionStudentScreen(d.w,d.h),a=d.w;!Object.prototype.hasOwnProperty.call(d,"w")||virtualclass[g].localCanvas.width===d.w&&virtualclass[g].localCanvas.height===d.h||(virtualclass[g].localCanvas.width=d.w,virtualclass[g].localCanvas.height=d.h,virtualclass[g].canvasOriginalWidth=
virtualclass[g].localCanvas.width,virtualclass[g].canvasOriginalHeight=virtualclass[g].localCanvas.height)}"undefined"===typeof k?virtualclass[g].drawImages(b):virtualclass[g].drawImages(b,k);virtualclass.previous=virtualclass[g].id;this.szoom||this.initZoom();c=document.getElementById(`virtualclass${virtualclass.apps.ss}`);virtualclass.gObj.screenShareId&&(c.dataset.screenshareid=virtualclass.gObj.screenShareId);virtualclass.userInteractivity.makeReadyContext()},initZoom(){var a=virtualclass.getTemplate("zoomControl")({hasControls:roles.hasControls()}),
b=document.querySelector(`#virtualclass${virtualclass.currApp}`);if(null!=b){b.insertAdjacentHTML("beforeend",a);a=document.querySelector(`#virtualclass${virtualclass.currApp} .zoomIn`);b=document.querySelector(`#virtualclass${virtualclass.currApp} .zoomOut`);const d=document.querySelector(`#virtualclass${virtualclass.currApp} .fitScreen`);null!=a&&(a.onclick=function(){virtualclass.studentScreen.zoomIn()});null!=b&&(b.onclick=function(){virtualclass.studentScreen.zoomOut()});null!=d&&d.addEventListener("click",
this.triggerFitControl.bind(this))}this.szoom=!0},triggerFitControl(){const a=document.querySelector("#virtualclassScreenShare .zoomControler .fitScreen");this.doOpposite?("normalview"===a.dataset.currstate?virtualclass.studentScreen.fitToScreen():virtualclass.studentScreen.normalView(),delete this.doOpposite):"normalview"===a.dataset.currstate?virtualclass.studentScreen.normalView():virtualclass.studentScreen.fitToScreen()},zoomIn(){virtualclass.ss.localCanvas.width=+virtualclass.ss.localCanvas.width*
this.SCALE_FACTOR;virtualclass.ss.localCanvas.height=+virtualclass.ss.localCanvas.height*this.SCALE_FACTOR+5;this.scale*=this.SCALE_FACTOR;t(globalImageData);this.addScroll()},fitToScreen(){var a=document.querySelector("#virtualclassScreenShare .zoomControler .fitScreen");a&&(a.dataset.currstate="normalview",document.querySelector("#virtualclassScreenShare .fitScreen.congtooltip").dataset.title=virtualclass.lang.getString("normalView"));this.setDimension();a=document.querySelector("#virtualclassScreenShare").offsetWidth;
this.scale=virtualclass.ss.getScale(virtualclass.ss.canvasOriginalWidth,a);virtualclass.ss.localCanvas.width=a-10;virtualclass.ss.localCanvas.height=Math.round(virtualclass.ss.canvasOriginalHeight*this.scale);t(globalImageData);this.addScroll()},normalView(){var a=document.querySelector("#virtualclassScreenShare .zoomControler .fitScreen");a&&(a.dataset.currstate="fittoscreen",document.querySelector("#virtualclassScreenShare .fitScreen.congtooltip").dataset.title=virtualclass.lang.getString("fitToScreen"));
a=this.setDimension();this.scale=virtualclass.ss.getScale(this.base.width,a.width);this.scale=1;virtualclass.ss.localCanvas.width=globalImageData.width;virtualclass.ss.localCanvas.height=globalImageData.height;t(globalImageData);virtualclass.ss.localCanvas.parentNode.classList.remove("scrollX")},zoomOut(){this.scale/=this.SCALE_FACTOR;virtualclass.ss.localCanvas.width=1/this.SCALE_FACTOR*+virtualclass.ss.localCanvas.width;virtualclass.ss.localCanvas.height=1/this.SCALE_FACTOR*+virtualclass.ss.localCanvas.height+
5;t(globalImageData);this.addScroll()},addScroll(){let a=virtualclass.ss.localCanvas.width,b=virtualclass.ss.localCanvas.parentNode.style.width;a=virtualclass.vutil.getValueWithoutPixel(a);b=virtualclass.vutil.getValueWithoutPixel(b);a>b?virtualclass.ss.localCanvas.parentNode.classList.add("scrollX"):virtualclass.ss.localCanvas.parentNode.classList.remove("scrollX")},setDimension(){var a=document.getElementById("virtualclassScreenShare");const b=a.offsetWidth;a=a.offsetHeight;this.setCanvasContainerDimension(b,
a);return{width:b,height:a}},getCanvasContainerDimension(){const a=document.querySelector(`#virtualclass${virtualclass.currApp}`);let {width:b}=a.style,{height:d}=a.style;if(null==b||""===b)b=a.offsetWidth;if(null==d||""===d)d=a.offsetHeight;b=virtualclass.vutil.getValueWithoutPixel(b)-40;d=virtualclass.vutil.getValueWithoutPixel(d);return{width:b,height:d}},setCanvasContainerDimension(a,b){},drawImageThroughWorker(a){c.Worker&&sdworker.postMessage({data_pack:a,dtype:"drgbs"},[a.buffer])}}};c.screenShare=
function(a){virtualclass.getSceenFirefox=function(){const a=parseInt(c.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);33<=a?(null==virtualclass.adpt&&(virtualclass.adpt=new virtualclass.adapter),virtualclass.adpt.init(navigator).mediaDevices.getUserMedia({video:{mozMediaSource:"window",mediaSource:"window"}}).then(a=>{virtualclass.ss.initInternal();if(roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing||virtualclass.gObj.studentSSstatus.mesharing){if(virtualclass.ss.initializeRecorder.call(virtualclass.ss,
a),"undefined"===typeof err){let d=a.currentTime;var b=c.setInterval(()=>{a||c.clearInterval(b);if(a.currentTime===d&&(c.clearInterval(b),a.onended))a.onended();d=a.currentTime},500)}}else virtualclass.ss.setCurrentApp()}).catch(a=>{virtualclass.ss.setCurrentApp();var b;"Video"===virtualclass.currApp?b=document.getElementById("virtualclassVideoTool"):"SharePresentation"===virtualclass.currApp?b=document.getElementById("virtualclassSharePresentationTool"):"DocumentShare"===virtualclass.currApp&&(b=
document.getElementById("virtualclassDocumentShareTool"));b=b.getElementsByTagName("a")[0];virtualclass.initlizer(b);"string"===typeof a?"PERMISSION_DENIED"===a&&c.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus():"object"===typeof a&&("PermissionDeniedError"===a.name||"SecurityError"===a.name)&&c.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus();roles.hasControls()&&("Video"===virtualclass.currApp||"SharePresentation"===virtualclass.currApp||
"DocumentShare"===virtualclass.currApp)&&virtualclass.ss.showDashboard()})):alert(virtualclass.lang.getString("notSupportBrowser",[a]))};return{prevStream:!1,init(a){this.type=a.type;this.ssByClick=!0;this.manualStop=!1;!roles.hasControls()||virtualclass.recorder.recImgPlay||virtualclass.gObj.studentSSstatus.mesharing?roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing?this.readyTostart(a.app):(roles.isStudent()&&(a=document.getElementById("chromeExtClose"))&&a.click(),this.initInternal()):
this.readyTostart(a.app)},initInternal(){this.currApp=this.tempCurrApp;virtualclass.currApp=virtualclass.apps.ss;var b=document.getElementById("virtualclassCont");virtualclass.vutil.setCurrApp(b,virtualclass.currApp);virtualclass.previous!==a.id&&(document.getElementById(virtualclass.previous).style.display="none",virtualclass.previous=a.id);b=document.getElementById(a.id);null!=b&&(b.style.display="block");Object.prototype.hasOwnProperty.call(this,"id")||(this.dc=virtualclass.dirtyCorner,this.postFix=
"Cont",this.id=Object.prototype.hasOwnProperty.call(a,"id")?a.id:"virtualclassScreenShare",this.className="virtualclass",this.label="Local",this.local=this.id+this.label,this.localTemp=`${this.id+this.label}Temp`,this.classes=Object.prototype.hasOwnProperty.call(a,"class")?a.classes:"",this.initPrevImage(),b=document.getElementById(this.id),null!=b&&b.parentNode.removeChild(b),this.html.UI.call(this,virtualclass.gObj.uRole),(roles.hasControls()&&!virtualclass.recorder.recImgPlay&&!virtualclass.gObj.studentSSstatus.mesharing||
roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing)&&virtualclass.vutil.initLocCanvasCont(`${this.localTemp}Video`))},readyTostart(a){a===virtualclass.apps.ss&&this.getScreen()},onError(a){virtualclass.previous?({previous:a}=virtualclass,virtualclass.currApp=a.split("virtualclass")[1],virtualclass.vutil.setCurrApp(document.getElementById("virtualclassCont"),virtualclass.currApp)):Object.prototype.hasOwnProperty.call(virtualclass,"previousApp")&&"object"===typeof virtualclass.previousApp&&
(virtualclass.currApp=virtualclass.previousApp.name,virtualclass.vutil.setCurrApp(document.getElementById("virtualclassCont"),virtualclass.currApp));roles.hasControls()&&("Video"===virtualclass.currApp||"SharePresentation"===virtualclass.currApp||"DocumentShare"===virtualclass.currApp)&&virtualclass.ss.showDashboard();virtualclass.gObj.studentSSstatus.mesharing&&(virtualclass.gObj.studentSSstatus.mesharing=!1)},showDashboard(){virtualclass.dashboard.initDashboardNav();"Video"===virtualclass.currApp?
(ioAdapter.mustSend({videoUl:{init:"destroyPlayer"},cf:"destroyPlayer"}),ioAdapter.mustSend({videoUl:{init:"studentlayout"},cf:"videoUl"})):"SharePresentation"===virtualclass.currApp&&virtualclass.dashboard.init()},getScreenStream(a){return a.mediaDevices.getDisplayMedia({video:{mandatory:{maxWidth:1440,maxHeight:9999}}})},async getScreen(){var a=virtualclass.adpt.init(navigator);a.mediaDevices.getDisplayMedia?(a=await this.getScreenStream(a),virtualclass.ss.initInternal(),virtualclass.ss.initializeRecorder.call(virtualclass.ss,
a)):"Chrome"===virtualclass.system.mybrowser.name?Object.prototype.hasOwnProperty.call(virtualclass.gObj,"ext")&&virtualclass.gObj.ext?c.postMessage({type:"getScreen",id:1},"*"):(virtualclass.vutil.beforeSend({ext:!0,cf:"colorIndicator"}),virtualclass.popup.chromeExtMissing(),virtualclass.vutil.setCurrApp(document.getElementById("virtualclassCont"),virtualclass.currApp),!roles.hasControls()||"Video"!==virtualclass.currApp&&"SharePresentation"!==virtualclass.currApp&&"DocumentShare"!==virtualclass.currApp||
virtualclass.ss.showDashboard()):"Firefox"===virtualclass.system.mybrowser.name&&virtualclass.getSceenFirefox()},unShareScreen(){this.video.src="";this.localtempCont.clearRect(0,0,this.localtempCanvas.width,this.localtempCanvas.height);clearInterval(virtualclass.clear);this.initPrevImage();Object.prototype.hasOwnProperty.call(this,"currentStream")&&this.currentStream.getTracks()[0].stop();virtualclass.vutil.beforeSend({unshareScreen:!0,st:this.type,cf:"unshareScreen"});this.clearScreenShare();virtualclass.vutil.setScreenShareDefualtColor()},
clearScreenShare(){"undefined"!==typeof virtualclass.prevScreen&&Object.prototype.hasOwnProperty.call(virtualclass.prevScreen,"currentStream")&&delete virtualclass.prevScreen.currentStream;virtualclass.gObj.studentSSstatus.mesharing=!1;virtualclass.removeSharingClass();virtualclass.gObj.studentSSstatus.shareToAll=!1;virtualclass.gObj.studentSSstatus.sharing=!1;const a=document.querySelector("#virtualclassScreenShare");null!=a&&a.parentNode.removeChild(a);virtualclass.vutil.removeSSsharing();delete virtualclass.ss;
Object.prototype.hasOwnProperty.call(virtualclass,"studentScreen")&&delete virtualclass.studentScreen;virtualclass.zoom.removeZoomController();virtualclass.ss=""},removeStream(){virtualclass.vutil.removeClass("audioWidget","fixed");this.localCont&&this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height);this.clearScreenShare()},initializeRecorder(a){const d=this;b=1;this.prevStream&&(this.ssByClick=!1);"undefined"!==typeof virtualclass.prevScreen&&Object.prototype.hasOwnProperty.call(virtualclass.prevScreen,
"currentStream")&&virtualclass.prevScreen.unShareScreen();this.video=document.getElementById(`${this.local}Video`);this.videoSmall=document.getElementById(`${this.local}Videosmall`);if("VIDEO"!==this.video.tagName){const a=document.getElementById(`${this.local}video`);this.video.parentNode.replaceChild(a,this.video);this.video=document.getElementById(`${this.local}Video`);this.video.autoplay=!0;virtualclass.vutil.initLocCanvasCont(`${this.local}TempVideo`)}this.currentStream=a;virtualclass.adpt.attachMediaStream(this.video,
a);virtualclass.adpt.attachMediaStream(this.videoSmall,a);this.prevStream=!0;this.currentStream.getVideoTracks()[0].onended=function(){if(d.ssByClick){var a=document.querySelector("#virtualclassScreenShareLocalSmall");a&&(a.style.display="none");d.video.src="";d.localtempCont.clearRect(0,0,d.localtempCanvas.width,d.localtempCanvas.height);clearInterval(virtualclass.clear);d.initPrevImage();d.clearScreenShare();virtualclass.vutil.beforeSend({unshareScreen:!0,st:d.type,cf:"unshareScreen"});roles.hasControls()?
Object.prototype.hasOwnProperty.call(virtualclass.gObj,"windowLoading")||virtualclass.vutil.initDefaultApp():(a=virtualclass.vutil.whoIsTeacher(),ioAdapter.mustSendUser({cf:"rmStdScreen"},a));d.prevStream=!1;d.prevScreen="";virtualclass.prevScreen=""}else d.ssByClick=!0};var f=c.innerWidth;var g=c.innerHeight-140;this.video.onloadedmetadata=function(){const a=(new Date).getTime();virtualclass.gObj.screenShareId=`ss_${a}`;virtualclass.userInteractivity.makeReadyContext();ioAdapter.mustSend({cf:"screenShareId",
id:virtualclass.gObj.screenShareId});d.width=f;d.height=g;d.localtempCanvas.width=d.video.offsetWidth;d.localtempCanvas.height=d.video.offsetHeight;virtualclass.prevScreen=d;virtualclass.system.measureResoultion({width:c.innerWidth,height:c.innerHeight});d.sharing();roles.hasControls()&&(virtualclass.vutil.makeActiveApp(d.id,virtualclass.previrtualclass),"virtualclassYts"===virtualclass.previrtualclass&&virtualclass.yts.destroyYT());virtualclass.previrtualclass=d.id}},sharing(){function a(a,b){a=
a.toString();for(let d=a.length;d<b;d+=1)a=`0${a}`;return a.match(/[\S]{1,2}/g)||[]}function g(a){switch(!0){case 300>=a||"undefined"===typeof a:H=300;break;case 3E3>=a:H=a;break;case 5E3>=a:H=3E3;break;default:H=5E3}}function k(){if(roles.hasControls()||virtualclass.gObj.studentSSstatus.mesharing){d=B.video.offsetWidth;f=B.video.offsetHeight;5<B.localtempCanvas.width&&5<B.localtempCanvas.height?(r=Math.round(B.localtempCanvas.height/12),t=Math.round(B.localtempCanvas.width/12),z=r,C=t):(r=z,t=C);
{var k=B.type;B.localtempCanvas.width=B.video.offsetWidth;B.localtempCanvas.height=B.video.offsetHeight;B.localtempCont.drawImage(B.video,0,0,B.video.offsetWidth,B.video.offsetHeight);var m=B.localtempCont.getImageData(0,0,B.localtempCanvas.width,B.localtempCanvas.height);m=B.dc.encodeRGB(m.data);const b=Math.round(B.localtempCanvas.width/t),g=Math.round(B.localtempCanvas.height/r);let n,u;const v=a(virtualclass.gObj.uid,8);var p=B.getContainerDimension();if("undefined"!==typeof d&&"undefined"!==
typeof f){var q=a(d,4);n=a(f,4)}else q=a(B.video.offsetWidth,4),n=a(B.video.offsetHeight,4);u=a(p.width,4);p=a(p.height,4);k=new Uint8ClampedArray(["ss"===k?104:204,virtualclass.gObj.screenShareVersion,v[0],v[1],v[2],v[3],q[0],q[1],n[0],n[1],u[0],u[1],p[0],p[1]]);q=new Uint8ClampedArray(m.length+k.length);q.set(k);q.set(m,k.length);c.Worker&&sworker.postMessage({img:m,resize:1,resA:r,resB:t,dw:b,dh:g,offsetWidth:B.video.offsetWidth,offsetHeight:B.video.offsetHeight},[m.buffer]);m=q}virtualclass.vutil.informIamSharing();
ioAdapter.sendBinary(m);g(m.length/128);b=0;clearInterval(virtualclass.clear);virtualclass.clear=setInterval(n,H)}}function m(){B.localtempCanvas.width=B.video.offsetWidth;B.localtempCanvas.height=B.video.offsetHeight;B.localtempCont.drawImage(B.video,0,0,B.video.offsetWidth,B.video.offsetHeight);const a=Math.round(B.localtempCanvas.width/t),b=Math.round(B.localtempCanvas.height/r),d=B.localtempCont.getImageData(0,0,B.video.offsetWidth,B.video.offsetHeight);c.Worker&&(sworker.postMessage({img:d.data,
resA:r,resB:t,dw:a,dh:b,offsetWidth:B.video.offsetWidth,offsetHeight:B.video.offsetHeight,type:B.type,uid:virtualclass.gObj.uid},[d.data.buffer]),sworker.onmessage=function(a){let b;1===a.data.needFullScreen?(a=virtualclass.getDataFullScreen(B.type),virtualclass.vutil.informIamSharing(),ioAdapter.sendBinary(a),b=a.length/128):null!=a.data.sendMasterSlice&&(ioAdapter.sendBinary(a.data.sendMasterSlice),b=a.data.sendMasterSlice.length/128);g(b);clearInterval(virtualclass.clear);virtualclass.clear=setInterval(n,
H)});clearInterval(virtualclass.clear)}function n(){clearInterval(virtualclass.clear);if("undefined"!==typeof d&&"undefined"!==typeof f){if(d!==B.video.offsetWidth||f!==B.video.offsetHeight)b=1}else d=B.video.offsetWidth,f=B.video.offsetHeight;1===b?virtualclass.ss.sendResizeWindowTime=setTimeout(k,2E3):m()}let r=Math.round(this.localtempCanvas.height/12),t=Math.round(this.localtempCanvas.width/12),z=r,C=t;const B=this;Object.prototype.hasOwnProperty.call(virtualclass,"wholeImage")&&clearInterval(virtualclass.wholeImage);
Object.prototype.hasOwnProperty.call(virtualclass,"clear")&&clearInterval(virtualclass.clear);0===r&&0===t&&virtualclass.view.createErrorMsg("screensharereload","errorContainer","virtualclassAppFooterPanel");let H=1E3;virtualclass.getDataFullScreen=function(b){B.localtempCanvas.width=B.video.offsetWidth;B.localtempCanvas.height=B.video.offsetHeight;B.localtempCont.drawImage(B.video,0,0,B.video.offsetWidth,B.video.offsetHeight);var d=B.localtempCont.getImageData(0,0,B.localtempCanvas.width,B.localtempCanvas.height);
d=B.dc.encodeRGB(d.data);var c=a(B.localtempCanvas.height,4),f=a(B.localtempCanvas.width,4);b="ss"===b?102:202;const g=a(virtualclass.gObj.uid,8);c=new Uint8ClampedArray([b,virtualclass.gObj.screenShareVersion,g[0],g[1],g[2],g[3],f[0],f[1],c[0],c[1]]);f=new Uint8ClampedArray(d.length+c.length);f.set(c);f.set(d,c.length);return f};clearInterval(virtualclass.clear);virtualclass.clear=setInterval(n,H)},getContainerDimension(){const a=document.getElementById(`${this.id}Local`);return{width:a.offsetWidth,
height:a.offsetHeight}},drawImages(a,b){sdworker.postMessage({encodeArr:a,cw:virtualclass.ss.localCanvas.width,ch:virtualclass.ss.localCanvas.height,dtype:"drgb",uid:"undefined"===typeof b?null:b},[a.buffer])},dimensionStudentScreen(a,b){this.localCanvas=document.getElementById(`${virtualclass[g].local}Video`);this.localCont=virtualclass[g].localCanvas.getContext("2d");this.canvasOriginalWidth=a;this.canvasOriginalHeight=b;this.localCanvas.width=a;this.localCanvas.height=b},dimensionStudentScreenResize(a){Object.prototype.hasOwnProperty.call(this,
"vac")||(this.vac=!0,this.localCanvas=document.getElementById(`${virtualclass[g].local}Video`),this.localCont=virtualclass[g].localCanvas.getContext("2d"));Object.prototype.hasOwnProperty.call(a,"d")&&(this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height),this.localCanvas.width=a.d.w,this.localCanvas.height=a.d.h,this.canvasOriginalWidth=this.localCanvas.width,this.canvasOriginalHeight=this.localCanvas.height);"virtualclassScreenShare"===virtualclass.previous&&virtualclass.vutil.setScreenInnerTagsWidth(virtualclass.previous)},
isAbleToScreenShare(){return roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing?!0:!(!roles.hasControls()||virtualclass.gObj.studentSSstatus.mesharing)},html:{UI(){var a=virtualclass.ss.isAbleToScreenShare(),b=roles.hasControls(),{recImgPlay:d}=virtualclass.recorder;d=virtualclass.getTemplate("ssmainDiv")({control:a,recImg:d,scrctrl:b});virtualclass.vutil.insertAppLayout(d);roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing&&(d=document.querySelector("#virtualclassCont  #stopScreenShare"))&&
d.addEventListener("click",()=>{virtualclass.ss&&virtualclass.ss.sendResizeWindowTime&&clearTimeout(virtualclass.ss.sendResizeWindowTime);virtualclass.vutil.initDefaultApp()});b&&(this.html.initScreenController(),virtualclass.gObj.studentSSstatus.shareToAll&&virtualclass.gObj.studentSSstatus.mesharing&&(b=document.querySelector("#screenController .selfView"))&&this.html.changeSsInfoSelf(b));b=document.querySelector(".congrea #virtualclassApp");a?b.classList.remove("zoomCtrAdd"):b.classList.contains("zoomCtr")||
b.classList.add("zoomCtrAdd");roles.hasControls()&&virtualclass.gObj.studentSSstatus.mesharing&&(a=document.querySelector("#virtualclassCont  #stopScreenShare"))&&a.addEventListener("click",()=>{virtualclass.vutil.initDefaultApp();const a=document.querySelector("#virtualclassCont.studentScreenSharing");a&&(a.classList.remove("studentScreenSharing"),document.querySelector("#chat_div").classList.remove("studentScreenSharing"));virtualclass.vutil.setScreenShareDefualtColor()})},initScreenController(){const a=
document.querySelector("#screenController .share");if(null!=a){const b=this;a.onclick=function(a){let d;const {classList:c}=a.currentTarget;c.contains("selfView")?(b.changeSsInfoSelf(a.currentTarget),d="sToAll"):c.contains("shareToAll")&&(b.changeSsInfoShareToAll(a.currentTarget),d="sview");ioAdapter.mustSend({cf:d})}}},changeSsInfoSelf(a){a.classList.remove("selfView");a.classList.add("shareToAll");a.setAttribute("data-title",virtualclass.lang.getString("selfview"));virtualclass.gObj.studentSSstatus.shareToAll=
!0},changeSsInfoShareToAll(a){a.classList.remove("shareToAll");a.classList.add("selfView");a.setAttribute("data-title",virtualclass.lang.getString("sharetoall"));virtualclass.gObj.studentSSstatus.shareToAll=!1}},initPrevImage(){sworker.postMessage({initPrevImg:!0})},setCurrentApp(){Object.prototype.hasOwnProperty.call(virtualclass,"previous")&&"undefined"!==typeof virtualclass.previous&&(virtualclass.currApp=virtualclass.previous.slice(12),virtualclass.vutil.setCurrApp(document.getElementById("virtualclassCont"),
virtualclass.currApp))},getScale(a,b){return b/a},initShareScreen(a,b){"function"===typeof virtualclass.getDataFullScreen&&(Object.prototype.hasOwnProperty.call(virtualclass.gObj,"sendScreen")&&clearTimeout(virtualclass.gObj.sendScreen),virtualclass.gObj.sendScreen=setTimeout(()=>{a=virtualclass.getDataFullScreen(a);const b=virtualclass.getDataFullScreen("ss");ioAdapter.sendBinary(b);virtualclass.vutil.informIamSharing();a=null},b))},selfView(a){const b=document.getElementById("virtualclassScreenShareLocal");
roles.isStudent()&&!virtualclass.gObj.studentSSstatus.mesharing&&null!=b&&(console.log("====> Screen share dislay none"),b.style.display="none");Object.prototype.hasOwnProperty.call(a,"firstSs")&&(virtualclass.gObj.studentSSstatus.sharing=!0);virtualclass.gObj.studentSSstatus.shareToAll=!1},shareToAll(){const a=document.getElementById("virtualclassScreenShareLocal");null!=a&&(a.style.display="block")},triggerFitToScreen(){const a=document.querySelector("#virtualclassScreenShare .zoomControler .fitScreen");
null!=a&&"normalview"===a.dataset.currstate&&virtualclass.zoom.zoomAction("fitToScreen")}}}})(window);(function(c){c.recorder={playTime:150,tempPlayTime:150,items:[],objn:0,playTimeout:"",allFileFound:!1,playTimePreviousSeconds:0,waitServer:!1,waitPopup:!1,masterRecordings:[],alreadyAskForPlay:!1,playStart:!1,error:0,currentMin:0,uploadInProcess:!1,totalRecordingFiles:[],totalPlayTimeInMin:0,totalTimeInMiliSeconds:0,subRecordings:null,attachSeekHandler:!1,rawDataQueue:{},xhr:[],session:null,elapsedPlayTime:0,prevFile:null,refrenceTime:null,totalElements:0,lastFileTime:null,lastRecordings:0,firstTimeRequest:!0,
alreadyRequested:{},binarySyncMsg:null,msg:null,orginalTimes:[],startSeek:!1,initPlay:!1,isTrimRecordingNow:!1,joinRoomRecevied:!1,totalTrimTime:0,trimofftime:0,trimontime:0,totalRecordingTime:0,actualPlayRecordingTime:0,timeStamp:null,totalTimeTillNow:0,markData:[],recViewData:{"x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room,"x-congrea-session":wbUser.session,data:{}},recording:"on",viewPoint:null,count:0,remainingSeconds:0,
recData:null,recDataOne:null,recordingOn:0,recordingOff:0,init(){if(!this.attachSeekHandler){this.initRecordViewHandler();this.attachSeekHandler=!0;const b=document.querySelector("#virtualclassCont"),a=document.querySelector("#allMarksinformation");a.addEventListener("mousedown",this.seekHandler.bind(this));b.addEventListener("mousemove",this.seekWithMouseMove.bind(this));c.addEventListener("mouseup",this.finalSeek.bind(this));b.addEventListener("touchmove",this.seekWithMouseMove.bind(this));b.addEventListener("touchend",
this.finalSeek.bind(this));a.addEventListener("touchstart",this.seekHandler.bind(this));b.addEventListener("touchmove",this.seekWithMouseMove.bind(this));b.addEventListener("touchend",this.finalSeek.bind(this));a.addEventListener("mousemove",this.handlerDisplayTime.bind(this));a.addEventListener("mouseleave",this.removeHandler.bind(this,a));virtualclass.pageVisible(this.handlPageActiveness.bind(this))}Object.prototype.hasOwnProperty.call(this,"prvNum")||(this.masterIndex=this.subRecordingIndex=0,
this.subRecordings=this.masterRecordings[this.masterIndex],this.play(),this.prvNum=this.masterIndex)},recDataSend(){var b=0;let a=0;if(this.recData&&0<this.recData.length)for(let d=0;d<=this.recData.length;d++)a!==this.recData[d]||void 0===this.recData[d]?(0===a||void 0===a||this.recViewData.data.hasOwnProperty(a)||(this.recViewData.data[a]=[]),0!==a&&void 0!==a&&this.recViewData.data[a].push({[b]:d})):void 0!==this.recData[d]&&d===this.recData.length&&this.recViewData.data[this.recData[d]].push({[b]:d}),
a!==this.recData[d]&&(b=d),a=this.recData[d];console.log("====> sent data ",JSON.stringify(this.recViewData));b=this.recViewData.data.rtt;navigator.sendBeacon("https://api.congrea.net/data/analytics/recording",JSON.stringify(this.recViewData));delete this.recViewData.data;this.recViewData.data={};this.recViewData.data.rtt=b},handlPageActiveness(){virtualclass.pageVisible()?this.earlierPause||(this.controller._play(),delete this.earlierPause):(this.earlierPause=this.controller.pause,this.controller._pause())},
removeHandler(b){b.removeEventListener("mousedown",this.seekHandler.bind(this));document.getElementById("timeInHover").style.display="none";document.querySelector("#virtualclassCont").classList.remove("recordSeeking")},async replayFromStart(){this.tempPlayTime=this.playTime=150;const b=this.masterRecordings;await virtualclass.config.endSession();virtualclass.popup.closeElem();disCommonChatInput();this.playTimeout="";this.playStart=this.waitPopup=this.waitServer=!1;this.elapsedPlayTime=this.error=
0;this.controller.ff=1;this.masterRecordings=b;this.playTimePreviousSeconds=0;this.playProgressBar(this.playTime);delete this.prvNum;virtualclass.wbCommon.indexNav.init();this.init();delete virtualclass.ss;virtualclass.ss="";delete virtualclass.gObj.wbData;virtualclass.gObj.wbData={};virtualclass.makeAppReady({app:"Whiteboard"})},convertInto(b){if("string"===typeof b.data)return b;b.data=b.data.buffer;return b},playProgressBar(b){0<b?(virtualclass.pbar.renderProgressBar(this.totalTimeInMiliSeconds,
b,"playProgressBar",void 0),b=this.convertIntoReadable(b),document.getElementById("tillRepTime").innerHTML=`${b.h}:${b.m}:${b.s}`,this.alreadyCalcTotTime||(this.updateTotalTime(),this.alreadyCalcTotTime=!0)):virtualclass.pbar.renderProgressBar(1E3*this.lastTimeInSeconds,0,"playProgressBar",void 0)},updateTotalTime(){const b=this.convertIntoReadable(this.totalTimeInMiliSeconds);document.getElementById("totalRepTime").innerHTML=`${b.h}:${b.m}:${b.s}`},convertIntoReadable(b){b/=1E3;let a=0,d=Math.floor(b%
60);b=Math.floor(b/60);60<=b&&(a=Math.floor(b/60),b%=60);10>a&&(a=`0${a}`);10>b&&(b=`0${b}`);10>d&&(d=`0${d}`);return{h:a,m:b,s:d}},displayWaitPopupIfNot(){!1===this.waitPopup&&(virtualclass.popup.sendBackOtherElems(),document.getElementById("recordingContainer").style.display="none",virtualclass.popup.waitBlockAction("block"),virtualclass.pbar.renderProgressBar(0,0,"downloadProgressBar","downloadProgressValue"),virtualclass.popup.waitBlock(),this.waitPopup=!0)},requestDataFromServer(b,a){if(this.isFileVcp(b))if(this.alreadyRequested[b])0<
virtualclass.recorder.totalRecordingFiles.length&&(d=virtualclass.recorder.totalRecordingFiles.shift(),virtualclass.recorder.requestDataFromServer(d,a));else{var d=`https://recording.congrea.net/${wbUser.lkey}/${wbUser.room}/${virtualclass.recorder.session}/${b}`;!0!==virtualclass.gObj.readyToCommunicate?setTimeout(()=>{virtualclass.recorder.requestDataFromServer(b,a)},1E3):a.get(d).then(d=>{virtualclass.recorder.afterDownloading(b,d.data,a)}).catch(d=>{console.error("Request failed with error ",
d);setTimeout(()=>{virtualclass.recorder.requestDataFromServer(b,a)},1E3)})}},afterDownloading(b,a,d){if(0<virtualclass.recorder.totalRecordingFiles.length){const a=virtualclass.recorder.totalRecordingFiles.shift();virtualclass.recorder.requestDataFromServer(a,d)}virtualclass.recorder.rawDataQueue[b]={file:b,data:a};this.formatRecording(b);this.alreadyRequested[b]=!0},isFirstPacket(b){b=virtualclass.recorder.orginalListOfFiles[b];return null!=b&&0===b.index},isPacketInSerial(b){if(null!=this.prevFile)return this.orginalListOfFiles[this.prevFile].next===
b||"end"===this.orginalListOfFiles[this.prevFile].next},formatRecording(b){(this.isFirstPacket(b)||this.isPacketInSerial(b))&&0<Object.keys(this.rawDataQueue).length&&(b=this.rawDataQueue[b],null!=b&&(this.makeRecordingQueue(b.file,b.data),delete this.rawDataQueue[b.file],this.prevFile=b.file,b=this.orginalListOfFiles[b.file].next,"end"!==b&&this.formatRecording(b)))},isFileVcp(b){return null!=b&&null!=b.match(/^.*\.(vcp)$/)},calculateNextTime(b,a){const d=a.substring(0,21);a.substring(22,a.length);
[a]=d.split(" ");a=Math.trunc(a/1E6);return a-b},insertPacketInto(b,a){a=Math.trunc(a/1E3);if(!isNaN(a)&&1<=a&&!this.isTrimRecordingNow){const d={playTime:1E3,recObjs:'{"0{"user":{"userid":"2"},"m":{"app":"nothing","cf":"sync"}} ',type:"J"};for(let c=0;c<a;c++)b.push(d),this.totalTimeTillNow+=1E3}return b},renderContextMark(b,a,d){const c=100*b/this.totalTimeInMiliSeconds;b=virtualclass.getTemplate("context-mark");virtualclass.gObj.lastContext=d;a=Object.assign({},a,{id:"ctime"+c,width:c,context:d});
a=b(a);document.getElementById("allMarksinformation").insertAdjacentHTML("beforeend",a)},makeRecordingQueue(b,a){var d=[],c=null;a=a.trim().split(/(?:\r\n|\r|\n)/g);let g;for(let b=0;b<a.length;b++)if(null!=a[b]&&a[b]){this.totalElements++;var k=a[b].substring(0,21);var m=a[b].substring(22,a[b].length);[k,g]=k.split(" ");k=Math.trunc(k/1E6);null!=this.refrenceTime&&(c?(this.tempPlayTime=k-this.refrenceTime-c,c=null):this.tempPlayTime=k-this.refrenceTime);if(null!=m&&m){!this.joinRoomRecevied&&-1<
m.indexOf('"type":"joinroom"')&&(this.joinRoomRecevied=!0,m=JSON.parse(m),m.clientids=m.action,m=JSON.stringify(m));if(this.lastFileTime&&0===b){const a=Math.trunc(k-this.lastFileTime);d=this.insertPacketInto(d,a);this.tempPlayTime=1E3<a?a%1E3:a}b===a.length-1&&(this.lastFileTime=k);virtualclass.settings.info.trimRecordings?this.isTrimRecordingNow?(d.push({playTime:0,recObjs:m,type:g}),-1<m.indexOf('{"ac":21,"cf":"recs"')&&(this.trimofftime=k,this.isTrimRecordingNow=!1,this.totalTimeInMiliSeconds-=
this.trimofftime-this.trimontime,this.trimontime=this.trimofftime=0)):-1<m.indexOf('{"ac":11,"cf":"recs"')?(this.isTrimRecordingNow=!0,d.push({playTime:0,recObjs:m,type:g}),this.trimontime=k):(d.push({playTime:this.tempPlayTime,recObjs:m,type:g}),this.totalTimeTillNow+=this.tempPlayTime):(this.recordingTotalTime(m,k),d.push({playTime:this.tempPlayTime,recObjs:m,type:g}),this.totalTimeTillNow+=this.tempPlayTime);this.handleMarkSign(m);"undefined"!==typeof a[b+1]&&(m=this.calculateNextTime(k,a[b+1]),
d=this.insertPacketInto(d,m,b,k,a[b+1].substring(0,21)),1E3<=m&&(c=1E3*Math.trunc(m/1E3)));this.refrenceTime=k}}for(a=0;a<d.length;a++)"B"===d[a].type&&(c=virtualclass.dtCon.base64DecToArr(d[a].recObjs),d[a].recObjs=c);this.masterRecordings.push(d);d=virtualclass.recorder.getTimeFromFile(b);this.finishRequestDataFromServer(d);this.isTrimRecordingNow&&this.allFileFound&&(this.totalTimeInMiliSeconds-=k-this.trimontime,this.isTrimRecordingNow=!1);virtualclass.settings.info.trimRecordings&&0<this.masterRecordings.length?
(this.actualTotalPlayTime=this.getTotalTimeInMilSeconds(this.masterRecordings.length-1,this.masterRecordings[this.masterRecordings.length-1].length-1),this.currentMin=this.actualTotalPlayTime/1E3/60):(d=(d-this.firstTimeInSeconds)/60,d>this.currentMin&&(this.currentMin=d));this.updateTotalTime();this.UIdownloadProgress();(18E4<=6E4*this.currentMin||this.lastFile===b)&&0<this.masterRecordings.length&&(this.playStart?this.startToPlay():this.alreadyAskForPlay||(this.alreadyAskForPlay=!0,this.askToPlay()))},
handleMarkSign(b){-1<b.indexOf("readyContext")&&(virtualclass.settings.info.trimRecordings?this.markData.push({data:b,totalTimeTillNow:this.totalTimeTillNow}):this.initDisplayContextMark(b,this.totalTimeTillNow))},initDisplayContextMark(b,a){b=JSON.parse(io.cleanRecJson(b));const d={question:!1,note:!1,bookmark:!1};virtualclass.userInteractivity.allMarks[b.m.context]&&(virtualclass.userInteractivity.allMarks[b.m.context].question&&0<virtualclass.userInteractivity.allMarks[b.m.context].question.length&&
(d.question=!0),virtualclass.userInteractivity.allMarks[b.m.context].note&&(console.log("This context has note ",b.m.context),d.note=!0),virtualclass.userInteractivity.allMarks[b.m.context].bookmark&&(d.bookmark=!0));this.renderContextMark(a,d,b.m.context)},disaplayAllMarkSign(){document.getElementById("allMarksinformation").innerHTML="";for(let b=0;b<this.markData.length;b++)this.initDisplayContextMark(this.markData[b].data,this.markData[b].totalTimeTillNow)},recordingTotalTime(b,a){-1<b.indexOf('{"ac":11,"cf":"recs"')?
this.recordingOff=a:-1<b.indexOf('{"ac":21,"cf":"recs"')&&(this.recordingOn=a,a=this.recordingOn-this.recordingOff,b=this.totalTimeInMiliSeconds-a,a=this.totalRecordingTime-a,this.totalRecordingTime=this.totalRecordingTime?a:b,this.recordingOn=this.recordingOff=0)},handleStartToPlay(b){const a=document.querySelector(".rv-vanilla-modal-overlay.is-shown");null!=a&&a.removeEventListener("click",this.handleStartToPlay.bind(this));virtualclass.gesture.clickToContinue();this.startToPlay();b.currentTarget.classList.remove("askToPlayCont")},
startToPlay(){this.playStart?Object.prototype.hasOwnProperty.call(this,"isPausedByNotPresent")&&(delete this.isPausedByNotPresent,this.subRecordingIndex=0,this.subRecordings=this.masterRecordings[this.masterIndex],this.controller._play(),virtualclass.popup.closeElem()):(virtualclass.settings.info.trimRecordings&&this.disaplayAllMarkSign(),this.playStart=!0,this.playInt(),virtualclass.popup.closeElem())},isDownloadedAllRecordings(b){return 9E5<this.sessionStartTime?b>=virtualclass.recorder.lastTimeInSeconds:
!1},finishRequestDataFromServer(b){this.isDownloadedAllRecordings(b)&&(virtualclass.settings.info.trimRecordings&&this.disaplayAllMarkSign(),virtualclass.recorder.allFileFound=!0,virtualclass.recorder.alreadyAskForPlay&&(b=document.getElementById("askplayMessage"),null!=b&&(b.innerHTML=virtualclass.lang.getString("playsessionmsg"))))},UIdownloadProgress(){const b=virtualclass.recorder.totalTimeInMiliSeconds/1E3/60;this.downloadInPercentage=100*this.currentMin/b;virtualclass.pbar.renderProgressBar(b,
this.currentMin,"downloadProgressBar","downloadProgressValue");virtualclass.recorder.playStart&&!virtualclass.recorder.waitServer&&virtualclass.recorder.init()},playInt(){virtualclass.popup.closeElem();virtualclass.recorder.init(virtualclass.recorder.masterRecordings);virtualclass.config.setNewSession("thisismyplaymode");virtualclass.recorder.initController();virtualclass.media.audio.initAudiocontext()},askToPlay(){const b=document.querySelector(".rv-vanilla-modal-overlay.is-shown");b.addEventListener("click",
this.handleStartToPlay.bind(this));const a=document.querySelector("#loadingWindowCont .askToPlay");null!=a&&a.addEventListener("click",this.handleStartToPlay.bind(this));document.getElementById("popupContainer").classList.add("playPopup");b.classList.add("askToPlayCont")},playProgressOutput(b){},getOffset(b){"touchend"===b.type?b=this.lastEvent:b.touches?(b.offsetX=b.touches[0].pageX-b.touches[0].target.offsetLeft,b.offsetY=b.touches[0].pageY-b.touches[0].target.offsetTop):b=0;return this.lastEvent=
b},seekHandler(b){null==b.offsetX&&(b=this.getOffset(b));this.pauseBeforeSeek=this.controller.pause;if(!this.startSeek){this.startSeek=!0;var a=document.querySelector("#virtualclassCont");null!=a&&a.classList.add("recordSeeking");b=b.offsetX;a=this.getCustomWidth();this.seekValueInPercentage=b/a*100}},getCustomWidth(){return document.getElementById("downloadProgress").clientWidth-1},async seek(b){virtualclass.videoHost.UI.hideTeacherVideo();b=this.getSeekPoint(b);(b.master<this.masterIndex||b.master===
this.masterIndex&&b.sub<this.subRecordingIndex)&&await this.replayFromStart();await this._seek(b);this.triggerSynchPacket()},triggerSynchPacket(){this.triggerPlayProgress();this.binarySyncMsg&&(this.handleSyncPacket(),this.binarySyncMsg=null);this.handleSyncStringPacket()},_seek(b){this.controller._pause();let a;for(;;){a=null!=b?this.masterIndex!==b.master?this.masterRecordings[this.masterIndex].length:b.sub:this.masterRecordings[this.masterIndex].length;for(let b=this.subRecordingIndex;b<a;b++){try{if("B"!==
this.subRecordings[this.subRecordingIndex].type)this.msg=io.cleanRecJson(this.subRecordings[this.subRecordingIndex].recObjs),-1<this.msg.indexOf('"m":{"unshareScreen"')?this.binarySyncMsg=null:-1<this.msg.indexOf('},"m":{"poll":{"pollMsg":"stdPublish",')?virtualclass.poll.recordStartTime={app:"Poll",data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}}:-1<this.msg.indexOf('"m":{"videoUl":{"content_path"')?virtualclass.videoUl.videoStartTime={app:"Video",data:{masterIndex:this.masterIndex,
subIndex:this.subRecordingIndex}}:-1<this.msg.indexOf('"m":{"quiz":{"quizMsg":"stdPublish"')&&(virtualclass.quiz.quizStartTime={app:"Quiz",data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}}),io.onRecMessage(this.convertInto({data:this.msg}));else{this.msg=this.subRecordings[this.subRecordingIndex].recObjs;if(104===this.msg[0]||204===this.msg[0]||102===this.msg[0]||202===this.msg[0])if(0===this.msg[1]||1===this.msg[1])this.binarySyncMsg={data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}};
"ScreenShare"!==virtualclass.currApp||104!==this.msg[0]&&204!==this.msg[0]&&103!==this.msg[0]&&203!==this.msg[0]&&102!==this.msg[0]&&202!==this.msg[0]||(io.onRecMessage(this.convertInto({data:this.msg})),this.binarySyncMsg=null)}this.collectElapsedPlayTime()}catch(f){}this.subRecordingIndex++}this.elapsedRecTime=this.elapsedTime=this.elapsedPlayTime;if(void 0!=b&&this.masterIndex===b.master&&b.sub===this.subRecordingIndex)break;else this.subRecordingIndex=0,this.masterIndex++,this.subRecordings=this.masterRecordings[this.masterIndex]}},
handleSyncStringPacket(){let b;if("Poll"===virtualclass.currApp&&"object"===typeof virtualclass.poll.pollState.data&&Object.prototype.hasOwnProperty.call(virtualclass.poll,"recordStartTime")){var a=virtualclass.poll.recordStartTime.data.subIndex;b=virtualclass.poll.recordStartTime.data.masterIndex;var d=this.getTotalTimeInMilSeconds(b,a);virtualclass.poll.dataRec.setting.timer?this.pollUpdateTime(d,virtualclass.poll.pollState):(d=this.convertIntoReadable(this.elapsedPlayTime-d),virtualclass.poll.dataRec.newTime.min=
d.m,virtualclass.poll.dataRec.newTime.sec=d.s,virtualclass.poll.elapsedTimer())}else"Video"===virtualclass.currApp&&"object"===typeof virtualclass.videoUl&&Object.prototype.hasOwnProperty.call(virtualclass.videoUl,"videoStartTime")?(a=virtualclass.videoUl.videoStartTime.data.subIndex,b=virtualclass.videoUl.videoStartTime.data.masterIndex,d=this.getTotalTimeInMilSeconds(b,a),d=(this.elapsedPlayTime-d)/1E3,"object"===typeof virtualclass.videoUl.player?virtualclass.videoUl.playVideo(d):(virtualclass.videoUl.isPaused=
this.pauseBeforeSeek?!0:!1,virtualclass.videoUl.startTime=d)):"Quiz"===virtualclass.currApp&&"object"===typeof virtualclass.quiz&&(a=virtualclass.quiz.quizStartTime.data.subIndex,b=virtualclass.quiz.quizStartTime.data.masterIndex,d=document.querySelector("#qztime"),a=this.getTotalTimeInMilSeconds(b,a),0<+virtualclass.quiz.plugin.config.quizTime?(a=1E3*virtualclass.quiz.plugin.config.quizTime-(this.elapsedPlayTime-a),virtualclass.quiz.plugin.method.startTimer(a/1E3,d,"desc","vmQuiz")):(a=(this.elapsedPlayTime-
a)/1E3,virtualclass.quiz.plugin.method.startTimer(a,d,"asc","vmQuiz")))},pollUpdateTime(b,a){b=this.convertIntoReadable(1E3*a.data.setting.time.totalInSeconds-(this.elapsedPlayTime-b));virtualclass.poll.remainingTimer({min:b.m,sec:b.s})},handleSyncPacket(){if(this.binarySyncMsg){var b=this.binarySyncMsg.data.subIndex;let a=this.binarySyncMsg.data.masterIndex;for(;a<=this.masterIndex;){const d=this.masterRecordings[a];let c;for(c=this.masterIndex!=a?this.masterRecordings[this.masterIndex].length:this.subRecordingIndex;b<=
c;b++){this.msg=d[b];try{if(null!=this.msg&&"B"===this.msg.type&&(this.msg=this.msg.recObjs,104===this.msg[0]||204===this.msg[0]||103===this.msg[0]||203===this.msg[0]||102===this.msg[0]||202===this.msg[0]))io.onRecMessage(this.convertInto({data:this.msg}))}catch(g){}}if(this.masterIndex===a&&b===this.subRecordingIndex)break;else a++,b=0}this.playProgressBar(this.elapsedPlayTime)}},fetchRecViewData(){axios.post("https://api.congrea.net/data/analytics/recording/fetch",{session:wbUser.session,uid:wbUser.rid},
{method:"POST",headers:{"x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room,"content-type":"application/json"}}).then(b=>{this.viewPoint=this.mapper(b.data.Items[0])})},mapper(b){function a(a){return"object"===typeof a&&null!==a}if(a(b)){const d=Object.keys(b);for(;d.length;){const c=d.shift(),g=b[c];a(g)&&g.hasOwnProperty("S")?b[c]=g.S:a(g)&&g.hasOwnProperty("N")?b[c]=parseFloat(g.N):a(g)&&g.hasOwnProperty("BOOL")?b[c]=
g.BOOL:a(g)&&g.hasOwnProperty("NULL")?b[c]=null:a(g)&&g.hasOwnProperty("M")?b[c]=this.mapper(g.M):a(g)&&g.hasOwnProperty("L")?b[c]=this.mapper(g.L):a(g)&&g.hasOwnProperty("SS")?b[c]=g.SS:a(g)&&g.hasOwnProperty("NN")?b[c]=g.NN:a(g)&&g.hasOwnProperty("BB")?b[c]=g.BB:a(g)&&g.hasOwnProperty("NS")?b[c]=g.NS:a(g)&&g.hasOwnProperty("BS")&&(b[c]=g.BS)}}return b},getSeekPoint(b){b=Math.trunc(this.totalTimeInMiliSeconds*b/100);this.count=Math.floor(b/5E3);let a=0;for(let d=0;d<this.masterRecordings.length;d++)for(let c=
0;c<this.masterRecordings[d].length;c++){a+=this.masterRecordings[d][c].playTime;if(a===b)return{master:d,sub:c};if(a>=b)return 0<c?c--:(d--,c=0<=d?this.masterRecordings[d].length-1:0),{master:d,sub:c}}},play(){this.controller.pause||(this.config(),this.isPlayFinished()?(this.masterRecordings[this.masterIndex]&&-1<this.masterRecordings[this.masterIndex][this.subRecordingIndex].recObjs.indexOf('"cf":"sEnd"')&&this.playProgressBar(this.totalTimeInMiliSeconds),this.allFileFound?this.askAgainToPlay():
(this.controller._pause(),this.initReplayWindow(),document.querySelector("#loadingWindowCont .loading").style.display="block",document.querySelector("#loadingWindowCont .askToPlay").style.display="none",this.isPausedByNotPresent=!0)):this.executePacketToPlay())},config(){0===this.masterIndex&&0===this.subRecordingIndex&&(this.startTime=performance.now(),this.reserveTime=this.playTimePreviousSeconds=this.elapsedRecTime=this.elapsedTime=0,document.getElementById("recPlay"),this.doControlActive(recPauseCont));
"undefined"!==typeof this.playTimeout&&this.playTimeout&&clearTimeout(this.playTimeout);Object.prototype.hasOwnProperty.call(this,"playTime")||(this.subRecordings=this.masterRecordings[this.masterIndex],io.cfg=JSON.parse(this.subRecordings[this.subRecordingIndex].recObjs),virtualclass.gObj.uRole="s")},executePacketToPlay(){this.calcPlayTime();0===this.playTime?(this.triggerPlayProgress(),this.executePacketToPlayActual(),this.calcPlayTimeNext(),this.play()):this.playTimeout=setTimeout(()=>{this.triggerPlayProgress();
this.executePacketToPlayActual();this.calcPlayTimeNext();this.play()},this.playTime)},executePacketToPlayActual(){try{0>this.subRecordings[this.subRecordingIndex].recObjs.indexOf('"cf":"sync"')&&(io.onRecMessage(this.convertInto({data:this.subRecordings[this.subRecordingIndex].recObjs})),"Poll"===virtualclass.currApp&&-1<this.subRecordings[this.subRecordingIndex].recObjs.indexOf('},"m":{"poll":{"pollMsg":"stdPublish",')?virtualclass.poll.recordStartTime={app:"Poll",data:{masterIndex:this.masterIndex,
subIndex:this.subRecordingIndex}}:"Video"===virtualclass.currApp&&-1<this.subRecordings[this.subRecordingIndex].recObjs.indexOf('"m":{"videoUl":{"content_path"')?virtualclass.videoUl.videoStartTime={app:"Video",data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}}:"Quiz"===virtualclass.currApp&&-1<this.subRecordings[this.subRecordingIndex].recObjs.indexOf('"m":{"quiz":{"quizMsg":"stdPublish",')&&(virtualclass.quiz.quizStartTime={app:"Quiz",data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}})),
this.recordingViewByStudent()}catch(b){}},recordingViewByStudent(){if(null===this.timeStamp){this.timeStamp=(new Date((new Date).toUTCString())).getTime();this.recViewData.data[this.timeStamp]=[];const b=this.totalRecordingTime?this.totalRecordingTime:this.totalTimeInMiliSeconds,a=Math.floor(b/5E3);void 0!==this.viewPoint?this.recDataConvertIntoArrayForm(a):this.recData=Array(a);this.recViewData.data.rtt=b;this.recViewData["x-congrea-uid"]=wbUser.rid}-1<this.subRecordings[this.subRecordingIndex].recObjs.indexOf('{"ac":11,"cf":"recs"')?
this.recording="off":-1<this.subRecordings[this.subRecordingIndex].recObjs.indexOf('{"ac":21,"cf":"recs"')&&(this.recording="on");"on"===this.recording&&(this.actualPlayRecordingTime+=this.subRecordings[this.subRecordingIndex].playTime,5E3<=this.actualPlayRecordingTime&&(this.remainingSeconds=this.actualPlayRecordingTime-5E3,void 0===this.recData[this.count]&&this.recData.splice(this.count,1,this.timeStamp),this.count++,this.actualPlayRecordingTime=this.remainingSeconds))},recDataConvertIntoArrayForm(b){var a=
this.viewPoint.data[Object.keys(this.viewPoint.data)[0]];this.recData=Array(b);if(null!==a)for(const c in this.viewPoint.data){b=c;a=this.viewPoint.data[c];for(let c=0;c<a.length;c++){var d=+Object.keys(a[c])[0];const f=Object.values(a[c])[0];for(;d<f;d++)this.recData.splice(d,1,+b)}}},isPlayFinished(){return"undefined"===typeof this.masterRecordings[this.masterIndex]&&("undefined"===typeof this.subRecordings||"undefined"===typeof this.subRecordings[this.subRecordingIndex])||"undefined"!==typeof this.subRecordings&&
"undefined"!==typeof this.subRecordings[this.subRecordingIndex]&&"J"===this.subRecordings[this.subRecordingIndex].type&&-1<this.subRecordings[this.subRecordingIndex].recObjs.indexOf('{"sEnd"')},triggerPauseVideo(){virtualclass.videoUl&&virtualclass.videoUl.player&&(virtualclass.videoUl.player.pause(),virtualclass.videoUl.isPaused=!0)},triggerPlayVideo(){"Video"===virtualclass.currApp&&virtualclass.videoUl&&virtualclass.videoUl.player&&(virtualclass.videoUl.player.play(),virtualclass.videoUl.isPaused=
!1)},askAgainToPlay(){if(this.subRecordings&&0>this.subRecordings[this.subRecordingIndex].recObjs.indexOf("sEnd"))io.onRecMessage(this.convertInto({data:this.subRecordings[this.subRecordingIndex].recObjs}));virtualclass.recorder.allFileFound?virtualclass.recorder.allFileFound&&this.initReplayWindow():(virtualclass.recorder.waitServer=!0,virtualclass.recorder.waitPopup=!1,this.displayWaitPopupIfNot())},initReplayWindow(){this.triggerPauseVideo();virtualclass.popup.replayWindow();virtualclass.popup.sendBackOtherElems();
document.getElementById("replayClose").addEventListener("click",()=>{c.close()});document.getElementById("replayButton").addEventListener("click",()=>{virtualclass.recorder.controller.pause=!1;virtualclass.recorder.replayFromStart.call(virtualclass.recorder)})},getCurrentPacket(){let b=0;if(0<this.masterIndex)for(let a=0;a<this.masterIndex;a++)b+=this.masterRecordings[a].length;return b+this.subRecordingIndex},collectElapsedPlayTime(){this.elapsedPlayTime+=this.subRecordings[this.subRecordingIndex].playTime},
triggerPlayProgress(){this.collectElapsedPlayTime();0===this.masterIndex&&0===this.subRecordingIndex?this.playProgressBar(this.elapsedPlayTime):(this.playTimeNowSeconds=Math.round(this.elapsedPlayTime/1E3),this.playTimeNowSeconds>this.playTimePreviousSeconds&&(this.playProgressBar(this.elapsedPlayTime),virtualclass.popup.sendBackOtherElems(),this.playTimePreviousSeconds=this.playTimeNowSeconds))},calcPlayTime(){"object"===typeof this.subRecordings[this.subRecordingIndex]&&(this.playTimePak=this.subRecordings[this.subRecordingIndex].playTime/
this.controller.ff);this.timeNow=performance.now();this.diffTime=this.timeNow-this.startTime;this.startTime=this.timeNow;this.elapsedTime+=this.diffTime;this.playTime=Math.round(this.playTimePak-(this.elapsedTime-this.elapsedRecTime));this.elapsedRecTime+=this.playTimePak;0>this.playTime&&(this.playTime=0)},calcPlayTimeNext(){this.subRecordingIndex+1==this.subRecordings.length?(this.masterIndex++,this.subRecordings=this.masterRecordings[this.masterIndex],this.subRecordingIndex=0):this.subRecordingIndex++},
initController(){if(null!=document.getElementById("playControllerCont")){var b=this;const a=document.getElementsByClassName("ff");for(let d=0;d<a.length;d++)a[d].onclick=function(){var a=this.id.split("ff")[1];b.controller.fastForward(parseInt(a,10));a=document.querySelector("#dispVideo");virtualclass.videoUl&&virtualclass.videoUl.player&&a.classList.contains("vjs-paused")&&virtualclass.videoUl.player.play();"replayFromStart"!==this.parentNode.id&&b.doControlActive(this)};b=this;const d=document.getElementById("recPause");
d.addEventListener("click",()=>{d.parentNode.classList.contains("recordingPlay")?b.initRecPause():b.initRecPlay()})}},initRecPause(){var b=document.getElementById("recPause");this.controller._pause();this.doControlActive(b);virtualclass.recorder.triggerPauseVideo();b.parentNode.classList.remove("recordingPlay");b.dataset.title=virtualclass.lang.getString("Play");virtualclass.liveStream.lastFileRequested&&(b=document.getElementById("liveStream"),null!=b&&b.pause())},initRecPlay(){const b=document.getElementById("recPause");
this.controller._play();this.doControlActive(b);if(virtualclass.videoUl&&virtualclass.videoUl.player)virtualclass.videoUl.player.play();else if(virtualclass.liveStream.lastFileRequested){const a=document.getElementById("liveStream");null!=a&&a.play()}b.parentNode.classList.add("recordingPlay");b.dataset.title=virtualclass.lang.getString("Pause")},doControlActive(b){const a=document.getElementById("playControllerCont").getElementsByClassName("recButton");for(let b=0;b<a.length;b++)a[b].classList.remove("controlActive");
b.parentNode.classList.add("controlActive")},controller:{pause:!1,ff:1,_play(){virtualclass.recorder.startTime=performance.now();this.ff=1;this.pause=!1;virtualclass.recorder.play()},_pause(){this.pause=!0},fastForward(b){this.ff=b;this.pause=!1;virtualclass.recorder.play()}},sendData(b,a,d){this.cb=d;b=JSON.stringify(b);this.httpObj.open("POST",a);this.httpObj.setRequestHeader("x-api-key",wbUser.lkey);this.httpObj.setRequestHeader("x-congrea-authuser",wbUser.auth_user);this.httpObj.setRequestHeader("x-congrea-authpass",
wbUser.auth_pass);this.httpObj.setRequestHeader("x-congrea-room",wbUser.room);this.httpObj.setRequestHeader("Content-Type","application/json");this.httpObj.withCredentials=!1;this.httpObj.send(b)},sortingFiles(b){return b.sort(function(a,b){return a<b?-1:a>b?1:0})},setOrginalListOfFiles(b){const a={};for(let d=0;d<b.length;d++)a[b[d]]=null!=b[d+1]?{index:d,next:b[d+1]}:{index:d,next:"end"};return a},triggerDownloader(){this.tryNumberOfTimes=1;Object.prototype.hasOwnProperty.call(this,"triggerDownloaderTime")&&
clearInterval(this.triggerDownloaderTime);Object.prototype.hasOwnProperty.call(this,"startTimeCounter")&&clearInterval(this.startTimeCounter);let b=0;this.startTimeCounter=setInterval(()=>{b++},1E3);this.triggerDownloaderTime=setInterval(()=>{3<this.tryNumberOfTimes?(virtualclass.recorder.allFileFound=!0,clearInterval(this.triggerDownloaderTime.triggerDownloaderTime),this.isPlayFinished()&&(-1<this.masterRecordings[this.masterIndex][this.subRecordingIndex].recObjs.indexOf('"cf":"sEnd"')&&this.playProgressBar(this.totalTimeInMiliSeconds),
this.askAgainToPlay())):virtualclass.xhrn.vxhrn.post(virtualclass.api.recordingFiles).then(a=>{this.afterDownloadingList(a.data)})},18E4)},afterDownloadingList(b){let a;if(null!=b&&Object.prototype.hasOwnProperty.call(b,"Item")){var d=+b.Item.time.N;this.sessionStartTime=(new Date).getTime()-d;d=[...new Set(b.Item.list.L.map(a=>a.S))];b=d.length;if(this.lastRecordings&&d.length===this.lastRecordings)this.tryNumberOfTimes=this.tryNumberOfTimes?++this.tryNumberOfTimes:1;else{delete this.alreadyCalcTotTime;
this.totalRecordingFiles=this.sortingFiles(d);this.lastFile=this.totalRecordingFiles[this.totalRecordingFiles.length-1];this.orginalListOfFiles=this.setOrginalListOfFiles(this.totalRecordingFiles);this.calculateTotalPlayTime();d=this.totalRecordingFiles.shift();this.firstxhr=axios.create({timeout:6E5,withCredentials:!0});this.requestDataFromServer(d,this.firstxhr);for(const b in this.totalRecordingFiles)d=virtualclass.recorder.session,a=this.totalRecordingFiles[b],virtualclass.createPrefetchLink(`https://recording.congrea.net/${wbUser.lkey}/${wbUser.room}/${d}/${a}`);
9E5>this.sessionStartTime&&this.triggerDownloader()}this.lastRecordings=b}else this.tryNumberOfTimes=this.tryNumberOfTimes?++this.tryNumberOfTimes:1,this.triggerDownloader()},requestListOfFiles(){this.fetchRecViewData();this.actualTotalPlayTime=0;this.session=wbUser.session;virtualclass.xhrn.vxhrn.post(virtualclass.api.recordingFiles,{session:virtualclass.recorder.session}).then(b=>{this.afterDownloadingList(b.data)})},calculateTotalPlayTime(){var b=virtualclass.recorder.totalRecordingFiles;const a=
Math.trunc(+b[0].split("-")[0]/1E6);b=Math.trunc(+b[b.length-1].split("-")[1].split(".")[0]/1E6);this.totalTimeInMiliSeconds=b-a;this.lastTimeInSeconds=Math.trunc(b/1E3);this.firstTimeInSeconds=Math.trunc(a/1E3)},getTimeFromFile(b){return+b.split("-")[1].split(".")[0]/1E9},totalPlayTime(){let b=0;for(let a=0;a<virtualclass.recorder.masterRecordings.length;a++)for(let d=0;d<virtualclass.recorder.masterRecordings[a].length;d++)b+=virtualclass.recorder.masterRecordings[a][d].playTime;return b/1E3},getTotalTimeInMilSeconds(b,
a){let d=0,c=0;for(;d<=b;){for(let f=0;f<virtualclass.recorder.masterRecordings[d].length&&(c+=virtualclass.recorder.masterRecordings[d][f].playTime,b!==d||a!==f);f++);d+=1}return c},getTempTotalTimeInMilSeconds(b,a){let d=0,c=0;for(;d<=b;){for(let f=0;f<this.orginalTimes[d].length&&(c+=this.orginalTimes[d][f],b!==d||a!==f);f++);d++}return c},getTotalElementLength(){let b=0;for(let a=0;a<virtualclass.recorder.masterRecordings.length;a++)b+=virtualclass.recorder.masterRecordings[a].length;return b},
seekWithMouseMove(b){null==b.offsetX&&(b=this.getOffset(b));if(this.startSeek){this.controller._pause();this.seekValueInPercentage=this.getSeekValueInPercentage(b);this.downloadInPercentage<this.seekValueInPercentage&&(this.seekValueInPercentage=Math.trunc(this.downloadInPercentage));this.setPlayProgressTime(this.seekValueInPercentage);virtualclass.pbar.renderProgressBar(this.totalTimeInMiliSeconds,6E4*this.seekTimeWithMove.m+1E3*this.seekTimeWithMove.s,"playProgressBar",void 0);const a=this.seekTimeWithMove.h,
d=this.seekTimeWithMove.m,c=this.seekTimeWithMove.s;document.querySelector("#tillRepTime").innerHTML=`${a}:${d}:${c}`;this.displayTimeInHover(b,this.seekValueInPercentage)}},getSeekValueInPercentage(b){const a=this.getCustomWidth();return b.offsetX/a*100},handlerDisplayTime(b){const a=this.getSeekValueInPercentage(b);this.displayTimeInHover(b,a)},displayTimeInHover(b,a){this.setPlayProgressTime(a);b=20>b.offsetX?3:5>c.innerWidth-b.offsetX?b.offsetX-65:30>c.innerWidth-b.offsetX?b.offsetX-60:40>c.innerWidth-
b.offsetX?b.offsetX-35:b.offsetX-25;a=document.getElementById("timeInHover");a.style.display="block";a.style.marginLeft=`${b}px`;b=this.seekTimeWithMove.h;a=this.seekTimeWithMove.m;const d=this.seekTimeWithMove.s;document.getElementById("timeInHover").innerHTML=`${b}:${a}:${d}`;document.querySelector("#virtualclassCont").classList.add("recordSeeking")},setPlayProgressTime(b){this.seekTimeWithMove=this.convertIntoReadable(b*this.totalTimeInMiliSeconds/100)},async finalSeek(b){b.offsetX||this.getOffset(b);
this.startSeek&&Object.prototype.hasOwnProperty.call(this,"seekValueInPercentage")&&(virtualclass.liveStream&&virtualclass.liveStream.clearEveryThing(),this.downloadInPercentage<this.seekValueInPercentage&&(this.seekValueInPercentage=Math.trunc(this.downloadInPercentage)),0<this.seekValueInPercentage&&await this.seek(this.seekValueInPercentage),this.pauseBeforeSeek?(this.controller._pause(),this.triggerPauseVideo()):(this.controller._play(),this.triggerPlayVideo()),"Video"===virtualclass.currApp&&
virtualclass.liveStream.lastFileRequested&&(virtualclass.liveStream.callFromSeek=!0,virtualclass.liveStream.requestInitializePacket(virtualclass.liveStream.lastFileRequested)),document.getElementById("timeInHover").style.display="none");document.querySelector("#virtualclassCont").classList.remove("recordSeeking");delete this.seekValueInPercentage;this.startSeek=!1;b=document.getElementById("congrealogo");null!=b&&b.classList.remove("disbaleOnmousedown")},initRecordViewHandler(){let b=!1;c.addEventListener("unload",
()=>{b||(virtualclass.recorder.recDataSend(),console.log("Send recording view data 1"),b=!0)});document.addEventListener("visibilitychange",()=>{b||"hidden"!==document.visibilityState||(virtualclass.recorder.recDataSend(),console.log("Send recording view data 2"),b=!0);"visible"===document.visibilityState&&(b=!1)});"mobTab"===virtualclass.system.device&&backDection.backDetect("#virtualclassCont",()=>{b||(virtualclass.recorder.recDataSend(),b=!0,setTimeout(()=>{virtualclassSetting.congreaWindow.close()},
500))})}}})(window);(function(c){c.storage={version:1,mycacheQueue:[],mycacheInQueue:[],mycacheOutQueue:[],async init(){this.tables=["cacheAll","cacheOut","cacheIn"];this.db=await virtualclass.virtualclassIDBOpen("congrea",this.version,{upgrade(b){virtualclass.storage.onupgradeneeded(b)}})},onupgradeneeded(b){b.objectStoreNames.contains("cacheAll")||b.createObjectStore("cacheAll");b.objectStoreNames.contains("cacheOut")||b.createObjectStore("cacheOut");b.objectStoreNames.contains("cacheIn")||b.createObjectStore("cacheIn")},
storeCacheAll(b,a){const d=this.db.transaction("cacheAll","readwrite");a[0]=+a[0];a[1]=+a[1];d.store.put(b,a);d.done.then(()=>{},()=>{})},storeCacheOut(b,a){const d=this.db.transaction("cacheOut","readwrite");d.store.put(b,a);d.done.then(()=>{},()=>{})},storeCacheIn(b,a){const d=this.db.transaction("cacheIn","readwrite");d.store.put(b,a);d.done.then(()=>{},()=>{})},async getDataFromCacheAll(){for(var b=await this.db.transaction("cacheAll").store.openCursor();b;)b.value&&(Array.isArray(this.mycacheQueue[b.key[0]])||
(this.mycacheQueue[b.key[0]]=[]),this.mycacheQueue[b.key[0]][b.key[1]]=b.value),b=await b.continue();if(0<this.mycacheQueue.length)for(const a in this.mycacheQueue){ioMissingPackets.validateAllVariables(a);for(const d in this.mycacheQueue[a])b=JSON.parse(this.mycacheQueue[a][d]),a===virtualclass.gObj.uid&&(ioAdapter.validateAllVariables(a),ioAdapter.serial=parseInt(d,10),ioAdapter.adapterMustData[ioAdapter.serial]=b),ioMissingPackets.executedSerial[a]=b.m.serial,ioMissingPackets.executedStore[a][b.m.serial]=
b,io.onRecJson(b)}},async getDataFromCacheIn(){for(var b=await this.db.transaction("cacheIn").store.openCursor();b;)b.value&&(Array.isArray(this.mycacheInQueue[b.key[0]])||(this.mycacheInQueue[b.key[0]]=[]),this.mycacheInQueue[b.key[0]][b.key[1]]=b.value),b=await b.continue();if(0<this.mycacheInQueue.length)for(const a in this.mycacheInQueue){ioMissingPackets.validateAllUserVariables(a);for(const d in this.mycacheInQueue[a]){b=JSON.parse(this.mycacheInQueue[a][d]);ioMissingPackets.executedUserSerial[a]=
b.m.userSerial;ioMissingPackets.executedUserStore[a][b.m.userSerial]=b;try{if("eddata"!==b.m.cf&&"colorIndicator"!==b.m.cf&&"reqscreen"!==b.m.cf&&"msg"!==b.m.cf)io.onRecJson(b)}catch(f){}}}},async getDataFromCacheOut(){for(var b=await this.db.transaction("cacheOut").store.openCursor();b;)b.value&&(Array.isArray(this.mycacheOutQueue[b.key[0]])||(this.mycacheOutQueue[b.key[0]]=[]),this.mycacheOutQueue[b.key[0]][b.key[1]]=b.value),b=await b.continue();if(0<this.mycacheOutQueue.length)for(const a in this.mycacheOutQueue)for(const d in this.mycacheOutQueue[a]){b=
JSON.parse(this.mycacheOutQueue[a][d]);ioAdapter.validateAllVariables(a);ioAdapter.userSerial[a]=parseInt(d,10);ioAdapter.userAdapterMustData[a][ioAdapter.userSerial[a]]=b;try{if("eddata"!==b.m.cf&&"reqscreen"!==b.m.cf&&"msg"!==b.m.cf)io.onRecJson(b)}catch(f){console.log(`Error ${f}`)}}},clearSingleTable(b,a){this.db.transaction(b,"readwrite").store.clear();"undefined"!==typeof a&&a()},async clearStorageData(){ioAdapter.adapterMustData=[];ioAdapter.serial=-1;ioAdapter.userSerial=[];ioAdapter.userAdapterMustData=
[];ioMissingPackets.executedStore=[];ioMissingPackets.executedSerial={};ioMissingPackets.missRequest=[];ioMissingPackets.aheadPackets=[];ioMissingPackets.missRequestFlag=0;ioMissingPackets.executedUserStore=[];ioMissingPackets.executedUserSerial={};ioMissingPackets.missUserRequest=[];ioMissingPackets.aheadUserPackets=[];ioMissingPackets.missUserRequestFlag=0;await Promise.all([this.clearSingleTable("cacheAll"),this.clearSingleTable("cacheIn"),this.clearSingleTable("cacheOut")]);Object.prototype.hasOwnProperty.call(virtualclass.gObj,
"sessionEndResolve")&&virtualclass.gObj.sessionEndResolve()},clearLastTable(){Object.prototype.hasOwnProperty.call(virtualclass.gObj,"sessionEndResolve")&&virtualclass.gObj.sessionEndResolve()}}})(window);(function(c,b){c.user=function(){return{readyLeftBar(a,b){roles.hasControls()&&(roles.isEducator()||virtualclass.html.leftAppBar(),virtualclass.attachFunction(),Object.prototype.hasOwnProperty.call(virtualclass,"previrtualclass")?virtualclass.vutil.makeActiveApp(`virtualclass${b}`,virtualclass.previrtualclass):virtualclass.vutil.makeActiveApp(`virtualclass${b}`))},teacherIsAlreadyExist(){const a=b.getElementById("chat_div").getElementsByClassName("ui-memblist-usr");let d;for(let b=0;b<a.length;b++)if(d=
a[b].getAttribute("data-role"),"t"===d||"e"===d)return!0;return!1},createControl(a,d){const c=b.createElement("div");c.id=`${a}ControlContainer`;c.className="controls";this.createControlDivs(c,a,d);return c},createControllerElement(a,d){const c=b.createElement("span");c.id=`${a+d}Img`;const g=b.createElement("a");g.id=`${a+d}Anch`;g.className="congtooltip";g.appendChild(c);const k=b.createElement("div");k.id=`${a+d}Cont`;k.className="controleCont";k.appendChild(g);return[k,c]},createAssignControl(a,
d,c,g){const f=this;var m=this.createControllerElement(d,"contrAssign");const n=m[0],r=m[1];m=b.getElementById(`${d}ControlContainer`);null!=m?0>=m.getElementsByClassName("controleCont").length?m.appendChild(n):m.insertBefore(n,m.firstChild):a.appendChild(n);virtualclass.user.control.changeAttribute(d,r,c,"assign","aRole");"undefined"!==typeof g&&(r.className+=" currTeacher");r.addEventListener("click",()=>{f.control.init.call(f,r)})},createControlDivs(a,b,c){const d=this;let f;let m,n,r,t,z=!1,v=
localStorage.getItem(`virtualclass${b}`);null!=v&&(z=!0,v=JSON.parse(v),Object.prototype.hasOwnProperty.call(v,"currTeacher")&&(virtualclass.gObj[`${b}currTeacher`]={},!0===v.currTeacher?(f=virtualclass.user.control.currTeacherAlready=!0,virtualclass.gObj[`${b}currTeacher`].ct=!0):virtualclass.gObj[`${b}currTeacher`].ct=!1));const u=!roles.isEducator(),p=virtualclass.vutil.userIsOrginalTeacher(b);for(let g=0;g<c.length;g++)if("assign"===c[g]&&p)"undefined"!==typeof f?this.createAssignControl(a,b,
u,f):this.createAssignControl(a,b,u);else if("audio"===c[g]){var q=this.createControllerElement(b,"contrAud");var A=q[0];m=q[1];a.appendChild(A);A=z&&Object.prototype.hasOwnProperty.call(v,"aud")?!!v.aud:!0;virtualclass.user.control.changeAttribute(b,m,A,"audio","aud");p&&m.addEventListener("click",()=>{d.control.init.call(d,m)});roles.hasAdmin()&&"false"===m.dataset.audioDisable&&(A=localStorage.getItem("allAudioAction"),null!=A&&"disable"===A&&m.click())}else"chat"===c[g]?(q=this.createControllerElement(b,
"contrChat"),A=q[0],n=q[1],a.appendChild(A),p&&n.addEventListener("click",()=>{d.control.init.call(d,n)}),r=z&&Object.prototype.hasOwnProperty.call(v,"chat")?!!v.chat:!0,virtualclass.user.control.changeAttribute(b,n,r,"chat","chat")):"editorRich"===c[g]||"editorCode"===c[g]?roles.hasAdmin()&&(t=z&&Object.prototype.hasOwnProperty.call(v,c[g])?!!v[c[g]]:!1,q=this.createControllerElement(b,`contr${c[g]}`),A=q[0],q=q[1],A.className+=` controller${c[g]}`,a.appendChild(A),virtualclass.currApp!==virtualclass.vutil.capitalizeFirstLetter(c[g])&&
(A.style.display="none"),virtualclass.user.control.changeAttribute(b,q,t,c[g],c[g]),p&&q.addEventListener("click",d.closureEditor(d,q))):"RaiseHand"===c[g]&&(rhEnable=z&&Object.prototype.hasOwnProperty.call(v,"raiseHand")?!!v.raiseHand:!0,virtualclass.user.control.changeAttribute(b,n,r,"RaiseHand","RaiseHand"))},closureEditor(a,b){return function(){a.control.init.call(a,b)}},control:{toggleDisplayWriteModeMsgBox(a,d){let c=b.getElementById(`${a}writeModeBox`);var g=virtualclass.lang.getString("readonlymode"),
k=virtualclass.lang.getString("writemode");g=d?k:g;k=b.getElementById(`virtualclass${a}Body`);null==c&&null!=k&&(c=b.createElement("div"),c.id=`${a}writeModeBox`,k.appendChild(c));null!=c&&(c.className="writeModeBox",c.dataset.writeMode=d,c.innerHTML=g);"EditorRich"===a&&this.tooglDisplayEditorToolBar(d)},tooglDisplayEditorToolBar(a){virtualclass.editorRich.editorStatus=a;const d=b.getElementsByClassName("vceditor-toolbar"),c=d[0];0<d.length&&(a?(c.style.pointerEvents="visible",c.style.opacity="1"):
(c.style.pointerEvents="none",c.style.opacity="0.5"))},receivedEditorRich(a){a.status?(virtualclass.gObj.uid===a.toUser?"object"!==typeof virtualclass.editorRich.cm||virtualclass.isPlayMode||virtualclass.editorRich.cm.setOption("readOnly",!1):this.enable(a.toUser,"editorRich","editorRich","editorRich"),virtualclass.isPlayMode&&virtualclass.editorRich.control.toggleDisplayWriteModeMsgBox(!1),a=!0):(virtualclass.gObj.uid===a.toUser?"object"===typeof virtualclass.editorRich.cm&&(virtualclass.editorRich.cm.setOption("readOnly",
"nocursor"),(a=b.querySelector("#virtualclassEditorRichBody #overlay"))&&a.parentNode.removeChild(a),a=b.querySelector("#virtualclassEditorRichBody .vceditor-toolbar .open"),null!=a&&(a.classList.remove("open"),a.classList.add("close"))):this.disable(a.toUser,"editorRich","editorRich","editorRich"),a=!1);roles.hasAdmin()||this.toggleDisplayWriteModeMsgBox("EditorRich",a)},receivedEditorCode(a){a.status?(virtualclass.gObj.uid===a.toUser?"object"!==typeof virtualclass.editorCode.cm||virtualclass.isPlayMode||
virtualclass.editorCode.cm.setOption("readOnly",!1):this.enable(a.toUser,"editorCode","editorCode","editorCode"),virtualclass.isPlayMode&&virtualclass.editorCode.control.toggleDisplayWriteModeMsgBox(!1),a=!0):(virtualclass.gObj.uid===a.toUser?"object"===typeof virtualclass.editorCode.cm&&virtualclass.editorCode.cm.setOption("readOnly","nocursor"):this.disable(a.toUser,"editorCode","editorCode","editorCode"),a=!1);roles.hasAdmin()||this.toggleDisplayWriteModeMsgBox("EditorCode",a);virtualclass.vutil.setReadModeWhenTeacherIsDisConn("editorCode")},
onmessage(a){Object.prototype.hasOwnProperty.call(a.message,"toUser")||(a.message.toUser=virtualclass.gObj.uid);this[`received${virtualclass.vutil.capitalizeFirstLetter(a.message.control)}`](a.message)},addCurrTeacherToControl(a){const d=b.getElementById(a);null!=d&&(virtualclass.vutil.elemHasAnyClass(a)?d.classList.add("currTeacher"):d.className="currTeacher")},removeCurrTeacherFromControl(a){var d=b.getElementById(a);virtualclass.vutil.elemHasAnyClass(a)&&(d.classList.remove("currTeacher"),d=a.indexOf("contr"),
a=a.substring(0,d),virtualclass.user.control.updateUser(a,"currTeacher",!1))},removeAudioFromParticipate(a){a=b.getElementById(`${a}contrAssignCont`);null!=a&&a.parentNode.removeChild(a)},disable(a,b,c,g){a.parentNode.setAttribute("data-title",virtualclass.lang.getString(`${b}Disable`));a.setAttribute(`data-${b}-disable`,"true");a.className=`icon-${b}Img block ${b}Img`;if("assign"===b)a.parentNode.classList.remove("tooltip"),this.addCurrTeacherToControl(a.id),a=localStorage.getItem(`virtualclass${c}`),
a=JSON.parse(a),Object.prototype.hasOwnProperty.call(virtualclass.gObj,`${c}currTeacher`)?(virtualclass.gObj[`${c}currTeacher`].ct||Object.prototype.hasOwnProperty.call(virtualclass.gObj,"controlAssign")&&virtualclass.gObj.controlAssign&&a.currTeacher)&&virtualclass.user.control.updateUser(c,"currTeacher",!0):Object.prototype.hasOwnProperty.call(virtualclass.gObj,"controlAssign")&&virtualclass.gObj.controlAssignId===c&&virtualclass.user.control.updateUser(c,"currTeacher",!0);else if("audio"===b||
"chat"===b)a.className=`icon-${b}DisImg block ${b}DisImg`;virtualclass.user.control.updateUser(c,g,!1)},enable(a,b,c,g){a.parentNode.setAttribute("data-title",virtualclass.lang.getString(`${b}Enable`));a.setAttribute(`data-${b}-disable`,"false");a.className=`icon-${b}Img enable ${b}Img`;virtualclass.user.control.updateUser(c,g,!0)},changeAttribute(a,b,c,g,k){c?virtualclass.user.control.enable(b,g,a,k):virtualclass.user.control.disable(b,g,a,k)},init(a,b,c,g){var d="undefined"!==typeof c?c:"Img";var f=
a.id;c=f.indexOf("contr");c=f.substring(0,c);f=f.split("contr")[1];d=f.indexOf(d);f=f.substring(0,d);if("Assign"===f)virtualclass.vutil.appIsForEducator(virtualclass.currApp)&&(virtualclass.gObj.controlAssign=!0,virtualclass.gObj.controlAssignId=c,g="true"===a.getAttribute("data-assign-disable"),g||(this.control.changeAttribute(c,a,g,"assign","aRole"),virtualclass.user.control.changeAttrToAssign("block")),roles.hasAdmin()||virtualclass.user.control.removeAudioFromParticipate(c));else{let k;"stdscreen"===
f?(roles.hasControls()&&"virtualclassScreenShare"===virtualclass.previous&&virtualclass.vutil.initDefaultApp(),this.control.stdscreen.call(this.control,c),"Video"===virtualclass.currApp&&virtualclass.videoUl.player&&(ioAdapter.mustSend({videoUl:{init:"destroyPlayer"},cf:"destroyPlayer"}),ioAdapter.mustSend({videoUl:{init:"studentlayout"},cf:"videoUl"}),virtualclass.dashboard.init(),virtualclass.vutil.removeBackgroundVideoApp())):("Chat"===f?(a.className="contrChatBlock",d="chat"):d="Aud"===f?"audio":
f,"undefined"!==typeof b?b=(k="enable"===b)?"enable":"block":"true"===a.getAttribute(`data-${d}-disable`)?(b="enable",k=!0):(b="block",k=!1),f=virtualclass.vutil.smallizeFirstLetter(f),this.control.changeAttribute(c,a,k,d,f),null==g&&this.control[`${d}`].call(this.control,c,b))}},init_old(a){var b=a.id,c=b.indexOf("contr");c=b.substring(0,c);b=b.split("contr")[1];const g=b.indexOf("Img");b=b.substring(0,g);"Assign"===b?(virtualclass.gObj.controlAssign=!0,virtualclass.gObj.controlAssignId=c,b="true"===
a.getAttribute("data-assign-disable"),b||(this.control.changeAttribute(c,a,b,"assign","aRole"),virtualclass.user.control.changeAttrToAssign("block")),roles.hasAdmin()||virtualclass.user.control.removeAudioFromParticipate(c)):"Chat"===b?("true"===a.getAttribute("data-chat-disable")?(a.className="contrChatBlock",b="enable",this.control.changeAttribute(c,a,!0,"chat","chat")):(b="block",this.control.changeAttribute(c,a,!1,"chat","chat")),this.control._chat(c,b)):"Aud"===b&&("true"===a.getAttribute("data-audio-disable")?
(b="enable",this.control.changeAttribute(c,a,!0,"audio","aud")):(b="block",this.control.changeAttribute(c,a,!1,"audio","aud")),this.control._audio(c,b))},chat(a,b){"enable"===b?virtualclass.settings.applySettings(!0,"studentpc",a):virtualclass.settings.applySettings(!1,"studentpc",a)},_audioAll(a,b){"enable"===b?virtualclass.vutil.beforeSend({ena:!0,toUser:a,cf:"ena"},a):virtualclass.vutil.beforeSend({dia:!0,toUser:a,cf:"dia"},a)},editorRich(a,b){"enable"===b?virtualclass.vutil.beforeSend({status:!0,
control:"editorRich",toUser:a,cf:"control"},a):virtualclass.vutil.beforeSend({status:!1,control:"editorRich",toUser:a,cf:"control"},a)},editorCode(a,b){"enable"===b?virtualclass.vutil.beforeSend({status:!0,control:"editorCode",toUser:a,cf:"control"},a):virtualclass.vutil.beforeSend({status:!1,control:"editorCode",toUser:a,cf:"control"},a)},audio(a,b){"enable"===b?virtualclass.settings.applySettings(!0,"studentaudio",a):virtualclass.settings.applySettings(!1,"studentaudio",a)},RaiseHand(a){virtualclass.raiseHand.raisehand(a)},
stdscreen(a){virtualclass.gObj.prvRequestScreenUser&&virtualclass.gObj.prvRequestScreenUser!==a&&virtualclass.config.makeWebSocketReady&&(ioAdapter.mustSendUser({cancel:!0,cf:"reqscreen"},virtualclass.gObj.prvRequestScreenUser),virtualclass.vutil.setScreenShareDefualtColor());const b=chatContainerEvent.elementFromShadowDom(`#ml${a} .icon-stdscreenImg`);null!==b&&(b.setAttribute("data-dcolor","blue"),b.parentNode.setAttribute("data-title",virtualclass.lang.getString("requestedScreenShare")));virtualclass.vutil.beforeSend({reqscreen:!0,
toUser:a,cf:"reqscreen"},a);virtualclass.gObj.prvRequestScreenUser=a;"Video"===virtualclass.currApp&&null!=virtualclass.videoUl&&(ioAdapter.mustSend({videoUl:{init:"destroyPlayer"},cf:"destroyPlayer"}),virtualclass.videoUl.destroyPlayer())},audioWidgetEnable(a){if(null==localStorage.getItem("dvid")){const d=b.getElementById("speakerPressOnce");if(null!==d){"undefined"===typeof a&&(d.className="active");if(!0===virtualclass.settings.specificUser&&roles.isStudent()){a=b.getElementById("speakerPressOnce");
const d=a.getElementsByClassName("congtooltip")[0];virtualclass.media.audio.studentSpeak();a.setAttribute("data-audio-playing","true");d.setAttribute("data-title",virtualclass.lang.getString("audioEnable"));a.className="audioTool active"}d.style.opacity="1";d.style.pointerEvents="visible"}}},mediaWidgetDisable(a){virtualclass.system.mediaDevices.hasWebcam=!1;a=localStorage.getItem("audEnable");null!=a&&JSON.parse(a);a=b.getElementById("audioWidget");a.style.opacity="1";a.style.pointerEvents="visible";
a.className="deactive";this.audioDisable();this.videoDisable();Object.prototype.hasOwnProperty.call(virtualclass.gObj,"video")&&(virtualclass.media.audio.studentNotSpeak(),virtualclass.media.audio.clickOnceSpeaker("speakerPressOnce","alwaysDisable"));virtualclass.vutil.addClass("virtualclassCont","nowebcam")},audioDisable(){const a=b.getElementById("speakerPressOnce");null!=a&&a.classList.contains("active")&&(a.classList.remove("active"),a.classList.add("deactive"));null!=a&&(a.style.opacity="0.5",
a.style.pointerEvents="none")},videoDisable(){const a=b.getElementById("congCtrBar");null!=a&&(a.style.opacity="0.5",a.style.pointerEvents="none")},videoEnable(){const a=b.getElementById("congCtrBar");null!=a&&(a.style.opacity="1",a.style.pointerEvents="visible")},disableCommonChat(){var a=b.getElementById("chatrm");null!=a&&(this.makeElemDisable(a),a.classList.add("chat_disable"));if(a=b.querySelector("#virtualclassCont.congrea #ta_chrm2"))a.classList.add("disable"),a.disabled=!0},disbaleAllChatBox(){b.querySelector("#chat_div").classList.add("chat_disabled");
const a=b.getElementById("stickybar").getElementsByClassName("ui-chatbox");for(let b=0;b<a.length;b++)this.makeElemDisable(a[b])},makeElemDisable(a){"chatrm"!==a.id&&(virtualclass.vutil.elemHasAnyClass(a.id)?(a.classList.remove("enable"),a.classList.add("disable")):a.className="disable");a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!0)},allChatEnable(a){if("pc"===a){b.querySelector("#chat_div").classList.remove("chat_disabled");a=b.getElementById("stickybar").getElementsByClassName("ui-chatbox");
for(var c=0;c<a.length;c++)this.makeElemEnable(a[c])}else"gc"===a&&(a=b.getElementById("chatrm"),null!=a&&a.classList.remove("chat_disable"),a=b.querySelector("#virtualclassCont.congrea #ta_chrm2"))&&(a.classList.remove("disable"),a.disabled=!1);a=b.querySelector("#virtualclassCont #chatrm.enable");c=b.querySelector("#chatroom_bt2");a&&(c.classList.contains("active")||c.classList.add("active"),virtualclass.chat.chatWindow="common")},resetmediaSetting(){if(roles.isStudent())virtualclass.settings.userAudioIcon(),
virtualclass.system.mediaDevices.hasWebcam&&virtualclass.settings.userVideoIcon();else{var a=b.getElementById("contrAudioAllImg");a&&a.classList.contains("icon-all-audio-enable")&&(a.classList.remove("icon-all-audio-enable"),a.classList.add("icon-all-audio-disable"),a.setAttribute("data-title",virtualclass.lang.getString("muteAll")),"enable"===a.dataset.action&&(a.dataset.action="disable"));a=b.getElementById("videoSwitch");if(null!=a&&virtualclass.system.mediaDevices.hasWebcam&&a.classList.contains("video")){const c=
b.getElementById("rightCtlr");a.classList.contains("on")&&(virtualclass.vutil.videoHandler("off"),c.parentNode.setAttribute("data-title",virtualclass.lang.getString("videoon")))}this.mediaSliderSetting("audio");this.mediaSliderSetting("video")}roles.hasAdmin()&&(virtualclass.gObj.delayVid="display")},mediaSliderSetting(a){const c="audio"===a?"Audio":"Video";var f=virtualclass.gObj.stdaudioEnable,g=virtualclass.gObj.stdvideoEnable;f={action:("audio"===a?f:g)?"enable":"disable",enable:"disable",disable:"enable"};
if(g=b.querySelector(`.congrea #contr${c}All.${f.action}`))g.classList.remove(f.action),g.classList.add(f[f.action]),(g=b.querySelector(`.congrea #contr${c}All input`))&&g.removeAttribute("checked");if(g=b.querySelector(`.congrea .slider.icon-all-${a}-${f.action}`))g.className=`slider round congtooltip icon-all-${a}-${f[f.action]}`,g.setAttribute("data-action",f[f.action]),a=virtualclass.lang.getString(`${f[f.action]}All${c}`),g.setAttribute("data-title",a)},makeElemEnable(a){virtualclass.vutil.elemHasAnyClass(a.id)?
(a.classList.remove("disable"),a.classList.add("enable")):a.className="enable";a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!1)},toggleAllEditorController(a,b){a=virtualclass.vutil.smallizeFirstLetter(a);const c=chatContainerEvent.elementFromShadowDom(".controleCont","all");if(0<c.length)for(let f=0;f<c.length;f++)if(0<c[f].id.indexOf(a)){var d=c[f].id.indexOf("Cont");0<d&&(d=c[f].id.substr(0,d),d=chatContainerEvent.elementFromShadowDom(`${d}Img`,null,!0),this.control.init.call(this,
d,b,void 0,"actnotSend"))}"enable"===b?virtualclass.vutil.beforeSend({status:!0,control:"editorRich",cf:"control"}):virtualclass.vutil.beforeSend({status:!1,control:"editorRich",cf:"control"})},toggleDisplayEditorController(a,b){a=virtualclass.vutil.smallizeFirstLetter(a);if(Object.prototype.hasOwnProperty.call(virtualclass.gObj,"testChatDiv")){a=chatContainerEvent.elementFromShadowDom(`.controller${a}`,"all");for(let c=0;c<a.length;c++)a[c].style.display=b}},updateUser(a,b,c){const d=localStorage.getItem(`virtualclass${a}`);
let f={};null==d?f.id=a:f=JSON.parse(d);f[b]=c;localStorage[`virtualclass${f.id}`]=JSON.stringify(f);return f},audioSign2(a,d){if("create"===d){if(null==b.getElementById(`${a.id}AudEnableSign`)){d=b.createElement("div");d.id=`${a.id}AudEnableSign`;const f=b.createElement("img");f.id=`${a.id+"audioenable"}Img`;f.src=`${c.whiteboardPath}images/${"audioenable"}.png`;const g=b.createElement("a");g.id=`${a.id+"audioenable"}Anch`;g.className="audEnableSign tooltip controleCont";g.setAttribute("data-title",
virtualclass.lang.getString("studentAudEnable"));g.appendChild(f);d.appendChild(g);b.getElementById(`${a.id}ControlContainer`).appendChild(d)}}else a=b.getElementById(`${a.id}AudEnableSign`),a.parentNode.removeChild(a)},audioSign(a,b){"create"===b?this.iconAttrManupulate(a.id,"icon-audioEnaGreen"):a.aud?this.iconAttrManupulate(a.id,"icon-audioImg"):this.iconAttrManupulate(a.id,"icon-audioDisImg")},iconAttrManupulate(a,b){a=virtualclass.gObj.testChatDiv.shadowRoot.querySelector(`#ml${a} .audioImg`);
if(null!=a)for(let c=0;c<a.classList.length;c++)if("icon-"===a.classList[c].substring(0,5)){a.classList.remove(a.classList[c]);a.classList.add(b);break}},shouldApply(a){let b=localStorage.getItem(`virtualclass${a}`);null!=b&&(b=JSON.parse(b),b.ad&&virtualclass.user.control.audioSign({id:a},"create"))},changeAttrToAssign(a){const c=b.getElementById("chatWidget").getElementsByClassName("assignImg");for(let b=0;b<c.length;b++)"enable"===a?(c[b].classList.remove("block"),c[b].classList.add("enable"),
c[b].parentNode.classList.add("tooltip"),c[b].parentNode.setAttribute("data-title",virtualclass.lang.getString("transferControls")),c[b].setAttribute("data-assign-disable","false")):(c[b].classList.remove("enable"),c[b].classList.add("block"),c[b].parentNode.classList.remove("tooltip"),c[b].setAttribute("data-assign-disable","true"))}},displayStudentSpeaker(a){const c=b.getElementById("alwaysPress");null!=c&&(c.style.display=a?"block":"none")},toggleAllUserListIcon(a,b){b="audio"===b?"Aud":"Chat";
const c=chatContainerEvent.elementFromShadowDom(".controleCont","all");if(0<c.length)for(let f=0;f<c.length;f++)if(0<c[f].id.indexOf(b)){var d=c[f].id.indexOf("Cont");0<d&&(d=c[f].id.substr(0,d),d=chatContainerEvent.elementFromShadowDom(`${d}Img`,null,!0),this.control.init.call(this,d,a,void 0,"actnotSend"))}},toggleAllVideo(a){ioAdapter.mustSend({action:a,cf:"toggleVideo"})},mediaSliderUI(a){const c=virtualclass.vutil.capitalizeFirstLetter(a);let f=b.querySelector(`.bulkUserActions #contr${c}AllImg`);
if("chat"===a)var g="pc";else if("groupChat"===a)g="gc";else if("audio"===a||"video"===a)g=a;var k="askQuestion"===a||"userlist"===a||"qaMarkNotes"===a?virtualclass.settings.info[a]:virtualclass.settings.info[`student${g}`];g=b.querySelector(`.bulkUserActions #contr${c}All input`);const m=b.querySelector(`.congrea #contr${c}All`),n=!0===k?"disable":"enable";null!==k?(f.setAttribute("data-action",n),f.className=`slider round icon-all-${a}-${n} enable congtooltip cgIcon`,f.dataset.title=virtualclass.lang.getString(`${n}All${c}`),
g.setAttribute("checked","true"),m.classList.add(n)):(k={action:k?"enable":"disable",enable:"disable",disable:"enable"},f=b.querySelector(`.bulkUserActions #contr${c}AllImg`),f.setAttribute("data-action",k[k.action]),f.className=`slider round icon-all-${a}-${k[k.action]} congtooltip cgIcon`,f.dataset.title=virtualclass.lang.getString(`${k[k.action]}All${c}`),g.removeAttribute("checked"),m.classList.add(k[k.action]));if(!virtualclass.isPlayMode){const b=this;f.addEventListener("click",()=>{const c=
b.toogleIcon(a),d="enable"===c;let f;"chat"===a?f="pc":"groupChat"===a?f="gc":"askQuestion"===a||"userlist"===a||"qaMarkNotes"===a?virtualclass.settings.applySettings(d,a):f=a;"raisehand"===a&&"userlist"===a||virtualclass.settings.applySettings(d,`student${f}`);"undefined"===typeof c||"audio"!==a&&"chat"!==a||b.toggleAllUserListIcon.call(virtualclass.user,c,a)})}},chatBoxesSwitch(){if(virtualclass.chat.chatroombox)toggleCommonChatBox();else if(0===$("div#chat_room").length){var a=b.createElement("ul");
a.id="chat_room";b.body.appendChild(a);virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:{name:"test"},title:virtualclass.lang.getString("chatroom_header"),offset:"20px",messageSent(a,b){$("#chat_room").chatroom("option","boxManager").addMsg(a.name,b)}});Object.prototype.hasOwnProperty.call(virtualclass.gObj,"chatEnable")&&!virtualclass.gObj.chatEnable&&(a=b.getElementById("chatrm"),null!=a&&virtualclass.user.control.makeElemDisable(a));a=b.getElementById("cc_arrow_button");
a.classList.add("icon-arrow-down");a.classList.remove("icon-arrow-up")}},toogleIcon(a){const c=virtualclass.vutil.capitalizeFirstLetter(a),f=b.querySelector(`.bulkUserActions #contr${c}AllImg`);if(null!=f){const d=f.dataset.action;"enable"===f.dataset.action?(f.dataset.action="disable",f.className=`slider round icon-all-${a}-disable congtooltip`,f.dataset.title=virtualclass.lang.getString(`disableAll${c}`),a=b.querySelector(`.congrea .bulkUserActions #contr${c}All`),a.classList.add("disable"),a.classList.remove("enable")):
(f.dataset.action="enable",f.className=`slider round icon-all-${a}-enable congtooltip`,f.dataset.title=virtualclass.lang.getString(`enableAll${c}`),a=b.querySelector(`.congrea .bulkUserActions #contr${c}All`),a.classList.add("enable"),a.classList.remove("disable"));return d}},changeRoleOnFooter(a,b){chatContainerEvent.elementFromShadowDom(`#ml${a}`).dataset.role=b},initControlHandler(a){const c=chatContainerEvent.elementFromShadowDom(`#ml${a} .contImg`,"all");let f=!1,g=localStorage.getItem(`virtualclass${a}`);
null!=g&&(f=!0,g=JSON.parse(g),Object.prototype.hasOwnProperty.call(g,"currTeacher")&&(virtualclass.gObj[`${a}currTeacher`]={},!0===g.currTeacher?(virtualclass.user.control.currTeacherAlready=!0,virtualclass.gObj[`${a}currTeacher`].ct=!0):virtualclass.gObj[`${a}currTeacher`].ct=!1));for(let d=0;d<c.length;d++)if(-1<c[d].className.indexOf("chat")){var k=f&&Object.prototype.hasOwnProperty.call(g,"chat")?Object.prototype.hasOwnProperty.call(virtualclass.settings.user,a)?virtualclass.settings.parseSettings(virtualclass.settings.user[a]).studentpc:
virtualclass.settings.info.studentpc:virtualclass.settings.info.studentpc;virtualclass.user.control.changeAttribute(a,c[d],k,"chat","chat")}else-1<c[d].className.indexOf("aud")?(f&&Object.prototype.hasOwnProperty.call(g,"aud")?k=Object.prototype.hasOwnProperty.call(virtualclass.settings.user,a)?virtualclass.settings.parseSettings(virtualclass.settings.user[a]).studentaudio:virtualclass.settings.info.studentaudio:(k=b.querySelector("#contrAudioAll"),null!=virtualclass.jId&&k.classList.contains("disable"),
k=virtualclass.settings.info.studentaudio),virtualclass.user.control.changeAttribute(a,c[d],k,"audio","aud"),roles.hasAdmin()&&"false"===c[d].dataset.audioDisable&&localStorage.getItem("allAudioAction")):-1<c[d].className.indexOf("RaiseHand")?(k=f&&Object.prototype.hasOwnProperty.call(g,"raiseHand")?!!g.raiseHand:!1,virtualclass.user.control.changeAttribute(a,c[d],k,"RaiseHand","RaiseHand")):-1<c[d].className.indexOf("stdscreen")?Object.prototype.hasOwnProperty.call(virtualclass.gObj.studentSSstatus,
"whoIsSharing")&&virtualclass.vutil.initssSharing(virtualclass.gObj.whoIsSharing):-1<c[d].className.indexOf("editorRich")&&"EditorRich"===virtualclass.currApp?(k=f&&Object.prototype.hasOwnProperty.call(g,"editorRich")?!!g.editorRich:!1,virtualclass.user.control.changeAttribute(a,c[d],k,"editorRich","editorRich")):-1<c[d].className.indexOf("editorCode")&&(k=f&&Object.prototype.hasOwnProperty.call(g,"editorCode")?!!g.editorCode:!1,virtualclass.user.control.changeAttribute(a,c[d],k,"editorCode","editorCode"))}}}})(window,
document);(function(c){c.xhr={init(){this.vxhr=axios.create({timeout:1E4,withCredentials:!0,headers:{"Content-Type":"application/json",post:{"Content-Type":"application/json"},get:{"Content-Type":"application/json"}},onUploadProgress:b=>{virtualclass.xhr.onProgress(b)}})},onProgress(b){virtualclass.pbar.currVal=b.loaded;""!==virtualclass.pbar.prvVal&&"undefined"!==typeof virtualclass.pbar.prvVal||virtualclass.isPlayMode||virtualclass.pbar.progressInit();virtualclass.pbar.renderProgressBar(b.total,b.loaded,
"indProgressBar","indProgressValue")}}})(window);(function(c){c.xhrn={init(){this.vxhrn=axios.create({timeout:1E4,headers:{"Content-Type":"application/json","x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room,post:{"Content-Type":"application/json"},get:{"Content-Type":"application/json"}}})},getAccess(){this.vxhrn.get(virtualclass.api.access,{withCredentials:!0}).then(()=>{virtualclass.gObj.readyToCommunicate=!0}).catch(b=>{console.error("Request failed with error ",b);
setTimeout(()=>{virtualclass.xhrn.getAccess()},1E3)})},async getAskQnAccess(){const b=await this.vxhrn.get(virtualclass.api.askQnsAccess);return b.data?b:!1}}})(window);const PopUp=function(c,b){function a(a){this.init(a);return this}function d(a,b){const c={};let d;for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(c[d]=b[d]);return c}function f(a){const b=document.createElement("div");b.classList.add("rv-vanilla-modal-overlay");document.querySelector("body").appendChild(b);"function"===typeof a&&a()}let g=!1;"use strict";a.prototype.init=function(a){const b=this;this.settings=d({selector:"[data-rv-vanilla-modal]",
modalSelector:".rv-vanilla-modal",closeSelector:".rv-vanilla-modal-close",showModalClassName:"rv-vanilla-modal-is-open",showOverlay:!0},a);this.modalElements=document.querySelectorAll(this.settings.modalSelector);this.triggers=document.querySelectorAll(this.settings.selector);this.settings.showOverlay&&f(()=>{b.overlayElement=document.querySelector(".rv-vanilla-modal-overlay")})};a.prototype.close=function(a){a.classList.remove(this.settings.showModalClassName);document.getElementById("popupContainer").style.display=
"none";this.settings.showOverlay&&this.overlayElement.classList.remove("is-shown")};a.prototype.open=function(a){document.getElementById("popupContainer").style.display="block";this.sendBackOtherElems();this.closeShownModal();a.classList.add(this.settings.showModalClassName);this.settings.showOverlay&&this.overlayElement.classList.add("is-shown")};a.prototype.each=function(a){[].forEach.call(this.triggers,b=>{"function"===typeof a&&a(b)})};a.prototype.closeShownModal=function(){const {showModalClassName:a}=
this.settings;[].forEach.call(this.modalElements,b=>{b.classList.contains(a)&&b.classList.remove(a)})};a.prototype.closeElem=function(){document.getElementById("popupContainer").classList.remove("playPopup","loading");if(!1===virtualclass.recorder.waitServer){var a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.zIndex=100);a=document.getElementById("stickybar");null!=a&&(a.style.zIndex=1E3);a=document.getElementById("commandToolsWrapper");null!=a&&(a.style.pointerEvents="visible");
a=document.getElementById("about-modal");null!=a&&virtualclass.popup.close(a);document.getElementById("sessionEndMsgCont").dataset.displaying="false";document.getElementById("uploadvideourl").dataset.displaying="false";document.getElementById("uploadppturl").dataset.displaying="false";a=document.getElementById("chatrm");null!=a&&(a.style.zIndex=1);console.log("====> Removing connecting class");a=document.querySelector("#virtualclassCont");document.querySelector("#networkStatusContainer").classList.remove("connecting-room");
a.classList.remove("connecting");document.querySelector("#virtualclassApp").classList.remove("try-to-connect");roles.hasControls()?virtualclass.userInteractivity.triggerInitFirebaseOperation():null!=localStorage.getItem("mySession")&&(document.getElementById("virtualclassCont").classList.add("readyForNote"),virtualclass.userInteractivity.triggerInitFirebaseOperation());a=document.getElementById("startLiveStream");null!=a&&a.classList.remove("disabled")}};a.prototype.waitBlock=function(){const a=document.getElementById("about-modal");
virtualclass.popup.open(a);this.hideAllPopups();document.getElementById("recordPlay").style.display="block";virtualclass.popup.replayWindowAction("none")};a.prototype.waitBlockAction=function(a){document.getElementById("recordPlay").style.display=a};a.prototype.sendBackOtherElems=function(a){a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.zIndex=0);a=document.getElementById("commandToolsWrapper");null!=a&&(a.style.pointerEvents="none");a=document.getElementById("stickybar");
null!=a&&(a.style.zIndex=0);a=document.getElementById("chatrm");null==a||virtualclass.isPlayMode||(a.style.zIndex=0);a=document.getElementById("audioWidget");null!=a&&(a.style.zIndex=0);a=document.getElementById("memlist");null!=a&&(a.style.zIndex=0)};a.prototype.openProgressBar=function(a){a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();document.getElementById("recordingContainer").style.display="block"};a.prototype.replayWindow=function(){const a=document.getElementById("about-modal");
virtualclass.popup.open(a);this.hideAllPopups();virtualclass.popup.replayWindowAction("block")};a.prototype.sesseionEndWindow=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();a=document.getElementById("sessionEndMsgCont");a.style.display="block";a.dataset.displaying=!0;document.getElementById("sessionEndClose").addEventListener("click",()=>{virtualclass.popup.closeElem();c.close()})};a.prototype.validateurlPopup=function(a){const b=document.getElementById("about-modal");
virtualclass.popup.open(b);this.hideAllPopups();let c,d;"video"===a?(c=document.querySelector("#virtualclassCont.congrea #popupContainer #uploadvideourl"),d=document.querySelector("#virtualclassCont.congrea #popupContainer #vidPopupClose")):"presentation"===a&&(c=document.querySelector("#virtualclassCont.congrea #popupContainer #uploadppturl"),d=document.querySelector("#virtualclassCont.congrea #popupContainer #pptPopupClose"));c.style.display="block";c.dataset.displaying=!0;d.addEventListener("click",
()=>{virtualclass.popup.closeElem()})};a.prototype.replayWindowAction=function(a){document.getElementById("replayContainer").style.display=a};a.prototype.progressBarAction=function(a){document.getElementById("recordingContainer").style.display=a};a.prototype.confirmInput=function(a,b,c,d,f,g){var k=document.getElementById("about-modal");virtualclass.popup.open(k);this.hideAllPopups();k=document.getElementById("confirm");k.style.display="block";var m=k.getElementsByClassName("confirmChild");if(0<m.length)for(;1<=
m.length;)m[0].parentNode.removeChild(m[0]);m=document.createElement("div");m.id="confirmMessage";m.className="confirmChild";m.innerHTML=a;k.appendChild(m);const n=this;a=function(){n.confirmInit(this.id,b,c,d,f,g)};m=document.createElement("div");m.id="confirmOk";m.className="confirmButton confirmChild";m.addEventListener("click",a);const r=document.createElement("button");r.id="confirmOkButton";r.className="icon-check";r.innerHTML=virtualclass.lang.getString("confirmOk");m.appendChild(r);k.appendChild(m);
m=document.createElement("div");m.id="confirmCancel";m.className="confirmButton confirmChild";m.addEventListener("click",a);a=document.createElement("button");a.id="confirmCancelButton";a.className="icon-close";a.innerHTML=virtualclass.lang.getString("confirmCancel");m.appendChild(a);k.appendChild(m)};a.prototype.pollPopUp=function(a,b){var c=document.getElementById("about-modal");virtualclass.popup.open(c);this.hideAllPopups();c=document.getElementById("editPollCont");c.style.display="block";const d=
this,f=function(){d.action(this.id,a,b)};if(null==document.getElementById("pollCancel")){const a=document.createElement("div");a.id="pollCancel";a.className="cancelBtn";a.addEventListener("click",f);const b=document.createElement("button");b.id="confirmCancelButton";b.className="icon-close";b.innerHTML=virtualclass.lang.getString("pollCancel");a.appendChild(b);c.appendChild(a)}document.getElementById("resetPoll").addEventListener("click",f);document.getElementById("addMoreOption").addEventListener("click",
f);document.getElementById("etSave").addEventListener("click",f);document.getElementById("saveNpublish").addEventListener("click",f)};a.prototype.action=function(a,b,c,d,f,g){b(a)};a.prototype.confirmInit=function(a,b,c,d,f,g){virtualclass.popup.closeElem();a="confirmOk"===a?virtualclass.popup.confirmOk():virtualclass.popup.confirmCancel();b(a,c,d,f,g)};a.prototype.confirmCancel=function(){return!1};a.prototype.confirmOk=function(){return!0};a.prototype.waitMsg=function(a){let b=0;"undefined"!==typeof a?
b=1300:document.getElementById("virtualclassCont").classList.add("withoutRefresh");setTimeout(()=>{virtualclass.network.netWorkElementIsReady()},b);"undefined"!==typeof virtualclass.vutil&&virtualclass.vutil.sesionEndMsgBoxIsExisting()||this.hideAllPopups()};a.prototype.chromeExtMissing=function(){const a=document.getElementById("about-modal");a.dataset.currPopup="chromeExt";virtualclass.popup.open(a);this.hideAllPopups();document.getElementById("chromeExtMiss").style.display="block";roles.isStudent()&&
virtualclass.gObj.studentSSstatus.mesharing&&(virtualclass.gObj.studentSSstatus.mesharing=!1);document.getElementById("chromeExtClose").addEventListener("click",()=>{virtualclass.popup.closeElem();a.dataset.currPopup=""})};a.prototype.generalMsg=function(a){const b=document.getElementById("about-modal");virtualclass.popup.open(b);this.hideAllPopups();document.getElementById("generalMessage").style.display="block";document.querySelector("#generalMessageMsg").innerHTML=a;document.getElementById("generalMessageClose").addEventListener("click",
()=>{virtualclass.popup.closeElem()})};let k=function(a){virtualclass.popup.closeElem();a&&a()};a.prototype.infoMsg=function(a,b){const d=document.getElementById("about-modal");virtualclass.popup.open(d);this.hideAllPopups();document.getElementById("infoMessage").style.display="block";document.querySelector("#infoMessageMsg").innerHTML=a;document.getElementById("infoMessageOk").innerHTML="ok";a=document.getElementById("infoMessageOk");g&&a.removeEventListener("click",g,!0);g=k.bind(c,b);a.addEventListener("click",
g,!0)};a.prototype.generalMsgButton=function(a){a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();a=document.querySelector("#generalMessageButton");null!=a&&(a.style.display="block;",document.querySelector("#generalMessageButton .button").addEventListener("click",()=>{virtualclass.popup.closeElem()}))};a.prototype.hideAllPopups=function(){const a=document.getElementsByClassName("popupWindow");for(let b=0;b<a.length;b++)a[b].style.display="none"};a.prototype.closePopup=
function(){virtualclass.popup.closeElem();"true"===document.getElementById("sessionEndMsgCont").dataset.displaying&&this.sesseionEndWindow()};a.prototype.loadingWindow=function(){const a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();const b=document.querySelector("#loadingWindowCont");null!=b&&(b.style.display="block",a.parentNode.classList.add("loading"))};return a}(window);(function(c){c.converter=function(){function b(a){return 26>a?a+65:52>a?a+71:62>a?a-4:62===a?43:63===a?47:65}return{base64EncArrInt(a){const b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=0>a[c]?-1*a[c]+127:a[c];return this.base64EncArr(b)},base64EncArr(a){let c=2,f="";for(let d=a.length,k=0,m=0;m<d;m++)if(c=m%3,0<m&&0===4*m/3%76&&(f+="\r\n"),k|=a[m]<<(16>>>c&24),2===c||1===a.length-m)f+=String.fromCharCode(b(k>>>18&63),b(k>>>12&63),b(k>>>6&63),b(k&63)),k=0;return f.substr(0,f.length-
2+c)+(2===c?"":1===c?"=":"==")},base64DecToArrInt(a){a=base64DecToArr(a);const b=new Int8Array(a.length);for(let c=0;c<a.length;c++)b[c]=128<=a[c]?-1*(a[c]-127):a[c];return b},base64DecToArr(a,b){a=a.replace(/[^A-Za-z0-9\+\/]/g,"");const c=a.length;b=b?Math.ceil((3*c+1>>2)/b)*b:3*c+1>>2;const d=new Uint8Array(b);for(var k,m=0,n=0,r=0;r<c;r++){k=r&3;var t=a.charCodeAt(r);m|=(64<t&&91>t?t-65:96<t&&123>t?t-71:47<t&&58>t?t+4:43===t?62:47===t?63:0)<<6*(3-k);if(3===k||1===c-r){for(k=0;3>k&&n<b;k++,n++)d[n]=
m>>>(16>>>k&24)&255;m=0}}return d},base64DecToArrclm(a){a=base64DecToArr(a);return new Uint8ClampedArray(a.buffer)}}}})(window);let prvTimeout;
const progressBar={prvVal:"",currVal:"",progressInit(){const c=this;"undefined"!==typeof prvTimeout&&clearTimeout(prvTimeout);prvTimeout=setTimeout(()=>{c.prvVal===c.currVal&&Object.prototype.hasOwnProperty.call(virtualclass.gObj,"downloadProgress")?virtualclass.recorder.initMakeAvailDownloadFile():(c.prvVal=c.currVal,c.progressInit())},5E4)},renderProgressBar(c,b,a,d){b>c&&(b=c,document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"));c=0===c&&0===b?0:Math.round(100*
b/c);a=document.getElementById(a);null!=a&&(a.style.width=`${c}%`);100<=d&&(d=document.getElementById("recordingClose"),recordingClose.style.display="block",d.addEventListener("click",()=>{virtualclass.popup.closeElem()}))}};const Server=function(c){function b(a,b){this.document=a;this.operations=b||[]}b.prototype.receiveOperation=function(a,b){if(0>a||this.operations.length<a)return!1;a=this.operations.slice(a);const {transform:c}=b.constructor;for(let d=0;d<a.length;d++)b=c(b,a[d])[0];this.document=b.apply(this.document);this.operations.push(b);return b};return b}(this);"object"===typeof module&&(module.exports=ot.Server);(function(c){const b={makeEventEmitter:function(a,b){a.prototype.allowedEvents_=b;a.prototype.on=function(a,b,c){this.validateEventType_(a);this.eventListeners_=this.eventListeners_||{};this.eventListeners_[a]=this.eventListeners_[a]||[];this.eventListeners_[a].push({callback:b,context:c})};a.prototype.off=function(a,b){this.validateEventType_(a);this.eventListeners_=this.eventListeners_||{};a=this.eventListeners_[a]||[];for(let c=0;c<a.length;c++)if(a[c].callback===b){a.splice(c,1);break}};a.prototype.trigger=
function(a){this.eventListeners_=this.eventListeners_||{};const b=this.eventListeners_[a]||[];for(let a=0;a<b.length;a++)b[a].callback.apply(b[a].context,Array.prototype.slice.call(arguments,1))};a.prototype.validateEventType_=function(a){if(this.allowedEvents_){let b=!1;for(let c=0;c<this.allowedEvents_.length;c++)if(this.allowedEvents_[c]===a){b=!0;break}if(!b)throw Error(`Unknown event "${a}"`);}}},elt:function(a,c,f){a=document.createElement(a);if("string"===typeof c)b.setTextContent(a,c);else if(c)for(let b=
0;b<c.length;++b)a.appendChild(c[b]);for(const b in f||{})a.setAttribute(b,f[b]);return a},setTextContent:function(a,b){a.innerHTML="";a.appendChild(document.createTextNode(b))},on:function(a,b,c,g){a.addEventListener?a.addEventListener(b,c,g||!1):a.attachEvent&&a.attachEvent(`on${b}`,c)},off:function(a,b,c,g){a.removeEventListener?a.removeEventListener(b,c,g||!1):a.detachEvent&&a.detachEvent(`on${b}`,c)},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(a){a.stopPropagation?
a.stopPropagation():a.cancelBubble=!0},stopEvent:function(a){b.preventDefault(a);b.stopPropagation(a)},stopEventAnd:function(a){return function(c){a(c);b.stopEvent(c);return!1}},trim:function(a){return a.replace(/^\s+/g,"").replace(/\s+$/g,"")},stringEndsWith:function(a,b){const c="string"===typeof b?[b]:b;for(let d=0;d<c.length;d++)if(b=c[d],-1!==a.indexOf(b,a.length-b.length))return!0;return!1},assert:function(a,b){if(!a)throw Error(b||"assertion error");},log:function(){if("undefined"!==typeof console&&
"undefined"!==typeof console.log){const a=["Vceditor:"];for(let b=0;b<arguments.length;b++)a.push(arguments[b]);console.log.apply(console,a)}}};c.utils=b})(window);(function(c){const b=function(a){function b(a){this.imageInsertionUI=a;this.element_=this.makeElement_()}const {utils:f}=c;f.makeEventEmitter(b,"bold italic underline strike font font-size color left center right unordered-list ordered-list todo-list indent-increase indent-decrease undo redo insert-image".split(" "));b.prototype.element=function(){return this.element_};b.prototype.makeButton_=function(a,b){const c=this;b=f.elt("a",[f.elt("span","",{class:`vceditor-tb-${b||a}`})],{class:"vceditor-btn"});
f.on(b,"click",f.stopEventAnd(()=>{c.trigger(a)}));return b};b.prototype.makeElement_=function(){var a=this.makeFontDropdown_(),b=this.makeFontSizeDropdown_(),c=this.makeColorDropdown_();a=[f.elt("div",[a],{class:"vceditor-btn-group close editor-font"}),f.elt("div",[b],{class:"vceditor-btn-group close"}),f.elt("div",[c],{class:"vceditor-btn-group close"})];b=f.elt("div",null,{class:"vceditor-btn-style-group close"});c=f.elt("div",[this.makeButton_("bold"),this.makeButton_("italic"),this.makeButton_("underline"),
this.makeButton_("strike","strikethrough")],{class:"vceditor-btn-group style-group"});b.appendChild(c);a.push(b);b=f.elt("div",null,{class:"vceditor-btn-list-group close"});c=f.elt("div",[this.makeButton_("unordered-list","list-2"),this.makeButton_("ordered-list","numbered-list"),this.makeButton_("todo-list","list")],{class:"vceditor-btn-group list-group"});b.appendChild(c);a.push(b);b=f.elt("div",null,{class:"vceditor-btn-indent-group close"});c=f.elt("div",[this.makeButton_("indent-decrease"),this.makeButton_("indent-increase")],
{class:"vceditor-btn-group indent-group"});b.appendChild(c);a.push(b);b=f.elt("div",null,{class:"vceditor-btn-paragraph-group close"});c=f.elt("div",[this.makeButton_("left","paragraph-left"),this.makeButton_("center","paragraph-center"),this.makeButton_("right","paragraph-right")],{class:"vceditor-btn-group paragraph-group"});b.appendChild(c);a.push(b);b=f.elt("div",[this.makeButton_("undo"),this.makeButton_("redo")],{class:"vceditor-btn-group undo-group"});a.push(b);this.imageInsertionUI&&a.push(f.elt("div",
[this.makeButton_("insert-image")],{class:"vceditor-btn-group vceditor-btn-image"}));a=f.elt("div",a,{class:"vceditor-toolbar-wrapper"});b=f.elt("div",null,{class:"vceditor-toolbar"});b.appendChild(a);return b};b.prototype.makeFontDropdown_=function(){const a="Arial;Comic Sans MS;Courier New;Impact;Times New Roman;Verdana".split(";"),b=[];for(let c=0;c<a.length;c++){const d=f.elt("span",a[c]);d.setAttribute("style",`font-family:${a[c]}`);b.push({content:d,value:a[c]})}return this.makeDropdown_("Font",
"font",b)};b.prototype.makeFontSizeDropdown_=function(){const a=[9,10,12,14,18,24,32,42],b=[];for(let c=0;c<a.length;c++){const d=f.elt("span",a[c].toString());d.setAttribute("style",`font-size:${a[c]}px; line-height:${a[c]-6}px;`);b.push({content:d,value:a[c]})}return this.makeDropdown_("Size","font-size",b,"px")};b.prototype.makeColorDropdown_=function(){const a="black red green blue yellow cyan magenta grey".split(" "),b=[];for(let c=0;c<a.length;c++){const d=f.elt("div");d.className="vceditor-color-dropdown-item";
d.setAttribute("style",`background-color:${a[c]}`);b.push({content:d,value:a[c]})}return this.makeDropdown_("Color","color",b)};b.prototype.makeDropdown_=function(a,b,c,d){function g(){const a=p.parentNode.parentNode;q?(a.classList.remove("open"),a.classList.add("close")):(a.classList.remove("close"),a.classList.add("open"))}function k(){q&&(g(),f.off(document,"click",k,!0),q=!1);A=!0;setTimeout(()=>{A=!1},0)}function m(a,c){"object"!==typeof a&&(a=document.createTextNode(String(a)));a=f.elt("a",
[a]);f.on(a,"click",f.stopEventAnd(()=>{k();n.trigger(b,c+d)}));p.appendChild(a)}d=d||"";const n=this;var u=virtualclass.vutil.smallizeFirstLetter(a);a="Font"===a?f.elt("a",`${a} \u25be`,{class:"vceditor-btn vceditor-dropdown"}):f.elt("a",null,{class:`vceditor-btn vceditor-dropdown ${u}`});const p=f.elt("ul",[],{class:`vceditor-dropdown-menu ${u}-menu`});a.appendChild(p);let q=!1,A=!1;for(u=0;u<c.length;u++){const {content:a}=c[u],{value:b}=c[u];m(a,b)}f.on(a,"click",f.stopEventAnd(()=>{A||q||(g(),
f.on(document,"click",k,!0),q=!0)}));return a};return b}();c.RichTextToolbar=b})(window);(function(c){const b=function(){function a(a,c,d){this.type=a;this.attributes=this.text=this.chars=null;"insert"===a?(this.text=c,b.assert("string"===typeof this.text),this.attributes=d||{},b.assert("object"===typeof this.attributes)):"delete"===a?(this.chars=c,b.assert("number"===typeof this.chars)):"retain"===a&&(this.chars=c,b.assert("number"===typeof this.chars),this.attributes=d||{},b.assert("object"===typeof this.attributes))}const {utils:b}=c;a.prototype.isInsert=function(){return"insert"===
this.type};a.prototype.isDelete=function(){return"delete"===this.type};a.prototype.isRetain=function(){return"retain"===this.type};a.prototype.equals=function(a){return this.type===a.type&&this.text===a.text&&this.chars===a.chars&&this.attributesEqual(a.attributes)};a.prototype.attributesEqual=function(a){for(var b in this.attributes)if(this.attributes[b]!==a[b])return!1;for(b in a)if(this.attributes[b]!==a[b])return!1;return!0};a.prototype.hasEmptyAttributes=function(){let a=!0;for(const b in this.attributes){a=
!1;break}return a};return a}();c.TextOp=b})(window);(function(c){const b=function(){function a(){if(!this||this.constructor!==a)return new a;this.ops=[];this.targetLength=this.baseLength=0}function b(a){({ops:a}=a);switch(a.length){case 1:return a[0];case 2:return a[0].isRetain()?a[1]:a[1].isRetain()?a[0]:null;case 3:if(a[0].isRetain()&&a[2].isRetain())return a[1]}return null}function f(a){return a.ops[0].isRetain()?a.ops[0].chars:0}const {TextOp:g}=c,{utils:k}=c;a.prototype.equals=function(a){if(this.baseLength!==a.baseLength||this.targetLength!==
a.targetLength||this.ops.length!==a.ops.length)return!1;for(let b=0;b<this.ops.length;b++)if(!this.ops[b].equals(a.ops[b]))return!1;return!0};a.prototype.retain=function(a,b){if("number"!==typeof a||0>a)throw Error("retain expects a positive integer.");if(0===a)return this;this.baseLength+=a;this.targetLength+=a;b=b||{};const c=0<this.ops.length?this.ops[this.ops.length-1]:null;c&&c.isRetain()&&c.attributesEqual(b)?c.chars+=a:this.ops.push(new g("retain",a,b));return this};a.prototype.insert=function(a,
b){if("string"!==typeof a)throw Error("insert expects a string");if(""===a)return this;b=b||{};this.targetLength+=a.length;const c=0<this.ops.length?this.ops[this.ops.length-1]:null,d=1<this.ops.length?this.ops[this.ops.length-2]:null;c&&c.isInsert()&&c.attributesEqual(b)?c.text+=a:c&&c.isDelete()?d&&d.isInsert()&&d.attributesEqual(b)?d.text+=a:(this.ops[this.ops.length-1]=new g("insert",a,b),this.ops.push(c)):this.ops.push(new g("insert",a,b));return this};a.prototype.delete=function(a){"string"===
typeof a&&(a=a.length);if("number"!==typeof a||0>a)throw Error("delete expects a positive integer or a string");if(0===a)return this;this.baseLength+=a;const b=0<this.ops.length?this.ops[this.ops.length-1]:null;b&&b.isDelete()?b.chars+=a:this.ops.push(new g("delete",a));return this};a.prototype.isNoop=function(){return 0===this.ops.length||1===this.ops.length&&this.ops[0].isRetain()&&this.ops[0].hasEmptyAttributes()};a.prototype.clone=function(){const b=new a;for(let a=0;a<this.ops.length;a++)this.ops[a].isRetain()?
b.retain(this.ops[a].chars,this.ops[a].attributes):this.ops[a].isInsert()?b.insert(this.ops[a].text,this.ops[a].attributes):b.delete(this.ops[a].chars);return b};a.prototype.toString=function(){return(Array.prototype.map||function(a){const b=[];for(let c=0,d=this.length;c<d;c++)b[c]=a(this[c]);return b}).call(this.ops,a=>a.isRetain()?`retain ${a.chars}`:a.isInsert()?`insert '${a.text}'`:`delete ${a.chars}`).join(", ")};a.prototype.toJSON=function(){const a=[];for(let b=0;b<this.ops.length;b++)this.ops[b].hasEmptyAttributes()||
a.push(this.ops[b].attributes),"retain"===this.ops[b].type?a.push(this.ops[b].chars):"insert"===this.ops[b].type?a.push(this.ops[b].text):"delete"===this.ops[b].type&&a.push(-this.ops[b].chars);0===a.length&&a.push(0);return a};a.fromJSON=function(b){const c=new a;for(let a=0,d=b.length;a<d;a++){let d=b[a],f={};"object"===typeof d&&(f=d,a++,d=b[a]);"number"===typeof d?0<d?c.retain(d,f):c.delete(-d):(k.assert("string"===typeof d),c.insert(d,f))}return c};a.prototype.apply=function(a,b,c){b=b||[];c=
c||[];if(a.length!==this.baseLength)throw Error("The operation's base length must be equal to the string's length.");const d=[];let f=0,g,m,n=0;const {ops:r}=this;for(let p=0,q=r.length;p<q;p++){const q=r[p];if(q.isRetain()){if(n+q.chars>a.length)throw Error("Operation can't retain more characters than are left in the string.");d[f++]=a.slice(n,n+q.chars);for(g=0;g<q.chars;g++){var A=b[n+g]||{};const a={};for(m in A)a[m]=A[m],k.assert(!1!==a[m]);for(m in q.attributes)!1===q.attributes[m]?delete a[m]:
a[m]=q.attributes[m],k.assert(!1!==a[m]);c.push(a)}n+=q.chars}else if(q.isInsert())for(d[f++]=q.text,g=0;g<q.text.length;g++){A={};for(m in q.attributes)A[m]=q.attributes[m],k.assert(!1!==A[m]);c.push(A)}else n+=q.chars}if(n!==a.length)throw Error("The operation didn't operate on the whole string.");a=d.join("");k.assert(a.length===c.length);return a};a.prototype.invert=function(b){let c=0;const d=new a,{ops:f}=this;for(let a=0,g=f.length;a<g;a++){const g=f[a];g.isRetain()?(d.retain(g.chars),c+=g.chars):
g.isInsert()?d.delete(g.text.length):(d.insert(b.slice(c,c+g.chars)),c+=g.chars)}return d};a.prototype.compose=function(b){function c(a,b,c){const d={};let f;for(f in a)d[f]=a[f];for(f in b)c&&!1===b[f]?delete d[f]:d[f]=b[f];return d}if(this.targetLength!==b.baseLength)throw Error("The base length of the second operation has to be the target length of the first operation");const d=new a,f=this.clone().ops;b=b.clone().ops;let g=0,k=0,m=f[g++],p=b[k++],q;for(;"undefined"!==typeof m||"undefined"!==typeof p;)if(m&&
m.isDelete())d.delete(m.chars),m=f[g++];else if(p&&p.isInsert())d.insert(p.text,p.attributes),p=b[k++];else{if("undefined"===typeof m)throw Error("Cannot compose operations: first operation is too short.");if("undefined"===typeof p)throw Error("Cannot compose operations: first operation is too long.");if(m.isRetain()&&p.isRetain())q=c(m.attributes,p.attributes),m.chars>p.chars?(d.retain(p.chars,q),m.chars-=p.chars,p=b[k++]):m.chars===p.chars?(d.retain(m.chars,q),m=f[g++],p=b[k++]):(d.retain(m.chars,
q),p.chars-=m.chars,m=f[g++]);else if(m.isInsert()&&p.isDelete())m.text.length>p.chars?(m.text=m.text.slice(p.chars),p=b[k++]):m.text.length===p.chars?(m=f[g++],p=b[k++]):(p.chars-=m.text.length,m=f[g++]);else if(m.isInsert()&&p.isRetain())q=c(m.attributes,p.attributes,!0),m.text.length>p.chars?(d.insert(m.text.slice(0,p.chars),q),m.text=m.text.slice(p.chars),p=b[k++]):m.text.length===p.chars?(d.insert(m.text,q),m=f[g++],p=b[k++]):(d.insert(m.text,q),p.chars-=m.text.length,m=f[g++]);else if(m.isRetain()&&
p.isDelete())m.chars>p.chars?(d.delete(p.chars),m.chars-=p.chars,p=b[k++]):m.chars===p.chars?(d.delete(p.chars),m=f[g++],p=b[k++]):(d.delete(m.chars),p.chars-=m.chars,m=f[g++]);else throw Error(`This shouldn't happen: op1: ${JSON.stringify(m)}, op2: ${JSON.stringify(p)}`);}return d};a.prototype.shouldBeComposedWith=function(a){if(this.isNoop()||a.isNoop())return!0;const c=f(this),d=f(a),g=b(this);a=b(a);return g&&a?g.isInsert()&&a.isInsert()?c+g.text.length===d:g.isDelete()&&a.isDelete()?d+a.chars===
c||c===d:!1:!1};a.prototype.shouldBeComposedWithInverted=function(a){if(this.isNoop()||a.isNoop())return!0;const c=f(this),d=f(a),g=b(this);a=b(a);return g&&a?g.isInsert()&&a.isInsert()?c+g.text.length===d||c===d:g.isDelete()&&a.isDelete()?d+a.chars===c:!1:!1};a.transformAttributes=function(a,b){const c={},d={};let f;var g={};for(f in a)g[f]=!0;for(f in b)g[f]=!0;for(f in g){g=a[f];const m=b[f];k.assert(null!=g||null!=m);null==g?d[f]=m:null==m?c[f]=g:g!==m&&(c[f]=g)}return[c,d]};a.transform=function(b,
c){if(b.baseLength!==c.baseLength)throw Error("Both operations have to have the same base length");const d=new a,f=new a;b=b.clone().ops;c=c.clone().ops;let g=0,k=0,m=b[g++],n=c[k++];for(;"undefined"!==typeof m||"undefined"!==typeof n;)if(m&&m.isInsert())d.insert(m.text,m.attributes),f.retain(m.text.length),m=b[g++];else if(n&&n.isInsert())d.retain(n.text.length),f.insert(n.text,n.attributes),n=c[k++];else{if("undefined"===typeof m)throw Error("Cannot transform operations: first operation is too short.");
if("undefined"===typeof n)throw Error("Cannot transform operations: first operation is too long.");if(m.isRetain()&&n.isRetain()){const r=a.transformAttributes(m.attributes,n.attributes);if(m.chars>n.chars){var q=n.chars;m.chars-=n.chars;n=c[k++]}else m.chars===n.chars?(q=n.chars,m=b[g++],n=c[k++]):(q=m.chars,n.chars-=m.chars,m=b[g++]);d.retain(q,r[0]);f.retain(q,r[1])}else if(m.isDelete()&&n.isDelete())m.chars>n.chars?(m.chars-=n.chars,n=c[k++]):m.chars===n.chars?(m=b[g++],n=c[k++]):(n.chars-=m.chars,
m=b[g++]);else if(m.isDelete()&&n.isRetain())m.chars>n.chars?(q=n.chars,m.chars-=n.chars,n=c[k++]):m.chars===n.chars?(q=n.chars,m=b[g++],n=c[k++]):(q=m.chars,n.chars-=m.chars,m=b[g++]),d.delete(q);else if(m.isRetain()&&n.isDelete())m.chars>n.chars?(q=n.chars,m.chars-=n.chars,n=c[k++]):m.chars===n.chars?(q=m.chars,m=b[g++],n=c[k++]):(q=m.chars,n.chars-=m.chars,m=b[g++]),f.delete(q);else throw Error("The two operations aren't compatible");}return[d,f]};return a}();c.TextOperation=b})(window);(function(c){const b=function(a){function b(a,b){this.wrapped=a;this.meta=b}function c(a,b){for(const c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c])}function g(a,b){return a&&"object"===typeof a&&"function"===typeof a.transform?a.transform(b):a}b.prototype.apply=function(){return this.wrapped.apply.apply(this.wrapped,arguments)};b.prototype.invert=function(){const {meta:a}=this;return new b(this.wrapped.invert.apply(this.wrapped,arguments),a&&"object"===typeof a&&"function"===typeof a.invert?
a.invert.apply(a,arguments):a)};b.prototype.compose=function(a){var d=this.wrapped.compose(a.wrapped);var f=this.meta;a=a.meta;if(f&&"object"===typeof f)if("function"===typeof f.compose)f=f.compose(a);else{var g={};c(f,g);c(a,g);f=g}else f=a;return new b(d,f)};b.transform=function(a,c){var {transform:d}=a.wrapped.constructor;d=d(a.wrapped,c.wrapped);return[new b(d[0],g(a.meta,c.wrapped)),new b(d[1],g(c.meta,a.wrapped))]};return b}();c.WrappedOperation=b})(window);(function(c){const b=function(){function a(a,b){this.position=a;this.selectionEnd=b}a.fromJSON=function(b){return new a(b.position,b.selectionEnd)};a.prototype.equals=function(a){return this.position===a.position&&this.selectionEnd===a.selectionEnd};a.prototype.compose=function(a){return a};a.prototype.transform=function(b){function c(a){let c=a;const {ops:d}=b;for(let f=0,g=b.ops.length;f<g&&!(d[f].isRetain()?a-=d[f].chars:d[f].isInsert()?c+=d[f].text.length:(c-=Math.min(a,d[f].chars),a-=d[f].chars),
0>a);f++);return c}const d=c(this.position);return this.position===this.selectionEnd?new a(d,d):new a(d,c(this.selectionEnd))};return a}();c.Cursor=b})(window);(function(c){const b=function(){function a(a){this.maxItems=a||50;this.state="normal";this.dontCompose=!1;this.undoStack=[];this.redoStack=[]}function b(a,b){const c=[],d=b.constructor;for(let f=a.length-1;0<=f;f--)b=d.transform(a[f],b),"function"===typeof b[0].isNoop&&b[0].isNoop()||c.push(b[0]),b=b[1];return c.reverse()}a.prototype.add=function(a,b){if("undoing"===this.state)this.redoStack.push(a),this.dontCompose=!0;else if("redoing"===this.state)this.undoStack.push(a),this.dontCompose=!0;else{const {undoStack:c}=
this;!this.dontCompose&&b&&0<c.length?c.push(a.compose(c.pop())):(c.push(a),c.length>this.maxItems&&c.shift());this.dontCompose=!1;this.redoStack=[]}};a.prototype.transform=function(a){this.undoStack=b(this.undoStack,a);this.redoStack=b(this.redoStack,a)};a.prototype.performUndo=function(a){this.state="undoing";if(0===this.undoStack.length)throw Error("undo not possible");a(this.undoStack.pop());this.state="normal"};a.prototype.performRedo=function(a){this.state="redoing";if(0===this.redoStack.length)throw Error("redo not possible");
a(this.redoStack.pop());this.state="normal"};a.prototype.canUndo=function(){return 0!==this.undoStack.length};a.prototype.canRedo=function(){return 0!==this.redoStack.length};a.prototype.isUndoing=function(){return"undoing"===this.state};a.prototype.isRedoing=function(){return"redoing"===this.state};return a}();c.UndoManager=b})(window);(function(c){const b=function(){function a(a){this.revision=a;this.state=k}function b(){}function c(a){this.outstanding=a}function g(a,b){this.outstanding=a;this.buffer=b}a.prototype.setState=function(a){this.state=a};a.prototype.applyClient=function(a){this.setState(this.state.applyClient(this,a))};a.prototype.applyServer=function(a){this.revision++;this.setState(this.state.applyServer(this,a))};a.prototype.serverAck=function(){this.revision++;this.setState(this.state.serverAck(this))};a.prototype.serverRetry=
function(){this.setState(this.state.serverRetry(this))};a.prototype.transformCursor=function(a){return this.state.transformCursor(a)};a.prototype.sendOperation=function(a){throw Error("sendOperation must be defined in child class");};a.prototype.applyOperation=function(a){throw Error("applyOperation must be defined in child class");};a.Synchronized=b;b.prototype.applyClient=function(a,b){a.sendOperation(a.revision,b);return new c(b)};b.prototype.applyServer=function(a,b){a.applyOperation(b);return this};
b.prototype.transformCursor=function(a){return a};b.prototype.serverAck=function(a){throw Error("There is no pending operation.");};b.prototype.serverRetry=function(a){throw Error("There is no pending operation.");};var k=new b;a.AwaitingConfirm=c;c.prototype.applyClient=function(a,b){return new g(this.outstanding,b)};c.prototype.applyServer=function(a,b){b=b.constructor.transform(this.outstanding,b);a.applyOperation(b[1]);return new c(b[0])};c.prototype.serverAck=function(a){return k};c.prototype.serverRetry=
function(a){a.sendOperation(this.outstanding);return this};c.prototype.transformCursor=function(a){return a.transform(this.outstanding)};a.AwaitingWithBuffer=g;g.prototype.applyClient=function(a,b){a=this.buffer.compose(b);return new g(this.outstanding,a)};g.prototype.applyServer=function(a,b){var {transform:c}=b.constructor;b=c(this.outstanding,b);c=c(this.buffer,b[1]);a.applyOperation(c[1]);return new g(b[0],c[0])};g.prototype.serverRetry=function(a){const b=this.outstanding.compose(this.buffer);
a.sendOperation(b);return new c(b)};g.prototype.serverAck=function(a){a.sendOperation(a.revision,this.buffer);return new c(this.buffer)};g.prototype.transformCursor=function(a){return a.transform(this.outstanding).transform(this.buffer)};return a}();c.Client=b})(window);(function(c){let b=0,a=0,d=null;"use strict";const f=function(){function f(a,b){this.cursorBefore=a;this.cursorAfter=b}function k(a,b){this.id=a;this.editorAdapter=b;this.li=document.createElement("li")}function m(a,b,c,d){r.call(this,a);this.serverAdapter=c;this.editorAdapter=d;this.undoManager=new z;this.clients={};const f=this;this.editorAdapter.registerCallbacks({change(a,b){f.onChange(a,b)},cursorActivity(){f.onCursorActivity()},blur(){f.onBlur()},focus(){f.onFocus()}});this.editorAdapter.registerUndo(()=>
{f.undo()});this.editorAdapter.registerRedo(()=>{f.redo()});this.serverAdapter.registerCallbacks({client_left(a){f.onClientLeft(a)},set_name(a,b){f.getClientObject(a).setName(b)},ack(){f.serverAck()},operation(a){f.applyServer(v.fromJSON(a))},cursor(a,b){b?f.getClientObject(a).updateCursor(f.transformCursor(t.fromJSON(b))):f.getClientObject(a).removeCursor()},clients(a){let b;for(b in f.clients)if(Object.prototype.hasOwnProperty.call(f.clients,b)&&!Object.prototype.hasOwnProperty.call(a,b))f.onClientLeft(b);
for(b in a)if(Object.prototype.hasOwnProperty.call(a,b)){var c=f.getClientObject(b);a[b].name&&c.setName(a[b].name);({selection:c}=a[b]);c?f.clients[b].updateSelection(f.transformSelection(Selection.fromJSON(c))):f.clients[b].removeSelection()}},reconnect(){f.serverReconnect()}})}function n(a){return a[a.length-1]}const {Client:r}=c,{Cursor:t}=c,{UndoManager:z}=c,{TextOperation:v}=c,{WrappedOperation:u}=c;f.prototype.invert=function(){return new f(this.cursorAfter,this.cursorBefore)};f.prototype.compose=
function(a){return new f(this.cursorBefore,a.cursorAfter)};f.prototype.transform=function(a){return new f(this.cursorBefore?this.cursorBefore.transform(a):null,this.cursorAfter?this.cursorAfter.transform(a):null)};k.prototype.setColor=function(a){this.color=a};k.prototype.updateCursor=function(a){this.color="#86BA7D";this.removeCursor();this.cursor=a;this.mark=this.editorAdapter.setOtherCursor(a,this.color,this.id)};k.prototype.removeCursor=function(){this.mark&&this.mark.clear()};(function(a,b){function c(){}
c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a})(m,r);m.prototype.getClientObject=function(a){const b=this.clients[a];return b?b:this.clients[a]=new k(a,this.editorAdapter)};m.prototype.applyUnredo=function(a){this.undoManager.add(this.editorAdapter.invertOperation(a));this.editorAdapter.applyOperation(a.wrapped);(this.cursor=a.meta.cursorAfter)&&this.editorAdapter.setCursor(this.cursor);this.applyClient(a.wrapped)};m.prototype.undo=function(){const a=this;this.undoManager.canUndo()&&
this.undoManager.performUndo(b=>{a.applyUnredo(b)})};m.prototype.redo=function(){const a=this;this.undoManager.canRedo()&&this.undoManager.performRedo(b=>{a.applyUnredo(b)})};m.prototype.onChange=function(a,b){var c=this.cursor;this.updateCursor();const d=0<this.undoManager.undoStack.length&&b.shouldBeComposedWithInverted(n(this.undoManager.undoStack).wrapped);c=new f(this.cursor,c);this.undoManager.add(new u(b,c),d);this.applyClient(a)};m.prototype.updateCursor=function(){this.cursor=this.editorAdapter.getCursor()};
m.prototype.onCursorActivity=function(){const a=this.cursor;this.updateCursor();!this.focused||a&&this.cursor.equals(a)||this.sendCursor(this.cursor)};m.prototype.onBlur=function(){this.cursor=null;this.sendCursor(null);this.focused=!1};m.prototype.onFocus=function(){this.focused=!0;this.onCursorActivity()};m.prototype.sendCursor=function(c){if(!(this.state instanceof r.AwaitingWithBuffer)){if(null!=c&&Object.prototype.hasOwnProperty.call(c,"position"))var f=c.position;if(null!=c&&Object.prototype.hasOwnProperty.call(c,
"selectionEnd"))var {selectionEnd:g}=c;if(0===b)null!=f&&null!=g?(this.serverAdapter.sendCursor(c),b=1):this.serverAdapter.sendCursor(c);else if(null!=f&&null!=g){null!=d&&clearTimeout(d);a=c;const b=this;d=setTimeout(()=>{b.serverAdapter.sendCursor(c);a=null},300)}else null!=a&&(this.serverAdapter.sendCursor(a),a=null),this.serverAdapter.sendCursor(c),b=0;g=f=null}};m.prototype.sendOperation=function(a,b){this.serverAdapter.sendOperation(a,b.toJSON(),this.cursor,this.editorAdapter.cm.options.keyMap)};
m.prototype.applyOperation=function(a){this.editorAdapter.applyOperation(a);this.updateCursor();this.undoManager.transform(new u(a,null))};m.prototype.emitStatus=function(){const a=this;setTimeout(()=>{a.trigger("synced",a.state instanceof r.Synchronized)},0)};return m}();c.EditorClient=f})(window);(function(c){const b=function(){function a(a,b){this.pos=a;this.length=b}a.prototype.end=function(){return this.pos+this.length};return a}();c.Span=b})(window);(function(c){const b=function(){function a(a,b){if(!a)throw Error(`AnnotationList assertion failed${b?`: ${b}`:""}`);}function b(a,b){this.pos=a;this.length=b.length;this.annotation=b.annotation;this.attachedObject_=b.attachedObject}function f(a,b){this.pos=a;this.length=b.length;this.annotation=b.annotation;this.node_=b}function g(a){this.head_=new k(0,n);this.changeHandler_=a}function k(a,b){this.length=a;this.annotation=b;this.next=this.attachedObject=null}const {Span:m}=c;b.prototype.getAttachedObject=
function(){return this.attachedObject_};f.prototype.attachObject=function(a){this.node_.attachedObject=a};const n={equals(){return!1}};g.prototype.insertAnnotatedSpan=function(b,c){this.wrapOperation_(new m(b.pos,0),(d,f)=>{a(!f||null===f.next);const g=new k(b.length,c);if(!f)return g;a(b.pos>d&&b.pos<d+f.length);const m=new k(0,n);m.next=new k(b.pos-d,f.annotation);m.next.next=g;g.next=new k(d+f.length-b.pos,f.annotation);return m.next})};g.prototype.removeSpan=function(b){0!==b.length&&this.wrapOperation_(b,
(c,d)=>{a(null!==d);const f=new k(0,n);let g=f;b.pos>c&&(g.next=new k(b.pos-c,d.annotation),g=g.next);for(;b.end()>c+d.length;)c+=d.length,d=d.next;c=c+d.length-b.end();0<c&&(g.next=new k(c,d.annotation));return f.next})};g.prototype.updateSpan=function(b,c){0!==b.length&&this.wrapOperation_(b,(d,f)=>{a(null!==f);const g=new k(0,n);let m=g;var q=d,r=b.pos-q;a(r<f.length);0<r&&(m.next=new k(r,f.annotation),m=m.next,q+=m.length);for(;null!==f&&b.end()>=d+f.length;)q=d+f.length-q,m.next=new k(q,c(f.annotation,
q)),m=m.next,d+=f.length,f=f.next,q=d;r=b.end()-q;0<r&&(a(r<f.length),m.next=new k(r,c(f.annotation,r)),m=m.next,q+=m.length,m.next=new k(d+f.length-q,f.annotation));return g.next})};g.prototype.wrapOperation_=function(a,c){if(0>a.pos)throw Error("Span start cannot be negative.");const d=[],g=[];a=this.getAffectedNodes_(a);if(null!==a.start){var m=a.end.next;a.end.next=null}else m=a.succ;var n=c(a.startPos,a.start);let q=!1;c=!1;if(n){this.mergeNodesWithSameAnnotations_(n);let b;a.pred&&a.pred.annotation.equals(n.annotation)?
(q=!0,n.length+=a.pred.length,a.beforePred.next=n,b=a.predPos):(a.beforeStart.next=n,b=a.startPos);for(;n.next;)g.push(new f(b,n)),b+=n.length,n=n.next;a.succ&&a.succ.annotation.equals(n.annotation)?(n.length+=a.succ.length,c=!0,n.next=a.succ.next):n.next=m;g.push(new f(b,n))}else a.pred&&a.succ&&a.pred.annotation.equals(a.succ.annotation)?(c=q=!0,n=new k(a.pred.length+a.succ.length,a.pred.annotation),a.beforePred.next=n,n.next=a.succ.next,g.push(new f(a.startPos-a.pred.length,n))):a.beforeStart.next=
m;q&&d.push(new b(a.predPos,a.pred));m=a.startPos;for(n=a.start;null!==n;)d.push(new b(m,n)),m+=n.length,n=n.next;c&&d.push(new b(m,a.succ));this.changeHandler_(d,g)};g.prototype.getAffectedNodes_=function(a){const b={};let c=null,d=this.head_,f=d.next,g=0;for(;null!==f&&a.pos>=g+f.length;)g+=f.length,c=d,d=f,f=f.next;if(null===f&&(0!==a.length||a.pos!==g))throw Error("Span start exceeds the bounds of the AnnotationList.");b.startPos=g;b.start=0===a.length&&a.pos===g?null:f;b.beforeStart=d;g===a.pos&&
0<g?(b.pred=d,b.predPos=g-d.length,b.beforePred=c):b.pred=null;for(;null!==f&&a.end()>g;)g+=f.length,d=f,f=f.next;if(a.end()>g)throw Error("Span end exceeds the bounds of the AnnotationList.");0===a.length&&a.end()===g?b.end=null:b.end=d;b.succ=g===a.end()?f:null;return b};g.prototype.mergeNodesWithSameAnnotations_=function(a){if(a)for(var b=null;a;)b&&b.annotation.equals(a.annotation)?(b.length+=a.length,b.next=a.next):b=a,a=a.next};g.prototype.forEach=function(a){let b=this.head_.next;for(;null!==
b;)a(b.length,b.annotation,b.attachedObject),b=b.next};g.prototype.getAnnotatedSpansForPos=function(a){let c=0,d=this.head_.next,f=null;for(;null!==d&&c+d.length<=a;)c+=d.length,f=d,d=d.next;if(null===d&&c!==a)throw Error("pos exceeds the bounds of the AnnotationList");const g=[];c===a&&f&&g.push(new b(c-f.length,f));d&&g.push(new b(c,d));return g};g.prototype.getAnnotatedSpansForSpan=function(a){if(0===a.length)return[];const b=[];var c=this.getAffectedNodes_(a);let d=c.startPos;for(c=c.start;null!==
c&&d<a.end();){var f=Math.max(d,a.pos);const g=Math.min(d+c.length,a.end());f=new m(f,g-f);f.annotation=c.annotation;b.push(f);d+=c.length;c=c.next}return b};g.prototype.count=function(){let b=0,c=this.head_.next,d=null;for(;null!==c;)d&&a(!d.annotation.equals(c.annotation)),d=c,c=c.next,b++;return b};k.prototype.clone=function(){const a=new k(this.spanLength,this.annotation);a.next=this.next;return a};return g}();c.AnnotationList=b})(window);(function(c){c.AttributeConstants={BOLD:"b",ITALIC:"i",UNDERLINE:"u",STRIKE:"s",FONT:"f",FONT_SIZE:"fs",COLOR:"c",BACKGROUND_COLOR:"bc",ENTITY_SENTINEL:"ent",LINE_SENTINEL:"l",LINE_INDENT:"li",LINE_ALIGN:"la",LIST_TYPE:"lt"}})(window);(function(c){const b=function(){function a(c){if(!(this instanceof a))return new a(c);this.attributes=c||{};this.attributes[b.LINE_SENTINEL]=!0}const b=c.AttributeConstants;a.LIST_TYPE={NONE:!1,ORDERED:"o",UNORDERED:"u",TODO:"t",TODOCHECKED:"tc"};a.prototype.cloneWithNewAttribute_=function(b,c){const d={};for(const a in this.attributes)d[a]=this.attributes[a];!1===c?delete d[b]:d[b]=c;return new a(d)};a.prototype.indent=function(a){return this.cloneWithNewAttribute_(b.LINE_INDENT,a)};a.prototype.align=
function(a){return this.cloneWithNewAttribute_(b.LINE_ALIGN,a)};a.prototype.listItem=function(a){vceditor.utils.assert(!1===a||"u"===a||"o"===a||"t"===a||"tc"===a);return this.cloneWithNewAttribute_(b.LIST_TYPE,a)};a.prototype.getIndent=function(){return this.attributes[b.LINE_INDENT]||0};a.prototype.getAlign=function(){return this.attributes[b.LINE_ALIGN]||0};a.prototype.getListItem=function(){return this.attributes[b.LIST_TYPE]||!1};return a}();c.LineFormatting=b})(window);(function(c){const b=function(){function a(a){return a===k.ORDERED?"</ol>":"</ul>"}function b(a,b){return a===b||a===k.TODO&&b===k.TODOCHECKED||a===k.TODOCHECKED&&b===k.TODO}const {utils:f}=c,g=c.AttributeConstants,{LIST_TYPE:k}=c.LineFormatting;return function(c,d){let m="",n=!0;const z=[];var v=!1;let u=!0;var p=!0;let q=0,A=c.ops[q],D=!1;for(;A;){f.assert(A.isInsert());const r=A.attributes;if(n){n=!1;var F=0,G=null,C="left";g.LINE_SENTINEL in r&&(F=r[g.LINE_INDENT]||0,G=r[g.LIST_TYPE]||null,C=
r[g.LINE_ALIGN]||"left");G&&(F=F||1);v?(m+="</li>",v=!1):u||(p&&(m+="<br/>"),m+="</div>");u=!1;for(f.assert(0<=F,"Indent must not be negative.");z.length>F||F===z.length&&null!==G&&!b(G,z[z.length-1]);)m+=a(z.pop());for(;z.length<F;)p=G||k.UNORDERED,D=G==k.TODO||G==k.TODOCHECKED||D,m+=p===k.ORDERED?"<ol>":p===k.UNORDERED?"<ul>":'<ul class="vceditor-todo">',z.push(p);p="left"!==C?` style="text-align:${C}"`:"";if(G){v="";switch(G){case k.TODOCHECKED:v=' class="vceditor-checked"';break;case k.TODO:v=
' class="vceditor-unchecked"'}m+=`<li${v}${p}>`;v=!0}else m+=`<div${p}>`;p=!0}if(g.LINE_SENTINEL in r){A=c.ops[++q];continue}if(g.ENTITY_SENTINEL in r){for(G=0;G<A.text.length;G++)F=vceditor.Entity.fromAttributes(r),F=d.exportToElement(F),m+=F.outerHTML;A=c.ops[++q];continue}F=G="";for(const a in r){C=r[a];var B;if(a===g.BOLD||a===g.ITALIC||a===g.UNDERLINE||a===g.STRIKE){f.assert(!0===C);var H=B=a}else a===g.FONT_SIZE?(H=`span style="font-size: ${C}`,H+="string"!==typeof C||-1===C.indexOf("px",C.length-
2)?'px"':'"',B="span"):a===g.FONT?(H=`span style="font-family: ${C}"`,B="span"):a===g.COLOR?(H=`span style="color: ${C}"`,B="span"):a===g.BACKGROUND_COLOR?(H=`span style="background-color: ${C}"`,B="span"):f.log(!1,`Encountered unknown attribute while rendering html: ${a}`);H&&(G+=`<${H}>`);B&&(F=`</${B}>${F}`)}({text:C}=A);const t=C.indexOf("\n");0<=t?(n=!0,A=t<C.length-1?new vceditor.TextOp("insert",C.substr(t+1),r):c.ops[++q],C=C.substr(0,t)):A=c.ops[++q];C=C.replace(/  +/g,a=>Array(a.length+1).join("\u00a0")).replace(/^ /,
"\u00a0").replace(/ $/,"\u00a0");0<C.length&&(p=!1);m+=G+C.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g,"&nbsp;")+F}v?m+="</li>":u||(p&&(m+="&nbsp;"),m+="</div>");for(;0<z.length;)m+=a(z.pop());D&&(m='<style>ul.vceditor-todo { list-style: none; margin-left: 0; padding-left: 0; } ul.vceditor-todo > li { padding-left: 1em; text-indent: -1em; } ul.vceditor-todo > li:before { content: "\\2610"; padding-right: 5px; } ul.vceditor-todo > li.vceditor-checked:before { content: "\\2611"; padding-right: 5px; }</style>\n'+
m);return m}}();c.SerializeHtml=b})(window);(function(c){const b=function(){function a(a,b,c){this.listType=a||m.UNORDERED;this.lineFormatting=b||vceditor.LineFormatting();this.textFormatting=c||vceditor.Formatting()}function b(){this.lines=[];this.currentLine=[];this.currentLineListItemType=null}function f(a,b,c){if(a.nodeType===r.ELEMENT_NODE){var d=n.fromElement(a);if(d){c.currentLine.push(new vceditor.Text(vceditor.sentinelConstants.ENTITY_SENTINEL_CHARACTER,new vceditor.Formatting(d.toAttributes())));return}}switch(a.nodeType){case r.TEXT_NODE:a=
a.nodeValue.replace(/[ \n\t]+/g," ");c.currentLine.push(vceditor.Text(a,b.textFormatting));break;case r.ELEMENT_NODE:switch(d=a.getAttribute("style")||"",b=k(b,d),a.nodeName.toLowerCase()){case "div":case "h1":case "h2":case "h3":case "p":c.newlineIfNonEmpty(b);g(a,b,c);c.newlineIfNonEmpty(b);break;case "center":b=b.withAlign("center");c.newlineIfNonEmpty(b);g(a,b.withAlign("center"),c);c.newlineIfNonEmpty(b);break;case "b":case "strong":g(a,b.withTextFormatting(b.textFormatting.bold(!0)),c);break;
case "u":g(a,b.withTextFormatting(b.textFormatting.underline(!0)),c);break;case "i":case "em":g(a,b.withTextFormatting(b.textFormatting.italic(!0)),c);break;case "s":g(a,b.withTextFormatting(b.textFormatting.strike(!0)),c);break;case "font":d=a.getAttribute("face");var f=a.getAttribute("color"),q=parseInt(a.getAttribute("size"));d&&(b=b.withTextFormatting(b.textFormatting.font(d)));f&&(b=b.withTextFormatting(b.textFormatting.color(f)));q&&(b=b.withTextFormatting(b.textFormatting.fontSize(q)));g(a,
b,c);break;case "br":c.newline(b);break;case "ul":c.newlineIfNonEmptyOrListItem(b);d="vceditor-todo"===a.getAttribute("class")?m.TODO:m.UNORDERED;g(a,b.withListType(d).withIncreasedIndent(),c);c.newlineIfNonEmpty(b);break;case "ol":c.newlineIfNonEmptyOrListItem(b);g(a,b.withListType(m.ORDERED).withIncreasedIndent(),c);c.newlineIfNonEmpty(b);break;case "li":c.newlineIfNonEmptyOrListItem(b);d="vceditor-checked"===a.getAttribute("class")?m.TODOCHECKED:b.listType;c.makeListItem(d);d=c.currentLine;g(a,
b,c);(d===c.currentLine||0<c.currentLine.length)&&c.newline(b);break;case "style":break;default:g(a,b,c)}}}function g(a,b,c){if(a.hasChildNodes())for(let d=0;d<a.childNodes.length;d++)f(a.childNodes[d],b,c)}function k(a,b){let {textFormatting:c}=a,{lineFormatting:d}=a;b=b.split(";");for(let a=0;a<b.length;a++){var f=b[a].split(":");if(2===f.length){var g=vceditor.utils.trim(f[0]).toLowerCase();f=vceditor.utils.trim(f[1]).toLowerCase();switch(g){case "text-decoration":g=0<=f.indexOf("underline");f=
0<=f.indexOf("line-through");c=c.underline(g).strike(f);break;case "font-weight":f="bold"===f||600<=parseInt(f);c=c.bold(f);break;case "font-style":c=c.italic("italic"===f||"oblique"===f);break;case "color":c=c.color(f);break;case "background-color":c=c.backgroundColor(f);break;case "text-align":d=d.align(f);break;case "font-size":g=null;vceditor.utils.stringEndsWith(f,"px pt % em xx-small x-small small medium large x-large xx-large smaller larger".split(" "))?g=f:parseInt(f)&&(g=`${parseInt(f)}px`);
g&&(c=c.fontSize(g));break;case "font-family":f=vceditor.utils.trim(f.split(",")[0]),f=f.replace(/['"]/g,""),f=f.replace(/\w\S*/g,a=>a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()),c=c.font(f)}}}return a.withLineFormatting(d).withTextFormatting(c)}const {LIST_TYPE:m}=c.LineFormatting;a.prototype.withTextFormatting=function(b){return new a(this.listType,this.lineFormatting,b)};a.prototype.withLineFormatting=function(b){return new a(this.listType,b,this.textFormatting)};a.prototype.withListType=
function(b){return new a(b,this.lineFormatting,this.textFormatting)};a.prototype.withIncreasedIndent=function(){const b=this.lineFormatting.indent(this.lineFormatting.getIndent()+1);return new a(this.listType,b,this.textFormatting)};a.prototype.withAlign=function(b){b=this.lineFormatting.align(b);return new a(this.listType,b,this.textFormatting)};b.prototype.newlineIfNonEmpty=function(a){this.cleanLine_();0<this.currentLine.length&&this.newline(a)};b.prototype.newlineIfNonEmptyOrListItem=function(a){this.cleanLine_();
(0<this.currentLine.length||null!==this.currentLineListItemType)&&this.newline(a)};b.prototype.newline=function(a){this.cleanLine_();({lineFormatting:a}=a);null!==this.currentLineListItemType&&(a=a.listItem(this.currentLineListItemType),this.currentLineListItemType=null);this.lines.push(vceditor.Line(this.currentLine,a));this.currentLine=[]};b.prototype.makeListItem=function(a){this.currentLineListItemType=a};b.prototype.cleanLine_=function(){if(0<this.currentLine.length){var a=this.currentLine.length-
1;this.currentLine[0].text=this.currentLine[0].text.replace(/^ +/,"");this.currentLine[a].text=this.currentLine[a].text.replace(/ +$/g,"");for(a=0;a<this.currentLine.length;a++)this.currentLine[a].text=this.currentLine[a].text.replace(/\u00a0/g," ")}1===this.currentLine.length&&""===this.currentLine[0].text&&(this.currentLine=[])};let n;var r=r||{ELEMENT_NODE:1,TEXT_NODE:3};return function(c,d){const g=(vceditor.document||document).createElement("div");g.innerHTML=c;n=d;c=new b;d=new a;f(g,d,c);return c.lines}}();
c.ParseHtml=b})(window);(function(c){const b=function(){function a(a){this.rtcm=a;this.cm=a.codeMirror;f(this,"onChange");f(this,"onAttributesChange");f(this,"onCursorActivity");f(this,"onFocus");f(this,"onBlur");this.rtcm.on("change",this.onChange);this.rtcm.on("attributesChange",this.onAttributesChange);this.cm.on("cursorActivity",this.onCursorActivity);this.cm.on("focus",this.onFocus);this.cm.on("blur",this.onBlur)}function b(a){const b=a.lineCount()-1;return a.indexFromPos({line:b,ch:a.getLine(b).length})}function f(a,
b){const c=a[b];a[b]=function(){c.apply(a,arguments)}}function g(a){for(const b in a)return!1;return!0}const {TextOperation:k}=c,{WrappedOperation:m}=c,{Cursor:n}=c;a.prototype.detach=function(){this.rtcm.off("change",this.onChange);this.rtcm.off("attributesChange",this.onAttributesChange);this.cm.off("cursorActivity",this.onCursorActivity);this.cm.off("focus",this.onFocus);this.cm.off("blur",this.onBlur)};a.operationFromCodeMirrorChanges=function(a,c){c=b(c);let d=(new k).retain(c),f=(new k).retain(c);
for(let b=a.length-1;0<=b;b--){const g=a[b],m=g.start,n=c-m-g.text.length;d=(new k).retain(m).delete(g.removed.length).insert(g.text,g.attributes).retain(n).compose(d);f=f.compose((new k).retain(m).delete(g.text.length).insert(g.removed,g.removedAttributes).retain(n));c+=g.removed.length-g.text.length}return[d,f]};a.operationFromAttributesChanges=function(a,c){c=b(c);const d=new k,f=new k;var g=0;for(let b=0;b<a.length;b++){const c=a[b];g=c.start-g;if(!(0<=g))throw Error("assertion error");d.retain(g);
f.retain(g);g=c.end-c.start;d.retain(g,c.attributes);f.retain(g,c.attributesInverse);g=c.start+g}d.retain(c-g);f.retain(c-g);return[d,f]};a.applyOperationToCodeMirror=function(a,b){10<a.ops.length&&b.codeMirror.getWrapperElement().setAttribute("style","display: none");const {ops:c}=a;let d=0;for(let a=0,k=c.length;a<k;a++){var f=c[a];f.isRetain()?(g(f.attributes)||b.updateTextAttributes(d,d+f.chars,a=>{for(const b in f.attributes)!1===f.attributes[b]?delete a[b]:a[b]=f.attributes[b]},"RTCMADAPTER",
!0),d+=f.chars):f.isInsert()?(b.insertText(d,f.text,f.attributes,"RTCMADAPTER"),d+=f.text.length):f.isDelete()&&b.removeText(d,d+f.chars,"RTCMADAPTER")}10<a.ops.length&&(b.codeMirror.getWrapperElement().setAttribute("style",""),b.codeMirror.refresh())};a.prototype.registerCallbacks=function(a){this.callbacks=a};a.prototype.onChange=function(b,c){"RTCMADAPTER"!==c[0].origin&&(b=a.operationFromCodeMirrorChanges(c,this.cm),this.trigger("change",b[0],b[1]))};a.prototype.onAttributesChange=function(b,
c){"RTCMADAPTER"!==c[0].origin&&(b=a.operationFromAttributesChanges(c,this.cm),this.trigger("change",b[0],b[1]))};a.prototype.onCursorActivity=function(){this.trigger("cursorActivity")};a.prototype.onFocus=function(){this.trigger("focus")};a.prototype.onBlur=function(){this.cm.somethingSelected()||this.trigger("blur")};a.prototype.getValue=function(){return this.cm.getValue()};a.prototype.getCursor=function(){var {cm:a}=this,b=a.getCursor();const c=a.indexFromPos(b);if(a.somethingSelected()){const c=
a.getCursor(!0);b=0===(b.line<c.line?-1:b.line>c.line?1:b.ch<c.ch?-1:b.ch>c.ch?1:0)?a.getCursor(!1):c;a=a.indexFromPos(b)}else a=c;return new n(c,a)};a.prototype.setCursor=function(a){this.cm.setSelection(this.cm.posFromIndex(a.position),this.cm.posFromIndex(a.selectionEnd))};a.prototype.addStyleRule=function(a){if("undefined"!==typeof document&&null!==document){if(!this.addedStyleRules){this.addedStyleRules={};const a=document.createElement("style");document.documentElement.getElementsByTagName("head")[0].appendChild(a);
this.addedStyleSheet=a.sheet}if(!this.addedStyleRules[a])return this.addedStyleRules[a]=!0,this.addedStyleSheet.insertRule(a,0)}};a.prototype.setOtherCursor=function(a,b,c){const d=this.cm.posFromIndex(a.position);if("string"===typeof b&&b.match(/^#[a-fA-F0-9]{3,6}$/)){var f=this.rtcm.end();if("object"===typeof a&&"number"===typeof a.position&&"number"===typeof a.selectionEnd&&!(0>a.position||a.position>f||0>a.selectionEnd||a.selectionEnd>f)){var g=this.cm.cursorCoords(d);f=document.createElement("span");
virtualclass.config.makeWebSocketReady&&(f.className="other-client",f.id=`cursorId${c}`,f.style.borderLeftWidth="3px",f.style.borderLeftStyle="solid",f.style.borderLeftColor=b,f.style.marginLeft="-3px",f.style.marginRight="-3px",f.style.height=`${.9*(g.bottom-g.top)}px`,f.setAttribute("data-clientname",virtualclass.vutil.getUserInfo("name",c,virtualclass.connectedUsers)),f.setAttribute("data-clientid",c));f.style.position="relative";g=document.getElementById(`cursorId${c}`);null!=g&&g.parentNode.removeChild(g);
if(c!=virtualclass.gObj.uid){if(a.position===a.selectionEnd)return f.style.zIndex=0,this.cm.setBookmark(d,{widget:f,insertLeft:!0});this.cm.setBookmark(d,{widget:f,insertLeft:!0});c=`selection-${b.replace("#","")}`;this.addStyleRule(`.${c} { background: ${b}; }`);a.selectionEnd>a.position?(b=d,a=this.cm.posFromIndex(a.selectionEnd)):(b=this.cm.posFromIndex(a.selectionEnd),a=d);return this.cm.markText(b,a,{className:c})}}}};a.prototype.trigger=function(a){const b=Array.prototype.slice.call(arguments,
1),c=this.callbacks&&this.callbacks[a];c&&c.apply(this,b)};a.prototype.applyOperation=function(b){a.applyOperationToCodeMirror(b,this.rtcm)};a.prototype.registerUndo=function(a){this.cm.undo=a};a.prototype.registerRedo=function(a){this.cm.redo=a};a.prototype.invertOperation=function(a){let b=0;const c=this.rtcm.codeMirror;let d,f;const n=new k;for(let k=0;k<a.wrapped.ops.length;k++){const m=a.wrapped.ops[k];if(m.isRetain())if(g(m.attributes))n.retain(m.chars),b+=m.chars;else for(d=this.rtcm.getAttributeSpans(b,
b+m.chars),f=0;f<d.length;f++){var q={};for(const a in m.attributes){var A=m.attributes[a];const b=d[f].attributes[a];!1===A?b&&(q[a]=b):A!==b&&(q[a]=b||!1)}n.retain(d[f].length,q);b+=d[f].length}else if(m.isInsert())n.delete(m.text.length);else if(m.isDelete()){q=c.getRange(c.posFromIndex(b),c.posFromIndex(b+m.chars));d=this.rtcm.getAttributeSpans(b,b+m.chars);for(f=A=0;f<d.length;f++)n.insert(q.substr(A,d[f].length),d[f].attributes),A+=d[f].length;b+=m.chars}}return new m(n,a.meta.invert())};return a}();
c.Client=b})(window);const otAdapter=function(){function c(b,a){a=a.charAt(0).toLowerCase()+a.slice(1);const c=Vceditor.getvcEditor();b.operations&&b.revision>b.operations.length?(a=[],a[b.revision-b.operations.length-1]=null,this.operations=a.concat(b.operations)):this.operations=b.operations?b.operations:[];this.server=new c.Server(b.doc,this.operations);this.trigger=function(a){this.callbacks[a].apply(this,Array.prototype.slice.call(arguments,1))};this.teacherOT=function(a){a=this.doOT(a);"undefined"!==typeof a&&this.preSend(a,
!0)};this.doOT=function(a){if(1!==this.myOTrequestData)try{if("virtualclass-editor-operation"==a.eddata){const b=JSON.parse(a.data),d=new c.WrappedOperation(c.TextOperation.fromJSON(b.operation),b.cursor&&c.Cursor.fromJSON(b.cursor)),f=this.server.receiveOperation(b.revision,d);if(!f)return;a.data=f.wrapped.toJSON();a.meta=f.meta}return a}catch(g){roles.isTeacher()&&(this.myOTrequestData=1,virtualclass[a.et].responseToRequest())}};this.processOp=function(a){if(1!==this.myrequestData&&1!==this.myOTrequestData)try{const b=
a.message;Object.prototype.hasOwnProperty.call(b,"edFrom")&&(a.fromUser.userid=b.edFrom);Object.prototype.hasOwnProperty.call(b,"eddata")&&("virtualclass-editor-cursor"==b.eddata?this.trigger("cursor",a.fromUser.userid,JSON.parse(b.data)):"selection"==b.eddata?this.trigger("selection",virtualclass.gObj.uid,b.data):"virtualclass-editor-operation"==b.eddata&&(this.trigger("operation",b.data),this.trigger("cursor",a.fromUser.userid,b.meta),this.storeOperationIfStudent(b)))}catch(g){console.log("ERROR!"),
roles.hasAdmin()?(this.myOTrequestData=1,virtualclass[a.message.et].responseToRequest()):(this.removeOperations(a),virtualclass[a.message.et].requestData(),this.myrequestData=1)}};this.storeOperationIfStudent=function(a){if(!roles.hasAdmin()||!virtualclass.config.makeWebSocketReady){const b={};b.wrapped=c.TextOperation.fromJSON(a.data);b.meta=a.meta;this.server.operations.push(b)}};this.receivedMessage=function(a){if(!virtualclass.isPlayMode||"object"!==typeof a.toUser){var b=a.message;if("t"!=a.fromUser.role&&
"e"!=a.fromUser.role||Object.prototype.hasOwnProperty.call(b,"edFrom"))if(Object.prototype.hasOwnProperty.call(b,"edFrom")||"t"==a.fromUser.role||"e"==a.fromUser.role)if(b.edFrom==virtualclass.gObj.uid&&virtualclass.vutil.isRefreshMode()){if("virtualclass-editor-operation"==b.eddata)try{this.trigger("ack"),this.storeOperationIfStudent(b)}catch(k){1===ioMissingPackets.missRequestFlag&&(virtualclass[b.et].cmClient.revision--,this.processOp(a))}}else this.processOp(a);else b=this.doOT(b),"undefined"!==
typeof b&&(a.message=b,b.edFrom=a.fromUser.userid,this.preSend(b,!0));else if(roles.hasAdmin()&&virtualclass.config.makeWebSocketReady){if("virtualclass-editor-operation"===b.eddata)try{this.trigger("ack")}catch(k){}}else this.processOp(a)}};this.removeOperations=function(a){({et:a}=a.message);this.server.operations=[];this.server.document="";virtualclass[a].cmClient.revision=0}}c.myrequestData=0;c.myOTrequestData=0;c.prototype.sendOperation=function(b,a,c,f){let d;"undefined"!==typeof f&&(d="richtext"===
f?"editorRich":"editorCode");b={eddata:"virtualclass-editor-operation",data:JSON.stringify({revision:b,operation:a,cursor:c}),et:d,cf:"eddata"};this.beforeSend(b)};c.prototype.sendSelection=function(b){this.beforeSend({eddata:"selection",data:JSON.stringify(b),cf:"eddata"})};c.prototype.sendCursor=function(b){this.beforeSend({eddata:"virtualclass-editor-cursor",data:JSON.stringify(b),cf:"eddata"})};c.prototype.registerCallbacks=function(b){this.callbacks=b};c.prototype.beforeSend=function(b){if(1!=
this.myrequestData)if(roles.hasAdmin())this.teacherOT(b);else{const a=virtualclass.vutil.whoIsTeacher();b=this.setEditorTypeOnPacket(b);ioAdapter.mustSendUser(b,a)}};c.prototype.setEditorTypeOnPacket=function(b){if(Object.prototype.hasOwnProperty.call(b,"eddata")&&"initVcEditor"!=b.eddata&&"virtualclass-editor-operation"!=b.eddata)if("EditorRich"==virtualclass.currApp||"editorRich"==virtualclass.currApp)b.et="editorRich";else if("EditorCode"==virtualclass.currApp||"editorCode"==virtualclass.currApp)b.et=
"editorCode";return b};c.prototype.preSend=function(b,a){b=this.setEditorTypeOnPacket(b);"undefined"===typeof a||0==a||null==a?ioAdapter.mustSend(b):setTimeout(()=>{"EditorRich"===virtualclass.currApp&&ioAdapter.mustSendAll(b)},300)};return c}();const Vceditor=function(c){var b=b||{};b.utils=c.utils;b=b||{};b.Span=c.Span;b.TextOp=c.TextOp;b.TextOperation=c.TextOperation;b.AnnotationList=c.AnnotationList;b.Cursor=c.Cursor;b.RichTextToolbar=c.RichTextToolbar;b.WrappedOperation=c.WrappedOperation;b.UndoManager=c.UndoManager;b.Client=c.Client;Client=b.Client;b.EditorClient=c.EditorClient;b.utils.makeEventEmitter(b.EditorClient,["synced"]);b.AttributeConstants=c.AttributeConstants;b.sentinelConstants={LINE_SENTINEL_CHARACTER:"\ue000",ENTITY_SENTINEL_CHARACTER:"\ue001"};
b.EntityManager=function(){function a(){this.entities_={};const a="src alt width height style class".split(" ");this.register("img",{render(a){d.assert(a.src,"image entity should have 'src'!");const b="src alt width height style class".split(" ");let c="<img ";for(let d=0;d<b.length;d++){const f=b[d];f in a&&(c+=` ${f}="${a[f]}"`)}return c+">"},fromElement(b){const c={};for(let d=0;d<a.length;d++){const f=a[d];b.hasAttribute(f)&&(c[f]=b.getAttribute(f))}return c}})}const {utils:d}=b;a.prototype.register=
function(a,c){b.utils.assert(c.render,"Entity options should include a 'render' function!");b.utils.assert(c.fromElement,"Entity options should include a 'fromElement' function!");this.entities_[a]=c};a.prototype.renderToElement=function(a,b){return this.tryRenderToElement_(a,"render",b)};a.prototype.exportToElement=function(a){const b=this.tryRenderToElement_(a,"export")||this.tryRenderToElement_(a,"getHtml")||this.tryRenderToElement_(a,"render");b.setAttribute("data-vceditor-entity",a.type);return b};
a.prototype.updateElement=function(a,b){const {type:c}=a;({info:a}=a);this.entities_[c]&&"undefined"!==typeof this.entities_[c].update&&this.entities_[c].update(a,b)};a.prototype.fromElement=function(a){let c=a.getAttribute("data-vceditor-entity");c||(c=a.nodeName.toLowerCase());if(c&&this.entities_[c])return a=this.entities_[c].fromElement(a),new b.Entity(c,a)};a.prototype.tryRenderToElement_=function(a,d,k){var {type:f}=a;({info:a}=a);if(this.entities_[f]&&this.entities_[f][d]&&(d=this.entities_[f][d](a,
k,b.document||c&&c.document))){if("string"===typeof d)return f=(b.document||document).createElement("div"),f.innerHTML=d,f.childNodes[0];if("object"===typeof d)return b.utils.assert("undefined"!==typeof d.nodeType,`Error rendering ${f} entity.  render() function`+" must return an html string or a DOM element."),d}};a.prototype.entitySupportsUpdate=function(a){return this.entities_[a]&&this.entities_[a].update};return a}();b=b||{};b.Entity=c.entity;b.Entity=function(){function a(b,c){if(!(this instanceof
a))return new a(b,c);this.type=b;this.info=c||{}}const c=b.AttributeConstants.ENTITY_SENTINEL,f=`${c}_`;a.prototype.toAttributes=function(){const a={};a[c]=this.type;for(const b in this.info)a[f+b]=this.info[b];return a};a.fromAttributes=function(b){const d=b[c],g={};for(const a in b)0===a.indexOf(f)&&(g[a.substr(f.length)]=b[a]);return new a(d,g)};return a}();b.RichTextCodeMirror=function(){function a(a,b,c){this.codeMirror=a;this.options_=c||{};this.entityManager_=b;this.currentAttributes_=null;
const d=this;this.annotationList_=new m((a,b)=>{d.onAnnotationsChanged_(a,b)});this.initAnnotationList_();k(this,"onCodeMirrorBeforeChange_");k(this,"onCodeMirrorChange_");k(this,"onCursorActivity_");if(/^4\./.test(CodeMirror.version))this.codeMirror.on("changes",this.onCodeMirrorChange_);else this.codeMirror.on("change",this.onCodeMirrorChange_);this.codeMirror.on("beforeChange",this.onCodeMirrorBeforeChange_);this.codeMirror.on("cursorActivity",this.onCursorActivity_);this.changeId_=0;this.outstandingChanges_=
{};this.dirtyLines_=[]}function c(a,b){return a.line-b.line||a.ch-b.ch}function f(a){if(0===a.length)return 0;let b=0;for(let c=0;c<a.length;c++)b+=a[c].length;return b+a.length-1}function g(a){this.attributes=a||{}}function k(a,b){const c=a[b];a[b]=function(){c.apply(a,arguments)}}const {AnnotationList:m}=b,{Span:n}=b,{utils:r}=b,t=b.AttributeConstants,z={c:"color",bc:"background-color",fs:"font-size",li(a){return`padding-left: ${40*a}px`}},v={};r.makeEventEmitter(a,["change","attributesChange",
"newLine"]);const u=b.sentinelConstants.LINE_SENTINEL_CHARACTER,p=b.sentinelConstants.ENTITY_SENTINEL_CHARACTER;a.prototype.detach=function(){this.codeMirror.off("beforeChange",this.onCodeMirrorBeforeChange_);this.codeMirror.off("change",this.onCodeMirrorChange_);this.codeMirror.off("changes",this.onCodeMirrorChange_);this.codeMirror.off("cursorActivity",this.onCursorActivity_);this.clearAnnotations_()};a.prototype.toggleAttribute=function(a,b){b=b||!0;if(this.emptySelection_()){const c=this.getCurrentAttributes_();
c[a]===b?delete c[a]:c[a]=b;this.currentAttributes_=c}else b=this.getCurrentAttributes_()[a]!==b?b:!1,this.setAttribute(a,b)};a.prototype.setAttribute=function(a,b){var c=this.codeMirror;this.emptySelection_()?(c=this.getCurrentAttributes_(),!1===b?delete c[a]:c[a]=b,this.currentAttributes_=c):(this.updateTextAttributes(c.indexFromPos(c.getCursor("start")),c.indexFromPos(c.getCursor("end")),c=>{!1===b?delete c[a]:c[a]=b}),this.updateCurrentAttributes_())};a.prototype.updateTextAttributes=function(a,
b,c,d,f){const k=[];let m=a;const q=this;this.annotationList_.updateSpan(new n(a,b-a),(a,b)=>{const n={};for(var A in a.attributes)n[A]=a.attributes[A];n[t.LINE_SENTINEL]&&!f||c(n);A={};const D={};q.computeChangedAttributes_(a.attributes,n,A,D);a:{for(const b in A){a=!1;break a}a=!0}a||k.push({start:m,end:m+b,attributes:A,attributesInverse:D,origin:d});m+=b;return new g(n)});0<k.length&&this.trigger("attributesChange",this,k)};a.prototype.computeChangedAttributes_=function(a,b,c,d){const f={};let g;
for(g in a)f[g]=!0;for(g in b)f[g]=!0;for(g in f)g in b?g in a?a[g]!==b[g]&&(c[g]=b[g],d[g]=a[g]):(c[g]=b[g],d[g]=!1):(c[g]=!1,d[g]=a[g])};a.prototype.toggleLineAttribute=function(a,b){const c=this.getCurrentLineAttributes_();this.setLineAttribute(a,a in c&&c[a]===b?!1:b)};a.prototype.setLineAttribute=function(a,b){this.updateLineAttributesForSelection(c=>{!1===b?delete c[a]:c[a]=b})};a.prototype.updateLineAttributesForSelection=function(a){var b=this.codeMirror,c=b.getCursor("start"),d=b.getCursor("end");
c=c.line;let f=d.line;b=b.getLine(f);d=this.areLineSentinelCharacters_(b.substr(0,d.ch));f>c&&d&&f--;this.updateLineAttributes(c,f,a)};a.prototype.updateLineAttributes=function(a,b,c){for(;a<=b;a++){var d=this.codeMirror.getLine(a);const b=this.codeMirror.indexFromPos({line:a,ch:0});d[0]!==u?(d={},d[t.LINE_SENTINEL]=!0,c(d),this.insertText(b,u,d)):this.updateTextAttributes(b,b+1,c,null,!0)}};a.prototype.replaceText=function(a,b,c,d,f){this.changeId_++;const g="cmrt-"+this.changeId_;this.outstandingChanges_[g]=
{origOrigin:f,attributes:d};d=this.codeMirror;a=d.posFromIndex(a);b="number"===typeof b?d.posFromIndex(b):null;d.replaceRange(c,a,b,g)};a.prototype.insertText=function(a,b,c,d){const f=this.codeMirror,g=f.getCursor(),k="RTCMADAPTER"===d&&!f.somethingSelected()&&a===f.indexFromPos(g);this.replaceText(a,null,b,c,d);k&&f.setCursor(g)};a.prototype.removeText=function(a,b,c){const d=this.codeMirror;d.replaceRange("",d.posFromIndex(a),d.posFromIndex(b),c)};a.prototype.insertEntityAtCursor=function(a,b,
c){var d=this.codeMirror;d=d.indexFromPos(d.getCursor("head"));this.insertEntityAt(d,a,b,c)};a.prototype.insertEntityAt=function(a,c,d,f){this.insertEntity_(a,new b.Entity(c,d),f)};a.prototype.insertEntity_=function(a,b,c){this.replaceText(a,null,p,b.toAttributes(),c)};a.prototype.getAttributeSpans=function(a,b){const c=[];a=this.annotationList_.getAnnotatedSpansForSpan(new n(a,b-a));for(b=0;b<a.length;b++)c.push({length:a[b].length,attributes:a[b].annotation.attributes});return c};a.prototype.end=
function(){const a=this.codeMirror.lineCount()-1;return this.codeMirror.indexFromPos({line:a,ch:this.codeMirror.getLine(a).length})};a.prototype.getRange=function(a,b){a=this.codeMirror.posFromIndex(a);b=this.codeMirror.posFromIndex(b);return this.codeMirror.getRange(a,b)};a.prototype.initAnnotationList_=function(){const a=this.end();0!==a&&this.annotationList_.insertAnnotatedSpan(new n(0,a),new g)};a.prototype.onAnnotationsChanged_=function(a,b){var c;const d={};this.tryToUpdateEntitiesInPlace(a,
b);for(var f=0;f<a.length;f++)({attributes:c}=a[f].annotation),t.LINE_SENTINEL in c&&(d[this.codeMirror.posFromIndex(a[f].pos).line]=!0),(c=a[f].getAttachedObject())&&c.clear();for(f=0;f<b.length;f++){({annotation:c}=b[f]);var g=t.LINE_SENTINEL in c.attributes;const k=t.ENTITY_SENTINEL in c.attributes;a=this.codeMirror.posFromIndex(b[f].pos);g?d[a.line]=!0:k?this.markEntity_(b[f]):(c=this.getClassNameForAttributes_(c.attributes),""!==c&&(g=this.codeMirror.posFromIndex(b[f].pos+b[f].length),c=this.codeMirror.markText(a,
g,{className:c}),b[f].attachObject(c)))}for(const a in d)this.dirtyLines_.push(this.codeMirror.getLineHandle(Number(a))),this.queueLineMarking_()};a.prototype.tryToUpdateEntitiesInPlace=function(a,b){let c=a.length;for(;c--;){const d=a[c];let f=b.length;for(;f--;){const g=b[f];if(d.pos===g.pos&&d.annotation.attributes.ent&&d.annotation.attributes.ent===g.annotation.attributes.ent&&this.entityManager_.entitySupportsUpdate(g.annotation.attributes.ent)){a.splice(c,1);b.splice(f,1);const k=d.getAttachedObject();
k.update(g.annotation.attributes);g.attachObject(k)}}}};a.prototype.queueLineMarking_=function(){if(null==this.lineMarkTimeout_){var a=this;this.lineMarkTimeout_=setTimeout(()=>{a.lineMarkTimeout_=null;const b=[];for(var c=0;c<a.dirtyLines_.length;c++){var d=a.codeMirror.getLineNumber(a.dirtyLines_[c]);b.push(Number(d))}a.dirtyLines_=[];b.sort((a,b)=>a-b);d=-1;for(c=0;c<b.length;c++){const f=b[c];f>d&&(d=a.markLineSentinelCharactersForChangedLines_(f,f))}},0)}};a.prototype.addStyleWithCSS_=function(a){const b=
document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a));b.appendChild(c)};a.prototype.getClassNameForAttributes_=function(a){let c="";for(const g in a){var d=a[g];if(g===t.LINE_SENTINEL)b.utils.assert(!0===d,"LINE_SENTINEL attribute should be true if it exists.");else{let a=(this.options_.cssPrefix||"cmrt-")+g;if(!0!==d){g===t.FONT_SIZE&&"string"!==typeof d&&(d+="px");var f=d.toString().toLowerCase().replace(/[^a-z0-9-_]/g,
"-");a+=`-${f}`;z[g]&&(v[g]||(v[g]={}),v[g][f]||(v[g][f]=!0,f=z[g],d="function"===typeof f?f(d):`${f}: ${d}`,this.addStyleWithCSS_(`${g===t.LINE_INDENT?`pre.${a}`:`.${a}`} { ${d} }`)))}c=`${c} ${a}`}}return c};a.prototype.markEntity_=function(a){var {attributes:c}=a.annotation;c=b.Entity.fromAttributes(c);const d=this.codeMirror,f=this,g=[];for(let b=0;b<a.length;b++){var k=d.posFromIndex(a.pos+b);const f=d.posFromIndex(a.pos+b+1),m={collapsed:!0,atomic:!0,inclusiveLeft:!1,inclusiveRight:!1},n=this.createEntityHandle_(c,
a.pos),q=this.entityManager_.renderToElement(c,n);q&&(m.replacedWith=q);k=d.markText(k,f,m);g.push(k);n.setMarker(k)}a.attachObject({clear(){for(let a=0;a<g.length;a++)g[a].clear()},update(a){a=b.Entity.fromAttributes(a);for(let b=0;b<g.length;b++)f.entityManager_.updateElement(a,g[b].replacedWith)}});this.queueRefresh_()};a.prototype.queueRefresh_=function(){const a=this;this.refreshTimer_||(this.refreshTimer_=setTimeout(()=>{a.codeMirror.refresh();a.refreshTimer_=null},0))};a.prototype.createEntityHandle_=
function(a,c){function d(){if(f){const a=f.find();return a?g.codeMirror.indexFromPos(a.from):null}return c}let f=null;const g=this;return{find:d,remove:function(){const a=d();null!=a&&(g.codeMirror.focus(),g.removeText(a,a+1))},replace:function(c){const f=b.AttributeConstants.ENTITY_SENTINEL,k=`${f}_`,m=d();g.updateTextAttributes(m,m+1,b=>{for(const a in b)delete b[a];b[f]=a.type;for(const a in c)b[k+a]=c[a]})},setMarker:function(a){f=a}}};a.prototype.lineClassRemover_=function(a){const b=this.codeMirror,
c=b.getLineHandle(a);return{clear(){b.removeLineClass(c,"text",".*")}}};a.prototype.emptySelection_=function(){const a=this.codeMirror.getCursor("start"),b=this.codeMirror.getCursor("end");return a.line===b.line&&a.ch===b.ch};a.prototype.onCodeMirrorBeforeChange_=function(a,b){if("+input"===b.origin||"paste"===b.origin){a=[];for(let c=0;c<b.text.length;c++){let d=b.text[c];d=d.replace(new RegExp(`[${u}${p}]`,"g"),"");a.push(d)}b.update(b.from,b.to,a)}};a.prototype.onCodeMirrorChange_=function(a,b){if("object"===
typeof b.from){for(a=[];b;)a.push(b),b=b.next;b=a}a=this.convertCoordinateSystemForChanges_(b);const c=[];for(let b=0;b<a.length;b++){var d=a[b];const {start:f}=d,{text:k}=d,{removed:m}=d;let {origin:q}=d;if(0<m.length){const a=this.annotationList_.getAnnotatedSpansForSpan(new n(f,m.length));let b=0;for(let g=0;g<a.length;g++){const k=a[g];c.push({start:f,end:f+k.length,removedAttributes:k.annotation.attributes,removed:m.substr(b,k.length),attributes:{},text:"",origin:d.origin});b+=k.length}this.annotationList_.removeSpan(new n(f,
m.length))}0<k.length&&("+input"===d.origin||"paste"===d.origin?d=this.currentAttributes_||{}:q in this.outstandingChanges_?(d=this.outstandingChanges_[q].attributes,q=this.outstandingChanges_[q].origOrigin,delete this.outstandingChanges_[q]):d={},this.annotationList_.insertAnnotatedSpan(new n(f,k.length),new g(d)),c.push({start:f,end:f,removedAttributes:{},removed:"",text:k,attributes:d,origin:q}))}this.markLineSentinelCharactersForChanges_(b);0<c.length&&this.trigger("change",this,c)};a.prototype.convertCoordinateSystemForChanges_=
function(a){function b(a,b){return function(d){if(0>=c(d,b.from))return a(d);if(0>=c(b.to,d)){var g=d.line+b.text.length-1-(b.to.line-b.from.line);if(b.to.line<d.line)d=d.ch;else if(1>=b.text.length)d=d.ch-(b.to.ch-b.from.ch)+f(b.text);else{var k=b.text;d=d.ch-b.to.ch+k[k.length-1].length}return a({line:g,ch:d})+f(b.removed)-f(b.text)}return b.from.line===d.line?a(b.from)+d.ch-b.from.ch:a(b.from)+f(b.removed.slice(0,d.line-b.from.line))+1+d.ch}}const d=this;let g=function(a){return d.codeMirror.indexFromPos(a)};
const k=[];for(let c=a.length-1;0<=c;c--){const d=a[c];g=b(g,d);const f=g(d.from),m=d.removed.join("\n"),n=d.text.join("\n");k.unshift({start:f,end:f+m.length,removed:m,text:n,origin:d.origin})}return k};a.prototype.markLineSentinelCharactersForChanges_=function(a){let b=Number.MAX_VALUE,c=-1;for(let d=0;d<a.length;d++){const f=a[d],{line:g}=f.from;if(1<f.removed.length||0<=f.removed[0].indexOf(u))b=Math.min(b,g),c=Math.max(c,g);1<f.text.length?(b=Math.min(b,g),c=Math.max(c,g+f.text.length-1)):0<=
f.text[0].indexOf(u)&&(b=Math.min(b,g),c=Math.max(c,g))}c=Math.min(c,this.codeMirror.lineCount()-1);this.markLineSentinelCharactersForChangedLines_(b,c)};a.prototype.markLineSentinelCharactersForChangedLines_=function(a,b){if(a<Number.MAX_VALUE)for(;0<a&&this.lineIsListItemOrIndented_(a-1);)a--;if(-1<b)for(var c=this.codeMirror.lineCount();b+1<c&&this.lineIsListItemOrIndented_(b+1);)b++;c=[];const d=this.codeMirror;for(;a<=b;a++){const b=d.getLine(a);var f=d.getLineHandle(a);d.removeLineClass(f,"text",
".*");if(0<b.length)for(f=b.indexOf(u);0<=f;){const g=f;for(;f<b.length&&b[f]===u;){const b=d.findMarksAt({line:a,ch:f});for(let a=0;a<b.length;a++)b[a].isForLineSentinel&&b[a].clear();f++}this.markLineSentinelCharacters_(a,g,f,c);f=b.indexOf(u,f)}else c=[]}return b};a.prototype.markLineSentinelCharacters_=function(a,b,c,d){const f=this.codeMirror;let g=null;var k=null,m=function(){const a=k.find();return a?a.from.line:null};if(0===b){const b=this.getLineAttributes_(a),c=b[t.LIST_TYPE];let f=b[t.LINE_INDENT]||
0;for(c&&0===f&&(f=1);f>=d.length;)d.push(1);"o"===c?(g=this.makeOrderedListElement_(d[f]),d[f]++):"u"===c?(g=this.makeUnorderedListElement_(),d[f]=1):"t"===c?(g=this.makeTodoListElement_(!1,m),d[f]=1):"tc"===c&&(g=this.makeTodoListElement_(!0,m),d[f]=1);m=this.getClassNameForAttributes_(b);""!==m&&this.codeMirror.addLineClass(a,"text",m);d=d.slice(0,f+1)}d={inclusiveLeft:!0,collapsed:!0};g&&(d.replacedWith=g);k=f.markText({line:a,ch:b},{line:a,ch:c},d);k.isForLineSentinel=!0};a.prototype.makeOrderedListElement_=
function(a){return r.elt("div",`${a}.`,{class:"vceditor-list-left"})};a.prototype.makeUnorderedListElement_=function(){return r.elt("div","\u2022",{class:"vceditor-list-left"})};a.prototype.toggleTodo=function(a){const b=t.LIST_TYPE,c=this.getCurrentLineAttributes_();let d;b in c&&("t"===c[b]||"tc"===c[b])?"t"===c[b]?d="tc":"tc"===c[b]&&(d=a?"t":!1):d="t";this.setLineAttribute(b,d)};a.prototype.makeTodoListElement_=function(a,b){const c={type:"checkbox",class:"vceditor-todo-left"};a&&(c.checked=!0);
a=r.elt("input",!1,c);const d=this;r.on(a,"click",r.stopEventAnd(a=>{d.codeMirror.setCursor({line:b(),ch:1});d.toggleTodo(!0)}));return a};a.prototype.lineIsListItemOrIndented_=function(a){a=this.getLineAttributes_(a);return!1!==(a[t.LIST_TYPE]||!1)||0!==(a[t.LINE_INDENT]||0)};a.prototype.onCursorActivity_=function(){const a=this;clearTimeout(a.cursorTimeout);a.cursorTimeout=setTimeout(()=>{a.updateCurrentAttributes_()},1)};a.prototype.getCurrentAttributes_=function(){this.currentAttributes_||this.updateCurrentAttributes_();
return this.currentAttributes_};a.prototype.updateCurrentAttributes_=function(){var a=this.codeMirror,c=a.indexFromPos(a.getCursor("anchor"));const d=a.indexFromPos(a.getCursor("head"));a=d;if(c>d){for(;a<this.end();){c=this.getRange(a,a+1);if("\n"!==c&&c!==u)break;a++}a<this.end()&&a++}else for(;0<a;){c=this.getRange(a-1,a);if("\n"!==c&&c!==u)break;a--}c=this.annotationList_.getAnnotatedSpansForPos(a);this.currentAttributes_={};a={};0<c.length&&!(t.LINE_SENTINEL in c[0].annotation.attributes)?a=
c[0].annotation.attributes:1<c.length&&(b.utils.assert(!(t.LINE_SENTINEL in c[1].annotation.attributes),"Cursor can't be between two line sentinel characters."),a=c[1].annotation.attributes);for(const b in a)"l"!==b&&"lt"!==b&&"li"!==b&&0!==b.indexOf(t.ENTITY_SENTINEL)&&(this.currentAttributes_[b]=a[b])};a.prototype.getCurrentLineAttributes_=function(){var a=this.codeMirror;const b=a.getCursor("anchor");a=a.getCursor("head");let {line:c}=a;0===a.ch&&b.line<a.line&&c--;return this.getLineAttributes_(c)};
a.prototype.getLineAttributes_=function(a){const c={},d=this.codeMirror.getLine(a);if(0<d.length&&d[0]===u){a=this.codeMirror.indexFromPos({line:a,ch:0});a=this.annotationList_.getAnnotatedSpansForSpan(new n(a,1));b.utils.assert(1===a.length);for(const b in a[0].annotation.attributes)c[b]=a[0].annotation.attributes[b]}return c};a.prototype.clearAnnotations_=function(){this.annotationList_.updateSpan(new n(0,this.end()),(a,b)=>new g({}))};a.prototype.newline=function(){const a=this.codeMirror,b=this;
if(this.emptySelection_()){const c=a.getCursor("head").line,d=this.getLineAttributes_(c),f=d[t.LIST_TYPE];f&&1===a.getLine(c).length?this.updateLineAttributes(c,c,a=>{delete a[t.LIST_TYPE];delete a[t.LINE_INDENT]}):(a.replaceSelection("\n","end","+input"),this.updateLineAttributes(c+1,c+1,a=>{for(const b in d)a[b]=d[b];"tc"===f&&(a[t.LIST_TYPE]="t");b.trigger("newLine",{line:c+1,attr:a})}))}else a.replaceSelection("\n","end","+input")};a.prototype.deleteLeft=function(){const a=this.codeMirror,b=a.getCursor("head");
var c=this.getLineAttributes_(b.line);const d=c[t.LIST_TYPE];c=c[t.LINE_INDENT];const f=this.emptySelection_()&&1===b.ch;f&&d?this.updateLineAttributes(b.line,b.line,a=>{delete a[t.LIST_TYPE];delete a[t.LINE_INDENT]}):f&&c&&0<c?this.updateLineAttributes(b.line,b.line,a=>{a[t.LINE_INDENT]--}):a.deleteH(-1,"char")};a.prototype.deleteRight=function(){const a=this.codeMirror,b=a.getCursor("head");var c=a.getLine(b.line);c=this.areLineSentinelCharacters_(c);const d=b.line+1<a.lineCount()?a.getLine(b.line+
1):"";this.emptySelection_()&&c&&d[0]===u?a.replaceRange("",{line:b.line,ch:0},{line:b.line+1,ch:0},"+input"):a.deleteH(1,"char")};a.prototype.indent=function(){this.updateLineAttributesForSelection(a=>{const b=a[t.LIST_TYPE];a[t.LINE_INDENT]?a[t.LINE_INDENT]++:a[t.LINE_INDENT]=b?2:1})};a.prototype.unindent=function(){this.updateLineAttributesForSelection(a=>{const b=a[t.LINE_INDENT];b&&1<b?a[t.LINE_INDENT]=b-1:(delete a[t.LIST_TYPE],delete a[t.LINE_INDENT])})};a.prototype.getText=function(){return this.codeMirror.getValue().replace(new RegExp(u,
"g"),"")};a.prototype.areLineSentinelCharacters_=function(a){for(let b=0;b<a.length;b++)if(a[b]!==u)return!1;return!0};g.prototype.equals=function(a){if(!(a instanceof g))return!1;let b;for(b in this.attributes)if(a.attributes[b]!==this.attributes[b])return!1;for(b in a.attributes)if(a.attributes[b]!==this.attributes[b])return!1;return!0};return a}();b=b||{};b.RichTextCodeMirrorAdapter=b.Client;b=b||{};b.Formatting=function(){function a(b){if(!(this instanceof a))return new a(b);this.attributes=b||
{}}const c=b.AttributeConstants;a.prototype.cloneWithNewAttribute_=function(b,c){const d={};for(const a in this.attributes)d[a]=this.attributes[a];!1===c?delete d[b]:d[b]=c;return new a(d)};a.prototype.bold=function(a){return this.cloneWithNewAttribute_(c.BOLD,a)};a.prototype.italic=function(a){return this.cloneWithNewAttribute_(c.ITALIC,a)};a.prototype.underline=function(a){return this.cloneWithNewAttribute_(c.UNDERLINE,a)};a.prototype.strike=function(a){return this.cloneWithNewAttribute_(c.STRIKE,
a)};a.prototype.font=function(a){return this.cloneWithNewAttribute_(c.FONT,a)};a.prototype.fontSize=function(a){return this.cloneWithNewAttribute_(c.FONT_SIZE,a)};a.prototype.color=function(a){return this.cloneWithNewAttribute_(c.COLOR,a)};a.prototype.backgroundColor=function(a){return this.cloneWithNewAttribute_(c.BACKGROUND_COLOR,a)};return a}();b=b||{};b.Text=function(){function a(c,f){if(!(this instanceof a))return new a(c,f);this.text=c;this.formatting=f||b.Formatting()}return a}();b.LineFormatting=
c.LineFormatting;b.Line=function(){function a(c,f){if(!(this instanceof a))return new a(c,f);"[object Array]"!==Object.prototype.toString.call(c)&&(c="undefined"===typeof c?[]:[c]);this.textPieces=c;this.formatting=f||b.LineFormatting()}return a}();b.ParseHtml=c.ParseHtml;b.SerializeHtml=c.SerializeHtml;b.textPiecesToInserts=function(a,c){function d(c,d){c instanceof b.Text&&(d=c.formatting.attributes,c=c.text);k.push({string:c,attributes:d});a="\n"===c[c.length-1]}function g(c){a&&d(b.sentinelConstants.LINE_SENTINEL_CHARACTER,
c.formatting.attributes);for(let a=0;a<c.textPieces.length;a++)d(c.textPieces[a]);d("\n")}const k=[];for(let a=0;a<c.length;a++)c[a]instanceof b.Line?g(c[a]):d(c[a]);return k};b=b||{};b.Vceditor=function(a){function d(a,b,g,k){if(!(this instanceof d))return new d(a,b,g,k);if(!q&&!A)throw Error("Couldn't find CodeMirror or ACE.  Did you forget to include codemirror.js or ace.js?");if(q&&b instanceof q)this.codeMirror_=this.editor_=b,a=this.codeMirror_.getValue();else if(A&&b&&b.session instanceof A.EditSession){if(this.ace_=
this.editor_=b,a=this.ace_.getValue(),""!==a)throw Error("Can't initialize Vceditor with an ACE instance that already contains text.");}else this.codeMirror_=this.editor_=new q(b);a=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.vcEditorWrapper_=p.elt("div",null,{class:"vceditor"});a.parentNode.replaceChild(this.vcEditorWrapper_,a);this.vcEditorWrapper_.appendChild(a);p.on(a,"dragstart",p.stopEvent);this.editor_.vceditor=this;this.options_=g||{};this.getOption("richTextShortcuts",
!1)&&(q.keyMap.richtext||this.initializeKeyMap_(),this.codeMirror_.setOption("keyMap","richtext"),this.vcEditorWrapper_.className+=" vceditor-richtext");this.imageInsertionUI=this.getOption("imageInsertionUI",!0);this.getOption("richTextToolbar",!1)&&(this.addToolbar_(),this.vcEditorWrapper_.className+=" vceditor-richtext vceditor-with-toolbar",virtualclass.editorRich.initAttachTool());this.addPoweredByLogo_();this.codeMirror_&&this.codeMirror_.refresh();this.getOption("userColor",f("JqrwCaZm29-CLg-Pfz2"));
this.entityManager_=new v;({revision:a}=k);b=[];this.codeMirror_?(this.richTextCodeMirror_=new n(this.codeMirror_,this.entityManager_,{cssPrefix:"vceditor-"}),this.editorAdapter_=new m(this.richTextCodeMirror_)):this.editorAdapter_=new t(this.ace_);Object.prototype.hasOwnProperty.call(g,"richTextToolbar")?(virtualclass.editorRich.vcAdapter=new otAdapter(k,"EditorRich"),virtualclass.editorRich.cmClient=new z(a,b,virtualclass.editorRich.vcAdapter,this.editorAdapter_)):(virtualclass.editorCode.vcAdapter=
new otAdapter(k,"EditorCode"),virtualclass.editorCode.cmClient=new z(a,b,virtualclass.editorCode.vcAdapter,this.editorAdapter_));"Microsoft Internet Explorer"===navigator.appName&&navigator.userAgent.match(/MSIE 8\./)&&(c.onload=function(){const a=document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css";b.styleSheet.cssText=":before,:after{content:none !important;}";a.appendChild(b);setTimeout(()=>{a.removeChild(b)},0)})}function f(a){let b=1;for(let c=0;c<a.length;c++)b=
17*(b+a.charCodeAt(c))%360;return k(b/360,1,.85)}function g(a,b,c){function d(a){a=Math.round(255*a).toString(16);return 1===a.length?`0${a}`:a}return`#${d(a)}${d(b)}${d(c)}`}function k(a,b,c){if(0===b)return g(c,c,c);const d=.5>c?c*(1+b):c+b-b*c,f=2*c-d;b=function(a){0>a&&(a+=1);1<a&&--a;return 1>6*a?f+6*(d-f)*a:1>2*a?d:2>3*a?f+6*(d-f)*(2/3-a):f};return g(b(a+1/3),b(a),b(a-1/3))}if(!b.RichTextCodeMirrorAdapter)throw Error("Oops! It looks like you're trying to include lib/vceditor.js directly.  This is actually one of many source files that make up vceditor.  You want dist/vceditor.js instead.");
const {RichTextCodeMirrorAdapter:m}=b,{RichTextCodeMirror:n}=b,{RichTextToolbar:r}=b,{ACEAdapter:t}=b,{EditorClient:z}=b,{EntityManager:v}=b,u=b.AttributeConstants,{utils:p}=b,{CodeMirror:q}=a,{ace:A}=a;p.makeEventEmitter(d);d.fromCodeMirror=d;d.fromACE=d;d.prototype.dispose=function(){this.zombie_=!0;const a=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.vcEditorWrapper_.removeChild(a);this.vcEditorWrapper_.parentNode.replaceChild(a,this.vcEditorWrapper_);this.editor_.vceditor=
null;this.codeMirror_&&"richtext"===this.codeMirror_.getOption("keyMap")&&this.codeMirror_.setOption("keyMap","default");this.vcAdapter.dispose();this.editorAdapter_.detach();this.richTextCodeMirror_&&this.richTextCodeMirror_.detach()};d.prototype.setUserId=function(a){this.vcAdapter.setUserId(a)};d.prototype.setUserColor=function(a){this.vcAdapter.setColor(a)};d.prototype.getText=function(){this.assertReady_("getText");return this.codeMirror_?this.richTextCodeMirror_.getText():this.ace_.getSession().getDocument().getValue()};
d.prototype.setText=function(a){if(this.ace_)return this.ace_.getSession().getDocument().setValue(a);this.codeMirror_.getWrapperElement().setAttribute("style","display: none");this.codeMirror_.setValue("");this.insertText(0,a);this.codeMirror_.getWrapperElement().setAttribute("style","");this.codeMirror_.refresh()};d.prototype.insertTextAtCursor=function(a){this.insertText(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),a)};d.prototype.insertText=function(a,c){p.assert(!this.ace_,"Not supported for ace yet.");
this.assertReady_("insertText");"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]);c=b.textPiecesToInserts(0===a,c);for(let b=0;b<c.length;b++){const {string:d}=c[b],{attributes:f}=c[b];this.richTextCodeMirror_.insertText(a,d,f);a+=d.length}};d.prototype.getOperationForSpan=function(a,c){const d=this.richTextCodeMirror_.getRange(a,c);a=this.richTextCodeMirror_.getAttributeSpans(a,c);c=0;const f=new b.TextOperation;for(let b=0;b<a.length;b++)f.insert(d.substr(c,a[b].length),a[b].attributes),
c+=a[b].length;return f};d.prototype.getHtml=function(){return this.getHtmlFromRange(null,null)};d.prototype.getHtmlFromSelection=function(){var a=this.codeMirror_.getCursor("start"),b=this.codeMirror_.getCursor("end");a=this.codeMirror_.indexFromPos(a);b=this.codeMirror_.indexFromPos(b);return this.getHtmlFromRange(a,b)};d.prototype.getHtmlFromRange=function(a,c){a=null!=a&&null!=c?this.getOperationForSpan(a,c):this.getOperationForSpan(0,this.codeMirror_.getValue().length);return b.SerializeHtml(a,
this.entityManager_)};d.prototype.insertHtml=function(a,c){c=b.ParseHtml(c,this.entityManager_);this.insertText(a,c)};d.prototype.insertHtmlAtCursor=function(a){this.insertHtml(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),a)};d.prototype.setHtml=function(a){a=b.ParseHtml(a,this.entityManager_);this.setText(a)};d.prototype.isHistoryEmpty=function(){this.assertReady_("isHistoryEmpty");return this.vcAdapter.isHistoryEmpty()};d.prototype.bold=function(){this.richTextCodeMirror_.toggleAttribute(u.BOLD);
this.codeMirror_.focus()};d.prototype.italic=function(){this.richTextCodeMirror_.toggleAttribute(u.ITALIC);this.codeMirror_.focus()};d.prototype.underline=function(){this.richTextCodeMirror_.toggleAttribute(u.UNDERLINE);this.codeMirror_.focus()};d.prototype.strike=function(){this.richTextCodeMirror_.toggleAttribute(u.STRIKE);this.codeMirror_.focus()};d.prototype.fontSize=function(a){this.richTextCodeMirror_.setAttribute(u.FONT_SIZE,a);this.codeMirror_.focus()};d.prototype.font=function(a){this.richTextCodeMirror_.setAttribute(u.FONT,
a);this.codeMirror_.focus()};d.prototype.color=function(a){this.richTextCodeMirror_.setAttribute(u.COLOR,a);this.codeMirror_.focus()};d.prototype.highlight=function(){this.richTextCodeMirror_.toggleAttribute(u.BACKGROUND_COLOR,"rgba(255,255,0,.65)");this.codeMirror_.focus()};d.prototype.align=function(a){if("left"!==a&&"center"!==a&&"right"!==a)throw Error('align() must be passed "left", "center", or "right".');this.richTextCodeMirror_.setLineAttribute(u.LINE_ALIGN,a);this.codeMirror_.focus()};d.prototype.orderedList=
function(){this.richTextCodeMirror_.toggleLineAttribute(u.LIST_TYPE,"o");this.codeMirror_.focus()};d.prototype.unorderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(u.LIST_TYPE,"u");this.codeMirror_.focus()};d.prototype.todo=function(){this.richTextCodeMirror_.toggleTodo();this.codeMirror_.focus()};d.prototype.newline=function(){this.richTextCodeMirror_.newline()};d.prototype.deleteLeft=function(){this.richTextCodeMirror_.deleteLeft()};d.prototype.deleteRight=function(){this.richTextCodeMirror_.deleteRight()};
d.prototype.indent=function(){this.richTextCodeMirror_.indent();this.codeMirror_.focus()};d.prototype.unindent=function(){this.richTextCodeMirror_.unindent();this.codeMirror_.focus()};d.prototype.undo=function(){this.codeMirror_.undo()};d.prototype.redo=function(){this.codeMirror_.redo()};d.prototype.insertEntity=function(a,b,c){this.richTextCodeMirror_.insertEntityAtCursor(a,b,c)};d.prototype.insertEntityAt=function(a,b,c,d){this.richTextCodeMirror_.insertEntityAt(a,b,c,d)};d.prototype.registerEntity=
function(a,b){this.entityManager_.register(a,b)};d.prototype.getOption=function(a,b){return a in this.options_?this.options_[a]:b};d.prototype.assertReady_=function(a){if(!this.ready_)throw Error(`You must wait for the "ready" event before calling ${a}.`);if(this.zombie_)throw Error("You can't use a Vceditor after calling dispose()!");};d.prototype.makeImageDialog_=function(){this.makeDialog_("img",virtualclass.lang.getString("InsertimageURL"))};d.prototype.makeDialog_=function(a,b){const c=this;
b=p.elt("input",null,{class:"vceditor-dialog-input",id:a,type:"text",placeholder:b,autofocus:"autofocus"});var d=p.elt("a","Submit",{class:"vceditor-btn",id:"submitbtn"});p.on(d,"click",p.stopEventAnd(function(){const b=document.getElementById("overlay");b.style.visibility="hidden";const d=document.getElementById(a).value;d&&c.insertEntity(a,{src:d});c.vcEditorWrapper_.removeChild(b)}));const f=p.elt("a","Cancel",{class:"vceditor-btn"});p.on(f,"click",p.stopEventAnd(function(){const a=document.getElementById("overlay");
a.style.visibility="hidden";c.vcEditorWrapper_.removeChild(a)}));d=p.elt("div",[d,f],{class:"vceditor-btn-group"});b=p.elt("div",[b,d],{class:"vceditor-dialog-div"});b=p.elt("div",[b],{class:"vceditor-dialog",id:"overlay"});this.vcEditorWrapper_.appendChild(b)};d.prototype.addToolbar_=function(){this.toolbar=new r(this.imageInsertionUI);this.toolbar.on("undo",this.undo,this);this.toolbar.on("redo",this.redo,this);this.toolbar.on("bold",this.bold,this);this.toolbar.on("italic",this.italic,this);this.toolbar.on("underline",
this.underline,this);this.toolbar.on("strike",this.strike,this);this.toolbar.on("font-size",this.fontSize,this);this.toolbar.on("font",this.font,this);this.toolbar.on("color",this.color,this);this.toolbar.on("left",function(){this.align("left")},this);this.toolbar.on("center",function(){this.align("center")},this);this.toolbar.on("right",function(){this.align("right")},this);this.toolbar.on("ordered-list",this.orderedList,this);this.toolbar.on("unordered-list",this.unorderedList,this);this.toolbar.on("todo-list",
this.todo,this);this.toolbar.on("indent-increase",this.indent,this);this.toolbar.on("indent-decrease",this.unindent,this);this.toolbar.on("insert-image",this.makeImageDialog_,this);this.vcEditorWrapper_.insertBefore(this.toolbar.element(),this.vcEditorWrapper_.firstChild)};d.prototype.addPoweredByLogo_=function(){};d.prototype.initializeKeyMap_=function(){function a(a){return function(b){setTimeout(()=>{a.call(b.vceditor)},0)}}this.getOption("readOnly")?q.keyMap.richtext={fallthrough:["default"]}:
q.keyMap.richtext={"Ctrl-B":a(this.bold),"Cmd-B":a(this.bold),"Ctrl-I":a(this.italic),"Cmd-I":a(this.italic),"Ctrl-U":a(this.underline),"Cmd-U":a(this.underline),"Ctrl-H":a(this.highlight),"Cmd-H":a(this.highlight),Enter:a(this.newline),Delete:a(this.deleteRight),Backspace:a(this.deleteLeft),Tab:a(this.indent),"Shift-Tab":a(this.unindent),fallthrough:["default"]}};return d}(c);b.Vceditor.Formatting=b.Formatting;b.Vceditor.Text=b.Text;b.Vceditor.Entity=b.Entity;b.Vceditor.LineFormatting=b.LineFormatting;
b.Vceditor.Line=b.Line;b.Vceditor.TextOperation=b.TextOperation;b.Vceditor.RichTextCodeMirrorAdapter=b.RichTextCodeMirrorAdapter;b.Server=Server;b.Vceditor.getvcEditor=function(){return b};return b.Vceditor}(window);window.Vceditor=Vceditor;(function(c){const b=function(a){return a.map(a=>({operation:a.wrapped.toJSON()}))},a=function(a){const b=Vceditor.getvcEditor();return a.map(a=>new b.WrappedOperation(b.TextOperation.fromJSON(a.operation),a.cursor&&b.Cursor.fromJSON(a.cursor)))};c.editor=function(d,f,g){this.etype=d;let k,m;"editorRich"===d?(k={lineWrapping:!0},m={richTextToolbar:!0,richTextShortcuts:!0,readOnly:!1}):(k={lineNumbers:!0,mode:"markdown",readOnly:!1},m={defaultText:"Markdown Editor "});return{etype:d,cm:"",vcAdapter:"",
initialised:!1,prvEdRev:0,dataReqTry:0,stroageData:localStorage.getItem(`${this.etype}_allEditorOperations`),tempstroageDataRev:localStorage.getItem(`${this.etype}_edOperationRev`),readonly:!1,editorStatus:!1,init(a,b,c,d){virtualclass.userInteractivity.makeReadyContext();const f={};"undefined"!==typeof a&&(f.revision=a);"undefined"!==typeof b&&(f.clients=b);"undefined"!==typeof c&&(f.doc=c);"undefined"!==typeof d&&(f.operations=d);this.cm||"object"===typeof this.cm?virtualclass.dispvirtualclassLayout(virtualclass.currApp):
(this.codemirrorWithLayout(k),this.createEditorClient(m,f));roles.hasControls()&&this.createAllEditorController();roles.hasControls()&&!virtualclass.gObj.studentSSstatus.sharing&&ioAdapter.mustSendAll({eddata:"init",et:this.etype,cf:"eddata"})},createAllEditorController(){const a=this.etype,b=`all${a}Container`;if(null==document.getElementById(b)){let f;var c=virtualclass.getTemplate("edenableall","editor")({type1:a}),d=`#virtualclass${virtualclass.vutil.capitalizeFirstLetter(a)}Body`;document.querySelector(d).insertAdjacentHTML("beforeend",
c);c=document.getElementById(`${b}Anch`);d=this.editorStatus;null!==d&&(virtualclass.editorRich.collborateToolStatus?virtualclass.editorRich.disableCollaborateTool():"disable"===d&&(c.dataset.action="disable"));c.addEventListener("click",()=>{let c=document.getElementById(`${b}Anch`);null!==c&&(f=c.dataset.action,"enable"===c.dataset.action?virtualclass.editorRich.disableCollaborateTool():virtualclass.editorRich.enableCollaborateTool());virtualclass.editorRich.editorStatus=c.dataset.action;virtualclass.user.control.toggleAllEditorController.call(virtualclass.user,
a,f)})}},disableCollaborateTool(){console.log("showing enable editor controller");const a=document.getElementById("alleditorRichContainerAnch");a.dataset.action="disable";a.classList.remove("icon-collaboratecrose");a.classList.add("icon-collaborate");a.parentNode.setAttribute("data-title",virtualclass.lang.getString("offcollaboration"))},enableCollaborateTool(){const a=document.getElementById("alleditorRichContainerAnch");a.classList.remove("icon-collaborate");a.classList.add("icon-collaboratecrose");
a.dataset.action="enable";a.parentNode.setAttribute("data-title",virtualclass.lang.getString("oncollaboration"))},removeScrollFromFireFox(a){a=virtualclass.vutil.capitalizeFirstLetter(a);setTimeout(()=>{const b=document.querySelector(`#virtualclass${a}Body .CodeMirror-vscrollbar`),c=document.querySelector(`#virtualclass${a}Body .CodeMirror`),d=document.querySelector(`#virtualclass${a}Body .CodeMirror-code`);b.style.display=d.offsetHeight>c.offsetHeight-25?"block":""},20)},createEditorClient(a,b){roles.hasAdmin()&&
(this.cm.setOption("readOnly",!1),this.createAllEditorController(),a.readOnly=!1);virtualclass.isPlayMode&&(this.readOnlyMode("enable","notCreateSyncBox"),this.cm.setOption("readOnly","nocursor"));Vceditor.fromCodeMirror({},this.cm,a,b);"Firefox"===virtualclass.system.mybrowser.detection()[0]&&this.removeScrollFromFireFox(this.etype)},disableEditorByOuterLayer(){var a=virtualclass.vutil.capitalizeFirstLetter(this.etype);a=document.querySelector(`#virtualclass${a}Body .CodeMirror.cm-s-default`);null!=
a&&(a.style.pointerEvents="none")},enableEditorByOuterLayer(){var a=virtualclass.vutil.capitalizeFirstLetter(this.etype);a=document.querySelector(`#virtualclass${a}Body .CodeMirror.cm-s-default`);null!=a&&(a.style.pointerEvents="visible")},codemirrorWithLayout(a){this.UI.container(this.etype);document.getElementById(this.UI.edId);"object"!==typeof this.cm&&(this.cm=CodeMirror(document.getElementById(this.UI.edId),a))},requestData(){const a=virtualclass.vutil.whoIsTeacher();this.readOnlyMode("enable");
ioAdapter.mustSendUser({eddata:"requestForEditorData",et:this.etype,cf:"eddata"},a)},readOnlyMode(a,b){"object"===typeof this.cm&&("enable"===a?this.readonly||(this.cm.setOption("readOnly","nocursor"),"undefined"===typeof b&&this.UI.createSynchMessageBox(),this.readonly="nocursor"):this.readonly&&!virtualclass.isPlayMode&&(this.cm.setOption("readOnly",!1),this.readonly=!1,this.UI.hideSynchMessageBox()),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(virtualclass.vutil.smallizeFirstLetter(this.etype)))},
isVcAdapterIsReady(a){return Object.prototype.hasOwnProperty.call(virtualclass[a],"vcAdapter")&&"object"===typeof virtualclass[a].vcAdapter},receivedOperations:{currAppEditor(a){a.fromUser.userid!=virtualclass.gObj.userid&&(virtualclass.currAppEditor=!0,virtualclass.currAppEditorType=a.message.et,virtualclass.dispvirtualclassLayout(virtualclass.currAppEditorType))},init(a,b){"s"===a.fromUser.role||a.fromUser.userid===virtualclass.gObj.uid&&1!==wbUser.virtualclassPlay&&virtualclass.config.makeWebSocketReady||
virtualclass.makeAppReady({app:b})},initVcEditor(a){roles.hasView()&&"function"===typeof virtualclass[a.message.et].vcAdapter.removeOperations&&virtualclass[a.message.et].vcAdapter.removeOperations(a);if(!roles.hasControls()||roles.hasControls()&&a.fromUser.userid!==virtualclass.gObj.uid&&(Object.prototype.hasOwnProperty.call(a.message,"resFromUser")||Object.prototype.hasOwnProperty.call(a.message,"allEdData"))){const b=JSON.parse(a.message.data);Object.prototype.hasOwnProperty.call(a.message,"layoutEd")?
this.initialiseDataWithEditor(b,a.message):this.initialiseDataWithEditor(b)}},requestForEditorData(a){a.fromUser.userid!==virtualclass.gObj.uid&&("object"!==typeof this.vcAdapter||0===this.vcAdapter.operations.length?ioAdapter.mustSendAll({eddata:"noDataForEditor",cf:"eddata"}):this.responseToRequest(a.fromUser.userid))},noDataForEditor(){roles.hasControls()},"virtualclass-editor-operation":function(a){"object"===typeof this.vcAdapter&&(this.readOnlyMode("disable"),this.vcAdapter.receivedMessage(a))},
"virtualclass-editor-cursor":function(a){"object"===typeof this.vcAdapter&&this.vcAdapter.receivedMessage(a)},select(){"object"===typeof this.vcAdapter&&this.vcAdapter.receivedMessage(e)}},onmessage(a,b){this.receivedOperations[a.message.eddata].call(this,a,b);"object"!==typeof this.vcAdapter&&roles.hasAdmin()&&"virtualclass-editor-operation"===a.message.eddata&&(virtualclass.makeAppReady({app:b}),this.vcAdapter.receivedMessage(a,onmessage))},UI:{id:f,class:"vmApp virtualclass",edId:g,container(a){null==
document.getElementById(this.id)&&(a=virtualclass.getTemplate("editorrich","editor")({type:virtualclass.vutil.capitalizeFirstLetter(a),class:a}),virtualclass.vutil.insertAppLayout(a))},createSynchMessageBox(){if(null!=document.getElementById("synchMessageBox"))this.showSynchMessageBox();else{const a=virtualclass.getTemplate("messagebox","editor")();document.getElementById(this.id).insertAdjacentHTML("afterbegin",a)}},showSynchMessageBox(){const a=document.getElementById("synchMessageBox");null!=a&&
(a.style.display="block")},hideSynchMessageBox(){const a=document.getElementById("synchMessageBox");null!=a&&(a.style.display="none")}},responseToRequest(a){const b=this.getWrappedOperations(!0);b.layoutEd="1";roles.isTeacher()&&(b.capp=virtualclass.currApp);b.et=this.etype;a?(b.resFromUser=!0,ioAdapter.mustSendUser(b,a)):(b.allEdData=!0,virtualclass[b.et].vcAdapter.removeOperations({message:{et:b.et}}),a=JSON.parse(b.data),virtualclass[b.et].initialiseDataWithEditor(a),virtualclass[b.et].vcAdapter.myOTrequestData=
0,"EditorRich"===virtualclass.currApp&&ioAdapter.mustSend(b))},isEidtorWithTeacher(){return roles.hasControls()&&("EditorRich"===virtualclass.currApp||"EditorCode"===virtualclass.currApp)},getWrappedOperations(a){a=this.vcAdapter&&this.vcAdapter.operations?b(this.vcAdapter.operations):[];return{eddata:"initVcEditor",data:JSON.stringify({operations:a}),et:this.etype,cf:"eddata"}},getStudentAllText(){return this.cm.getValue("\n")},removeCodeMirror(){this.readonly=!1;const a=document.getElementById(this.UI.id);
null!=a&&a.parentNode.removeChild(a);this.cm=""},setReadMode(){var a=this.editorStatus;if(!roles.hasAdmin()){null!=a?a?(this.cm.setOption("readOnly",!1),a=!0):(this.cm.setOption("readOnly","nocursor"),a=!1):(this.cm.setOption("readOnly","nocursor"),a=!1);const b=virtualclass.vutil.capitalizeFirstLetter(this.etype);virtualclass.user.control.toggleDisplayWriteModeMsgBox(b,a);virtualclass.vutil.setReadModeWhenTeacherIsDisConn(virtualclass.vutil.smallizeFirstLetter(this.etype))}},writeBulkDocs(b){const c=
a(b.operations);b.revision=0;if(this.cm){if(this.cm.getValue()!==b.str||""===b.str)this.vcAdapter=this.cmClient="",b.operations=[],b.doc="";this.createEditorClient(m,b);this.prvEdRev=b.revision}for(b=0;b<c.length;b++)virtualclass[this.etype].vcAdapter.server.receiveOperation(b,c[b]),this.vcAdapter.trigger("operation",c[b].wrapped.toJSON())},initialiseDataWithEditor(b,c){a(b.operations);"undefined"!==typeof c&&Object.prototype.hasOwnProperty.call(c,"capp")&&(virtualclass.currApp=virtualclass.vutil.capitalizeFirstLetter(c.capp));
this.removeCodeMirror();this.codemirrorWithLayout(k);virtualclass.dispvirtualclassLayout(virtualclass.currApp);this.writeBulkDocs(b);this.cm.refresh();this.setReadMode();b=virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp);"EditorRich"===b||"EditorCode"===b?virtualclass.previous=`virtualclass${virtualclass.currApp}`:(b=document.getElementById("virtualclassEditorRich"),null!=b&&(b.style.display="none"),b=document.getElementById("virtualclassEditorCode"),null!=b&&(b.style.display="none"));
b=document.getElementById("virtualclassEditorTool");null!=b&&(b.style.pointerEvents="visible");otAdapter.myrequestData=0},removeEditorData(){"object"===typeof this.cm&&("object"===typeof this.vcAdapter&&(this.vcAdapter.operations.length=0),this.removeCodeMirror(),localStorage.removeItem(`${this.etype}_allEditorOperations`),localStorage.removeItem(`${this.etype}_edOperationRev`))},saveIntoLocalStorage(){"object"===typeof this.vcAdapter&&0<this.vcAdapter.operations.length&&this.getWrappedOperations()},
undoManager(a){setTimeout(()=>{90===a?document.querySelector(".vceditor-tb-undo").parentNode.click():89===a&&document.querySelector(".vceditor-tb-redo").parentNode.click()},0)},initAttachTool(){const a=document.querySelector(".vceditor-btn-style-group"),b=document.querySelector(".vceditor-btn-list-group"),d=document.querySelector(".vceditor-btn-indent-group"),f=document.querySelector(".vceditor-btn-paragraph-group");a.addEventListener("mousedown",this.editorNavBar.bind(this));b.addEventListener("mousedown",
this.editorNavBar.bind(this));d.addEventListener("mousedown",this.editorNavBar.bind(this));f.addEventListener("mousedown",this.editorNavBar.bind(this));c.addEventListener("mouseup",this.editorTool.bind(this))},editorNavBar(a){if("vceditor-btn-style-group"===a.target.classList[0]||"vceditor-btn-list-group"===a.target.classList[0]||"vceditor-btn-indent-group"===a.target.classList[0]||"vceditor-btn-paragraph-group"===a.target.classList[0]){const b=document.querySelector(".vceditor-toolbar-wrapper .open"),
c=document.querySelector(`.${a.target.classList[0]}`);null!=b&&a.currentTarget.classList.contains(b.classList[0])?null!=b&&c.classList.contains("open")&&(c.classList.remove("open"),c.classList.add("close")):(virtualclass.editorRich.getEditorToolElem(),c.classList.remove("close"),c.classList.add("open"))}},editorTool(a){const b=document.querySelector("#virtualclassCont").dataset.currapp;null===b||"EditorRich"!==b||a.target.classList.contains("open")||virtualclass.editorRich.getEditorToolElem()},getEditorToolElem(){const a=
document.querySelector(".vceditor-toolbar-wrapper .open");null!=a&&(a.classList.remove("open"),a.classList.add("close"))}}}})(window);(function(c,b){c.Chat=function(){let a;return{userList:[],init(){this.chatroombox=null;this.chatWindow="private";this.counter=0;this.idList=[];this.commonChat=[];b.htab=[];b.htabIndex=[];this.vmstorage={};b("body").footerbar();a=b("#tabs").tabs({cache:!0,activeOnAdd:!0});!1===browserSupportsLocalStorage()?alert(virtualclass.lang.getString("sterror")):(this.history(),this.UI.privateChatBox.init(),b("ul.tabs").on("click, focus","li",function(){b(`li[aria-controls='${b(this).attr("id")}']`).removeClass("ui-state-highlight")}),
roles.isStudent()&&(virtualclass.settings.studentpc(virtualclass.settings.info.studentpc),virtualclass.settings.studentgc(virtualclass.settings.info.studentgc)))},fetchChatUsers(){const a=new FormData;a.append("action","fetchUser");virtualclass.xhr.vxhr.post(`${c.webapi}&user=${virtualclass.gObj.uid}&methodname=congrea_get_enrolled_users`,a).then(a=>{virtualclass.chat.userList=a.data;updateOnlineUserText()}).catch(a=>{console.error("Request failed with error ",a)})},setChatDisplay(){const a=document.querySelector("#virtualclassCont.congrea  #ta_chrm2"),
b=document.querySelector("#virtualclassCont.congrea #congreaUserSearch");var c=document.getElementById("memlist");document.getElementById("user_list");var k=localStorage.getItem("chatWindow");null!=k&&"common"===k?(virtualclass.chat.chatWindow="common",(k=document.getElementById("chatrm"))?(k.classList.add("enable"),k.classList.remove("disable"),document.getElementById("chatroom_bt2").classList.add("active"),c&&(c.classList.remove("enable"),c.classList.contains("disable")||c.classList.add("disable"),
c=document.getElementById("user_list"),c.classList.remove("active")),b&&(b.style.display="none")):c&&(c.classList.add("enable"),c.classList.remove("disable"),c=document.getElementById("user_list"),c.classList.add("active"))):null!=k&&"support"===k?(c=document.getElementById("congreaSupport"))&&c.classList.add("active"):(c&&(c.classList.add("enable"),document.getElementById("user_list"),virtualclass.chat.chatWindow="private"),a&&(a.style.display="none"));document.querySelector("#virtualclassCont.congrea  .vmchat_bar_button").classList.contains("active")?
(a&&(a.style.display="none"),b&&(b.style.display="block")):(a&&(a.style.display="block"),b&&(b.style.display="none"))},showChatListUsers(){const a=virtualclass.chat.userList;0<a.length&&(this.showChatUserList(a),displayChatOfflineUserList(a),document.querySelector("div#memlist").classList.add("enable"))},showChatUserList(a){if(!document.getElementById("chat_div")){const a=document.createElement("div");a.id="chat_div";document.body.appendChild(a)}b("#chat_div").memberlist({id:"chat_div",user:a,offset:"-1px",
title:virtualclass.lang.getString("online"),userSent(a){return b("#chat_div").memberlist("option","boxManager").addUsr(a)}})},history(){var a=null;null!=localStorage.getItem(wbUser.sid)&&(a=JSON.parse(localStorage.getItem(wbUser.sid)),displayPvtChatHistory(a),a=localStorage.getItem("chatEnable"),null!=a&&"false"===a&&virtualclass.user.control.disbaleAllChatBox(),this.vmstorage=JSON.parse(localStorage.getItem(wbUser.sid)));0<localStorage.length&&(displaycomChatHistory(),virtualclass.chat.removeChatHighLight("chatrm"),
null!=a&&"false"===a&&virtualclass.user.control.disableCommonChat())},exportCommonChat(a){const b=[],c=virtualclass.chat.commonChat;for(let d=0;d<c.length;d++)a<=c[d].time&&b.push(c[d]);return b},UI:{privateChatBox:{init(){b("#tabs").delegate("span.icon-close","click",this.close);b("#tabs").on("click","li a",this.toggle)},close(){var a=b(this).closest("li").attr("id").substring(5);b(`#${a}`).chatbox("option").boxClosed(a);b(`div#cb${a}.ui-widget`).hide();a=b(this).closest("li").remove().attr("aria-controls");
b(`#${a}`).remove()},toggle(){const a=b(this).closest("li").attr("id").substring(5);b(`#${a}`).chatbox("toggleContentbox");"hidden"===localStorage.getItem(a)?localStorage.removeItem(a):localStorage.setItem(a,"hidden")}}},removedPrvLoggedInDetail(){b(".ui-memblist").remove();b(".ui-chatbox").remove();b("div#chatrm").remove();virtualclass.chat.chatroombox=null;for(const a in io.uniquesids)a!=io.cfg.userid&&(chatboxManager.delBox(a),b(`li#tabcb${a}`).remove());this.idList=0;b("#stickybar").removeClass("maximize").addClass("minimize");
a.tabs("refresh")},removeCookieUserInfo(a){document.cookie="auth_user=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";document.cookie="auth_pass=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";document.cookie="path=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";virtualclass.ioEventApi.Unauthenticated()},makeUserListEmpty(){const a=`url(${c.whiteboardPath}images/offline.png)no-repeat top left`;b("#user_list .inner_bt #usertab_icon").css({background:a});b("#chatroom_bt .inner_bt #chatroom_text").text(`${virtualclass.lang.chatroom} (0)`);
b("div#memlist").removeClass("enable")},removeChatHighLight(a){if(Object.prototype.hasOwnProperty.call(virtualclass.gObj,"testChatDiv")){a=chatContainerEvent.elementFromShadowDom(".ui-state-highlight","all");for(let b=0;b<a.length;b++)a[b].classList.remove("ui-state-highlight")}},openChatBox(){const a=document.querySelector("#memlist");null!=a&&(0<a.offsetWidth||0<a.offsetHeight||b("#chat_div").memberlist("option","boxManager").toggleBox())},enableTechSupport(a){const b=document.querySelector("#congreaSupport");
b.setAttribute("data-tsid",a);b.classList.remove("notavailable");b.classList.add("available")},disableTechSupport(a){const b=document.querySelector("#congreaSupport");b.classList.add("notavailable");b.classList.remove("available");a=document.querySelector(`#tabcb${a} .icon-close`);null!=a&&a.click()},removeCommonChatNodes(){const a=document.getElementById("chat_room");if(null!==a)for(;a.firstChild;)a.removeChild(a.firstChild)},calculateViewPortForMessageBox(){var a=document.querySelectorAll("#tabs .ui-widget.ui-chatbox");
if(null!=a){var b=0;let c=0;for(;c<a.length;c++)b+=a[c].offsetWidth;a=document.getElementById("virtualclassAppContainer").offsetWidth;b>a&&(b=document.querySelector("#tabs .ui-widget.ui-chatbox"),null!=b&&(b=b.querySelector("span.icon-close"),null!=b&&b.parentNode.click()))}}}}})(window,$);(function(c){c.widget("ui.footerbar",{options:{id:null,offset:0,width:"100%",barscroll:c(window).width()-430,supportId:"7",boxClosed(b){}},init(b){this.elem=b},widget(){return this.uiFooterbar},_create(){function b(){const b=[];virtualclass.connectedUsers.forEach(a=>{a.userid!==virtualclass.gObj.uid&&(a={id:a.userid,name:a.name.toLowerCase()},b.push(a))});const c=document.getElementById("congreaUserSearch").value;a(b,c.toLowerCase())}function a(a,b){a.forEach((a,c)=>{c=chatContainerEvent.elementFromShadowDom(`ml${a.id}`,
null,!0);-1!==a.name.indexOf(b)?c.style.display="block":c.style.display="none"})}var d=roles.hasAdmin();const f=virtualclass.getTemplate("stickycont","chat");c("#stickycontainer").append(f({control:d}));const g=document.getElementById("chatroom_bt2"),k=document.getElementById("user_list"),m=document.querySelector("#appSettingCtrl"),n=document.querySelector("#virtualclassCont.congrea #appSettingDetail"),r=document.querySelector("#virtualclassCont.congrea #chatWidget");document.querySelector("#virtualclassCont.congrea #techVideo");
document.querySelector("#virtualclassAppRightPanel");const t=document.querySelector("#virtualclassApp");d=document.querySelector("#stickycontainer ul.chatBarTab");document.querySelector("#virtualclassCont.congrea #congAskQuestion");d.addEventListener("click",a=>{t.classList.contains("collapsedRightbar")&&"congAskQuestion"!==a.target.id&&(virtualclass.rightbar.handleRightBar("open"),virtualclass.chat.calculateViewPortForMessageBox())});c("#chatroom_bt2 .inner_bt").click(()=>{virtualclass.vutil.sendSpeedByMobile(3);
virtualclass.rightbar.handleDisplayRightBar("#chatWidget");virtualclass.rightbar.handleDisplayBottomRightBar(g);m.classList.contains("settingActive")&&(m.classList.remove("settingActive"),m.classList.add("chatActive"));r.classList.contains("active")||r.classList.add("active");n.classList.remove("active");n.classList.contains("deactive")||n.classList.add("deactive");c("#chatroom_bt2").removeClass("ui-state-highlight");virtualclass.chat.chatWindow="common";if(0===c("ul#chat_room").length){var a=document.createElement("ul");
a.id="chat_room";document.body.appendChild(a);virtualclass.chat.chatroombox=c("#chat_room").chatroom({id:"chat_room",user:{name:"test"},title:virtualclass.lang.getString("chatroom_header"),messageSent(a,b){const d=a.userid||virtualclass.gObj.uid;c("#chat_room").chatroom("option","boxManager").addMsg(a.name,b,d)}});Object.prototype.hasOwnProperty.call(virtualclass.gObj,"chatEnable")&&!virtualclass.gObj.chatEnable&&(a=document.getElementById("chatrm"),null!=a&&virtualclass.user.control.makeElemDisable(a))}if(a=
document.getElementById("ta_chrm2"))a.style.display="block";if(a=document.getElementById("memlist"))a.classList.remove("enable"),a.classList.contains("disable")||a.classList.add("disable");if(a=document.getElementById("congreaUserSearch"))a.style.display="none";if(a=document.getElementById("chatrm"))a.classList.contains("enable")||a.classList.add("enable"),a.classList.remove("disable")});c("#techVideo").click(function(){virtualclass.vutil.sendSpeedByMobile(1);virtualclass.rightbar.handleDisplayBottomRightBar(document.getElementById("techVideo"))});
c("#user_list").click(function(a){virtualclass.vutil.sendSpeedByMobile(3);virtualclass.rightbar.handleDisplayRightBar("#chatWidget");virtualclass.rightbar.handleDisplayBottomRightBar(a.currentTarget);k.classList.add("active");virtualclass.rightbar.handleDisplayBottomRightBar(document.getElementById("user_list"));a=document.getElementById("chatWidget");const b=document.getElementById("appSettingDetail");m.classList.contains("settingActive")&&(m.classList.remove("settingActive"),m.classList.add("chatActive"));
a.classList.contains("active")||a.classList.add("active");b.classList.remove("active");b.classList.contains("deactive")||b.classList.add("deactive");virtualclass.chat.chatWindow="private";this.classList.add("active");if(a=document.getElementById("chatrm"))a.classList.remove("enable"),a.classList.contains("disable")||a.classList.add("disable");if(a=document.getElementById("ta_chrm2"))a.style.display="none";if(a=document.getElementById("congreaUserSearch"))a.style.display="block";if(a=document.getElementById("memlist"))a.classList.remove("disable"),
a.classList.contains("enable")||a.classList.add("enable")});c("#congreaUserSearch").keyup(function(){b(this.value)});this._setWidth(this.options.width);this.init(this)},destroy(){this.element.remove();this._destroy()},_setWidth(b){}})})(jQuery);(function(c){c.fn.clickToggle=function(b,a){const d=[b,a];this.data("toggleclicked",0);this.click(function(){const a=c(this).data(),b=a.toggleclicked;c.proxy(d[b],this)();a.toggleclicked=(b+1)%2});return this}})(jQuery);(function(c){let b;c.widget("ui.memberlist",{options:{id:null,title:null,user:null,hidden:!1,offset:0,userSent(a){"7"!==a.userid&&this.boxManager.addUsr(a.name)},boxClosed(a){},boxManager:{init(a){this.elem=a},addUsr(a){if(null!=chatContainerEvent.elementFromShadowDom(`#ml${a.userid}`))return!0;document.createElement("div");document.createDocumentFragment("div").id="tempId";a.userid!==wbUser.id&&(a.notSelf=!0);roles.hasControls()&&(a.isTeacher=!0);"t"===a.role?a.rl="teacher":"s"===a.role&&(a.rl="student");
a.chatIconColors=virtualclass.gObj.chatIconColors[a.userid];return virtualclass.getTemplate("chatuser","chat")({peer:a})},highlightBox(){const a=this;a.elem.uiChatboxTitlebar.effect("highlight",{},300);a.elem.uiChatbox.effect("bounce",{times:3},300,()=>{a.highlightLock=!1;a._scrollToBottom()})},toggleBox(){},_scrollToBottom(){}}},toggleContent(a){this.uiChatboxContent.toggle();this.uiChatboxContent.is(":visible")},widget(){return this.uiChatbox},_create(){const a=(this.uiChatbox=c("<div></div>")).appendTo(document.getElementById("congreaChatCont")).addClass("ui-widget ui-corner-top ui-memblist").attr("id",
"memlist");b=(this.uiChatboxContent=c("<div></div>")).addClass("ui-widget-content ui-memblist-content ").appendTo(a);(this.uiChatboxLog=this.element).addClass("ui-widget-content ui-memblist-log").appendTo(b).focusin(function(){const a=c(this).parent().prev();a.scrollTop(a.scrollHeight)});this._setWidth(this.options.width);this._position(this.options.offset);this.options.boxManager.init(this);roles.hasAdmin()&&(virtualclass.user.mediaSliderUI("audio"),virtualclass.user.mediaSliderUI("video"),virtualclass.user.mediaSliderUI("chat"),
virtualclass.user.mediaSliderUI("groupChat"),virtualclass.user.mediaSliderUI("askQuestion"),virtualclass.user.mediaSliderUI("userlist"),virtualclass.user.mediaSliderUI("qaMarkNotes"))},_setOption(a,b){if(null!=b)switch(a){case "hidden":b?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(b);break;case "width":this._setWidth(b)}c.Widget.prototype._setOption.apply(this,arguments)},_setWidth(a){this.uiChatboxLog.width(`${a}px`)},_position(a){this.uiChatbox.css("right",a)}})})(jQuery);(function(c){c.widget("ui.chatbox",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,messageSent(b,a,c){this.boxManager.addMsg(a.name,c)},boxClosed(b){},boxManager:{init(b){this.elem=b},addMsg(b,a){var d=virtualclass.poll.capitalizeFirstLetterFnameLname(b),f=this.elem.uiChatboxLog;b=document.createElement("div");f.append(b);f=!1;if(d){const a=document.createElement("b");c(a).text(`${d}: `);b.appendChild(a)}else f=!0;d=document.createElement(f?"i":"span");c(d).text(a);b.appendChild(d);
c(b).addClass("ui-chatbox-msg");c(b).fadeIn();this._scrollToBottom();this.elem.uiChatboxTitlebar.hasClass("ui-state-focus")||this.highlightLock||(this.highlightLock=!0,this.highlightBox())},highlightBox(){},toggleBox(){this.elem.uiChatbox.toggle()},_scrollToBottom(){const b=this.elem.uiChatboxLog;b.scrollTop(b.get(0).scrollHeight)}}},toggleContent(b){},toggleContentbox(b){this.uiChatboxContent.is(":visible")?(this.uiChatboxInputBox.focus(),c(c(`#tabs ul li[id = "tabcb${this.options.id}"]`)).removeClass("ui-state-active")):
c(c(`#tabs ul li[id="tabcb${this.options.id}"]`)).addClass("ui-state-active");this.uiChatbox.toggle("slide",{direction:"down"},1E3)},widget(){return this.uiChatbox},_create(){createTab(this.options.id,this.options.title);const b=this;var {options:a}=b,d=a.title||"No Title";const f=(b.uiChatbox=c("<div></div>")).appendTo(document.body).addClass("ui-widget ui-corner-top ui-chatbox").attr("id",`cb${b.options.id}`).focusin(()=>{b.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(()=>{b.uiChatboxTitlebar.removeClass("ui-state-focus")});
a=(b.uiChatboxTitlebar=c("<div></div>")).addClass("ui-widget-header ui-corner-top ui-chatbox-titlebar ui-dialog-header").click(a=>{}).appendTo(f);(b.uiChatboxTitle=c('<span class="cgText"></span>')).html(d).appendTo(a);const g=(b.uiChatboxTitlebarClose=c('<a href="#"></a>')).addClass("ui-chatbox-icon ").attr("role","button").hover(()=>{g.addClass("ui-state-hover")},()=>{g.removeClass("ui-state-hover")}).click(a=>{delete virtualclass.chat.vmstorage[b.options.id][0].box;f.hide();b.options.boxClosed(b.options.id);
c(`#tabcb${b.options.id}`).remove();virtualclass.chat.idList&&virtualclass.chat.idList.length&&(a=virtualclass.chat.idList.indexOf(b.options.id),-1<a&&virtualclass.chat.idList.splice(a,1));return!1}).appendTo(a);c("<span ></span>").addClass("ui-icon icon-close cgIcon ").text("").appendTo(g);const k=(b.uiChatboxTitlebarMinimize=c('<a href = "#"></a>')).addClass("ui-chatbox-icon").attr("role","button").hover(()=>{k.addClass("ui-state-hover")},()=>{k.removeClass("ui-state-hover")}).click(a=>{b.toggleContentbox(a);
return!1}).appendTo(a);c("<span></span>").addClass("ui-icon icon-minus").text("").appendTo(k);d=(b.uiChatboxContent=c("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(f);(b.uiChatboxLog=b.element).addClass("ui-widget-content ui-chatbox-log").appendTo(d);const m=(b.uiChatboxInput=c("<div></div>")).addClass("ui-widget-content ui-chatbox-input").click(a=>{}).appendTo(d),n=(b.uiChatboxInputBox=c("<textarea></textarea>")).addClass("ui-widget-content ui-chatbox-input-box ").prop("id",
`ta${b.options.id}`).appendTo(m).keypress(function(a){if(a.keyCode&&a.keyCode===c.ui.keyCode.ENTER){a=c.trim(c(this).val());if(0<a.length){ioAdapter.mustSendUser({msg:a,cf:"msg"},b.options.id);c(`li[aria-controls='tabcb${b.options.id}']`).removeClass("ui-state-highlight");c(this).val("");c(`#${b.options.id}`).chatbox("option").messageSent(b.options.id,{name:io.cfg.userobj.name},a);const d=b.options.id;"undefined"===typeof virtualclass.chat.vmstorage[d]&&(virtualclass.chat.vmstorage[d]=[]);const f=
(new Date).getTime();virtualclass.chat.vmstorage[d].push({userid:io.cfg.userid,name:io.cfg.userobj.name,msg:a,time:f})}return!1}}).focusin(function(){n.addClass("ui-chatbox-input-focus");const a=c(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)}).focusout(()=>{n.removeClass("ui-chatbox-input-focus")});a.find("*").add(a).disableSelection();d.children().click(()=>{b.uiChatboxInputBox.focus()});b._setWidth(b.options.width);b._position(b.options.offset);b.options.boxManager.init(b);b.options.hidden||
f.show();c(c(`#tabs ul li[id = "tabcb${b.options.id}"]`)).append(f)},_setOption(b,a){if(null!=a)switch(b){case "hidden":a?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(a);break;case "width":this._setWidth(a)}c.Widget.prototype._setOption.apply(this,arguments)},_setWidth(b){this.uiChatbox.width(`${b}px`);this.uiChatboxInputBox.css("width",`${b-11}px`)},_position(b){}})})(jQuery);let uiChatboxContent,uiChatboxLog,uiChatboxInputBox,msg;
(function(c){c.widget("ui.chatroom",{options:{id:null,title:null,user:null,hidden:!1,offset:6,messageSent(b,a){this.boxManager.addMsg(b.name,a)},boxClosed(b){},boxManager:{init(b){this.elem=b},addMsg(b,a,d){"undefined"===typeof virtualclass.gObj.chatIconColors[d]&&groupChatImgColor(b,d);const f=virtualclass.vutil.getCurrentFormattedTime(a.time);var {msg:g}=a,k=this.elem.uiChatboxLog;const m=document.createElement("li");m.className="left clearfix";k.append(m);k=document.createElement("div");k.className=
"chat-user-icon pull-left";m.appendChild(k);if(virtualclass.gObj.chatIconColors[d]){k.style.backgroundColor=virtualclass.gObj.chatIconColors[d].bgColor;k.style.color=virtualclass.gObj.chatIconColors[d].textColor;var n=document.createElement("span");n.className="chat-img ";n.innerHTML=virtualclass.gObj.chatIconColors[d].initial}k.appendChild(n);n=!1;d=document.createElement("div");d.className="commonChatCon chat-body clearfix";b?(k=document.createElement("a"),k.className="primary-font",c(k).text(b),
d.appendChild(k)):n=!0;b=document.createElement(n?"i":"p");b.className="text";c(b).text(g);g=document.createElement("span");g.className="text-muted";g.innerHTML=f;d.appendChild(b);d.appendChild(g);m.appendChild(d);d.appendChild(b);m.dataset.msgtime=a.time;c(m).addClass("ui-chatbox-msg");c(m).fadeIn();this._scrollToBottom()},groupChatImgColor(b,a){let c;const f=this.getInitials(b);b=this.stringToHslColor(a.toString()+b,60,35);c=125<virtualclass.vutil.calcBrightness(b)?"black":"white";virtualclass.gObj.chatIconColors[a]=
{bgColor:b,textColor:c,initial:f}},stringToHslColor(b,a,c){let d=0;for(let a=0;a<b.length;a++)d=b.charCodeAt(a)+((d<<5)-d);return`hsl(${d%360}, ${a}%, ${c}%)`},getInitials(b){b=b.split(" ");let a=b[0].substring(0,1).toUpperCase();1<b.length&&(a+=b[b.length-1].substring(0,1).toUpperCase());return a},highlightBox(){this.elem.uiChatboxTitlebar.addClass("ui-state-highlight");this.highlightLock=!1;this._scrollToBottom()},toggleBox(){this.elem.uiChatbox.toggle("slide",{direction:"down"},1E3)},_scrollToBottom(){const b=
this.elem.uiChatboxLog;b.scrollTop(b.get(0).scrollHeight)}}},toggleContent(b){this.uiChatboxContent.toggle();this.uiChatboxContent.is(":visible")&&this.uiChatboxInputBox.focus()},widget(){return this.uiChatbox},_create(){const b=this;let a;const d=(b.uiChatbox=c("<div></div>")).appendTo(document.getElementById("congreaChatCont")).addClass("ui-widget ui-corner-top ui-chatroom disable").prop("id","chatrm");uiChatboxContent=(b.uiChatboxContent=c("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(d);
uiChatboxLog=(b.uiChatboxLog=b.element).addClass("ui-widget-content ui-chatbox-log").appendTo(uiChatboxContent);uiChatboxInputBox=(b.uiChatboxInputBox=c("<input></input>")).addClass("ui-widget-content ui-chatbox-input-box ").prop("id","ta_chrm2").prop("placeholder",virtualclass.lang.getString("sendMessage")).appendTo(document.querySelector(".congrea #congchatBarInput")).keydown(function(d){if(d.keyCode&&d.keyCode===c.ui.keyCode.ENTER){msg=c.trim(c(this).val());d=(new Date).getTime();var f={receiver:"chatroom",
msg,cf:"msg",time:d};0<msg.length&&(ioAdapter.mustSend(f),c(this).val(""),b.options.messageSent({name:io.cfg.userobj.name},{msg,time:d}),null!=localStorage.getItem("chatroom")?(f=JSON.parse(localStorage.getItem("chatroom")),a={userid:io.cfg.userid,name:io.cfg.userobj.name,msg,time:d},f.push(a)):a={userid:io.cfg.userid,name:io.cfg.userobj.name,msg,time:d},virtualclass.chat.commonChat.push(a));return!1}});uiChatboxContent.children().click(()=>{b.uiChatboxInputBox.focus()});b._setWidth(b.options.width);
b._position(b.options.offset);b.options.boxManager.init(b);roles.isStudent()&&virtualclass.settings.studentgc(virtualclass.settings.info.studentgc);b.options.hidden||(d.show(),virtualclass.vutil.isPlayMode()&&disCommonChatInput())},_setOption(b,a){if(null!=a)switch(b){case "hidden":a?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(a);break;case "width":this._setWidth(a)}c.Widget.prototype._setOption.apply(this,arguments)},_setWidth(b){this.uiChatbox.width(`${b}px`)},
_position(b){this.uiChatbox.css("left",b)}})})(jQuery);Array.indexOf||(Array.prototype.indexOf=function(c){for(let b=0;b<this.length;b++)if(this[b]==c)return b;return-1});
const chatboxManager=function(){function c(b){var c=d.indexOf(b);if(-1!==c){d.splice(c,1);a.splice(c,1);b=f.width+f.gap;for(let a=c;a<d.length;a++)c=$(`#${d[a]}`).chatbox("option","offset"),$(`#${d[a]}`).chatbox("option","offset",c-b)}else alert(`There is some error: ${b}`)}function b(a,b,c){f.messageSent(a,b,c)}let a=[],d=[];const f={width:230,gap:20,maxBoxes:5,messageSent(a,b,c){$(`#${a}`).chatbox("option","boxManager").addMsg(b,c)}};return{init:function(a){$.extend(f,a)},addBox:function(g,k,m){m=
d.indexOf(g);const n=a.indexOf(g);-1===m&&(-1!==n?($(`#${g}`).chatbox("option","offset",285+(f.width+f.gap)*d.length),$(`#${g}`).chatbox("option","boxManager").toggleBox(),d.push(g),m=$("#tabs li").index($(`#tabcb${g}`)),$($(".tabs li")[m]).css("display","list-item"),$("#tabs").tabs("option","active",m),$("#tabs").tabs("show")):("undefined"===typeof k.last_name&&(k.last_name=""),m=document.createElement("div"),m.setAttribute("id",g),$(m).chatbox({id:g,user:k,title:`${k.first_name} ${k.last_name}`,
hidden:!1,width:f.width,offset:285+(f.width+f.gap)*d.length,messageSent:b,boxClosed:c}),a.push(g),d.push(g),virtualclass.chat.calculateViewPortForMessageBox()));"support"===k.class?0===$(`#cb${g}.support`).length&&$(`#cb${g}`).addClass("support").removeClass("privateChat"):"privateChat"===k.class&&0===$(`#cb${g}.privateChat`).length&&$(`#cb${g}`).addClass("privateChat").removeClass("support");Object.prototype.hasOwnProperty.call(virtualclass.chat.vmstorage,g)&&(virtualclass.chat.vmstorage[g][0].box=
"opened")},delBox:function(b){d=$.grep(d,a=>b!=a);a=$.grep(a,a=>b!=a)},dispatch:function(a,b){$(`#${a.userid}`).chatbox("option","boxManager").addMsg(a.name,b)}}}();let tabId;const myChatBoxOpen=!1,chatResults=[];let myDivResult="";const checkChatDisabled=!1;let tmpmyDivResult;
function displayChatUserList(c){Object.prototype.hasOwnProperty.call(virtualclass.gObj,"insertUser")||(virtualclass.gObj.insertUser=!0,virtualclass.gObj.userToBeDisplay=500);var b=c;if(virtualclass.gObj.insertUser){if(virtualclass.jId===virtualclass.gObj.uid&&virtualclass.gObj.userToBeDisplay<c.length){b=[];b.push(virtualclass.vutil.getMySelf());for(let a=0;a<virtualclass.gObj.userToBeDisplay;a++)c[a].userid!==virtualclass.gObj.uid&&b.push(c[a])}for(c=0;c<b.length;c++)"undefined"===typeof virtualclass.gObj.chatIconColors[b[c].userid]&&
groupChatImgColor(b[c].name,b[c].userid),virtualclass.gObj.chatIconColors[b[c].userid].savedImg="noimage"===b[c].img?!1:b[c].img,null==document.getElementById(`video${b[c].userid}`)&&(tmpmyDivResult=$("#chat_div").memberlist("option").userSent(b[c])),"boolean"!==typeof tmpmyDivResult&&"undefined"!==typeof tmpmyDivResult&&null!=tmpmyDivResult&&(myDivResult+=tmpmyDivResult);"undefined"===typeof chat_div&&(chat_div=document.querySelector("#chat_div"));null!=myDivResult&&"undefined"!==typeof myDivResult&&
""!==myDivResult&&"boolean"!==typeof myDivResult&&(" "===chat_div.shadowRoot.innerHTML||""===chat_div.shadowRoot.innerHTML?(c=roles.hasControls()?"teacher":"student",chat_div.shadowRoot.innerHTML=virtualclass.isPlayMode?`<link rel='stylesheet' type='text/css'
          href='${whiteboardPath}css/modules/chat-container.css'>
          <div id='subchat' class='playMode ${c}'>${myDivResult}</div>`:`<link rel='stylesheet' type='text/css' 
          href='${whiteboardPath}css/modules/chat-container.css'>
          <div id='subchat' class='${c}'>${myDivResult}</div>`):chat_div.shadowRoot.querySelector("#subchat").insertAdjacentHTML("beforeend",myDivResult));myDivResult="";if(virtualclass.gObj.uid===virtualclass.vutil.whoIsTeacher())for(c=0;c<b.length;c++)virtualclass.gObj.uid!==b[c].userid&&virtualclass.user.initControlHandler(b[c].userid)}virtualclass.gObj.insertUser=!(virtualclass.connectedUsers.length>=virtualclass.gObj.userToBeDisplay);roles.isStudent()&&virtualclass.settings.userlist(virtualclass.settings.info.userlist)}
function handleCommonChat(){var c=document.querySelector("#congAskQuestion"),b=document.querySelector("#virtualclassnote");c.classList.contains("active")||b.classList.contains("active")||(c=document.querySelector(".vmchat_room_bt .inner_bt"),b=document.querySelector(".vmchat_bar_button"),c.click(),b.classList.add("disable"))}
function displayChatOfflineUserList(c){alert("display chat offline user");let b=document.querySelector("#melistcontainer");null==b&&(b=document.createDocumentFragment("div"),b.id="melistcontainer");for(let a=0;a<c.length;a++)virtualclass.vutil.alreadyConnected(c[a].userid)||c[a].userid==virtualclass.gObj.uid||null!=document.getElementById(`video${c[a].userid}`)||(myDivResult=$("#chat_div").memberlist("option").userSent(c[a]),virtualclass.media.addUserRole(myDivResult,c[a].role),b.appendChild(myDivResult));
document.querySelector("#chat_div").appendChild(b)}function updateOnlineUserText(){roles.hasAdmin()&&0<virtualclass.chat.userList.length&&(document.querySelector("#userListHeader #onlineusertext").innerHTML="");document.querySelector("#userListHeader #onlineusertext").innerHTML=`(${virtualclass.connectedUsers.length})`}
function memberUpdate(c,b){if("removed"===b)b=virtualclass.gObj.testChatDiv.shadowRoot.querySelector(`#ml${c.removeUser}`),null!=b&&b.parentNode.removeChild(b),updateOnlineUserText();else{c=virtualclass.gObj.memberlistpending;virtualclass.gObj.memberlistpending=[];if(0<c.length){virtualclass.chat.showChatUserList(c);virtualclass.jId===virtualclass.gObj.uid&&(virtualclass.chat.openChatBox(),virtualclass.media.dispAllVideo("chat_div"));displayChatUserList(c);for(var a=0;a<c.length;a++)if(c[a].userid===
io.cfg.userid&&"undefined"!==typeof b&&"removed"!==b){var d=document.getElementById(`video${virtualclass.gObj.uid}`);Object.prototype.hasOwnProperty.call(virtualclass.gObj,"audIntDisable")||Object.prototype.hasOwnProperty.call(virtualclass.gObj,"vidIntDisable")||null!=d||virtualclass.media.innerHandleUserMedia(virtualclass.gObj.uid);d=chatContainerEvent.elementFromShadowDom(`#ml${virtualclass.gObj.uid}`);null!=d&&d.classList.add("mySelf")}}else console.log("====> Chat div is not removing when one user is left the room ");
roles.hasAdmin()&&virtualclass.jId===virtualclass.gObj.uid?(virtualclass.chat.openChatBox(),"added"===b?virtualclass.chat.fetchChatUsers():virtualclass.chat.showChatListUsers(),virtualclass.chat.setChatDisplay()):virtualclass.jId===virtualclass.gObj.uid&&virtualclass.chat.setChatDisplay();c=document.querySelector("#memlist");b=document.querySelector("#chatrm");null!=c&&null==document.querySelector("#chatroom_bt2.active")?null!=b&&(b.classList.remove("enable"),b.classList.add("disable")):(c&&(c.classList.remove("enable"),
c.classList.add("disable")),c=document.querySelector("#user_list"),a=document.querySelector("#chatroom_bt2"),b&&(a.classList.contains("active")||a.classList.add("active"),c.classList.remove("active")));b=document.querySelector("#virtualclassCont.congrea  #user_list.vmchat_bar_button");c=document.querySelector("#virtualclassCont.congrea #congreaUserSearch");a=document.querySelector("#virtualclassCont.congrea  #ta_chrm2");b.classList.contains("active")?(a&&(a.style.display="none"),c&&(c.style.display=
"block")):(a&&(a.style.display="block"),c&&(c.style.display="none"));updateOnlineUserText();virtualclass.connectedUsers.forEach(a=>{$(`#ml${a.userid}`).addClass("online").removeClass("offline")});b=document.querySelector("#chat_div .ui-memblist-usr.mySelf .videoSubWrapper video");null!=b&&b.play()}"display"===virtualclass.gObj.delayVid&&setTimeout(()=>{virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid)},200);virtualclass.gObj.delayVid=""}
function messageUpdate(c){var b=$.isPlainObject(c.message)?c.message.msg:c.message;const a=c.toUser,d=c.fromUser,f=io.cfg.userid,g=(new Date).getTime();let k;"chatroom"!==c.message.receiver||a&&""!==a?null!=a&&""!==a&&(f===a.userid&&d.userid!==f&&(-1===$.inArray(d.userid,virtualclass.chat.idList)&&(virtualclass.chat.counter++,virtualclass.chat.idList.push(d.userid),Object.prototype.hasOwnProperty.call(virtualclass.chat.vmstorage,d.userid)||(virtualclass.chat.vmstorage[d.userid]=[],virtualclass.chat.vmstorage[d.userid].push({userid:d.userid,
name:`${d.name} ${d.lname}`}))),null==document.querySelector(`#cb${d.userid}`)&&(chatboxManager.addBox(d.userid,{dest:`dest${virtualclass.chat.counter}`,title:`box${virtualclass.chat.counter}`,first_name:d.name,last_name:d.lname}),Object.prototype.hasOwnProperty.call(virtualclass.chat.vmstorage,d.userid)&&1<virtualclass.chat.vmstorage[d.userid].length&&displayUserSinglePvtChatHistory(d.userid)),chatboxManager.init({user:d,messageSent(a,b,c){$(`#${a}`).chatbox("option","boxManager").addMsg(b.name,
c)}}),roles.isStudent()&&virtualclass.settings.studentpc(virtualclass.settings.info.studentpc),$(`#${d.userid}`).chatbox("option").messageSent(d.userid,d,b),$(`li[aria-controls='tabcb${d.userid}']`).addClass("ui-state-highlight"),k=d.userid),virtualclass.chat.vmstorage[k].push({userid:d.userid,name:d.name,msg:b,time:g})):(b={msg:b,time:c.message.time},virtualclass.chat.chatroombox||0!==$("ul#chat_room").length||(c=document.createElement("ul"),c.id="chat_room",document.body.appendChild(c),virtualclass.chat.chatroombox=
$("#chat_room").chatroom({id:"chat_room",user:d,title:virtualclass.lang.getString("chatroom_header"),messageSent(a,b){const c=a.userid||virtualclass.gObj.uid;$("#chat_room").chatroom("option","boxManager").addMsg(a.name,b,c)}})),$("#chat_room").chatroom("option").messageSent(d,b),c=localStorage.getItem("chatroom"),null!=c?(c=JSON.parse(c),b={userid:d.userid,name:d.name,msg:b,time:g},c.push(b)):b={userid:d.userid,name:d.name,msg:b,time:g},virtualclass.chat.commonChat.push(b),0===$("#chatroom_bt2.active").length&&
virtualclass.config.makeWebSocketReady&&($("#chatroom_bt2").addClass("ui-state-highlight"),$("#chatrm").removeClass("enable")))}function statusUpdate(c,b,a){$(`#${c.userid}`).length&&($(`#${c.userid}`).chatbox("option").messageSent(c.userid,c,b),$(`#ta${c.userid}`).prop("disabled",a))}function commonChatboxUpdate(c,b){$("ul#chat_room").length&&$("#chat_room").chatroom("option").messageSent(c,b)}
function newStatus(c){$.each(c.message,(b,a)=>{null!=c.newuser&&a.userid==c.newuser&&(statusUpdate(a,"Online",!1),commonChatboxUpdate(a,"Online"))})}function createTab(c,b){const a=$("#tabs").tabs(),d=$("div#tabs ul li").length;tabId=`tabcb${c}`;addTab(a,tabId,d,b)}
function addTab(c,b,a,d){$("#tab_content");a=d||`Tab ${a}`;b=$(`<li id = '${b}' class = 'ui-state-default ui-corner-bottom ui-tabs-active ui-state-active' aria-controls = '${b}'><a href = '#{href}' class = 'ui-tabs-anchor'>#{label}</a> <a href = '#' role = 'button'class = 'ui-corner-all ui-chatbox-icon'><span class = 'ui-icon icon-close'></span></a></li>`.replace(/#\{href\}/g,`#${b}`).replace(/#\{label\}/g,a));c.find(".ui-tabs-nav").append(b)}
function browserSupportsLocalStorage(){return"localStorage"in window&&null!=window.localStorage}
function displaycomChatHistory(){var c=localStorage.getItem("chatroom");if(null!=c){const b=document.createElement("ul");b.id="chat_room";document.body.appendChild(b);c=JSON.parse(c);virtualclass.chat.commonChat=c;$.each(c,(a,b)=>{1>a&&(virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:b,title:"Common chat",messageSent(a,b){const c=a.userid||virtualclass.gObj.uid;$("#chat_room").chatroom("option","boxManager").addMsg(a.name,b,c)}}));"object"===typeof b.msg?$("#chat_room").chatroom("option").messageSent(b,
b.msg):$("#chat_room").chatroom("option").messageSent(b,{msg:b.msg,time:b.time})})}"hidden"==localStorage.getItem("chatroom_status")&&$("#chatrm").hide()}
function displayPvtChatHistory(c){let b=!1;$.each(c,(a,c)=>{virtualclass.chat.counter++;virtualclass.chat.idList.push(a);$.each(c,(c,d)=>{1>c?(Object.prototype.hasOwnProperty.call(d,"box")&&(b=!0),b&&(a==virtualclass.chat.supportId&&(d.name="support"),chatboxManager.addBox(a,{dest:`dest${virtualclass.chat.counter}`,title:`box${virtualclass.chat.counter}`,first_name:d.name}),chatboxManager.init({messageSent(a,b,c){$(`#${a}`).chatbox("option","boxManager").addMsg(b.name,c)}}))):b&&$(`#${a}`).chatbox("option").messageSent(a,
d,d.msg)});b=!1;a==virtualclass.chat.supportId&&(c=document.getElementById(`cb${virtualclass.chat.supportId}`))&&c.classList.add("support");"hidden"==localStorage.getItem(a)&&($(`#cb${a}`).hide(),$(`#tabcb${a}`).removeClass("ui-state-active"))})}function displayError(c){virtualclass.view.createErrorMsg(c,"errorContainer","virtualclassAppFooterPanel",{className:"Unauthenticated"})}function clearAllChatBox(){$("#chatWidget .icon-close").trigger("click")}
function disCommonChatInput(){const c=document.getElementById("ta_chrm");null!=c&&(c.disabled=!0)}
function toggleCommonChatBox(){var c=$("#chatroom_bt2");"hidden"==localStorage.getItem("chatroom_status")?(localStorage.removeItem("chatroom_status"),c.attr("data-title",virtualclass.lang.getString("minCommonChat"))):c.attr("data-title",virtualclass.lang.getString("maxCommonChat"));c=document.getElementById("cc_arrow_button");null!=c&&(virtualclass.vutil.elemHasAnyClass("cc_arrow_button")?c.classList.contains("icon-arrow-up")?(c.classList.add("icon-arrow-down"),c.classList.remove("icon-arrow-up")):
(c.classList.add("icon-arrow-up"),c.classList.remove("icon-arrow-down")):c.className="icon-arrow-up");virtualclass.chat.chatroombox.chatroom("option","boxManager").toggleBox()}function sortUserList(c,b){return c.name<b.name?-1:c.name>b.name?1:0}function sortCommonChat(){const c=$("#chat_room");c.find(".ui-chatbox-msg").sort((b,a)=>+b.dataset.msgtime-+a.dataset.msgtime).appendTo(c)}
function displayUserSinglePvtChatHistory(c){$(`#${c} .ui-chatbox-msg`).remove();const b=virtualclass.chat.vmstorage[c];1<b.length&&$.each(b,(a,b)=>{0<a&&$(`#${c}`).chatbox("option").messageSent(c,b,b.msg)})}function groupChatImgColor(c,b){let a;const d=getInitials(c);c=stringToHslColor(b.toString()+c,60,35);a=125<virtualclass.vutil.calcBrightness(c)?"black":"white";virtualclass.gObj.chatIconColors[b]={bgColor:c,textColor:a,initial:d}}
function stringToHslColor(c,b,a){let d=0;for(let a=0;a<c.length;a++)d=c.charCodeAt(a)+((d<<5)-d);return`hsl(${d%360}, ${b}%, ${a}%)`}function getInitials(c){c=c.split(" ");let b=c[0].substring(0,1).toUpperCase();1<c.length&&(b+=c[c.length-1].substring(0,1).toUpperCase());return b};const preCheck={currTest:"",playTestAudio:!1,session:null,cNavigator:null,handlers:[],videoAction:!1,donePrecheck:!1,cameraStreamStatus:2,init(){var c=document.querySelector("#myModal");c&&(c.className="modal in");roles.hasControls()?this.videoAction=virtualclass.videoHost.gObj.videoSwitch:Object.prototype.hasOwnProperty.call(virtualclass.videoHost.gObj,"stdStopSmallVid")?this.videoAction=!virtualclass.videoHost.gObj.stdStopSmallVid:this.videoAction=!1;this.totalTest=["browser","bandWidth","webcam",
"speaker","mic"];this.currTest="browser";c=document.querySelector("#virtualclassCont #preCheckcontainer");null!=c&&(c.style.display="block",document.getElementById("virtualclassCont").dataset.currwindow="precheck");c=document.querySelector("#virtualclassCont #virtualclassApp");null!=c&&(c.style.display="FLEX");this.startToCheckWholeSytem();if(c=document.querySelector("#preCheckcontainer .skip"))c.removeEventListener("click",this.initSkip),c.addEventListener("click",this.initSkip);virtualclass.precheck.donePrecheck=
!0;null!=workerAudioSend&&workerAudioSend.postMessage({cmd:"precheck",msg:{precheck:virtualclass.precheck.donePrecheck}})},initSkip(){micTesting.makeAudioEmpty();if(localStorage.getItem("precheck")){var c=document.getElementById("preCheckcontainer");c.style.display="none";c=document.getElementById("virtualclassApp");c.style.display="flex"}else virtualclass.popup.waitMsg(),virtualclass.makeReadySocket(),c=document.getElementById("preCheckcontainer"),c.style.display="none",c=document.getElementById("virtualclassApp"),
c.style.display="flex",localStorage.setItem("precheck",!0),virtualclass.videoHost.afterSessionJoin();document.getElementById("virtualclassCont").dataset.currwindow="normal";if(c=document.getElementById("vcSpeakerCheckAudio"))c.pause(),c.currentTime=0;virtualclass.gObj.precheckScrn=!1;virtualclass.precheck.afterComplete()},cancelAudioGraph(){null!=this.graph&&null!=this.graph&&this.graph.microphone.stop()},startToCheckWholeSytem(){this[this.totalTest[0]].perform()},_next(c,b){"browser"===c&&virtualclass.media.audio.initAudiocontext();
virtualclass.precheck.cancelAudioGraph();micTesting.makeAudioEmpty();const a=this[c].next;virtualclass.precheck.currTest=a;virtualclass.precheck.updateProgressBar(a);!Object.prototype.hasOwnProperty.call(this[a],"alreadyDone")||Object.prototype.hasOwnProperty.call(this[a],"alreadyDone")&&"bandwidth"===a?this[a].perform():(virtualclass.precheck.display(`#preCheckcontainer .precheck.${a}`),"speaker"===a?this[a]._play():"mic"===a?this[a].audioOperation():"webcam"===a&&(virtualclass.precheck.webcam.initHandler(),
virtualclass.precheck.webcam.createVideo()));virtualclass.precheck.hide(`#preCheckcontainer .precheck.${c}`);"undefined"!==typeof b&&b();this[a].alreadyDone=!0},_prev(c,b){virtualclass.precheck.cancelAudioGraph();micTesting.makeAudioEmpty();const a=this[c].prev;virtualclass.precheck.hide(`#preCheckcontainer .precheck.${c}`);virtualclass.precheck.display(`#preCheckcontainer .precheck.${a}`);document.querySelector(`#preCheckcontainer  #preCheckProgress .${c}`).classList.remove("active","current");document.querySelector(`#preCheckcontainer  #preCheckProgress .${a}`).classList.add("current");
"speaker"===a?this[a]._play():"mic"===a?(micTesting.playAudio=!0,this[a].audioOperation()):"webcam"===a&&virtualclass.precheck.webcam.initHandler();"undefined"!==typeof b&&b()},display(c){document.querySelector(c).style.display="block"},hide(c){document.querySelector(c).style.display="none"},createMessage(c,b,a){const d=document.createElement("div");d.className=a;d.innerHTML=b;document.querySelector(c).appendChild(d)},initHandler(c,b,a){const d=document.querySelector(c);null!=d&&(b=this.triggerInitHandler.bind(d,
c,b,a),d.addEventListener("click",b),this.handlers.push({id:c,handler:b}))},removeAllListener(){for(let c=0;c<this.handlers.length;c++)document.querySelector(this.handlers[c].id).removeEventListener("click",this.handlers[c].handler);this.handlers=[]},triggerInitHandler(c,b,a){this.classList.contains("next")?virtualclass.precheck._next(b):this.classList.contains("prev")&&virtualclass.precheck._prev(b);"undefined"!==typeof a&&null!=a&&a()},browser:{curr:"browser",next:"bandwidth",perform(){virtualclass.precheck.display(`${"#preCheckcontainer .precheck"}.${this.curr}`);
if(0<virtualclass.error.length){var c=1<virtualclass.error.length?virtualclass.error.join("<br />"):virtualclass.error[0];virtualclass.precheck.createMessage("#preCheckcontainer .precheck .result",c,"error")}virtualclass.system.mybrowser.notSuppport||(c=virtualclass.lang.getString("congreainchrome"),virtualclass.precheck.createMessage("#preCheckcontainer .precheck .result",c,"information"),virtualclass.precheck.initHandler(`${"#preCheckcontainer .precheck"} #${this.curr}Buttons .next`,this.curr))}},
bandwidth:{prev:"browser",curr:"bandwidth",next:"speaker",perform(){virtualclass.precheck.display(`#preCheckcontainer .precheck.${this.curr}`);const c=`#preCheckcontainer .precheck.${this.curr} .result`;this.imageAddr="https://dl.congrea.com/bandwidth.jpg";this.downloadSize=1E6;this.measureConnectionSpeed(a=>{document.querySelector(c).innerHTML="";virtualclass.precheck.createMessage(c,a,"information");virtualclass.precheck.initHandler(`${"#preCheckcontainer .precheck"} #${this.curr}Buttons .prev`,
this.curr);virtualclass.precheck.initHandler(`${"#preCheckcontainer .precheck"} #${this.curr}Buttons .next`,this.curr)});const b=virtualclass.media.sessionConstraints();virtualclass.precheck.session=b[1];null==virtualclass.adpt&&(virtualclass.adpt=new virtualclass.adapter);virtualclass.precheck.cNavigator=virtualclass.adpt.init(navigator);virtualclass.precheck.cNavigator.mediaDevices.getUserMedia(virtualclass.precheck.session).then(a=>{virtualclass.precheck.mediaStream=a;0<virtualclass.precheck.mediaStream.getVideoTracks().length&&
(virtualclass.precheck.cameraStreamStatus=1,"webcam"===virtualclass.precheck.currTest&&(document.getElementById("webcamTempVideo").classList.remove("novideo"),a=document.querySelector("#vcWebCamCheck .result .error"),null!=a&&(a.classList.remove("error"),a.classList.add("general"),a.innerHTML=virtualclass.lang.getString("webcamerainfo")),virtualclass.precheck.webcam.createVideo()))}).catch(function(a){virtualclass.media.handleUserMediaError(a);const [b,c]=virtualclass.precheck.webcam.currentStatus();
a=`#preCheckcontainer .precheck.${virtualclass.precheck.webcam.curr}`;const g=document.querySelector(`${a} .msg`);null!==g&&g.parentNode.removeChild(g);virtualclass.precheck.webcam.displayMessage(a,c,b);virtualclass.precheck.cameraStreamStatus=0})},bandWidthInWords(c){600<c?(c="high",virtualclass.videoHost.gObj.MYSPEED=1):400<c?(c="medium",virtualclass.videoHost.gObj.MYSPEED=2):(virtualclass.videoHost.gObj.MYSPEED=3,c="low");ioAdapter.sendSpeed(virtualclass.videoHost.gObj.MYSPEED);return c},measureConnectionSpeed(c){const b=
new Image;b.onload=()=>{this.endTime=(new Date).getTime();const a=this.calculateSpeed();c(virtualclass.lang.getString(`${this.bandWidthInWords(a)}BandWidthSpeed`))};b.onerror=function(a,b){c(virtualclass.lang.getString("bandwitdhImageNotFound"))};this.startTime=(new Date).getTime();b.src=this.imageAddr+`?nnn=${this.startTime}`},calculateSpeed(){const c=((8*this.downloadSize/((this.endTime-this.startTime)/1E3)).toFixed(2)/1024).toFixed(2);return Math.round(c)}},speaker:{prev:"bandwidth",curr:"speaker",
next:"mic",perform(){const c=document.createElement("div");c.innerHTML=virtualclass.lang.getString("speakerTest");document.querySelector(`${`#preCheckcontainer .precheck.${this.curr}`} .result`).appendChild(c);this._play()},_play(){virtualclass.precheck.display(`#preCheckcontainer .precheck.${this.curr}`);document.querySelector("#vcSpeakerCheckAudio source");const c=document.getElementById("vcSpeakerCheckAudio");c.loop=!0;c.play();this.playTestAudio||(virtualclass.precheck.initHandler(`${"#preCheckcontainer .precheck"} #${this.curr}Buttons .prev`,
this.curr,()=>{c.pause();c.currentTime=0}),virtualclass.precheck.initHandler(`${"#preCheckcontainer .precheck"} #${this.curr}Buttons .next`,this.curr,()=>{c.pause();c.currentTime=0}),this.playTestAudio=!0);virtualclass.precheck.cancelAudioGraph()}},mic:{prev:"speaker",curr:"mic",next:"webcam",graphProcessor:null,graph:null,perform(){micTesting.manipulateStreamFallback(virtualclass.precheck.mediaStream);virtualclass.precheck.display(`${"#preCheckcontainer .precheck"}.${this.curr}`);this.visualize();
if(null==document.querySelector("#micTest")){const c=document.createElement("div");c.id="micTest";document.querySelector(`${`${"#preCheckcontainer .precheck"}.${this.curr}`} .result`).appendChild(c)}if("safari"===virtualclass.system.mybrowser.name||"iOS"===virtualclass.system.mybrowser.name)this.graphContext=new (window.AudioContext||window.webkitAudioContext),this.graphProcessor=this.graphContext.createScriptProcessor(1024,1,1);this.initAudioGraph()},initAudioGraph(){const c=document.getElementById("micTest");
c.innerHTML=virtualclass.lang.getString("microphoneNotConnected");if(virtualclass.precheck.mediaStream&&0<virtualclass.precheck.mediaStream.getAudioTracks().length){if(Object.prototype.hasOwnProperty.call(this,"graph")&&null!=this.graph){const b=document.querySelector("#audioGraph wave");null!=b&&b.parentNode.removeChild(b)}this.graph=WaveSurfer.create({container:"#audioGraph",waveColor:"green",interact:!1,cursorWidth:0,audioContext:this.graphContext||null,audioScriptProcessor:this.graphProcessor||
null,plugins:[WaveSurfer.microphone.create()],height:20,maxCanvasWidth:500});this.graph.microphone.on("deviceReady",()=>{console.info("Device ready!")});this.graph.microphone.on("deviceError",b=>{console.warn(`Device error: ${b}`)});c.innerHTML=virtualclass.lang.getString("mictesting")}},audioOperation(){micTesting.playAudio=!0;this.visualize()},visualize(){virtualclass.precheck.initHandler(`#preCheckcontainer .precheck #${this.curr}Buttons .prev`,this.curr);virtualclass.precheck.initHandler(`#preCheckcontainer .precheck #${this.curr}Buttons .next`,
this.curr)}},webcam:{test:{1:"noWebCam",2:"nopermission",3:"webcambuys"},prev:"mic",curr:"webcam",currentStatus(){let c,b;if(virtualclass.system.mediaDevices.hasWebcam)if(0<virtualclass.system.mediaDevices.webcamErr.length){c=virtualclass.system.mediaDevices.webcamErr[virtualclass.system.mediaDevices.webcamErr.length-1];if("PermissionDeniedError"===c||"SecurityError"===c||"nopermission"===c)c+="Ext","Firefox"===virtualclass.system.mybrowser.name&&(c+="FF");c=virtualclass.lang.getString(c);b="error"}else 2===
virtualclass.precheck.cameraStreamStatus?(b="error",c=virtualclass.lang.getString("nowebcamconnectedyet")):(b="general",c=virtualclass.lang.getString("webcamerainfo"));else b="error",c=virtualclass.lang.getString("nowebcam");return[c,b]},displayMessage(c,b,a){let d=document.querySelector(`${c} .result .msg`);null!==d&&d.parentNode.removeChild(d);d=document.createElement("div");d.className=`msg ${b}`;d.innerHTML=a;document.querySelector(`${c} .result`).appendChild(d)},perform(){const [c,b]=this.currentStatus(),
a=`#preCheckcontainer .precheck.${this.curr}`;this.displayMessage(a,b,c);virtualclass.precheck.display(a);-1<b.indexOf("error")?document.getElementById("webcamTempVideo").className="novideo":this.createVideo();this.initHandler()},initHandler(){virtualclass.precheck.initHandler("#preCheckcontainer .precheck #joinSession .prev",this.curr);var c=document.querySelector("#joinSession .next");null!=c?(c.removeEventListener("click",this.joinSession.bind(this)),c.addEventListener("click",this.joinSession.bind(this))):
(c=document.querySelector("#joinSession .precheckComplete"),null==c||this.alreladyAttachedPrecheck||(this.alreladyAttachedPrecheck=!0,c.removeEventListener("click",this.initHidePrecheck.bind(this)),c.addEventListener("click",this.initHidePrecheck.bind(this))))},initHidePrecheck(){console.log("SUMAN HIDE PRECHECK");document.getElementById("preCheckcontainer").style.display="none";document.getElementById("virtualclassApp").style.display="flex";virtualclass.videoHost._resetPrecheck();virtualclass.precheck.afterComplete()},
joinSession(){virtualclass.popup.waitMsg();virtualclass.makeReadySocket();document.getElementById("preCheckcontainer").style.display="none";document.getElementById("virtualclassApp").style.display="flex";localStorage.setItem("precheck",!0);virtualclass.videoHost.afterSessionJoin();virtualclass.precheck.afterComplete()},createVideo(){if(virtualclass.system.mediaDevices.hasWebcam&&"undefined"!==typeof virtualclass.precheck.mediaStream){const c=document.getElementById("webcamTempVideo");"mobTab"===virtualclass.system.device?
(c.width=320,c.height=100):(c.width=320,c.height=240);virtualclass.adpt.attachMediaStream(c,virtualclass.precheck.mediaStream);c.muted=!0;c.play()}}},startSession(){document.getElementById("virtualclassApp").style.display="flex";const c=document.getElementById("virtualclassPreCheck");null!=c&&c.parentNode.removeChild(c)},updateProgressBar(c){document.querySelector(`#progressbarScreen .${c}`);const b=document.querySelectorAll("#preCheckProgress .progressbar li");for(let a=0;a<b.length;a++)if(b[a].classList.add("active"),
b[a].classList.contains(c)){0<a&&b[a-1].classList.remove("current");b[a].classList.add("current");break}},async afterComplete(c){Object.prototype.hasOwnProperty.call(virtualclass.precheck,"mediaStream")&&null!=virtualclass.precheck.mediaStream&&virtualclass.precheck.mediaStream.getTracks()[0].stop();virtualclass.videoHost._resetPrecheck();micTesting.destroyAudioNode();virtualclass.precheck.removeAllListener();"undefined"!==typeof workletAudioSend?workletAudioSend.disconnect():null!=virtualclass.gObj.audioPlayerNode&&
(virtualclass.gObj.audioPlayerNode.disconnect(virtualclass.media.audio.Html5Audio.audioContext.destination),virtualclass.gObj.audioPlayerNode=null);"undefined"!==typeof virtualclass.media.audioCreatorNode&&null!=virtualclass.media.audioCreatorNode&&(virtualclass.media.audioCreatorNode.disconnect(virtualclass.media.audio.Html5Audio.audioContext.destination),virtualclass.media.audioCreatorNode=null);Object.prototype.hasOwnProperty.call(virtualclass.media.audio,"Html5Audio")&&Object.prototype.hasOwnProperty.call(virtualclass.media.audio.Html5Audio,
"audioContext")&&null!=virtualclass.media.audio.Html5Audio.audioContext&&virtualclass.media.audio.Html5Audio.audioContext.close();Object.prototype.hasOwnProperty.call(virtualclass.media.audio,"Html5Audio")&&delete virtualclass.media.audio.Html5Audio;const b=this.videoAction?"on":"off";c||await virtualclass.media.init();virtualclass.vutil.videoHandler(b,"notSendStatus");virtualclass.media.audio.initAudiocontext();virtualclass.precheck.speaker.playTestAudio=!1;virtualclass.media.audio.studentNotSpeak();
virtualclass.precheck.donePrecheck=!1;virtualclass.media.detectAudioWorklet()?virtualclass.media.audio.initPlay():virtualclass.media.audio.initPlayWithFallback();null!=workerAudioSend&&workerAudioSend.postMessage({cmd:"precheck",msg:{precheck:virtualclass.precheck.donePrecheck}})}};eval(function(c,b,a,d,f,g){f=function(a){return(a<b?"":f(parseInt(a/b)))+(35<(a%=b)?String.fromCharCode(a+29):a.toString(36))};if(!"".replace(/^/,String)){for(;a--;)g[f(a)]=d[a]||f(a);d=[function(a){return g[a]}];f=function(){return"\\w+"};a=1}for(;a--;)d[a]&&(c=c.replace(new RegExp(`\\b${f(a)}\\b`,"g"),d[a]));return c}('(v(){o d="H+/";o e=I J(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,K,-1,-1,-1,L,M,N,O,P,Q,R,S,T,U,w,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,V,W,X,Y,Z,1a,-1,-1,-1,-1,-1,-1,1b,1c,1d,1e,1f,1g,1h,1i,1j,1k,1l,1m,1n,1o,1p,1q,1r,1s,1t,1u,1v,1w,1x,1y,1z,1A,-1,-1,-1,-1,-1);v A(a){o b,i,g;o c,h,f;g=a.B;i=0;b="";p(i<g){c=a.n(i++)&r;j(i==g){b+=d.k(c>>2);b+=d.k((c&x)<<4);b+="==";q}h=a.n(i++);j(i==g){b+=d.k(c>>2);b+=d.k(((c&x)<<4)|((h&C)>>4));b+=d.k((h&D)<<2);b+="=";q}f=a.n(i++);b+=d.k(c>>2);b+=d.k(((c&x)<<4)|((h&C)>>4));b+=d.k(((h&D)<<2)|((f&1B)>>6));b+=d.k(f&1C)}s b}v E(a){o b,h,f,l;o i,g,m;g=a.B;i=0;m="";p(i<g){t{b=e[a.n(i++)&r]}p(i<g&&b==-1);j(b==-1)q;t{h=e[a.n(i++)&r]}p(i<g&&h==-1);j(h==-1)q;m+=y.z((b<<2)|((h&1D)>>4));t{f=a.n(i++)&r;j(f==w)s m;f=e[f]}p(i<g&&f==-1);j(f==-1)q;m+=y.z(((h&1E)<<4)|((f&1F)>>2));t{l=a.n(i++)&r;j(l==w)s m;l=e[l]}p(i<g&&l==-1);j(l==-1)q;m+=y.z(((f&1G)<<6)|l)}s m}j(!u.F)u.F=A;j(!u.G)u.G=E})();',
62,105,"               c3 len c2  if charAt c4 out charCodeAt var while break 0xff return do window function 61 0x3 String fromCharCode base64encode length 0xF0 0xF base64decode btoa atob ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 new Array 62 63 52 53 54 55 56 57 58 59 60 20 21 22 23 24           25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 0xC0 0x3F 0x30 0XF 0x3C 0x03".split(" "),0,{}));let vType;function createRequestObject(){return"Microsoft Internet Explorer"==navigator.appName?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}const http=createRequestObject();function convertResponseBodyToText(c){const b={};for(var a=0;256>a;a++)for(let c=0;256>c;c++)b[String.fromCharCode(a+256*c)]=String.fromCharCode(a)+String.fromCharCode(c);a=IEBinaryToArray_ByteStr(c);c=IEBinaryToArray_ByteStr_Last(c);return a.replace(/[\s\S]/g,a=>b[a])+c}const IEBinaryToArray_ByteStr_Script="\x3c!-- IEBinaryToArray_ByteStr --\x3e\r\n<script type='text/vbscript'>\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n\tIEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n\tDim lastIndex\r\n\tlastIndex = LenB(Binary)\r\n\tif lastIndex mod 2 Then\r\n\t\tIEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n\tElse\r\n\t\tIEBinaryToArray_ByteStr_Last = \"\"\r\n\tEnd If\r\nEnd Function\r\n\x3c/script>\r\n";
document.write(IEBinaryToArray_ByteStr_Script);
function loadfile(c,b,a){"undefined"===typeof vType&&(vType="dec");if("dec"===vType){const d=new Image;d.src=c;http.open("get",d.src);http.overrideMimeType?http.overrideMimeType("text/plain; charset=x-user-defined"):http.setRequestHeader("Accept-Charset","x-user-defined");http.onreadystatechange=function(){if(4==http.readyState){var c="undefined"===typeof http.responseBody?http.responseText.split("").map(a=>String.fromCharCode(a.charCodeAt(0)&255)).join(""):convertResponseBodyToText(http.responseBody);
"dec"===vType&&virtualclass.gObj.meetingMode&&WebPDecDemo(b.id);virtualclass.vutil.WebPDecodeAndDraw(c,b,a)}};http.send(null)}};function WebPDecDemo(c){document.getElementById(c).getContext("2d");document.createElement("img")};const BASE64_MARKER=";base64,";let videoPartCont,sampleRate;
var videoHost={gObj:{},setDefaultValue(c){virtualclass.videoHost.gObj.MYSPEED=c||1;virtualclass.videoHost.gObj.teacherVideoQuality=this.getTeacherVideoQuality()},init(c,b){this.sl=0;this.width=c;this.height=b;this.gObj.videoSwitch=1;this.allStdVideoOff=this.domReady=this.gObj.stdStopSmallVid=!1;roles.hasAdmin()?(this._init(),c=document.createElement("canvas"),c.id="dummyCanvas",c.width=40,c.height=40,document.querySelector("#virtualclassCont").appendChild(c),WebPDecDemo("dummyCanvas"),this.domReady=
!0):(this.setCanvasAttr("videoPartCan","videoParticipate"),WebPDecDemo("videoParticipate"),virtualclass.videoHost.UI.hideTeacherVideo());c=document.querySelector("#virtualclassAppRightPanel");if(null!=c)if(b=localStorage.getItem("tvideo"),null==b&&(b="show"),c.classList.add(b),roles.hasControls())(c=localStorage.getItem("videoSwitch"))&&"0"===c&&(virtualclass.connectedUsers&&virtualclass.connectedUsers.length?virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid):virtualclass.gObj.delayVid="display",
virtualclass.videoHost.UI.hideTeacherVideo());else if(c=JSON.parse(localStorage.getItem("stdVideoSwitch")))virtualclass.connectedUsers&&virtualclass.connectedUsers.length?virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid):virtualclass.gObj.delayVid="display",virtualclass.videoHost.UI.hideTeacherVideo()},renderSelfVideo(c){"undefined"===typeof virtualclass.media.tempStream&&this.getMediaStream(c)},isDomReady(c){const b=this;this.domReady?(null!=this.domreadyCheck&&clearTimeout(this.domreadyCheck),
c()):this.domreadyCheck=setTimeout(()=>{b.isDomReady(c)},1E3)},_init(){this.setCanvasAttr("vidHost","videoHost");this.setCanvasAttr("vidHostSlice","videoHostSlice");this.vidHostSlice.globalAlpha=.5;this.vidHostSlice.globalCompositeOperation="multiply"},onmessage(c){"on"===c?(virtualclass.videoHost.gObj.videoSwitch=1,this.UI.displayTeacherVideo(),localStorage.tvideo="show"):"off"===c&&(virtualclass.videoHost.gObj.videoSwitch=0,this.UI.hideTeacherVideo(),localStorage.tvideo="hide")},stdVideoCtrlMsg(c){const {userid:b}=
c.fromUser;c.message.stdVideoCtr.videoSwitch?this.setUserIcon(b):this.removeUserIcon(b)},toggleVideoMsg(c){const b=document.querySelector("#congCtrBar");"enable"===c?(b.style.pointerEvents="visible",b.style.opacity="1",virtualclass.videoHost.gObj.allStdVideoOff=!1):(b.style.pointerEvents="none",b.style.opacity="0.5",virtualclass.videoHost.gObj.allStdVideoOff=!0)},toggleStdVideoIcon(c){const b=document.querySelector(".congrea .videoSwitchCont"),a=document.querySelector(".congrea #rightCtlr #videoSwitch");
"enable"===c?(a.setAttribute("data-action","disable"),a.className="video on",b.setAttribute("data-title",virtualclass.lang.getString("videooff"))):(a.setAttribute("data-action","enable"),a.className="video off",b.setAttribute("data-title",virtualclass.lang.getString("videoon")))},setUserIcon(c){var b;(b=chatContainerEvent.elementFromShadowDom(`#ml${c} .user-details a .videoWrapper`))&&b.parentNode.removeChild(b);const a=chatContainerEvent.elementFromShadowDom(`#ml${c} .user-details a`);chatContainerEvent.elementFromShadowDom(`#ml${c} .user-details a span`)||
chatContainerEvent.elementFromShadowDom(`#ml${c} .user-details a img`)||null==a||(virtualclass.gObj.chatIconColors[c]&&!virtualclass.gObj.chatIconColors[c].savedImg?(b=document.createElement("span"),b.innerHTML=virtualclass.gObj.chatIconColors[c].initial,b.style.backgroundColor=virtualclass.gObj.chatIconColors[c].bgColor,b.style.color=virtualclass.gObj.chatIconColors[c].textColor,b.dataset.event="ub",b.classList.add("chat-img","media-object"),a.appendChild(b)):virtualclass.gObj.chatIconColors[c]&&
virtualclass.gObj.chatIconColors[c].savedImg&&(b=document.createElement("img"),b.setAttribute("src",virtualclass.gObj.chatIconColors[c].savedImg),b.classList.add("chat-img","media-object"),a.appendChild(b)))},removeUserIcon(c){const b=virtualclass.media;virtualclass.gObj.uid===c&&(c=b.video.createVideoElement(),virtualclass.media.util.imageReplaceWithVideo(virtualclass.gObj.uid,c),chatContainerEvent.elementFromShadowDom(`#ml${virtualclass.gObj.uid} #tempVideo`)||(b.video.insertTempVideo(c),b.video.tempVideoInit()),
b.video.myVideo=chatContainerEvent.elementFromShadowDom(`#video${virtualclass.gObj.uid}`),b.video.myVideo.muted=!0,virtualclass.adpt.attachMediaStream(b.video.myVideo,b.video.tempStream))},fromLocalStorage(){let c="";if(roles.hasControls())c=localStorage.getItem("videoSwitch"),localStorage.removeItem("videoSwitch");else{var b=localStorage.getItem("stdVideoSwitch");b=null!=b&&"undefined"!=b?JSON.parse(b):!1;localStorage.removeItem("stdVideoSwitch");var a=localStorage.getItem("allStdVideoOff");a=null!=
a&&"undefined"!=a?JSON.parse(a):!1;virtualclass.videoHost.gObj.allStdVideoOff=a;localStorage.removeItem("stdVideoSwitch")}if("undefined"!==typeof c&&c)if(virtualclass.videoHost.gObj.videoSwitch=+c,roles.hasControls()){if(a=document.getElementById("videoSwitch"))+c?a.classList.contains("off")&&(a.classList.add("on"),a.classList.remove("off")):a.classList.contains("on")&&(a.classList.add("off"),a.classList.remove("on"),virtualclass.gObj.meetingMode&&virtualclass.multiVideo.setVideoStatus(!1))}else virtualclass.gObj.meetingMode||
(+c?virtualclass.videoHost.UI.displayTeacherVideo():virtualclass.videoHost.UI.hideTeacherVideo());roles.hasControls()||("undefined"!==typeof b&&b&&((virtualclass.videoHost.gObj.stdStopSmallVid=b)?(virtualclass.videoHost.toggleStdVideoIcon("disable"),virtualclass.multiVideo.setVideoStatus(!1)):virtualclass.videoHost.toggleStdVideoIcon("enable")),virtualclass.videoHost.gObj.allStdVideoOff||!virtualclass.system.mediaDevices.hasWebcam?virtualclass.videoHost.toggleVideoMsg("disable"):virtualclass.gObj.videoEnable?
virtualclass.videoHost.toggleVideoMsg("enable"):virtualclass.videoHost.toggleStdVideoIcon("disable"))},setCanvasAttr(c,b){this[c]=document.getElementById(b);this[c].width=this.width;this[c].height=this.height;this[`${c}Con`]=this[c].getContext("2d")},getMediaStream(c){this.videoHostSrc=document.getElementById("videoHostSource");this.videoHostSrc.width=this.width;null!=this.videoHostSrc.srcObject&&(this.videoHostSrc.srcObject=null);virtualclass.adpt.attachMediaStream(this.videoHostSrc,c);const b=this;
setTimeout(()=>{b.shareVideo()},2E3)},shareVideo(){this.imageSlices=this.getImageSlices(1,1);this.clearTeacherVideoTime();videoHost.gObj.shareVideoInterval=setInterval(()=>{this.gObj.videoSwitch&&io.webSocketConnected()&&virtualclass.system.mediaDevices.hasWebcam&&this._shareVideo(1,1)},120)},clearTeacherVideoTime(){Object.prototype.hasOwnProperty.call(videoHost.gObj,"shareVideoInterval")&&clearInterval(videoHost.gObj.shareVideoInterval)},_shareVideo(c,b){let a;for(this.sl=0;this.sl<c*b;this.sl++){this.vidHostCon.drawImage(this.videoHostSrc,
0,0,this.width,this.height);a=this.imageSlices[this.sl];const b=this.vidHostCon.getImageData(a.x,a.y,a.w,a.h);this.vidHostSliceCon.putImageData(b,a.x,a.y)}this.sl===c*b&&(virtualclass.system.webpSupport?(c=this.vidHostSlice.toDataURL("image/webp",.6),b=1):(c=this.vidHostSlice.toDataURL("image/jpeg",.3),b=0),this.vidHostSliceCon.clearRect(0,0,this.width,this.height),this.sendInBinary(c,b))},sendInBinary(c,b){c=this.convertDataURIToBinary(c);b=new Int8Array([21,b]);const a=new Int8Array(c.length+b.length);
a.set(b);a.set(c,b.length);ioAdapter.sendBinary(a)},convertDataURIToBinary(c){var b=c.indexOf(BASE64_MARKER)+BASE64_MARKER.length;c=c.substring(b);c=window.atob(c);b=c.length;const a=new Uint8Array(new ArrayBuffer(b));for(let d=0;d<b;d++)a[d]=c.charCodeAt(d);return a},drawReceivedImage(c,b,a){"undefined"===typeof vid0eoPartCont&&(this.videoPartCan=document.getElementById("videoParticipate"),this.videoPartCont=this.videoPartCan.getContext("2d"),videoPartCont=!0);const d=this;"undefined"!==typeof virtualclass.media.audio.Html5Audio?
sampleRate=virtualclass.media.audio.Html5Audio.audioContext.sampleRate:"undefined"===typeof sampleRate&&(sampleRate=(new (window.AudioContext||window.webkitAudioContext)).sampleRate);virtualclass.gObj.isReadyForVideo&&document.querySelector("#virtualclassCont.congrea #videoHostContainer.hide")&&virtualclass.videoHost.UI.displayTeacherVideo();setTimeout(()=>{if(virtualclass.isPlayMode||3>virtualclass.videoHost.gObj.MYSPEED)if(virtualclass.system.webpSupport||"jpeg"===b){const b=new Image;b.onload=
function(){d.videoPartCont.drawImage(b,a.x,a.y)};b.src=c}else virtualclass.gObj.isReadyForVideo&&(virtualclass.gObj.isReadyForVideo=!1,loadfile(c,d.videoPartCan,d.videoPartCont))},260)},onError(c){},getImageSlices(c,b){const a=[],d=c*b,f=Math.floor(this.vidHost.width/b),g=Math.floor(this.vidHost.height/c);for(let k=0;k<d;k++){const d=this._getSingleSliceImg(k,f,g,c,b);a.push(d)}return a},_getSingleSliceImg(c,b,a,d,f){0==c?f=c=0:(d=Math.floor(c/f),c=c%f*b,f=d*a);return{x:c,y:f,w:b,h:a}},Uint8ToString(c){const b=
[];for(let a=0;a<c.length;a+=32768)b.push(String.fromCharCode.apply(null,c.subarray(a,a+32768)));return b.join("")},getTeacherVideoQuality(){virtualclass.videoHost.gObj.teacherVideoQuality=16;const c=document.querySelector("#virtualclassCont.teacher #videoHostSource");null==c||c.src||(virtualclass.videoHost.gObj.teacherVideoQuality=0);return virtualclass.videoHost.gObj.teacherVideoQuality},afterSessionJoin(){const c=roles.hasAdmin()?1:virtualclass.videoHost.gObj.MYSPEED;this.setDefaultValue(c);virtualclass.network.initToPing(1E4);
this.fromLocalStorage();this.resetPrecheck()},resetPrecheck(){this._resetPrecheck();var c=document.querySelector("#joinSession .next");if(null!=c){const b=document.createElement("button");c.parentNode.appendChild(b);c.parentNode.removeChild(c);b.classList.add("precheckComplete","btn","btn-default");b.innerHTML=virtualclass.lang.getString("prechkcmplt")}(c=document.querySelector("#preCheckcontainer .skip"))&&c.addEventListener("click",()=>{micTesting.makeAudioEmpty();document.getElementById("preCheckcontainer").style.display=
"none";document.getElementById("virtualclassApp").style.display="flex";virtualclass.videoHost._resetPrecheck()})},_resetPrecheck(){var c=document.querySelectorAll("#congProgressbar .active");for(let b=0;b<c.length;b++)0<b&&c[b].classList.remove("active");0<c.length&&(c=document.querySelectorAll("#myModal .precheck"),[].slice.call(c,0).forEach(b=>{b.style.display="none"}),(c=document.querySelector("#vcBrowserCheck .information"))&&c.parentNode.removeChild(c),virtualclass.precheck.totalTest&&virtualclass.precheck.totalTest.forEach(b=>
{"undefined"!==typeof virtualclass.precheck[b]&&Object.prototype.hasOwnProperty.call(virtualclass.precheck[b],"alreadyDone")&&"mic"===b&&delete virtualclass.precheck[b].alreadyDone}))},UI:{displayTeacherVideo(){if(!virtualclass.gObj.meetingMode){var c=document.querySelector(".congrea #videoHostContainer");c.classList.add("show");c.classList.remove("hide");c=document.querySelector(".congrea #virtualclassAppRightPanel");const b=document.querySelector("#virtualclassCont.congrea #virtualclassAppFooterPanel");
c.classList.add("vidShow");b.classList.add("vidShow");c.classList.remove("vidHide");b.classList.remove("vidHide")}},hideTeacherVideo(){if(!virtualclass.gObj.meetingMode){var c=document.querySelector(".congrea #videoHostContainer");c.classList.remove("show");c.classList.add("hide");c=document.querySelector(".congrea #virtualclassAppRightPanel");const b=document.querySelector("#virtualclassCont.congrea #virtualclassAppFooterPanel");c.classList.add("vidHide");c.classList.remove("vidShow");b.classList.add("vidHide");
b.classList.remove("vidShow")}}}};(function(c){"use strtic";var b=function(){return{coursePoll:[],sitePoll:[],setting:{showResult:!0,timer:!0,time:{}},uid:0,currQid:0,currOption:{},dataToStd:{},count:{},save:0,newUserTime:{},list:[],listPoll:{},currResultView:"bar",tStamp:[],pollState:{},uniqueUsers:[],init(){this.pollState={};virtualclass.previrtualclass="virtualclassPoll";virtualclass.previous=virtualclass.previrtualclass;this.cmid=virtualclass.vutil.getUrlVars(c.webapi).cmid;this.timer&&clearInterval(this.timer);roles.isStudent()?
this.UI.defaultLayoutForStudent():(this.UI.container(),ioAdapter.mustSend({poll:{pollMsg:"init"},cf:"poll"}));!virtualclass.isPlayMode&&roles.hasControls()&&this.interfaceToFetchList(this.cmid)},interfaceToSave(a){const b=this,f=new FormData;f.append("dataToSave",JSON.stringify(a));f.append("user",virtualclass.gObj.uid);virtualclass.xhr.vxhr.post(`${c.webapi}&methodname=poll_save`,f).then(a=>{a=a.data;const {options:c}=a,d={},f={};c.forEach(a=>{f[a.optid]=a.options});a.copied?(a.options=f,d.questionid=
a.qid,d.category=a.category,d.createdby=a.createdby,d.questiontext=a.question,d.creatorname=a.creatorname,d.options=a.options,b.publishPoll(d),b.interfaceToFetchList(d.category)):b.updatePollList(a);b.currQid=a.qid;b.currOption=f}).catch(a=>{console.error("Request failed with error ",a)})},interfaceToEdit(a){const b=this,f=new FormData;f.append("editdata",JSON.stringify(a));f.append("user",virtualclass.gObj.uid);virtualclass.xhr.vxhr.post(`${c.webapi}&methodname=poll_update`,f).then(a=>{b.updatePollList(a.data)}).catch(a=>
{console.error("Request failed with error ",a)})},updatePollList(a){const {options:b}=a,c={},g={};b.forEach(a=>{g[a.id]=a.options});c.questionid=a.qid;c.category=a.category;c.createdby=a.createdby;c.questiontext=a.question;c.creatorname=a.creatorname;c.options=g;this.currQid=a.qid;this.currOption=g;(c.category?this.coursePoll:this.sitePoll).push(c);this.interfaceToFetchList(c.category)},interfaceToFetchList(a){const b=this,f=new FormData;f.append("category",JSON.stringify(a));f.append("user",virtualclass.gObj.uid);
virtualclass.recorder.items=[];virtualclass.xhr.vxhr.post(`${c.webapi}&methodname=poll_data_retrieve`,f).then(c=>{c=c.data;for(let a=0;a<=c.length-1;a++){const {options:b}=c[a];for(var d in b)c[a].options[d]=b[d].options}d=c.pop();JSON.parse(a)?(b.coursePoll=c,b.displaycoursePollList()):(b.sitePoll=c,b.displaysitePollList(d))}).catch(a=>{console.error("Request failed with error ",a)})},interfaceToDelete(a){const b=this,f=new FormData;f.append("qid",JSON.stringify(a));f.append("user",virtualclass.gObj.uid);
virtualclass.xhr.vxhr.post(`${c.webapi}&methodname=poll_delete`,f).then(a=>{const c=a.data;a.data&&""!==a.data&&b.interfaceToFetchList(c)}).catch(a=>{console.error("Request failed with error ",a)})},interfaceToDelOption(a){const b=new FormData;b.append("id",JSON.stringify(a));b.append("user",virtualclass.gObj.uid);virtualclass.xhr.vxhr.post(`${c.webapi}&methodname=poll_option_drop`,b).then(()=>{}).catch(a=>{console.error("Request failed with error ",a)})},interfaceToSaveResult(a){const b=this,f=new FormData;
f.append("saveResult",JSON.stringify(a));f.append("user",virtualclass.gObj.uid);virtualclass.xhr.vxhr.post(`${c.webapi}&methodname=poll_result`,f).then(a=>{(""!==a.data||"OK"===a.statusText&&0===a.data)&&b.interfaceToFetchList(a.data)}).catch(a=>{console.error("Request failed with error ",a)})},reloadPollList(a,b){a=document.getElementById("coursePollTab");const c=document.getElementById("sitePollTab");let d=0;"course"===b?(c.classList.remove("active"),a.classList.add("active"),d=this.cmid):(a.classList.remove("active"),
c.classList.add("active"));this.interfaceToFetchList(d)},reloadVotedScrn(){this.dataRec.newTime=0;var a=document.getElementById("stdPollMszLayout");a&&a.parentNode.removeChild(a);if(a=document.getElementById("stdPollContainer"))a.style.display="none";a=this.dataRec.setting.showResult?virtualclass.lang.getString("votesuccess"):virtualclass.lang.getString("votesuccessPbt");this.showMsg("mszBoxPoll",a,"alert-success");this.pollState.currScreen="voted";this.pollState.data=this.dataRec;this.pollState.timer=
this.newUserTime},reloadStdResult(a){const b=document.getElementById("mszBoxPoll");b&&(b.style.display="none");if(this.dataRec=a.data)this.dataRec.newTime=a.data.timer;this.count=a.data.count;console.log("====> student submit poll ",this.count);this.currResultView=a.data.view;this.stdPublishResult(this.count);"bar"===this.currResultView?this.updateBarGraph():"pi"===this.currResultView&&(this.createPiChart(),this.updatePiChart());this.pollState.currScreen="stdPublishResult";this.pollState.data=this.dataRec;
this.pollState.timer=this.newUserTime;this.pollState.count=this.count;this.pollState.view=this.currResultView},loadTeacherScrn(a){a.data.view=a.data.view||"bar";this.dataToStd.question=a.data.question;this.dataToStd.options=a.data.options;this.dataToStd.qId=a.data.qId;this.setting=a.data.setting;this.nTimer=this.newTime=this.newUserTime=a.data.newTime;this.currResultView=a.data.view;this.uniqueUsers=a.data.users;var {pollType:b}=a.data;const c=document.getElementById("coursePollTab"),g=document.getElementById("sitePollTab");
let k=0;"course"===b?(g.classList.remove("active"),c.classList.add("active"),k=this.cmid):(c.classList.remove("active"),g.classList.add("active"));this.interfaceToFetchList(k);this.list=a.data.list;b={question:this.dataToStd.question,options:this.dataToStd.options,setting:this.setting,newTime:this.nTimer,count:this.count,view:this.currResultView,list:this.list,totalUsers:a.data.totalUsers,users:this.uniqueUsers,pollType:b,qId:a.data.qId};console.log("====> student submit poll ",this.count);"yes"!==
a.pollClosed&&this.reloadTeacherPublish(a);"undefined"!==typeof a.data.pollClosed&&"yes"!==a.pollClosed&&(this.UI.pollClosedUI(),a=virtualclass.lang.getString("Pclosed"),this.showMsg("resultLayoutHead",a,"alert-success"),this.timer&&clearInterval(this.timer),this.testNoneVoted(virtualclass.poll.count),(a=document.getElementById("pollResultMsz"))&&a.parentNode.removeChild(a),b.pollClosed="yes",this.pollState.pollClosed="yes");this.pollState.data=b;this.pollState.currScreen="teacherPublish";localStorage.removeItem("pollState")},
reloadTeacherPublish(a){const {pollType:b}=a.data;virtualclass.modal.closeModalHandler("editPollModal");const c=this.setting.timer;this.UI.resultView(c,b);this.list=a.data.list;this.count=a.data.count;this.currResultView=a.data.view;this.reloadGraph();this.updateVotingInformation();if(c){const [b,c,d]=this.getFormatedTime();if(c||1<d){if(a=document.getElementById("timerWrapper")){var g=document.createElement("div");g.id="timerCont";a.appendChild(g)}this.remainingTimer({hour:b,min:c,sec:d})}else if(c||
1>=d){if(a=document.getElementById("timerWrapper"))g=document.createElement("div"),g.id="timerCont",a.appendChild(g);g.innerHTML=`${10>c?`0${c}`:c}:${10>d?"00":d}`;(g=document.getElementById("pollResultMsz"))&&g.parentNode.removeChild(g)}}else this.triggerElapseTimer();if(g=document.getElementById("modalClose"))g.removeAttribute("data-dismiss"),g.addEventListener("click",()=>{virtualclass.poll.pollModalClose(b)});this.pollState.currScreen="teacherPublish"},pollModalClose(a){roles.hasControls()&&virtualclass.poll.pollState.currScreen&&
"teacherPublish"===virtualclass.poll.pollState.currScreen&&(virtualclass.poll.pollState.currScreen="course"===a?"displaycoursePollList":"displaysitePollList");const b=virtualclass.lang.getString("pclosetag");virtualclass.popup.confirmInput(b,this.resultCloseConfirm,a)},resultCloseConfirm(a){if(a){(a=document.querySelector("#editPollModal"))&&a.remove();virtualclass.poll.timer&&(ioAdapter.mustSend({poll:{pollMsg:"stdPublishResult",data:virtualclass.poll.count},cf:"poll"}),virtualclass.poll.resultToStorage(),
virtualclass.poll.interfaceToSaveResult({qid:virtualclass.poll.dataToStd.qId,list:virtualclass.poll.list}),clearInterval(virtualclass.poll.timer),virtualclass.poll.timer=0);if(a=document.getElementById("congreaPollVoters"))a.innerHTML=virtualclass.lang.getString("receivedVotes");virtualclass.poll.count={};ioAdapter.mustSend({poll:{pollMsg:"completeClose"},cf:"poll"})}},resultToStorage(){(roles.hasControls()?this.dataToStd:this.dataRec)&&this.uid++},reloadGraph(){"bar"===this.currResultView?(this.showGraph(),
this.updateBarGraph()):"pi"===this.currResultView?(this.createPiChart(),this.updatePiChart()):"list"===this.currResultView&&this.listView();var a=document.getElementsByClassName("emptyList");if(0<this.list.length)for(var b=0;b<a.length;b++)a[b].style.display="none";else virtualclass.poll.hideChart();if(a=document.querySelectorAll("#chartMenuCont button"))for(b=0;b<a.length;b++)a[b].classList.remove("disabled")},onmessage(a,b){"stdPublish"===a.poll.pollMsg?this.dataRec=a.poll.data:roles.isStudent()&&
"stdResponse"===a.poll.pollMsg&&"stdPublishResult"!==virtualclass.poll.pollState.currScreen&&virtualclass.poll.pollState.data.qId===a.poll.qId&&this.reloadVotedScrn(a.poll);"stdResponse"===a.poll.pollMsg?a.poll.qId===virtualclass.poll.pollState.data.qId&&virtualclass.poll[a.poll.pollMsg].call(this,a.poll.data,b):virtualclass.poll[a.poll.pollMsg].call(this,a.poll.data,b)},pollPopUp(a,b,c){const d=function(){virtualclass.poll.action(this.id,a,b,c);"goBack"!==this.id&&"cacelSetting"!==this.id||virtualclass.modal.removeModal()};
var f=document.getElementById("editPollModal");f=(document.getElementById("editPollModal")?f:document.getElementById("qnPopup")).querySelectorAll("#pollModalBody .controls");for(let a=0;a<f.length;a++)f[a].addEventListener("click",d)},attachConfirmInit(a,b,c,g){this.action(a,b,c,g)},action(a,b,c,g){b(a,c,g)},displaycoursePollList(){var a;const b=this;this.dispList("course");if(a=document.querySelector("#listQnContcourse tbody"))for(;a.childNodes.length;)a.removeChild(a.lastChild);const c=document.querySelector("#listQnContcourse");
if(this.coursePoll.length)c&&(c.style.display="block"),a=document.querySelector("#mszBoxPoll"),a.style.display="none",this.coursePoll.forEach((a,c)=>{b.forEachPoll(a,c,"course")});else{a=document.querySelector("#mszBoxPoll");const b=virtualclass.lang.getString("noPoll");a.style.display="block";a.innerHTML=b;c&&(c.style.display="none")}(a=document.getElementById("emptyListsite"))&&a.parentNode.removeChild(a);this.dispNewPollBtn("course");"teacherPublish"!==this.pollState.currScreen&&(this.pollState.currScreen=
"displaycoursePollList")},displaysitePollList(a){var b;const c=this;this.dispList("site");if(b=document.querySelector("#listQnContsite tbody"))for(;b.childNodes.length;)b.removeChild(b.lastChild);const g=document.querySelector("#listQnContsite");if(this.sitePoll.length)this.sitePoll.forEach((b,d)=>{c.forEachPoll(b,d,"site",a)}),g&&(g.style.display="block"),b=document.querySelector("#mszBoxPoll"),b.style.display="none";else{b=document.querySelector("#mszBoxPoll");let c=virtualclass.lang.getString("noPoll");
"false"===a&&(c=virtualclass.lang.getString("noPollNoAdmin"));b.style.display="block";b.innerHTML=c;g&&(g.style.display="none")}(b=document.getElementById("emptyListcourse"))&&b.parentNode.removeChild(b);this.dispNewPollBtn("site",a);"teacherPublish"!==this.pollState.currScreen&&(this.pollState.currScreen="displaysitePollList")},dispList(a){var b=document.getElementById("mszBoxPoll");0<b.childNodes.length&&b.childNodes[0].parentNode.removeChild(b.childNodes[0]);b="course"===a?"site":"course";this.hidePollList(b);
var c=document.getElementById(`listQnCont${a}`);c&&(c.style.display="table",(c=document.getElementById(`newPollBtn${a}`))&&c.classList.contains(b)&&(c.classList.remove(b),c.classList.add(a)))},dispNewPollBtn(a,b){this.attachEvent(`newPollBtn${a}`,"click",this.newPollHandler,a);var c=document.getElementById(`newPollBtn${a}`);"site"===a?("undefined"!==typeof b&&"true"===b?c.style.display="table":(c.style.display="none",roles.hasControls&&(a=document.getElementById("listQnContsite"),a.classList.add("teacherTableHeader"))),
c=document.getElementById("newPollBtncourse")):(roles.hasControls&&(a=document.getElementById("listQnContsite"),a.classList.remove("teacherTableHeader")),c.style.display="table",c=document.getElementById("newPollBtnsite"));c&&(c.style.display="none")},forEachPoll(a,b,c,g){const d={};d.questiontext=a.questiontext;var f=Object.prototype.hasOwnProperty.call(a,"creatorfname")?virtualclass.poll.capitalizeFirstLetterFnameLname(a.creatorfname):virtualclass.poll.capitalizeFirstLetterFnameLname(a.creatorname);
d.creator=f;d.pollType=c;d.index=b;f=virtualclass.getTemplate("qn","poll");(document.querySelector(`#listQnCont${c} .pollList tbody`)||document.querySelector(`#listQnCont${c} .pollList`)).insertAdjacentHTML("beforeend",f({pollQn:d}));if("course"===c&&a.createdby===wbUser.id||"site"===c&&"true"===g){if(a.isPublished){if(g=document.querySelector(`#editQn${c}${b} span`))g.setAttribute("title",virtualclass.lang.getString("etDisabledA")),g.style.cursor="default",g.classList.add("disabled")}else this.attachEvent(`editQn${c}${b}`,
"click",this.editHandler,a,c,b,a.createdby,a.questionid);this.attachEvent(`deleteQn${c}${b}`,"click",this.deleteHandler,a,c,b)}else{if(g=document.querySelector(`#editQn${c}${b} span`))g.setAttribute("title",virtualclass.lang.getString("etDisabledCr")),g.style.cursor="default",g.classList.add("disabled");g=document.querySelector(`#deleteQn${c}${b} span`);g.setAttribute("title",virtualclass.lang.getString("dltDisabled"));g.style.cursor="default";g.classList.add("disabled")}g="course"==c?virtualclass.poll.coursePoll:
virtualclass.poll.sitePoll;b!==g.length-1&&b!==g.length-2&&b!==g.length-3||document.querySelector(`#contQn${c}${b}`).classList.add("lastNode");this.attachEvent(`publishQn${c}${b}`,"click",this.publishHandler,a,c,b);this.previewOnHover(a,c,b)},previewOnHover(a,b,c){const d={};document.querySelector(`#qnText${b}${c} .popover-content`)||(d.questiontext=a.questiontext,d.options=a.options,a=virtualclass.getTemplate("previewPopup","poll")({data:d}),virtualclass.modal.attachpopupHandler(b,c,a))},attachEvent(a,
b,c,g,k,m,n,r,t){r=document.getElementById(a);null!=r&&r.addEventListener(b,()=>{"undefined"!==typeof g?c(g,k,m,a,n,t):c(k,m,a,n,t)})},hidePollList(a){if(a=document.getElementById(`listQnCont${a}`))a.style.display="none"},editHandler(a,c,f){a=document.getElementById("mszBoxPoll");0<a.childNodes.length&&a.childNodes[0].parentNode.removeChild(a.childNodes[0]);a={};b="course"===c?virtualclass.poll.coursePoll[f]:virtualclass.poll.sitePoll[f];a.options=b.options;a.questiontext=b.questiontext;const d=virtualclass.getTemplate("edit-modal",
"poll");document.querySelector("#bootstrapCont").insertAdjacentHTML("beforeend",d({data:a}));virtualclass.poll.UI.editPoll(c,f);virtualclass.modal.closeModalHandler("editPollModal")},stdResponse(a,b){"voted"!==this.pollState.currScreen&&"stdPublishResult"!==this.pollState.currScreen&&"displaysitePollList"!==this.pollState.currScreen&&this.updateResponse(a,b)},newPollHandler(a){const b=document.querySelector("#createPollCont");var c=document.querySelector("#editPollModal");c&&c.remove();c=virtualclass.getTemplate("modal",
"poll");b.insertAdjacentHTML("beforeend",c());virtualclass.modal.closeModalHandler("editPollModal");virtualclass.poll.pollPopUp(virtualclass.poll.popupFn,void 0,a)},popupFn(a,b,c){"goBack"!==a&&virtualclass.poll[a].call(virtualclass.poll,b,c,a)},next(a,b){virtualclass.poll.pollSetting(b,a)},etSave(a,b,c){if(!virtualclass.poll.isBlank())return 0;const d="course"===b?virtualclass.poll.coursePoll[a]:virtualclass.poll.sitePoll[a],f="course"===b?virtualclass.poll.cmid:0,m=document.getElementById("q");
document.getElementById("etSave").setAttribute("data-dismiss","modal");if("undefined"!==typeof a)virtualclass.poll.saveQuestion(m,a,b),virtualclass.poll.saveOption(a,b),virtualclass.poll.interfaceToEdit({questionid:d.questionid,question:d.questiontext,options:d.options,createdby:d.createdby},f);else if(!virtualclass.poll.newPollSave("undefined",b))return 0;"etSave"===c&&virtualclass.modal.removeModal();return 1},closePoll(a){const b=virtualclass.lang.getString("pclose");virtualclass.popup.confirmInput(b,
virtualclass.poll.askConfirmClose,"close",a)},saveQuestion(a,b,c){"course"===c?(this.coursePoll[b].questiontext=a.value,this.coursePoll[b].creator=wbUser.name):(this.sitePoll[b].questiontext=a.value,this.sitePoll[b].creator=wbUser.name);document.getElementById(`qnText${c}${b}`).innerHTML=a.value},saveOption(a,b){const c=[];let d=0;var k;b="course"===b?this.coursePoll[a]:this.sitePoll[a];const m=document.getElementById("optsTxCont").querySelectorAll("#virtualclassCont #optsTxCont .opt");for(a=0;a<
m.length;a++)c[a]=m[a].value;for(k in b.options)b.options[k]=c[d],d++;if(a>d)for(d,k=d;k<a;k++)b.options[`noid${d}`]=c[d],d++},hideModal(){virtualclass.modal.removeModal()},newPollSave(a,b){a=0;const c=[];if(!virtualclass.poll.isBlank())return 0;var d=document.getElementById("optsTxCont").querySelectorAll("#virtualclassCont #optsTxCont .opt");for(let a=0;a<d.length;a++)c.push(d[a].value);d=document.getElementById("q");"course"===b&&(a=virtualclass.poll.cmid);virtualclass.poll.interfaceToSave({question:d.value,
options:c,action:"newPollSave",category:a,copied:!1},a);return 1},isBlank(){document.getElementById("q");var a=document.getElementById("optsTxCont").querySelectorAll("#virtualclassCont #optsTxCont .opt");let b=0,c=0;for(let d=0;d<a.length;d++)null==a[d].value||""===a[d].value.trim()?c++:b++;a=document.getElementById("q");return null==a.value||""===a.value.trim()?(virtualclass.lang.getString("pollblank"),alert(virtualclass.lang.getString("pollblank")),0):2>b?(alert(virtualclass.lang.getString("minoption")),
0):c?(alert(virtualclass.lang.getString("delblank")),0):1},saveNdPublish(a,b){if(!virtualclass.poll.isBlank())return 0;var c=`${b}Poll`,d=document.getElementById("optsTxCont").querySelectorAll("#virtualclassCont #optsTxCont .opt");if("undefined"===typeof a){({length:c}=virtualclass.poll[c]);var k=document.getElementById("q").value,m={};for(var n=0;n<d.length;n++)m[n]=d[n].value;d=m;virtualclass.poll.dataToStd.question=k;virtualclass.poll.dataToStd.options=d;virtualclass.poll.newPollSave(c,b,!0)&&
virtualclass.poll.pollSetting(b,c,!0)}else{k=virtualclass.poll[c][a];n=document.getElementById("q").value;k.question=n;n=0;for(m in k.options)k.options[m]=d[n].value,n++;virtualclass.poll[c][a].questiontext=document.getElementById("q").value;virtualclass.poll.dataToStd.question=virtualclass.poll[c][a].questiontext;virtualclass.poll.dataToStd.options=virtualclass.poll[c][a].options;virtualclass.poll.etSave(a,b,setting)&&virtualclass.poll.pollSetting(b,a,!0)}a={type:"course",qid:a,pollqnOps:virtualclass.poll.dataToStd};
virtualclass.poll.pollState.currScreen="setting";virtualclass.poll.pollState.data=a},pollCancel(){virtualclass.popup.closeElem();virtualclass.modal.closeModalHandler("editPollModal")},reset(){const a=document.querySelectorAll("#editPollModal textArea");for(let b=0;b<a.length;b++)a[b].value=""},addMoreOption(a,b){virtualclass.poll.UI.createOption(a,b)},removeOption(a,b,c){const d=c.replace("remove","");c=document.getElementById(c);c.parentNode.parentNode.removeChild(c.parentNode);a="course"===a?virtualclass.poll.coursePoll[b]:
virtualclass.poll.sitePoll[b];"undefined"!==typeof a&&(delete a.options[d],virtualclass.poll.interfaceToDelOption(d))},publishHandler(a,b,c){var d=document.getElementById("mszBoxPoll");0<d.childNodes.length&&d.childNodes[0].parentNode.removeChild(d.childNodes[0]);({isPublished:d}=a);d?virtualclass.poll.duplicatePoll(a):virtualclass.poll.publishPoll(a,b,c)},duplicatePoll(a){const b=[];for(const c in a.options)b.push(a.options[c]);virtualclass.poll.interfaceToSave({question:a.questiontext,options:b,
action:"newPollSave",category:a.category,copied:!0},a.category)},publishPoll(a,b){virtualclass.poll.dataToStd.question=a.questiontext;virtualclass.poll.dataToStd.qId=a.questionid;virtualclass.poll.dataToStd.options=a.options;document.getElementById("layoutPollBody");var c=document.getElementById("editPollModal");c&&c.remove();c={};c.questiontext=a.questiontext;c.options=a.options;const d=virtualclass.getTemplate("preview-modal","poll"),k=document.querySelector("#virtualclassApp #bootstrapCont");k&&
k.insertAdjacentHTML("beforeend",d({poll:c}));b||(b="0"===a.category?"site":"course");virtualclass.poll.pollPreview(b);virtualclass.modal.closeModalHandler("editPollModal")},pollPreview(a){const b=document.getElementById("contFooter");virtualclass.poll.UI.previewFooterBtns(b,a)},deleteHandler(a,b,c){a=document.getElementById("mszBoxPoll").querySelectorAll("#mszBoxPoll .alert");0<a.length&&a[0].parentNode.removeChild(a[0]);a=virtualclass.lang.getString("pollDel");virtualclass.popup.confirmInput(a,
virtualclass.poll.askConfirm,b,c)},showMsg(a,b,c){let d=document.getElementById(a);if(!d){const b=document.getElementById("layoutPollBody");d=document.createElement("div");d.id=a;b.appendChild(d)}a=document.createElement("div");a.className="alert  alert-dismissable";a.classList.add(c);a.innerHTML=b;d.insertBefore(a,d.firstChild)},askConfirm(a,b,c){if(a){a=document.getElementById(`contQn${b}${c}`);a.parentNode.removeChild(a);a=virtualclass.lang.getString("Pdsuccess");virtualclass.poll.showMsg("mszBoxPoll",
a,"alert-success");a="course"===b?virtualclass.poll.coursePoll[c]:virtualclass.poll.sitePoll[c];const d=a.questionid;a="course"===b?virtualclass.poll.coursePoll:virtualclass.poll.sitePoll;a.splice(c,1);virtualclass.poll.interfaceToDelete(d)}},askConfirmClose(a,b,c){if(a){(virtualclass.poll.setting.showResult&&roles.hasControls()||!roles.hasControls())&&ioAdapter.mustSend({poll:{pollMsg:"stdPublishResult",data:virtualclass.poll.count},cf:"poll"});virtualclass.poll.resultToStorage();virtualclass.poll.UI.pollClosedUI();
virtualclass.poll.interfaceToSaveResult({qid:virtualclass.poll.dataToStd.qId,list:virtualclass.poll.list});a=virtualclass.lang.getString("Pclosed");virtualclass.poll.showMsg("resultLayoutHead",a,"alert-success");virtualclass.poll.pollState.data.pollClosed="yes";clearInterval(virtualclass.poll.timer);a=virtualclass.poll.timer=0;for(var d in virtualclass.poll.count)virtualclass.poll.count[d]&&(a=1);if(a)"list"!==virtualclass.poll.currResultView&&virtualclass.poll.showChart();else{virtualclass.poll.noneVoted(c);
if(c=document.getElementById("resultLayoutHead"))for(d=0;d<c.childNodes.length;d++)c.childNodes[d].parentNode.removeChild(c.childNodes[d]);c=document.getElementById("pollResultMsz");c.parentNode.removeChild(c);c=document.getElementById("chartMenuCont");c.parentNode.removeChild(c)}}},showStudentPollReport(a){virtualclass.poll.studentReportLayout(a);(a=document.getElementById("mszBoxPoll"))&&a.parentNode.removeChild(a)},studentReportLayout(a){for(var b=document.getElementById("layoutPollBody");1<b.childElementCount;)b.removeChild(b.lastChild);
const c=document.createElement("div");b.appendChild(c);b=a.result;virtualclass.poll.count=b;console.log("====> student submit poll ",virtualclass.poll.count);virtualclass.poll.dataRec=a.pollData;virtualclass.poll.stdPublishResult(b,"true")},timerDisable(){document.getElementById("timer").classList.add("disabled")},stdPublish(){virtualclass.poll.pollState.data=virtualclass.poll.dataRec;virtualclass.poll.pollState.timer=virtualclass.poll.newUserTime;if(roles.hasControls()&&!virtualclass.config.makeWebSocketReady)console.log("there is happening something"),
this.loadTeacherScrn(virtualclass.poll.pollState);else{var a=document.getElementById("mszBoxPoll");a&&0<a.childNodes.length&&a.childNodes[0].parentNode.removeChild(a.childNodes[0]);virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);(a=document.getElementById("resultLayout"))&&a.parentNode.removeChild(a);(a=document.getElementById("stdPollContainer"))&&a.parentNode.removeChild(a);if(a=document.querySelector(".congrea.student #virtualclassPoll #navigator #stdPollHeader"))a.style.display=
"block";a={};a.question=virtualclass.poll.dataRec.options;const b=virtualclass.getTemplate("pollStd","poll");document.querySelector("#layoutPollBody").insertAdjacentHTML("beforeend",b({poll:a}));this.UI.stdPublishUI();virtualclass.poll.dataRec.setting.timer?(virtualclass.poll.newTimer=virtualclass.poll.dataRec.newTime,a=this.getFormatedTime(),this.remainingTimer({min:a[1],sec:a[2]}),document.querySelector("#timerLabel").innerHTML=virtualclass.lang.getString("Rtime")):(this.triggerElapseTimer(),a=
virtualclass.lang.getString("Tmyclose"),virtualclass.poll.showMsg("stdContHead",a,"alert-success"),document.querySelector("#timerLabel").innerHTML=virtualclass.lang.getString("ETime"));a=document.getElementById("stdQnCont");this.showQn(a);a=document.getElementById("stdOptionCont");this.showOption(a);(a=document.getElementById("btnVote"))&&a.addEventListener("click",virtualclass.poll.voted);if(a=document.querySelector("#virtualclassCont.congrea.student #navigator #pollResult"))a.style.display="none";
virtualclass.poll.pollState.currScreen="stdPublish"}},getFormatedTime(){if(virtualclass.isPlayMode)var a=1E3*virtualclass.poll.pollState.data.setting.time.totalInSeconds;else a=virtualclass.vutil.UTCtoLocalTimeToSeconds(virtualclass.poll.pollState.data.setting.time.timestamp),a=(new Date).getTime()-a,a=1E3*virtualclass.poll.pollState.data.setting.time.totalInSeconds-a;return 0<a?virtualclass.vutil.miliSecondsToFormatedTime(a):[0,0,0]},triggerElapseTimer(){var a=virtualclass.vutil.UTCtoLocalTimeToSeconds(virtualclass.poll.pollState.data.setting.time.timestamp);
a=(new Date).getTime()-a;const [,b,c]=virtualclass.vutil.miliSecondsToFormatedTime(a);this.elapsedTimer(b,c)},voted(){virtualclass.poll.pollState.currScreen="voted";if(!document.querySelector("#virtualclassCont.congrea #stdPollContainer #btnVote").classList.contains("disabled"))if(virtualclass.poll.saveSelected()){virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);var a=document.getElementById("stdPollMszLayout");a&&a.parentNode.removeChild(a);a=document.getElementById("stdPollContainer");
a.parentNode.removeChild(a);a=virtualclass.poll.dataRec.setting.showResult?virtualclass.lang.getString("votesuccess"):virtualclass.lang.getString("votesuccessPbt");document.querySelector(".congrea.student #mszBoxPoll").style.display="block";virtualclass.poll.showMsg("mszBoxPoll",a,"alert-success");virtualclass.poll.sendResponse()}else alert("Select an option");virtualclass.poll.pollState.currScreen="voted";virtualclass.poll.pollState.data=virtualclass.poll.dataRec;virtualclass.poll.pollState.timer=
virtualclass.poll.newUserTime},sendResponse(){const a=virtualclass.vutil.whoIsTeacher();ioAdapter.mustSendUser({poll:{pollMsg:"stdResponse",data:virtualclass.poll.responseId,qId:virtualclass.poll.pollState.data.qId},cf:"poll"},a)},saveSelected(){const a=document.getElementById("stdOptionCont").querySelectorAll("#stdOptionCont .opt");let b;for(b=0;b<a.length;b++)if(a[b].checked)return virtualclass.poll.responseId=a[b].id,1;if(b===a.length)return 0},elapsedTimer(a,b){let c=a||0,d=b||0,k;Object.prototype.hasOwnProperty.call(virtualclass.poll,
"timer")&&clearInterval(virtualclass.poll.timer);if(a=document.getElementById("timerLabel"))a.innerHTML=virtualclass.lang.getString("ETime");if(roles.hasControls())k=document.getElementById("timerCont");else if(a=document.getElementById("stdContHead"))k=document.querySelector("#timerCont"),null===k&&(k=document.createElement("div"),k.id="timerCont",a.appendChild(k));a=function(){k?(d++,60===d&&(d=0,c++,60===c&&(c=0)),k.innerHTML=`${10>c?`0${c}`:c}:${10>d?`0${d}`:d}`):clearInterval(virtualclass.poll.timer)};
a();virtualclass.poll.timer=setInterval(a,1E3)},remainingTimer(a){virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);const b=document.getElementById("timerCont");let c=a.min||0,g=a.sec||0;a=function(){b?(b.innerHTML=`${10>c?`0${c}`:c}:${10>g?`0${g}`:g}`,g--,0>=g&&(g=59,c--,0>c&&(g=c=0,b.innerHTML=`${10>c?`0${c}`:c}:${10>g?`0${g}`:g}`,clearInterval(virtualclass.poll.timer),virtualclass.poll.timerExpired()))):clearInterval(virtualclass.poll.timer)};if(null!=c||null!=g)a(),virtualclass.poll.timer=
setInterval(a,1E3)},timerExpired(){var a=document.getElementById("btnVote");a&&a.classList.add("disabled");roles.hasControls()&&(virtualclass.poll.setting.showResult&&ioAdapter.mustSend({poll:{pollMsg:"stdPublishResult",data:virtualclass.poll.count},cf:"poll"}),virtualclass.poll.timer&&virtualclass.poll.interfaceToSaveResult({qid:virtualclass.poll.dataToStd.qId,list:virtualclass.poll.list}),this.testNoneVoted(virtualclass.poll.count));virtualclass.poll.timer=0;if(a=document.getElementById("congreaPollVoters"))a.innerHTML=
virtualclass.lang.getString("rvtu");virtualclass.poll.pollState.data.pollClosed="yes"},testNoneVoted(a){var b=0,c;for(c in a)a[c]&&(b=1);if(b)"list"!==virtualclass.poll.currResultView&&virtualclass.poll.showChart();else{this.noneVoted();if(a=document.getElementById("resultLayoutHead"))for(b=0;b<a.childNodes.length;b++)a.childNodes[b].parentNode.removeChild(a.childNodes[b]);a=document.getElementById("pollResultMsz");a.parentNode.removeChild(a);a=document.getElementById("chartMenuCont");a.parentNode.removeChild(a);
a=document.querySelector("#editPollModal");"teacherPublish"===virtualclass.poll.pollState.currScreen&&a.remove()}},stdPublishResult(a,b){const c=virtualclass.poll.count;virtualclass.poll.count=a;console.log("====> student submit poll ",virtualclass.poll.count);if(roles.hasControls()&&!virtualclass.config.makeWebSocketReady){if(b=document.getElementById("closePoll"))b.style.display="none";clearInterval(virtualclass.poll.timer);virtualclass.poll.timer=0;this.testNoneVoted(a);virtualclass.poll.count=
c}else{virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);if(virtualclass.poll.dataRec||b)virtualclass.poll.dataRec.setting.showResult?this.resultDisplay(a):(this.noResultDisplay(),a=document.getElementById("resultLayoutHead"),virtualclass.poll.UI.resultNotShownUI(a),virtualclass.poll.pollState.currScreen="stdPublishResult",virtualclass.poll.pollState.data="noResult");virtualclass.poll.resultToStorage()}},completeClose(){if(roles.hasControls()&&!virtualclass.config.makeWebSocketReady){this.pollState.currScreen=
"displaysitePollList";const a=document.querySelector("#editPollModal");a&&a.remove();this.reloadPollList(virtualclass.poll.pollState,virtualclass.poll.pollState.data.pollType)}},resultDisplay(a){var b=document.querySelector(".congrea #stdPollContainer");b&&(b.style.display="none");var c=document.getElementById("resultLayout");c&&c.parentNode.removeChild(c);virtualclass.poll.UI.createResultLayout();c=document.getElementById("timerWrapper");c.parentNode.removeChild(c);document.getElementById("resultLayout").classList.add("bootstrap",
"container");virtualclass.poll.count=a;console.log("====> student submit poll ",virtualclass.poll.count);(a=document.getElementById("mszBoxPoll"))&&0<a.childNodes.length&&(a=a.querySelectorAll("#mszBoxPoll .alert"),0<a.length&&a[0].parentNode.removeChild(a[0]));document.getElementById("chartMenuCont")&&virtualclass.poll.UI.chartMenu(b);b=0;for(const a in virtualclass.poll.count)virtualclass.poll.count[a]&&(b=1);b?(virtualclass.poll.showGraph(),virtualclass.poll.showChart()):this.noneVoted();virtualclass.poll.pollState.currScreen=
"stdPublishResult";virtualclass.poll.pollState.data=virtualclass.poll.dataRec;virtualclass.poll.pollState.timer=virtualclass.poll.newUserTime;virtualclass.poll.pollState.count=virtualclass.poll.count},noResultDisplay(){var a=document.getElementById("stdPollContainer");a&&a.parentNode.removeChild(a);virtualclass.poll.UI.createResultLayout();if(a=document.getElementById("resultLayoutHead"))for(var b=0;b<a.childNodes.length;b++)a.childNodes[b].parentNode.removeChild(a.childNodes[b]);if(a=document.getElementById("resultLayoutBody"))for(b=
0;b<a.childNodes.length;b++)a.childNodes[b].parentNode.removeChild(a.childNodes[b])},noneVoted(a){console.log("====> No voted poll here");"undefined"!==typeof virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);this.noResultDisplay();var b=document.querySelector("#resultLayoutHead");b&&(b.style.display="none");document.querySelector("#qnLabelCont");if(b=document.querySelector("#chartMenuCont"))b.style.display="none";b=document.getElementById("resultLayoutBody");var c=document.createElement("div");
c.className="pollResultNotify";c.id="resultNote";b.appendChild(c);b.insertBefore(c,b.firstChild);c=virtualclass.lang.getString("Pclosed");virtualclass.poll.showMsg("resultNote",c,"alert-error");c=document.getElementById("resultNote");const g=document.createElement("div");g.className="notifyText alert alert-info";g.id="congreaPollNote";g.innerHTML=virtualclass.lang.getString("Novote");c.appendChild(g);c=virtualclass.poll.dataRec;roles.hasControls()||this.showPollText(b,c);(b=document.getElementById("modalClose"))&&
b.addEventListener("click",()=>{const b=document.querySelector("#editPollModal");b&&b.remove();roles.hasControls()&&a&&virtualclass.poll.pollState.currScreen&&"teacherPublish"===virtualclass.poll.pollState.currScreen&&(virtualclass.poll.pollState.currScreen="course"===a?"displaycoursePollList":"displaysitePollList")})},showPollText(a){var b=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec;a={};a.question=b.question;a.options=b.options;b=virtualclass.getTemplate("qnOptions",
"poll");document.querySelector("#resultLayoutBody #optnNonVotd").insertAdjacentHTML("beforeend",b({poll:a}))},showQn(a){roles.hasControls()?a.innerHTML=virtualclass.poll.dataToStd.question:a.innerHTML=virtualclass.poll.dataRec.question},showOption(a){const b=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec;var {options:c}=b;for(const d in c){c=document.createElement("div");a.appendChild(c);var g=document.createElement("input");g.className="opt";g.setAttribute("name","option");
g.setAttribute("value",d);g.setAttribute("type","radio");g.id=d;c.appendChild(g);g=document.createElement("span");g.className="stdoptn";c.appendChild(g);g.innerHTML=b.options[d]}},pollSetting(a,b,c){virtualclass.poll.UI.hidePrevious(b);null==document.getElementById(`settingTx${b}`)&&virtualclass.poll.UI.pollSettingUI(b,a);"undefined"!==typeof c&&document.getElementById("publish").setAttribute("disable",!0);document.getElementById("publish").addEventListener("click",()=>{virtualclass.poll.saveSetting(a,
c)});document.getElementById("cancelSetting").addEventListener("click",()=>{virtualclass.modal.removeModal("editPollModal")});virtualclass.modal.closeModalHandler("editPollModal")},saveSetting(a,b){let c;document.getElementById("radioBtn2")&&(c=document.getElementById("radioBtn2").checked,virtualclass.poll.setting.timer=c);const d=document.getElementById("timer");if(d){var k=d.options[d.selectedIndex].value;const a=document.getElementById("ut");virtualclass.poll.setting.time.totalInSeconds="minut"===
a.options[a.selectedIndex].value?60*+k:+k;virtualclass.poll.setting.time.timestamp=virtualclass.vutil.localToUTC(Date.now())}document.getElementById("pollCkbox")&&(k=document.getElementById("pollCkbox").checked,virtualclass.poll.setting.showResult=k);virtualclass.poll.UI.resultView(c,a);virtualclass.poll.currResultView="bar";if(c){const [a,b,c]=virtualclass.vutil.miliSecondsToFormatedTime(1E3*virtualclass.poll.setting.time.totalInSeconds);virtualclass.poll.remainingTimer({hour:a,min:b,sec:c})}else virtualclass.poll.elapsedTimer();
"undefined"!==typeof b&&(virtualclass.poll.dataToStd.qId=virtualclass.poll.currQid,virtualclass.poll.dataToStd.options=virtualclass.poll.currOption);a={question:virtualclass.poll.dataToStd.question,options:virtualclass.poll.dataToStd.options,qId:virtualclass.poll.dataToStd.qId,setting:virtualclass.poll.setting,count:virtualclass.poll.count,list:virtualclass.poll.list,users:virtualclass.poll.uniqueUsers,pollType:a};"undefined"!==typeof virtualclass.poll.afterReload&&(a.newTime=virtualclass.poll.afterReload,
delete virtualclass.poll.afterReload);d&&ioAdapter.mustSend({poll:{pollMsg:"stdPublish",data:a},cf:"poll"});a.view=virtualclass.poll.currResultView;virtualclass.poll.showGraph();virtualclass.poll.updateBarGraph();virtualclass.poll.pollState.currScreen="teacherPublish";virtualclass.poll.pollState.data=a},updateResponse(a,b){"list"!==virtualclass.poll.currResultView&&virtualclass.poll.showChart();var c=document.getElementById("pollResultMsz");c&&(c.style.display="none");c=document.querySelectorAll("#chartMenuCont button");
for(let a=0;a<c.length;a++)c[a].classList.remove("disabled");c={};"undefined"===typeof virtualclass.poll.count[a]&&(virtualclass.poll.count[a]=0);virtualclass.poll.count[a]+=1;c[b.userid]=a;c.username=b.name;virtualclass.poll.list.push(c);"bar"===virtualclass.poll.currResultView?(virtualclass.poll.showGraph(),virtualclass.poll.updateBarGraph()):"pi"===virtualclass.poll.currResultView?virtualclass.poll.updatePiChart():"list"===virtualclass.poll.currResultView&&virtualclass.poll.updateListResult()},
updateVotingInformation(){console.log("====> POLL UPDATE VOTING INFORMATION ");var a=Object.prototype.hasOwnProperty.call(virtualclass,"connectedUsers")?virtualclass.connectedUsers.length:0;let b=0;for(var c in virtualclass.poll.count)b+=virtualclass.poll.count[c];a=a?a-1:0;(c=virtualclass.poll.uniqueUsers.length?virtualclass.poll.uniqueUsers.length:0)&&(a=c);c=document.getElementById("receivedVotes");null!=c&&(c.innerHTML=`${b}\/${a}`)},updateBarGraph(){const a=document.getElementById("pollResultMsz"),
b=[],c=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec;for(const d in virtualclass.poll.count)b.push([c.options[d],virtualclass.poll.count[d]]),virtualclass.poll.count[d]&&(virtualclass.poll.showChart(),a&&(a.style.display="none"));for(const a in c.options)Object.prototype.hasOwnProperty.call(virtualclass.poll.count,a)||(b.push([c.options[a],"0"]),virtualclass.poll.count[a]=0);virtualclass.poll.chart&&virtualclass.poll.chart.load({columns:b});roles.hasControls()&&this.updateVotingInformation()},
updatePiChart(){const a=document.getElementById("pollResultMsz");this.updateVotingInformation();const b=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec,c=[];for(const d in virtualclass.poll.count)c.push([b.options[d],virtualclass.poll.count[d]]),virtualclass.poll.count[d]&&(virtualclass.poll.showChart(),a&&(a.style.display="none"));for(const a in b.options)Object.prototype.hasOwnProperty.call(virtualclass.poll.count,a)||(c.push([b.options[a],"0"]),virtualclass.poll.count[a]=
0);virtualclass.poll.piChart&&virtualclass.poll.piChart.load({columns:c})},updateListResult(){this.updateVotingInformation();const a=virtualclass.poll.list.pop();virtualclass.poll.addResultListItem(a);virtualclass.poll.list.push(a);virtualclass.poll.pollState.data.list=virtualclass.poll.list},createPiChart(){const a=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec;virtualclass.poll.currResultView="pi";virtualclass.poll.hideChart();var b=document.getElementById("listCont");
b&&(b.style.display="none");b=[];let c=!1;for(const d in virtualclass.poll.count)b.push([a.options[d],virtualclass.poll.count[d]]),virtualclass.poll.count[d]&&(c=!0);c&&virtualclass.poll.showChart();virtualclass.poll.piChart=c3.generate({data:{columns:b,transition:{duration:null},type:"pie",onclick(a,b){},onmouseover(a,b){},onmouseout(a,b){}}});virtualclass.poll.currResultView="pi";"undefined"!==typeof virtualclass.poll.pollState.data&&(virtualclass.poll.pollState.data.view="pi")},listView(){virtualclass.poll.currResultView=
"list";virtualclass.poll.hideChart();const a=document.getElementById("resultLayoutBody");var b=document.getElementById("listCont");b.hasChildNodes()&&b.removeChild(b.childNodes[0]);0<virtualclass.poll.list.length&&(virtualclass.poll.createResponseTable(a),(b=document.getElementById("pollResultMsz"))&&b.parentNode.removeChild(b));if(b=document.getElementById("listCont"))b.style.display="block"},createResponseTable(a){a=virtualclass.getTemplate("pollresultlist","poll");document.querySelector("#virtualclassApp #listCont").insertAdjacentHTML("beforeend",
a({}));virtualclass.poll.list.forEach((a,b)=>{virtualclass.poll.addResultListItem(a,b)});virtualclass.poll.currResultView="list";"undefined"!==typeof virtualclass.poll.pollState.data&&(virtualclass.poll.pollState.data.view="list",virtualclass.poll.pollState.data.list=virtualclass.poll.list)},addResultListItem(a){let b;const c=virtualclass.poll.dataToStd.options;var g=document.getElementById("resultList");for(var k in a)"username"!==k&&(b=a[k]);k=document.createElement("tr");g.appendChild(k);g=document.createElement("td");
a=virtualclass.poll.capitalizeFirstLetterFnameLname(a.username);g.innerHTML=a;k.appendChild(g);g=document.createElement("td");g.innerHTML=c[b];k.appendChild(g)},capitalizeFirstLetterFnameLname(a){if(a&&null!=a){var [b,c]=a.split(/\s*(?: |$)\s*/);a=virtualclass.vutil.capitalizeFirstLetter(b);if("undefined"!==typeof c){const b=virtualclass.vutil.capitalizeFirstLetter(c);return`${a} ${b}`}return`${a}`}},barGraph(){virtualclass.poll.showChart();virtualclass.poll.currResultView="bar";const a=document.getElementById("listCont");
a&&(a.style.display="none");virtualclass.poll.showGraph();virtualclass.poll.updateBarGraph();virtualclass.poll.pollState.data.view="bar"},showGraph(){var a=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec;const b=[];for(const c in virtualclass.poll.count)b.push([a.options[c],virtualclass.poll.count[c]]);a={type:"bar"};a.columns=b;virtualclass.poll.hideChart();virtualclass.poll.chart=c3.generate({bindto:"#chart",data:a,bar:{width:{ratio:.5}},axis:{y:{tick:{format:function(a){return parseInt(a)===
a?a:null}},label:"Votes"}}})},hideChart(){const a=document.getElementById("chart");a&&(a.style.display="none");console.log("====> chat graph hide ",document.querySelector("#chart").offsetWidth)},showChart(){const a=document.getElementById("chart");a&&(a.style.display="block")},UI:{id:"virtualclassPoll",class:"virtualclass",container(){var a=document.getElementById(this.id);null!=a&&a.parentNode.removeChild(a);a=virtualclass.getTemplate("pollmain","poll");const b=!!roles.hasAdmin();virtualclass.vutil.insertAppLayout(a({control:b}));
if(roles.hasAdmin()){const a=document.querySelector("#coursePollTab"),b=document.querySelector("#sitePollTab");b.addEventListener("click",()=>{a.classList.remove("active");b.classList.add("active");b.style.pointerEvents="none";a.style.pointerEvents="visible";virtualclass.poll.interfaceToFetchList(0)});a.addEventListener("click",()=>{b.classList.remove("active");a.classList.add("active");a.style.pointerEvents="none";b.style.pointerEvents="visible";virtualclass.poll.interfaceToFetchList(virtualclass.poll.cmid)})}else{document.querySelector("#virtualclassCont.congrea.student #navigator #pollResult").style.display=
"none";const a=document.querySelector(".congrea.student #virtualclassPoll #navigator #pollResult");a.addEventListener("click",()=>{virtualclass.poll.showStudentPollReport(virtualclass.poll.previousResult);a.classList.add("active")})}},resultView(a,b){if(roles.hasControls()&&(this.createResultLayout(),!a)){var c=document.getElementById("resultLayoutHead");a=document.getElementById("closePoll");a||(a=document.createElement("button"),a.id="closePoll",a.className="btn btn-default col-md-2",c.appendChild(a),
a.innerHTML=virtualclass.lang.getString("closeVoting"),a.addEventListener("click",()=>{virtualclass.poll.closePoll(b)}),c=document.createElement("i"),c.className="icon-close-poll",a.appendChild(c))}if(a=document.getElementById("modalClose"))a.removeAttribute("data-dismiss"),a.addEventListener("click",()=>{virtualclass.poll.pollModalClose(b)});virtualclass.poll.count={};virtualclass.poll.list=[]},createResultLayout(){var a=document.getElementById("resultLayout");a&&a.parentNode.removeChild(a);var b=
!!roles.hasControls();a={};a.control=b;if(roles.hasControls()){a.question=virtualclass.poll.dataToStd.question;a.options=virtualclass.poll.dataToStd.options;b=virtualclass.getTemplate("result-modal","poll");const c=document.querySelector("#editPollModal");c&&c.remove();document.querySelector("#bootstrapCont").insertAdjacentHTML("beforeend",b({obj:a}));a=document.querySelectorAll("#chartMenuCont button");for(b=0;b<a.length;b++)a[b].classList.add("disabled")}else a.question=virtualclass.poll.dataRec.question,
b=virtualclass.getTemplate("stdResult","poll"),document.querySelector("#virtualclassPoll").insertAdjacentHTML("beforeend",b({obj:a}));this.resultLayoutBody()},resultNotShownUI(a){var b=document.querySelector("#resultLayoutBody");b&&(b.style.display="none");if(a=document.getElementById("mszBoxPoll"))for(;0<a.childNodes.length;)a.removeChild(a.childNodes[0]);else a=document.createElement("div"),a.id="mszBoxPoll",b.appendChild(a);a=virtualclass.lang.getString("noResultStd");document.querySelector("#mszBoxPoll").style.display=
"block";if(b=document.querySelector("#resultLayoutHead"))b.style.display="none";virtualclass.poll.showMsg("mszBoxPoll",a,"alert-success")},resultLayoutBody(a){if(a=document.querySelector("#qnLabelCont"))roles.hasControls()&&(a.innerHTML=virtualclass.poll.dataToStd.question),roles.hasControls()&&(this.chartMenu(),this.createResultMsgCont())},createResultMsgCont(a){document.getElementById("pollResultMsz").innerHTML=virtualclass.lang.getString("watstdrespo")},pollClosedUI(){var a=document.getElementById("closePoll");
a&&a.parentNode.removeChild(a);if(a=document.getElementById("congreaPollVoters"))a.innerHTML=virtualclass.lang.getString("rvtu");(a=document.getElementById("pollResultMsz"))&&a.parentNode.removeChild(a)},chartMenu(a){document.querySelector("#chartMenuCont #bar").addEventListener("click",virtualclass.poll.barGraph);document.querySelector("#chartMenuCont #pi").addEventListener("click",virtualclass.poll.createPiChart);roles.hasControls()&&document.querySelector("#chartMenuCont #rList").addEventListener("click",
virtualclass.poll.listView)},qnLabel(a){const b=document.createElement("div");b.id="chart";b.className="row";a.appendChild(b);console.log("====> chat graph, container ",document.querySelector("#chart").offsetWidth)},createNav(a){roles.hasControls()||document.querySelector(".congrea.student #virtualclassPoll #navigator a").addEventListener("click",()=>{virtualclass.poll.showStudentPollReport()})},createMszBox(a){const b=document.createElement("div");b.id="mszBoxPoll";b.className="row";a.appendChild(b)},
createOption(a,b){let c;const d=document.getElementById("optsTxCont").querySelectorAll("#optsTxCont .opt");let k=0;for(let a=0;a<d.length;a++){k++;var m=d[a].id}c=m?k:"0";m={};m.index=c;m.closeBtn=1<c;m=virtualclass.getTemplate("optioninput","poll")({close:m});document.querySelector("#addMoreCont").insertAdjacentHTML("beforebegin",m);document.getElementById(`remove${c}`).addEventListener("click",()=>{virtualclass.poll.removeOption(b,a,`remove${c}`)})},hidePrevious(a){(a=document.getElementById("optsTxCont"))&&
a.parentNode.removeChild(a);if(a=document.getElementById("reset"))a.style.display="none";a=document.getElementById("footerCtrCont");a.parentNode.removeChild(a)},editPoll(a,b){virtualclass.poll.UI.loadContent(a,b);virtualclass.poll.UI.footerBtns(a,b)},loadContent(a,c){let d;document.getElementById("qnTxCont");virtualclass.poll.UI.editQn(a,c);d=b.options;let g=0;if("object"===typeof d)for(var k in d)g++,virtualclass.poll.UI.editOptions(a,c,k,g);else for(k=0;k<d.length;k++)virtualclass.poll.UI.editOptions(a,
c,k,g)},previewFooterBtns(a,b,c){document.getElementById("footerCtrCont")&&virtualclass.poll.pollPopUp(virtualclass.poll.popupFn,c,b)},footerBtns(a,b){a&&virtualclass.poll.pollPopUp(virtualclass.poll.popupFn,b,a)},editQn(a,b){const c=document.querySelector("#qnTxCont #q");null==c&&(c.value=document.getElementById(`qnText${a}${b}`).innerHTML);null==c||c.value||(c.value="course"===a?virtualclass.poll.coursePoll[b].questiontext:virtualclass.poll.sitePoll[b].questiontext)},editOptions(a,b,c,g){document.getElementById("optsTxCont").style.display=
"block";document.getElementById(`opt${b}${c}`);if(2<g){const d=document.createElement("a");d.id=`remove${c}`;d.className="close";d.innerHTML="&times";document.querySelector(`#optsTxCont .inputWrapper #option${c}`).parentNode.appendChild(d);d.addEventListener("click",()=>{virtualclass.poll.removeOption(a,b,d.id)})}g=document.getElementById(`option${c}`);"course"===a?(c=virtualclass.poll.coursePoll[b].options[c],g.value="object"===typeof c?c.options:c):(c=virtualclass.poll.sitePoll[b].options[c],g.value=
"object"===typeof c?c.options:c)},pollSettingUI(a,b){const c=virtualclass.getTemplate("setting-modal","poll"),d=document.querySelector("#editPollModal");for(;d.firstChild;)d.removeChild(d.firstChild);d.insertAdjacentHTML("beforeend",c({time:function(a,b){const c=[];for(a=b-a+1;a--;)c[a]=b--;return c}(1,60)}));this.settingUIBody(a,b)},settingUIBody(a,b){this.addSettingHandlers()},addSettingHandlers(){document.getElementById("mode").addEventListener("click",()=>{const a=document.getElementById("radioBtn1"),
b=document.getElementById("radioBtn2");a.checked?(document.getElementById("timer").setAttribute("disabled",!0),document.getElementById("ut").setAttribute("disabled",!0)):b.checked&&(document.getElementById("timer").removeAttribute("disabled"),document.getElementById("ut").removeAttribute("disabled"))})},defaultLayoutForStudent(){this.container();const a=document.getElementById("mszBoxPoll");if(null==document.getElementById("stdPollMszLayout")){const b=document.createElement("div");b.id="stdPollMszLayout";
b.innerHTML=virtualclass.lang.getString("pollmaybeshown");a.appendChild(b)}},stdPublishUI(){const a=document.getElementById("stdPollMszLayout");a&&a.parentNode.removeChild(a)},disableClose(){document.getElementById("pollClose").style.display="none"}},updateUsersOnPoll(a){a.hasOwnProperty("users")?(virtualclass.poll.uniqueUsers=a.message.map(a=>a.userid),virtualclass.poll.uniqueUsers=virtualclass.poll.uniqueUsers.filter(a=>{if(a!==virtualclass.gObj.uid)return a}),0<Object.keys(virtualclass.poll.count).length&&
virtualclass.poll.updateVotingInformation()):0>virtualclass.poll.uniqueUsers.indexOf(virtualclass.jId)&&virtualclass.vutil.whoIsTeacher()!==virtualclass.jId&&(virtualclass.poll.uniqueUsers.push(virtualclass.jId),0<Object.keys(virtualclass.poll.count).length&&virtualclass.poll.updateVotingInformation())},makeGraphResponsive(){if(virtualclass.poll.pollState&&"stdPublishResult"===virtualclass.poll.pollState.currScreen&&virtualclass.poll.currResultView){let a;(a="bar"===virtualclass.poll.currResultView?
document.querySelector("#chartMenuCont #bar"):document.querySelector("#chartMenuCont #pi"))&&a.click()}}}};c.poll=b})(window);const dashboard={userConfirmation(c,b){virtualclass.popup.confirmInput(c,a=>{b(a)})},init(c,b){"SharePresentation"!==c||document.querySelector("#pptDbCont")||(null==document.querySelector(".docsDbCont")&&(document.querySelector("#SharePresentationDashboard").innerHTML=virtualclass.vutil.getPptDashBoard("SharePresentation")),virtualclass.sharePt.attachEvent("submitpurl","click",virtualclass.sharePt.initNewPpt),virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&(virtualclass.sharePt.showPpts(virtualclass.sharePt.ppts),
virtualclass.sharePt.retrieveOrder()));const a=document.querySelectorAll("#congdashboard .dbContainer");for(let b=0;b<a.length;b++)a[b].style.display=a[b].dataset.app===virtualclass.currApp?"block":"none";"DocumentShare"===c?("undefined"===typeof b&&this.open(),virtualclass.dts.noteExist()&&virtualclass.vutil.hideUploadMsg("docsuploadContainer")):"Video"===c?"undefined"===typeof b&&virtualclass.modal.showModal():virtualclass.modal.showModal();virtualclass.dashboard.actualCloseHandler();this.displayHeaderText()},
close(){var c=document.querySelector("#congdashboard .modal-content button.close");null!=c&&(c.classList.remove("clicked"),c.click(),c=document.querySelector("#dashboardnav button"),null!=c&&c.classList.remove("clicked"))},open(){virtualclass.modal.showModal();virtualclass.dashboard.clickCloseButton()},isDashBoardExit(c){return null!=document.querySelector(`#${c}Dashboard`)},isDashBoardNavExist(){return null!=document.querySelector("#dashboardnav")},actualCloseHandler(){const c=document.querySelector("#congdashboard .modal-content button.close");
null!=c&&c.addEventListener("click",()=>{const b=document.querySelector("#dashboardnav button");null!=b&&(b.classList.remove("clicked"),dashboard.dashBoardClickTooltip("open"))})},clickCloseButton(){const c=document.querySelector("#dashboardnav button");null!=c&&c.classList.add("clicked")},dashBoardClickTooltip(c){const b=document.querySelector("#dashboardnav button");"Video"===virtualclass.currApp?b.parentNode.setAttribute("data-title",virtualclass.lang.getString(`${c}videoDashboard`)):"SharePresentation"===
virtualclass.currApp?b.parentNode.setAttribute("data-title",virtualclass.lang.getString(`${c}SharePresentationdbHeading`)):"DocumentShare"===virtualclass.currApp&&b.parentNode.setAttribute("data-title",virtualclass.lang.getString(`${c}dsDbheading`))},dashBoardNavHandler(){const c=document.querySelector(".congrea #virtualclassApp");this.classList.contains("clicked")?(virtualclass.dashboard.close(),c&&c.classList.contains("dashboard")&&c.classList.remove("dashboard")):(c&&!c.classList.contains("dashboard")&&
c.classList.add("dashboard"),virtualclass.dashboard.init(virtualclass.currApp),this.classList.add("clicked"),virtualclass.dashboard.dashBoardClickTooltip("close"),"DocumentShare"===virtualclass.currApp&&Object.prototype.hasOwnProperty.call(virtualclass,"dts")&&(virtualclass.dts.moveProgressbar(),null!=virtualclass.dts.docs.currNote&&virtualclass.dts.setCurrentNav(virtualclass.dts.docs.currNote),document.querySelector(".dbContainer #listnotes .linknotes")?document.querySelector(".congrea.teacher  #dashboardContainer .modal-header button.enable")||
virtualclass.vutil.showFinishBtn():virtualclass.vutil.removeFinishBtn()))},initDashboardNav(c){if(roles.hasControls()){var b=document.querySelector("#dashboardnav button");null==b&&(b=virtualclass.getTemplate("dashboardNav")({app:virtualclass.currApp}),document.querySelector("#virtualclassAppOptionsCont").insertAdjacentHTML("beforeend",b),b=document.querySelector("#dashboardnav button"),null!=b&&(b.addEventListener("click",this.dashBoardNavHandler),c&&virtualclass.dashboard.readyDashboard(c)));"DocumentShare"===
virtualclass.currApp?virtualclass.dts.noteExist()?(virtualclass.dts.isUploaderExist()||virtualclass.vutil.modalPopup("docs",["docsuploadContainer"]),document.getElementById("dashboardnav").setAttribute("data-title",virtualclass.lang.getString("DocumentSharedbHeading"))):(this.readyDashboard(),(c=document.getElementById("virtualclassApp"))&&c.classList.add("dashboard")):"Video"===virtualclass.currApp?("undefined"===typeof c&&(this.readyDashboard(),this.displayHeaderText()),document.querySelector(".congrea #listvideo .linkvideo.playing")||
virtualclass.vutil.removeFinishBtn()):(this.readyDashboard(),this.displayHeaderText(),document.querySelector(".congrea .pptSharing")&&virtualclass.dashboard.close())}else virtualclass.dts.init();"DocumentShare"===virtualclass.currApp&&Object.prototype.hasOwnProperty.call(virtualclass,"dts")&&virtualclass.dts.moveProgressbar()},readyDashboard(c){let b;var a;({currApp:f}=virtualclass);if(null===document.querySelector("#congdashboard")){var d=virtualclass.getTemplate("dashboard");document.querySelector("#dashboardContainer").innerHTML=
d({app:f});d=document.querySelector("#dashboardnav button");null!=d&&d.classList.add("clicked")}this.modalCloseHandler();d=document.getElementById("dashboardnav");if("DocumentShare"===f)d.setAttribute("data-title",virtualclass.lang.getString("DocumentSharedbHeading")),null==document.querySelector(`#${f}Dashboard`)&&(d=document.createElement("div"),b=document.querySelector("#congdashboard .modal-body"),b.appendChild(d),d.id=`${f}Dashboard`),(a=document.querySelector("#docsDbCont"))&&a.parentNode.removeChild(a),
document.querySelector(`#${f}Dashboard`).innerHTML=virtualclass.vutil.getDocsDashBoard(f),virtualclass.dts.init(),virtualclass.vutil.attachEventToUploadTab(),virtualclass.dts.isUploaderExist()||virtualclass.vutil.modalPopup("docs",["docsuploadContainer"]),virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listnotes");else if("Video"===f){null==document.querySelector(`#${f}Dashboard`)&&(d=document.createElement("div"),
b=document.querySelector("#congdashboard .modal-body"),b.appendChild(d),d.id=`${f}Dashboard`);if(!document.querySelector("#videoPopup")){var f=virtualclass.getTemplate("popup","videoupload")();document.querySelector("#VideoDashboard").insertAdjacentHTML("beforeend",f);(f=document.querySelector("#videoPopup  #uploadMsz div"))&&f.parentNode.removeChild(f);virtualclass.vutil.attachEventToUpload();virtualclass.videoUl.UI.inputUrl()}virtualclass.videoUl.UI.popup(c);virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery");
virtualclass.vutil.makeElementActive("#listvideo");c&&c.init.videoUrl&&(a=!0);c=document.querySelector("#dashboardnav button");null==c||a||virtualclass.vutil.isDashboardOpened()||c.click()}else"SharePresentation"===f&&(d.setAttribute("data-title",virtualclass.lang.getString("SharePresentationdbHeading")),null==document.querySelector(`#${f}Dashboard`)&&(a=document.createElement("div"),document.querySelector("#congdashboard .modal-body").appendChild(a),a.id=`${f}Dashboard`),a=document.querySelector("#dashboardnav button"),
null==a||virtualclass.vutil.isDashboardOpened()||a.click())},modalCloseHandler(){if(!this.attachModalCloseHandler){const c=document.querySelector(".congrea .dashboardContainer .modal-header .close");c&&(this.attachModalCloseHandler=!0,c.addEventListener("click",()=>{const b=document.querySelector(".congrea #virtualclassApp");b.classList.contains("dashboard")&&b.classList.remove("dashboard");c.setAttribute("data-dismiss","modal");virtualclass.modal.hideModal()}))}},displayHeaderText(){const c=document.querySelector("#congdashboard .modal-header h4");
null!=c&&(c.innerHTML=virtualclass.lang.getString(`${virtualclass.currApp}dbHeading`))}};(function(c){c.videoUl=function(){return{videos:[],uploaderParam:{},videoObj:{},videoId:"",videoUrl:"",isfullscreen:!1,currPlaying:"",autoPlayFlag:1,status:0,yts:!1,online:!1,listEndPause:!1,attachPlayer:!1,lastSeek:0,appName:"Video",init(){virtualclass.orderList[virtualclass.videoUl.appName]||(virtualclass.orderList[virtualclass.videoUl.appName]=new OrderedList);this.videoInit=!0;this.currPlaying="";this.pages={};virtualclass.previrtualclass="virtualclassVideo";virtualclass.previous="virtualclassVideo";
this.autoPlayFlag=1;this.UI.container();if(roles.hasControls()){var b=document.querySelector("#dashboardnav button");b&&b.click();virtualclass.config.makeWebSocketReady&&ioAdapter.mustSend({videoUl:{init:"studentlayout"},cf:"videoUl"})}else if(b=document.getElementById("messageLayoutVideo"))b.style.display="block";virtualclass.liveStream.init()},reArrangeElements(b){if(!(0>=Object.keys(b).length)){var a=document.getElementById("listvideo"),c=document.createElement("div");c.id="listvideo";c.className=
"videos";var f=this.getActiveVideos(),g=!1;for(let a=0;a<f.length;a++)-1>=b.indexOf(f[a].fileuuid)&&(b.push(f[a].fileuuid),g=!0);g&&(virtualclass.orderList[virtualclass.videoUl.appName].ol.order=b,virtualclass.videoUl.sendOrder(virtualclass.orderList[virtualclass.videoUl.appName].ol.order));for(f=0;f<b.length;f++)(g=document.getElementById(`linkvideo${b[f]}`))&&c.appendChild(g);a.parentNode.replaceChild(c,a)}},getActiveVideos(){const b=[];for(let a=0;a<virtualclass.serverData.rawData.video.length;a++)Object.prototype.hasOwnProperty.call(virtualclass.serverData.rawData.video[a],
"deleted")||b.push(virtualclass.serverData.rawData.video[a]);return b},requestOrder(){virtualclass.vutil.requestOrder(b=>{"Error"===b?console.log("page order retrieve failed"):"undefined"!==typeof b&&null!=b&&0<virtualclass.orderList[virtualclass.videoUl.appName].ol.order.length&&virtualclass.videoUl.reArrangeElements(virtualclass.orderList[virtualclass.videoUl.appName].ol.order)})},afterUploadVideo(b,a,c){if(c.success){virtualclass.orderList[virtualclass.videoUl.appName].insert(virtualclass.gObj.file.uuid);
virtualclass.videoUl.sendOrder(virtualclass.orderList[virtualclass.videoUl.appName].ol.order);virtualclass.videoUl.showUploadMsz("Video uploaded successfully","alert-success");(b=document.querySelector(".congrea #VideoDashboard #videoPopup"))&&(b.classList.contains("uploadSuccess")||b.classList.add("uploadSuccess"));for(b=0;b<virtualclass.gObj.uploadingFiles.length;b++)a={},a.filename=`${virtualclass.gObj.uploadingFiles[b].name} (Processing...)`,a.fileuuid=virtualclass.gObj.uploadingFiles[b].uuid,
a.filetype="video",a.key_room=`${virtualclass.gObj.sessionInfo.key}_${virtualclass.gObj.sessionInfo.room}`,a.noVideo=!0,this.afterUploadFile(a);virtualclass.gObj.uploadingFiles=[];virtualclass.serverData.pollingStatus().then(()=>{virtualclass.videoUl.UI.rawVideoList();virtualclass.videoUl.sendOrder(virtualclass.orderList[virtualclass.videoUl.appName].ol.order)})}else virtualclass.videoUl.showUploadMsz("video upload failed","alert-error");if(b=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-list"))b.style.display=
"none"},showUploadMsz(b,a){const c=document.querySelector("#VideoDashboard #uploadMsz"),f=document.querySelector("#VideoDashboard #uploadMsz .alert");f&&f.parentNode.removeChild(f);const g=document.createElement("div");g.className="alert  alert-dismissable";g.classList.add(a);g.innerHTML=b;c.appendChild(g);b=document.createElement("button");b.className="close";b.setAttribute("data-dismiss","alert");b.innerHTML="&times";b.addEventListener("click",()=>{var a=document.querySelector("#uploadMsz");a&&
(a.style.display="none");(a=document.querySelector(".congrea #VideoDashboard #videoPopup"))&&a.classList.remove("uploadSuccess");g.parentNode.removeChild(g)});g.appendChild(b)},retrieveOrder(){this.requestOrder()},afterUploadFile(b){var a=b.fileuuid;this.pages[a]=new virtualclass.page("videoList","video","virtualclassVideo","videoUl",b.status,b.filetype);if("video_yts"===b.filetype){var c=virtualclass.videoUl.getVideoId(b.URL);virtualclass.videoUl.UI.fetchYtsTitle(b,c)}this.pages[a].init(a,b.filename);
this.videoDisplayHandler(b);a=document.getElementById(`linkvideo${b.fileuuid}`);if(c=document.getElementById(`videoTitle${b.fileuuid}`))c.innerHTML=b.filename;c=a.getElementsByClassName("status")[0];Object.prototype.hasOwnProperty.call(b,"disabled")?(this.disable(b.fileuuid),a&&(a.classList.add("disable"),a.dataset.status=0)):(this.enable(b.fileuuid),a&&(a.classList.add("enable"),a.dataset.status=1));c.dataset.status=a.dataset.status;this.calculateHeight();Object.prototype.hasOwnProperty.call(b,"noVideo")&&
(a.classList.add("noVideo"),document.querySelector(".noVideo .playDisable").title=virtualclass.lang.getString("uploading"))},calculateHeight(){const b=document.querySelector("#listvideo");$(".qq-uploader-selector").css({minHeight:b.offsetHeight})},showVideos(){roles.hasControls()&&virtualclass.videoUl.showVideoList();virtualclass.videoUl.videoUrl&&(virtualclass.videoUl.activeVideoClass(virtualclass.videoUl.videoId),virtualclass.vutil.showFinishBtn())},showVideoList(){var b=document.getElementById("listvideo");
if(b)for(var a=0;a<b.childNodes.length-1;a++)b.childNodes[a].parentNode.removeChild(b.childNodes[a]);virtualclass.serverData.rawData.video&&virtualclass.serverData.rawData.video.length&&virtualclass.serverData.rawData.video.forEach((a,b)=>{if(!Object.prototype.hasOwnProperty.call(a,"deleted")){b=document.querySelector(`#linkvideo${a.fileuuid}`);if(null!=b){const a=document.querySelector(".noVideo .playDisable");null!=a&&(a.title=virtualclass.lang.getString("Play"));b.classList.remove("noVideo")}virtualclass.videoUl.afterUploadFile(a)}});
virtualclass.vutil.makeElementActive("#listvideo");b=document.querySelector(".congrea #listvideo .linkvideo.singleVideo");a=document.querySelector(".congrea #listvideo .linkvideo");1!==virtualclass.serverData.rawData.video.length||b||null==a?1<virtualclass.serverData.rawData.video.length&&b&&b.classList.remove("singleVideo"):a.classList.add("singleVideo")},videoDisplayHandler(b){const a=document.getElementById(`mainpvideo${b.fileuuid}`);a&&!b.status?a.classList.contains("playDisable")||a.classList.add("playDisable"):
a&&a.classList.contains("playDisable")&&a.classList.remove("playDisable");a&&a.addEventListener("click",()=>{virtualclass.liveStream.isLiveStreamMode()&&virtualclass.liveStream.stop();virtualclass.videoUl.isPaused=!1;"video_yts"===b.filetype?(virtualclass.videoUl.yts=!0,virtualclass.videoUl.online=!1):"video_online"===b.filetype?(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!0):(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!1);if(b.urls){const a=b.urls.main_video;virtualclass.videoUl.UI.displayVideo(b.fileuuid,
a);virtualclass.videoUl.activeVideoClass(b.fileuuid);const c={};c.content_path=a;c.id=b.fileuuid;c.title=b.filename;c.type=b.filetype;virtualclass.videoUl.videoToStudent(c);virtualclass.videoUl.videoId=b.fileuuid;virtualclass.vutil.showFinishBtn();virtualclass.dashboard.close();virtualclass.userInteractivity.makeReadyContext()}})},activeVideoClass(b){var a=document.getElementsByClassName("controlCont");for(var c=0;c<a.length;c++)a[c].classList.contains("removeCtr")&&a[c].classList.remove("removeCtr");
(a=document.getElementById(`controlContvideo${b}`))&&!a.classList.contains("removeCtr")&&a.classList.add("removeCtr");a=document.getElementsByClassName("linkvideo");for(c=0;c<a.length;c++)a[c].classList.contains("playing")&&a[c].classList.remove("playing");(b=document.getElementById(`linkvideo${b}`))&&!b.classList.contains("playing")&&b.classList.add("playing")},destroyPl(){"object"===typeof virtualclass.videoUl.player&&("ScreenShare"===virtualclass.currApp&&ioAdapter.mustSend({video:"destroyPl",
cf:"video"}),virtualclass.videoUl.destroyPlayer())},_rearrange(b){virtualclass.orderList[virtualclass.videoUl.appName].ol.order=b;this.reArrangeElements(virtualclass.orderList[virtualclass.videoUl.appName].ol.order);this.sendOrder(virtualclass.orderList[virtualclass.videoUl.appName].ol.order)},async editTitle(b,a,d){d=new FormData;const f={lc_content_id:b,action:"edit",title:a,user:virtualclass.gObj.uid};for(const a in f)d.append(a,f[a]);await this.vxhr.post(`${c.webapi}&user=${virtualclass.gObj.uid}&methodname=update_content_video`,
d).then(c=>{if(c=document.getElementById(`videoTitle${b}`))c.innerHTML=a,c.style.display="inline",virtualclass.serverData.rawData.video&&virtualclass.serverData.rawData.video.length&&virtualclass.serverData.rawData.video.forEach(c=>{c.id===b&&(c.title=a)})}).catch(a=>{console.error("Request failed with error ",a)})},sendOrder(b){virtualclass.vutil.sendOrder("vid",b);ioAdapter.mustSend({videoUl:{order:b},cf:"videoUl"})},onmessage(b){if("string"===typeof b.videoUl)if("play"===b.videoUl)this.handlePlayEvent(b,
b.play);else if("pause"===b.videoUl)this.handlePauseEvent(b);else if("destroyPlayer"===b.videoUl)virtualclass.videoUl.destroyPlayer();else if("enterFullScreen"===b.videoUl)virtualclass.videoUl.enterFullScreen();else if("exitFullScreen"===b.videoUl)virtualclass.videoUl.exitFullScreen();else{if("videoDelete"===b.videoUl&&(b=document.querySelector("#videoPlayerCont"))){b.style.display="none";if(b=document.querySelector("#messageLayoutVideo"))b.style.display="block";virtualclass.videoUl.videoId=null;
virtualclass.videoUl.videoUrl=null;b=document.querySelector(".congrea #dispVideo video");const a=document.querySelector(".congrea #dispVideo iframe");(b=b||a)&&b.setAttribute("src","")}}else this.onmessageObj(b)},onmessageObj(b){b.videoUl.type&&("video_yts"===b.videoUl.type?(virtualclass.videoUl.yts=!0,virtualclass.videoUl.online=!1):"video_online"===b.videoUl.type?(virtualclass.videoUl.online=!0,virtualclass.videoUl.yts=!1):(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!1));if(Object.prototype.hasOwnProperty.call(b.videoUl,
"init"))if(virtualclass.videoUl.rec=b.videoUl,"studentlayout"===b.videoUl.init){if(virtualclass.makeAppReady({app:"Video",data:b.videoUl}),b=document.getElementById("messageLayoutVideo"))b.style.display="block"}else Object.prototype.hasOwnProperty.call(b.videoUl.init,"videoUrl")&&(virtualclass.videoUl.videoId=b.videoUl.init.id,virtualclass.videoUl.videoUrl=b.videoUl.init.videoUrl,virtualclass.videoUl.UI.displayVideo(b.videoUl.init.id,b.videoUl.init.videoUrl),virtualclass.userInteractivity.makeReadyContext());
else Object.prototype.hasOwnProperty.call(b.videoUl,"content_path")?(virtualclass.videoUl.videoId=b.videoUl.id,virtualclass.videoUl.videoUrl=b.videoUl.content_path,virtualclass.videoUl.title=b.videoUl.title,virtualclass.videoUl.UI.displayVideo(b.videoUl.id,virtualclass.videoUl.videoUrl),virtualclass.userInteractivity.makeReadyContext()):Object.prototype.hasOwnProperty.call(b.videoUl,"play")?(this.handlePlayEvent(b,b.videoUl.play),virtualclass.gObj.videoMode="normalVideo",console.log("normal video mode")):
Object.prototype.hasOwnProperty.call(b.videoUl,"order")&&(virtualclass.orderList[virtualclass.videoUl.appName].ol.order=b.videoUl.order,roles.hasControls()&&!virtualclass.config.makeWebSocketReady&&0<virtualclass.orderList[virtualclass.videoUl.appName].ol.order.length&&(virtualclass.videoUl.showVideos(),virtualclass.videoUl.reArrangeElements(virtualclass.orderList[virtualclass.videoUl.appName].ol.order)))},calculateVideoTime(b){b=virtualclass.vutil.UTCtoLocalTimeToSeconds(b);return((new Date).getTime()-
b)/1E3},handlePlayEvent(b,a){virtualclass.videoUl.lastSeek=a;b.videoTime&&!virtualclass.isPlayMode&&(virtualclass.videoUl.lastSeek+=this.calculateVideoTime(b.videoTime));this.playVideo();virtualclass.videoUl.isPaused=!1},handlePauseEvent(b){console.log("====> video pause event");virtualclass.videoUl.lastSeek=b.currTime;this.pauseVideo();virtualclass.videoUl.isPaused=!0},enablePlayer(){const b=document.getElementById("videoPlayerCont");b&&(b.style.display="block")},disablePlayer(){const b=document.getElementById("videoPlayerCont");
b&&(b.style.display="none")},destroyPlayer(){virtualclass.videoUl.player.dispose();delete virtualclass.videoUl.player;this.UI.attachPlayer=!1;delete virtualclass.gObj.videoMode;console.log("delete normal video")},playVideo(b){virtualclass.videoUl.lastSeek=b||virtualclass.videoUl.lastSeek;virtualclass.videoUl.player.currentTime(virtualclass.videoUl.lastSeek);virtualclass.videoUl.player.play()},pauseVideo(){virtualclass.videoUl.player.currentTime(virtualclass.videoUl.lastSeek);virtualclass.videoUl.player.pause();
virtualclass.videoUl.isPaused=!0},autoPlayList(b){var a=this.getActiveVideos();(b=this.findNextObj(b))&&"object"!==typeof b?b<a.length&&(b=this.autoPlayList(b)):(a={},a.id=b.fileuuid,a.title=b.filename,a.type=b.filetype,!virtualclass.videoUl.listEnd&&b&&("video_online"===b.filetype?(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!0,virtualclass.videoUl.UI.displayVideo(b.fileuuid,b.URL),virtualclass.videoUl.videoToStudent(b),this.activeVideoClass(b.id),a.content_path=b.URL):(virtualclass.videoUl.online=
!1,"video_yts"===b.filetype?(virtualclass.videoUl.yts=!0,virtualclass.videoUl.UI.displayVideo(b.fileuuid,b.URL),a.content_path=b.URL):(virtualclass.videoUl.yts=!1,virtualclass.videoUl.UI.displayVideo(b.fileuuid,b.urls.main_video),a.content_path=b.urls.main_video),virtualclass.videoUl.videoToStudent(a)),virtualclass.videoUl.player&&virtualclass.videoUl.player.ready(function(){console.log("====> video play ");this.play()}),this.activeVideoClass(b.fileuuid)))},findNextObj(b){const a=this.findNextVideo(b);
let c=!1;const f=this.getActiveVideos();for(let d=0;d<f.length;d++)if(f[d].fileuuid===a){if("1"===document.getElementById(`linkvideo${f[d].fileuuid}`).getAttribute("data-status")){c=f[d];break}c=b+1;break}return c},findNextVideo(b){const a=document.querySelectorAll("#listvideo .linkvideo");return b<a.length?a[b].getAttribute("data-rid"):!1},disable(b){document.querySelector(`#linkvideo${b}`).classList.add("playDisable");const a=document.getElementById(`mainpvideo${b}`);a.style.opacity=.3;a.style.pointerEvents=
"none";virtualclass.serverData.rawData.video&&virtualclass.serverData.rawData.video.length&&virtualclass.serverData.rawData.video.forEach((a,c)=>{a.fileuuid===b&&(a.disabled=0,a.status=0)})},enable(b){document.querySelector(`#linkvideo${b}`).classList.remove("playDisable");const a=document.getElementById(`mainpvideo${b}`);a&&(a.style.opacity=1,a.style.pointerEvents="auto",virtualclass.serverData.rawData.video&&virtualclass.serverData.rawData.video.length&&virtualclass.serverData.rawData.video.forEach((a,
c)=>{a.fileuuid===b&&(delete a.disabled,a.status=1)}))},delete(b){const a=this;virtualclass.xhrn.vxhrn.post(virtualclass.api.UpdateDocumentStatus,{uuid:b,action:"delete",page:0}).then(c=>{a.afterDeleteCallback(c.data,b)})},afterDeleteCallback(b,a){if("ERROR"!==b&&(b=document.getElementById(`linkvideo${a}`))){b.parentNode.removeChild(b);if(virtualclass.videoUl.videoId===a&&(b=document.querySelector("#videoPlayerCont"))){b.style.display="none";ioAdapter.mustSend({videoUl:"videoDelete",cf:"videoUl"});
virtualclass.videoUl.videoId=null;virtualclass.videoUl.videoUrl=null;b=document.querySelector(".congrea #dispVideo video");const a=document.querySelector(".congrea #dispVideo iframe");(b=b||a)&&b.setAttribute("src","");virtualclass.vutil.removeFinishBtn()}virtualclass.serverData.rawData.video&&virtualclass.serverData.rawData.video.length&&virtualclass.serverData.rawData.video.forEach(b=>{b.fileuuid===a&&(b=virtualclass.serverData.rawData.video.indexOf(b),0<=b&&virtualclass.serverData.rawData.video.splice(b,
1))});b=virtualclass.orderList.Video.ol.order.indexOf(a);0<=b&&(virtualclass.orderList.Video.ol.order.splice(b,1),virtualclass.videoUl.sendOrder(virtualclass.orderList[virtualclass.videoUl.appName].ol.order));virtualclass.serverData.rawData.video.length?1===virtualclass.serverData.rawData.video.length&&(b=document.querySelector(".congrea #listvideo .linkvideo"))&&b.classList.add("singleVideo"):virtualclass.vutil.removeFinishBtn()}},videoToStudent(b){virtualclass.gObj.videoMode="normalVideo";ioAdapter.mustSend({videoUl:b,
cf:"videoUl",videoTime:virtualclass.vutil.localToUTC()});console.log("normal video mode")},getVideoId(b){b=b.match(/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|&v(?:i)?=))([^#&\?]*).*/);return null!=b&&1<b.length&&(b=b[1].substring(0,11),11===b.length)?b:!1},UI:{id:"virtualclassVideo",class:"bootstrap virtualclass",container(){if(!document.getElementById("virtualclassVideo")){var b={control:!!roles.hasAdmin()};virtualclass.vutil.insertAppLayout((0,JST[`${virtualclass.gObj.tempPrefix}/videoupload/videoupload.hbs`])(b));
document.getElementById(this.id)}!roles.hasControls()&&(b=document.getElementById("messageLayoutVideo"))&&(b.style.display="block")},createYoutubeUrlCont(b){const a=document.createElement("div");a.id="listvideo";b.appendChild(a)},displayVideo(b,a){"object"===typeof virtualclass.videoUl.player&&Object.prototype.hasOwnProperty.call(virtualclass.videoUl.player,"dispose")&&virtualclass.videoUl.destroyPlayer();virtualclass.videoUl.videoUrl=a;virtualclass.videoUl.videoId=b;let c=document.getElementById("videoPlayerCont");
c?c.style.display="block":(virtualclass.videoUl.UI.container(),c=document.getElementById("videoPlayerCont"));const f=document.querySelector("iframe#player");f&&f.remove();virtualclass.videoUl.UI.switchDisplay(c,a);virtualclass.videoUl.UI.videojsPlayer(a,b);virtualclass.dashboard.close();virtualclass.userInteractivity.makeReadyContext()},videojsPlayer(b,a){if(!virtualclass.videoUl.player){virtualclass.videoUl.player="mobTab"===virtualclass.system.device&&"iOS"!==virtualclass.system.mybrowser.name&&
"Safari"!==virtualclass.system.mybrowser.name?videojs("dispVideo",{html5:{nativeAudioTracks:!1,nativeVideoTracks:!1,hls:{overrideNative:!0}},controlBar:{pictureInPictureToggle:!1}}):videojs("dispVideo",{controlBar:{pictureInPictureToggle:!1}});if(roles.hasControls()){$(".vjs-autoPlay-button").length||virtualclass.videoUl.UI.appendAutoPlayButton(virtualclass.videoUl.player);const a=document.getElementById("autoPlayListBtn");a&&(a.className=virtualclass.videoUl.autoPlayClass)}virtualclass.videoUl.UI.attachPlayerHandler(virtualclass.videoUl.player,
a,b)}virtualclass.videoUl.lastSeek=0;virtualclass.videoUl.UI.onEndedHandler(virtualclass.videoUl.player,a,b);virtualclass.videoUl.setPlayerUrlTime&&clearTimeout(virtualclass.videoUl.setPlayerUrlTime);virtualclass.videoUl.setPlayerUrlTime=setTimeout(()=>{"object"===typeof virtualclass.videoUl.player&&virtualclass.videoUl.UI.setPlayerUrl(virtualclass.videoUl.player,b)},100)},attachPlayerHandler(b){this.attachPlayer||(this.attachPlayer=!0,b.on("pause",a=>{roles.hasControls()&&ioAdapter.mustSend({videoUl:"pause",
cf:"videoUl",currTime:b.currentTime()});virtualclass.videoUl.isPaused=!0}),b.on("play",a=>{roles.hasControls()&&ioAdapter.mustSend({videoUl:{play:b.currentTime()},cf:"videoUl",videoTime:virtualclass.vutil.localToUTC()});virtualclass.videoUl.isPaused=!1}),b.on("fullscreenchange",a=>{setTimeout(()=>{virtualclass.vutil.showFullScreenButtonIfNeed()},0)}))},switchDisplay(b,a){var c=document.getElementById("dispVideo");c?c.style.display="block":virtualclass.videoUl.UI.createVideoElem(b);c=document.getElementById("messageLayoutVideo");
"undefined"===typeof a?(b.style.display="none",c&&(c.style.display="block")):(b.style.display="block",c&&(c.style.display="none"))},createVideoElem(b){b.insertAdjacentHTML("beforeend",'<video id="dispVideo" class="video-js" autoplay controls  preload="auto" data-setup="{}" >');b=document.createElement("p");b.setAttribute("class","vjs-no-js");document.getElementById("dispVideo").appendChild(b);const a=document.createElement("a");a.setAttribute("href","https://videojs.com/html5-video-support/");a.setAttribute("target",
"_blank");a.innerHTML="supports HTML5 video";b.appendChild(a)},setPlayerUrl(b,a){b.poster_&&(b.poster_="");const c=document.querySelector("#dispVideo");virtualclass.videoUl.yts?(c.setAttribute("data-setup",'{ techOrder: [youtube],"preload": "auto"}'),b.src({type:"video/youtube",src:a}),(a=document.querySelector("#videoPlayerCont .vjs-error-display"))&&a.classList.add("vjs-hidden")):virtualclass.videoUl.online?(c.setAttribute("data-setup",'{"preload": "auto" }'),b.src({type:"video/webm",src:a}),b.src({type:"video/mp4",
src:a})):(c.setAttribute("data-setup",'{"preload": "auto"}'),b.src({type:"application/x-mpegURL",withCredentials:!0,src:a}),console.log("live video suman 2"));b.any("loadstart",()=>{virtualclass.videoUl.alreadySetPlayerUrl=!0;virtualclass.videoUl.isPaused?(virtualclass.videoUl.lastSeek&&virtualclass.videoUl.player.currentTime(virtualclass.videoUl.lastSeek),b.pause()):"desktop"===virtualclass.system.device&&(virtualclass.videoUl.lastSeek&&virtualclass.videoUl.player.currentTime(virtualclass.videoUl.lastSeek),
b.play())});b.on("error",()=>{if(1150===b.error().code){const a=document.querySelector("#videoPlayerCont .vjs-error-display");a&&a.classList.remove("vjs-hidden")}})},appendAutoPlayButton(b){virtualclass.videoUl.autoPlayClass=virtualclass.videoUl.autoPlayFlag?"vjs-autoPlay-button vjs-control on":"vjs-autoPlay-button vjs-control off";b.controlBar.addChild("button",{el:videojs.createEl("button",{className:"vjs-autoPlay-button vjs-control on",id:"autoPlayListBtn",role:"button",title:"Auto Play",onclick(){virtualclass.videoUl.UI.autoPlayFn(this)}})})},
autoPlayFn(b){b.classList.contains("off")?(virtualclass.videoUl.autoPlayFlag=1,b.classList.remove("off"),b.classList.add("on"),b.style.color="green"):(virtualclass.videoUl.autoPlayFlag=0,b.classList.remove("on"),b.classList.add("off"),b.style.color="red")},onEndedHandler(b,a,c){b.off("ended");b.on("ended",()=>{if(roles.hasControls())virtualclass.videoUl.UI.onEnded(b,a)})},onEnded(b,a,c){c=document.querySelectorAll("#listvideo .linkvideo");let d=0;for(let b=0;b<c.length;b++)if(c[b].getAttribute("data-rid")===
a){d=b;break}virtualclass.videoUl.autoPlayFlag?(b.poster_&&(b.poster_=""),virtualclass.videoUl.findNextVideo(d+1)?virtualclass.videoUl.autoPlayList(d+1,c):virtualclass.videoUl.UI.autoVideoPause()):virtualclass.videoUl.UI.autoVideoPause()},autoVideoPause(){virtualclass.videoUl.isPaused=!0;virtualclass.videoUl.listEndPause=!0;virtualclass.videoUl.player.on("play",()=>{virtualclass.videoUl.listEndPause&&(virtualclass.videoUl.player.pause(),virtualclass.videoUl.listEndPause=!1)})},inputUrl(){document.getElementById("congreaShareVideoUrlCont");
var b=document.getElementById("messageLayout");null!=b&&b.parentNode.removeChild(b);document.getElementById("submitURL").addEventListener("click",()=>{var a=document.querySelector(".congrea #videourl");if(virtualclass.videoUl.UI.validateURL(a.value)){var b=document.querySelector(" #listvideo .playing");b&&b.classList.remove("playing");(b=document.querySelector(" #listvideo .removeCtr"))&&b.classList.remove("removeCtr");a=virtualclass.vutil.createHashString(a.value)+virtualclass.vutil.randomString(32).slice(1,
-1);virtualclass.videoUl.UI.saveYtsUrl(a)}});(b=document.querySelector(".congrea #newVideoBtn"))&&b.addEventListener("click",()=>{document.querySelector(".congrea #congreavideoContBody").style.display="block";document.querySelector(".congrea #listvideo").style.display="none"})},saveYtsUrl(b){const a=document.querySelector(".congrea #videourl"),c={};c.uuid=b;c.URL=a.value;c.title=a.value;b=virtualclass.api.addURL;"boolean"===typeof virtualclass.videoUl.getVideoId(a.value)?c.type="video_online":c.type=
"video_yts";virtualclass.xhrn.vxhrn.post(b,c).then(()=>{virtualclass.orderList[virtualclass.videoUl.appName].insert(c.uuid);virtualclass.config.makeWebSocketReady&&(virtualclass.serverData.syncComplete=!1,virtualclass.serverData.syncAllData().then(()=>{virtualclass.videoUl.UI.rawVideoList();virtualclass.videoUl.sendOrder(virtualclass.orderList[virtualclass.videoUl.appName].ol.order)}))});document.querySelector(".congrea #videourl").value=""},fetchYtsTitle(b,a){$.getJSON("https://www.googleapis.com/youtube/v3/videos",
{key:"AIzaSyCt1SQWwanpucKGFlzytu-mDdr6vRKzJGA",part:"snippet,statistics",id:a},a=>{0!==a.items.length&&(a=a.items[0].snippet.title,virtualclass.videoUl.UI.setYtsTitle(b,a))}).fail((a,b,c)=>"ERROR")},validateURL(b){return null==b.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g)?(virtualclass.popup.validateurlPopup("video"),!1):!0},setYtsTitle(b,a){if(b=document.querySelector(`#listvideo #videoTitle${b.fileuuid}`))b.innerHTML=a},removeinputURL(){const b=
document.getElementById("youtubeUrlContainer");null!=b&&b.parentNode.removeChild(b)},popup(){var b=document.querySelector("#congreavideoContBody");b&&null!=b.lastChild&&b.removeChild(b.lastChild);b={};var a=document.querySelector("#listvideo .playing");a&&(this.currPlaying=a.getAttribute("data-rid"));b.validation="mp4 avi wmv mov webm mkv vob mpeg".split(" ");b.cb=virtualclass.videoUl.afterUploadVideo;b.cthis="video";b.multiple=!1;b.maxSize=512E6;b.requesteEndPoint=`${c.webapi}&methodname=file_save&live_class_id=${virtualclass.gObj.congCourse}&status=1&content_type_id=2&user=${virtualclass.gObj.uid}`;
b.wrapper=document.getElementById("congreavideoContBody");virtualclass.fineUploader.uploaderFn(b);virtualclass.serverData.syncComplete?virtualclass.serverData.rawData.video.length?(virtualclass.videoUl.showVideos(),virtualclass.videoUl.reArrangeElements(virtualclass.orderList[virtualclass.videoUl.appName].ol.order)):this.rawVideoList():virtualclass.serverData.syncAllData().then(()=>{virtualclass.videoUl.UI.rawVideoList()});document.querySelector("#virtualclassCont.congrea #VideoDashboard .qq-uploader.qq-gallery").setAttribute("qq-drop-area-text",
virtualclass.lang.getString("dropVideosHere"));const d=document.querySelector("#uploadMsz");b=document.querySelector("#congreavideoContBody .qq-upload-list-selector.qq-upload-list");b.style.display="block";a=document.querySelector("#uploadMsz div");a||(a=document.createElement("div"),d.appendChild(a));a.appendChild(b);b=document.querySelectorAll("#videoPopup #uploadMsz ul");if(2<b.length)for(a=0;a<b.length-1;a++)b[a].querySelector("li")||b[a].parentNode.removeChild(b[a]);document.querySelector("#uploadVideo").addEventListener("click",
()=>{d.style.display="block";const a=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-button input");a&&a.click()})},rawVideoList(){virtualclass.videoUl.showVideos();virtualclass.videoUl.requestOrder()}}}}})(window);(function(c){const b=function(){return{generateModal(a,b){var c=document.getElementById(`${a}PopupCont`);elem1Id="congreaVideoContBody";elem2Id="congreaShareVideoUrlCont";var d=document.createElement("div");d.id=`${a}Popup`;d.className="modal";d.role="dialog";d.style.display="none";d.setAttribute("tab-index","-1");d.setAttribute("area-hidden","true");c.appendChild(d);a=document.createElement("div");a.className="modal-dialog";d.appendChild(a);d=document.createElement("div");d.className="modal-content";
d.id="videoModalBody";a.appendChild(d);a=document.createElement("div");a.id="contHead";a.className="modal-header";d.appendChild(a);c=document.createElement("button");c.type="button";c.className="close";c.id="modalClose";c.setAttribute("data-dismiss","modal");c.innerHTML="&times";a.appendChild(c);const k=document.createElement("div");k.id="modalcontBody";k.className="modal-body";d.appendChild(k);b.forEach(a=>{virtualclass.fineUploader.createElems(k,a)});b=document.createElement("form");b.id="form1";
d.appendChild(b);b=document.createElement("div");b.id="contFooter";b.className="modal-footer";d.appendChild(b)},createElems(a,b){const c=document.createElement("div");c.id=b;c.className="upload";a.appendChild(c)},initModal(a){$(`#${a}Popup`).modal({backdrop:"static",keyboard:!1});$(`#${a}Popup`).modal({show:!0});$(`#${a}Popup`).on("hidden.bs.modal",()=>{$(`#${a}Popup`).remove()})},uploaderFn(a){new qq.s3.FineUploader({element:a.wrapper,template:"qq-template-gallery",debug:!1,multiple:a.multiple,validation:{allowedExtensions:a.validation,
minSizeLimit:4E3,sizeLimit:a.maxSize},request:{endpoint:virtualclass.api.uploadMedia,accessKey:"AKIAJV7RJOFBDFVY62EQ"},signature:{endpoint:virtualclass.api.upload,version:4,customHeaders:{"x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room}},uploadSuccess:{endpoint:virtualclass.api.uploadSuccess,customHeaders:{"x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room}},
retry:{enableAuto:!1},cors:{allowXdr:!0,expected:!0,sendCredentials:!1},objectProperties:{key(a){const b=wbUser.lkey,c=wbUser.room;virtualclass.gObj.file={};virtualclass.gObj.file.uuid=this.getUuid(a);virtualclass.gObj.file.name=this.getName(a);const d={name:this.getName(a),uuid:this.getUuid(a)};virtualclass.gObj.uploadingFiles.push(d);virtualclass.gObj.sessionInfo={key:b,room:c};return`${b}/${c}/${virtualclass.gObj.file.uuid}/${this.getName(a)}`}},callbacks:{onComplete(b,c,g){let d;if("video"===
a.cthis){a.cb.call(virtualclass.videoUl,b,c,g);if(b=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-list"))b.style.display="none";virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery");virtualclass.vutil.makeElementActive("#listvideo");b=document.querySelector("#uploadMsz .qq-upload-list-selector.qq-upload-list");null!=b&&(b.style.display="block");b=document.querySelectorAll("#uploadMsz .qq-upload-list-selector.qq-upload-list");
if(1<b.length)for(c=1;c<b.length-1;c++)b[c].parentNode.removeChild(b[c]);virtualclass.vutil.removeChildrens("#VideoDashboard #uploadMsz .qq-upload-list-selector.qq-upload-list li");d=document.querySelector("#VideoDashboard")}else"docs"===a.cthis&&(a.cb.call(virtualclass.dts,b,c,g),virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listdocs"),b=document.querySelector("#docsuploadContainer #docsUploadMsz .qq-upload-list-selector.qq-upload-list"),
null!=b&&(b.style.display="block"),virtualclass.vutil.removeChildrens("#docsUploadMsz .qq-upload-list-selector.qq-upload-list li"),d=document.querySelector("#DocumentShareDashboard"));null!=d&&d.classList.remove("uploading")},onError(){var b;(b=document.querySelector(".dbContainer .alert"))&&b.parentNode.removeChild(b);if("video"===a.cthis){if(b=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-list"))b.style.display="none";virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery");
virtualclass.vutil.makeElementActive("#listvideo")}else if("docs"===a.cthis){if(b=document.querySelector("#DocumentShareDashboard .qq-upload-list-selector.qq-upload-list"))b.style.display="none";virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery");virtualclass.vutil.makeElementActive("#listdocs")}},onSubmitted(b,c){let d,f;this.setName(b,c.toLowerCase());"video"===a.cthis?(d="#uploadMsz",f="#VideoDashboard"):"docs"===a.cthis&&(d="#docsUploadMsz",
f="#DocumentShareDashboard");document.querySelector(f).classList.add("uploading");b=document.querySelector(`${d} .close`);null!=b&&b.click();b=document.querySelector(d);null!=b&&(b.style.display="block");document.querySelector(`${d} .qq-upload-list-selector.qq-upload-list`).style.display="block"}}})},onDragEnter(a){"DocumentShare"===virtualclass.currApp?(virtualclass.vutil.makeElementDeactive("#listnotes"),virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery")):
"Video"===virtualclass.currApp&&(virtualclass.vutil.makeElementDeactive("#listvideo"),virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"))},onDragEnd(a){}}}();c.fineUploader=b})(window);(function(c,b){const a=function(a,b,c,k,m,n){this.appId=c;this.id=null;this.parent="undefined"!==typeof a?a:null;this.status="undefined"!==typeof m?m:1;this.type=b;this.module=k;"video"==b&&(this.videoClass=n)};a.prototype.init=function(a,c){this.rid=a;this.id=this.type+a;"undefined"!==typeof c&&(this.title=c);roles.hasControls()&&(a=b.getElementById(this.parent),null==b.querySelector(`#link${this.id}`)&&this.createPageNav(a))};a.prototype.createPageNav=function(a){var c=b.getElementById(`list${this.type}`);
a=`link${this.type}${this.rid}`;var d={rid:this.rid,status:this.status,id:this.id,type:this.type,title:this.title,titleAction:1===this.status?"Hide":"Show"};if("video"===this.type){if(d=b.getElementById("listvideo")){d=this.UI.createPageNavLink2.call(this,d);var k=virtualclass.getTemplate("linkvideo","videoupload");c.insertAdjacentHTML("beforeend",k(d));c=b.getElementById(`${this.type}Title${this.rid}`);c.innerHTML=this.title;c.dataset.title=this.title;this.UI.controller.init(this,a)}}else if("docs"===
this.type)k=virtualclass.getTemplate("docsNav",virtualclass.dts.tempFolder),d.title=virtualclass.vutil.trimExtension(d.title),c.insertAdjacentHTML("beforeend",k(d)),this.UI.controller.init(this,a);else if("notes"===this.type){k=virtualclass.getTemplate("notesNav",virtualclass.dts.tempFolder);const b=virtualclass.dts.getNote(this.rid);d.content_path=b.thumbnail;c.insertAdjacentHTML("beforeend",k(d));this.UI.controller.init(this,a)}else"ppt"===this.type&&(c=b.getElementById("listppt"))&&(d=this.UI.createPageNavLink2.call(this,
c),k=virtualclass.getTemplate("linkPpt","ppt"),c.insertAdjacentHTML("beforeend",k(d)),c=b.getElementById(`${this.type}Title${this.rid}`),c.innerHTML=this.title,c.dataset.title=this.title,this.UI.controller.init(this,a));a=b.getElementById(`mainp${this.id}`);this.createPageNavAttachEvent(a)};a.prototype.createPageNavAttachEvent=function(a){if("docs"===this.type){const b=virtualclass.dts;a=a.closest(".linkdocs");null!=a?a.onclick=b.docs.goToDocs(this.rid):alert("Element is null")}else"notes"===this.type&&
(a.onclick=virtualclass.dts.docs.goToNavs(this.rid))};a.prototype.displayContent=function(a,c){b.getElementById(a);a.appendChild(c)};a.prototype.sendUpdate=function(b){b.type=this.type;b.id=this.rid;a.prototype.xhrSend(b)};a.prototype.xhrSend=async function(a){const b=new FormData;for(const c in a)b.append(c,a[c]);await this.vxhr.post(`${c.webapi}&user=${virtualclass.gObj.uid}${"SharePresentation"!==virtualclass.currApp?"&methodname=update_content":"&methodname=update_content_video"}`,b).catch(a=>
{console.error("Request failed with error ",a)})};a.prototype.sendStatus=function(a){let b;"notes"===this.type?(b=this.rid.split("_"),a.uuid=b[0],a.page=+b[1]):(a.uuid=this.rid,a.page=0);virtualclass.xhrn.vxhrn.post(virtualclass.api.UpdateDocumentStatus,a).then(a=>{console.log(`====> Update status  ${a.data}`)})};a.prototype.rearrange=function(){const a=b.querySelectorAll(`#list${this.type} .link${this.type}`),c=[];if(null!=a)for(let b=0;b<a.length;b++)c.push(a[b].dataset.rid);0<c.length&&("notes"===
this.type?virtualclass.dts.reArrangeNotes(c):virtualclass[this.module]._rearrange(c))};a.prototype.disable=function(a){"notes"===this.type?virtualclass.dts.noteDisable(this.rid):virtualclass[this.module].disable(this.rid)};a.prototype.enable=function(){"notes"===this.type?virtualclass.dts.noteEnable(this.rid):virtualclass[this.module].enable(this.rid)};a.prototype.UI={mainPDiv(){const a=b.createElement("div");a.className=`mainp${this.type}`;a.id=`mainp${this.id}`;a.className="mainpreview";if("notes"===
this.type){a.innerHTML="";const d=b.createElement("img");d.className="thumbnail";d.id=`thumbnail${this.rid}`;var c=virtualclass.dts.getNote(this.rid);d.src=c.content_path;d.style.border="1px solid gray";d.style.width="70px";d.style.height="40px";d.style.padding="5px";a.appendChild(d);c=b.querySelectorAll(`#list${this.type} .link${this.type}`);c=null!=c?c.length:1;const f=b.createElement("span");f.className="thumbList tooltip2";f.innerHTML=c;f.dataset.title=this.title;a.appendChild(d);a.appendChild(f)}else"docs"===
this.type&&(a.innerHTML=this.title,a.dataset.title=this.title,a.className+=" tooltip2");a.dataset.screen=this.id;a.dataset.rid=this.rid;return a},createPageNavLink2(){const a=b.createElement("div");a.className=`link${this.type}`;a.id=`link${this.id}`;a.className=`link${this.type} links`;a.dataset.screen=this.id;a.dataset.rid=this.rid;a.type=this.type;a.dataset.selected=0;a.dataset.status=this.status;"video"===this.type&&a.classList.add(this.videoClass);return a},createPageNavLink(a){const b={};let c;
b.type=this.type;b.className=`link${this.type}`;b.id=`link${this.id}`;b.className=`link${this.type} links`;b.dataset={};b.dataset.screen=this.id;b.dataset.rid=this.rid;b.dataset.selected=0;b.dataset.status=this.status;"video"===this.type?(b.type="video",c=virtualclass.getTemplate("linkvideo","videoupload")):c=JST["templates/linkdoc.hbs"];a.insertAdjacentHTML("beforeend",c(b))},mainView(){b.getElementById(this.parent);if(null==b.getElementById(`screen-${this.type}`)){const a={hasControls:roles.hasControls(),
cd:virtualclass.dts.docs.currDoc},c=JST["templates/docMain.hbs"];b.querySelector("#documentScreen").insertAdjacentHTML("beforeend",c(a))}return b.querySelector(`#screen${this.id}   .pageContainer`)},controller:{cthis:null,init(a,b){this.cthis=a;this.element(a,"status",this.cthis.status);this.element(a,"delete");"video"===a.type&&this.element(a,"edit");"docs"!==a.type&&this.dragDrop.init(this.cthis)},dragDrop:{cthis:null,source:null,init(a){const c=this;this.cthis=a;const d=b.querySelector(`#${`link${this.cthis.type}${this.cthis.rid}`}`);
d.setAttribute("draggable","true");d.addEventListener("dragstart",b=>{c.handleDragStart(b,a)},!1);d.addEventListener("dragenter",b=>{c.handleDragEnter(b,a)},!1);d.addEventListener("dragend",b=>{c.handleDragEnd(b,a)},!1)},isBefore(a,b){if(a&&b){if(a.parentNode===b.parentNode)for(;a;a=a.previousSibling)if(a===b)return!0;return!1}},handleDragStart(a,b){a.dataTransfer.setData("text/plain","nirmala");"video"===b.type?(virtualclass.vutil.makeElementDeactive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),
virtualclass.vutil.makeElementActive("#listvideo")):"notes"===this.cthis.type&&(virtualclass.vutil.makeElementDeactive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listnotes"));a.target.classList.contains(`link${b.type}`)?this.source=a.target:this.source=a.target.closest(`.link${b.type}`);a.dataTransfer.effectAllowed="move";this.source&&this.source.classList.add("dragElem")},handleDragEnter(a,c){"video"===c.type?virtualclass.vutil.makeElementActive("#listvideo"):
"notes"===c.type&&virtualclass.vutil.makeElementActive("#listnotes");if(this.source){this.source.classList.add("dragElem");if("video"===c.type||"notes"===c.type||"ppt"===c.type){var d=b.querySelectorAll(`#virtualclassCont.congrea .link${c.type}.htn`);for(let a=0;a<d.length;a++)d[a].classList.remove("htn")}d=a.target.closest(`.link${c.type}`);d.classList.add("htn");this.isBefore(this.source,d)?d.parentNode.insertBefore(this.source,d):(a=a.target.closest(`.link${c.type}`),a.parentNode.insertBefore(this.source,
a.nextSibling));if("video"===c.type||"notes"===c.type||"ppt"===c.type)for(c=b.querySelectorAll(`#virtualclassCont.congrea .link${c.type}:not(.dragElem)`),a=0;a<c.length;a++)c[a].classList.add("opaq")}},handleDragEnd(a,c){"DocumentShare"===virtualclass.currApp&&(virtualclass.dts.indexNav.oldOrder=virtualclass.orderList.DocumentShare.ol.order);c.rearrange();a.preventDefault();this.source.classList.remove("dragElem");if("video"===c.type||"notes"===c.type||"ppt"===c.type){"video"===c.type?virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"):
"notes"===c.type&&virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery");virtualclass.vutil.makeElementActive(`#list${c.type}`);a=b.querySelectorAll(` #virtualclassCont.congrea .link${c.type}.opaq`);for(let b=0;b<a.length;b++)a[b].classList.remove("opaq");c=b.querySelectorAll(` #virtualclassCont.congrea .link${c.type}.htn`);for(a=0;a<c.length;a++)c[a].classList.remove("htn")}}},events:{status2(a,b){0===+a.dataset.status?(a.title="video"===b.type||
"ppt"===b.type?"Disable":"Hide",b.status=1,b.enable()):(a.title="video"===b.type||"ppt"===b.type?"Enable":"Show",b.status=0,b.disable());a.dataset.status=b.status;a.closest(`.link${b.type}`).dataset.status=b.status;a.querySelector(".statusanch").innerHTML=`status${a.dataset.status}`;b.sendStatus({action:"status",status:a.dataset.status})},status(a,b){0===+a.dataset.status?this.enableElement(a,b):this.disableElement(a,b);this.setStatusToElement(a,b)},disableElement(a,b){a.title="video"===b.type||"ppt"===
b.currObj?"Enable":"Show";b.status=0;b.disable()},enableElement(a,b){a.title="video"===b.type||"ppt"===b.type?"Disable":"Hide";b.status=1;b.enable()},setStatusToElement(a,b){a.dataset.status=b.status;const c=a.closest(`.link${b.type}`);null!=c&&(c.dataset.status=b.status);a.querySelector(".statusanch").innerHTML=`status${a.dataset.status}`;b.sendStatus({action:0===b.status?"disable":"enable"})},delete(a,b,g){virtualclass.dashboard.userConfirmation(virtualclass.lang.getString("deletepopup"),a=>{a&&
("notes"===b.type?virtualclass[b.module].deleteNote(b.rid,b.type):virtualclass[b.module].delete(b.rid))});"DocumentShare"===virtualclass.currApp&&(a=g||c.event,a.stopPropagation&&a.stopPropagation(),null!=a.cancelBubble&&(a.cancelBubble=!0))},edit(a,c){if(!b.querySelector(`#titleCont${c.rid}`)&&"video"===c.type){var d=function(){var a=b.querySelector(`#virtualclassCont.congrea #temp${c.rid}`);a&&(a.value||(a.value=c.title),a.value&&(virtualclass.videoUl.editTitle(c.rid,a.value,c.videoClass),a=b.querySelector(`#virtualclassCont.congrea #titleCont${c.rid}`),
a.parentNode.removeChild(a)))},f=b.querySelector(`#virtualclassCont.congrea #videoTitle${c.rid}`);a=f.innerHTML;f.style.display="none";const g=b.querySelector(`#virtualclassCont.congrea #videoTitleCont${c.rid} .controls.edit`),k=b.createElement("div");k.setAttribute("class","titleCont");k.setAttribute("id",`titleCont${c.rid}`);f.parentNode.insertBefore(k,g);f=b.createElement("input");f.setAttribute("type","text");f.setAttribute("class","textInput");f.setAttribute("id",`temp${c.rid}`);f.setAttribute("placeholder",
a);k.appendChild(f);$(b).on("click",a=>{a.target.id!==`temp${c.rid}`&&a.target.id!==`editVideoTitle${c.rid}`&&d()})}}},element2(a,c,g){("video"===a.type?"status"===c?b.querySelector(`#controlCont${a.type}${a.rid} .status`):b.querySelector(`#controlCont${a.type}${a.rid} .delete`):"status"===c?b.querySelector(".controls.status"):b.querySelector(".controls.delete")).onclick=this.goToEvent(this.cthis,c)},element(a,c,g){g=`.${c}`;"status"===c||"delete"===c?b.querySelector(`#controlCont${a.type}${a.rid} ${g}`).onclick=
this.goToEvent(this.cthis,c):"edit"===c&&(g=b.querySelector(`#${a.type}TitleCont${a.rid} ${g}`),g.onclick=this.goToEvent(this.cthis,c),"video_yts"!==a.videoClass&&(g.style.pointerEvents="none",g.classList.add("editDisable")));const d=this;if(c=b.querySelector(`#link${a.type}${a.rid}`))d.hoverHandler(a),c.classList.add("showCtr"),c.addEventListener("mouseover",()=>{d.hoverHandler(a)}),c.addEventListener("mouseout",()=>{d.hoverHandler1(a)})},hoverHandler(a){(a="video"===a.type?b.querySelector(`#VideoDashboard #link${a.type}${a.rid} .controlCont`):
"ppt"===a.type?b.querySelector(`#SharePresentationDashboard #link${a.type}${a.rid} .controlCont`):b.querySelector(`#DocumentShareDashboard #link${a.type}${a.rid} .controlCont`))&&a.classList.add("showCtr")},hoverHandler1(a){"video"===a.type?(a=b.querySelector(`#VideoDashboard #link${a.type}${a.rid} .controlCont`),a.classList.remove("showCtr")):"ppt"===a.type&&(a=b.querySelector(`#SharePresentationDashboard #link${a.type}${a.rid} .controlCont`),a.classList.remove("showCtr"))},goToEvent(a,b){const c=
this;return function(d){c.events[b](this,a,d)}}}};c.page=a})(window,document);(function(c){let b=!0;c.documentShare=function(){return{allPages:null,allNotes:null,allDocs:null,notes:null,order:[],tempFolder:"documentSharing",appName:"DocumentShare",sentStudentLayout:!1,async init(){virtualclass.orderList[this.appName]||(virtualclass.orderList[this.appName]=new OrderedList);this.pages={};this.notes={};b=!0;"undefined"===typeof this.indexNav&&(this.indexNav=new virtualclass.pageIndexNav("documentShare"));this.UI.container();roles.hasControls()&&virtualclass.config.makeWebSocketReady&&
(ioAdapter.mustSend({dts:{init:"studentlayout"},cf:"dts"}),virtualclass.dts.sentStudentLayout=!0,virtualclass.serverData.syncAllData());await this.afterFirstRequestDocs(virtualclass.serverData.rawData.docs)},moveProgressbar(){const a=document.querySelector("#docsUploadMsz"),b=document.querySelector("#docsuploadContainer .qq-upload-list-selector.qq-upload-list");if(b){b.style.display="block";const c=document.createElement("div");a.appendChild(c);c.appendChild(b)}},setNoteScreen(a){if(null==document.querySelector(`#note${a.slideNumber}.current.note`)){const b=
this.getDocId(a.slideNumber);this.docs.executeScreen(b,"fromreload",void 0,a.slideNumber);this.setScreenByOrder(b)}},setScreenByOrder(a){if(null!=virtualclass.orderList[this.appName].ol.order&&0<virtualclass.orderList[this.appName].ol.order.length){const b=this.getAllNotes(virtualclass.orderList[this.appName].ol.order);let c;for(let a=0;a<b.length;a++)c=b[a].id.split("_")[0],this.setLinkSelected(c,1);this.createNoteLayout(b,a);this.reArrangeNotes(virtualclass.orderList[this.appName].ol.order);for(a=
0;a<virtualclass.orderList[this.appName].ol.order.length;a++)this.noteStatus(virtualclass.orderList[this.appName].ol.order[a],this.allNotes[virtualclass.orderList[this.appName].ol.order[a]].status)}},createNoteLayout(a,b){var c=[];for(let b=0;b<a.length;b++)Object.prototype.hasOwnProperty.call(a[b],"deletedn")||c.push(a[b]);0<c.length&&(null==document.querySelector("#screen-docs .pageContainer")?(b={notes:c,hasControls:roles.hasControls(),cd:b},c="screen",a=document.querySelector("#docScreenContainer")):
(b={notes:c},c="notesMain",a=document.querySelector("#screen-docs #notesContainer")),c=virtualclass.getTemplate(c,"documentSharing"),b=c(b),null!=a&&a.insertAdjacentHTML("beforeend",b),roles.hasControls()||virtualclass.vutil.showZoom())},afterUploadFile(a){roles.hasControls()&&(this.createPageForNavigation(a),virtualclass.serverData.pollingStatus().then(()=>{virtualclass.dts.afterConverted()}))},initDocs(a){if("object"!==typeof this.pages[a]){let b=0;if("true"===this.allDocs[a].status||1===this.allDocs[a].status)b=
1;const c=`docs${a}`;this.pages[c]=new virtualclass.page("docScreenContainer","docs","virtualclassDocumentShare","dts",b);this.pages[c].init(a,this.allDocs[a].filename)}},fetchAllNotes(){const a={};for(const b in virtualclass.dts.allDocs)for(let c=0;c<virtualclass.dts.allDocs[b].notesarr.length;c++)a[virtualclass.dts.allDocs[b].notesarr[c].id]=virtualclass.dts.allDocs[b].notesarr[c];return a},afterFirstRequestDocs(a){this.rawToProperData(a);for(const a in this.allDocs)Object.prototype.hasOwnProperty.call(this.allDocs[a],
"deleted")||this.initDocs(this.allDocs[a].fileuuid);roles.hasAdmin()&&(virtualclass.config.makeWebSocketReady?this.requestOrder(this.executeOrder):this.executeOrder(virtualclass.orderList.DocumentShare.ol.order))},rawToProperData(a){this.allDocs=this.convertInObjects(a);this.allNotes=this.fetchAllNotes()},afterRequestOrder(a){null!=a&&0<a.length&&(virtualclass.orderList[this.appName].ol.order=a,a=this.getDocId(virtualclass.orderList[this.appName].ol.order[0]),Object.prototype.hasOwnProperty.call(virtualclass.dts.allDocs,
a)&&(a=`docs${a}`,this.setScreenByOrder(a),this.docs.currNote=virtualclass.orderList[this.appName].ol.order[0],this.docs.displayScreen(a,virtualclass.orderList[this.appName].ol.order[0])))},requestOrder(a){virtualclass.vutil.requestOrder(a)},executeOrder(a){null!=a&&"undefined"!==typeof a&&0<a.length&&("Failed"===a||"Error"===a?($("#congdashboard").modal(),virtualclass.dashboard.clickCloseButton()):a&&roles.hasAdmin()&&(ioAdapter.mustSend({dts:{order_recived:virtualclass.orderList.DocumentShare.ol.order},
cf:"dts"}),"DocumentShare"===virtualclass.currApp&&(virtualclass.dts.afterRequestOrder(virtualclass.orderList.DocumentShare.ol.order),virtualclass.dts.createNoteNav())))},getFilenameFromUploadingfiles(a){for(a=0;a<virtualclass.gObj.uploadingFiles.length;)return virtualclass.gObj.uploadingFiles[a].name},createPageForNavigation(a){var b={filename:this.getFilenameFromUploadingfiles(a),fileuuid:a,filepath:"somewhere",filetype:"doc",key_room:`${virtualclass.gObj.sessionInfo.key}_${virtualclass.gObj.sessionInfo.room}`,
status:1};this.allDocs[a]=b;b=0;if("true"===this.allDocs[a].status||1===this.allDocs[a].status)b=1;const c=`docs${a}`;"object"!==typeof this.pages[c]&&(this.pages[c]=new virtualclass.page("docScreenContainer","docs","virtualclassDocumentShare","dts",b),this.pages[c].init(a,this.allDocs[a].filename),Object.prototype.hasOwnProperty.call(this.allDocs[a],"notes")||document.querySelector(`#linkdocs${a}`).classList.add("noDocs"))},afterConverted(){virtualclass.dts.afterFirstRequestDocs(virtualclass.serverData.rawData.docs);
ioAdapter.mustSend({dts:{fallDocs:!0},cf:"dts"});this.removeNoDocsElem()},triggerMsgCloseButton(){this.successMsgTime&&clearTimeout(this.successMsgTime);this.successMsgTime=setTimeout(()=>{const a=document.querySelector("#docsUploadMsz .close");a&&a.click()},4E3)},removeNoDocsElem(){const a=document.querySelectorAll(".noDocs");for(let b=0;b<a.length;b++)a[b].classList.remove("noDocs")},requestSlides(a){const b=this.getDocs(a);if(null!=b){const c=document.querySelector(`#linkdocs${a}`).dataset.selected;
ioAdapter.mustSend({dts:{dres:a,ds:1-+c},cf:"dts"});return b}return null},getNotes(a){return this.allDocs[a].notesarr},removePagesUI(a){a=this.getNotes(a);for(let b=0;b<a.length;b++)this.removePageUI(a[b].id);0>=virtualclass.orderList[this.appName].ol.order.length&&(b=!0);roles.hasControls()&&this.indexNav.createIndex()},removePageUI(a){var b=virtualclass.orderList[this.appName].ol.order.indexOf(a);0<=b&&virtualclass.orderList[this.appName].ol.order.splice(b,1);b=document.querySelector(`#notesContainer #note${a}`);
null!=b&&b.parentNode.removeChild(b);"object"===typeof virtualclass.wb[`_doc_${a}_${a}`]&&delete virtualclass.wb[`_doc_${a}_${a}`];this.removeNoteNav(a);this.reaArrangeThumbCount();if(!roles.hasControls())if(a=document.querySelector("#notesContainer .note.current"))a=a.id.split("note")[1],virtualclass.dts.indexNav.studentDocNavigation(a);else{if(a=document.getElementById("stdPageNo"))a.innerHTML=1;virtualclass.dts.indexNav.setTotalPages(virtualclass.orderList.DocumentShare.ol.order.length)}},addPages(a){let b=
0;for(;b<a.length;)Object.prototype.hasOwnProperty.call(a[b],"deletedn")||null==virtualclass.orderList[this.appName].ol.order||(Array.isArray(virtualclass.orderList[this.appName].ol.order)||(virtualclass.orderList[this.appName].ol.order=[]),-1>=virtualclass.orderList[this.appName].ol.order.indexOf(a[b].id)&&virtualclass.orderList[this.appName].insert(a[b].id)),b++},toggleSlideWithOrder(a){a=document.querySelector(`#linkdocs${a}`);if(null!=a){if("1"===a.dataset.selected)return a.dataset.selected=0,
!1;a.dataset.selected=1;return!0}},setLinkSelected(a,b){a=document.querySelector(`#linkdocs${a}`);null!=a&&(a.dataset.selected=b)},onResponseFiles(a,c,f,g,k){if(b){if("undefined"!==typeof g)this.docs.currNote=g;else if(!virtualclass.dts.noteExist()){for(var d=0;d<c.length;d++)if(1===c[d].status){g=c[d].id;break}this.docs.currNote=g}b=!1}"undefined"!==typeof f?(d=+f,roles.hasControls()&&(1===f?this.setLinkSelected(a,1):this.setLinkSelected(a,0))):d=roles.hasControls()?this.toggleSlideWithOrder(a,c):
!0;d?(this.addPages(c),a="string"!==typeof a?`docs${a}`:0<=a.indexOf("docs")?a:`docs${a}`,this.createNoteLayout(c,a),"undefined"!==typeof g?this.docs.displayScreen(a,g):virtualclass.dts.noteExist()||this.docs.displayScreen(a),"undefined"!==typeof k?this.createNoteNav(k):this.createNoteNav(),this.updateLinkNotes(this.docs.currNote),virtualclass.dts.setCurrentNav(this.docs.currNote),virtualclass.vutil.hideUploadMsg("docsuploadContainer"),virtualclass.vutil.addNoteClass()):(this.deleteNotesFromOrder(a),
this.removePagesUI(a),virtualclass.dts.noteExist()||(virtualclass.vutil.showUploadMsg("docsuploadContainer"),virtualclass.dts.docs.currNote=0,virtualclass.dts.docs.currDoc=void 0,virtualclass.gObj.currWb=null),virtualclass.dts.docSelected()||(c=JSON.parse(localStorage.getItem("dtsdocs")),null!=c&&(c.slideNumber=null),roles.isStudent()&&!virtualclass.dts.noteExist()&&(c=document.querySelector("#docScreenContainer"),null!=c&&c.classList.remove("noteDisplay"),virtualclass.gObj.currWb=null,document.querySelector("#virtualclassCont").classList.remove("pdfRendering"),
c=document.querySelector("#virtualclassAppLeftPanel.hideZoom"),g=document.querySelector("#virtualclassAppLeftPanel"),c||(g.classList.add("hideZoom"),g.classList.remove("showZoom")))));null==document.querySelector("#listnotes .currentNav")&&(c=document.querySelector("#listnotes .linknotes"),null!=c&&(virtualclass.dts.currNote=c.dataset.rid,c=document.querySelector(`#mainpnotes${virtualclass.dts.currNote}`),null!=c&&(virtualclass.dts.docs.currDoc=virtualclass.dts.currNote.split("_")[0],c.click())));
roles.hasAdmin()&&this.sendOrder(virtualclass.orderList[this.appName].ol.order)},selectFirstNote(){if(null==document.querySelector("#notesContainer .current")){const a=document.querySelector("#notesContainer .note");null!=a&&(this.docs.currNote=a.dataset.slide,this.docs.currDoc=`docs${this.getDocId(a.dataset.slide)}`,this.docs.note.getScreen(a))}},isDocumentExist(a){if("undefined"!==typeof a)return"layout"!==a.init&&"studentlayout"!==a.init?!0:!1},isDocAlreadyExist(a){for(let b=0;b<this.documents.length;b++)if(this.documents[b].id===
a)return!0;return!1},UI:{id:"virtualclassDocumentShare",class:"virtualclass container",container(){if(null==document.getElementById(this.id)){var a={control:roles.hasControls()};const b=virtualclass.getTemplate("docsMain","documentSharing");virtualclass.vutil.insertAppLayout(b(a));null==document.querySelector("#congdashboard")&&(a=virtualclass.getTemplate("dashboard")({app:"DocumentShare"}),document.querySelector("#dashboardContainer").innerHTML=a)}null==document.querySelector("#DocumentShareDashboard")&&
(a=document.createElement("div"),document.querySelector("#congdashboard .modal-body").appendChild(a),a.id="DocumentShareDashboard");null==document.querySelector("#docsDbCont")&&(a=virtualclass.vutil.getDocsDashBoard("DocumentShare"),document.querySelector("#DocumentShareDashboard").innerHTML=a,roles.hasControls()&&(virtualclass.vutil.attachEventToUploadTab(),null==document.querySelector("#DocumentShareDashboard .qq-gallery")&&virtualclass.vutil.modalPopup("docs",["docsuploadContainer"]),virtualclass.dashboard.modalCloseHandler()))},
createMainContent(a,b,c){},createSlides(a,b){let c=document.querySelector("#notesContainer");null==c&&(c=document.createElement("div"),c.className="notes",c.id="notesContainer");for(let a=0;a<b.length;a++)if(null==document.querySelector(`#note${b[a].id}`)){const c=document.createElement("div");c.id=`note${b[a].id}`;c.className="note";c.dataset.slide=b[a].id;c.dataset.status="true"===c.dataset.statuS||!0===c.dataset.statuS?1:"false"===c.dataset.status||!1===c.dataset.status?0:b[a].status}a.appendChild(c);
roles.hasControls()&&(this.createNavigation(a,"prev"),this.createNavigation(a,"next"))},createNavigation(a,b){if(null==document.querySelector(`#docs${b}`)){const c=document.createElement("span");c.className=`${"nvgt "}${b}`;c.id=`docs${b}`;a.appendChild(c)}},createDocsNav(a,b){let c=document.getElementById("listDocs");null==c&&(c=document.createElement("div"),c.id="listDocs",a.appendChild(c));a=this.createDocsNavLink(b);this.attachDocsNav(a,b);c.appendChild(a)},createDocsNavLink(a){const b=document.createElement("div");
b.id=`link${a}`;b.className="linkdoc";b.innerHTML=a;b.dataset.screen=a;return b},attachDocsNav(a,b){a.onclick=virtualclass.dts.docs.goToDocs(b)}},createNoteNav(a){let b;virtualclass.orderList[this.appName].ol.order&&this.indexNav.init();for(let c=0;c<virtualclass.orderList[this.appName].ol.order.length;c++)"object"!==typeof this.notes[virtualclass.orderList[this.appName].ol.order[c]]&&(b="true"===this.allNotes[virtualclass.orderList[this.appName].ol.order[c]].status||1===+this.allNotes[virtualclass.orderList[this.appName].ol.order[c]].status?
1:0,this.notes[virtualclass.orderList[this.appName].ol.order[c]]=new virtualclass.page("screen-docs","notes","virtualclassDocumentShare","dts",b),this.notes[virtualclass.orderList[this.appName].ol.order[c]].init(virtualclass.orderList[this.appName].ol.order[c],`note_${this.allNotes[virtualclass.orderList[this.appName].ol.order[c]].lc_content_id}_${virtualclass.orderList[this.appName].ol.order[c]}`),"undefined"===typeof a&&this.noteStatus(virtualclass.orderList[this.appName].ol.order[c],b)),0===c&&
virtualclass.vutil.hideUploadMsg("docsuploadContainer");roles.hasControls()&&(this.indexNav.shownPage(this.indexNav.width),this.indexNav.addActiveNavigation(),document.querySelector("#dcPaging").addEventListener("change",function(){virtualclass.dts.docs.goToNavs(this.value)()}));document.querySelector(".congrea.teacher  #dashboardContainer .modal-header button.enable")||virtualclass.vutil.showFinishBtn();this.indexNav.setTotalPages(virtualclass.orderList[virtualclass.dts.appName].ol.order.length)},
addNoteHidClass(a,b,c){b>c?a.classList.add("hid","right"):a.classList.add("shw")},indexHandler(a){virtualclass.dts.docs.goToNavs(a)},createNoteNavAlt(a){let b;for(let c=0;c<virtualclass.orderList[this.appName].ol.order.length;c++)b="true"===this.allNotes[virtualclass.orderList[this.appName].ol.order[c]].status||1===+this.allNotes[virtualclass.orderList[this.appName].ol.order[c]].status?1:0,this.notes[virtualclass.orderList[this.appName].ol.order[c]]=new virtualclass.page("screen-docs","notes","virtualclassDocumentShare",
"dts",b),this.notes[virtualclass.orderList[this.appName].ol.order[c]].init(virtualclass.orderList[this.appName].ol.order[c],`note_${this.allNotes[virtualclass.orderList[this.appName].ol.order[c]].lc_content_id}_${virtualclass.orderList[this.appName].ol.order[c]}`),"undefined"===typeof a&&this.noteStatus(virtualclass.orderList[this.appName].ol.order[c],b)},removeNoteNav(a){const b=document.querySelector(`#linknotes${a}`);null!=b&&b.parentNode.removeChild(b);"object"===typeof this.notes[a]&&delete this.notes[a]},
docs:{num:0,currNote:0,curr(a,b){this.currDoc=a;virtualclass.dts.docs.num=a;const c=document.querySelector("#documentScreen .screen.current");null!=c&&c.classList.remove("current");document.querySelector("#screen-docs").classList.add("current");document.querySelector("#documentScreen").dataset.screen=a;this.note="undefined"!==typeof b?new this.slide(b):new this.slide;this.note.init();this.note.currentSlide(this.currNote)},display(a){document.querySelector(a).style.display="block"},hide(a){document.querySelector(a).style.display=
"none"},goToDocs(a){const b=this;return function(){"object"===typeof virtualclass.dts.docs.note&&virtualclass.vutil.updateCurrentDoc(virtualclass.dts.docs.note.currNote);b.executeScreen(a);roles.hasControls()&&(Object.keys(virtualclass.dts.notes).length?virtualclass.vutil.showFinishBtn():virtualclass.vutil.removeFinishBtn(),virtualclass.dts&&virtualclass.dts.docs&&virtualclass.dts.docs.currNote&&virtualclass.dts.identifyFirstAndLastNote(`note${virtualclass.dts.docs.currNote}`))}},goToNavs(a){return function(){const b=
document.querySelector(`#linknotes${a}`);null!=b?1===+b.dataset.status&&(virtualclass.dts.docs.currNote=a,virtualclass.dts.docs.note.currentSlide(a)):(virtualclass.dts.docs.currNote=a,virtualclass.dts.docs.note.currentSlide(a));virtualclass.dts.indexNav.addActiveNavigation();virtualclass.dts.indexNav.UI.setClassPrevNext()}},studentExecuteScreen(a){const b=a.dres;this.currDoc=b;const c=virtualclass.dts.getDocs(b);if(null!=c)virtualclass.dts.onResponseFiles(b,c,a.ds)},executeScreen(a,b,c,g){this.currDoc=
a;-1===a.indexOf("docs")&&(this.currDoc=`docs${a}`);const d=virtualclass.dts;if(roles.hasControls()&&"undefined"===typeof b)"docs"===a.substring(0,4)&&(a=a.split("docs")[1]),b=d.requestSlides(a),null!=b&&(d.onResponseFiles(a,b),"undefined"!==typeof c&&c());else if("undefined"!==typeof g){"string"===typeof a&&-1<a.indexOf("docs")&&(a=a.split("docs")[1]);const f=d.getDocs(a);if(null!=f){if("undefined"===typeof b)d.onResponseFiles(a,f,void 0,g);else d.onResponseFiles(a,f,void 0,g,"fromReload");"undefined"!==
typeof c&&c()}}},displayScreen(a,b){"undefined"!==typeof b?this.curr(a,b):this.curr(a)},createWhiteboard(a){virtualclass.vutil.createWhiteBoard(`_doc_${a}_${a}`);virtualclass.previous=virtualclass.dtsConfig.id},slide:function(a){return{li_items:0,imageNumber:0,currSlide:"undefined"!==typeof a?a:0,currNote:"undefined"!==typeof a?a:0,doc:1,init(){const a=virtualclass.dts;var b=document.querySelector("#screen-docs .notes");this.doc=a.docs.num;if(null!=b){if(this.li_items=b.children,this.imageNumber=
this.li_items.length,roles.hasControls()){b=document.querySelector("#screen-docs .prev");const c=document.querySelector("#screen-docs .next"),d=this;b.onclick=function(){virtualclass.vutil.navWhiteboard(d,d.prevSlide,a)};c.onclick=function(){virtualclass.vutil.navWhiteboard(d,d.nextSlide,a)}}}else alert("no element")},slideTo(a,b){const c=a.dataset.slide;virtualclass.vutil.updateCurrentDoc(c);this.displaySlide(a);roles.hasControls()&&"undefined"===typeof b&&(!virtualclass.dts.sentStudentLayout&&virtualclass.config.makeWebSocketReady&&
(ioAdapter.mustSend({dts:{init:"studentlayout"},cf:"dts"}),virtualclass.dts.sentStudentLayout=!0),ioAdapter.mustSend({dts:{slideTo:c,docn:virtualclass.dts.docs.currDoc},cf:"dts"}))},displaySlide(a){const b=document.querySelector("#screen-docs .note.current");null!=b&&b.classList.remove("current");null!=a&&a.classList.add("current");virtualclass.vutil.addNoteClass();a=a.id.split("note")[1];roles.hasControls()?virtualclass.config.makeWebSocketReady||(a=virtualclass.orderList[virtualclass.dts.appName].ol.order.indexOf(a),
virtualclass.wbCommon.indexNav.setCurrentIndex(a+1),virtualclass.dashboard.close()):virtualclass.dts.indexNav.studentDocNavigation(a)},prevSlide(a){var b=a.docs.currNote,c=document.querySelector(`#documentScreen #note${b}`);null!=c&&(c=c.previousElementSibling,null!=c?(0===+c.dataset.status?(b=this.getActiveSlide(a,b,"prev"))?(this.getScreen(b,!0),a.docs.currNote=b.dataset.slide):virtualclass.dts.indexNav.UI.setArrowStatusDocs(document.getElementById("leftNavPage"),"disable","enable"):(this.getScreen(c,
!0),a.docs.currNote=c.dataset.slide),virtualclass.dts.indexNav.movePageIndex("left")):(a=document.getElementById("leftNavPage"),virtualclass.dts.indexNav.UI.setArrowStatusDocs(a,"disable","enable")))},getActiveSlide(a,b,c){b=document.querySelector(`#documentScreen #note${b}`);if(null!=b)return b="next"===c?b.nextElementSibling:b.previousElementSibling,null!=b?0===+b.dataset.status?this.getActiveSlide(a,b.dataset.slide,c):b:!1},nextSlide(a){var b=a.docs.currNote;if(b!==virtualclass.orderList[virtualclass.dts.appName].ol.order[virtualclass.orderList[virtualclass.dts.appName].ol.order.length-
1]){var c=document.querySelector(`#documentScreen #note${b}`);null!=c&&(c=c.nextElementSibling,null!=c&&(0===+c.dataset.status?(b=this.getActiveSlide(a,b,"next"))?(this.getScreen(b,!0),a.docs.currNote=b.dataset.slide):alert("There is no page"):(this.getScreen(c,!0),a.docs.currNote=c.dataset.slide)));virtualclass.dts.indexNav.movePageIndex("right")}else a=document.getElementById("rightNavPage"),virtualclass.dts.indexNav.UI.setArrowStatusDocs(a,"disable","enable")},isSlideAvailable(a,b){return a===
b?!1:!0},currentSlide(a){a=document.querySelector(`#documentScreen #note${a}`);null!=a&&this.getScreen(a);a=document.querySelector("#docScreenContainer");null!=a&&a.classList.add("noteDisplay")},isPdfRendered(){const a=document.querySelector(`#canvas${virtualclass.gObj.currWb}`);return null!=a?Object.prototype.hasOwnProperty.call(a.parentNode.dataset,"pdfrender"):!1},getScreen(a){this.currNote=this.currSlide=a.dataset.slide;virtualclass.dts.currDoc=this.doc;this.slideTo(a);this.isWhiteboardExist(this.currNote)?
virtualclass.zoom.normalRender():virtualclass.dts.docs.createWhiteboard(this.currNote);virtualclass.vutil.updateCurrentDoc(this.currNote);virtualclass.dts.updateLinkNotes(this.currNote);virtualclass.dts.identifyFirstAndLastNote(a.id);virtualclass.userInteractivity.makeReadyContext()},isWhiteboardExist(a){var b=`_doc_${a}_${a}`;a=document.querySelector(`#${`containerWb${b}`}`);b=virtualclass.pdfRender[b];return null!==a&&null!=b}}}},destroyDts(){const a=document.getElementById(virtualclass.dts.UI.id);
null!=a&&a.parentNode.removeChild(a);virtualclass.dts=null},screenIsCreated(a){return null!=document.getElementById(`screen${a}`)},convertInObjects(a){const b={};for(let c=0;c<a.length;c++)b[a[c].fileuuid]=a[c];return b},onmessage(a){"object"!==typeof virtualclass.dts&&virtualclass.makeAppReady({app:"DocumentShare",data:{init:"studentlayout"}});const {dts:b}=a.message;Object.prototype.hasOwnProperty.call(b,"docn")&&-1===b.docn.indexOf("docs")&&(b.docn=`docs${b.docn}`);if(Object.prototype.hasOwnProperty.call(b,
"fallDocs"))virtualclass.dts.afterFirstRequestDocs(virtualclass.serverData.rawData.docs);else if(Object.prototype.hasOwnProperty.call(b,"dres"))this.docs.studentExecuteScreen(b),roles.hasControls()&&!virtualclass.dts.noteExist()&&(virtualclass.dashboard.open(),virtualclass.config.makeWebsocketReady||virtualclass.vutil.triggerDashboard("DocumentShare","hidepopup"));else if(Object.prototype.hasOwnProperty.call(b,"slideTo"))if("object"!==typeof this.docs.note){const a=this;this.docs.executeScreen(b.docn,
void 0,()=>{a.docs.note.currNote=b.slideTo;const c=document.querySelector(`#note${b.slideTo}`);a.docs.note.slideTo(c)},b.slideTo)}else"object"===typeof this.docs.note&&b.docn!==this.docs.num?(this.docs.currNote=b.slideTo,this.docs.note.currentSlide(b.slideTo)):(a=document.querySelector(`#note${b.slideTo}`),null!=a?(this.docs.currNote=b.slideTo,this.docs.note.getScreen(a)):alert(`Note is not found ${b.slideTo}`));else if(Object.prototype.hasOwnProperty.call(b,"dispScreen"))a=b.dispScreen.sc,virtualclass.vutil.updateCurrentDoc(a,
b.dispScreen.sn),virtualclass.dts.screenIsCreated(a)?this.docs.displayScreen(a):(this.docs.executeScreen(a,void 0,void 0,b.dispScreen.sn),"object"===typeof this.docs.note&&this.docs.note.getScreen(b.dispScreen.sn));else if(Object.prototype.hasOwnProperty.call(b,"rmnote"))this.delete(b.rmnote);else if(Object.prototype.hasOwnProperty.call(b,"rmsnote"))this.removePageUI(b.rmsnote),this.removePageFromStructure(b.rmsnote);else if(Object.prototype.hasOwnProperty.call(b,"noteSt"))if(roles.isStudent())this.noteStatus(b.note,
b.noteSt);else{a=document.querySelector(`#controlContnotes${b.note} .status`);const c=virtualclass.dts.notes[b.note];0===+b.noteSt?virtualclass.dts.notes[b.note].UI.controller.events.disableElement(a,c):virtualclass.dts.notes[b.note].UI.controller.events.enableElement(a,c);virtualclass.dts.notes[b.note].UI.controller.events.setStatusToElement(a,c)}else Object.prototype.hasOwnProperty.call(b,"docSt")?this.docStatus(b.doc,b.docSt):Object.prototype.hasOwnProperty.call(b,"order_recived")?(this.afterRequestOrder(b.order_recived),
roles.hasControls()&&!virtualclass.config.makeWebSocketReady&&virtualclass.dts.createNoteNav()):Object.prototype.hasOwnProperty.call(b,"norder")&&(virtualclass.orderList[this.appName].ol.order=b.norder,virtualclass.dts.indexNav.studentDocNavigation(this.docs.currNote))},sendCurrentDoc(){Object.prototype.hasOwnProperty.call(virtualclass.dts.docs,"currDoc")},consoleMessage(a){},_rearrange(a){alert(a.toString())},reArrangeNotes(a){virtualclass.orderList[this.appName].ol.order=a;this.reArrangeElements(a);
roles.hasAdmin()&&(this.sendOrder(virtualclass.orderList[this.appName].ol.order),ioAdapter.mustSend({dts:{norder:virtualclass.orderList[this.appName].ol.order},cf:"dts"}),virtualclass.dts&&virtualclass.dts.docs&&virtualclass.dts.docs.currNote&&virtualclass.dts.identifyFirstAndLastNote(`note${virtualclass.dts.docs.currNote}`))},sendOrder(a){Array.isArray(a)&&virtualclass.vutil.sendOrder("docs",a)},reaArrangeThumbCount(){const a=document.querySelectorAll("#listnotes .thumbList");for(let b=0;b<a.length;b++)a[b].innerHTML=
b+1},reArrangeElements(a){const b=document.getElementById("notesContainer"),c=document.createElement("div");c.id="notesContainer";c.className="notes";for(let b=0;b<a.length;b++)c.appendChild(document.getElementById(`note${a[b]}`));b.parentNode.replaceChild(c,b);this.reaArrangeThumbCount()},delete(a){this.deleteNotesFromOrder(a);virtualclass.xhrn.vxhrn.post(virtualclass.api.UpdateDocumentStatus,{uuid:a,action:"delete",page:0}).then(a=>{"ok"===a.data.status&&virtualclass.dts.sendOrder(virtualclass.orderList[this.appName].ol.order)});
this.deleteDocElement(a)},deleteNotesFromOrder(a){const b=this.getNotes(a);virtualclass.orderList[this.appName].ol.order=virtualclass.orderList[this.appName].ol.order.filter(a=>!b.includes(a.id))},deleteDocElement(a){const b=document.querySelector(`#linkdocs${a}`);null!=b&&b.parentNode.removeChild(b);delete this.pages[`docs${a}`];this.removePagesUI(a);this.removePagesFromStructure(a)},deleteNote(a,b){this.removePageUI(a,b);this.removePageFromStructure(a,b);roles.hasControls()&&ioAdapter.mustSend({dts:{rmsnote:a},
cf:"dts"});b=a.split("_");a=b[0];b=parseInt(b[1]);const c=this;virtualclass.xhrn.vxhrn.post(virtualclass.api.UpdateDocumentStatus,{uuid:a,action:"delete",page:b}).then(a=>{"ok"===a.data.status&&c.sendOrder(virtualclass.orderList[this.appName].ol.order)});b=!1;const d=virtualclass.dts.allDocs[a];if(null!=d)for(let a=0;a<d.notesarr.length;a++)if(!Object.prototype.hasOwnProperty.call(d.notesarr[a],"deletedn")){b=!0;break}b||this.delete(a);roles.hasControls()&&this.indexNav.createIndex()},removePagesFromStructure(a){this.allDocs[a].deleted=
"0";let b;for(b in this.allNotes)-1<this.allNotes[b].id.indexOf(a)&&this.removePageFromStructure(this.allNotes[b].id)},updateInAllDocs(a){var b=a.split("_")[0];b=this.allDocs[b];if("undefined"!==typeof b.notes[a]){b.notes[a].deletedn=a;for(let c=0;c<b.notesarr.length;c++)b.notesarr[c].id===a&&(b.notesarr[c].deletedn=a)}},removePageFromStructure(a){this.allNotes[a].deletedn=a;this.updateInAllDocs(a)},disable(a){this.docStatus(a)},enable(a){this.docStatus(a)},docStatus(a,b){var c=document.querySelector(`#linkdocs${a} .controls.status`);
b=null!=c?"undefined"===typeof b?1-+c.dataset.status:b:b;c=this.getDocs(a);for(let a=0;a<c.length;a++){const d=c[a].id;this.noteStatus(d,b);this.updatePageNavStatus(d,b)}roles.hasControls()&&ioAdapter.mustSend({dts:{docSt:b,doc:a},cf:"dts"})},updatePageNavStatus(a,b){a=document.querySelector(`#linknotes${a}`);null!=a&&(a.dataset.status=b,a=a.querySelector(".controls.status"),a.dataset.status=b,a.querySelector(".statusanch").innerHTML=`status${b}`)},noteDisable(a){this.noteStatus(a);this.sendNoteStatus(a)},
noteEnable(a){this.noteStatus(a);this.sendNoteStatus(a)},sendNoteStatus(a){if(roles.hasControls()){const b=document.querySelector(`#note${a}`);null!=b&&ioAdapter.mustSend({dts:{noteSt:b.dataset.status,note:a},cf:"dts"})}},noteStatus(a,b){const c=document.querySelector(`#note${a}`);null!=c&&(b="undefined"===typeof b?1-+c.dataset.status:1===b||"1"===b?1:0,c.dataset.status=b,b=this.allNotes[a],b.status=c.dataset.status,this.allNotes[a]=b)},getDocsOld(a){const b=[];for(const c in this.allNotes)a===this.allNotes[c].lc_content_id&&
b.push(this.allNotes[c]);return b},getDocs(a){if(null!=this.allDocs&&"object"===typeof this.allDocs[a])return this.allDocs[a].notesarr},getDocId(a){return a.split("_")[0]},getAllNotes(a){const b=[];for(let c=0;c<a.length;c++)b.push(this.allNotes[a[c]]);return b},getNote(a){return this.allNotes[a]},updateLinkNotes(a){const b=document.querySelector("#listnotes .currentNav");null!=b&&b.classList.remove("currentNav");this.setCurrentNav(a)},setCurrentNav(a){a=document.querySelector(`#linknotes${a}`);null!=
a&&a.classList.add("currentNav")},onAjaxResponse(a,b,c){if(Object.prototype.hasOwnProperty.call(c,"success")&&c.success){for(a=0;a<virtualclass.gObj.uploadingFiles.length;a++)this.afterUploadFile(virtualclass.gObj.uploadingFiles[a].uuid);virtualclass.gObj.uploadingFiles=[];this.showUploadMsz(virtualclass.lang.getString("docUploadSuccess"),"alert-success");this.triggerMsgCloseButton()}else"duplicate"===c.message?this.showUploadMsz(virtualclass.lang.getString("duplicateUploadMsg"),"alert-error"):Object.prototype.hasOwnProperty.call(c,
"error")?this.showUploadMsz(c.error,"alert-error"):this.showUploadMsz(virtualclass.lang.getString("someproblem"),"alert-error");if(a=document.querySelector("#DocumentShareDashboard .qq-upload-list-selector.qq-upload-list"))a.style.display="none";null!=document.querySelector("#listnotes")&&(virtualclass.vutil.makeElementDeactive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listnotes"))},showUploadMsz(a,b){const c=document.querySelector("#DocumentShareDashboard #docsUploadMsz");
var d=document.querySelector("#DocumentShareDashboard #docsUploadMsz .alert");d&&d.parentNode.removeChild(d);d=document.createElement("div");d.className="alert  alert-dismissable";d.classList.add(b);d.innerHTML=a;c.appendChild(d);a=document.createElement("button");a.className="close";a.setAttribute("data-dismiss","alert");a.innerHTML="&times";d.appendChild(a);a.addEventListener("click",function(){this.parentNode.remove()})},setNoteDimension(a,b,c){var d=document.querySelector(`#cont${c}`);null!=d&&
(d=document.querySelector(`#${d.parentNode.id} .imageContainer img`),d.style.width=a,d.style.height=b);system.setDocCanvasDimension(a,b,c);c=document.querySelector("#screen-docs .pageContainer");roles.hasAdmin()&&(b+=60);null!=c&&(c.style.width=`${a}px`,c.style.height=`${b}px`)},isFirstNote(a){const b=document.querySelector("#notesContainer .note");return null!=b&&a===b.id},isLastNote(a){const b=document.querySelectorAll("#notesContainer .note"),c=b[b.length-1];return 0<b.length&&c.id===a},noteExist(){return null!=
document.querySelector("#notesContainer .note")},docSelected(){return document.querySelector('#listdocs .linkdocs[data-selected="1"]')},isUploaderExist(){return null!=document.querySelector("#docsuploadContainer .qq-uploader-selector")},updateScreen(){this.rawToProperData(virtualclass.serverData.rawData.docs);for(const a in this.allDocs)Object.prototype.hasOwnProperty.call(this.allDocs[a],"deleted")?this.delete(this.allDocs[a].fileuuid):this.initDocs(this.allDocs[a].fileuuid)},printOrderList(){},
identifyFirstAndLastNote(a){const b=virtualclass.dts.isFirstNote(a);a=virtualclass.dts.isLastNote(a);const c=document.querySelector("#screen-docs .pageContainer");b&&a?(c.classList.add("firstNote"),c.classList.add("lastNote")):b?(c.classList.remove("lastNote"),c.classList.add("firstNote")):a?(c.classList.remove("firstNote"),c.classList.add("lastNote")):(c.classList.remove("firstNote"),c.classList.remove("lastNote"))}}}})(window);(function(c){"use strtic";let b,a;c.quiz=function(){return{coursequiz:[],uid:virtualclass.gObj.uid,qzid:0,newUserTime:{},list:[],listQuiz:{},uniqueUsers:[],usersFinishedQz:[],quizJSON:{},attemptedUsers:{},cmid:2,quizSt:{},quizAttempted:{},initToFetch:!0,init(){virtualclass.previrtualclass="virtualclassQuiz";virtualclass.previous="virtualclassQuiz";this.cmid=virtualclass.vutil.getUrlVars(c.webapi).cmid;!roles.hasAdmin()||roles.isEducator()?roles.isStudent()?this.UI.defaultLayoutForStudent():(this.UI.container(),
roles.hasControls()?ioAdapter.mustSend({quiz:{quizMsg:"init"},cf:"quiz"}):this.UI.defaultLayoutForStudent()):(this.UI.container(),ioAdapter.mustSend({quiz:{quizMsg:"init"},cf:"quiz"}));roles.hasControls()&&this.initToFetch&&(this.initToFetch=!1,this.interfaceToFetchList(this.cmid));const a=JSON.parse(localStorage.getItem("quizSt"));a&&(virtualclass.quiz.quizSt=a)},displayQuizModalBox(){const a=document.querySelector("#editQuizModal");a.className="modal in";a.style.display="block"},teacherViewOnPageRefresh(a){const b=
a.quizDetail;this.quizJSON=a.data.json;this.openQuizPopup(this.quizJSON,b.id);this.UI.resultView(b);this.tabContent();this.displayQuizModalBox();virtualclass.quiz.quizSt.screen="tchResultView"},displayQuizList(){console.log("===> quiz display questions");var a=!1;virtualclass.quiz.dispList("course");if(0<Object.keys(this.coursequiz).length){for(const b in this.coursequiz)Object.prototype.hasOwnProperty.call(this.coursequiz,b)&&!+this.coursequiz[b].quizstatus&&(a=!0,this.displayQuizes(this.coursequiz[b],
b));this.UI.listHeader();if(a)a=document.querySelector("#virtualclassCont.congrea #layoutQuiz #headerContainer"),a.classList.contains("show")||a.classList.add("show");else if(a=document.querySelector("#virtualclassCont.congrea #layoutQuiz #mszBoxQuiz"))a.classList.add("show"),a.innerHTML=virtualclass.lang.getString("noQuiz")}else if(a=document.querySelector("#virtualclassCont.congrea #layoutQuiz #mszBoxQuiz"))a.classList.add("show"),a.innerHTML=virtualclass.lang.getString("noQuiz")},dispList(){document.getElementById("mszBoxQuiz");
const a=document.getElementById("listQzCont");a?a.style.display="block":this.UI.layout2("layoutQuizBody")},interfaceToFetchList(a){console.log("===> quiz fetch");a=new FormData;a.append("cmid",this.cmid);a.append("user",this.uid);const b=this;virtualclass.xhr.vxhr.post(`${c.webapi}&methodname=congrea_quiz`,a).then(a=>{this.initToFetch=!0;a=a.data;if(0===a.status)document.getElementById("bootstrapQzCont").innerHTML=virtualclass.lang.getString("noQuiz");else{for(let b=0;b<=a.length-1;b++){const {options:c}=
a[b];for(const d in c)a[b].options[d]=c[d].options}b.coursequiz=a;b.displayQuizList()}}).catch(a=>{console.error("Request failed with error ",a)})},displayQuizes(a,b){this.UI.qzCont(b);this.UI.qzCtrCont(b);this.UI.qzTextCont(a,b);this.attachQZEvent(`publishQz${b}`,"click",this.publishHandler,a,b)},attachQZEvent(a,b,c,k,m){a=document.getElementById(a);null!=a&&a.addEventListener(b,()=>{"undefined"!==typeof k&&c(k,m)})},publishHandler(a,b){const c=document.getElementById("mszBoxQuiz");0<c.childNodes.length&&
c.childNodes[0].parentNode.removeChild(c.childNodes[0]);virtualclass.quiz.readyToPublishQuiz(a,b)},readyToPublishQuiz(a,b){this.openQuizPopup(a,b);this.quizPreview(a);this.displayQuizModalBox()},openQuizPopup(a,b){this.qzid=b;(a=document.getElementById("editQuizModal"))&&a.remove();a=document.getElementById("bootstrapQzCont");virtualclass.quiz.UI.generateModal("editQuizModal",a)},showQn(a){roles.hasControls()?a.innerHTML="quiz question":a.innerHTML="quiz question for student"},action(a,b,c){b(a,c)},
getQuizData(a){const d=this.coursequiz[a.id],g=new FormData;g.append("cmid",this.cmid);g.append("user",this.uid);g.append("qid",a.id);b=this;virtualclass.xhr.vxhr.post(`${c.webapi}&methodname=congrea_get_quizdata`,g,{transformResponse:a=>a}).then(a=>{if(b.isJson(a.data))b.quizJSON=a.data,$("#slickQuiz").slickQuiz({json:b.quizJSON,questionPerPage:d.questionsperpage,questionMode:d.preferredbehaviour,quizTime:d.timelimit,displayDetailResult:!1});else{const b=document.getElementById("publishQzBt");b.parentNode.removeChild(b);
document.getElementById("contQzBody").innerHTML=a}}).catch(a=>{console.error("Request failed with error ",a)})},quizPopUp(a,b){const c=function(){virtualclass.quiz.action(this.id,a,b)},d=(document.getElementById("editQuizModal")?document.getElementById("editQuizModal"):document.getElementById("qzPopup")).querySelectorAll(":scope .controls");for(let a=0;a<d.length;a++)d[a].addEventListener("click",c)},quizPreview(a){this.UI.modalContentUI();var b=document.getElementById("contQzHead"),c=document.createElement("div");
c.id="QstnName";c.innerHTML=a.name;b.appendChild(c);c=document.getElementById("contQzBody");b=document.createElement("button");b.id="publishQzBt";b.classList.add("btn","btn-default","controls");b.innerHTML=virtualclass.lang.getString("PQuiz");c.appendChild(b);c=document.createElement("i");c.className="icon-publish";b.appendChild(c);this.getQuizData(a);this.quizPopUp(this.popupFn,1)},popupFn(a,b){virtualclass.quiz[a].call(virtualclass.quiz,b)},publishQzBt(){const a=virtualclass.quiz;var b=a.quizJSON,
g=JSON.parse(b).questions.length;a.coursequiz[a.qzid].noOfQus=g;g=a.coursequiz[a.qzid];b={json:b,questionPerPage:g.questionsperpage,questionMode:g.preferredbehaviour,quizTime:g.timelimit,displayDetailResult:!1};virtualclass.quiz.publishedTime=Date.now();ioAdapter.mustSend({quiz:{quizMsg:"stdPublish",quizId:a.qzid,data:b,quizDetail:g,timestamp:virtualclass.vutil.localToUTC(Date.now())},cf:"quiz"});a.UI.resultView(g);a.tabContent();a.quizSt.screen="tchResultView";b=new FormData;b.append("cmid",a.cmid);
b.append("qzid",a.qzid);b.append("user",a.uid);virtualclass.xhr.vxhr.post(`${c.webapi}&methodname=congrea_add_quiz`,b).then(a=>{}).catch(a=>{console.error("Request failed with error ",a)})},closeQzBt(){virtualclass.quiz.publishedTime=0;var {qzid:a}=virtualclass.quiz;ioAdapter.mustSend({quiz:{quizMsg:"stdShowResult",data:{qzid:a}},cf:"quiz"});null!=virtualclass.gObj.CDTimer&&clearInterval(virtualclass.gObj.CDTimer);document.getElementById("closeQzBt").disabled=!0;a=document.createElement("div");a.className=
"alert alert-info";a.innerHTML=virtualclass.lang.getString("QClosed");resultQzLayout.insertBefore(a,resultQzLayout.firstChild)},quizDisplay(a){if(roles.isStudent()){var b=document.querySelector("#virtualclassCont.customResult");null!=b&&b.classList.remove("customResult")}(b=document.getElementById("mszBoxQuiz"))&&b.parentNode.removeChild(b);(b=document.getElementById("contQzBody"))&&b.parentNode.removeChild(b);b=document.getElementById("bootstrapQzCont");const c=virtualclass.view.customCreateElement("div",
"contQzBody","modal-body");b.appendChild(c);this.UI.modalContentUI();$("#slickQuiz").slickQuiz(a)},onmessage(a,b){var c=virtualclass.quiz;"stdPublish"===a.quiz.quizMsg&&(c.publishedTime=virtualclass.vutil.UTCtoLocalTimeToSeconds(a.quiz.timestamp),a.quiz.data.ptm=c.publishedTime,c.dataRec=a.quiz.data,c.qzid=a.quiz.quizId,roles.hasControls()&&!virtualclass.config.makeWebSocketReady?this.teacherViewOnPageRefresh(a.quiz):(c.quizSt.screen="stdPublish",this.quizDisplay(a.quiz.data),delete virtualclass.quiz.closeQuizId));
if("stdShowResult"===a.quiz.quizMsg||"quizTimeEnd"===a.quiz.quizMsg)virtualclass.quiz.publishedTime=0,roles.hasControls()&&!virtualclass.config.makeWebSocketReady?(c=document.getElementById("closeQzBt"),null!=c&&(c.disabled=!0)):(null!=document.querySelector("#timeText")&&(document.querySelector("#timeText").textContent="Quiz has been closed"),(c=document.querySelector("#slickQuiz .quizResults"))&&"block"!==c.style.display&&(c=document.querySelectorAll("#slickQuiz .nextQuestion"),c[c.length-1].click()));
"quizClosed"===a.quiz.quizMsg&&(this.closeQuizId=a.quiz.quizId,console.log("hello  brother => ",this.closeQuizId),this.quizSt={},this.UI.defaultLayoutForStudent());if("quizAttempt"===a.quiz.quizMsg&&roles.hasControls())if(virtualclass.vutil.UTCtoLocalTimeToSeconds(a.quiz.timestamp)>virtualclass.quiz.publishedTime){"undefined"===typeof this.attemptedUsers[a.quiz.questionId]&&(this.attemptedUsers[a.quiz.questionId]={});c=a.quiz.user;"undefined"===typeof this.attemptedUsers[a.quiz.questionId][c]&&(this.attemptedUsers[a.quiz.questionId][c]=
{});this.attemptedUsers[a.quiz.questionId][c]=a.quiz.ans;c=Object.keys(this.attemptedUsers[a.quiz.questionId]).length;let b=0;for(d in this.attemptedUsers[a.quiz.questionId])1==this.attemptedUsers[a.quiz.questionId][d]&&b++;document.getElementById(`usA_${a.quiz.questionId}`).innerHTML=c;var d=0;0<b&&(d=b/c*100);const f=document.getElementById(`qPb_${a.quiz.questionId}`);f.innerHTML=`${d}% correct`;f.style.width=`${d}%`;"undefined"===typeof this.quizAttempted[a.quiz.questionId]&&(this.quizAttempted[a.quiz.questionId]=
{});this.quizAttempted[a.quiz.questionId].uA=c;this.quizAttempted[a.quiz.questionId].cA=b}else console.log("Igonre the packet");"quizsubmitted"===a.quiz.quizMsg&&(this.submittedTime=virtualclass.vutil.UTCtoLocalTimeToSeconds(a.quiz.timestamp),roles.hasControls()?(console.log("===> quiz result quizsubmitted "),this.submittedTime>this.publishedTime&&(this.usersFinishedQz.push(a.quiz.user),d=this.usersFinishedQz.length,c=virtualclass.poll.capitalizeFirstLetterFnameLname(b.name),this.gradeReport(d,c,
a.quiz.timetaken,a.quiz.score,a.quiz.quesattemptd,a.quiz.correctans,b.userid),virtualclass.config.makeWebSocketReady&&this.saveGradeInDb(a.quiz.user,a.quiz.timetaken,a.quiz.score,a.quiz.quesattemptd,a.quiz.correctans))):this.submittedTime>this.publishedTime&&(this.closeQuizId&&this.closeQuizId===a.quiz.quizId?(this.quizSt={},virtualclass.config.makeWebSocketReady?this.UI.defaultLayoutForStudent():"Quiz"===virtualclass.currApp&&this.UI.defaultLayoutForStudent()):(b=document.getElementById("contQzBody"),
null!=b&&b.parentNode.removeChild(b),b=document.getElementById("layoutQuizBody"),this.UI.createMszBox(b),this.UI.displayStudentResultScreen(a.quiz))))},saveGradeInDb(a,b,g,k,m){const d=virtualclass.quiz;b=this.convertTimeToSec(b);const f=new FormData;f.append("cmid",d.cmid);f.append("qzid",d.qzid);f.append("user",a);f.append("grade",g);f.append("timetaken",b);f.append("qusattempted",k);f.append("currectans",m);virtualclass.gObj.currentSession?f.append("session",virtualclass.gObj.currentSession):null!=
localStorage.mySession&&f.append("session",localStorage.mySession);virtualclass.xhr.vxhr.post(`${c.webapi}&methodname=congrea_quiz_result`,f).then(a=>{}).catch(a=>{console.error("Request failed with error ",a)})},displayAttemptOverview(){const a=virtualclass.quiz;for(const b in a.quizAttempted)if(document.getElementById(`usA_${b}`).innerHTML=a.quizAttempted[b].uA,0<a.quizAttempted[b].cA){const c=(a.quizAttempted[b].cA/a.quizAttempted[b].uA*100).toFixed(2),d=document.getElementById(`qPb_${b}`);d.innerHTML=
`${c}% correct`;d.style.width=`${c}%`}},attemptProgressReport(){var a=JSON.parse(virtualclass.quiz.quizJSON);const b=virtualclass.view.customCreateElement("div","attemptQzBody","modal-body");a=a.questions;let c=1;for(let d=0;d<a.length;d++){const f=virtualclass.view.customCreateElement("div","","q-area");b.appendChild(f);var k=virtualclass.view.customCreateElement("span","","q-no");k.innerHTML=c;f.appendChild(k);k=virtualclass.view.customCreateElement("div","","qscolor");k.innerHTML=a[d].q;f.appendChild(k);
k=virtualclass.view.customCreateElement("div");k.innerHTML=`${virtualclass.lang.getString("UsersAttempted")} : <span id='usA_${a[d].qid}'>0</span>`;f.appendChild(k);k=this.UI.createProgressBar(a[d].qid,0);f.appendChild(k);c++}return b},tabContent(){const a=document.getElementById("resultQzLayout"),b=virtualclass.view.customCreateElement("div","","tab-content");var c=virtualclass.view.customCreateElement("div","qzOverv");c.className="tab-pane fade in active";var k=this.attemptProgressReport();c.appendChild(k);
b.appendChild(c);c=virtualclass.view.customCreateElement("div","gdRpt");c.className="tab-pane fade";k=this.UI.gradeReportLayout();c.appendChild(k);b.appendChild(c);a.appendChild(b)},gradeReport(a,b,c,k,m,n,r){const d=document.getElementById("qzReTbody");if(d){let f=document.getElementById(`user${r}`);null!==f&&(a=f.childNodes[0].innerHTML,f.parentNode.removeChild(f));f=document.createElement("tr");f.id=`user${r}`;d.appendChild(f);r=document.createElement("th");r.scope="row";r.innerHTML=a;f.appendChild(r);
a=document.createElement("td");a.innerHTML=b;f.appendChild(a);b=document.createElement("td");b.innerHTML=c;f.appendChild(b);c=document.createElement("td");c.innerHTML=`${k}%`;f.appendChild(c);k=document.createElement("td");k.innerHTML=m;f.appendChild(k);m=document.createElement("td");m.innerHTML=n;f.appendChild(m)}},quizTimer(a,b,c){function d(){g="asc"===c?a+((Date.now()-f)/1E3|0):a-((Date.now()-f)/1E3|0);r=g/3600|0;t=g%3600/60|0;z=g%60|0;r=10>r?`0${r}`:r;t=10>t?`0${t}`:t;z=10>z?`0${z}`:z;b.textContent=
`${r}:${t}:${z}`;if(0>=g&&("asc"!==c&&(b.textContent="00 : 00 : 00 "),f=0,null!=virtualclass.gObj.CDTimer&&clearInterval(virtualclass.gObj.CDTimer),ioAdapter.mustSend({quiz:{quizMsg:"quizTimeEnd",quizId:virtualclass.view.qzid},cf:"quiz"}),roles.hasControls())){let a=document.getElementById("closeQzBt");null!=a&&(a.disabled=!0)}}c="undefined"!==typeof c?c:"desc";let f=Date.now(),g,r,t,z;null!=virtualclass.gObj.CDTimer&&clearInterval(virtualclass.gObj.CDTimer);"asc"!==c&&d();virtualclass.gObj.CDTimer=
setInterval(d,1E3)},quizModalClose(){const a=this,b=virtualclass.lang.getString("rusureCquiz");virtualclass.popup.confirmInput(b,b=>{b&&(a.quizSt={},b=document.getElementById("editQuizModal"),b.parentNode.removeChild(b),a.attemptedUsers={},a.quizAttempted={},ioAdapter.mustSend({quiz:{quizMsg:"quizClosed",quizId:a.qzid},cf:"quiz"}))})},convertSecToTime(a){if(/^\d+$/.test(a)){const b=new Date(null);b.setSeconds(a);return b.toISOString().substr(11,8)}return"00:00:00"},convertTimeToSec(a){return a?(a=
a.split(":"),3600*+a[0]+60*+a[1]+ +a[2]):0},isJson(a){try{JSON.parse(a)}catch(f){return!1}return!0},sendQuizData(a,b,c){if(roles.isStudent()){const d=virtualclass.vutil.whoIsTeacher();ioAdapter.mustSendUser({quiz:{quizMsg:"quizAttempt",quizid:a,questionId:b,ans:c,user:virtualclass.gObj.uid,timestamp:virtualclass.vutil.localToUTC(Date.now())},cf:"quiz"},d)}},UI:{id:"virtualclassQuiz",class:"virtualclass",container(){var a=document.getElementById(this.id);null!=a&&(console.log("===> Quiz remove"),a.parentNode.removeChild(a));
a=virtualclass.view.customCreateElement("div",this.id,this.class);virtualclass.vutil.insertAppLayout(a);this.layout(a)},layout(a){const b=virtualclass.view.customCreateElement("div","layoutQuiz","bootstrap container-fluid quizLayout");a.appendChild(b);a=document.createElement("nav");a.className="nav navbar ";b.appendChild(a);const c=virtualclass.view.customCreateElement("div","","vchead");c.innerHTML=virtualclass.lang.getString("Quiz");a.appendChild(c);a=virtualclass.view.customCreateElement("div",
"layoutQuizBody","quizMainCont");b.appendChild(a);this.createMszBox(a);this.createModalCont(a)},createModalCont(a){const b=virtualclass.view.customCreateElement("div","bootstrapQzCont","modalCont");a.appendChild(b)},layout2(a){var b=document.getElementById(a);null==document.getElementById("listQzCont")&&(a=document.createElement("div"),a.className="table-responsive",b.appendChild(a),b=virtualclass.view.customCreateElement("table","listQzCont","table table-bordered table-striped quizList"),a.appendChild(b))},
listHeader(){var a=document.getElementById("listQzCont");const b=document.createElement("tr");b.classList.add("headerContainer");b.id="headerContainer";a.insertBefore(b,a.firstChild);a=document.createElement("th");a.classList.add("controlsHeader");a.innerHTML=virtualclass.lang.getString("Controls");b.appendChild(a);var c=document.createElement("i");c.className="icon-setting";a.appendChild(c);a=document.createElement("th");a.classList.add("qnTextHeader");a.innerHTML=virtualclass.lang.getString("Quizes");
b.appendChild(a);c=document.createElement("i");c.className="icon-help";a.appendChild(c);a=document.createElement("th");a.classList.add("timeHeader");a.innerHTML=virtualclass.lang.getString("Time");b.appendChild(a);c=document.createElement("i");c.className="icon-creator";a.appendChild(c);a=document.createElement("th");a.classList.add("qperpageHeader");a.innerHTML=virtualclass.lang.getString("Quiz/page");b.appendChild(a)},createTab(){const a=document.createElement("ul");a.classList.add("nav","nav-tabs");
const b=document.createElement("li");b.classList.add("active","questionPreview");const c=document.createElement("a");c.setAttribute("data-toggle","tab");c.href="#qzOverv";c.innerHTML=virtualclass.lang.getString("QuestionsOverview");b.appendChild(c);a.appendChild(b);const k=document.createElement("li");k.classList.add("reportPreview");const m=document.createElement("a");m.setAttribute("data-toggle","tab");m.href="#gdRpt";c.classList.add("reportPreview");m.innerHTML=virtualclass.lang.getString("Greport");
k.appendChild(m);a.appendChild(k);k.addEventListener("click",()=>{k.classList.contains("active")||(k.classList.toggle("active"),b.classList.toggle("active"));k.classList.contains("active")&&(document.querySelector("#gdRpt").className="tab-pane fade in active",document.querySelector("#qzOverv").className="tab-pane fade")});b.addEventListener("click",()=>{b.classList.contains("active")||(b.classList.toggle("active"),k.classList.toggle("active"));b.classList.contains("active")&&(document.querySelector("#qzOverv").className=
"tab-pane fade in active",document.querySelector("#gdRpt").className="tab-pane fade")});return a},resultView(a){if(roles.hasControls()){this.createResultLayout();var b=document.querySelector("#contQzHead");if(null==document.querySelector("#QstnName")){var c=document.createElement("div");c.id="QstnName";c.innerHTML=a.name;null!=b&&b.appendChild(c)}var d=parseInt(a.timelimit);if(0<d){c="desc";var m=virtualclass.lang.getString("TimeRemaining")}else c="asc",m=virtualclass.lang.getString("ETime");b=document.getElementById("resultQzLayout");
"asc"===c&&b.classList.add("elapsedTime");d=virtualclass.view.customCreateElement("div","rsQzHead","row col-md-12");b.appendChild(d);var n=virtualclass.view.customCreateElement("div","","timilimit col-md-3 quizHeadList");n.innerHTML=`${virtualclass.lang.getString("timeLimit")} : <span> ${virtualclass.quiz.convertSecToTime(a.timelimit)}</span>`;d.appendChild(n);n=virtualclass.view.customCreateElement("div","","col-md-3 quizHeadList");n.innerHTML=`${virtualclass.lang.getString("noOfQuestions")} : <span> ${a.noOfQus}</span>`;
d.appendChild(n);n=virtualclass.view.customCreateElement("div","","col-md-3 quizHeadList");n.innerHTML=`${m} : <span id="elsTime">00:00:00</span>`;d.appendChild(n);m=virtualclass.view.customCreateElement("button","closeQzBt","");m.classList.add("btn","btn-default","controls");m.innerHTML=virtualclass.lang.getString("Cquiz");d.appendChild(m);m.addEventListener("click",virtualclass.quiz.closeQzBt);if("asc"!==c||"undefined"===typeof virtualclass.quiz.publishedTime||virtualclass.config.makeWebSocketReady)d=
virtualclass.quiz.calculateRemainingTime(+a.timelimit);else if(a=virtualclass.vutil.UTCtoLocalTimeToSeconds(virtualclass.quiz.publishedTime),d=((new Date).getTime()-a)/1E3,0>d||0===virtualclass.quiz.publishedTime)d=0;virtualclass.quiz.quizTimer(d,document.getElementById("elsTime"),c);a=this.createTab();b.appendChild(a)}},createResultLayout(){var b=document.getElementById("resultQzLayout");b&&b.parentNode.removeChild(b);if(roles.hasControls()){b=document.getElementById("contQzHead");(a=document.getElementById("publishQzBt"))&&
a.parentNode.removeChild(a);var c=document.querySelector("#contQzHead .close");c&&(c.parentNode.removeChild(c),c=virtualclass.view.customCreateElement("div","modalQzClose","close"),c.type="button",c.innerHTML="&times",b.appendChild(c));if(b=document.getElementById("quizModalBody"))for(;1<b.childElementCount;)b.removeChild(b.lastChild);c=document.createElement("div");c.id="resultQzLayout";b.appendChild(c);document.getElementById("modalQzClose").addEventListener("click",()=>{virtualclass.quiz.usersFinishedQz=
[];virtualclass.quiz.qGrade=[];virtualclass.quiz.quizModalClose()})}},createProgressBar(a,b){const c=virtualclass.view.customCreateElement("div","","progress");a=virtualclass.view.customCreateElement("div",`qPb_${a}`,"progress-bar");a.role="progressbar";a.setAttribute("setaria-valuenow",b);a.setAttribute("aria-valuemin","0");a.setAttribute("aria-valuemax","100");a.style=`width:${b}%`;a.innerHTML=`${b}% Correct`;c.appendChild(a);return c},gradeReportLayout(){const a=virtualclass.view.customCreateElement("div",
"gradeRpBody","modal-body"),b=virtualclass.view.customCreateElement("table","","table");var c=virtualclass.view.customCreateElement("thead","","thead-inverse");const k=document.createElement("tr");var m=document.createElement("th");m.innerHTML="#";k.appendChild(m);m=document.createElement("th");m.innerHTML=virtualclass.lang.getString("gRname");k.appendChild(m);m=document.createElement("th");m.innerHTML=virtualclass.lang.getString("gRtimeTaken");k.appendChild(m);m=document.createElement("th");m.innerHTML=
virtualclass.lang.getString("gRgrade");k.appendChild(m);m=document.createElement("th");m.innerHTML=virtualclass.lang.getString("gRQAttempted");k.appendChild(m);m=document.createElement("th");m.innerHTML=virtualclass.lang.getString("gRCorrect");k.appendChild(m);c.appendChild(k);b.appendChild(c);c=virtualclass.view.customCreateElement("tbody","qzReTbody");b.appendChild(c);a.appendChild(b);return a},displayStudentResultScreen(a){const b=(+a.maxmarks/a.noofqus*a.correctans).toFixed(2);var c=document.getElementById("mszBoxQuiz");
if(c){var d=document.getElementById("stdQuizMszLayout");d&&c.removeChild(d);d=document.getElementById("resultDiv");null!=d&&d.parentNode.removeChild(d);d=virtualclass.view.customCreateElement("div","resultDiv");c.appendChild(d);c=document.createElement("h4");c.innerHTML=`${virtualclass.lang.getString("QTquestions")} : ${a.noofqus}</span>`;d.appendChild(c);c=document.createElement("h4");c.innerHTML=`${virtualclass.lang.getString("gRtimeTaken")} : ${a.timetaken}</span>`;d.appendChild(c);c=document.createElement("h4");
c.innerHTML=`${virtualclass.lang.getString("QMaximumMark")} : ${(+a.maxmarks).toFixed(2)}</span>`;d.appendChild(c);c=document.createElement("h4");c.innerHTML=`${virtualclass.lang.getString("QCorrectAnswers")} : ${a.correctans}</span>`;d.appendChild(c);c=document.createElement("h4");c.innerHTML=`${virtualclass.lang.getString("QQuestionsAttempted")} : ${a.quesattemptd}</span>`;d.appendChild(c);c=document.createElement("h3");c.className="quizScore";c.innerHTML=`${virtualclass.lang.getString("QYouScored")} : <i>${b} / ${(+a.maxmarks).toFixed(2)}</i></span>`;
d.appendChild(c);d.style.display="block"}a=document.querySelector("#virtualclassCont");"mobTab"===virtualclass.system.device&&a.classList.add("customResult")},createMszBox(a){const b=virtualclass.view.customCreateElement("div","mszBoxQuiz","row");a.appendChild(b)},generateModal(a,b){const c=virtualclass.view.customCreateElement("div",a,"modal");c.role="dialog";c.style.display="none";c.setAttribute("tab-index","-1");c.setAttribute("area-hidden","true");b.appendChild(c);b=document.createElement("div");
b.className="modal-dialog";c.appendChild(b);a=virtualclass.view.customCreateElement("div","quizModalBody","modal-content");b.appendChild(a);b=virtualclass.view.customCreateElement("div","contQzHead","modal-header");a.appendChild(b);const d=virtualclass.view.customCreateElement("div","","close");d.type="button";d.setAttribute("data-dismiss","modal");d.innerHTML="&times";b.appendChild(d);b=virtualclass.view.customCreateElement("div","contQzBody","modal-body");a.appendChild(b);document.querySelector("#editQuizModal #contQzHead .close ").addEventListener("click",
()=>{c.style.display="none";c.className="modal fade"})},modalContentUI(){const a=document.getElementById("contQzBody"),b=virtualclass.view.customCreateElement("div","slickQuiz","path-mod-congrea-quiz");var c=virtualclass.view.customCreateElement("h3","","quizName");b.appendChild(c);c=virtualclass.view.customCreateElement("P","timeText");b.appendChild(c);var k=virtualclass.view.customCreateElement("div","exam_navblock","navblock");b.appendChild(k);c=virtualclass.view.customCreateElement("div","","content");
k.appendChild(c);k=virtualclass.view.customCreateElement("div","","qn_buttons multipages");c.appendChild(k);c=virtualclass.view.customCreateElement("div","","quizArea");b.appendChild(c);k=virtualclass.view.customCreateElement("div","","quizHeader");c.appendChild(k);c=virtualclass.view.customCreateElement("a","","button startQuiz");c.href="#";c.innerHTML="Get Started!";k.appendChild(c);k=virtualclass.view.customCreateElement("div","","quizResults");b.appendChild(k);var m=virtualclass.view.customCreateElement("h3",
"","quizScore");m.innerHTML="You Scored: <span></span>";k.appendChild(m);m=virtualclass.view.customCreateElement("h3","","quizLevel");c.innerHTML="<strong>Ranking:</strong> <span></span>";k.appendChild(m);c=virtualclass.view.customCreateElement("div","","quizResultsCopy");k.appendChild(c);a.appendChild(b)},qzCont(a){const b=document.getElementById("listQzCont");a=virtualclass.view.customCreateElement("tr",`contQz${a}`,"vcQuizCont");null!=b&&b.insertBefore(a,b.firstChild)},qzCtrCont(a){var b=document.getElementById(`contQz${a}`);
const c=virtualclass.view.customCreateElement("td",`ctrQz${a}`,"quizCtrCont");b.appendChild(c);b=document.createElement("a");b.href="#";b.id=`publishQz${a}`;c.appendChild(b);a=document.createElement("span");a.className="icon-publish2";a.setAttribute("data-toggle","tooltip");a.setAttribute("title",virtualclass.lang.getString("quizreviewpublish"));b.appendChild(a)},qzTextCont(a,b){b=document.getElementById(`contQz${b}`);var c=document.createElement("td");c.classList.add("qnText");c.innerHTML=a.name;
b.appendChild(c);const d=document.createElement("td");d.classList.add("creator");c=0<a.timelimit?virtualclass.quiz.convertSecToTime(a.timelimit):a.timelimit;d.innerHTML=c;b.appendChild(d);c=document.createElement("td");c.classList.add("qperpage");c.innerHTML=a.questionsperpage;b.appendChild(c)},defaultLayoutForStudent(){this.container();const a=document.getElementById("mszBoxQuiz");if(null==document.getElementById("stdQuizMszLayout")){const b=virtualclass.view.customCreateElement("div","stdQuizMszLayout");
b.innerHTML=virtualclass.lang.getString("quizmayshow");a.appendChild(b)}}},createMessageBox(){const a=document.getElementById("mszBoxQuiz");if(null==document.getElementById("stdQuizMszLayout")){const b=virtualclass.view.customCreateElement("div","stdQuizMszLayout");b.innerHTML=virtualclass.lang.getString("quizmayshow");a.appendChild(b)}},sendSubmittedQuiz(a){const b=virtualclass.vutil.whoIsTeacher();ioAdapter.mustSendUser({quiz:{quizMsg:"quizsubmitted",quizId:this.qzid,user:virtualclass.gObj.uid,
timestamp:virtualclass.vutil.localToUTC(Date.now()),timetaken:a.timetaken,quesattemptd:a.quesattemptd,correctans:a.correctans,score:a.score,maxmarks:a.maxmarks,noofqus:a.noofqus},cf:"quiz"},b)},calculateRemainingTime(a){if("undefined"!==typeof virtualclass.quiz.publishedTime&&(roles.isStudent()||roles.hasControls()&&!virtualclass.config.makeWebSocketReady)){if(0===virtualclass.quiz.publishedTime)return a;{const b=(new Date).getTime()-virtualclass.quiz.publishedTime;a=(1E3*a-b)/1E3;0>a&&(a=0)}}return a},
scrollToTop(){const a=document.querySelector("#slickQuiz .quizArea");null!=a&&(a.scrollTop=0)}}}})(window);!function(){const c=Handlebars.template;(Handlebars.templates=Handlebars.templates||{})["docNotesMain.hbs"]=c({compiler:[7,">= 4.0.0"],main(b,a,c,f,g){let d;return`<div id="notesContainer" class="notes ddd">\n  ${b.escapeExpression((d=null!=(d=c.name||(null!=a?a.name:a))?d:c.helperMissing,"function"===typeof d?d.call(null!=a?a:b.nullContext||{},{name:"name",hash:{},data:g}):d))}\n</div>`},useData:!0})}();(function(c){function b(a){}function a(){}function d(a){}function f(a){}function g(){}function k(a){}function m(b,c){v[c]=new RTCPeerConnection(pc_config);v[c].onicecandidate=n(c,"opc");v[c].onaddstream=t(c);"undefined"!==typeof _localStream&&v[c].addStream(_localStream);v[c].setRemoteDescription(new RTCSessionDescription(b.sdp),a,d);v[c].createAnswer(a=>{v[c].setLocalDescription(a);ioAdapter.sendUser({cf:"mvid",sdp:a,answer:!0},c)},f)}function n(a,b){return function(c){c.candidate&&ioAdapter.sendUser({cf:"mvid",
candidate:c.candidate,pt:b},a)}}function r(a,b){p[b]=a;virtualclass.multiVideo.removeUser(b);b=$(`<div class='videoCont remoteVideo'  id='vid${b}' data-userid='${b}' data-totaluser=''></div>`);const d=$("<video  class='videoBox' autoplay></video>");d.attr({src:c.URL.createObjectURL(a),autoplay:"autoplay"});b.append(d);$("#videosWrapper").append(b);virtualclass.multiVideo.updateVideoLength();b.click(function(){q.UI.displayMainVideo(this)});"undefined"!==typeof updateActiveTime&&clearTimeout(updateActiveTime);
updateActiveTime=setTimeout(()=>{var a=0;for(var b in p){var c=p[b].getVideoTracks()[0];const d=document.querySelector(`#vid${b}`);null!=c?(a++,null!=d&&(d.classList.add("vshow"),d.classList.remove("vhide"))):null!=d&&(d.classList.add("vhide"),d.classList.remove("vshow"))}c="one";4<a?c="morethanfour":2<a?c="four":1<a&&(c="two");a=document.querySelector("#virtualclassCont");b=document.querySelector("#videoConfrence");a.setAttribute("data-totalUser",c);b.setAttribute("data-totalUser",c)},3E3)}function t(a){return function(b){r(b.stream,
a)}}function z(a){u[a]=new RTCPeerConnection(pc_config);u[a].onicecandidate=n(a,"apc");u[a].onaddstream=t(a);"undefined"!==typeof _localStream&&u[a].addStream(_localStream);u[a].createOffer(b=>{u[a].setLocalDescription(b);ioAdapter.sendUser({cf:"mvid",sdp:b,offer:!0},a)},b)}let v,u;const p={},q={init(){this.UI.container();this.start();var a=document.querySelector("#videosWrapper .videoCont.selfVideo");a.id=`vid${virtualclass.gObj.uid}`;a.setAttribute("data-userid",virtualclass.gObj.uid);const b=this;
p[virtualclass.gObj.uid]=virtualclass.multiVideo.localStream;a.addEventListener("click",function(){b.UI.displayMainVideo(this)});this.updateVideoLength();a=localStorage.getItem("videoSwitch");null!=a&&"0"==a&&virtualclass.multiVideo.setVideoStatus(!1)},_init(){const a=document.querySelector("#videosWrapper .videoCont.selfVideo");this.UI.displayMainVideo(a);const b=this;setTimeout(()=>{b.displayVideo();roles.hasControls()&&ioAdapter.mustSend({cf:"mvid",_init:!0})},2E3)},displayVideo(){document.querySelector("#virtualclassMultiVideo").style.display=
"block"},start(){virtualclass.multiVideo.localStream=virtualclass.media.video.tempStream;const a=document.querySelector("#videoConfrence .multilocalVideo");virtualclass.adpt.attachMediaStream(a,virtualclass.multiVideo.localStream);this.initDone=!0},UI:{container(){if(null==document.querySelector("#virtualclassMultiVideo")){const a=virtualclass.getTemplate("multiVideoMain");virtualclass.vutil.insertAppLayout(a())}},displayMainVideoOld(a){const b=a.firstElementChild;if("MultiVideo"==virtualclass.currApp){const a=
document.querySelector("#multiVidSelected"),c=a.getContext("2d");"undefined"!==typeof earlierVideo&&clearInterval(earlierVideo);earlierVideo=setInterval(()=>{c.drawImage(b,0,0,a.width,a.height)},28)}},displayMainVideo(a){if("MultiVideo"==virtualclass.currApp){const b=document.querySelector("#multiVidSelected");({userid:a}=a.dataset);virtualclass.adpt.attachMediaStream(b,p[a])}}},removeUser(a){a=document.querySelector(`#videosWrapper .videoCont[data-userid="${a}"]`);null!=a&&a.parentNode.removeChild(a)},
onUserRemove(a){this.removeUser(a);this.updateVideoLength();"object"===typeof v[a]&&v[a].close();"object"===typeof u[a]&&u[a].close()},updateVideoLength(){let a;var b=document.querySelectorAll("#videoConfrence .videoCont");a="one";4<b.length?a="morethanfour":2<b.length?a="four":1<b.length&&(a="two");b=document.querySelector("#virtualclassCont");const c=document.querySelector("#videoConfrence");b.setAttribute("data-totalUser",a);c.setAttribute("data-totalUser",a)},setAudioStatus(a){const b=virtualclass.multiVideo.localStream.getAudioTracks();
if(0!==b.length)for(let c=0;c<b.length;++c)b[c].enabled=a},setVideoStatus(a){setTimeout(()=>{if("undefined"!==typeof virtualclass.multiVideo.localStream){const b=document.querySelector(`#vid${virtualclass.gObj.uid}`),c=virtualclass.multiVideo.localStream.getVideoTracks();if(0!==c.length)for(let d=0;d<c.length;++d)if(c[d].enabled=a,null!=b){const a=document.querySelector("#videoConfrence"),b=document.querySelectorAll("#videosWrapper .videoCont.vshow");null!=a&&(a.dataset.activeuser=`vid_${b.length}`)}}},
1E3)},addClass(){}};v={};u={};q.onmessage=function(b,c){if(Object.prototype.hasOwnProperty.call(b,"_init"))virtualclass.makeAppReady({app:virtualclass.apps.mv});else if(Object.prototype.hasOwnProperty.call(b,"offer"))m(b,c);else if(Object.prototype.hasOwnProperty.call(b,"candidate")){const a=new RTCIceCandidate(b.candidate);"apc"==b.pt?v[c].addIceCandidate(a,g,k):u[c].addIceCandidate(a,g,k)}else Object.prototype.hasOwnProperty.call(b,"answer")&&u[c].setRemoteDescription(new RTCSessionDescription(b.sdp),
a,d)};q.onUserJoin=function(a){setTimeout(()=>{z(a)},2E3)};c.MultiVideo=q})(window);(function(c){c.zoomWhiteboard=function(){return{init(){if(null==document.querySelector(".zoomControler")){var b=document.querySelector("#virtualclassAppLeftPanel");if(null!=b){const a=virtualclass.getTemplate("zoomControl")({hasControls:roles.hasControls()});b.insertAdjacentHTML("beforeend",a);this.initScaleController();b=localStorage.getItem("canvasDimension");null!=b&&(virtualclass.zoom.canvasDimension=JSON.parse(b))}}},initScaleController(){const b=document.querySelector(".zoomControler"),a=this;
b.querySelector(".zoomIn").addEventListener("click",()=>{virtualclass.zoom.performZoom=!0;delete virtualclass.zoom.fitToScreenWidth;delete virtualclass.zoom.prvWhiteboard;a.zoomAction("zoomIn")});b.querySelector(".zoomOut").addEventListener("click",()=>{delete virtualclass.zoom.fitToScreenWidth;delete virtualclass.zoom.prvWhiteboard;virtualclass.zoom.performZoom=!0;a.zoomAction("zoomOut")});b.querySelector(".fitScreen").addEventListener("click",()=>{a.triggerFitToScreen()})},triggerFitToScreen(){const b=
document.querySelector("#virtualclassAppLeftPanel .zoomControler .fitScreen");null!=b&&("Whiteboard"===virtualclass.currApp?this.zoomAction("fitToScreen"):(this.lastFitAction=this.doOpposite?"fittopage"===b.dataset.currstate?"fitToScreen":"fitToPage":"fittopage"===b.dataset.currstate?"fitToPage":"fitToScreen",this.zoomAction(this.lastFitAction),delete this.doOpposite))},zoomAction(b){"ScreenShare"===virtualclass.currApp?virtualclass.studentScreen[b].call(virtualclass.studentScreen):(virtualclass.zoom.prvCanvasScale=
this.canvasScale,this[b].call(this))},zoomIn(b){delete virtualclass.zoom.performFitToPage;const a=virtualclass.gObj.currWb;if("object"===typeof virtualclass.wb[a]){const c=virtualclass.wb[a].canvas.lowerCanvasEl,f=virtualclass.zoom.canvasDimension.width*virtualclass.gObj.SCALE_FACTOR,g=virtualclass.zoom.canvasDimension.height*virtualclass.gObj.SCALE_FACTOR;virtualclass.zoom.canvasDimension.width=f;virtualclass.zoom.canvasDimension.height=g;"undefined"!==typeof b?virtualclass.pdfRender[a]._zoom.call(virtualclass.pdfRender[a],
c,f,g,b):virtualclass.pdfRender[a]._zoom.call(virtualclass.pdfRender[a],c,f,g)}},zoomOut(){delete virtualclass.zoom.performFitToPage;const b=virtualclass.gObj.currWb,a=virtualclass.wb[b].canvas.lowerCanvasEl,c=a.parentNode,f=a.parentNode.offsetWidth,g=1/virtualclass.gObj.SCALE_FACTOR*virtualclass.zoom.canvasDimension.width,k=1/virtualclass.gObj.SCALE_FACTOR*virtualclass.zoom.canvasDimension.height;virtualclass.zoom.canvasDimension.width=g;virtualclass.zoom.canvasDimension.height=k;g<=f&&c.classList.remove("scrollX");
virtualclass.pdfRender[b]._zoomOut.call(virtualclass.pdfRender[b],a,g,k)},fitToScreen(){virtualclass.gObj.fitToScreen=!0;delete virtualclass.zoom.performFitToPage;delete virtualclass.zoom.performZoom;const b=virtualclass.gObj.currWb;if("undefined"!==typeof virtualclass.pdfRender[b]){const a=virtualclass.wb[virtualclass.gObj.currWb].canvas.lowerCanvasEl,c=document.querySelector(".canvasWrapper").offsetWidth;try{virtualclass.pdfRender[b]._fitToScreen.call(virtualclass.pdfRender[b],a,c),"DocumentShare"===
virtualclass.currApp&&this.fitToElementTooltip("fitToToPage")}catch(f){}}},fitToPage(){virtualclass.zoom.performFitToPage=!0;const b=virtualclass.gObj.currWb;virtualclass.pdfRender[b].innerFitToPage.call(virtualclass.pdfRender[b],b);"DocumentShare"===virtualclass.currApp&&this.fitToElementTooltip("fitToScreen")},reload(){virtualclass.zoom.normalRender()},normalRender(){const b=virtualclass.gObj.currWb;delete virtualclass.zoom.performZoom;const a=virtualclass.zoom.canvasDimension;virtualclass.pdfRender[b]&&
"object"===typeof virtualclass.pdfRender[b].shownPdf&&null!=virtualclass.zoom.canvasScale&&virtualclass.zoom.canvasDimension&&(a.width=virtualclass.zoom.canvasDimension.width/virtualclass.gObj.SCALE_FACTOR,a.height=virtualclass.zoom.canvasDimension.height/virtualclass.gObj.SCALE_FACTOR,virtualclass.gObj.normalZoomTime&&clearTimeout(virtualclass.gObj.normalZoomTime),virtualclass.gObj.normalZoomTime=setTimeout(()=>{virtualclass.zoom.zoomIn("normalRender")},100))},removeZoomController(){const b=document.querySelector("#virtualclassApp .zoomControler");
null!=b&&virtualclass.gObj.studentSSstatus.mesharing&&b.parentNode.removeChild(b)},fitToElementTooltip(b){const a=document.querySelector("#virtualclassAppLeftPanel .zoomControler .fitScreen"),c=document.getElementById("notesContainer");"fitToScreen"===b?(a&&(a.dataset.currstate="fittoscreen",document.querySelector("#virtualclassAppLeftPanel .fitScreen.congtooltip").dataset.title=virtualclass.lang.getString("fitToScreen")),c&&(c.dataset.currstate="fittotpage")):(a&&(a.dataset.currstate="fittopage",
document.querySelector("#virtualclassAppLeftPanel .fitScreen.congtooltip").dataset.title=virtualclass.lang.getString("fitToPage")),c&&(c.dataset.currstate="fittoscreen"))}}}})(window);(function(c){c.pdfRender=function(){return{firstTime:!0,firstTimeScroll:!0,shownPdf:"",canvasWrapper:null,canvasId:null,canvas:null,pdfScale:1,url:"",axhr:axios.create({timeout:5E3,withCredentials:!0,responseType:"arraybuffer"}),init(b,a){io.globallock=!1;virtualclass.gObj.firstNormalRender=!1;"undefined"!==typeof a?(this.url=virtualclass.dts.getNote(a).pdf,a="_doc_"+a+"_"+a):(this.url=`${whiteboardPath}resources/sample.pdf`,a=virtualclass.gObj.currWb);this.loadPdf(this.url,b,a)},prefechPdf(b){const a=
virtualclass.dts.getNote(b);this.axhr.get(a.pdf).then(b=>{virtualclass.vutil.afterPdfPrefetch(a.id,b.data)}).catch(a=>{console.error("Request failed with error ",a)})},loadPdf(b,a,c){Object.prototype.hasOwnProperty.call(virtualclass.gObj.nextPdf,c)?this.afterPdfLoad(a,c,virtualclass.gObj.nextPdf[c]):this.axhr.get(b).then(async b=>{await virtualclass.pdfRender[c].afterPdfLoad(a,c,b.data)})},async afterPdfLoad(b,a,c){this.wbId=a;this.canvas=b;this.canvasWrapper=b.closest(".canvasWrapper");b={};b.data=
c;null!=virtualclass.gObj.myworker&&(b.worker=virtualclass.gObj.myworker);PDFJS.workerSrc=`${whiteboardPath}build/src/pdf.worker.min.js`;PDFJS.cMapUrl=`${whiteboardPath}build/cmaps/`;PDFJS.cMapPacked=!0;c=await PDFJS.getDocument(b);c.wbId=this.wbId;this.shownPdf=c;null==virtualclass.gObj.myworker&&(virtualclass.gObj.myworker=c.loadingTask._worker);await virtualclass.pdfRender[this.wbId].displayPage(c,1,!0);roles.hasControls()||(this.leftPosX=this.topPosY=0);this.scrollEvent();"undefined"!==typeof this.wbId&&
null!=this.wbId&&(a=a.split("_"),a=document.querySelector(`#note${a[2]}_${a[3]}`),null!=a&&null!=a.nextElementSibling&&virtualclass.pdfRender[this.wbId].prefechPdf(a.nextElementSibling.dataset.slide))},updateScrollPosition(b,a){"object"===typeof this.scroll[a]&&Object.prototype.hasOwnProperty.call(this.scroll[a],"b")&&(this.scroll[a].b=b,this.scroll[a].c=this.scroll[a].b+this.scroll[a].studentVPm)},scrollEvent(){const b=this.canvasWrapper,a=b.scrollTop,c=b.scrollLeft;virtualclass.topPosY=a;virtualclass.leftPosX=
c;this.topPosY=a;this.leftPosX=c;const f=this;b.onscroll=function(){f.onScroll(b)}},onScroll(b,a){let c=b.scrollTop,f=b.scrollLeft;(0<c||"undefined"!==typeof a)&&this._scroll(f,c,b,"Y");(0<f||"undefined"!==typeof a)&&this._scroll(f,c,b,"X");roles.hasControls()||"object"!==typeof virtualclass.pdfRender[virtualclass.gObj.currWb]?roles.isStudent():virtualclass.pdfRender[virtualclass.gObj.currWb].setScrollPosition({scX:f,scY:c})},_scroll(b,a,c,f){if(roles.hasControls())return this.topPosY=a,this.leftPosX=
b,this.scrollPosition(c,f);if("Y"===f)var d=a;else"X"===f&&(d=b);this.updateScrollPosition(d,f);return null},scrollPosition(b,a){const {canvas:c}=this;if("Y"===a)var f=b.scrollTop,g=c.height;else"X"===a&&(f=b.scrollLeft,g=c.width);this[`scrollPos${a}`]=f/g*100;b=virtualclass.vutil.getElemM(`canvasWrapper${virtualclass.gObj.currWb}`,a);this[`actualVp${a}`]=b;this[`viewPort${a}`]=b/g*100;g={};g[`vp${a}`]=this[`viewPort${a}`];g[`sc${a}`]=this[`scrollPos${a}`];return g},scroll:{caclculatePosition(b,a,
c){b=this.type=c;null==this[b]&&(this[b]={});this[b].a=0;this[b].d=a;a=`canvasWrapper${virtualclass.gObj.currWb}`;c=document.querySelector(`#${a}`);null!=c&&("X"===this.type?this[b].b=c.scrollLeft:"Y"===this.type&&(this[b].b=c.scrollTop),this[b].studentVPm=virtualclass.vutil.getElemM(a,b),this[b].c=this[b].b+this[b].studentVPm)}},setScrollPosition(b){const a=virtualclass.vutil.canvasDimensionFromPixel(this.canvas);Object.prototype.hasOwnProperty.call(b,"scY")&&null!=b.scY&&null!=this.canvas&&this.scroll.caclculatePosition(b.scY,
a.height,"Y");Object.prototype.hasOwnProperty.call(b,"scX")&&null!=b.scX&&null!=this.canvas&&this.scroll.caclculatePosition(b.scX,a.width,"X")},customMoustPointer(b,a,c){this.scroll[a].e=c;this.scroll[a].e>this.scroll[a].c?(b=this.scroll[a].b+(this.scroll[a].d-this.scroll[a].c),b>this.scroll[a].e&&(b=this.scroll[a].e-(this.scroll[a].b+this.scroll[a].c)/2),"Y"==a?this.canvasWrapper.scrollTop=b:this.canvasWrapper.scrollLeft=b,this.scroll[a].b=b,this.scroll[a].c=this.scroll[a].b+this.scroll[a].studentVPm):
this.scroll[a].e<this.scroll[a].b&&(b=this.scroll[a].b-this.scroll[a].a,this.scroll[a].c-b<this.scroll[a].e&&(b=(this.scroll[a].b+this.scroll[a].c)/2-this.scroll[a].e),"Y"===a?this.canvasWrapper.scrollTop-=b:this.canvasWrapper.scrollLeft-=b,this.scroll[a].b=b,this.scroll[a].c=this.scroll[a].b+this.scroll[a].studentVPm)},setCustomMoustPointer(b,a){var c=`scrollDiv${a}${virtualclass.gObj.currWb}`,f=document.querySelector(`#${c}mousePointer`);null==f&&(f=document.createElement("div"),f.className="mousepointer",
f.id=`${c}mousePointer`,c=document.querySelector(`#scrollDiv${a}${virtualclass.gObj.currWb}`),null!=c&&c.appendChild(f));"Y"===a?f.style.top=`${b.y-this.scroll[a].a}px`:"X"===a&&(f.style.left=`${b.x-this.scroll[a].a}px`)},sendScroll(){virtualclass.vutil.setDefaultScroll()},sendCurrentScroll(b){let a={};if(null!=this.currentScroll){a=Object.assign(a,this.currentScroll);const c=this;c.currentScrolltoUser=b;setTimeout(()=>{c.currentScrolltoUser=b;a.cf="scf";a.toUser=b;virtualclass.vutil.beforeSend({toUser:b,
cf:"scf",scY:a.scY,vpY:a.vpY},b)},2E3)}},setDefaultCanvasWidth(b,a){if("_doc_0_0"!==b||0!==a.parentNode.parentNode.offsetWidth&&300!==a.parentNode.parentNode.offsetWidth)a.width=a.parentNode.parentNode.offsetWidth-6;else{let b;"Whiteboard"===virtualclass.currApp?b=document.querySelector("#virtualclassWhiteboard.canvasContainer.current"):"DocumentShare"===virtualclass.currApp&&(b=document.querySelector("#screen-docs.current"));b||(b=document.querySelector("#virtualclassAppContainer"));a.width=b.offsetWidth-
6}virtualclass.wbWrapper.util.createFabricNewInstance(b,{width:a.width,height:a.height})},calculateViewPort(b,a){const c=document.getElementById("virtualclassAppContainer");b=virtualclass.vutil.canvasDimensionFromPixel(b);const f=a.getViewport(Math.min(c.clientWidth/b.width*virtualclass.zoom.canvasScale,c.clientHeight/b.height*virtualclass.zoom.canvasScale));return f.width<c.offsetWidth?f:a.getViewport(b.width/a.getViewport(1).width)},getAppearanceCanvasWidth(b,a){Object.prototype.hasOwnProperty.call(virtualclass.zoom,
"diffrentDocumentWidth")?(b=virtualclass.zoom.diffrentDocumentWidth,delete virtualclass.zoom.diffrentDocumentWidth):Object.prototype.hasOwnProperty.call(virtualclass.gObj,"fitToScreen")?(b=300===a.parentNode.offsetWidth||0===a.parentNode.offsetWidth?document.querySelector("#virtualclassAppContainer").offsetWidth:a.parentNode.offsetWidth-6,"DocumentShare"===virtualclass.currApp&&virtualclass.zoom.fitToElementTooltip("fitToToPage")):Object.prototype.hasOwnProperty.call(virtualclass.zoom,"performZoom")?
(b=virtualclass.zoom.canvasDimension.width,delete virtualclass.zoom.performZoom):Object.prototype.hasOwnProperty.call(virtualclass.zoom,"canvasDimension")?b=virtualclass.zoom.canvasDimension.width:0===a.offsetWidth||300===a.offsetWidth||virtualclass.isPlayMode?(this.setDefaultCanvasWidth(b,a),b=virtualclass.vutil.canvasDimensionFromPixel(a).width):b=a.parentNode.offsetWidth-6;return b},async renderPage(b,a){virtualclass.zoom.prvPdfDimension&&virtualclass.zoom.prvPdfDimension[2]!==b.view[2]&&(virtualclass.gObj.fitToScreen=
!0,this.firstTime&&(virtualclass.gObj.pdfWidthChanged=!0));if(null!=virtualclass.gObj.currWb){var c=this.pdfScale;null!=virtualclass.zoom.canvasScale&&""!=virtualclass.zoom.canvasScale&&0<virtualclass.zoom.canvasScale&&(c=virtualclass.zoom.canvasScale);let d;d="Whiteboard"===virtualclass.currApp&&null!=this.wbId&&virtualclass.gObj.currWb!==this.wbId?-1<this.wbId.indexOf("_doc_")?this.wbId:`_doc_${this.wbId}_${this.wbId}`:b.wbId;const k=virtualclass.wb[d].canvas.lowerCanvasEl;var f=this.getAppearanceCanvasWidth(d,
k);this.firstTime?(this.firstTime=!1,c=null==virtualclass.zoom.canvasScale||virtualclass.gObj.fitToScreen?b.getViewport(f/b.getViewport(1).width):b.getViewport(c)):c=virtualclass.zoom.performFitToPage?this.calculateViewPort(k,b):b.getViewport(f/b.getViewport(1).width);virtualclass.zoom.prvCanvasScale=virtualclass.zoom.canvasScale;virtualclass.zoom.canvasScale=c.scale;virtualclass.zoom.prvPdfDimension=b.view;f=document.getElementById(`${k.id}_pdf`);f.width=c.width;f.height=c.height;virtualclass.zoom.canvasDimension=
{};virtualclass.zoom.canvasDimension.width=c.width;virtualclass.zoom.canvasDimension.height=c.height;virtualclass.wbWrapper.util.createFabricNewInstance(d,{width:c.width,height:c.height});if(Object.prototype.hasOwnProperty.call(virtualclass.gObj,"fitToScreen")){const a=document.querySelector(`#canvasWrapper${virtualclass.gObj.currWb}`);if(null!==a&&(a.scrollHeight<=a.clientHeight||a.scrollWidth<=a.clientWidth))virtualclass.pdfRender[virtualclass.gObj.currWb].onScroll(a,!0)}virtualclass.wb[d].canvas.setZoom(virtualclass.zoom.canvasScale);
delete virtualclass.gObj.fitToScreen;c={canvasContext:f.getContext("2d"),viewport:c};await b.render(c);k.parentNode.dataset.pdfrender=!0;this[d]={pdfrender:!0};virtualclass.vutil.showZoom();null!=a&&null!=virtualclass.gObj.currWb&&(await this.initWhiteboardData(b.wbId),roles.hasControls()&&virtualclass.wbWrapper.util.handleActivateTool(b.wbId));"object"===typeof this.shownPdf&&(io.globallock=!1,virtualclass.vutil.removeClass("virtualclassCont","resizeWindow"));this.firstTimeScroll&&roles.isStudent()&&
"object"===typeof virtualclass.pdfRender[virtualclass.gObj.currWb]&&(virtualclass.pdfRender[virtualclass.gObj.currWb].setScrollPosition({scX:0,scY:0}),this.firstTimeScroll=!1)}},async displayPage(b,a,c){a=await b.getPage(a);a.wbId=b.wbId;virtualclass.pdfRender[b.wbId].page=a;"undefined"!==typeof c?await this.renderPage(a,c):await this.renderPage(a,null)},async initWhiteboardData(b){"object"===typeof virtualclass.gObj.wbData[b]&&virtualclass.gObj.wbData[b]&&0<virtualclass.gObj.wbData[b].length&&await virtualclass.wbWrapper.replay.replayFromLocalStroage(virtualclass.gObj.wbData[b],
b)},async _zoom(b,a,c){virtualclass.vutil.setHeight(virtualclass.gObj.currWb,b,c);virtualclass.vutil.setWidth(virtualclass.gObj.currWb,b,a);b=b.parentNode;c=virtualclass.vutil.getValueWithoutPixel(b.style.width);await virtualclass.pdfRender[virtualclass.gObj.currWb].displayPage(this.shownPdf,1);for(const a in virtualclass.pdfRender)this.zoomwhiteboardObjects(a);a>c&&b.classList.add("scrollX")},async innerFitToPage(b){if(" "!==this.shownPdf&&""!==this.shownPdf){await virtualclass.pdfRender[b].displayPage(this.shownPdf,
1);for(const a in virtualclass.pdfRender)this.fitToScreenWhiteboardObjects(a)}},zoomwhiteboardObjects(b){WhiteboardUtility.fitWhiteboardAtScale(b)},zoomOutWhiteboardObjects(b){WhiteboardUtility.fitWhiteboardAtScale(b)},fitToScreenWhiteboardObjects(b){WhiteboardUtility.fitWhiteboardAtScale(b)},async _zoomOut(b,a,c){virtualclass.vutil.setHeight(virtualclass.gObj.currWb,b,c);virtualclass.vutil.setWidth(virtualclass.gObj.currWb,b,a);await virtualclass.pdfRender[virtualclass.gObj.currWb].displayPage(this.shownPdf,
1);for(const a in virtualclass.pdfRender)this.zoomOutWhiteboardObjects(a)},async _fitToScreen(b,a){virtualclass.vutil.setHeight(virtualclass.gObj.currWb,b,b.height);virtualclass.vutil.setWidth(virtualclass.gObj.currWb,b,a);b=b.parentNode;const c=b.offsetWidth;if(" "!==this.shownPdf){await virtualclass.pdfRender[virtualclass.gObj.currWb].displayPage(this.shownPdf,1);for(const a in virtualclass.pdfRender)this.fitToScreenWhiteboardObjects(a);a>c&&55<a-c?b.classList.add("scrollX"):b.classList.remove("scrollX")}roles.hasControls()&&
virtualclass.wbWrapper.util.handleActivateTool(this.shownPdf.wbId)},calculateScaleAtFirst(b,a){b=b.getViewport(a.width/b.getViewport(1).width);this.firstTime=!1;return b},isWhiteboardAlreadyExist(b){return null!=this.canvas},defaultScroll(){null!=virtualclass.gObj.currWb&&(this.canvasWrapper.scrollTop=1)}}}})(window);(function(c){c.wbCommon={order:[0],wbInd:0,initNavHandler(){document.querySelector("#virtualclassWhiteboard.whiteboard .next").addEventListener("click",virtualclass.vutil.navWhiteboard.bind(virtualclass.vutil,this,this.next));document.querySelector("#virtualclassWhiteboard.whiteboard .prev").addEventListener("click",virtualclass.vutil.navWhiteboard.bind(virtualclass.vutil,this,this.prev))},initNav(b){"undefined"===typeof this.indexNav&&(this.indexNav=new pageIndexNav("WB"));const a=virtualclass.gObj.currIndex||
b.length;this.indexNav.init();this.createWbNavigation||(this.indexNav.UI.createNewPageButton(),this.createWbNavigation=!0);roles.hasControls()?(virtualclass.wbCommon.indexNav.createWbNavigationNumber(a),virtualclass.wbCommon.indexNav.addActiveNavigation(virtualclass.gObj.currWb)):virtualclass.wbCommon.indexNav.studentWBPagination(virtualclass.gObj.currIndex||virtualclass.gObj.currSlide);virtualclass.wbCommon.indexNav.setTotalPages(b.length)},displaySlide(b){this.hideElement();const a=document.querySelector(`#note${b}`);
null!=a&&(a.classList.add("current"),virtualclass.gObj.currWb=b,console.log("====> whiteboard apply ",virtualclass.gObj.currWb));this.identifyFirstNote(b);this.identifyLastNote(b)},hideElement(){const b=document.querySelector("#virtualclassWhiteboard.whiteboard .current");null!=b&&(b.classList.remove("current"),console.log("suman hide element 1 ",virtualclass.gObj.currWb))},next(){this.hideElement();var b=virtualclass.orderList.Whiteboard.getNextByID(virtualclass.gObj.currWb);if(b){b=b.id;this.readyCurrentWhiteboard(b);
this.setCurrSlideNumber(b);virtualclass.wbCommon.indexNav.addActiveNavigation(b);virtualclass.wbCommon.indexNav.UI.pageNavHandler("right");const a=virtualclass.orderList.Whiteboard.ol.order.indexOf(b);this.identifyLastNote(b);virtualclass.gObj.currWb=b;console.log("====> whiteboard apply ",virtualclass.gObj.currWb);virtualclass.gObj.currIndex=a+1;virtualclass.wbCommon.indexNav.setCurrentIndex(virtualclass.gObj.currIndex);virtualclass.vutil.beforeSend({cf:"cwb",diswb:!0,wid:b,currIndex:virtualclass.gObj.currIndex});
this.identifyFirstNote(b)}else console.log("No element found")},prev(){this.hideElement();var b=virtualclass.orderList.Whiteboard.getPreviousByID(virtualclass.gObj.currWb);if(b){b=b.id;this.readyCurrentWhiteboard(b);this.setCurrSlideNumber(b);virtualclass.wbCommon.indexNav.addActiveNavigation(b);virtualclass.wbCommon.indexNav.UI.pageNavHandler("left");const a=virtualclass.orderList.Whiteboard.ol.order.indexOf(b);virtualclass.gObj.currIndex=a+1;virtualclass.wbCommon.indexNav.setCurrentIndex(virtualclass.gObj.currIndex);
virtualclass.vutil.beforeSend({cf:"cwb",diswb:!0,wid:b,currIndex:virtualclass.gObj.currIndex});this.identifyLastNote(b);"_doc_0_0"===b&&virtualclass.wb[b]&&virtualclass.wbWrapper.util.handleActivateTool(b)}else console.log("No element found")},newPage(){this.hideElement();virtualclass.gObj.wbCount++;let b=virtualclass.gObj.wbCount;const a=`${"_doc_0_"}${virtualclass.gObj.wbCount}`;var c=virtualclass.gObj.currWb;let f=null;0<virtualclass.orderList.Whiteboard.ol.order.length&&virtualclass.orderList.Whiteboard.getCurrentPosition(virtualclass.gObj.currWb)+
1!==virtualclass.orderList.Whiteboard.ol.order.length&&(f=!0);this.displaySlide(a);null===f?(c=virtualclass.orderList.Whiteboard.ol.order.length,c+=1,virtualclass.vutil.createWhiteBoard(a,b)):(c=virtualclass.orderList.Whiteboard.ol.order.indexOf(c),b=c+1,c=b+1,virtualclass.vutil.createWhiteBoard(a,b),this.rearrange(virtualclass.orderList.Whiteboard.ol.order),virtualclass.vutil.beforeSend({cf:"rearrangeWb",order:virtualclass.orderList.Whiteboard.ol.order}));virtualclass.gObj.currIndex=c;virtualclass.wbCommon.indexNav.createWbNavigationNumber(c);
virtualclass.vutil.beforeSend({cf:"cwb",wbCount:virtualclass.gObj.wbCount,currIndex:c});this.identifyLastNote(a)},rearrange(b){const a=document.getElementsByClassName("whiteboardContainer")[0],c=document.createElement("div");c.className="whiteboardContainer";for(let a=0;a<b.length;a++){const d=document.getElementById(`note${b[a]}`);d&&c.appendChild(d)}a.parentNode.replaceChild(c,a)},setCurrSlideNumber(b){b=b.split("_");0<b.length&&(virtualclass.gObj.currSlide=b[b.length-1],roles.hasControls()||"undefined"!==
typeof virtualclass.wbCommon.indexNav&&virtualclass.wbCommon.indexNav.studentWBPagination(virtualclass.gObj.currIndex||virtualclass.gObj.currSlide))},readyCurrentWhiteboard(b){null!=b?(this.whiteboardExist(b)||virtualclass.vutil.createWhiteBoard(b),this.displaySlide(b),virtualclass.gObj.currWb=b,console.log("====> whiteboard apply ",virtualclass.gObj.currWb)):alert("Elemennt is NULL")},whiteboardExist(b){return"object"===virtualclass.wb[b]&&null!=document.querySelector(`#canvas${b}`)},whiteboardWrapperExist(b){let a,
c=null;var f=virtualclass.gObj.currWb;if(null!==f)return f=document.querySelector(`#note${f}`),"prev"===b?a=f.previousElementSibling:"next"===b&&(a=f.nextElementSibling),null!==a&&(c=a.dataset.wbId),c},readyElements(b){const a=document.querySelector("#virtualclassWhiteboard .whiteboardContainer");for(let d=0;d<b.length;d++){const f=b[d];var c=document.querySelector(`#note${f}`);null==c&&(c=document.createElement("div"),c.id=`note${f}`,c.dataset.wbId=f,c.className="canvasContainer",a.appendChild(c))}},
reArrangeElements(b){const a=document.querySelector("#virtualclassWhiteboard .whiteboardContainer"),c=document.createElement("div");c.className="whiteboardContainer";for(let a=0;a<b.length;a++){var f=`note_${b[a]}`;f=document.getElementById(f);null!=c&&null!=f&&c.appendChild(f)}a.parentNode.replaceChild(c,a)},identifyFirstNote(b){const a=document.querySelector("#virtualclassWhiteboard");"_doc_0_0"===b?a.classList.add("firstNote"):a.classList.remove("firstNote")},identifyLastNote(b){const a=document.querySelector("#virtualclassWhiteboard");
virtualclass.orderList.Whiteboard.ol.order.indexOf(b)+1===virtualclass.orderList.Whiteboard.ol.order.length||"_doc_0_0"===b&&1===virtualclass.orderList.Whiteboard.ol.order.length?a.classList.add("lastNote"):a.classList.remove("lastNote")},removeAllContainers(){const b=document.querySelectorAll("#virtualclassWhiteboard .whiteboardContainer .canvasContainer");let a;for(let c=0;c<b.length;c++)a=b[c],a.parentNode.removeChild(a)},clearNavigation(){const b=document.getElementById("dcPaging");if(null!==
b){for(;b.firstChild;)b.removeChild(b.firstChild);if(null!=virtualclass.wbCommon.indexNav)if(roles.hasControls())virtualclass.wbCommon.indexNav.createWbNavigationNumber(0,0),document.querySelector("#virtualclassWhiteboard").classList.add("lastNote");else{const a=document.createElement("span");a.id="stdPageNo";b.appendChild(a);virtualclass.wbCommon.indexNav.studentWBPagination(0)}}},deleteWhiteboard(b){delete virtualclass.wb[b];console.log("JAI 2");delete virtualclass.pdfRender[b];"Whiteboard"===virtualclass.currApp&&
(b=document.querySelector(`#containerWb${b}`),null!==b&&b.parentNode.removeChild(b))}}})(window);const serverData={rawData:{video:[],ppt:[],docs:[]},syncComplete:!1,syncxhr:axios.create({timeout:1E4,headers:{"Content-Type":"application/json","x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room,post:{"Content-Type":"application/json"}}}),sdxhr:axios.create({timeout:1E4,headers:{"Content-Type":"application/json","x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room,
post:{"Content-Type":"application/json"}}}),onMessage(c){c.rawData&&(virtualclass.serverData.awsUrlArr(c.rawData),virtualclass.serverData.syncComplete=!0)},syncAllData(){return new Promise(c=>{function b(){!0===virtualclass.serverData.syncComplete?c(!0):virtualclass.serverData.syncxhr.post(virtualclass.api.GetDocumentURLs,{}).then(a=>{virtualclass.serverData.awsUrlArr(a.data);ioAdapter.mustSend({rawData:a.data,cf:"rawSyncData"});virtualclass.serverData.syncComplete=!0;c(!0)}).catch(a=>{console.error("Request failed with error ",
a);setTimeout(()=>b(),1E3)})}roles.hasControls()&&b()})},awsUrlArr(c){this.rawData={video:[],ppt:[],docs:[]};const b=[];c=c.Items;let a;for(let n=0;n<c.length;n+=1)if(Object.prototype.hasOwnProperty.call(c[n],"filetype"))switch(c[n].filetype.S){case "doc":a=this.processObj(c[n]);var d=c[n].processed_data.M.commonpath.S;var f=parseInt(c[n].processed_data.M.count.N,10);if(null!=d&&null!=f){d=`${"https://media.congrea.net"}/${c[n].processed_data.M.commonpath.S}`;let r;a.notes={};a.notesarr=[];let t=
[],z=[];Object.prototype.hasOwnProperty.call(a,"deletednes")&&(t=a.deletednes);Object.prototype.hasOwnProperty.call(a,"disablednes")&&(z=a.disablednes);for(let b=1;b<=f;b+=1){var g=b;var k=3-`${g}`.length;var m=(0<k?Array(++k).join("0"):"")+g;g=`${d}/image/${m}.${c[n].processed_data.M.image.M.type.S}`;k=`${d}/pdf/${m}.pdf`;m=`${d}/thumbnail/${m}.${c[n].processed_data.M.thumbnail.M.type.S}`;virtualclass.createPrefetchLink(k);r=99<b?`${a.fileuuid}_${b}`:9<b?`${a.fileuuid}_0${b}`:`${a.fileuuid}_00${b}`;
const f={};0<t.length&&-1<t.indexOf(b)&&(f.deletedn=r);f.id=r;f.pdf=k;f.image=g;f.thumbnail=m;0<z.length?-1<z.indexOf(b)?f.status=0:f.status=1:f.status=1;a.notes[r]=f;a.notesarr.push(f)}b.push(a);this.rawData.docs.push(a)}break;case "video":null!=c[n].processed_data&&"COMPLETED"===c[n].processed_data.S&&(a=this.processObj(c[n]),f=a.filepath.substr(0,a.filepath.lastIndexOf("/")),a.urls={},a.urls.thumbnail={},a.urls.videos={},a.urls.main_video=`${"https://media.congrea.net/"+f}/video/play_video.m3u8`,
a.urls.videos["0400k"]=`${"https://media.congrea.net/"+f}/video/0400k/video.m3u8`,a.urls.videos["0600k"]=`${"https://media.congrea.net/"+f}/video/0600k/video.m3u8`,a.urls.videos["1000k"]=`${"https://media.congrea.net/"+f}/video/1000k/video.m3u8`,a.urls.videos["1500k"]=`${"https://media.congrea.net/"+f}/video/1500k/video.m3u8`,a.urls.videos["2000k"]=`${"https://media.congrea.net/"+f}/video/2000k/video.m3u8`,a.urls.thumbnail["0400k"]=`${"https://media.congrea.net/"+f}/video/0400k/thumbs/00001.png`,
a.urls.thumbnail["0600k"]=`${"https://media.congrea.net/"+f}/video/0600k/thumbs/00001.png`,a.urls.thumbnail["1000k"]=`${"https://media.congrea.net/"+f}/video/1000k/thumbs/00001.png`,a.urls.thumbnail["1500k"]=`${"https://media.congrea.net/"+f}/video/1500k/thumbs/00001.png`,a.urls.thumbnail["2000k"]=`${"https://media.congrea.net/"+f}/video/2000k/thumbs/00001.png`,b.push(a),this.rawData.video.push(a));break;case "video_yts":case "video_online":a=this.processVidUrlObj(c[n]);a.urls={};a.urls.main_video=
a.URL;b.push(a);this.rawData.video.push(a);break;case "presentation":a=this.processVidUrlObj(c[n]),a.urls={},a.urls.presentation=a.URL,b.push(a),this.rawData.ppt.push(a)}},processObj(c){const b={};b.filename=c.filename.S;b.filepath=c.filepath.S;b.filetype=c.filetype.S;b.fileuuid=c.fileuuid.S;b.key_room=c.key_room.S;Object.prototype.hasOwnProperty.call(c,"deleted")&&("0"===c.deleted.NS[0]?b.deleted=c.deleted.NS[0]:b.deletednes=c.deleted.NS);Object.prototype.hasOwnProperty.call(c,"disabled")&&("0"===
c.disabled.NS[0]?b.disabled=c.disabled.NS[0]:b.disablednes=c.disabled.NS);return b},processVidUrlObj(c){const b={};b.URL=c.URL.S;b.filename=b.URL;b.filetype=c.filetype.S;b.fileuuid=c.fileuuid.S;b.key_room=c.key_room.S;Object.prototype.hasOwnProperty.call(c,"deleted")&&(b.deleted=c.deleted.NS[0]);Object.prototype.hasOwnProperty.call(c,"disabled")&&(b.disabled=c.disabled.NS[0]);return b},pollingStatus(){return new Promise(c=>{function b(){Object.prototype.hasOwnProperty.call(virtualclass.gObj,"pollingDocumentStatus")&&
clearTimeout(virtualclass.gObj.pollingDocumentStatus);virtualclass.gObj.pollingDocumentStatus=setTimeout(()=>{virtualclass.xhrn.vxhrn.post(virtualclass.api.GetDocumentStatus,{uuid:virtualclass.gObj.file.uuid}).then(a=>{a=a.data.Item;null!=a&&(Object.prototype.hasOwnProperty.call(a,"processed_data")&&(Object.prototype.hasOwnProperty.call(a.processed_data,"S")&&"COMPLETED"===a.processed_data.S||Object.prototype.hasOwnProperty.call(a.processed_data,"M")&&Object.prototype.hasOwnProperty.call(a.processed_data.M,
"pdf"))?(clearTimeout(virtualclass.gObj.pollingDocumentStatus),virtualclass.serverData.syncComplete=!1,virtualclass.serverData.syncAllData().then(()=>{c()})):b())})},5E3)}b()})}};const api={access:"https://api.congrea.net/data/access",askQnsAccess:"https://api.congrea.net/data/askqns-access",upload:"https://api.congrea.net/t/upload",uploadSuccess:"https://api.congrea.net/t/uploadSuccess",uploadMedia:"https://uploadmedia.congrea.net",UpdateDocumentStatus:"https://api.congrea.net/t/UpdateDocumentStatus",GetDocumentURLs:"https://api.congrea.net/t/GetDocumentURLs",UpdateRoomMetaData:"https://api.congrea.net/t/UpdateRoomMetaData",GetRoomMetaData:"https://api.congrea.net/t/GetRoomMetaData",
addURL:"https://api.congrea.net/t/addURL",GetDocumentStatus:"https://api.congrea.net/t/GetDocumentStatus",recordingFiles:"https://api.congrea.net/data/recording-files"};(function(c,b){c.raiseHand=function(a){return{stdRhEnable:"enabled",rhCount:0,rhCountR:0,init(a){this.stdRhEnable="enabled";roles.hasControls()||(this.attachHandlerAtStudent(),this.stdRhEnable&&"disabled"===this.stdRhEnable&&(b.querySelector("#virtualclassCont.congrea #icHr").setAttribute("data-action","disable"),a=b.querySelector("#virtualclassCont.congrea #congHr"),a.classList.remove("enable"),a.classList.add("disable"),a.setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdDisabled"))))},
raisehand(a){var c=chatContainerEvent.elementFromShadowDom(`#ml${a} .controllerRaiseH`);const d=c.querySelector("a.congtooltip"),k=d.querySelector(".RaiseHandImg");ioAdapter.mustSendUser({data:{action:"disable"},cf:"raiseHand"},a);c.classList.remove("enabled");c.classList.add("disabled");k.setAttribute("data-raisehand-disable",!0);d.setAttribute("data-title","disabled");c.style.pointerEvents="none";virtualclass.user.control.updateUser(a,"raiseHand",!1);virtualclass.raiseHand.moveDownInList(a);this.rhCount--;
this.rhCount||b.querySelector("#user_list .hand_bt").classList.remove("highlight");a=b.querySelector("#user_list .hand_bt  #notifyText");0<this.rhCount?a.innerHTML=this.rhCount:(c=b.querySelector("#user_list .hand_bt"),a.innerHTML="",c.classList.remove("congtooltip"),c.removeAttribute("data-title"),b.querySelector("#user_list .hand_bt").classList.remove("highlight"))},onMsgRec(a){a=a.message;roles.hasControls()?this.msgRecAtTeacher(a.data):this.msgRecAtStudent(a.data)},msgRecAtTeacher(a){var c=a.user;
const d=chatContainerEvent.elementFromShadowDom(`#ml${c} .controllerRaiseH`),k=d.querySelector("a.congtooltip"),m=k.querySelector(".RaiseHandImg");"enable"===a.action?(this.enableRaiseHand(c),this.moveUpInList()):"disable"===a.action&&(virtualclass.user.control.updateUser(c,"raiseHand",!1),d.classList.remove("enabled"),d.classList.add("disabled"),m.setAttribute("data-raisehand-disable",!0),k.setAttribute("data-title","disabled"),d.style.pointerEvents="none",this.moveDownInList(c),this.rhCount--,this.rhCount||
b.querySelector("#user_list .hand_bt").classList.remove("highlight"));a=b.querySelector("#user_list .hand_bt  #notifyText");0<this.rhCount?a.innerHTML=this.rhCount:(c=b.querySelector("#user_list .hand_bt"),a.innerHTML="",c.classList.remove("congtooltip"),c.removeAttribute("data-title"))},msgRecAtStudent(a){"disable"===a.action&&(this.stdRhEnable="enabled",a=b.getElementById("congHr"),a.classList.remove("disable"),a.classList.add("enable"),b.querySelector("#virtualclassCont.congrea #icHr").setAttribute("data-action",
"enable"),b.querySelector("#virtualclassCont.congrea #congHr").setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdEnabled")))},moveUpInList(){const a=chatContainerEvent.elementFromShadowDom(".controllerRaiseH","all");for(let b=0;b<a.length;b++)a[b].classList.contains("enabled")&&0!==b&&a[b].closest(".ui-memblist-usr").parentNode.insertBefore(a[b].closest(".ui-memblist-usr"),a[0].closest(".ui-memblist-usr"))},moveDownInList(a){const b=chatContainerEvent.elementFromShadowDom(".controllerRaiseH.enabled",
"all");a=virtualclass.gObj.testChatDiv.shadowRoot.getElementById(`${a}contRaiseH`);0<b.length&&a.closest(".ui-memblist-usr").parentNode.insertBefore(a.closest(".ui-memblist-usr"),b[b.length-1].closest(".ui-memblist-usr").nextSibling)},enableRaiseHand(a){this.rhCount++;this._enableRaiseHand(this.rhCount,a)},_enableRaiseHand(a,c){const d=chatContainerEvent.elementFromShadowDom(`#ml${c} .controllerRaiseH`),f=d.querySelector("a.congtooltip"),m=f.querySelector(".RaiseHandImg");virtualclass.user.control.updateUser(c,
"raiseHand",!0);d.classList.remove("disabled");d.classList.add("enabled");m.setAttribute("data-raisehand-disable",!1);f.setAttribute("data-title",virtualclass.lang.getString("RaiseHandEnable"));d.style.pointerEvents="visible";c=b.querySelector("#user_list .hand_bt");c.classList.contains("highlight")||c.classList.add("highlight");b.querySelector("#user_list .hand_bt  #notifyText").innerHTML=a;a=b.querySelector("#user_list .hand_bt");a.classList.contains("congtooltip")||a.classList.add("congtooltip");
a.setAttribute("data-title",virtualclass.lang.getString("raiseHandNotify"))},_raiseHand(a){this.rhCountR++;this.rhCount=this.rhCountR;this._enableRaiseHand(this.rhCountR,a)},updateInStorage(){},attachHandlerAtStudent(){virtualclass.settings.raisehand(!1)}}}()})(window,document);(function(c){c.colorSelector={makeThemeReady(){const b=virtualclassSetting.theme.selectedColor,a=virtualclass.vutil.calcBrightness(b);let c;c=125<a?"black":"white";const f={},g={},k={};k.fcolor=chroma(b).brighten().hex();k.scolor=chroma(b).brighten(1.8).hex();50>a?10>=a?(g.fcolor=chroma(b).brighten(2).hex(),g.scolor=chroma(b).brighten(3).hex()):(g.fcolor=chroma(b).darken().hex(),g.scolor=chroma(b).darken(2).hex()):180<a?(g.fcolor=chroma(b).darken(1.5).hex(),g.scolor=chroma(b).darken(1.1).hex(),k.fcolor=
chroma(b).darken(.5).hex(),k.scolor=chroma(b).darken(.8).hex()):(g.fcolor=chroma(b).darken(.8).hex(),g.scolor=chroma(b).darken(.6).hex(),k.fcolor=chroma(b).brighten().hex(),k.scolor=chroma(b).brighten(1.8).hex());f.fcolor=b;f.scolor=chroma(b).brighten().hex();g.frontColor=c;k.frontColor=c;this.makeThemeReadyMainCont(c,f,g,k);this.makeThemeReadyEditor(c,f,g,k);this.makeThemeReadyRightPanel(c,f,g,k);this.makeThemeReadyVideo(c,f,g,k,a);this.makeThemeReadyPoll(c,f,g,k,a);this.makeThemeReadyPresentation(c,
f,g,k,a);this.makeThemeReadyDocument(c,f,g,k);this.lightColorCustomize(c,f,g,k,a)},lightColorCustomize(b,a,c,f,g){218<=g&&(a.fcolor=chroma(a.fcolor).darken(.4).hex(),a.scolor=chroma(a.fcolor).darken().hex());b=`1px solid ${a.fcolor}`;this.addCss(`${"#virtualclassCont.congrea #virtualclassOptionsCont .appOptions {border-top:"}${b}}`+"#virtualclassCont.congrea #fullScreenButton ,#virtualclassCont.congrea .vmchat_bar_button ,#virtualclassCont.congrea .vmchat_room_bt.congtooltip ,#virtualclassCont.congrea #congAskQuestion ,#virtualclassCont.congrea .shapesToolbox ,#virtualclassCont.congrea li#appSettingCtrl ,#virtualclassCont.congrea #fullScreenExitButton, #virtualclassCont.congrea #virtualclassAppRightPanel #rightBarHeader, #virtualclassCont.congrea #virtualclassAppRightPanel #askQuestionHeader .header .action, #virtualclassCont #virtualclassAppFooterPanel #precheckBtn, #virtualclassCont.congrea li#virtualclassnote, #virtualclassCont.congrea #virtualclassAppRightPanel #appSettingCtrl, #virtualclassCont.congrea #bookmark "+
`{border-left: 1px solid ${a.fcolor}}`+"#virtualclassCont.congrea #virtualclassAppFooterPanel #chatWidget .chatBarTab "+`{border-left:${b}}`+"#virtualclassCont.congrea .containerWb .commandToolsWrapper .tool a ,#virtualclassCont.congrea .shapesToolbox ,#virtualclassCont.congrea #virtualclassAppFooterPanel #chatWidget .chatBarTab li ,#virtualclassCont.congrea #fullScreenButton ,#virtualclassCont.congrea #fullScreenExitButton, #virtualclassCont.congrea.playMode #fullScreenButton ,#virtualclassCont #virtualclassAppFooterPanel #precheckBtn, #virtualclassCont #virtualclassAppFooterPanel #recording, #virtualclassCont.congrea #virtualclassAppRightPanel #askQuestionHeader .header .action, #virtualclassCont.congrea.playMode #fullScreenExitButton "+
`{border-right: 1px solid ${a.fcolor}}`+"#virtualclassCont.congrea .ui-widget-header.ui-corner-top.ui-chatbox-titlebar.ui-dialog-header"+`{border: 1px solid ${a.fcolor}}`+"#virtualclassCont.congrea .btn.btn-default ,#virtualclassCont.congrea .vceditor-toolbar, #virtualclassCont.congrea #virtualclassAppFooterPanel #chatWidget .chatBarTab,#virtualclassCont.congrea #stickybar .footerCtr .vmchat_search #congreaUserSearch ,#virtualclassCont.congrea button ,#virtualclassCont.congrea #virtualclassAppRightPanel #rightBarHeader ,#virtualclassCont.congrea .zoomControler ,#virtualclassCont.congrea .btn-default, #virtualclassCont.congrea #popupContainer #about-modal #infoMessage #infoMessageOk "+
`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%)}`)},calcBrightness(b){b=chroma(b).rgb();return Math.round((299*parseInt(b[0])+587*parseInt(b[1])+114*parseInt(b[2]))/1E3)},makeThemeReadyMainCont(b,a,c,f){this.addCss(`${"#virtualclassCont.congrea .ui-widget-header, #virtualclassCont.congrea .commandToolsWrapper, #virtualclassCont.congrea .shapesToolbox .shapesTool, #virtualclassCont.congrea #virtualclassAppFooterPanel {background-image: linear-gradient(to bottom, "}${a.fcolor} 0%,${a.scolor} 100%)} `+
"#virtualclassCont.congrea #virtualclassAppLeftPanel #dashboardnav .btn "+`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%)} `+"#virtualclassCont.congrea #virtualclassAppLeftPanel #dashboardnav .btn.clicked"+`{background-image: linear-gradient(to bottom, ${c.fcolor} 0%,${c.scolor} 100%)} `+"#virtualclassCont.congrea #sessionEndMsgCont .endHeader,#virtualclassCont.congrea #playButton,#virtualclassCont.congrea #recordPlay .rv-vanilla-modal-body #downloadPcCont #downloadSessionText"+
`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%)} `+"#virtualclassCont.congrea #virtualclassOptionsCont:first-child, #virtualclassCont.congrea #startLiveStream "+`{background-image: linear-gradient(to right, ${a.fcolor} 0%,${a.scolor} 100%)} `+"#virtualclassCont.congrea #virtualclassOptionsCont .appOptions.active "+`{background-image: radial-gradient(ellipse at center, ${c.fcolor} 0%,${c.scolor} 100%)} `+"#virtualclassCont.congrea .tool.active a span:before "+`{color:${b}}`+
'#virtualclassCont.congrea #virtualclassOptionsCont .appOptions:hover, #virtualclassCont.congrea .containerWb .commandToolsWrapper .tool a:hover, #virtualclassCont.congrea .containerWb .commandToolsWrapper .tool ul.fontSizeList span:hover, #virtualclassCont.congrea.orginalTeacher #virtualclassAppContainer .virtualclass .commandToolsWrapper .tool[data-tool="stroke"] ul.strkSizeList li:hover, #virtualclassCont.congrea #dashboardContainer .modal-header button.enable:hover, #virtualclassCont.congrea #confirmCancel #confirmCancelButton:hover, #virtualclassCont.congrea #confirm.popupWindow #confirmOk #confirmOkButton:hover, #virtualclassCont.congrea #popupContainer #about-modal #infoMessage #infoMessageOk:hover, #virtualclassCont.congrea a.vceditor-btn:hover, #virtualclassCont.congrea .vceditor-dropdown-menu a:hover, #virtualclassCont.congrea #virtualclassEditorRich .vceditor-toolbar-wrapper .vceditor-btn-style-group:hover, #virtualclassCont.congrea #virtualclassEditorRich .vceditor-toolbar-wrapper .vceditor-btn-list-group:hover, #virtualclassCont.congrea #virtualclassEditorRich .vceditor-toolbar-wrapper .vceditor-btn-indent-group:hover, #virtualclassCont.congrea #virtualclassEditorRich .vceditor-toolbar-wrapper .vceditor-btn-paragraph-group:hover '+
`{background-image: radial-gradient(ellipse at center, ${f.fcolor} 0%,${f.scolor} 100%)}`+"#virtualclassCont.congrea #confirm.popupWindow #confirmOk #confirmOkButton,#virtualclassCont.congrea #confirm.popupWindow #confirmCancel #confirmCancelButton"+`{color:${b}}`+"#virtualclassCont.congrea .appOptions:hover .cgIcon:before"+`{color:${f.frontColor}}`+"#virtualclassCont.congrea .active .cgIcon:before"+`{color:${c.frontColor}}`+"#virtualclassCont.congrea .cgIcon:before"+`{color:${b}}`+"#virtualclassCont.congrea #docShareNav .pageNav"+
`{color:${b}}`+"#virtualclassCont.congrea .containerWb .commandToolsWrapper .tool a,#virtualclassCont.congrea .containerWb .commandToolsWrapper .tool.active a:hover,"+`{color:${b}}`+"#virtualclassCont.congrea .shapesToolbox a"+`{color:${b}}`+"#virtualclassCont.congrea .cgText"+`{color:${b}}`+"#virtualclassCont.congrea .vchead"+`{color:${b}}`+"#virtualclassCont.congrea .icon-publish2:before"+`{color:${c.fcolor}}`+"#virtualclassCont.congrea button ,#virtualclassCont.congrea .btn-default "+`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%)} `+
"#virtualclassCont.congrea #congdashboard .modal-header .close{opacity :1;}#virtualclassCont.congrea .modal-header .btn-default ,#virtualclassCont.congrea .modal .btn-default ,#virtualclassCont.congrea .precheck .btn-default "+`{color :${b}} `+"#virtualclassCont.congrea .vjs-control-bar .vjs-autoPlay-button {background:none}#virtualclassCont.congrea .vjs-control-bar .vjs-button {background:none ; border:none  ;color:white}#virtualclassCont.congrea  #onlineusertext:before"+`{color :${b}} `+"#virtualclassCont.congrea  #recordPlay #playButton:before"+
`{color :${b}} `+"#virtualclassCont.congrea #recordingHeaderContainer  "+`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%);color:${b}} `+"#virtualclassCont.congrea  #virtualclassApp .playControllerMainCont "+`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%) ;color:${b}} `+"#virtualclassCont.congrea  .dbContainer .qq-cancel-button-selector"+`{color :${b}} `+" #virtualclassCont.congrea #virtualclassOptionsCont .appOptions "+`{border : 1px solid${a.fcolor}} `+
`{background-image: linear-gradient(to bottom, ${c.fcolor} 0%,${c.scolor} 100%) ;color:${b}} `+`{border-left: 1px solid ${a.fcolor}}`+"#virtualclassCont.congrea  #playController button"+`{background-image:none !important;color:${b}!important; border-right: 1px solid ${a.fcolor}!important}`+"#virtualclassCont.congrea #virtualclassAppLeftPanel .containerWb .commandToolsWrapper .shapesToolbox.active a.shape_anchor, #virtualclassCont.congrea #virtualclassAppLeftPanel .containerWb .commandToolsWrapper .notshape.active a, #virtualclassCont.congrea #virtualclassAppLeftPanel .containerWb .commandToolsWrapper .shapesTool .tool.active a "+
`{background-image: radial-gradient(ellipse at center, ${c.fcolor} 0%,${c.scolor} 100%);} `)},makeThemeReadyEditor(b,a,c,f){this.addCss(`${"#virtualclassCont.congrea a.vceditor-btn#virtualclassCont.congrea .containerWb .commandToolsWrapper .tool ul.fontSizeList span.selected,{background-color: "}${c.fcolor}} `+"#virtualclassCont.congrea a.vceditor-btn"+`{color: ${c.frontColor}} `+"#virtualclassCont.congrea #alleditorRichContainer"+`{background-color: ${c.frontColor}} `+"#virtualclassCont.congrea .commandToolsWrapper .tool.active a"+
`{background-image: radial-gradient(ellipse at center, ${c.fcolor} 0%,${c.scolor} 100% )} `+"#virtualclassCont .vceditor-dropdown-menu a:hover"+`{background-color:${a.fcolor}}`)},makeThemeReadyRightPanel(b,a,c,f){this.addCss(`${"#virtualclassCont.congrea #recordPlay .rv-vanilla-modal-body #downloadPcCont #downloadSessionText,#virtualclassCont.congrea #virtualclassAppRightPanel #audioWidget{background-image: linear-gradient(to bottom, "}${a.fcolor} 0%,${a.scolor} 100%)}`+"#virtualclassCont.congrea #stickycontainer .inner_bt:hover, #virtualclassCont.congrea a.stdAskQuestion:hover, #virtualclassCont.congrea li#appSettingCtrl a#appSettingCtrlAnchor:hover ,#virtualclassCont.congrea #stickycontainer .stdAskQuestion #iconAskQuestion:hover, #virtualclassCont.congrea #stickycontainer #contrAudioAll:hover, #virtualclassCont.congrea #virtualclassAppRightPanel #mainAudioPanel li:hover, #virtualclassCont.congrea #virtualclassAppRightPanel #mainAudioPanel li a:hover,#virtualclassCont.congrea #audioTest-box:hover,#virtualclassCont.congrea #playButton:hover, #virtualclassCont.congrea #alwaysPress:hover,#virtualclassCont.congrea .recButton:hover,#virtualclassCont.congrea li#virtualclassnote a:hover , #virtualclassCont.congrea #virtualclassAppRightPanel #appSettingCtrl:hover, #virtualclassCont #virtualclassAppFooterPanel #precheckBtn:hover, #virtualclassCont #virtualclassAppFooterPanel #recording.show:hover, #virtualclassCont.congrea #virtualclassAppFooterPanel #bookmark:hover, #virtualclassCont.congrea #virtualclassAppFooterPanel #fullScreenExitButton:hover, #virtualclassCont.congrea #networkStatusContainer:hover, #virtualclassCont.congrea #virtualclassAppFooterPanel #fullScreenButton:hover, #virtualclassCont.congrea #startLiveStream:hover, #virtualclassCont.congrea #virtualclassAppRightPanel #askQuestionHeader .header .action .addQuestion-icon:hover "+
`{background-image: radial-gradient(ellipse at center, ${f.fcolor} 0%,${f.scolor} 100%)}`+"#virtualclassCont.congrea .vmchat_support.active ,#virtualclassCont.congrea .vmchat_room_bt.active,#virtualclassCont.congrea .vmchat_bar_button.active, #virtualclassCont.congrea #congAskQuestion.askQuestionEnable.active, #virtualclassCont.congrea #virtualclassnote.notesEnable.active, #virtualclassCont.congrea li#appSettingCtrl.active, #virtualclassCont.congrea #virtualclassAppRightPanel #audioWidget .settingActive,#virtualclassCont.congrea #virtualclassAppRightPanel #stickycontainer .askQuestion_btn.disable"+
`{background-image: radial-gradient(ellipse at center, ${c.fcolor} 0%,${c.scolor} 100%)}`+"#virtualclassCont.congrea #virtualclassAppRightPanel li:hover .cgIcon:before"+`{color:${f.frontColor}}`+"#virtualclassCont.congrea #virtualclassAppRightPanel #appSettingCtrlAnchor span"+`{color:${b}}`+"#virtualclassCont.congrea #virtualclassAppRightPanel li:hover .cgText"+`{color:${f.frontColor}}`+"#virtualclassCont.congrea #virtualclassAppRightPanel .askQuestion_btn.enable #iconAskQuestion:before"+`{color:${b}}`+
"#virtualclassCont.congrea #virtualclassAppRightPanel .pre-check-btn"+`{background-image: linear-gradient(to bottom, ${a.fcolor} 0%,${a.scolor} 100%) ;color:${b}} `)},makeThemeReadyVideo(b,a,c,f,g){let d=a.fcolor;180<g&&(d=c.fcolor);this.addCss(`${"#virtualclassCont.congrea .ui-widget-header,#virtualclassCont.congrea #congdashboard .modal-header,#virtualclassCont #virtualclassApp #virtualclassAppLeftPanel #sidebarButton, #virtualclassCont.congrea #layoutPoll #navigator, #virtualclassCont.congrea #layoutQuiz .navbar, #virtualclassCont.congrea #virtualclassAppFooterPanel #audioWidget {background-image: linear-gradient(to bottom, "}${a.fcolor} 0%,${a.scolor} 100%)}`+
"#virtualclassCont.congrea #listvideo .linkvideo .videoTitleCont:before, #virtualclassCont.congrea #listvideo .linkvideo .controls .editanch:before, "+`#virtualclassCont.congrea #listvideo .linkvideo .controls:before{color:${d}}`+`#virtualclassCont.congrea #listvideo .linkvideo .controls:hover:before{color:${f.fcolor}}`+`#virtualclassCont.congrea #VideoDashboard button{color:${b}}`+`#virtualclassCont.congrea #VideoDashboard button{border:1px solid${b}}`+`{background-color: ${c.frontColor}} `+`#virtualclassCont.congrea #listvideo .linkvideo.playing{border:solid ${a.fcolor} 1px}`)},
makeThemeReadyPoll(b,a,c,f,g){a=a.fcolor;180<g&&(a=c.fcolor);this.addCss(`${"#virtualclassCont.congrea #virtualclassPoll .btn.btn-default, #virtualclassCont.congrea #virtualclassPoll #stdPollContainer #btnVote{color:"}${b};}`+`#virtualclassCont.congrea .bootstrap .pollNavBar > li > a {color:${b} ; }`+"#virtualclassCont.congrea .bootstrap .navListTab:hover"+`{color:${f.frontColor}}`+"#virtualclassCont.congrea #virtualclassPoll #chartMenuCont a, #virtualclassCont.congrea #virtualclassPoll .controlIcon:before"+
`{color:${a}}`+`#virtualclassCont.congrea #virtualclassPoll .controlIcon:hover:before{color:${f.fcolor}}`+"#virtualclassCont.congrea #virtualclassPoll .modal button.close ,#virtualclassCont.congrea  .alert .close {background-image: none ;background-color:none}")},makeThemeReadyPresentation(b,a,c,f,g){a=a.fcolor;180<g&&(a=c.fcolor,f.fcolor=chroma(c.fcolor).darken());this.addCss(`${"#virtualclassCont.congrea #SharePresentationDashboard .btn-default{color:"}${b}}`+"#virtualclassCont.congrea #virtualclassPoll #chartMenuCont a, "+
`#virtualclassCont.congrea #SharePresentationDashboard .controls:before{color:${a}}`+`#virtualclassCont.congrea #SharePresentationDashboard .controls:hover:before{color:${f.fcolor}}`)},makeThemeReadyDocument(b,a,c,f){this.addCss(`${"#virtualclassCont.congrea #DocumentShareDashboard #newDocBtn {color:"}${b}; border: 1px solid ${a.fcolor}}`)},addCss(b){const a=document.getElementsByTagName("head")[0],c=document.createElement("style");c.setAttribute("type","text/css");c.styleSheet?c.styleSheet.cssText=
b:c.appendChild(document.createTextNode(b));a.appendChild(c)}}})(window);(function(c,b){c.appSetting=function(){return{init(){const a=b.getElementById("appSettingCtrl");a&&a.addEventListener("click",()=>{const a=b.getElementById("appSettingDetail");a.classList.contains("active")?a.classList.remove("active"):a.classList.add("active")})}}}()})(window,document);function Network(){this.sumLatency=this.latency=0;this.minLatency=999999;this.countLatency=0;this.avgLatency=1;this.MYSPEED_COUNTER_HIGH=this.MYSPEED_COUNTER_OK=0}Network.prototype.pingToServer=function(){if(io.webSocketConnected()){const c=Date.now();ioAdapter.sendPing(c)}};
Network.prototype.initToPing=function(c){Object.prototype.hasOwnProperty.call(this,"initToPingTime")&&clearTimeout(this.initToPingTime);Object.prototype.hasOwnProperty.call(this,"sleepTime")&&clearTimeout(this.sleepTime);this.initToPingTime=setTimeout(()=>{this.pingToServer();const b=this;this.sleepTime=setTimeout(()=>{this.latency=3E3;b.initToPing(5E3)},3E3)},c);this.variations()};
Network.prototype.variations=function(){this.latency&&3E3>this.latency&&0<this.latency&&(this.sumLatency+=this.latency,this.countLatency++,this.avgLatency=Math.round(this.sumLatency/this.countLatency),this.latency<this.minLatency&&10<this.latency&&(this.minLatency=this.latency));this.avgLatency>2*this.minLatency&&this.resetVariations();this.adaptiveMedia()};
Network.prototype.adaptiveMedia=function(){3>virtualclass.videoHost.gObj.MYSPEED&&(3E3<=this.latency||999999>this.minLatency&&this.latency>3*this.minLatency)?(this.MYSPEED_COUNTER_OK=0,this.MYSPEED_COUNTER_HIGH+=1,this.updateNetworkInfo("medium"),1===virtualclass.videoHost.gObj.MYSPEED&&2<=this.MYSPEED_COUNTER_HIGH?(this.MYSPEED_COUNTER_HIGH=0,this.updateNetworkInfo("medium"),this.setSpeed(2)):2===virtualclass.videoHost.gObj.MYSPEED&&4<=this.MYSPEED_COUNTER_HIGH&&(this.MYSPEED_COUNTER_HIGH=0,this.updateNetworkInfo("slow"),
this.setSpeed(3))):1<virtualclass.videoHost.gObj.MYSPEED&&999999>this.minLatency&&this.latency<2*this.minLatency?(this.MYSPEED_COUNTER_OK+=1,this.MYSPEED_COUNTER_HIGH=0,this.updateNetworkInfo("medium"),2<virtualclass.videoHost.gObj.MYSPEED&&4<=this.MYSPEED_COUNTER_OK?(this.MYSPEED_COUNTER_OK=0,this.updateNetworkInfo("medium"),this.setSpeed(2)):1<virtualclass.videoHost.gObj.MYSPEED&&10<=this.MYSPEED_COUNTER_OK&&(this.MYSPEED_COUNTER_OK=0,this.updateNetworkInfo("fast"),this.setSpeed(1))):(1E3<this.latency?
this.updateNetworkInfo("medium"):this.updateNetworkInfo("fast"),this.MYSPEED_COUNTER_HIGH=this.MYSPEED_COUNTER_OK=0)};
Network.prototype.updateNetworkInfo=function(c){var b;1===virtualclass.videoHost.gObj.MYSPEED?b="high":2===virtualclass.videoHost.gObj.MYSPEED?b="medium":3===virtualclass.videoHost.gObj.MYSPEED&&(b="low");const a=document.getElementById("proposedSpeed");a&&(a.dataset.suggestion=b);if(b=document.getElementById("networkLatency"))b.dataset.latency=c,c=virtualclass.lang.getString(`band${c}`),b.dataset.title=c};
Network.prototype.setSpeed=function(c){virtualclass.videoHost.gObj.MYSPEED=c;ioAdapter.sendSpeed(virtualclass.videoHost.gObj.MYSPEED);this.hideTeacherVideo();this.resetVariations()};Network.prototype.hideTeacherVideo=function(){if(roles.isStudent()&&3<=virtualclass.videoHost.gObj.MYSPEED){const c=document.querySelector("#videoParticipate"),b=c.getContext("2d");b.fillStyle="#000000";b.fillRect(0,0,c.offsetWidth,c.offsetHeight)}};
Network.prototype.resetVariations=function(){this.countLatency=this.sumLatency=0;this.avgLatency=1;this.minLatency=999999};Network.prototype.netWorkElementIsReady=function(){const c=document.querySelector("#networkStatusContainer"),b=document.querySelector("#virtualclassCont");if(null==c){const a=this;virtualclass.gObj.connectingRoom=setTimeout(()=>{a.netWorkElementIsReady()},1E3)}else c.classList.add("connecting-room"),virtualclass.isPlayMode||b.classList.add("connecting"),clearTimeout(virtualclass.gObj.connectingRoom)};const gesture={initClassJoin(){const c=document.querySelector("#joinClassModal");null!=c&&(c.style.display="block",document.getElementById("virtualclassCont").dataset.currwindow="precheck");document.querySelector("#joinClassModal").className="modal in";const b=document.querySelector("#virtualclassCont #virtualclassApp");null!=b&&(b.style.display="flex");const a=document.querySelector("#joinClassModal .joinClasscontainer button");c&&c.addEventListener("click",()=>{a.focus()});this.classJoin=!0},attachHandler(){const c=
document.querySelector("#joinClassModal .joinClasscontainer button");c.focus();null!=c&&(c.addEventListener("click",()=>{virtualclass.gesture.clickToContinue()}),c.addEventListener("keydown",b=>{b.preventDefault();13===b.keyCode&&virtualclass.gesture.clickToContinue()}))},closeContinueWindow(){const c=document.querySelector("#virtualclassCont #virtualclassApp"),b=document.querySelector("#joinClassModal");c.style.display="flex";b.style.display="none";document.getElementById("virtualclassCont").dataset.currwindow=
"normal"},clickToContinue(){this.closeContinueWindow();virtualclass.media.audio.initAudiocontext();virtualclass.media.readyAudioContext=!0;virtualclass.vutil.triggerMouseEvent(document.querySelector(".CodeMirror-scroll"),"mousedown")},initAudioResume(c){const b=document.querySelector("#joinClassModal");null!==b&&(b.style.display="block");virtualclass.modal.show("#joinClassModal");if(null===document.getElementById("initAudio")){var a=document.querySelector("#joinClassModal .modal-body");const d=document.createElement("div");
d.id="initAudio";d.innerHTML=virtualclass.lang.getString("clickheretoplay");a.appendChild(d);a.onclick=function(){virtualclass.media.audio.initScriptNode(c);b.style.display="none";virtualclass.gObj.requestToScriptNode=null}}a=document.querySelector("#joinClassModal .joinClasscontainer");null!==a&&(a.style.display="none")}};(function(c,b){const a=function(a){this.app=a};a.prototype.init=function(){null===b.getElementById("ancCont")&&this.UI.container();this.subCont=b.querySelector("#virtualclassCont.congrea #dcPaging")};a.prototype.createIndex=function(){this.shownPage(this.width);this.addActiveNavigation();this.setTotalPages(virtualclass.orderList.DocumentShare.ol.order.length)};a.prototype.setCurrentIndex=function(a){b.querySelector("#currIndex").innerHTML=a};a.prototype.setTotalPages=function(a){var c=b.querySelector("#docShareNav #totalPages");
c&&(c.innerHTML=virtualclass.lang.getString("of")+" "+`${a}`,c=b.querySelector("#docShareNav"),a?(c.classList.add("show"),c.classList.remove("hide")):(c.classList.add("hide"),c.classList.remove("show")))};a.prototype.adjustPageNavigation=function(a,c){if("right"===c){var d=b.querySelectorAll(".noteIndex.shw");if(d.length)var f=d[d.length-1],m=parseInt(f.getAttribute("data-set"));for(f=m;f<a;f++)if("DocumentShare"===virtualclass.currApp&&virtualclass.dts.indexNav.UI.setClassPrevNext(),d=b.querySelector(".noteIndex.hid.right"))if(d.classList.remove("hid",
"right"),d.classList.add("shw"),d=b.querySelector(".noteIndex.shw"))d.classList.remove("shw"),d.classList.add("hid","left");"DocumentShare"===virtualclass.currApp&&(a=virtualclass.dts.docs.currNote,(a=b.querySelector(`.congrea #dcPaging #index${a}`))&&!a.classList.contains("active")&&a.classList.add("active"))}else{for((c=b.querySelector(".noteIndex.shw"))&&(m=+c.getAttribute("data-set"));m>a;m--)"DocumentShare"===virtualclass.currApp&&virtualclass.dts.indexNav.UI.setClassPrevNext(),c=b.querySelectorAll(".noteIndex.hid.left"),
c.length&&(d=c[c.length-1]),d&&(d.classList.remove("hid","left"),d.classList.add("shw"),c=b.querySelectorAll(".noteIndex.shw"),c.length&&(f=c[c.length-1]),f&&(f.classList.remove("shw"),f.classList.add("hid","right")));"DocumentShare"===virtualclass.currApp&&(a=virtualclass.dts.docs.currNote,(a=b.querySelector(`.congrea #dcPaging #index${a}`))&&!a.classList.contains("active")&&(a.classList.add("active"),a.setAttribute("selected","selected")))}};a.prototype.removeNav=function(){const a=b.getElementById("docShareNav");
for(;a.firstChild;)a.removeChild(a.firstChild)};a.prototype.addActiveNavigation=function(a){this.addActiveClass(a);a=b.querySelector("#rightNavPage.disable");this.UI.isNodeAvailable(".noteIndex.shw.active","next")?null!=a&&("Whiteboard"===virtualclass.currApp?this.UI.setArrowStatus("rightNavPage","enable"):"DocumentShare"===virtualclass.currApp&&virtualclass.dts.indexNav.UI.setArrowStatusDocs(b.getElementById("rightNavPage"),"enable","disable")):"Whiteboard"===virtualclass.currApp?this.UI.setArrowStatus("rightNavPage",
"disable"):virtualclass.dts.indexNav.UI.setArrowStatusDocs(b.getElementById("rightNavPage"),"disable","enable");a=b.querySelector("#leftNavPage.disable");this.UI.isNodeAvailable(".noteIndex.shw.active","prev")?null!=a&&("Whiteboard"===virtualclass.currApp?this.UI.setArrowStatus("leftNavPage","enable"):virtualclass.dts.indexNav.UI.setArrowStatusDocs(b.getElementById("leftNavPage"),"enable","disable")):"Whiteboard"===virtualclass.currApp?this.UI.setArrowStatus("leftNavPage","disable"):"DocumentShare"===
virtualclass.currApp&&virtualclass.dts.indexNav.UI.setArrowStatusDocs(b.getElementById("leftNavPage"),"disable","enable")};a.prototype.addActiveClass=function(){let a;if("Whiteboard"===virtualclass.currApp)a=virtualclass.gObj.wbCount+1;else if("DocumentShare"===virtualclass.currApp)if(Array.isArray(virtualclass.orderList[virtualclass.dts.appName].ol.order)){a=virtualclass.orderList[virtualclass.dts.appName].ol.order.length;const b=virtualclass.orderList[virtualclass.dts.appName].ol.order.indexOf(virtualclass.dts.docs.currNote);
this.setCurrentIndex(b+1)}else a=1;this.setTotalPages(a)};a.prototype.rearrangePageNavigation=function(a){const c=b.getElementById("dcPaging");if(c){const f=b.createElement("div");f.id="dcPaging";if(null!=f){const g=[];if(this.oldOrder)for(var d=0;d<this.oldOrder.length;d++)g[this.oldOrder[d]]=b.getElementById(`index${this.oldOrder[d]}`).className;for(d=0;d<a.length;d++){const c=b.getElementById(`index${a[d]}`);this.oldOrder&&(c.className=g[this.oldOrder[d]]);f.appendChild(c);c.innerHTML=d+1;c.value=
d+1}c.parentNode.replaceChild(f,c)}}this.UI.setClassPrevNext();this.addActiveNavigation()};a.prototype.shownPage=function(a){const c=b.querySelectorAll(".noteIndex");a=this.countNumberOfNavigation(a);for(let b=0;b<c.length;b++)c[b].className=b>a?"noteIndex hid right":"noteIndex shw"};a.prototype.countNumberOfNavigation=function(a){return 1200<=a?8:700<=a?5:500<=a?4:2};a.prototype.movePageIndex=function(a){virtualclass.dts.indexNav.addActiveNavigation();virtualclass.dts.indexNav.UI.setClassPrevNext();
virtualclass.dts.indexNav.UI.pageNavHandler(a)};a.prototype.createDocNavigationNumber=function(a,c){var d=virtualclass.getTemplate("docIndex","navigation")({app:virtualclass.currApp,id:a,page:c+1});this.subCont.insertAdjacentHTML("beforeend",d);d=b.querySelector(`#index${a}`);virtualclass.dts.docs.currNote===a&&(d.classList.add("active"),this.setCurrentIndex(c));this.index=c+1;d.onclick=virtualclass.dts.docs.goToNavs(a)};a.prototype.createWbNavigationNumber=function(a){const b=`_doc_0_${a}`,c=virtualclass.getTemplate("wbIndex",
"navigation")({app:virtualclass.currApp,id:a,order:a,wid:b});this.subCont.insertAdjacentHTML("beforeend",c);virtualclass.wbCommon.indexNav.addActiveNavigation(b);this.setCurrentIndex(a)};a.prototype.newWbpage=function(){virtualclass.vutil.navWhiteboard(virtualclass.wbCommon,virtualclass.wbCommon.newPage)};a.prototype.studentDocNavigation=function(a){if(virtualclass.orderList[virtualclass.dts.appName].ol.order){a=virtualclass.orderList[virtualclass.dts.appName].ol.order.indexOf(a);var c=b.querySelector("#docShareNav");
-1===a?(c.classList.add("hide"),c.classList.remove("show")):(c.classList.add("show"),c.classList.remove("hide"));if(c=b.getElementById("stdPageNo"))c.innerHTML=a+1;this.setTotalPages(virtualclass.orderList[virtualclass.dts.appName].ol.order.length)}};a.prototype.studentWBPagination=function(a){const c=b.getElementById("stdPageNo");c&&(c.innerHTML=+a,this.setTotalPages(virtualclass.orderList.Whiteboard.ol.order.length))};a.prototype.updateNavigation=function(){"Whiteboard"===virtualclass.currApp?roles.hasControls()?
roles.hasControls()&&!virtualclass.config.makeWebSocketReady&&(virtualclass.wbCommon.indexNav.setCurrentIndex(virtualclass.gObj.currIndex),virtualclass.wbCommon.indexNav.setTotalPages(virtualclass.orderList.Whiteboard.ol.order.length)):"undefined"!==typeof virtualclass.wbCommon.indexNav&&virtualclass.wbCommon.indexNav.studentWBPagination(virtualclass.gObj.currIndex||virtualclass.gObj.currSlide):"DocumentShare"===virtualclass.currApp&&virtualclass.dts.noteExist()&&(this.setCurrentIndex(virtualclass.gObj.currIndex),
this.setTotalPages(virtualclass.orderList.Documentshare.ol.order.length))};a.prototype.UI={container(){const a=b.getElementById("docShareNav"),c=virtualclass.getTemplate("navMain","navigation")({app:virtualclass.currApp,control:roles.hasControls()});a.innerHTML=c},createNewPageButton(){if(roles.hasControls()&&"Whiteboard"===virtualclass.currApp){var a=b.querySelector(".congrea #docShareNav");const c=b.createElement("span");c.id="addNewPage";c.className="newPage";a.insertBefore(c,a.firstChild);a=b.createElement("span");
c.appendChild(a);a.className="icon-newPage congtooltip";a.setAttribute("data-title",virtualclass.lang.getString("newPage"));a.addEventListener("click",function(){virtualclass.gObj.readyToCreate&&(virtualclass.gObj.readyToCreate=!1,virtualclass.wbCommon.indexNav.newWbpage(this.type))})}},setClassPrevNext(){let a,c;const g=b.querySelector(`#documentScreen #note${virtualclass.dts.docs.currNote}`);null!=g&&(a=g.previousElementSibling,c=g.nextElementSibling);b.querySelector("#leftNavPage")&&(a?this.setArrowStatus("leftNavPage",
"enable"):this.setArrowStatus("leftNavPage","disable"));b.querySelector("#rightNavPage")&&(c?this.setArrowStatus("rightNavPage","enable"):this.setArrowStatus("rightNavPage","disable"))},pageNavHandler(a,c){if("right"===a){if(a=b.querySelector(".noteIndex.hid.right.active")){a.classList.remove("hid");a.classList.remove("right");a.classList.add("shw");var d=b.querySelector(".noteIndex.shw");d&&(d.classList.remove("shw"),d.classList.add("hid","left"))}}else if(a=b.querySelector(".noteIndex.hid.left.active"))a.classList.remove("hid"),
a.classList.remove("left"),a.classList.add("shw"),a=b.querySelectorAll(".noteIndex.shw"),a.length&&(d=a[a.length-1]),d&&(d.classList.remove("shw"),d.classList.add("hid"),d.classList.add("right"))},setArrowStatus(a,c){const d="disable"===c?"enable":"disable";a=b.getElementById(a);"Whiteboard"===virtualclass.currApp?(a.classList.add(c),a.classList.remove(d)):virtualclass.dts.docs.currNote===virtualclass.orderList.DocumentShare.ol.order[virtualclass.orderList.DocumentShare.ol.order.length-1]&&this.setArrowStatusDocs(a,
c,d)},setArrowStatusDocs(a,b,c){a.classList.add(b);a.classList.remove(c)},isNodeAvailable(a,c){c="next"===c?"nextSibling":"previousSibling";return(a=b.querySelector(a))&&null!=a[c]}};c.pageIndexNav=a})(window,document);(function(c){c.modal=(()=>({show(b){b=document.querySelector(b);null!=b&&b.classList.add("in")},hide(b){b=document.querySelector(b);null!=b&&b.classList.add("fade")},removeModal(){const b=document.querySelector("#editPollModal");b&&b.parentNode.removeChild(b)},closeModalHandler(b){const a=this;(b=document.querySelector(`#${b} .close`))&&b.addEventListener("click",()=>{a.removeModal()})},hideModal(){const b=document.querySelector("#congdashboard");b&&(b.className="modal fade")},showModal(){const b=
document.querySelector("#congdashboard");b&&(b.className="modal in")},attachpopupHandler(b,a,c){const d=document.querySelector(`#qnText${b}${a}`);d.insertAdjacentHTML("beforeend",c);document.querySelector(`#qnText${b}${a} .popover-content`).classList.add("hide");const g=document.querySelector(`#qnText${b}${a} .popover-content`);d.addEventListener("mouseover",()=>{g.classList.add("show");g.classList.remove("hide")});d.addEventListener("mouseleave",()=>{g.classList.remove("show");g.classList.add("hide")})}}))()})(window);const chatContainerEvent={ub:"initChatBox",ac:"footerControler",ch:"footerControler",er:"footerControler",rs:"footerControler",rh:"footerControler",getEvent(c){({event:c}=c.dataset);return this[c]},initChatBox(c,b){var a=$(c);let d;"videoSubWrapper"===c.className||"userVideos"===c.classList?(d=a[0].id,c=d.replace("user","")):(d=a.attr("href"),c=d.replace("#",""));"undefined"!==typeof d&&(a=0<a.parent(".usern").length?a.html():chat_div.shadowRoot.querySelector(`#ml${c} .usern a`).title,-1===$.inArray(c,
virtualclass.chat.idList)&&(virtualclass.chat.counter++,virtualclass.chat.idList.push(c),Object.prototype.hasOwnProperty.call(virtualclass.chat.vmstorage,c)||(virtualclass.chat.vmstorage[c]=[],virtualclass.chat.vmstorage[c].push({userid:c,name:a}))),b.addBox(c,{dest:`dest${virtualclass.chat.counter}`,title:`box${virtualclass.chat.counter}`,first_name:a,type:"privateChat"}),b.init({user:{name:a},messageSent(a,b,c){$(`#${a}`).chatbox("option","boxManager").addMsg(b.name,c)}}),Object.prototype.hasOwnProperty.call(virtualclass.chat.vmstorage,
c)&&displayUserSinglePvtChatHistory(c),a=c=null)},onEvent(c,b){const a=this.getEvent(c);"userVideos"===c.classList||"videoSubWrapper"===c.classList||"initChatBox"===a?(c=c.classList.contains("media-heading")?c.parentNode.previousElementSibling:c.parentNode,this.initChatBox(c,b)):"footerControler"===a&&("A"===c.tagName&&(c=c.firstElementChild,"SPAN"!==c.tagName&&alert("no span tag is found")),virtualclass.user.control.init.call(virtualclass.user,c))},elementFromShadowDom(c,b,a){let d;null!=virtualclass.gObj.testChatDiv&&
(d=virtualclass.gObj.testChatDiv.shadowRoot,d="undefined"!==typeof b&&"all"===b?d.querySelectorAll(c):"undefined"!==typeof a?d.getElementById(c):d.querySelector(c));return d}};const micTesting={audioPlayerNode:!1,manipulateStreamFallback(c){this.playAudio=!0;this.audioToBePlay=[];this.allAudioArr=[];this.bufferSize=16384;if(null!=c){if(!Object.prototype.hasOwnProperty.call(virtualclass.media.audioVisual,"audioCtx")||Object.prototype.hasOwnProperty.call(virtualclass.media.audioVisual,"audioCtx")&&null==virtualclass.media.audioVisual.audioCtx)virtualclass.media.audioVisual.audioCtx=new (window.AudioContext||window.webkitAudioContext);!virtualclass.system.mediaDevices.hasMicrophone||
null!=this.audioCreatorNode&&null!=this.audioCreatorNode&&"undefined"!==typeof this.audioCreatorNode||(this.audioInput=virtualclass.media.audioVisual.audioCtx.createMediaStreamSource(c),this.audioCreatorNode=virtualclass.media.audioVisual.audioCtx.createScriptProcessor(this.bufferSize,1,1),this.audioCreatorNode.onaudioprocess=this.recorderProcessFallback.bind(this),this.audioInput.connect(this.audioCreatorNode),this.audioCreatorNode.connect(virtualclass.media.audioVisual.audioCtx.destination))}},
recorderProcessFallback(c){if(this.playAudio){Object.prototype.hasOwnProperty.call(virtualclass.precheck.mic.graph.microphone,"localAudioBuffer")&&null!=virtualclass.precheck.mic.graph.microphone.localAudioBuffer||(virtualclass.precheck.mic.graph.microphone.localAudioBuffer=virtualclass.media.audioVisual.audioCtx.createBuffer(1,this.bufferSize,virtualclass.media.audioVisual.audioCtx.sampleRate));const b=c.inputBuffer.getChannelData(0);this.queueWithFallback(b);this.playWithFallback();virtualclass.precheck.mic.graph.microphone.reloadBufferFunction(c)}},
queueWithFallback(c){for(let b=0;b<c.length;b++)this.allAudioArr.push(c[b]);for(;this.allAudioArr.length>=this.bufferSize;)c=this.allAudioArr.splice(0,this.bufferSize),this.audioToBePlay.push(new Float32Array(c))},playWithFallback(){const c=this;let b;this.audioPlayerNode||(this.audioPlayerNode=virtualclass.media.audioVisual.audioCtx.createScriptProcessor(this.bufferSize,1,1),this.audioPlayerNode.onaudioprocess=function(a){if(micTesting.playAudio){if(b=a.outputBuffer.getChannelData(0),a=c.getAudioChunks(),
null!=a)for(let c=0;c<a.length;c++)b[c]=a[c]}else for(b=a.outputBuffer.getChannelData(0),a=0;a<b.length;a++)b[a]=0},this.audioPlayerNode.connect(virtualclass.media.audioVisual.audioCtx.destination))},getAudioChunks(){if(5<=this.audioToBePlay.length){for(;2<=this.audioToBePlay.length;)this.audioToBePlay.shift();this.aChunksPlay=!0;return this.audioToBePlay.shift()}if(2<=this.audioToBePlay.length||0<this.audioToBePlay.length&&!0===this.aChunksPlay)return this.aChunksPlay=!0,this.audioToBePlay.shift();
this.aChunksPlay=!1},makeAudioEmpty(){this.playAudio=!1;this.audioToBePlay=[]},destroyAudioNode(){this.makeAudioEmpty();if(virtualclass.gObj.meetingMode){const c=virtualclass.multiVideo.localStream.getTracks();for(let b=0;b<c.length;b++)c[b].stop()}else this.audioPlayerNode&&(this.audioPlayerNode.disconnect(virtualclass.media.audioVisual.audioCtx.destination),delete this.audioPlayerNode,this.audioPlayerNode=!1),this.audioCreatorNode&&(this.audioCreatorNode.disconnect(virtualclass.media.audioVisual.audioCtx.destination),
delete this.audioCreatorNode,"Firefox"!==virtualclass.system.mybrowser.name&&"iOS"!==virtualclass.system.mybrowser.name&&"Safari"!==virtualclass.system.mybrowser.name||virtualclass.media.audioVisual.audioCtx.close(),Object.prototype.hasOwnProperty.call(virtualclass.precheck.mic,"graphProcessor")&&null!=virtualclass.precheck.mic.graphProcessor&&virtualclass.precheck.mic.graphProcessor.disconnect(virtualclass.precheck.mic.graphContext.destination),"Firefox"!==virtualclass.system.mybrowser.name&&"iOS"!==
virtualclass.system.mybrowser.name&&"Safari"!==virtualclass.system.mybrowser.name||null==virtualclass.precheck.mic.graphContext||virtualclass.precheck.mic.graphContext.close(),delete virtualclass.media.audioVisual.audioCtx)}};(function(c){c.settings={info:{},user:{},currentTime:0,specificUser:!1,init(){virtualclass.settings.info=virtualclass.settings.parseSettings(virtualclassSetting.settings);const b=localStorage.getItem("userSettings");b&&(virtualclass.settings.user=JSON.parse(b));this.recording.init()},triggerSettings(){this.qaMarkNotes(virtualclass.settings.info.qaMarkNotes);this.askQuestion(virtualclass.settings.info.askQuestion);this.qaAnswer(virtualclass.settings.info.qaAnswer);this.qaComment(virtualclass.settings.info.qaComment);
this.qaUpvote(virtualclass.settings.info.qaUpvote)},settingsToHex(b){const a=[];a[0]=+b.allowoverride;a[1]=+b.studentaudio;a[2]=+b.studentvideo;a[3]=+b.studentpc;a[4]=+b.studentgc;a[5]=+b.askQuestion;a[6]=+b.userlist;a[7]=+b.enableRecording;a[8]=+b.recAllowpresentorAVcontrol;a[9]=+b.recShowPresentorRecordingStatus;a[10]=+b.attendeeAV;a[11]=+b.recallowattendeeAVcontrol;a[12]=+b.showAttendeeRecordingStatus;a[13]=+b.trimRecordings;a[14]=+b.attendeerecording;a[15]=+b.qaMarkNotes;a[16]=+b.qaAnswer;a[17]=
+b.qaComment;a[18]=+b.qaUpvote;a[19]=+b.upcomingSetting;return virtualclass.settings.binaryToHex(a.join(""))},parseSettings(b){const a={};b=virtualclass.settings.hexToBinary(b);b=b.split("");a.allowoverride=!!+b[0];a.studentaudio=!!+b[1];a.studentvideo=!!+b[2];a.studentpc=!!+b[3];a.studentgc=!!+b[4];a.askQuestion=!!+b[5];a.userlist=!!+b[6];a.enableRecording=!!+b[7];a.recAllowpresentorAVcontrol=!!+b[8];a.recShowPresentorRecordingStatus=!!+b[9];a.attendeeAV=!!+b[10];a.recallowattendeeAVcontrol=!!+b[11];
a.showAttendeeRecordingStatus=!!+b[12];a.trimRecordings=!!+b[13];a.attendeerecording=!!+b[14];a.qaMarkNotes=!!+b[15];a.qaAnswer=!!+b[16];a.qaComment=!!+b[17];a.qaUpvote=!!+b[18];a.upcomingSetting=!!+b[19];return a},hexToBinary(b){let a,c="";const f={0:"0000",1:"0001",2:"0010",3:"0011",4:"0100",5:"0101",6:"0110",7:"0111",8:"1000",9:"1001",a:"1010",b:"1011",c:"1100",d:"1101",e:"1110",f:"1111",A:"1010",B:"1011",C:"1100",D:"1101",E:"1110",F:"1111"};for(a=0;a<b.length;a+=1)if(Object.prototype.hasOwnProperty.call(f,
b[a]))c+=f[b[a]];else return!1;return c},binaryToHex(b){let a,c,f,g,k="";for(a=b.length-1;3<=a;a-=4){f=b.substr(a+1-4,4);for(c=g=0;4>c;c+=1){if("0"!==f[c]&&"1"!==f[c])return!1;g=2*g+parseInt(f[c],10)}k=10<=g?String.fromCharCode(g-10+65)+k:String(g)+k}if(0<=a){for(c=g=0;c<=a;c+=1){if("0"!==b[c]&&"1"!==b[c])return!1;g=2*g+parseInt(b[c],10)}k=String(g)+k}return k},applySettings(b,a,c){if(roles.hasControls())return!0!==b&&!1!==b||!Object.prototype.hasOwnProperty.call(virtualclass.settings.info,a)?!1:
("undefined"===typeof c?(virtualclass.settings.applyPresentorGlobalSetting(b,a),"askQuestion"!==a&&"qaMarkNotes"!==a||this.triggerSettings(b)):virtualclass.settings.applySpecificAttendeeSetting(b,a,c),!0)},applyPresentorGlobalSetting(b,a){localStorage.removeItem("userSettings");virtualclass.settings.info[a]=b;b=virtualclass.settings.settingsToHex(virtualclass.settings.info);ioAdapter.mustSend({cf:"settings",Hex:b,time:Date.now()});virtualclassSetting.settings=b;for(const a in virtualclass.settings.user)virtualclass.user.control.changeAttribute(a,
virtualclass.gObj.testChatDiv.shadowRoot.getElementById(`${a}contrAudImg`),virtualclass.settings.info.studentaudio,"audio","aud"),virtualclass.user.control.changeAttribute(a,virtualclass.gObj.testChatDiv.shadowRoot.getElementById(`${a}contrChatImg`),virtualclass.settings.info.studentpc,"chat","chat");virtualclass.settings.user={}},applySpecificAttendeeSetting(b,a,c){if(Object.prototype.hasOwnProperty.call(virtualclass.settings.user,c)){var d=virtualclass.settings.parseSettings(virtualclass.settings.user[c]);
d[a]=b;b=virtualclass.settings.settingsToHex(d)}else{d={};for(const a in virtualclass.settings.info)d[a]=virtualclass.settings.info[a];d[a]=b;b=virtualclass.settings.settingsToHex(d)}ioAdapter.mustSendUser({cf:"settings",Hex:b,toUser:c,time:Date.now()},c);virtualclass.settings.user[c]=b;localStorage.setItem("userSettings",JSON.stringify(virtualclass.settings.user))},applyAttendeeSetting(b){const a="enableRecording recAllowpresentorAVcontrol recShowPresentorRecordingStatus attendeeAV recallowattendeeAVcontrol showAttendeeRecordingStatus attendeerecording".split(" ");
for(const c in b)if(virtualclass.settings.info[c]!==b[c]&&(virtualclass.isPlayMode?"qaMarkNotes"!==c&&"askQuestion"!==c&&"qaAnswer"!==c&&"qaUpvote"!==c&&"qaComment"!==c&&(virtualclass.settings.info[c]=b[c]):virtualclass.settings.info[c]=b[c],"trimRecordings"!==c)){const d=-1!==a.indexOf(c)?b:b[c];if(virtualclass.isPlayMode){if("qaMarkNotes"!==c&&"askQuestion"!==c&&"qaAnswer"!==c&&"qaUpvote"!==c&&"qaComment"!==c)virtualclass.settings[c](d)}else virtualclass.settings[c](d)}},onMessage(b,a){roles.hasControls()?
"string"===typeof b&&null==a&&(virtualclass.gObj.refreshSession||(virtualclass.settings.info=virtualclass.settings.parseSettings(b)),delete virtualclass.gObj.refreshSession):"string"===typeof b&&roles.isStudent()?(this.specificUser=a?!0:!1,b=virtualclass.settings.parseSettings(b),this.applyAttendeeSetting(b)):this.recording.triggerSetting(b)},studentaudio(b){roles.isStudent()&&(!0===b?(virtualclass.user.control.audioWidgetEnable(!0),virtualclass.gObj.audioEnable=!0):!1===b&&(b=document.querySelector("#speakerPressOnce"),
!0!==b.dataset.audioPlaying&&"true"!==b.dataset.audioPlaying||virtualclass.media.audio.clickOnceSpeaker("speakerPressOnce"),virtualclass.user.control.audioDisable(),virtualclass.gObj.audioEnable=!1))},allowoverride(){},studentpc(b){roles.isStudent()&&(!0===b?virtualclass.user.control.allChatEnable("pc"):!1===b&&virtualclass.user.control.disbaleAllChatBox())},studentgc(b){roles.isStudent()&&(!0===b?virtualclass.user.control.allChatEnable("gc"):virtualclass.user.control.disableCommonChat())},studentvideo(b){if(roles.isStudent()){const a=
document.querySelector(".videoSwitchCont #videoSwitch");a.classList.contains("off")&&!1===b||a.classList.contains("on")&&!0===b||a.classList.contains("on")&&!1===b&&virtualclass.vutil.videoHandler("off");virtualclass.videoHost.toggleVideoMsg(!1===b?"disable":"enable")}},askQuestion(b){const a=document.querySelector("#congAskQuestion"),c=document.getElementById("virtualclassAppRightPanel");!0===b?(a.classList.remove("askQuestionDisable"),a.classList.add("askQuestionEnable"),c.dataset.askQuestion="askQuestionEnable"):
(a.classList.remove("askQuestionEnable"),a.classList.add("askQuestionDisable"),c.dataset.askQuestion="askQuestionDisable")},userlist(b){if(roles.isStudent()){const a=document.querySelector("#memlist");if(null!==a){const c=document.querySelector("#congchatBarInput #congreaUserSearch"),f=document.querySelector("#user_list.vmchat_bar_button");!0===b?(a.classList.remove("hideList"),c.classList.remove("hideInput"),f.classList.remove("disable")):(a.classList.add("hideList"),c.classList.add("hideInput"),
f.classList.add("disable"),handleCommonChat())}}},attendeerecording(b){virtualclass.settings.recordingSettings(b)},enableRecording(b){virtualclass.settings.recordingSettings(b)},recAllowpresentorAVcontrol(b){virtualclass.settings.recordingSettings(b)},recShowPresentorRecordingStatus(b){virtualclass.settings.recordingSettings(b)},attendeeAV(b){virtualclass.settings.recordingSettings(b)},recallowattendeeAVcontrol(b){virtualclass.settings.recordingSettings(b)},showAttendeeRecordingStatus(b){virtualclass.settings.recordingSettings(b)},
qaMarkNotes(b){const a=document.querySelector("#virtualclassnote"),c=document.getElementById("virtualclassAppRightPanel"),f=document.querySelector("#bookmark");!0===b?(a.classList.remove("notesDisable"),a.classList.add("notesEnable"),f.classList.remove("bookmarkDisable"),f.classList.add("bookmarkEnable"),c.dataset.qaNote="enable"):(a.classList.remove("notesEnable"),a.classList.add("notesDisable"),f.classList.remove("bookmarkEnable"),f.classList.add("bookmarkDisable"),c.dataset.qaNote="disbale")},
qaAnswer(b){!virtualclass.vutil.checkUserRole()&&document.querySelector("#askQuestion")&&(!0===b?document.querySelector("#askQuestion").dataset.answer="enable":!1===b&&(document.querySelector("#askQuestion").dataset.answer="disable"))},qaComment(b){!virtualclass.vutil.checkUserRole()&&document.querySelector("#askQuestion")&&(!0===b?document.querySelector("#askQuestion").dataset.comment="enable":!1===b&&(document.querySelector("#askQuestion").dataset.comment="disable"))},qaUpvote(b){!virtualclass.vutil.checkUserRole()&&
document.querySelector("#askQuestion")&&(!0===b?document.querySelector("#askQuestion").dataset.upvote="enable":!1===b&&(document.querySelector("#askQuestion").dataset.upvote="disable"))},upcomingSetting(){},recordingSettings(b){b=virtualclass.settings.recording.recordingStatus(b);virtualclass.settings.recording.showRecordingButton(b)},recording:{recordingButton:0,attendeeButtonAction:!0,init(){var b=JSON.parse(localStorage.getItem("recordingButton"));this.recordingButton=null===b?this.recordingStatus():
b;b=JSON.parse(localStorage.getItem("attendeeButtonAction"));null!==b&&(this.attendeeButtonAction=b);this.showRecordingButton()},toggleRecordingButton(){21===this.recordingButton?this.recordingButton=11:11===this.recordingButton&&(this.recordingButton=21);ioAdapter.setRecording();localStorage.setItem("recordingButton",this.recordingButton);this.showRecordingButton();roles.hasControls()?ioAdapter.mustSend({ac:this.recordingButton,cf:"recs"}):21===this.recordingButton?(this.attendeeButtonAction=!0,
localStorage.setItem("attendeeButtonAction",!0)):(this.attendeeButtonAction=!1,localStorage.setItem("attendeeButtonAction",!1))},showRecordingButton(b){"undefined"!==typeof b&&(this.recordingButton=b);b=virtualclass.getTemplate("recordingButton");let a;this.removeButton();switch(this.recordingButton){case 10:a={ten:"ten"};break;case 11:a={eleven:"eleven"};break;case 20:a={twenty:"twenty"};break;case 21:a={twentyone:"twentyone"};break;default:return}b=b(a);document.querySelector("#virtualclassAppFooterPanel #networkStatusContainer").insertAdjacentHTML("afterend",
b);b=document.getElementById("recording");21!==this.recordingButton&&11!==this.recordingButton||this.attachHandler(b)},removeButton(){const b=document.getElementById("recording");null!==b&&b.remove()},attachHandler(b){b.addEventListener("click",this.recordingButtonAction.bind(this,b))},recordingButtonAction(){21!==this.recordingButton&&11!==this.recordingButton||this.toggleRecordingButton()},recordingStatus(b){b="undefined"!==typeof b?b:virtualclass.settings.info;if(!b.enableRecording){if(roles.hasControls()){if(b.recShowPresentorRecordingStatus)return 10}else if(b.showAttendeeRecordingStatus)return 10;
return 0}if(roles.hasControls())return b.recAllowpresentorAVcontrol?21:b.recShowPresentorRecordingStatus?20:22;if(b.attendeerecording){if(b.attendeeAV)return b.recallowattendeeAVcontrol?21:b.showAttendeeRecordingStatus?20:22;if(b.showAttendeeRecordingStatus)return 10}return 0},sendYesOrNo(){return 20===this.recordingButton||21===this.recordingButton||22===this.recordingButton?"yes":"no"},triggerSetting(b){if(roles.isStudent())if(virtualclass.settings.info.attendeeAV){switch(b.ac){case 11:this.recordingButton=
10;break;case 21:this.recordingButton=virtualclass.settings.info.recallowattendeeAVcontrol?this.attendeeButtonAction?21:11:20;break;default:return}ioAdapter.setRecording();localStorage.setItem("recordingButton",this.recordingButton);virtualclass.settings.info.showAttendeeRecordingStatus&&this.showRecordingButton()}else this.recordingButton=0,ioAdapter.setRecording(),this.showRecordingButton()}},userAudioIcon(){!1===virtualclass.settings.info.studentaudio?(virtualclass.gObj.audioEnable=!1,virtualclass.user.control.audioDisable(!0)):
!0===virtualclass.settings.info.studentaudio?(virtualclass.gObj.audioEnable=!0,virtualclass.user.control.audioWidgetEnable(!0)):!0!==virtualclass.settings.info.studentaudio&&virtualclass.user.control.audioDisable()},userVideoIcon(){!1===virtualclass.settings.info.studentvideo&&roles.isStudent()?(virtualclass.vutil.videoHandler("off"),virtualclass.user.control.videoDisable()):(roles.isStudent()&&!0!==virtualclass.settings.info.studentvideo?void 0!==virtualclass.settings.info.studentvideo&&(virtualclass.vutil.videoHandler("off"),
virtualclass.videoHost.toggleVideoMsg("disable")):(virtualclass.user.control.videoEnable(),roles.isStudent()&&virtualclass.vutil.videoHandler("off")),!0===virtualclass.settings.info.studentvideo&&virtualclass.user.control.videoEnable())}}})(window);(c=>{function b(a){const b=new Promise((b,c)=>{const d=()=>{a.removeEventListener("success",g);a.removeEventListener("error",k)},g=()=>{b(f(a.result));d()},k=()=>{c(a.error);d()};a.addEventListener("success",g);a.addEventListener("error",k)});b.then(b=>{b instanceof IDBCursor&&r.set(b,a)});u.set(b,a);return b}function a(a){if(!t.has(a)){var b=new Promise((b,c)=>{const d=()=>{a.removeEventListener("complete",f);a.removeEventListener("error",g);a.removeEventListener("abort",g)},f=()=>{b();d()},g=()=>
{c(a.error);d()};a.addEventListener("complete",f);a.addEventListener("error",g);a.addEventListener("abort",g)});t.set(a,b)}}function d(a){return a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...b){a.apply(u.get(this),b);return f(r.get(this))}:function(...b){return f(a.apply(u.get(this),b))}:function(b,...c){c=a.call(u.get(this),b,...c);
z.set(c,b.sort?b.sort():[b]);return f(c)}}function f(c){if(c instanceof IDBRequest)return b(c);if(v.has(c))return v.get(c);if("function"===typeof c)var f=d(c);else c instanceof IDBTransaction&&a(c),f=k(c,m||(m=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(c,p):c;f!==c&&(v.set(c,f),u.set(f,c));return f}function g(a,b){if(a instanceof IDBDatabase&&!(b in a)&&"string"===typeof b){if(D.get(b))return D.get(b);var c=b.replace(/FromIndex$/,""),d=b!==c,f=A.includes(c);if(c in
(d?IDBIndex:IDBObjectStore).prototype&&(f||q.includes(c)))return a=async function(a,...b){a=this.transaction(a,f?"readwrite":"readonly");let g=a.store;d&&(g=g.index(b.shift()));b=g[c](...b);f&&await a.done;return b},D.set(b,a),a}}const k=(a,b)=>b.some(b=>a instanceof b);let m,n;const r=new WeakMap,t=new WeakMap,z=new WeakMap,v=new WeakMap,u=new WeakMap;let p={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return t.get(a);if("objectStoreNames"===b)return a.objectStoreNames||z.get(a);if("store"===
b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return f(a[b])},has(a,b){return a instanceof IDBTransaction&&("done"===b||"store"===b)?!0:b in a}};const q=["get","getKey","getAll","getAllKeys","count"],A=["put","add","delete","clear"],D=new Map;p=(a=>({get:(b,c,d)=>g(b,c)||a.get(b,c,d),has:(b,c)=>!!g(b,c)||a.has(b,c)}))(p);c.virtualclassOpenDB=function(a,b,{blocked:c,upgrade:d,blocking:g}={}){const k=indexedDB.open(a,b);a=f(k);d&&k.addEventListener("upgradeneeded",a=>{d(f(k.result),
a.oldVersion,a.newVersion,f(k.transaction))});c&&k.addEventListener("blocked",()=>c());g&&a.then(a=>a.addEventListener("versionchange",g));return a};c.virtualclassDeleteDB=function(a,{blocked:b}={}){a=indexedDB.deleteDatabase(a);b&&a.addEventListener("blocked",()=>b());return f(a).then(()=>{})}})(window);function triggerInitShareScreen(c,b){"function"===typeof virtualclass.getDataFullScreen&&virtualclass.ss.initShareScreen(c,b)}function isAlreadyInPendingList(c){if(0<virtualclass.gObj.memberlistpending.length)return-1<virtualclass.gObj.memberlistpending.findIndex(b=>b.userid===c.userid)}const removeAppsDom=function(){var c=document.getElementById("commandToolsWrapper");null!=c&&c.parentNode.removeChild(c);c=document.getElementById("virtualclassOptionsCont");null!=c&&c.parentNode.removeChild(c)};
function memberUpdateWithDelay(c,b){if("removed"===b){var a=virtualclass.gObj.memberlistpending.findIndex(a=>a.userid===c.removeUser);-1<a?virtualclass.gObj.memberlistpending.splice(a,1):setTimeout(()=>{memberUpdate(c,b)},0)}else{const b=c.message;if(virtualclass.isPlayMode)for(a=0;a<b.length;a++)isAlreadyInPendingList(b[a])||virtualclass.gObj.memberlistpending.push(b[a]);else for(a=0;a<b.length;a++)virtualclass.gObj.memberlistpending.push(b[a])}0<virtualclass.gObj.memberlistpending.length&&!Object.prototype.hasOwnProperty.call(virtualclass.gObj,
"memberUpdateDelayTimer")&&(virtualclass.gObj.memberUpdateDelayTimer=setTimeout(()=>{memberUpdate(null,"added");delete virtualclass.gObj.memberUpdateDelayTimer;Object.prototype.hasOwnProperty.call(virtualclass.gObj,"addEventToChatDiv")||(virtualclass.gObj.testChatDiv.shadowRoot.querySelector("#subchat").addEventListener("click",a=>{chatContainerEvent.onEvent(a.srcElement,chatboxManager)}),virtualclass.gObj.addEventToChatDiv=!0)},1500))}
const defaultOperation=function(c,b){virtualclass.jId===virtualclass.gObj.uid&&"t"!==virtualclass.joinUser.role&&(virtualclass.vutil.overrideRoles(virtualclass.joinUser.role),"s"===virtualclass.joinUser.role?removeAppsDom():"e"!==virtualclass.joinUser.role&&virtualclass.vutil.removeSessionEndTool());ioPingPong.ping(c);Array.isArray(c.message)||(c.message=[c.message]);memberUpdateWithDelay(c,"added");roles.hasAdmin()&&(virtualclass.gObj.uid===virtualclass.jId&&!virtualclass.gObj.studentSSstatus.mesharing&&
virtualclass.editorRich.isVcAdapterIsReady("editorRich")&&virtualclass.editorRich.responseToRequest(),ioAdapter.sendWithDelayAndDrop({cf:"tConn"},null,"send","tConn",1E3));roles.hasControls()&&virtualclass.gObj.uid!==virtualclass.jId?(virtualclass.vutil.sendCurrAppOnUserJoin(),"ScreenShare"===virtualclass.currApp?b="ss":"SharePresentation"!==virtualclass.currApp&&"DocumentShare"===virtualclass.currApp&&roles.hasControls()&&Object.prototype.hasOwnProperty.call(virtualclass.dts.docs,"currDoc"),"undefined"!==
typeof b&&null!==b&&triggerInitShareScreen(b,6E3)):roles.isStudent()&&virtualclass.gObj.uid!==virtualclass.jId&&virtualclass.gObj.studentSSstatus.mesharing&&triggerInitShareScreen("ss",6E3)};function processImage(c,b){c=new Uint8ClampedArray(c);c=c.subarray(2,c.length);1==b?(b=`data:image/webp;base64,${btoa(virtualclass.videoHost.Uint8ToString(c))}`,c="webp"):(b=`data:image/jpeg;base64,${btoa(virtualclass.videoHost.Uint8ToString(c))}`,c="jpeg");const a=document.getElementById("videoHostContainer");roles.isStudent()&&a.classList.contains("displayInterrupt")&&a.classList.remove("displayInterrupt");virtualclass.videoHost.drawReceivedImage(b,c,{x:0,y:0})}
function isAnyOnePresenter(){return 1===parseInt(wbUser.anyonepresenter,10)}function joinAsTeacher(c){virtualclass.gObj.veryFirstJoin=!1;virtualclass.vutil.isOrginalTeacherExist(c)||overrideOperation("t")}var overrideOperation=function(c){"s"===c&&(virtualclass.view.disappearBox("drawArea"),removeAppsDom());virtualclass.vutil.overrideRoles(c)};function getPosition(c,b){return c.findIndex(a=>a.userid===b)}
const ioEventApi={readyto_member_add(c){if("object"===typeof c.joinUser){const b={};let a=0;for(const d in c.joinUser)wbUser.id!==d&&(b.joinUser={key:d},b.message=c.message[a],b.newuser=c.newuser,b.type=c.type,b.user=c.user,a++,this.member_added(b))}else this.member_added(c)},member_added(c){"undefined"===typeof virtualclass.connectedUsers&&(virtualclass.connectedUsers=[]);if(Object.prototype.hasOwnProperty.call(c,"user")){var b=c.message;virtualclass.jId=b.userid;const a=getPosition(virtualclass.connectedUsers,
virtualclass.jId);-1!==a&&virtualclass.connectedUsers.splice(a,1);virtualclass.gObj.allUserObj[virtualclass.jId]=b;virtualclass.connectedUsers.push(b);virtualclass.joinUser=b}else if(Object.prototype.hasOwnProperty.call(c,"users")){virtualclass.jId=c.joinUser;virtualclass.connectedUsers=c.message;for(var a=0;a<virtualclass.connectedUsers.length;a++)virtualclass.gObj.allUserObj[virtualclass.connectedUsers[a].userid]=virtualclass.connectedUsers[a];virtualclass.joinUser=this.getJoinUser(virtualclass.connectedUsers,
virtualclass.jId)}virtualclass.jId===virtualclass.gObj.uid&&(virtualclass.videoHost.setDefaultValue("undefined"===typeof virtualclass.videoHost.gObj.MYSPEED?1:virtualclass.videoHost.gObj.MYSPEED),virtualclass.vutil.setDefaultScroll(),roles.hasControls())&&(virtualclass.gObj.toBeSendSession||localStorage.getItem("userSettings")?virtualclass.gObj.toBeSendSession&&(ioAdapter.mustSend({cf:"settings",Hex:virtualclassSetting.settings,time:Date.now()}),virtualclass.settings.info=virtualclass.settings.parseSettings(virtualclassSetting.settings),
delete virtualclass.gObj.toBeSendSession):(b=virtualclass.settings.settingsToHex(virtualclass.settings.info),ioAdapter.mustSend({cf:"settings",Hex:b,time:Date.now()})),b=localStorage.getItem("recordingButton"),null!==b&&ioAdapter.mustSend({ac:JSON.parse(b),cf:"recs"}),null!=localStorage.getItem("prvUser")&&virtualclass.vutil.checkUserRole()&&virtualclass.settings.triggerSettings());virtualclass.gObj.mySetTime=2E3;defaultOperation(c,void 0);roles.hasControls()&&virtualclass.poll.updateUsersOnPoll(c);
if("undefined"!==typeof virtualclass.quiz&&0>virtualclass.quiz.uniqueUsers.indexOf(virtualclass.jId))for(a in virtualclass.quiz.uniqueUsers.push(virtualclass.jId),io.uniquesids)0>virtualclass.quiz.uniqueUsers.indexOf(a)&&virtualclass.quiz.uniqueUsers.push(a);"s"===virtualclass.joinUser.role&&virtualclass.gObj.has_ts_capability&&ioAdapter.mustSend({uid:virtualclass.gObj.uid,ac:!0,cf:"tsr"});if(virtualclass.gObj.uid!==virtualclass.jId&&virtualclass.gObj.meetingMode)virtualclass.multiVideo.onUserJoin(virtualclass.jId);
!roles.hasControls()&&("t"===c.message[0].role||virtualclass.gObj.uid===virtualclass.jId&&virtualclass.vutil.whoIsTeacher())&&(c=document.getElementById("virtualclassCont"),c.classList.contains("tr_available")||(c.classList.add("tr_available"),virtualclass.gObj.teacherAvailableTime&&clearTimeout(virtualclass.gObj.teacherAvailableTime),virtualclass.gObj.teacherAvailableTime=setTimeout(()=>{virtualclass.settings.info.askQuestion&&virtualclass.settings.askQuestion(!0);"editorRich"===virtualclass.currApp&&
virtualclass.editorRich.cm.setOption("readOnly",!1)},3E3)))},newmessage(c){const b=c.message;if(Object.prototype.hasOwnProperty.call(b,"cf")&&"function"===typeof receiveFunctions[b.cf])receiveFunctions[b.cf](c)},readyto_user_logout(c){for(const b in c.action)c={type:"user_logout",fromUser:b,message:"offline"},virtualclass.ioEventApi.user_logout(c)},user_logout(c){if(!roles.hasControls()&&(Object.prototype.hasOwnProperty.call(virtualclass.gObj,"whoIsTeacher")||(virtualclass.gObj.whoIsTeacher=virtualclass.vutil.whoIsTeacher()),
virtualclass.gObj.whoIsTeacher===c.fromUser)){var b=document.getElementById("virtualclassCont");virtualclass.settings.askQuestion(!1);b&&b.classList.contains("tr_available")&&(b.classList.remove("tr_available"),"EditorRich"===virtualclass.currApp&&roles.isStudent()&&virtualclass.editorRich.cm.setOption("readOnly","nocursor"))}b=c.fromUser;delete virtualclass.gObj.allUserObj[b];c=getPosition(virtualclass.connectedUsers,b);-1!==c&&virtualclass.connectedUsers.splice(c,1);c={removeUser:b};memberUpdateWithDelay(c,
"removed");if(virtualclass.gObj.meetingMode)virtualclass.multiVideo.onUserRemove(b);virtualclass.connectedUsers.length<virtualclass.gObj.userToBeDisplay&&(virtualclass.gObj.insertUser=!0)},error(c){virtualclass.gObj.displayError&&(virtualclass.view.removeElement("serverErrorCont"),"undefined"!==typeof c.message&&("undefined"!==typeof c.message.stack&&virtualclass.view.createErrorMsg(c.message.stack,"errorContainer","virtualclassAppFooterPanel"),"object"!==typeof c.message&&virtualclass.view.createErrorMsg(c.message.stack,
"errorContainer","virtualclassAppFooterPanel")))},Text_Limit_Exeed(c){virtualclass.view.createErrorMsg(virtualclass.lang.getString("Text_Limit_Exeed"),"errorContainer","virtualclassAppFooterPanel",{className:"Text_Limit_Exeed"})},Binary_Limit_Exeed(c){virtualclass.view.createErrorMsg(virtualclass.lang.getString("Binary_Limit_Exeed"),"errorContainer","virtualclassAppFooterPanel",{className:"Binary_Limit_Exeed"})},Unauthenticated(c){virtualclass.view.createErrorMsg(virtualclass.lang.getString("Unauthenticated"),
"errorContainer","virtualclassAppFooterPanel",{className:"Unauthenticated"});virtualclass.vutil.stopConnection()},Multiple_login(c){virtualclass.view.createErrorMsg(virtualclass.lang.getString("Multiple_login"),"errorContainer","virtualclassAppFooterPanel",{className:"Multiple_login"});virtualclass.vutil.stopConnection()},Max_rooms(c){virtualclass.view.createErrorMsg(virtualclass.lang.getString("Max_rooms"),"errorContainer","virtualclassAppFooterPanel",{className:"Max_rooms"})},Max_users(c){virtualclass.view.createErrorMsg(virtualclass.lang.getString("Max_users"),
"errorContainer","virtualclassAppFooterPanel",{className:"Max_users"})},PONG(c){virtualclass.network.latency=Date.now()-c.message;virtualclass.network.initToPing(1E3)},authentication_failed(c){virtualclass.chat.removeCookieUserInfo(c)},connectionclose(c){console.log("====> close connection message ",c.message);Object.prototype.hasOwnProperty.call(virtualclass,"recorder")&&virtualclass.recorder.startUpload||virtualclass.recorder.smallData&&Object.prototype.hasOwnProperty.call(virtualclass.recorder,
"rdlength")&&1E5>virtualclass.recorder.rdlength||virtualclass.popup.waitMsg();virtualclass.chat.makeUserListEmpty();c.message&&(c=1<=c.message.indexOf("c310")?virtualclass.lang.getString("connectionClosec310"):virtualclass.lang.getString("connectionClose",[c.message]),virtualclass.view.createErrorMsg(c,"errorContainer","virtualclassAppFooterPanel",{className:"connectionClose"}))},connectionopen(c){virtualclass.gObj.invalidlogin=!1;c=6E3;Object.prototype.hasOwnProperty.call(virtualclass.gObj,"doEndSession")&&
(c=1E4);setTimeout(()=>{if(!(virtualclass.vutil.sesionEndMsgBoxIsExisting()||Object.prototype.hasOwnProperty.call(virtualclass.gObj,"downloadProgress")||virtualclass.recorder.startUpload)){virtualclass.popup.closePopup();virtualclass.vutil.setDefaultScroll();const b=document.getElementById("popupContainer");null!=b&&(b.style.display="none")}},c)},binrec(c){var b=new Uint8Array(c.message);switch(b[0]){case 102:case 103:case 104:case 202:case 203:case 204:roles.hasControls()&&(virtualclass.gObj.studentSSstatus.mesharing=
!0,b=document.querySelector("#virtualclassCont"),""!==b&&(b.classList.add("studentScreenSharing"),document.querySelector("#chat_div").classList.add("studentScreenSharing")));Object.prototype.hasOwnProperty.call(virtualclass,"studentScreen")||(virtualclass.studentScreen=new studentScreen);roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing||virtualclass.studentScreen.ssProcess(c.message,"ss","ScreenShare");virtualclass.gObj.studentSSstatus.sharing&&roles.isStudent()&&(c=document.getElementById("virtualclassScreenShareLocal"),
virtualclass.gObj.studentSSstatus.shareToAll?null!=c&&(c.style.display="block"):null!=c&&(c.style.display="none"));break;case 11:virtualclass.media.video.process(c.message);break;case 21:processImage(c.message,b[1])}},getJoinUser(c,b){for(let a=0;a<c.length;a++)if(c[a].userid===b)return c[a]}};const receiveFunctions=new function(){this.pong=function(c){ioPingPong.pong(c)};this.pongAck=function(c){ioPingPong.pongAck(c)};this.control=function(c){if(roles.isStudent())virtualclass.user.control.onmessage(c);else roles.hasControls()&&(virtualclass.editorRich.collborateToolStatus=c.message.status)};this.eddata=function(c){if(Object.prototype.hasOwnProperty.call(c.message,"et"))if("editorRich"===c.message.et)virtualclass.editorRich.onmessage(c,"EditorRich");else virtualclass.editorCode.onmessage(c,
"EditorCode")};this.videoStop=function(){if(roles.isStudent()){const c=document.getElementById("videoHostContainer");null!==c&&c.classList.add("displayInterrupt")}};this.nEd=function(c){const b=document.getElementById("EditorRichwriteModeBox");null!=b&&("true"===b.dataset.writeMode?localStorage.removeItem("nEd"):(c.message.cf="control",virtualclass.user.control.onmessage(c)))};this.bt=function(){virtualclass.vutil.removeBecomeTeacherWidget()};this.tConn=function(c){setTimeout(()=>{virtualclass.vutil.setReadModeWhenTeacherIsConn("editorRich");
virtualclass.vutil.setReadModeWhenTeacherIsConn("editorCode")},2E3)};this.yts=function(c){if(c.fromUser.userid!==virtualclass.gObj.uid)virtualclass.yts.onmessage(c.message)};this.sad=function(c){c.message.sad?(c=virtualclass.user.control.updateUser(c.fromUser.userid,"ad",!0),virtualclass.user.control.audioSign(c,"create")):(c=virtualclass.user.control.updateUser(c.fromUser.userid,"ad",!1),virtualclass.user.control.audioSign(c,"remove"),c=document.getElementById(`${c.id}contrAudAnch`),null!=c&&c.setAttribute("data-title",
virtualclass.lang.getString("audioDisable")));return!0};this.settings=function(c){if(Object.prototype.hasOwnProperty.call(c.message,"Hex")){const b=virtualclass.vutil.UTCtoLocalTimeToSeconds(c.message.time);b>virtualclass.settings.currentTime&&(virtualclass.settings.onMessage(c.message.Hex,c.message.toUser),virtualclass.settings.currentTime=b)}};this.ena=function(c){};this.dia=function(c){};this.aEna=function(c){};this.aDia=function(c){};this.msg=function(c){messageUpdate(c)};this.sEnd=async function(){if(!virtualclass.isPlayMode){document.querySelector("#joinClassModal").style.display=
"none";const c=document.querySelector("#virtualclassCont #virtualclassApp");null!=c&&(c.style.display="flex");await virtualclass.config.endSession();virtualclass.popup.sesseionEndWindow();virtualclass.gObj.endSession=!0}};this.dispWhiteboard=function(c){virtualclass.makeAppReady({app:virtualclass.apps.wb,data:c.message.d})};this.ppt=function(c){Object.prototype.hasOwnProperty.call(c.message,"init")?virtualclass.makeAppReady({app:virtualclass.apps.sp}):("object"!==typeof virtualclass.sharePt&&(virtualclass.makeAppReady({app:virtualclass.apps.sp}),
virtualclass.sharePt.onmessage({pptMsg:c.message.ppt.init,cf:"ppt",user:"all",cfpt:"setUrl"})),virtualclass.sharePt.onmessage(c.message))};this.unshareScreen=function(c){virtualclass.gObj.studentSSstatus.shareToAll=!1;c=c.message.st;"object"===typeof virtualclass[c]&&(virtualclass[c].prevImageSlices=[],virtualclass[c].removeStream(),virtualclass.currApp=virtualclass.gObj.defaultApp)};this.videoSlice=function(c){virtualclass.media.playVideo(c.message.videoSlice)};this.videoByImage=function(){};this.chatPackResponsed=
function(c){c.message.byRequest===virtualclass.gObj.uid&&virtualclass.gObj.chat.displayMissedChats(c.message.chatPackResponsed)};this.clearAll=function(c){};this.ca=function(c){if("object"===typeof virtualclass.wb&&!roles.hasControls()&&virtualclass.wb[virtualclass.gObj.currWb])virtualclass.wbWrapper.cursor.onMessage(c.message)};this.wb=c=>{virtualclass.wbWrapper.msg.onMessage(c)};this.replayAll=function(c){virtualclass.wb[virtualclass.gObj.currWb].response.replayAll()};this.dts=function(c){if(Object.prototype.hasOwnProperty.call(c.message.dts,
"init"))virtualclass.gObj.screenRh=100,virtualclass.makeAppReady({app:"DocumentShare",data:c.message.dts}),virtualclass.gObj.screenRh=60;else if("object"===typeof virtualclass.dts)virtualclass.dts.onmessage(c)};this.poll=function(c){"init"===c.message.poll.pollMsg?virtualclass.makeAppReady({app:"Poll"}):("object"!==typeof virtualclass.poll&&(virtualclass.makeAppReady({app:"Poll"}),virtualclass.poll.onmessage({pollMsg:c.message.poll.init,cf:"poll",user:"all"})),virtualclass.poll.onmessage(c.message,
c.fromUser))};this.quiz=function(c){"init"===c.message.quiz.quizMsg?virtualclass.makeAppReady({app:"Quiz"}):("object"!==typeof virtualclass.quiz&&(virtualclass.makeAppReady({app:"Quiz"}),virtualclass.quiz.onmessage({quizMsg:c.message.quiz.init,cf:"quiz",user:"all"})),virtualclass.quiz.onmessage(c.message,c.fromUser))};this.videoUl=function(c){virtualclass.videoUl.onmessage(c.message)};this.congController=function(c){const b=c.message.congCtr.videoSwitch;if(c.fromUser.userid!==virtualclass.gObj.uid)virtualclass.videoHost.onmessage(b);
"off"===b?(virtualclass.vutil.addClass("virtualclassCont","videoff"),virtualclass.vutil.addClass("virtualclassAppRightPanel","hide"),virtualclass.vutil.removeClass("virtualclassAppRightPanel","show"),virtualclass.videoHost.setUserIcon(c.fromUser.userid)):(document.querySelector("#virtualclassCont").classList.remove("videoff"),virtualclass.vutil.addClass("virtualclassAppRightPanel","show"),virtualclass.vutil.removeClass("virtualclassAppRightPanel","hide"))};this.tsr=function(c){};this.na=function(c){virtualclass.user.control.iconAttrManupulate(c.fromUser.userid,
"icon-audioEnaOrange")};this.ya=function(c){virtualclass.user.control.iconAttrManupulate(c.fromUser.userid,"icon-audioEnaGreen")};this.mem_add=function(c){virtualclass.ioEventApi.member_added({type:"member_added",newJoinUser:c.message.user,cmadd:!0})};this.mvid=function(c){virtualclass.multiVideo.onmessage(c.message,c.fromUser.userid)};this.sc=function(c){virtualclass.pdfRender[virtualclass.gObj.currWb].setScrollPosition(c.message)};this.scf=function(c){console.dir(c.message);null!=virtualclass.gObj.currWb&&
virtualclass.pdfRender[virtualclass.gObj.currWb].setScrollPosition(c.message)};this.cwb=function(c){if(Object.prototype.hasOwnProperty.call(c.message,"diswb")){const {wid:b}=c.message;virtualclass.gObj.currWb=b;const a=b.split("_");0<a.length&&(virtualclass.gObj.currSlide=a[a.length-1]);virtualclass.gObj.currIndex=c.message.currIndex;virtualclass.wbCommon.whiteboardExist(virtualclass.gObj.currWb)?virtualclass.wbCommon.indexNav.updateNavigation():virtualclass.vutil.createWhiteBoard(virtualclass.gObj.currWb);
virtualclass.wbCommon.displaySlide(b)}else Object.prototype.hasOwnProperty.call(c.message,"wbCount")&&(virtualclass.gObj.wbCount=c.message.wbCount,virtualclass.gObj.currIndex=c.message.currIndex,virtualclass.wbCommon.indexNav.updateNavigation())};this.rearrangeWb=function(c){virtualclass.orderList.Whiteboard.overrideOrder(c.message.order);virtualclass.wbCommon.rearrange(virtualclass.orderList.Whiteboard.ol.order)};this.reqscreen=function(c){c.message.cancel?virtualclass.popup.closeElem():(virtualclass.gObj.studentSSstatus.receivedScreenShareRequest=
!0,"mobTab"===virtualclass.system.device||"Chrome"!==virtualclass.system.mybrowser.name&&"Firefox"!==virtualclass.system.mybrowser.name&&"Edge"!==virtualclass.system.mybrowser.name?virtualclass.vutil.beforeSend({ext:!0,cf:"colorIndicator",nosupport:!0}):(c=virtualclass.lang.getString("stdscreenshare"),virtualclass.gObj.precheckScrn&&virtualclass.vutil.prechkScrnShare(),virtualclass.gesture.closeContinueWindow(),virtualclass.popup.confirmInput(c,b=>{delete virtualclass.gObj.studentSSstatus.receivedScreenShareRequest;
b?(roles.isStudent()&&(virtualclass.gObj.studentSSstatus.mesharing=!0),virtualclass.makeAppReady({app:"ScreenShare",cusEvent:"byclick"})):virtualclass.vutil.beforeSend({sd:!0,cf:"colorIndicator"});virtualclass.media.readyAudioContext||(virtualclass.media.audio.initAudiocontext(),virtualclass.media.readyAudioContext=!0)})))};this.sshare_user=c=>{virtualclass.vutil.removeSSsharing();virtualclass.gObj.whoIsSharing=c.fromUser.userid;virtualclass.vutil.initssSharing(c.fromUser.userid)};this.sview=function(c){virtualclass.gObj.studentSSstatus.shareToAll=
!1;virtualclass.ss&&virtualclass.ss.selfView(c.message)};this.sToAll=function(){virtualclass.gObj.studentSSstatus.shareToAll=!0;virtualclass.gObj.studentSSstatus.sharing=!0;virtualclass.ss&&virtualclass.ss.shareToAll()};this.rmStdScreen=function(c){virtualclass.vutil.initDefaultApp();virtualclass.vutil.beforeSend({unshareScreen:!0,st:"ss",cf:"unshareScreen"});"object"===typeof virtualclass.ss?virtualclass.ss.clearScreenShare():virtualclass.vutil.removeSSsharing()};this.raiseHand=function(c){virtualclass.raiseHand.onMsgRec(c)};
this.colorIndicator=function(c){var b=c.message;c=c.fromUser.userid;b.sd?(b=chatContainerEvent.elementFromShadowDom(`#ml${c} .icon-stdscreenImg`),null!==b&&(b.setAttribute("data-dcolor","red"),b.parentNode.dataset.title=virtualclass.lang.getString("screensharedenied"))):(delete virtualclass.gObj.prvRequestScreenUser,b.ext&&(b=Object.prototype.hasOwnProperty.call(b,"nosupport")?"nosupport":"orange",c=chatContainerEvent.elementFromShadowDom(`#ml${c} .icon-stdscreenImg`),null!==c&&(c.setAttribute("data-dcolor",
b),"nosupport"===b&&(c.parentNode.dataset.title=virtualclass.lang.getString("screensharenotsupport")))))};this.stdVideoCtrl=function(c){c.fromUser.userid!==virtualclass.gObj.uid&&virtualclass.videoHost.stdVideoCtrlMsg(c)};this.toggleVideo=function(c){};this.destroyPlayer=function(c){if("Video"===virtualclass.currApp&&Object.prototype.hasOwnProperty.call(virtualclass,"videoUl")&&virtualclass.videoUl.videoUrl){virtualclass.videoUl&&virtualclass.videoUl.destroyPlayer();virtualclass.videoUl.videoUrl=
"";virtualclass.videoUl.videoId="";(c=document.getElementById("dispVideo_Youtube_api"))&&c.contentWindow&&c.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*");if(c=document.querySelector(".congrea #dispVideo"))c.style.display="none",(c=document.querySelector(".congrea #dispVideo video"))&&c.setAttribute("src","");(c=document.querySelector("#listvideo .playing"))&&c.classList.remove("playing");(c=document.querySelector("#listvideo .removeCtr"))&&c.classList.remove("removeCtr");
"object"===typeof virtualclass.videoUl.player&&delete virtualclass.videoUl.player}};this.sync=function(){};this.recs=function(c){if(virtualclass.isPlayMode)if(virtualclass.videoHost.gObj.videoSwitch)virtualclass.videoHost.onmessage("on");else virtualclass.videoHost.onmessage("off");else if(virtualclass.settings.info.attendeeAV)virtualclass.settings.onMessage(c.message);else if(roles.hasControls())virtualclass.settings.onMessage(c.message)};this.rawSyncData=function(c){virtualclass.serverData.onMessage(c.message)};
this.screenShareId=function(c){virtualclass.gObj.screenShareId=c.message.id};this.readyContext=function(){};this.liveStream=function(c){virtualclass.liveStream.onMessage(c)}};function Config(){}Config.prototype.sessionName=()=>{let c=localStorage.getItem("mySession");null===c&&(c=virtualclass.config.setSession());return c};Config.prototype.setSession=()=>{const c=localStorage.mySession;console.log("==== session 1, My session is created by setSession ",c," ",localStorage.mySession);virtualclass.config.setNewSession(c);return c};
Config.prototype.setNewSession=c=>{localStorage.setItem("mySession",c);virtualclass.gObj.currentSession=c;virtualclass.isPlayMode||(roles.hasControls()?(c=(new Date).getTime(),c=JSON.stringify({createdDate:c}),localStorage.setItem("myConfig",c)):(console.log("Invoke firebase operation"),virtualclass.userInteractivity.triggerInitFirebaseOperation("note")))};
Config.prototype.verifySession=async c=>{const {session:b}=c.message,a=localStorage.getItem("mySession");null!=a?a!==b&&"t"===c.fromUser.role&&await virtualclass.config.sessionDestroy(b,c):virtualclass.config.setNewSession(b)};Config.prototype.sessionDestroy=async(c,b)=>{virtualclass.isPlayMode?virtualclass.config.setNewSession("thisismyplaymode"):(b=b.fromUser.userid,localStorage.removeItem("mySession"),await virtualclass.config.endSession(),virtualclass.config.setNewSession(c),ioMissingPackets.validateAllVariables(b))};
Config.prototype.endSession=async function(c){delete virtualclass.connectedUsers;Object.prototype.hasOwnProperty.call(virtualclass.gObj,"memberUpdateDelayTimer")&&(clearTimeout(virtualclass.gObj.memberUpdateDelayTimer),virtualclass.gObj.memberlistpending.length=0,delete virtualclass.gObj.memberUpdateDelayTimer);Object.prototype.hasOwnProperty.call(virtualclass,"poll")&&""!==virtualclass.poll&&(virtualclass.poll.pollState={},virtualclass.poll.dataRec={});var b=document.getElementById("congrealogo");
null!=b&&b.classList.remove("disbaleOnmousedown");$("#chatroom_bt2").removeClass("ui-state-highlight");"object"===typeof virtualclass.videoUl&&Object.prototype.hasOwnProperty.call(virtualclass.videoUl,"player")&&"object"===typeof virtualclass.videoUl.player&&null!=virtualclass.videoUl.player.player_&&virtualclass.videoUl.destroyPlayer();null!=virtualclass.gObj.CDTimer&&clearInterval(virtualclass.gObj.CDTimer);b=document.querySelector(`#virtualclass${virtualclass.currApp}`);null!=b&&(b.style.display=
"none");Object.prototype.hasOwnProperty.call(virtualclass,"media")&&virtualclass.media.audio.muteButtonToogle();b=chatContainerEvent.elementFromShadowDom(".ui-memblist-usr","all");if(null!=b&&0<b.length)for(var a=0;a<b.length;a++)null!=b[a]&&b[a].parentNode.removeChild(b[a]);virtualclass.gObj.precheckScrn&&virtualclass.vutil.prechkScrnShare();virtualclass.gObj.audioEnable=roles.hasControls()?!0:virtualclass.gObj.stdaudioEnable;b=localStorage.getItem("precheck");null!=virtualclass.chat&&(delete virtualclass.chat.vmstorage,
virtualclass.chat.vmstorage={},virtualclass.chat.removeChatHighLight("chatrm"));virtualclass.recorder.items=[];virtualclass.recorder.totalSent=0;virtualclass.gObj.tempReplayObjs.length=0;virtualclass.wb="";delete virtualclass.gObj.currWb;virtualclass.gObj.studentSSstatus.mesharing=!1;virtualclass.removeSharingClass();virtualclass.gObj.studentSSstatus.shareToAll=!1;virtualclass.gObj.studentSSstatus.sharing=!1;delete virtualclass.gObj.whoIsSharing;null!=virtualclass.videoHost&&(virtualclass.videoHost.gObj.stdStopSmallVid=
!1,virtualclass.videoHost.gObj.allStdVideoOff=!1);virtualclass.gObj.wbTool={};Object.prototype.hasOwnProperty.call(virtualclass.recorder,"startUpload")&&delete virtualclass.recorder.startUpload;Object.prototype.hasOwnProperty.call(virtualclass.gObj,"downloadProgress")&&delete virtualclass.gObj.downloadProgress;c||("object"===typeof virtualclass.wb&&(alert("Clear all whiteboard"),virtualclass.wb[virtualclass.gObj.currWb].utility.t_clearallInit(),virtualclass.wb[virtualclass.gObj.currWb].utility.makeDefaultValue(void 0,
virtualclass.gObj.currWb),"object"===typeof virtualclass.wb[virtualclass.gObj.currWb].replay&&(virtualclass.wb[virtualclass.gObj.currWb].replay.rendering=!1)),null!=virtualclass.editorRich&&virtualclass.editorRich.removeEditorData(),virtualclass.pdfRender={});virtualclass.vutil.removeClass("audioWidget","fixed");await virtualclass.storage.clearStorageData();virtualclass.wbCommon.removeAllContainers();virtualclass.gObj.wbCount=0;virtualclass.gObj.currSlide=0;virtualclass.currApp=virtualclass.gObj.defaultApp;
Object.prototype.hasOwnProperty.call(virtualclass.gObj,"disableCamByUser")?virtualclass.user.control.audioDisable():virtualclass.user.control.audioWidgetEnable(!0);virtualclass.user.control.allChatEnable();virtualclass.user.control.resetmediaSetting();roles.isStudent()?(c=document.getElementById("videoHostContainer"),null!==c&&(c.style.display="none"),c=document.getElementById("virtualclassAppRightPanel"),null!==c&&c.classList.contains("vidShow")&&c.classList.remove("vidShow")):(c=document.getElementById("virtualclassSessionEndTool"),
null!==c&&(c.className=virtualclass.vutil.removeClassFromElement("virtualclassSessionEndTool","active")));"object"===typeof virtualclass.yts&&clearInterval(virtualclass.yts.tsc);"object"===typeof virtualclass.sharePt&&virtualclass.sharePt.UI.removeIframe();virtualclass.previous=`virtualclass${virtualclass.currApp}`;virtualclass.getContent=!1;virtualclass.recorder.storeDone=0;workerIO.postMessage({cmd:"sessionEndClose"});null!=b&&localStorage.setItem("precheck",JSON.parse(b));virtualclass.settings.user=
{};c=document.querySelector("#virtualclassWhiteboard");null!==c&&(c.style.display="none");c=document.querySelector("#virtualclassCont");null!==c&&c.classList.remove("loading");localStorage.clear();virtualclass.videoHost&&roles.isStudent()&&!virtualclass.isPlayMode&&(c=document.querySelector("#virtualclassAppRightPanel"),null===c||c.classList.contains("vidHide")||c.classList.add("vidHide"));virtualclass.enablePreCheck||virtualclass.popup.waitMsg();"object"===typeof virtualclass.dts&&null!=virtualclass.dts&&
virtualclass.dts.destroyDts();if("object"===typeof virtualclass.raiseHand&&null!=virtualclass.raiseHand)if(roles.hasControls()){if(virtualclass.raiseHand.rhCount=0,virtualclass.raiseHand.rhCountR=0,(c=document.querySelector(".congrea .vmchat_bar_button .hand_bt.highlight"))&&c.classList.remove("highlight"),c=document.querySelector(".congrea .vmchat_bar_button .hand_bt #notifyText"))c.innerHTML=""}else if(c=document.querySelector(".congrea .handRaise.disable"))c.classList.remove("disable"),c.classList.add("enable"),
c.setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdEnabled")),document.querySelector(".congrea .handRaise #icHr").setAttribute("data-action","enable"),virtualclass.raiseHand.stdRhEnable="enabled";if(null!==document.getElementById("chat_div")){(c=chatContainerEvent.elementFromShadowDom(".vmchat_room_bt.ui-state-highlight"))&&c.classList.remove("ui-state-highlight");(c=document.querySelector("#virtualclassCont.congrea.student"))&&c.classList.contains("videoff")&&c.classList.remove("videoff");
c=document.querySelector("#virtualclassCont #memlist");b=document.querySelector("#virtualclassCont #chatrm");a=document.querySelector("#user_list");const d=document.querySelector("#chatroom_bt2");c&&!c.classList.contains("enable")&&(c.classList.add("enable"),c.classList.remove("disable"),b&&(b.classList.add("disable"),b.classList.remove("enable")));null!==d&&(a.classList.contains("active")||a.classList.add("active"),d.classList.remove("active"));virtualclass.chat.removeCommonChatNodes()}virtualclass.wbCommon.order=
[0];virtualclass.gObj.wbCount=0;virtualclass.wbCommon.clearNavigation();"object"===typeof virtualclass.wb&&delete virtualclass.wb[virtualclass.gObj.currWb].toolColor;virtualclass.gObj.currIndex=1};class OrderedList{constructor(){this.ol={};this.ol.order=[];this.ol.list={}}insert(c,b,a){null!=a||0===a?this.ol.order.splice(a,0,c):this.ol.order.push(c);b&&(this.ol.list[c]=b)}remove(c){this.ol.order.splice(c,1)}removeByID(c){c=this.ol.order.indexOf(c);this.ol.order.splice(c,1)}getNext(c){c+=1;return{id:this.ol.order[c],data:this.ol.list[this.ol.order[c]]}}getPrevious(c){--c;return{id:this.ol.order[c],data:this.ol.list[this.ol.order[c]]}}getNextByID(c){c=this.ol.order.indexOf(c)+1;return{id:this.ol.order[c],
data:this.ol.list[this.ol.order[c]]}}getPreviousByID(c){c=this.ol.order.indexOf(c)-1;return{id:this.ol.order[c],data:this.ol.list[this.ol.order[c]]}}getOrder(){return this.ol.list.join(",")}loadOrder(c){this.ol.list=c.split(",")}setID(c,b){this.ol.list[c]=b}loadList(c){this.ol.list=c}reset(){this.ol={};this.ol.order.length=0;this.ol.list={}}overrideOrder(c){this.ol.order=c}getCurrentPosition(c){return this.ol.order.indexOf(c)}getCurrent(c){return this.ol.list[c]}emptyList(){console.log("====> Empty the list");
this.ol.order.length=0;delete this.ol.list;this.ol.list={}}};(function(c){function b(){}b.prototype.setBasicData=async function(a){a.earlierWidth=a.innerWidth;a.earlierHeight=a.innerHeight;a.wbUser=wbUser;a.pageEnter=(new Date).getTime();const b=new a.virtualclass;b.config=new Config;b.appData={};b.virtualclassIDBOpen=a.virtualclassOpenDB;a.virtualclass=b;b.gObj.displayError=1;b.lang={};b.lang.getString=a.getString;b.lang.message=a.message;"Unmute"===virtualclassSetting.audio_tooltip&&(virtualclassSetting.audio_tooltip=b.lang.getString("audioDisable"));b.gObj.mobileVchOffset=
vhCheck();b.settings=a.settings;b.ioEventApi=ioEventApi;b.user=new a.user;b.storage=a.storage;b.wbCommon=a.wbCommon;b.recorder=a.recorder;b.vutil=a.vutil;b.system=a.system;b.chat=new Chat;b.gObj.docs="init";await b.system.mediaDevices.getMediaDeviceInfo();wbUser.virtualclassPlay=+wbUser.virtualclassPlay;b.gObj.orginalUserId=wbUser.id;wbUser.virtualclassPlay&&(b.gObj.role="s",localStorage.removeItem("teacherId"),wbUser.rid=wbUser.id,wbUser.id=99955551230,b.gObj.uid=wbUser.id);b.popup=new PopUp({showOverlay:!0});
b.gObj.fromPageRefresh=!0;b.isMiniFileIncluded("wb.min")&&(b.gObj.displayError=0);2<a.virtualclass.error.length?a.virtualclass.error=[]:(b.gObj.memberlistpending=[],b.gObj.veryFirstJoin=!0,await b.storage.init())};b.prototype.validDateSession=async function(){let a=localStorage.getItem("prvUser");const b=localStorage.getItem("thisismyplaymode");virtualclass.gObj.myConfig=localStorage.getItem("myConfig");virtualclass.isPlayMode||null!==b&&"thisismyplaymode"===b?await virtualclass.config.endSession():
null!==a?(a=JSON.parse(a),a.id!==wbUser.id||a.room!==wbUser.room||wbUser.role!==a.role?await virtualclass.config.endSession():a.settings!==virtualclassSetting.settings?(virtualclass.gObj.refreshSession=!0,virtualclass.gObj.toBeSendSession=virtualclassSetting.settings,virtualclass.setPrvUser()):null!==virtualclass.gObj.myConfig&&await this.exceedSessionTime(),console.log("Previous user ",JSON.stringify(a))):null!==virtualclass.gObj.myConfig&&await this.exceedSessionTime()};b.prototype.exceedSessionTime=
async function(){config=JSON.parse(virtualclass.gObj.myConfig);const a=config.createdDate;108E5<(new Date).getTime()-a&&await virtualclass.config.endSession()};b.prototype.loadData=function(){let a;roles.hasControls()&&localStorage.setItem("uRole",virtualclass.gObj.uRole);null===localStorage.getItem("prvUser")&&virtualclass.setPrvUser();virtualclass.createMainContainer();var b=JSON.parse(localStorage.getItem("prevApp"));virtualclass.gObj.prevApp=b;if(null!=b){virtualclass.previousApp=b;var c=b.name;
c=c.charAt(0).toUpperCase()+c.slice(1);"Yts"===b.name||"DocumentShare"===b.name?null==b.metaData?a=null:(a=b.metaData,a.fromReload=!0):"Video"===b.name?null==b.metaData||null==b.metaData.init?a=null:(a=b.metaData,a.fromReload=!0):"Whiteboard"===b.name&&(null==wIds&&(virtualclass.gObj.wbCount=b.wbn),b=localStorage.getItem("currSlide"),null!=b&&(virtualclass.gObj.currSlide=b))}else c=virtualclass.gObj.defaultApp;"undefined"===typeof a&&(a=null);virtualclass.precheck=localStorage.getItem("precheck");
b=localStorage.getItem("precheck");null!=b&&(virtualclass.isPrecheck=JSON.parse(b));wbUser.virtualclassPlay?(virtualclass.isPrecheck=!1,virtualclass.enablePreCheck=!1):virtualclass.enablePreCheck=!0;!virtualclass.enablePreCheck||null!=virtualclass.isPrecheck&&virtualclass.isPrecheck?(virtualclass.makePreCheckAvailable=!1,virtualclass.popup.waitMsg("refresh")):virtualclass.makePreCheckAvailable=!0;virtualclass.appData.appIs=c;virtualclass.appData.videoObj=a};b.prototype.appInit=function(){virtualclass.settings.init();
virtualclass.init(wbUser.role,virtualclass.appData.appIs,virtualclass.appData.videoObj);if("Edge"===virtualclass.system.mybrowser.name){const a=document.getElementById("virtualclassCont");null!=a&&a.classList.add("edge")}virtualclass.gObj.testChatDiv=document.querySelector("#chat_div");virtualclass.gObj.testChatDiv.attachShadow({mode:"open"})};b.prototype.setUpMedia=function(){if(roles.isStudent()){const a=localStorage.getItem("audEnable");null!==a&&"false"===a.ac&&(virtualclass.user.control.mediaWidgetDisable(),
virtualclass.gObj.audioEnable=!1)}Object.prototype.hasOwnProperty.call(virtualclass.gObj,"audIntDisable")||Object.prototype.hasOwnProperty.call(virtualclass.gObj,"vidIntDisable")||virtualclass.media.init()};b.prototype.readyToGo=async function(){null!=virtualclass.isPrecheck&&("undefined"===typeof virtualclass.videoHost.gObj.MYSPEED&&(virtualclass.videoHost.gObj.MYSPEED=1),await virtualclass.videoHost.afterSessionJoin())};b.prototype.cache=async function(){virtualclass.config.makeWebSocketReady=!1;
await virtualclass.storage.getDataFromCacheAll();await virtualclass.storage.getDataFromCacheIn();await virtualclass.storage.getDataFromCacheOut();virtualclass.config.makeWebSocketReady=!0;null!==localStorage.getItem("precheck")&&virtualclass.makeReadySocket()};b.prototype.notifyAboutCPU=function(){const a=virtualclass.lang.getString("notcompatiblecpu"),b=virtualclass.lang.getString("notcompatibleram");virtualclass.system.isCompatibleCPU()||virtualclass.view.createErrorMsg(a,"errorContainer","virtualclassAppFooterPanel",
{className:"notcompatiblecpu"});virtualclass.system.isCompatibleRAM()||virtualclass.view.createErrorMsg(b,"errorContainer","virtualclassAppFooterPanel",{className:"notcompatiblecpu"})};c.Bootstrap=b})(window);class Note{constructor(){this.queue=[null];this.current=0;this.attachImmediateHandler=!1;this.attachFocusHandler={}}handleQueue(c){-1>=this.queue.indexOf(c)&&(this.queue[this.queue.length-1]=c)}triggerNavigate(c){"previous"===c?this.current&&--this.current:this.current<=this.queue.length&&(this.current+=1);c=this.queue[this.current];null==c&&(console.log("==== suman bogati ",this.queue[virtualclass.userInteractivity.currentContext]),c=virtualclass.userInteractivity.currentContext);virtualclass.userInteractivity.context[c]?
this.displayNoteBy(c):virtualclass.userInteractivity.engine.performWithQueue({component:"note",action:"renderer",type:"noteContainer",context:c});this.updateNavigateNumbers(c)}updateNavigateNumbers(c){var b=document.querySelector("#noteNavigation .notenumber .current");b&&(b.innerHTML=`${this.current+1} /`);document.querySelector("#noteNavigationContainer .clearAll").dataset.currentContext=c;if(c=document.querySelector("#noteNavigation .notenumber .total"))c.innerHTML=this.queue.length;c=document.querySelector("#noteNavigation .next");
b=document.querySelector("#noteNavigation .previous");0===this.current&&b.classList.add("deactive");0<this.current&&b.classList.remove("deactive");this.current+1===this.queue.length&&c.classList.add("deactive");this.current+1<this.queue.length&&c.classList.remove("deactive");console.log("Update ")}displayNoteBy(c){const b=document.querySelector("#noteContainer .context.active");b&&b.classList.remove("active");console.log("context ===> ",c,this.current);(c=document.querySelector(`#noteContainer .context[data-context~=${c}]`))&&
c.classList.add("active")}afterChangeContext(c){-1>=this.queue.indexOf(c)&&null!=this.queue[this.queue.length-1]&&this.queue.push(null);const b=this.queue.indexOf(c);this.current=-1!==b?b:this.queue.length-1;"note"===virtualclass.userInteractivity.getActiveTab()&&this.updateNavigateNumbers(c)}deleteElementFromQueue(c){console.log("====> clear context ",c);const b=this.queue.indexOf(c);-1<=b&&(b+1===this.queue.length?this.queue[b]=null:(this.queue.splice(b,1),0<this.queue.length?null!=this.queue[this.queue.length-
1]&&this.queue.push(null):this.queue[0]=null,this.current=this.queue.length-1,this.updateNavigateNumbers(c)))}renderNote(c){var b=document.querySelector(`#noteContainer .context[data-context="${c}"]`);if(null===b){b=virtualclass.getTemplate("note-content-area","askQuestion")({context:c});const a=document.querySelector("#noteContainer .container");null!=a&&a.insertAdjacentHTML("beforeEnd",b)}(b=document.querySelector("#noteContainer .context.active"))&&b.classList.remove("active");b=document.querySelector(`#noteContainer .context[data-context="${c}"]`);
b.classList.add("active");b=document.querySelector(`#noteContainer .context[data-context="${c}"] textarea.content`);this.attachFocusHandler[c]||(b.addEventListener("input",this.noteHandler.bind(this)),this.attachFocusHandler[c]=!0);c=document.getElementById("noteNavigationContainer");virtualclass.userInteractivity.note.attachImmediateHandler||(virtualclass.userInteractivity.note.attachImmediateHandler=!0,c.addEventListener("click",this.noteHandlerImmediate.bind(this)))}container(c){var b=c?c.context:
virtualclass.userInteractivity.currentContext;let a=document.getElementById("noteContainer");null==a&&(b=virtualclass.getTemplate("note","askQuestion")({context:b}),document.querySelector("#rightSubContainer").insertAdjacentHTML("beforeend",b));this.renderNote(c.context);(c=document.querySelector("#rightSubContainer .active"))&&c.classList.remove("active");a=document.getElementById("noteContainer");a.classList.add("active")}displayWithContent(c){let b=document.querySelector(`#noteContainer [data-context~=${c.context}] .content`);
b||(virtualclass.userInteractivity.engine.performWithPassData({component:"note",action:"renderer",type:"noteContainer",context:c.context}),b=document.querySelector(`#noteContainer [data-context~=${c.context}] .content`));b.value=c.content}noteHandlerImmediate(c){console.log("====> handler ",c.target.className);virtualclass.userInteractivity.handler(c)}noteHandler(c,b){b?this.handler(c):(this.noteEvent=c,this.sendToDatabaseTime&&clearTimeout(this.sendToDatabaseTime),this.sendToDatabaseTime=setTimeout(()=>
{virtualclass.userInteractivity.note.handleQueue(virtualclass.userInteractivity.currentContext);virtualclass.userInteractivity.handler(c);delete this.noteEvent},400))}};class Bookmark{afterChangeContext(c){var b=document.querySelector("#bookmark .container .bookmarks.active");b&&b.classList.remove("active");var a=document.querySelector(`#bookmark .bookmarks[data-context~=${c}]`);a?a.classList.add("active"):(b=document.querySelector("#bookmark .container"))&&!a&&(a=virtualclass.getTemplate("bookmark","askQuestion"),b.insertAdjacentHTML("beforeEnd",a({context:virtualclass.userInteractivity.currentContext})));virtualclass.userInteractivity.queue.bookmark[c]&&0<virtualclass.userInteractivity.queue.bookmark[c].length&&
virtualclass.userInteractivity.engine.perform(c,"bookmark")}async bookMarkHandler(c){virtualclass.userInteractivity.handler(c);const b=c.target.parentNode;1===+b.dataset.value?(b.dataset.value=0,c.target.dataset.title=virtualclass.lang.getString("addContext")):(b.dataset.value=1,c.target.dataset.title=virtualclass.lang.getString("removeContext"))}attachHandler(){document.getElementById("bookmark").addEventListener("click",this.bookMarkHandler)}updateOnPageRefresh(c){const b=document.querySelector(`#bookmark .bookmarks[data-context~=${c.context}]`);
if(b){const a=b.querySelector(".congtooltip");b.dataset.value=c.content;a.dataset.title=1===c.content?virtualclass.lang.getString("removeContext"):virtualclass.lang.getString("addContext")}}};class QuestionAnswer{elapsedComponentTime(c){const b=firebase.firestore.Timestamp.fromDate(new Date).seconds;c=c.componentId.split(`${c.component}-${virtualclass.gObj.orginalUserId}-`)[1];return Math.floor((b-+c)/60)}separatedContent(c){let b;if(128<c.content.length){var a=c.content.slice(0,128);b=c.content.slice(128,c.content.length)}else a=c.content;if("edit"===c.action||"cancel"===c.action){const d=document.querySelector(`#${c.componentId} .content p`),f=virtualclass.getTemplate("ellipsisText",
"askQuestion");d&&(d.innerHTML=a);128<c.content.length&&(a=f({morecontent:b}),document.querySelector(`#${c.componentId} .content p`).insertAdjacentHTML("beforeend",a));this.displayMore(c)}else if("create"===c.action)return c={content:a,moreContent:b}}displayMore(c){const b=document.querySelector(`#${"create"===c.action?c.id:c.componentId} .content p .btn`);128<c.content.length&&b&&b.classList.contains("close")&&(b.classList.remove("close"),b.classList.add("open"))}addHighLight(c){"question"!==c.component||
"create"!==c.action&&"edit"!==c.action||"question"===virtualclass.userInteractivity.getActiveTab()||this.addHighLightNewActual()}addHighLightNewActual(){document.getElementById("congAskQuestion").classList.add("highlight-new-question")}removeHighlight(){const c=document.getElementById("congAskQuestion");c.classList.contains("highlight-new-question")&&c.classList.remove("highlight-new-question")}viewAllQuestion(c){this.triggerPause();var b=document.getElementById("viewAllQuestion");c=c.currentTarget.dataset.viewall;
const a=document.getElementById("askQuestion");if(null!=a){const d=document.getElementById("virtualclassAppRightPanel"),f=document.querySelector("#askQuestion .container .current");f&&f.classList.remove("current");if("enable"===c){d&&d.classList.add("viewAllMode");a.classList.add("viewAll");b.dataset.viewall="disable";if(!this.viewAllTriggered)for(const a in virtualclass.userInteractivity.queue.question)this.context[a]||(this.context[a]=new QAcontext),this.triggerPerform(a);this.viewAllMode=this.viewAllTriggered=
!0}else virtualclass.userInteractivity.currentContext=virtualclass.userInteractivity.readyContextActual(),d&&d.classList.remove("viewAllMode"),a.classList.remove("viewAll"),b.dataset.viewall="enable",b=`#askQuestion .context[data-context~=${virtualclass.userInteractivity.currentContext}]`,(b=document.querySelector(b))&&b.classList.add("current"),this.viewAllMode=!1}}};class UserInteractivityEngine{performWithQueue(c){this.makeQueue(c);this.perform(c.context,"note"===c.component||"bookmark"===c.component?c.component:"question")}makeQueue(c){const b="note"===c.component||"bookmark"===c.component?c.component:"question";virtualclass.userInteractivity.queue[b][c.context]||(virtualclass.userInteractivity.queue[b][c.context]=[]);virtualclass.userInteractivity.queue[b][c.context].push(c)}perform(c,b){for(;virtualclass.userInteractivity.queue[b][c]&&0<virtualclass.userInteractivity.queue[b][c].length;){const a=
virtualclass.userInteractivity.queue[b][c].shift();"question"===a.component&&a.upvote&&1<a.upvote?virtualclass.userInteractivity.upvote.call(virtualclass.userInteractivity,a):"answer"===a.component&&a.upvote&&1<a.upvote?virtualclass.userInteractivity.upvote.call(virtualclass.userInteractivity,a):(virtualclass.userInteractivity[a.action].call(virtualclass.userInteractivity,a),console.log("=====> perform ",a))}}performWithPassData(c){virtualclass.userInteractivity[c.action].call(virtualclass.userInteractivity,
c)}};class UserInteractivityEvents{constructor(){this.values="edit delete upvote markAnswer moreControls reply navigation createInput save cancel more less clearall previous next moreControlsCloseTray".split(" ")}reply(c){virtualclass.userInteractivity.engine.performWithQueue({component:"question"===c.component||"answer"===c.component?"question"===c.component?"answer":"comment":c.component,action:"renderer",type:"input",context:virtualclass.userInteractivity.currentContext,componentId:c.componentId,parent:c.parentId})}edit(c){var b=
virtualclass.userInteractivity,a=b.context;if(+c.componentId.split("-")[1]===+virtualclass.gObj.orginalUserId||virtualclass.vutil.checkUserRole()){const d=virtualclass.userInteractivity.questionAnswer.elapsedComponentTime({componentId:c.componentId,component:c.component});if(!virtualclass.vutil.checkUserRole()&&(30<d||0<a[b.currentContext][c.component][c.componentId].children.length||0<a[b.currentContext][c.component][c.componentId].upvote)){if(b=virtualclass.lang.getString("askQuestionTimeExceed"),
virtualclass.view.createAskQuestionMsg(b,"msgContainer","loading"),c=document.querySelector(`#${c.componentId}`))c.classList.remove("editable"),c.classList.add("noneditable")}else(b=document.querySelector(`#${c.componentId} .footer`))&&b.classList.contains("show")&&(b.classList.remove("show"),b.classList.add("hide")),b=virtualclass.lang.getString("more"),b=document.querySelector(`#${c.componentId} .content p`).innerText.replace(b,""),(a=document.querySelector(`#${c.componentId} .content .morecontent`))?
(a=a.innerHTML,a=b+a):a=b,b=document.querySelector(`#${c.componentId} .content p`).dataset.component,c=virtualclass.userInteractivity.generateData({action:"renderer",type:"input",content:a,component:b,componentId:c.componentId,parent:null}),virtualclass.userInteractivity[c.action].call(virtualclass.userInteractivity,c)}}delete(c){var b=virtualclass.userInteractivity,a=b.context;if(+c.componentId.split("-")[1]===+virtualclass.gObj.orginalUserId||virtualclass.vutil.checkUserRole()){const d=b.questionAnswer.elapsedComponentTime({componentId:c.componentId,
component:c.component});if(!virtualclass.vutil.checkUserRole()&&(30<d||0<a[b.currentContext][c.component][c.componentId].children.length||0<a[b.currentContext][c.component][c.componentId].upvote)){if(b=virtualclass.lang.getString("askQuestionTimeExceed"),virtualclass.view.createAskQuestionMsg(b,"msgContainer","loading"),c=document.querySelector(`#${c.componentId}`))c.classList.remove("editable"),c.classList.add("noneditable")}else a=b.generateData({component:c.component,action:c.event,componentId:c.componentId,
parent:c.parentId}),"comment"===c.component&&(c.level=b.context[b.currentContext][c.component][c.componentId].level),b.send(a)}}upvote(c){var b=virtualclass.userInteractivity;const a=b.context,d=virtualclass.gObj.orginalUserId;"0"===document.querySelector(`#${c.componentId} .upVote .total`).innerHTML?(b=virtualclass.userInteractivity.generateData({component:c.component,action:c.event}),"question"!==c.component&&(b.parent=c.parentId),b.upvote=1,b.componentId=c.componentId,b.upvoteBy=[d],b.content=
virtualclass.userInteractivity.context[b.context][c.component][c.componentId].content,virtualclass.userInteractivity.send(b),virtualclass.userInteractivity.firstid=b.id):(a[b.currentContext][c.component][c.componentId].upvoteBy.push(d),b.firstid=a[b.currentContext][c.component][c.componentId].id,b.db.collection(b.collection).doc(b.firstid).update({upvote:firebase.firestore.FieldValue.increment(1),upvoteBy:a[b.currentContext][c.component][c.componentId].upvoteBy}),virtualclass.userInteractivity.upvote(c))}knowCommentLevel(c){let b=
null,a=1;for(;!b&&4>a;){const d=virtualclass.userInteractivity.context,f=virtualclass.userInteractivity.currentContext;d[f].comment[c]?(c=d[f].comment[c].parent,a+=1):b=!0}return a}save(c){if("note"===c.component){c=virtualclass.userInteractivity.generateData({component:c.component,content:c.text,type:"noteWithContent",action:c.action,uname:virtualclass.uInfo.userobj.name,componentId:c.componentId,parent:c.parentId,navigation:virtualclass.userInteractivity.note.queue});var b=document.querySelector("#noteNavigationContainer .clearAll").dataset.currentContext;
b&&(c.context=b);virtualclass.userInteractivity.send(c)}else if("bookmark"===c.component)c=virtualclass.userInteractivity.generateData({component:c.component,content:c.text,type:"bookmark",action:c.action,uname:virtualclass.uInfo.userobj.name,componentId:c.componentId,parent:c.parentId}),virtualclass.userInteractivity.send(c);else{c.componentId&&(b=document.querySelector(`#${c.componentId} .footer`))&&b.classList.contains("hide")&&(b.classList.remove("hide"),b.classList.add("show"));b=virtualclass.userInteractivity.generateData({component:c.component,
content:c.text,type:"contentBox",action:c.action,uname:virtualclass.uInfo.userobj.name,componentId:c.componentId,parent:c.parentId});"create"===c.action&&(b.componentId=b.id);if("edit"===c.action||"create"===c.action)"comment"===c.component?(c=this.knowCommentLevel(c.parentId),b.level=c):b.level=this.knowCommentLevel(c.componentId);this.trggerSend(b)}}async trggerSend(c){await virtualclass.userInteractivity.send(c);if(virtualclass.vutil.checkUserRole()&&"answer"===c.component){const b={event:"markAnswer",
component:"answer",componentId:c.componentId,parentId:c.parent,text:void 0,action:void 0};c.action="markAnswer";setTimeout(()=>{virtualclass.userInteractivity.event.execute(b)},1E3)}}moreControls(c){c=document.querySelector(`#${c.componentId} .moreControls .item`);c.classList.contains("close")?(c.classList.remove("close"),c.classList.add("open")):(c.classList.remove("open"),c.classList.add("close"))}moreControlsCloseTray(){const c=document.querySelector("#askQuestion .moreControls .item.open");c&&
(c.classList.remove("open"),c.classList.add("close"))}markAnswer(c){const b=document.querySelector(`#askQuestion #${c.parentId} .answers .answer[data-mark-answer="marked"]`),a=document.querySelector(`#askQuestion #${c.parentId} .answers .moreControls .mark`),d=virtualclass.lang.getString("markAnswerUnmark");b&&a&&"Unmark"===a.innerHTML&&a.parentNode.dataset.componentId!==c.componentId?virtualclass.view.createAskQuestionMsg(d,"msgContainer","loading"):(c=virtualclass.userInteractivity.generateData({component:c.component,
action:c.event,uname:virtualclass.uInfo.userobj.name,componentId:c.componentId,parent:c.parentId}),virtualclass.userInteractivity.send(c))}cancel(c){const b=virtualclass.userInteractivity,a=virtualclass.userInteractivity.context;if(c.componentId){var d=document.querySelector("#writeContent .text");d&&d.remove();(d=document.querySelector(`#${c.componentId} .footer`))&&d.classList.contains("hide")&&(d.classList.remove("hide"),d.classList.add("show"));b.questionAnswer.separatedContent({componentId:c.componentId,
content:a[b.currentContext][c.component][c.componentId].content,action:c.event})}else b.rendererObj.removeWriteContainer()}navigation(c){const b=document.querySelector(`#${c.componentId} .${"question"===c.component?"answers":"comments"}`);b.classList.contains("open")?(b.classList.remove("open"),b.classList.add("close")):(b.classList.remove("close"),b.classList.add("open"));document.querySelector(`#${c.componentId} .container`).scrollIntoView()}moreOrLess(c){const b=document.querySelector(`#${c.componentId} .morecontent`),
a="more"===c.event?"less":"more";c=document.querySelector(`#${c.componentId} .content .btn`);const d="more"===a?virtualclass.lang.getString("more"):virtualclass.lang.getString("less");c.innerHTML=d;c.dataset.event=a;b.classList.contains("close")?(b.classList.remove("close"),b.classList.add("open")):(b.classList.remove("open"),b.classList.add("close"));c.dataset.event===a&&(c.classList.remove("close"),c.classList.add("open"))}more(c){this.moreOrLess(c)}less(c){this.moreOrLess(c)}next(c){virtualclass.userInteractivity.note.triggerNavigate(c.event)}previous(c){virtualclass.userInteractivity.note.triggerNavigate(c.event)}execute(c){this[c.event].call(this,
c)}};class UserInteractivityRenderer{mainInterface(c){const b=virtualclass.userInteractivity;if(!c||"note"!==c.component){c=document.querySelector("#virtualclassCont.congrea #congAskQuestion");const a=virtualclass.getTemplate("askQuestionMain","askQuestion")({});document.querySelector("#rightSubContainer").insertAdjacentHTML("beforeend",a);virtualclass.vutil.checkUserRole()||(virtualclass.settings.qaAnswer(virtualclass.settings.info.qaAnswer),virtualclass.settings.qaComment(virtualclass.settings.info.qaComment),
virtualclass.settings.qaUpvote(virtualclass.settings.info.qaUpvote),virtualclass.settings.askQuestion(virtualclass.settings.info.askQuestion),virtualclass.settings.qaMarkNotes(virtualclass.settings.info.qaMarkNotes));c.addEventListener("click",a=>{b.initFirebaseOperatoin();b.renderMainContainer(a.currentTarget);b.questionAnswer.removeHighlight();this.reArrangeUpvoteCallback=()=>{b.rearrangeUpvoteDone||(b.triggerRearrangeUpvotedElem({context:b.currentContext,component:"question"}),b.triggerRearrangeUpvotedElem({context:b.currentContext,
component:"answer"}))};this.reArrangeUpvoteCallback()});(c=document.querySelector("#virtualclassCont.congrea .addQuestion-icon"))&&c.addEventListener("click",()=>{let a=document.getElementById("writeContent");a&&(a.childNodes[1].childNodes[0].click(),a=null);a||b.engine.performWithQueue({component:"question",action:"renderer",type:"input",context:b.currentContext})});document.getElementById("virtualclassnote").addEventListener("click",a=>{b.triggerInitFirebaseOperation("note");virtualclass.rightbar.handleDisplayBottomRightBar(a.currentTarget);
b.engine.performWithQueue({component:"note",action:"renderer",type:"noteContainer",context:b.currentContext});0<=b.note.queue.indexOf(b.currentContext).indexOf&&(b.note.current=b.note.queue.indexOf(b.currentContext));b.note.updateNavigateNumbers(b.currentContext)})}}input(c){console.log("=== input handle ",c.component);const b=virtualclass.userInteractivity;var a="question"===c.component?"#askQuestion":`#${null===c.componentId?c.parent:c.componentId}`;document.querySelector("#writeContent .text");
var d={componentId:c.componentId,component:c.component,parent:c.parent};d=virtualclass.getTemplate(c.type,"askQuestion")(d);"undefined"!==typeof c.content&&"undefined"!==typeof c.componentId?c.userId===virtualclass.gObj.orginalUserId&&(document.querySelector(`#${c.componentId} .content p`).innerHTML="",document.querySelector(`#${c.componentId} .content p`).insertAdjacentHTML("beforeend",d),a=document.querySelector("#writeContent .text"))&&(a.innerHTML=c.content,this.autosize({target:a})):"question"===
c.component?document.querySelector(a).insertAdjacentHTML("beforeend",d):(document.querySelector(`${a} .${c.component}s`).insertAdjacentHTML("beforebegin",d),a=document.querySelector(`#${c.parent}`).getBoundingClientRect(),0<=a.top&&0<=a.left&&a.right<=(window.innerWidth||document.documentElement.clientWidth)&&a.bottom<=(window.innerHeight||document.documentElement.clientHeight)||document.querySelector(`#${c.parent}`).scrollIntoView());a=document.querySelector("#writeContent");"question"===c.component&&
a&&"askQuestion"===a.parentNode.id&&a.addEventListener("click",b.handler.bind(b));a.addEventListener("input",b.userInputHandler.bind(this,c.component))}contentBox(c){var b=virtualclass.userInteractivity.questionAnswer.separatedContent(c),a=`#askQuestion [data-context~=${c.context}] .container`;if("question"===c.component)if(document.querySelector(`#askQuestion .context[data-context~=${c.context}]`))b=virtualclass.getTemplate(c.component,"askQuestion")({id:c.id,userName:c.uname,content:b.content,morecontent:b.moreContent}),
document.querySelector(a).insertAdjacentHTML("beforeend",b);else{var d=virtualclass.getTemplate("context","askQuestion")({context:c.context});document.querySelector("#askQuestion .container").insertAdjacentHTML("beforeend",d);d=virtualclass.getTemplate(c.component,"askQuestion");document.querySelector(a).insertAdjacentHTML("beforeend",d({id:c.id,userName:c.uname,content:b.content,morecontent:b.moreContent}));console.log("====> adding current ");document.querySelector(`#askQuestion [data-context~=${c.context}]`).classList.add("current")}else if("answer"===
c.component||"comment"===c.component)a=virtualclass.getTemplate(c.component,"askQuestion"),b={id:c.id,itemId:c.componentId,userName:c.uname,hasControl:virtualclass.vutil.checkUserRole(),content:b.content,morecontent:b.moreContent,parent:c.parent},b=a(b),"answer"===c.component?document.querySelector(`#${c.parent} .answers`).insertAdjacentHTML("beforeend",b):"comment"===c.component&&(a=document.querySelector(`#${c.parent} .comments`))&&a.insertAdjacentHTML("beforeend",b);virtualclass.userInteractivity.questionAnswer.displayMore(c);
document.querySelector(`#${c.componentId}`).scrollIntoView();+c.userId===+virtualclass.gObj.orginalUserId&&("note"===c.component?(this.renderNote(c.context),document.querySelector(`#noteContainer .context[data-context="${c.context}"] textarea.content`).value=c.content):"comment"!==c.component&&(document.querySelector(`#${c.id} .upVote`).dataset.upvote="upvoted"),b=document.querySelector(`#${c.componentId}`))&&(b.classList.add("mySelf"),30>virtualclass.userInteractivity.questionAnswer.elapsedComponentTime({componentId:c.componentId,
component:c.component})&&!virtualclass.vutil.checkUserRole()?b.classList.add("editable"):virtualclass.vutil.checkUserRole()&&b.classList.add("editable"));"question"===c.component&&(c=document.querySelector(`#${c.id}.question`))&&c.addEventListener("click",a=>{virtualclass.userInteractivity.handler(a)})}autosize(c){setTimeout(()=>{c.target.style.cssText="height:auto; padding:0";c.target.style.cssText=`height: ${c.target.scrollHeight}px`},1E3)}noteContainer(c){virtualclass.userInteractivity.note.container(c)}noteWithContent(c){virtualclass.userInteractivity.note.displayWithContent(c)}bookmark(c){virtualclass.userInteractivity.bookmark.updateOnPageRefresh(c)}removeWriteContainer(){const c=
document.querySelector("#writeContent");c&&c.remove()}};class UserInteractivityBasicOperation{generateData(c){const b=firebase.firestore.Timestamp.fromDate(new Date).seconds;c.id=`${c.component}-${virtualclass.gObj.orginalUserId}-${b}`;c.timestamp=b;c.context=virtualclass.userInteractivity.currentContext;c.userId=virtualclass.gObj.orginalUserId;return c}async send(c){virtualclass.userInteractivity.collection||(virtualclass.userInteractivity.setDbCollection(),virtualclass.userInteractivity.attachHandlerForRealTimeUpdate());"note"===c.component||"bookmark"===
c.component?await virtualclass.userInteractivity.db.collection(virtualclass.userInteractivity.collectionMark).doc(c.id).set(c).then(()=>{console.log("ask question write, Document successfully written! ",c)}).catch(b=>{console.error("ask question write, Error writing document: ",b)}):await virtualclass.userInteractivity.db.collection(virtualclass.userInteractivity.collection).doc(c.id).set(c).then(()=>{}).catch(()=>{})}handler(c){const b=virtualclass.userInteractivity;if("userInteractivity-content"!==
c.target.id){if("save"===c.target.dataset.event){var a=document.getElementById("userInteractivity-content");if(a)var d=a.value}(a=document.querySelector("#writeContent .cancel"))&&"userInteractivity-content"!==c.target.id&&""!==d&&a.click();(a=c.target.closest("div.context"))&&a.dataset&&(b.currentContext=c.target.closest("div.context").dataset.context);a=null;var f=c.target;if(this.event.values.includes(f.dataset.event)){var g=f.dataset.event;var k=f.parentNode}else this.event.values.includes(f.parentNode.dataset.event)?
(g=f.parentNode.dataset.event,k=f.parentNode.parentNode):this.event.values.includes(f.parentNode.parentNode.dataset.event)&&(g=f.parentNode.parentNode.dataset.event,k=f.parentNode.parentNode.parentNode);if(g){let m,n,r=null;c=k.dataset.component;let t=k.dataset.componentId;if(k.dataset.componentId&&"save"!==g)if(a=t,"reply"===g)a=null,r=t;else if("edit"===g||"markAnswer"===g||"delete"===g)r=k.dataset.parent?k.dataset.parent:null;if("save"===g){if("note"===c)m=f.value,n="create";else if("bookmark"===
c)m=0===+k.dataset.value?1:0,n="create";else{if(d)m=d;else if(null!=d){virtualclass.view.createAskQuestionMsg(virtualclass.lang.getString("enterText"),"msgContainer","loading");return}null===k.dataset.componentId||""===k.dataset.componentId?n="create":(n="edit",{componentId:a}=k.dataset,virtualclass.vutil.checkUserRole()||(d=b.context[b.currentContext][c][a].upvote,0!==d&&null!=d&&({componentId:a}=k.dataset,g="cancel",d=virtualclass.lang.getString("upvoted"),virtualclass.view.createAskQuestionMsg(d,
"msgContainer","loading"))))}r=k.dataset.parent?k.dataset.parent:null}else if("clearall"===g){k=document.querySelector("#noteNavigationContainer .clearAll");if(d=k.dataset.currentContext)d=k.dataset.currentContext;if(k=document.querySelector(`#noteContainer .context[data-context~=${d}] textarea`))m=k.value="",n="create",g="save"}else"upvote"===g&&(r=k.dataset.parent);this.event.execute({event:g,component:c,componentId:a,text:m,action:n,parentId:r});if("cancel"===g||"save"===g)this.inputGenerating=
!1,this.pollInputGeneratingTime&&clearTimeout(this.pollInputGeneratingTime),b.rendererObj.removeWriteContainer(),roles.isStudent()&&this.donotChangeContext&&this.donotChangeContext!==this.currentContext&&(this.triggerPerform(this.donotChangeContext),delete this.donotChangeContext)}}}userInputHandler(){roles.isStudent()&&(virtualclass.userInteractivity.inputGenerating=!0,this.pollInputGeneratingTime&&clearTimeout(this.pollInputGeneratingTime),this.pollInputGeneratingTime=setTimeout(()=>{virtualclass.userInteractivity.inputGenerating=
!1;virtualclass.userInteractivity.donotChangeContext&&(virtualclass.userInteractivity.triggerPerform(virtualclass.userInteractivity.donotChangeContext),delete virtualclass.userInteractivity.donotChangeContext,document.querySelector("#writeContent .cancel").click())},17E3));const c=document.querySelector("#writeContent .text");virtualclass.userInteractivity.rendererObj.autosize.call(this,{target:c})}renderer(c){this.rendererObj[c.type].call(this.rendererObj,c)}create(c){if(c.userId===virtualclass.gObj.orginalUserId){const b=
document.querySelector("#writeContent");b&&b.remove()}c.componentId=c.id;this.renderer(c);this.updateStatus(c,"editable")}delete(c){const b=document.querySelector(`#${c.componentId}`);b&&(b.remove(),this.updateStatus(c,"delete"))}deleteComponentVariableHelper(c){if("question"===c.component)this.deleteQuestionVariable(c.componentId);else if("answer"===c.component)this.deleteAnswerVariable(c.componentId);else if("comment"===c.component)this[`deleteCommentVariableLevel${c.level}`](c.componentId)}deleteQuestionVariable(c){const b=
virtualclass.userInteractivity.context,{currentContext:a}=virtualclass.userInteractivity,d=b[a].question[c].children;for(let a=0;a<d.length;a++)this.deleteAnswerVariable(d[a]);delete b[a].question[c]}deleteAnswerVariable(c){const b=virtualclass.userInteractivity.context,{currentContext:a}=virtualclass.userInteractivity,d=b[a].answer[c].children;for(let a=0;a<d.length;a++)this.deleteCommentVariableLevel1(d[a]);delete b[a].answer[c]}deleteCommentVariableLevel1(c){const b=virtualclass.userInteractivity.context,
{currentContext:a}=virtualclass.userInteractivity,d=b[a].comment[c].children;for(let a=0;a<d.length;a++)this.deleteCommentVariableLevel2(d[a]);delete b[a].comment[c]}deleteCommentVariableLevel2(c){const b=virtualclass.userInteractivity.context,{currentContext:a}=virtualclass.userInteractivity,d=b[a].comment[c].children;for(let a=0;a<d.length;a++)this.deleteCommentVariableLevel3(d[a]);delete b[a].comment[c]}deleteCommentVariableLevel3(c){const b=virtualclass.userInteractivity.context,{currentContext:a}=
virtualclass.userInteractivity,d=b[a].comment[c].children;for(let c=0;c<d.length;c++)delete b[a].comment[d[c]];delete b[a].comment[c]}updateStatus(c,b){const a=virtualclass.userInteractivity.context,{currentContext:d}=virtualclass.userInteractivity;if("delete"===b)this.updateCount(c,b),this.deleteComponentVariableHelper(c);else if("editable"===b||"edited"===b){var f=c;if("editable"===b){f.upvote=0;f.children=[];if("comment"===c.component&&3<=c.level){var g=document.querySelector(`#${c.componentId}`);
g&&(g.dataset.status="reachMaxLimit")}else"answer"===c.component&&(g=document.querySelector(`#askQuestion #${c.parent} .answers`),g.classList.contains("close")&&(g.classList.remove("close"),g.classList.add("open")));this.updateCount(c,b);virtualclass.vutil.attachWhiteboardPopupHandler()}else"edited"===b&&(f.children=a[d][c.component][c.componentId].children,f.content=c.content);f.status=b;a[d][c.component][c.componentId]=f}else if("upvote"===b){if("question"===c.component||"answer"===c.component)f=
a[d][c.component][c.componentId].children;f={id:c.id,content:c.content,children:f,status:b,parent:c.parent,componentId:c.componentId,upvote:c.upvote,upvoteBy:c.upvoteBy};f.status=b;a[d][c.component][c.componentId]=f}}updateCount(c,b){const a=virtualclass.userInteractivity;let d="answer"===c.component?"question":"answer";null!=c.parent&&"comment"===c.parent.split("-")[0]&&(d="comment");if(a.context[c.context]&&a.context[c.context][d]&&"question"!==c.component&&Object.prototype.hasOwnProperty.call(a.context[c.context][d],
c.parent)){var f=a.context[c.context][d][c.parent].children,g=document.querySelector(`#${c.parent}`),k=document.querySelector(`#${c.parent} .footer .navigation`);if("answer"===c.component||"comment"===c.component){if("editable"===b)f.push(c.componentId),!virtualclass.vutil.checkUserRole()&&g&&(g.classList.remove("editable"),g.classList.add("noneditable")),k&&k.classList.contains("disable")&&k.classList.remove("disable");else{f.splice(f.indexOf(c.componentId),1);b=c.parent.split("-")[1];var m=a.questionAnswer.elapsedComponentTime({componentId:c.parent,
component:d});const n=a.context[a.currentContext][d][c.parent].upvote,r=document.querySelector(`#${c.parent} .upVote .total`);(!virtualclass.vutil.checkUserRole()&&30>m&&r&&0===n||"comment"===d&&b===virtualclass.gObj.orginalUserId)&&0===f.length&&g&&(g.classList.remove("noneditable"),g.classList.add("editable"));0===f.length&&(k.classList.contains("disable")||k.classList.add("disable"));if("question"===d&&!virtualclass.vutil.checkUserRole())for(f=document.querySelectorAll(`#askQuestion #${c.parent} .answers .answer`),
g=0;g<f.length;g++)k=a.questionAnswer.elapsedComponentTime({componentId:c.componentId,component:"answer"}),b=a.context[a.currentContext].answer[c.componentId].upvote,m=a.context[c.context].answer[c.componentId].children,f[g].classList.contains("noneditable")&&0===b&&0===m.length&&30>k&&(f[g].classList.remove("noneditable"),f[g].classList.add("editable"));"answer"!==c.component||document.querySelector(`#askQuestion #${c.parent} .answers .answer[data-mark-answer="marked"]`)||(document.querySelector(`#${c.parent}`).dataset.markAnswer=
"")}if(f=document.querySelector(`#${c.parent} .navigation .total`))f.innerHTML=a.context[c.context][d][c.parent].children.length}}}edit(c){virtualclass.userInteractivity.questionAnswer.separatedContent(c);document.querySelector(`#${c.componentId} .lable`).innerHTML=`${c.component} (edited)`;const b=document.querySelector("#writeContent");b&&b.remove();this.updateStatus(c,"edited")}upvote(c){if(c.upvote){1===c.upvote&&(virtualclass.userInteractivity.firstid=c.id);document.querySelector(`#${c.componentId} .upVote .total`).innerHTML=
c.upvote;c.upvoteBy[c.upvoteBy.length-1]===virtualclass.gObj.orginalUserId?document.querySelector(`#${c.componentId} .upVote`).dataset.upvote="upvoted":-1<c.upvoteBy.indexOf(virtualclass.gObj.orginalUserId)&&(document.querySelector(`#${c.componentId} .upVote`).dataset.upvote="upvoted");if(!virtualclass.vutil.checkUserRole()){const b=document.querySelector(`#${c.componentId}`);b.classList.remove("editable");b.classList.add("noneditable")}this.updateStatus(c,"upvote");this.mostUpvotedOnTop(c)}else document.querySelector(`#${c.componentId} .upVote`).dataset.upvote=
"upvoted"}markAnswer(c){var b=`#askQuestion #${c.parent} .answers`,a=document.querySelector(`#${c.parent} .comments`),d=document.querySelector(`${b} .answer[data-mark-answer="marked"]`);const f=document.querySelector(`#${c.parent}`),g=document.querySelector(b),k=document.querySelector(`${b} #${c.componentId} .moreControls .mark`);b=document.querySelector(`${b} #${c.componentId}`);if(d&&f.dataset.markAnswer){if(d&&b&&"marked"!==b.dataset.markAnswer)return;delete d.dataset.markAnswer;delete f.dataset.markAnswer;
g.classList.contains("close")&&(g.classList.remove("close"),g.classList.add("open"));if(k){k.innerHTML="Mark As Answer";return}if(!k)return}else k&&"Mark As Answer"===k.innerHTML&&(k.innerHTML="Unmark");d=document.querySelector(`#${c.componentId}`);if(f&&d&&!f.dataset.markAnswer&&(d.dataset.markAnswer="marked",f.dataset.markAnswer="marked",g.classList.contains("open")&&(g.classList.remove("open"),g.classList.add("close")),a&&a.classList.contains("open")&&(a.classList.remove("open"),a.classList.add("close")),
g.insertBefore(d,g.firstChild),!virtualclass.vutil.checkUserRole()))for(c=document.querySelectorAll(`#askQuestion #${c.parent} .answers .answer`),a=0;a<c.length;a++)c[a].classList.contains("editable")&&c[a].classList.remove("editable"),c[a].classList.add("noneditable")}navigationHandler(c,b){}mostUpvotedOnTop(c){let b;const a=[],d=virtualclass.userInteractivity.context,f=c.context;"answer"===c.component&&(b=d[f].question[c.parent].children);for(const g in d[f][c.component])if("events"!==g&&"orderdByUpvoted"!==
g){const k={componentId:g,upvote:d[f][c.component][g].upvote};"answer"===c.component?-1!==b.indexOf(g)&&(k.parent=c.parent,a.push(k)):"question"===c.component&&a.push(k)}a.sort((a,b)=>b.upvote-a.upvote);d[f][c.component].orderdByUpvoted=a}triggerRearrangeUpvotedElem(c){let b;var a=virtualclass.userInteractivity.context;const d=c.context,f=document.createElement("div");f.className="question"===c.component?"container":"answers open";if(a[d][c.component].orderdByUpvoted){if("question"===c.component)for(let b=
0;b<a[d][c.component].orderdByUpvoted.length;b++){var g=`#${a[d][c.component].orderdByUpvoted[b].componentId}`;f.appendChild(document.querySelector(g))}else for(g=a[d][c.component].orderdByUpvoted,a=0;a<g.length;a++)b=g[a].parent,f.appendChild(document.querySelector(`#${g[a].componentId}`));g=`#askQuestion [data-context~=${d}] ${"question"===c.component?".container":`#${b} .answers`}`;c=document.querySelector(g);c.parentNode.replaceChild(f,c);this.rearrangeUpvoteDone=!0}}}
class QAcontext{constructor(){this.actions=[];this.question={};this.answer={};this.comment={};this.note={};this.bookmark={}}}
class UserInteractivity extends UserInteractivityBasicOperation{init(){this.initialize||(this.queue={},this.queue.note=[],this.queue.question=[],this.queue.bookmark=[],this.context={},this.initialize=this.firstRealTime=!0,this.allMarks={},this.note=new Note,this.event=new UserInteractivityEvents,this.engine=new UserInteractivityEngine,this.rendererObj=new UserInteractivityRenderer,this.rendererObj.mainInterface(),this.questionAnswer=new QuestionAnswer,this.bookmark=new Bookmark,this.attachHandler(),
this.inputGenerating=this.viewAllMode=!1)}attachHandler(){this.bookmark.attachHandler();virtualclass.isPlayMode&&document.getElementById("viewAllQuestion").addEventListener("click",this.questionAnswer.viewAllQuestion.bind(this))}async initFirebaseOperatoin(){if(!this.initFirebase){var c=document.getElementById("virtualclassCont");c&&c.classList.add("askQuestionFetching");this.initFirebase=!0;(c=await this.authenticate({apiKey:"AIzaSyDx4OisyZGmbcAx57s0zlwRlopPNNDqxSs",projectId:"vidyamantra-congrea"}))&&
Object.prototype.hasOwnProperty.call(c,"operationType")&&this.afterSignIn()}}makeReadyContext(){this.clearTimeMakeReady&&clearTimeout(this.clearTimeMakeReady);this.clearTimeMakeReady=setTimeout(()=>{virtualclass.vutil.checkUserRole()?this.displayContext():this.inputGenerating?this.donotChangeContext=this.readyContextActual():this.displayContext()},200)}getActiveTab(){return null!=document.querySelector("#congAskQuestion.active")?"question":null!=document.querySelector("#virtualclassnote.active")?
"note":!1}readyContextActual(){let c,b;switch(virtualclass.currApp){case "Whiteboard":case "DocumentShare":c=virtualclass.gObj.currWb;break;case "EditorRich":c="editor";break;case "SharePresentation":c=null;b=virtualclass.sharePt;b.currId&&b.state&&(c=`sharePt-${b.currId}_${b.state.indexv}_${b.state.indexh}`);break;case "Video":virtualclass.videoUl.videoId&&(c=`video-${virtualclass.videoUl.videoId}`);break;case "ScreenShare":virtualclass.gObj.screenShareId&&(c=virtualclass.gObj.screenShareId);break;
default:c=null}return c}displayContext(){this.rendererObj.removeWriteContainer();const c=this.readyContextActual();c!==this.currentContext&&c&&("question"!==this.getActiveTab()&&(this.queue.question[c]&&0<this.queue.question[c].length?this.questionAnswer.addHighLightNewActual():this.questionAnswer.removeHighlight()),this.triggerPerform(c),virtualclass.vutil.checkUserRole()&&ioAdapter.mustSend({cf:"readyContext",context:this.currentContext}))}triggerPerform(c){this.currentContext=c;this.triggerPerformActual(c)}async triggerPerformActual(c){var b=
document.getElementById("askQuestion");b&&(c?b.classList.add("readyContext"):b.classList.remove("readyContext"));b=document.querySelector("#askQuestion .container .current");const a=document.querySelector(`.context[data-context~=${this.currentContext}]`);a&&!a.classList.contains("current")&&a.classList.add("current");b&&b.classList.contains("current")&&b.classList.remove("current");c&&!this.context[c]&&(this.context[c]=new QAcontext);(b=this.getActiveTab())&&this.queue[b]&&this.queue[b][c]&&0<this.queue[b][c].length?
(await this.engine.perform(c,b),this.triggerRearrangeUpvotedElem({context:c,component:"question"}),this.triggerRearrangeUpvotedElem({context:c,component:"answer"}),"note"===b&&this.note.afterChangeContext(c)):"note"===b&&(this.engine.performWithQueue({component:"note",action:"renderer",type:"noteContainer",context:c}),this.note.afterChangeContext(c));this.bookmark.afterChangeContext(c)}async authenticate(c){firebase.initializeApp(c);this.db||(this.db=firebase.firestore());this.setDbCollection();if(c=
await virtualclass.xhrn.getAskQnAccess())return firebase.auth().signInWithCustomToken(c.data);this.db.firestore().enablePersistence().catch(function(b){});return!1}setDbCollection(){virtualclass.isPlayMode?(this.collection=`${wbUser.lkey}_${wbUser.session}_${wbUser.room}`,this.collectionMark=`${this.collection}_${virtualclass.gObj.orginalUserId}`):null!=localStorage.getItem("mySession")&&(this.collection=`${wbUser.lkey}_${localStorage.getItem("mySession")}_${wbUser.room}`,this.collectionMark=`${this.collection}_${virtualclass.gObj.orginalUserId}`)}buildAllMarksStatus(c){this.allMarks[c.context]||
(this.allMarks[c.context]={});"question"===c.component?"create"===c.action?(this.allMarks[c.context].question||(this.allMarks[c.context].question=[]),this.allMarks[c.context][c.component].push(c.componentId)):"delete"===c.action&&(this.allMarks[c.context][c.component]=this.allMarks[c.context][c.component].filter(b=>b!==c.componentId)):"note"===c.component?(this.allMarks[c.context][c.component]=!0,""!==c.content.trim()&&""!==c.content.trim()||delete this.allMarks[c.context][c.component]):"bookmark"===
c.component&&(this.allMarks[c.context][c.component]=!0,0===+c.content&&delete this.allMarks[c.context][c.component])}attachHandlerForRealTimeUpdate(){this.db.collection(this.collection).orderBy("timestamp","asc").onSnapshot(c=>{c.docChanges().forEach(b=>{const a=document.getElementById("askQuestion");if("added"===b.type||"modified"===b.type)b=b.doc.data(),a.classList.contains("active")&&(b.context===virtualclass.userInteractivity.currentContext||virtualclass.userInteractivity.viewAllMode)?(this.engine.performWithQueue(b),
virtualclass.isPlayMode&&"_doc_0_0"===b.context&&this.buildAllMarksStatus(b)):(this.engine.makeQueue(b),this.questionAnswer.addHighLight(b),virtualclass.isPlayMode&&this.buildAllMarksStatus(b))});this.firstRealTime&&((c=document.getElementById("virtualclassCont"))&&c.classList.remove("askQuestionFetching"),this.firstRealTime=!1,this.rendererObj.reArrangeUpvoteCallback&&this.rendererObj.reArrangeUpvoteCallback())},c=>{console.log("ask question real time ",c)})}async afterSignIn(){this.collection&&
await this.attachHandlerForRealTimeUpdate();virtualclass.isPlayMode&&(virtualclass.recorder.requestListOfFiles(),this.collectionMark&&this.loadInitialDataMark())}loadInitialDataMark(){if(this.collectionMark&&!this.initCollectionMark){var c=this;document.getElementById("virtualclassCont").classList.add("readyForNote");this.db.collection(this.collectionMark).get().then(b=>{c.initCollectionMark=!0;b.docs.forEach(a=>{a=a.data();"note"!==c.getActiveTab()&&"bookmark"!==a.component||c.currentContext!==a.context?
c.engine.makeQueue(a):c.engine.performWithQueue(a);virtualclass.isPlayMode&&this.buildAllMarksStatus(a);"note"===a.component&&(virtualclass.userInteractivity.note.queue=a.navigation,virtualclass.userInteractivity.note.afterChangeContext(virtualclass.userInteractivity.currentContext))})})}}async triggerInitFirebaseOperation(c){await this.initFirebaseOperatoin();this.initFirebase&&this.loadInitialDataMark();"note"===c&&((c=document.querySelector("#noteContainer .loading.active"))&&c.classList.remove("active"),
(c=document.querySelector("#noteContainer .contentContainer"))&&c.classList.add("active"))}renderMainContainer(c){virtualclass.rightbar.handleDisplayRightBar("#askQuestion");virtualclass.rightbar.handleDisplayBottomRightBar(c);this.queue.question[this.currentContext]&&0<this.queue.question[this.currentContext].length&&this.engine.perform(this.currentContext,"question")}getCurrentQuestions(){return this.context[virtualclass.userInteractivity.currentContext].question}triggerPause(){virtualclass.isPlayMode&&
virtualclass.recorder.playStart&&!virtualclass.recorder.controller.pause&&virtualclass.recorder.initRecPause()}};class Rightbar{handleRightBar(c){c?"open"===c?virtualclass.vutil.openRightbar():virtualclass.vutil.closedRightbar():document.getElementById("virtualclassApp").classList.contains("openRightbar")?virtualclass.vutil.closedRightbar():virtualclass.vutil.openRightbar();if("ScreenShare"===virtualclass.currApp){if(roles.isStudent()&&!virtualclass.gObj.studentSSstatus.mesharing||roles.isTeacher()&&virtualclass.gObj.studentSSstatus.mesharing)virtualclass.studentScreen.doOpposite=!0,virtualclass.studentScreen.triggerFitControl(),
virtualclass.ss.triggerFitToScreen()}else virtualclass.zoom.doOpposite=!0,virtualclass.zoom.triggerFitToScreen()}handleDisplayRightBar(c){const b=document.querySelectorAll("#rightSubContainer .rightContainer.active");for(let a=0;a<b.length;a++)b[a]&&b[a].classList.remove("active");(c=document.querySelector(c))&&c.classList.add("active");this.handleChatWidget()}handleChatWidget(){var c=document.getElementById("memlist");c&&(c.classList.remove("enable"),c.classList.contains("disable")||c.classList.add("disable"));
if(c=document.getElementById("congreaUserSearch"))c.style.display="none";(c=document.getElementById("chatrm"))&&c.classList.contains("enable")&&(c.classList.remove("enable"),c.classList.add("disable"));if(c=document.getElementById("ta_chrm2"))c.style.display="none"}handleDisplayBottomRightBar(c){var b=document.querySelector("#stickycontainer .bottomright.active");b&&b.classList.remove("active");c.classList.add("active");this.handlerHeader(c.dataset.headerid);b=document.getElementById("virtualclassAppRightPanel");
null!=b&&(b.dataset.currwindow=c.dataset.headerid)}handlerHeader(c){const b=document.querySelector("#rightBarHeader .active");b&&b.classList.remove("active");(c=document.querySelector(`#${c}`))&&c.classList.add("active")}};const backDection={backDetectValues:{frameLoaded:0,frameTry:0,frameTime:0,frameDetect:null,frameSrc:null,frameCallBack:null,frameThis:null,frameNavigator:window.navigator.userAgent,frameDelay:0,frameDataSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"},backDetect(c,b,a){this.backDetectValues.frameThis=document.querySelector(c);this.window=window;this.backDetectValues.frameCallBack=
b;null!==a&&(this.backDetectValues.frameDelay=a);let d="about:blank?loading";if(-1<this.backDetectValues.frameNavigator.indexOf("MSIE ")||-1<this.backDetectValues.frameNavigator.indexOf("Trident"))d=`${this.backDetectValues.frameDataSrc}?loading`;setTimeout(()=>{this.backDetectValues.frameThis.insertAdjacentHTML("beforeEnd",`<iframe src=${d} style='display:none;' id='backDetectFrame' onload='backDection.frameInit();'></iframe>`)},this.backDetectValues.frameDelay)},frameInit(){this.backDetectValues.frameDetect=
document.getElementById("backDetectFrame");2===this.backDetectValues.frameLoaded&&(this.backDetectValues.frameCallBack.call(this),this.window.history.go(-1));this.backDetectValues.frameLoaded+=1;1===this.backDetectValues.frameLoaded&&(this.backDetectValues.frameTime=setTimeout(()=>{backDection.setupFrames()},500))},setupFrames(){clearTimeout(this.backDetectValues.frameTime);this.backDetectValues.frameSrc=this.backDetectValues.frameDetect.src;1===this.backDetectValues.frameLoaded&&-1===this.backDetectValues.frameSrc.indexOf("historyLoaded")&&
(-1<this.backDetectValues.frameNavigator.indexOf("MSIE ")||-1<this.backDetectValues.frameNavigator.indexOf("Trident")?this.backDetectValues.frameDetect.src=`${this.backDetectValues.frameDataSrc}'?historyLoaded`:this.backDetectValues.frameDetect.src="about:blank?historyLoaded")}};class LiveStream{constructor(){this.mimeType="video/webm;codecs=vp8,opus";this.queue=[];this.MAX_TIME=999999999999;this.startedStream=!1;this.uploadEndPoint="https://stream.congrea.net";this.fileList=new OrderedList;this.streamQueue=[];this.sendFiles=[];this.bufferLength=2;this.listStream={};this.iOS=this.playByOgv=this.sharing=!1;this.resoluation={qga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},vga2:{width:{ideal:800},height:{ideal:600}},vga3:{width:{ideal:960},
height:{ideal:720}},vga4:{width:{ideal:1024},height:{ideal:768}},hd:{width:{ideal:1280},height:{ideal:720}},fullhd:{width:{ideal:1920},height:{ideal:1080}},fourk:{width:{ideal:4096},height:{ideal:2160}},eightk:{width:{ideal:7680},height:{ideal:4320}}};this.xhr=axios.create({responseType:"arraybuffer",withCredentials:!0});this.constraints={audio:{echoCancellation:{exact:!0}},video:this.resoluation.fullhd};this.constraints.video.frameRate={ideal:15}}init(){setTimeout(()=>{if(!document.querySelector("#networkStatusContainer.connecting-room")){const c=
document.getElementById("startLiveStream");null!=c&&c.classList.remove("disabled")}},1500);if(!this.alreadyInit){virtualclass.isPlayMode?this.prefixUrl=`${this.uploadEndPoint}/${wbUser.lkey}/${wbUser.room}/${wbUser.session}`:null!=localStorage.mySession?this.prefixUrl=`${this.uploadEndPoint}/${wbUser.lkey}/${wbUser.room}/${localStorage.mySession}`:virtualclass.gObj.currentSession&&(this.prefixUrl=`${this.uploadEndPoint}/${wbUser.lkey}/${wbUser.room}/${virtualclass.gObj.currentSession}`);if(!this.prefixUrl){setTimeout(()=>
{this.init()},1500);return}roles.hasControls()&&document.getElementById("startLiveStream").addEventListener("click",this.handlLiveStream.bind(this));this.alreadyInit=!0;const c=document.getElementById("virtualclassCont");null!=c&&c.classList.add("ogvPlayer")}"Safari"===virtualclass.system.mybrowser.name&&(this.playByOgv=!0);this.playByOgv&&!this.isScriptAlreadyIncluded("/virtualclass/build/ogv/ogv.js")&&virtualclass.vutil.loadFile("/virtualclass/build/ogv/ogv.js","js")}requestStream(c){c&&this.xhr.get(c).then(async b=>
{this.afterReceivedStream(b)}).catch(b=>{console.log("ERROR:- REQUEST URL ",b)})}getFileName(c){const b=c.lastIndexOf("/");return c.substring(b+1).replace(".chvs","")}duringPlayFirstPacket(){var c=document.getElementById("virtualclassVideo");c&&(c.dataset.currapp="liveStream");if(c=document.getElementById("messageLayoutVideo"))c.style.display="none"}afterReceivedStream(c){const b=c.data.slice(4,c.data.length);c=this.getFileName(c.config.url);this.listStream[c]=b;this.playIfReady(c)}onBuffer(c){this.sourceBuffer&&
this.sourceBuffer.appendBuffer(c)}readyParticipateVideo(){this.remoteVideo||(this.remoteVideo=document.getElementById("liveStream"),this.remoteVideo.srcObject=null,this.remoteVideo.currentTime=0)}initPLayerForParticipaes(){"undefined"!=typeof MediaSource&&(this.mediaSource=new MediaSource,this.mediaSource.addEventListener("sourceopen",this.mediaSourceOpen.bind(this)),this.readyParticipateVideo(),this.remoteVideo.src=URL.createObjectURL(this.mediaSource))}mediaSourceOpen(){"open"===this.mediaSource.readyState&&
(this.sourceBuffer=this.mediaSource.addSourceBuffer(this.mimeType),this.sourceBuffer.addEventListener("error",c=>{console.log(c)}),this.sourceBuffer.addEventListener("updateend",()=>{const c=this.fileList.getNextByID(virtualclass.liveStream.currentExecuted);c&&this.playIfReady(c.id)}))}handlLiveStream(c){"0"===c.currentTarget.dataset.sharinglivestream?this.startToShare():(this.stop(),c=document.querySelector("#dashboardnav button"),null!=c&&c.click())}disableLiveStreamButton(){const c=document.getElementById("startLiveStream");
null!=c&&c.classList.add("disabled")}async startToShare(){this.stopTraditionalVideo();document.getElementById("startLiveStream").dataset.sharinglivestream="1";let c=null;try{c=await navigator.mediaDevices.getUserMedia(this.constraints)}catch(b){this.disableLiveStreamButton(),virtualclass.media.handleUserMediaError(b)}c&&this.handleSuccess(c)}handleSuccess(c){var b=c.getVideoTracks()[0];const a=b.getSettings();console.dir("====> camera settings ",a);b=b.getSettings();console.log("Video constraints: media settings:",
JSON.stringify(b));b=c.getAudioTracks()[0].getSettings();console.log("Audio constraints: media settings: ",JSON.stringify(b));this.stream=c;virtualclass.dashboard.close();this.showLiveStreamHTML();document.getElementById("liveStream").srcObject=this.stream;this.startRecorder(a.width)}startRecorder(c){let b=25E4;640<c&&1920>=c?b=5E5:1920<c&&(b=1E6);console.log("current mode LIVE STREAM");console.log("video bit per second ",b);MediaRecorder.isTypeSupported(this.mimeType)||console.error(`${this.mimeType} is not supported`);
this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:this.mimeType,videoBitsPerSecond:b});this.mediaRecorder.addEventListener("stop",this.stopHandler.bind(this));this.mediaRecorder.addEventListener("dataavailable",this.handleLiveStreamData.bind(this));this.mediaRecorder.start(2E3)}stopHandler(){console.log("====STOP 1")}handleLiveStreamData(c){console.log("====> triggering data ");this.mediaRecorder&&"recording"===this.mediaRecorder.state&&this.saveToStreamServer(c.data)}async saveToStreamServer(c){c=
await this.videoTypedArray(c);ioAdapter.sendStream(c)}async videoTypedArray(c){c=await c.arrayBuffer();c=new Uint8Array(c);let b=new c.constructor(2);b[0]=72;b[1]=78;let a=new c.constructor(c.length+b.length);a.set(b,0);a.set(c,b.length);return a}stop(){document.getElementById("startLiveStream").dataset.sharinglivestream="0";this.mediaRecorder&&"inactive"!==this.mediaRecorder.state&&this.mediaRecorder.stop();this.hideLiveStreamHTML();this.disableLiveStreamButton();roles.hasControls()&&(ioAdapter.mustSend({cf:"liveStream",
stop:!0}),this.clearEveryThing());setTimeout(()=>{const c=document.getElementById("startLiveStream");null!=c&&c.classList.remove("disabled")},5E3)}stopTraditionalVideo(){Object.prototype.hasOwnProperty.call(virtualclass,"videoUl")&&Object.prototype.hasOwnProperty.call(virtualclass.videoUl,"player")&&virtualclass.videoUl.destroyPlayer();const c=document.getElementById("videoPlayerCont");c&&(c.style.display="none");roles.hasControls()&&ioAdapter.mustSend({cf:"liveStream",stopVideo:!0})}clearEveryThing(){console.log("Removed live stream");
delete virtualclass.gObj.videoMode;console.log("delete normal video");var c=document.getElementById("virtualclassVideo");null!=c&&(c.dataset.currapp="normalVideo",c=document.getElementById("messageLayoutVideo"))&&(c.style.display="block");this.stream&&this.stream.getTracks().forEach(b=>{b.stop()});this.mediaRecorder&&delete this.mediaRecorder;if(this.sourceBuffer){if(this.sourceBuffer.updating)this.sourceBuffer.abort(),console.log("Source buffer abort");else{try{this.sourceBuffer.remove(0,300)}catch(b){this.sourceBuffer.abort()}console.log("====> appended start: remove 3");
console.log("Source buffer remove")}delete this.sourceBuffer;delete this.mediaSource;delete this.startReadyFile}this.startedStream=!1;c=document.getElementById("liveStream");null!=c&&(c.src=null);delete this.firstFile;console.log("====> Empty the list 2a");delete this.startingPoint;delete this.startedAppending;this.fileList.emptyList();delete this.lastFileRequested;delete virtualclass.liveStream.callFromSeek;delete this.startFromPageRefresh;delete this.currentExecuted;console.log("====> appended start: remove 1");
this.playByOgv&&this.destroyOGVPlayer();roles.hasControls()&&virtualclass.media.audio.isProcessError&&(virtualclass.precheck.afterComplete(!0),delete virtualclass.media.audio.isProcessError)}showLiveStreamHTML(){document.getElementById("virtualclassVideo").dataset.currapp="liveStream"}hideLiveStreamHTML(){document.getElementById("virtualclassVideo").dataset.currapp="normalVideo"}isLiveStreamMode(){return"liveStream"===document.getElementById("virtualclassVideo").dataset.currapp}onMessage(c){c.message.fileName?
setTimeout(()=>{"Video"===virtualclass.currApp&&this.mediaRecorder&&"recording"===this.mediaRecorder.state&&ioAdapter.mustSend({cf:"liveStream",url:c.message.fileName})},3E3):c.message.stop?this.clearEveryThing():c.message.stopVideo?this.stopTraditionalVideo():c.message.url&&"Video"===virtualclass.currApp&&!Object.prototype.hasOwnProperty.call(virtualclass.gObj,"videoMode")&&roles.isStudent()&&(this.firstFile||(this.firstFile=c.message.url,console.log("This is first file ",this.firstFile)),this.lastFileRequested=
c.message.url,this.fileList.insert(c.message.url,`${this.prefixUrl}/${c.message.url}.chvs`),!this.startingPoint&&this.fileList.ol.order.length>=this.bufferLength&&this.readyStartingPoint(),this.insertTime&&(clearTimeout(this.insertTime),this.pageRefresh=!0),this.insertTime=setTimeout(()=>{this.pageRefresh?5>=this.fileList.ol.order.length?this.triggerStart(this.fileList.ol.order[0]):this.startFromPageRefresh||(this.startFromPageRefresh=!0,virtualclass.liveStream.callFromSeek||this.requestInitializePacket()):
this.triggerStart(c.message.url);this.insertTime=this.pageRefresh=!1},100))}requestInitializePacket(c){this.stopTraditionalVideo();this.initPLayerForParticipaes();this.xhrInitPacket||(this.xhrInitPacket=axios.create({responseType:"arraybuffer",headers:{"Content-Type":"application/json","x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room,get:{Accept:"video/webm;codecs=vp8,opus"}}}));let b;b=virtualclass.isPlayMode?wbUser.session:
null!=localStorage.mySession?localStorage.mySession:virtualclass.gObj.currentSession;this.requestInitializePacketFinal(c?`https://api.congrea.net/data/stream?session=${b}&file=${c}`:`https://api.congrea.net/data/stream?session=${b}`)}requestInitializePacketFinal(c){this.latesRequetInitUrl=c;this.xhrInitPacket.get(c).then(async b=>{this.latesRequetInitUrl===b.config.url&&(this.currentFile=b.headers["x-congrea-seg"].split(".chvs")[0],this.startedStream=!0,this.listStream[this.currentFile]=b.data,this.firstFile=
b.headers["x-congrea-seg"].split(".chvs")[0],delete this.startingPoint,this.readyStartingPoint())}).catch(b=>{console.log("ERROR:- REQUEST STARTING PACKET ",b)})}triggerStart(c){this.startedStream?this.startedStream&&0<this.fileList.ol.order.length&&(c=this.fileList.getNextByID(this.currentFile),this.requestStream(c.data),this.currentFile=c.id):(this.initPLayerForParticipaes(),this.requestStream(this.fileList.getCurrent(c)),this.currentFile=c,this.startedStream=!0)}isMyTurn(c){const b=this.fileList.getNextByID(this.currentExecuted);
console.log("is my turn curernt, next ",this.currentExecuted,b.id,c);return b.id===c}inStreamList(c){return this.listStream[c]?this.listStream[c]:!1}readyStartingPoint(){let c=this.firstFile;if(-1>=this.fileList.getCurrentPosition(c))console.log("NOT FOUND ON LIST");else{var b;if(1<this.bufferLength){for(let a=1;a<this.bufferLength;a++)if(b=this.fileList.getNextByID(c))c=b.id;c!==this.firstFile&&(this.startingPoint=c)}}}playIfReady(c){this.playByOgv?this.playIfReadyOGV(c):this.playIfReadyNormal(c)}playIfReadyNormal(c){var b=
this.inStreamList(c);if(this.startingPoint&&c===this.startingPoint&&this.inStreamList(this.firstFile)){b=this.inStreamList(this.firstFile);try{this.onBuffer(b),console.log("Actual append buffer ",this.firstFile),this.currentExecuted=this.firstFile,delete this.listStream[this.firstFile],this.startedAppending=!0,this.duringPlayFirstPacket(),this.startFromPageRefresh&&setTimeout(()=>{document.getElementById("liveStream").currentTime=this.MAX_TIME;console.log("REFRESH THE SCREEN")},virtualclass.isPlayMode?
700:1600)}catch(a){this.requestInitializePacket(c),console.log("====> Error handlling request packet")}}else if(this.startedAppending&&this.isMyTurn(c)&&b)try{this.onBuffer(b),console.log("Actual append buffer ",c),delete this.listStream[c],this.currentExecuted=c}catch(a){this.requestInitializePacket(c),console.log("====> Error handlling request packet")}}playIfReadyOGV(){if(!this.ogvPlayerReady&&this.inStreamList(this.firstFile)&&1<Object.keys(this.listStream).length&&1<virtualclass.liveStream.fileList.ol.order.length){this.readyOGVInstance();
this.ogvPlayerReady=!0;const c=this.inStreamList(this.firstFile);this.ogvPlayer._loadCodec(c,b=>{virtualclass.liveStream.afterLoadedCodec(b)})}}afterLoadedCodec(c){this.currentExecuted=this.firstFile;this.ogvPlayer._startProcessingVideo(c);console.log("Current executed file input ",this.currentExecuted);delete this.listStream[this.firstFile];this.startedAppending=!0;this.duringPlayFirstPacket();this.ogvPlayerLoadedMedia&&clearInterval(this.ogvPlayerLoadedMedia);this.ogvPlayerLoadedMedia=setInterval(()=>
{this.ogvPlayer&&this.ogvPlayer._codec&&this.ogvPlayer._codec.loadedAllMetadata&&(clearInterval(this.ogvPlayerLoadedMedia),virtualclass.system.mybrowser.iOS?virtualclass.popup.infoMsg(virtualclass.lang.getString("continueToLiveStream"),()=>{virtualclass.liveStream.ogvPlayer.play()}):this.ogvPlayer.play())},500)}destroyOGVPlayer(){this.ogvPlayer&&(this.ogvPlayer._stopPlayback(),this.ogvPlayer.stop());delete this.ogvPlayer;delete virtualclass.liveStream.listStream;virtualclass.liveStream.listStream=
{};delete this.ogvPlayerReady;const c=document.getElementById("ogvVideoContainer");null!=c&&c.parentNode.removeChild(c)}readyOGVInstance(){this.ogvPlayer=new OGVPlayer({forceWebGL:!0,debug:!1});const c=document.createElement("div");c.id="ogvVideoContainer";c.appendChild(this.ogvPlayer);document.getElementById("liveStreamCont").appendChild(c)}getChunkForOgvPlayer(){const c=this.fileList.getNextByID(this.currentExecuted);return c?(virtualclass.liveStream.tempFile=c.id,this.inStreamList(c.id)):!1}isScriptAlreadyIncluded(c){for(var b=
document.getElementsByTagName("script"),a=0;a<b.length;a++)if(b[a].getAttribute("src")==c)return!0;return!1}};$.uiBackCompat=!1;
(function(c){c.onload=async function(){const b=new c.Bootstrap;await b.setBasicData(c);await b.validDateSession();await b.loadData();await b.appInit();await b.setUpMedia();await b.readyToGo();await b.cache();virtualclass.serverData.syncComplete=!1;await virtualclass.serverData.syncAllData().then(()=>{"DocumentShare"===virtualclass.currApp&&virtualclass.dts?virtualclass.dts.updateScreen():"Video"===virtualclass.currApp&&"object"===typeof virtualclass.videoUl.UI.rawVideoList()?virtualclass.videoUl.UI.rawVideoList():"SharePresentation"===
virtualclass.currApp&&0<virtualclass.serverData.rawData.ppt.length&&virtualclass.sharePt.awsPresentationList(virtualclass.serverData.rawData.ppt);virtualclass.vutil.requestOrder(()=>{})});b.notifyAboutCPU();virtualclass.isPlayMode&&virtualclass.settings.triggerSettings()}})(window);null!==window.location.search&&""!==window.location.search&&document.querySelector("html").classList.add("pwaSupported");window.addEventListener("beforeinstallprompt",c=>{console.log("\ud83d\udc4d","beforeinstallprompt",c);c.preventDefault();window.deferredPrompt=c});
window.addEventListener("load",()=>{navigator.fullscreen?(console.log("Launched: pwa app from ios"),document.querySelector("html").classList.add("pwaRunning")):matchMedia("(display-mode: fullscreen)").matches?(console.log("Launched: pwa app from android"),document.querySelector("html").classList.add("pwaRunning")):console.log("Launched: Browser Tab");document.referrer.includes("net.vidyamantra.congrea")&&(document.querySelector("html").classList.add("twaRunning"),console.log("Launched: Android app"))});
//# sourceMappingURL=https://live.congrea.net/virtualclass/build/src/wb-map
