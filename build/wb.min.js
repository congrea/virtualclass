var roles={isTeacher:function(){return"t"===virtualclass.gObj.uRole},isStudent:function(){return"s"===virtualclass.gObj.uRole},isPresenter:function(){return"p"===virtualclass.gObj.uRole},isEducator:function(){return"e"===virtualclass.gObj.uRole},hasControls:function(){return"t"===virtualclass.gObj.uRole||"p"===virtualclass.gObj.uRole},hasAdmin:function(){return"t"===virtualclass.gObj.uRole||"e"===virtualclass.gObj.uRole},hasView:function(){return"s"===virtualclass.gObj.uRole||"e"===virtualclass.gObj.uRole}};var ioStorage={sendStore:function(c,a){var b;b=JSON.stringify({type:a,m:c,userto:null,user:virtualclass.uInfo.userobj});c.hasOwnProperty("sEnd")||c.hasOwnProperty("getMsPckt")||this.completeStorage(b)},dataBinaryStore:function(c){var a;"[object Int8Array]"==Object.prototype.toString.call(c)?a="a":"[object Uint8ClampedArray]"==Object.prototype.toString.call(c)&&(a="c");dtConWorker.postMessage({dt:a,msg:c});var b=this;dtConWorker.onmessage=function(a){b.completeStorage(a.data.msg,{type:a.data.dt})}},
dataAdapterStore:function(c,a){"object"==typeof virtualclass.storage&&"object"==typeof virtualclass.storage.db?virtualclass.storage.dataAdapterAllStore(JSON.stringify(c),a):setTimeout(function(){ioStorage.dataAdapterStore(c,a)},10)},dataUserAdapterMustData:function(c,a){"object"==typeof virtualclass.storage&&"object"==typeof virtualclass.storage.db?virtualclass.storage.dataUserAdapterAllStore(JSON.stringify(c),a):setTimeout(function(){ioStorage.dataUserAdapterMustData(c,a)},10)},dataExecutedStoreAll:function(c,
a){virtualclass.storage.dataExecutedStoreAll(JSON.stringify(c),a)},dataExecutedUserStoreAll:function(c,a){virtualclass.storage.dataExecutedUserStoreAll(JSON.stringify(c),a)},ioCompleteStorageInit:function(c){try{ioStorage.completeStorage(c)}catch(a){var b=this;setTimeout(function(){b.ioCompleteStorageInit(c)},10)}},completeStorage:function(c,a,b){if(!virtualclass.hasOwnProperty("getContent")||!0!=virtualclass.getContent){if("undefined"==typeof firstTime&&(referenceTime=window.pageEnter,firstTime=
!0,!virtualclass.vutil.isPlayMode())){try{var d=virtualclass.storage.db.transaction(["allData"],"readwrite")}catch(f){this.ioCompleteStorageInit(c);return}d=virtualclass.storage.db.transaction(["allData"],"readwrite");if("undefined"!=typeof d){var g=d.objectStore("allData");g.openCursor().onsuccess=function(a){(a=a.target.result)&&a.value.hasOwnProperty("recObjs")&&(a.value.hasOwnProperty("bd")?g.clear():JSON.parse(a.value.recObjs).hasOwnProperty("authuser")||g.clear())}}}var d=(new Date).getTime(),
h=d-referenceTime;"undefined"!=typeof b?virtualclass.storage.completeStorage(h,void 0,void 0,b):"undefined"==typeof a?virtualclass.storage.completeStorage(h,c):virtualclass.storage.completeStorage(h,c,a);referenceTime=d}}};var ioMissingPackets={executedStore:[],executedSerial:null!=localStorage.getItem("executedSerial")?JSON.parse(localStorage.getItem("executedSerial")):{},missRequest:[],aheadPackets:[],missRequestFlag:0,executedUserStore:[],executedUserSerial:null!=localStorage.getItem("executedUserSerial")?JSON.parse(localStorage.getItem("executedUserSerial")):{},missUserRequest:[],aheadUserPackets:[],missUserRequestFlag:0,validateAllVariables:function(c){if("undefined"==typeof this.executedSerial||null==this.executedSerial)this.executedSerial=
{};"undefined"==typeof this.executedSerial[c]&&(this.executedSerial[c]=-1);"undefined"==typeof this.missRequest[c]&&(this.missRequest[c]=0);"undefined"==typeof this.executedStore[c]&&(this.executedStore[c]=[]);"undefined"==typeof this.aheadPackets[c]&&(this.aheadPackets[c]=[])},validateAllUserVariables:function(c){if("undefined"==typeof this.executedUserSerial||null==this.executedUserSerial)this.executedUserSerial={};"undefined"==typeof this.executedUserSerial[c]&&(this.executedUserSerial[c]=-1);
"undefined"==typeof this.missUserRequest[c]&&(this.missUserRequest[c]=0);"undefined"==typeof this.executedUserStore[c]&&(this.executedUserStore[c]=[]);"undefined"==typeof this.aheadUserPackets[c]&&(this.aheadUserPackets[c]=[])},checkMissing:function(c){var a=c.user.userid;this.validateAllVariables(a);if(c.m.hasOwnProperty("ping")&&c.m.hasOwnProperty("session")){var b=localStorage.getItem("mySession");if(null!=b&&c.m.session!=b){virtualclass.isPlayMode?localStorage.setItem("mySession","thisismyplaymode"):
(localStorage.removeItem("mySession"),virtualclass.storage.config.endSession(),localStorage.setItem("mySession",c.m.session),console.log("REFRESH SESSION"));return}}1==c.m.missedpackets?this.fillExecutedStore(c):"undefined"!=typeof c.m.serial&&null!=c.m.serial?c.m.serial==this.executedSerial[a]+1?(console.log("UID "+a+" Object with Serial "+c.m.serial),this.executedSerial[a]=c.m.serial,this.executedStore[a][c.m.serial]=c,ioStorage.dataExecutedStoreAll(c,a+"_"+c.m.serial),this.onRecSave(c),io.onRecJson(c)):
c.m.serial>this.executedSerial[a]+1?(console.log("UID "+a+" requst miss packet"),this.requestMissedPackets(this.executedSerial[a]+1,c.m.serial,c,a)):(console.log("UID "+a+" no action current packet "+this.executedSerial[a]+" coming at "+c.m.serial),this.executedStore[a][c.m.serial]=c):console.log("UID "+a+" checkMissing should not be called without serial")},userCheckMissing:function(c){var a=c.user.userid;this.validateAllUserVariables(a);1==c.m.missedpackets?this.fillExecutedStore(c):"undefined"!=
typeof c.m.userSerial&&null!=c.m.userSerial?c.m.userSerial==this.executedUserSerial[a]+1?(console.log("UID "+a+" Object with userSerial "+c.m.userSerial),this.executedUserSerial[a]=c.m.userSerial,this.onRecSave(c),io.onRecJson(c),this.executedUserStore[a][c.m.userSerial]=c,ioStorage.dataExecutedStoreAll(c,a+"_"+c.m.userSerial)):c.m.userSerial>this.executedUserSerial[a]+1?(console.log("UID "+a+" requst miss packet"),this.userRequestMissedPackets(this.executedUserSerial[a]+1,c.m.userSerial,c,a)):(console.log("UID "+
a+" no action current packet "+this.executedUserSerial[a]+" coming at "+c.m.userSerial),this.executedUserStore[a][c.m.userSerial]=c):console.log("UID "+a+" checkMissing should not be called without userSerial")},requestMissedPackets:function(c,a,b,d){0>c&&(c=0);"use strict";0==this.missRequest[d]?(this.aheadPackets[d].unshift(b.m.serial),this.executedStore[d][b.m.serial]=b,a--,console.log("UID "+d+" request packet from "+c+" to "+a),this.waitAndResetmissRequest(d),ioAdapter.sendUser({reqMissPac:1,
from:c,till:a},d)):(console.log("UID "+d+" ahead packet"+b.m.serial),this.aheadPackets[d].unshift(b.m.serial),this.executedStore[d][b.m.serial]=b)},userRequestMissedPackets:function(c,a,b,d){0>c&&(c=0);"use strict";0==this.missUserRequest[d]?(this.aheadUserPackets[d].unshift(b.m.userSerial),this.executedUserStore[d][b.m.userSerial]=b,a--,console.log("UID "+d+" User request packet from "+c+" to "+a),this.userWaitAndResetmissUserRequest(d),ioAdapter.sendUser({userReqMissPac:1,from:c,till:a},d)):(console.log("UID "+
d+" User ahead packet"+b.m.userSerial),this.aheadUserPackets[d].unshift(b.m.userSerial),this.executedUserStore[d][b.m.userSerial]=b)},waitAndResetmissRequest:function(c){ioMissingPackets.missRequest[c]=1;ioMissingPackets.missRequestFlag=1;setTimeout(function(){ioMissingPackets.missRequest[c]=0;ioMissingPackets.missRequestFlag=0},15E3)},userWaitAndResetmissUserRequest:function(c){ioMissingPackets.missUserRequest[c]=1;ioMissingPackets.missUserRequestFlag=1;setTimeout(function(){ioMissingPackets.missUserRequest[c]=
0;ioMissingPackets.missUserRequestFlag=0},15E3)},sendMissedPackets:function(c){var a=c.user.userid;this.validateAllVariables(a);var b=c.m.from;0>b&&(b=0);b=ioAdapter.adapterMustData.slice(b,c.m.till+1);ioAdapter.sendUser({missedpackets:1,data:b},c.user.userid);console.log("UID "+a+" send packet total chunk length "+b.length)},userSendMissedPackets:function(c){var a=c.user.userid;this.validateAllUserVariables(a);var b=c.m.from;0>b&&(b=0);b=ioAdapter.userAdapterMustData[a].slice(b,c.m.till+1);ioAdapter.sendUser({userMissedpackets:1,
data:b},c.user.userid);console.log("UID "+a+" send packet total chunk length "+b.length)},fillExecutedStore:function(c){var a=c.user.userid;this.validateAllVariables(a);0<c.m.data.length?console.log("UID "+a+" received packet from "+c.m.data[0].m.serial+" to "+c.m.data[c.m.data.length-1].m.serial):console.log("UID "+a+" empty data object");var b=c.m.data.length,d;for(d=0;d<b;d++)if(null!=c.m.data[d])if("undefined"!=typeof c.m.data[d].m.serial&&null!=c.m.data[d].m.serial){this.executedSerial[a]=c.m.data[d].m.serial;
ioStorage.dataExecutedStoreAll(c.m.data[d],a+"_"+c.m.data[d].m.serial);this.onRecSave(c.m.data[d]);c.m.data[d].user=c.user;this.executedStore[a][c.m.data[d].m.serial]=c.m.data[d];try{if(console.log("UID "+a+" Object with Serial "+c.m.data[d].m.serial),!c.m.data[d].m.hasOwnProperty("receiver"))io.onRecJson(c.m.data[d])}catch(f){console.log("Error "+f)}}else console.log("UID "+a+" Received Packed missing serial");for(this.aheadPackets[a]=this.aheadPackets[a].sort(function(a,d){return d-a});c=this.aheadPackets[a].pop();)if("undefined"!=
typeof c&&null!=c)if("undefined"!=typeof this.executedStore[a][c])this.executedSerial[a]=c,this.onRecSave(this.executedStore[a][c]),console.log("UID "+a+" Object with Serial "+this.executedStore[a][c].m.serial),ioStorage.dataExecutedStoreAll(this.executedStore[a][c],a+"_"+this.executedStore[a][c].m.serial),io.onRecJson(this.executedStore[a][c]);else{console.log("fillExecutedStore undefined");return}else console.log("UID "+a+" ahead Packed missing serial");this.missRequest[a]=0;ioMissingPackets.missRequestFlag=
0},userFillExecutedStore:function(c){var a=c.user.userid;this.validateAllUserVariables(a);0<c.m.data.length?console.log("UID "+a+" received user packet from "+c.m.data[0].m.userSerial+" to "+c.m.data[c.m.data.length-1].m.userSerial):console.log("UID "+a+" empty user data object");var b=c.m.data.length,d;for(d=0;d<b;d++)if(null!=c.m.data[d])if("undefined"!=typeof c.m.data[d].m.userSerial&&null!=c.m.data[d].m.userSerial){this.executedUserSerial[a]=c.m.data[d].m.userSerial;ioStorage.dataExecutedUserStoreAll(c.m.data[d],
a+"_"+c.m.data[d].m.userSerial,c.m.data[d].m.userSerial);this.onRecSave(c.m.data[d]);c.m.data[d].user=c.user;c.m.data[d].userto=c.userto;try{console.log("UID "+a+" Object with user Serial "+c.m.data[d].m.userSerial),io.onRecJson(c.m.data[d])}catch(f){console.log("Error "+f)}this.executedUserStore[a][c.m.data[d].m.userSerial]=c.m.data[d]}else console.log("UID "+a+" Received Packed missing User serial");for(this.aheadUserPackets[a]=this.aheadUserPackets[a].sort(function(a,d){return d-a});c=this.aheadUserPackets[a].pop();)"undefined"!=
typeof c&&null!=c?(this.executedUserSerial[a]=c,this.onRecSave(this.executedUserStore[a][c]),console.log("UID "+a+" Object with Serial "+this.executedUserStore[a][c].m.userSerial),io.onRecJson(this.executedUserStore[a][c])):console.log("UID "+a+" ahead Packed missing serial");this.missUserRequest[a]=0;ioMissingPackets.missUserRequestFlag=0},onRecSave:function(c){var a=JSON.stringify(c);io.onRecSave(c,a)}};var ioAdapter={adapterMustData:[],serial:-1,userSerial:[],userAdapterMustData:[],validateAllVariables:function(c){if("undefined"==typeof this.userSerial||null==this.userSerial)this.userSerial=[];"undefined"==typeof this.userSerial[c]&&(this.userSerial[c]=-1);if("undefined"==typeof this.userAdapterMustData||null==this.userAdapterMustData)this.userAdapterMustData=[];"undefined"==typeof this.userAdapterMustData[c]&&(this.userAdapterMustData[c]=[])},mustSend:function(c){this.serial++;console.log("s.n "+
this.serial);c.serial=this.serial;this.adapterMustData[this.serial]={type:"broadcast",m:c};this.send(c);ioStorage.dataAdapterStore({type:"broadcast",user:wbUser.id,m:c},this.serial)},send:function(c){io.send(c,"broadcastToAll",null);ioStorage.sendStore(c,"broadcastToAll")},mustSendAll:function(c){this.mustSendUser(c,virtualclass.gObj.uid);this.mustSend(c)},sendAll:function(c){io.send(c,"broadcast",null)},mustSendUser:function(c,a){this.validateAllVariables(a);"undefined"!=typeof c.serial&&c.serial&&
(c.serial=null);this.userSerial[a]++;console.log("USER s.n "+this.userSerial[a]+" user "+a);c.userSerial=this.userSerial[a];this.userAdapterMustData[a][c.userSerial]={type:"broadcastToAll",m:c};this.sendUser(c,a);ioStorage.dataUserAdapterMustData({type:"broadcastToAll",user:wbUser.id,m:c},a+"_"+c.userSerial)},sendUser:function(c,a){io.send(c,"broadcastToAll",a)},sendBinary:function(c){io.sendBinary(c);ioStorage.dataBinaryStore(c)}};var ioPingPong={ping:function(c){if("member_added"==c.type&&roles.hasAdmin()){var a={ping:"ping",cf:"pong",session:this.sessionName()};if(virtualclass.gObj.uid!=virtualclass.jId)ioAdapter.mustSendUser(a,virtualclass.jId),console.log("PING TO "+virtualclass.jId);else for(var b=0;b<c.message.length;b++)c.message[b].userid!=virtualclass.gObj.uid&&(ioAdapter.mustSendUser(a,c.message[b].userid),console.log("PING TO "+c.message[b].userid));ioAdapter.mustSend(a);console.log("PING BROADCAST")}},pong:function(c){c.toUser?
(console.log("PONG TO "+c.toUser.userid+" from "+c.fromUser.userid),ioAdapter.mustSendUser({ping:"pong",cf:"pongAck"},c.fromUser.userid),console.log("PONG ACK TO "+c.fromUser.userid)):(console.log("PONG BROADCAST from "+c.fromUser.userid),this.verifySession(c))},pongAck:function(c){console.log("PONG ACK FROM "+c.fromUser.userid)},sessionName:function(){var c=localStorage.getItem("mySession");null===c&&(c=this.setSession());return c},setSession:function(){var c=randomString(32);localStorage.setItem("mySession",
c);return c},verifySession:function(c){var a=c.message.session,b=localStorage.getItem("mySession");null!=b?b!==a&&this.sessionDestroy(a,c):localStorage.setItem("mySession",a)},sessionDestroy:function(c,a){if(virtualclass.isPlayMode)localStorage.setItem("mySession","thisismyplaymode");else{var b=a.fromUser.userid;localStorage.removeItem("mySession");virtualclass.storage.config.endSession();localStorage.setItem("mySession",c);ioMissingPackets.validateAllVariables(b);console.log("REFRESH SESSION")}}};(function(c){c.virtualclass=function(){return{isPlayMode:""!=wbUser.virtualclassPlay?parseInt(wbUser.virtualclassPlay,10):0,apps:["Whiteboard","ScreenShare","Yts","EditorRich","EditorCode"],appSessionEnd:"virtualclassSessionEnd",appAudioTest:"virtualclassAudioTest",rWidgetConfig:{id:"audioWidget"},wb:"",ss:"",wss:"",rw:"",lang:{},error:[],gObj:{uid:c.wbUser.id,uRole:c.wbUser.role,uName:c.wbUser.name,tempReplayObjs:[],alreadyReplayFromStorage:!1,commandToolsWrapperId:"commandToolsWrapper",editorInitDone:0,
resize:!1},clearSession:function(){c.pageEnter=(new Date).getTime();virtualclass.vutil.beforeSend({sEnd:!0,cf:"sEnd"},null,!0);virtualclass.storage.config.endSession();virtualclass.hasOwnProperty("prevScreen")&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&virtualclass.prevScreen.unShareScreen();virtualclass.previrtualclass="virtualclassEditorRich"},init:function(a,b,d){a=c.wbUser;virtualclass.uInfo={userid:a.id,sid:a.sid,rid:a.path,authuser:a.auth_user,authpass:a.auth_pass,userobj:{userid:a.id,
name:a.name,lname:a.lname,img:a.imageurl,role:null!=localStorage.getItem("uRole")?localStorage.getItem("uRole"):a.role},room:a.room};this.wbConfig={id:"virtualclass"+this.apps[0],classes:"appOptions"};this.ssConfig={id:"virtualclass"+this.apps[1],classes:"appOptions"};this.ytsConfig={id:"virtualclass"+this.apps[2],classes:"appOptions"};this.edConfig={id:"virtualclass"+this.apps[3],classes:"appOptions"};this.edCodeConfig={id:"virtualclass"+this.apps[4],classes:"appOptions"};this.user=new c.user;this.lang.getString=
c.getString;this.lang.message=c.message;this.vutil=c.vutil;this.media=c.media;this.system=c.system;this.recorder=c.recorder;this.converter=c.converter;this.clear="";this.currApp=this.vutil.capitalizeFirstLetter(b);this.storage=c.storage;this.storage.init(function(){virtualclass.vutil.isPlayMode()||ioStorage.completeStorage(JSON.stringify(virtualclass.uInfo))});this.dirtyCorner=c.dirtyCorner;this.html.init(this);this.adapter=c.adapter;virtualclass.chat=new Chat;virtualclass.chat.init();virtualclass.vutil.initOnBeforeUnload(virtualclass.system.mybrowser.name);
virtualclass.xhr=c.xhr;virtualclass.xhr.init();virtualclass.dtCon=virtualclass.converter();virtualclass.pbar=progressBar;virtualclass.editorRich=c.editor("editorRich","virtualclassEditorRich","virtualclassEditorRichBody");virtualclass.editorCode=c.editor("editorCode","virtualclassEditorCode","virtualclassEditorCodeBody");virtualclass.yts=c.yts();null!=localStorage.uRole&&(virtualclass.gObj.uRole=localStorage.uRole,document.getElementById("virtualclassCont").classList.add(virtualclass.vutil.getClassName(virtualclass.gObj.uRole)));
"undefined"==typeof d||null==d?this.makeAppReady(b,"byclick"):this.makeAppReady(b,"byclick",d);this.system.check();this.vutil.isSystemCompatible();b==this.apps[1]&&this.system.setAppDimension();virtualclass.vutil.createReclaimButtonIfNeed();virtualclass.user.assignRole(virtualclass.gObj.uRole,b);this.gObj.video=new c.virtualclass.media;if(!virtualclass.vutil.isPlayMode())var f=this,g=setInterval(function(){2<=f.gObj.editorInitDone&&(f.initSocketConn(),clearInterval(g))},100)},initSocketConn:function(){this.system.webSocket&&
(io.init(virtualclass.uInfo),c.userdata=virtualclass.uInfo)},html:{id:"virtualclassCont",optionsClass:"appOptions",init:function(a){this.virtualclass=a},leftAppBar:function(){if(!(0<document.getElementsByClassName("appOptions").length)){var a=document.getElementById(this.id),b=this.createElement("div","virtualclassOptionsCont");a.insertBefore(b,a.firstChild);this.createDiv(virtualclass.edConfig.id+"Tool","editorRich",b,virtualclass.edConfig.classes);this.createDiv(virtualclass.wbConfig.id+"Tool",
"whiteboard",b,virtualclass.wbConfig.classes);this.createDiv(virtualclass.ssConfig.id+"Tool","screenshare",b,virtualclass.ssConfig.classes);this.createDiv(virtualclass.ytsConfig.id+"Tool","youtubeshare",b,virtualclass.ytsConfig.classes);this.createDiv(virtualclass.edCodeConfig.id+"Tool","editorCode",b,virtualclass.edCodeConfig.classes);virtualclass.gObj.hasOwnProperty("errNotScreenShare")&&virtualclass.view.disableSSUI();roles.hasControls()&&this.createDiv(virtualclass.appSessionEnd+"Tool","sessionend",
b,"appOptions");virtualclass.gObj.hasOwnProperty("errAppBar")&&virtualclass.view.disableLeftAppBar()}},createDiv:function(a,b,d,f,g){var c=document.createElement("a");c.href="#";var m=document.createElement("div");m.id=a;"undefined "!=typeof f&&(m.className=f);a=document.createElement("span");a.className="icon-"+b;c.appendChild(a);c.dataset.title=virtualclass.lang.getString(b);c.className="tooltip";m.appendChild(c);"undefined"!=typeof g?(g=document.getElementById("virtualclassScreenShareTool"),d.replaceChild(m,
g)):d.appendChild(m)},createElement:function(a,b,d){a=document.createElement(a);"undefined"!=typeof b&&(a.id=b);if("undefined"!=typeof d&&1<d.length)for(b=0;b<d.length;b++)a.className+=d[b]+" ";return a}},dispvirtualclassLayout:function(a){if("undefined"!=typeof this.previous)if(this.previous.toUpperCase()!=("virtualclass"+this.currApp).toUpperCase())if(document.getElementById(virtualclass.previous).style.display="none","undefined"!=typeof a){if("EDITORRICH"==a.toUpperCase()){var b=document.getElementById("virtualclassEditorCode");
null!=b&&(b.style.display="none")}else console.log("EditorRich can not be display:none "+a);"EDITORCODE"==a.toUpperCase()?(b=document.getElementById("virtualclassEditorRich"),null!=b&&(b.style.display="none")):console.log("EditorCode can not be display:none "+a)}else console.log("appId "+a+" undefined");else for(var b=document.getElementById("virtualclassCont").getElementsByClassName("virtualclass"),d=0;d<b.length;d++)b[d].style.display="none";"undefined"!=typeof a&&(a="virtualclass"+(a.charAt(0).toUpperCase()+
a.slice(1)));b=document.getElementById(a);null!=b&&(b.style.display="block",console.log("App "+a+" block"))},makeAppReady:function(a,b,d){console.log("Application is ready"+a);this.view=c.view;this.currApp=virtualclass.vutil.capitalizeFirstLetter(a);console.log("Current App init "+this.currApp);a!=this.apps[1]&&virtualclass.hasOwnProperty("previrtualclass")&&roles.hasControls()&&virtualclass.vutil.makeActiveApp("virtualclass"+a,virtualclass.previrtualclass);if("undefined"!=typeof this.previous&&("virtualclassEditorRich"==
this.previous||"virtualclassEditorCode"==this.previous)){var f=this.previous.split("virtualclass")[1];this.user.control.toggleDisplayEditorController(f,"none")}a!=this.apps[1]&&(this.dispvirtualclassLayout(a),document.getElementById("virtualclassCont").dataset.currapp=this.currApp);this.appInitiator[a].apply(virtualclass,Array.prototype.slice.call(arguments));this.previrtualclass=this.previous;a!=this.apps[0]&&a!=this.apps[1]&&virtualclass.system.setAppDimension();a!=this.apps[1]&&a!=this.apps[2]&&
virtualclass.hasOwnProperty("yts")&&virtualclass.yts.destroyYT()},appInitiator:{Whiteboard:function(a,b){"object"==typeof this.ss&&(this.ss.prevStream=!1);"undefined"!=typeof this.previous&&"undefined"!=typeof b&&"byclick"==b&&virtualclass.vutil.beforeSend({dispWhiteboard:!0,cf:"dispWhiteboard"});"object"!=typeof this.wb?(this.wb=new c.whiteboard(this.wbConfig),this.wb.utility=new c.utility,this.wb.alreadyReplay=!1,this.wb.packContainer=new c.packContainer,this.wb.draw_object=c.draw_object,this.wb.makeobj=
c.makeobj,this.wb.readyFreeHandObj=c.readyFreeHandObj,this.wb._replay=_replay,this.wb.readyTextObj=c.readyTextObj,this.wb.bridge=c.bridge,this.wb.response=c.response,virtualclass.wb.utility.displayCanvas(),roles.hasControls()&&(virtualclass.wb.utility.setOrginalTeacherContent(a),virtualclass.wb.attachToolFunction(vcan.cmdWrapperDiv,!0),vcan.utility.canvasCalcOffset(vcan.main.canid)),!this.alreadyReplayFromStorage&&0<this.gObj.tempReplayObjs.length&&this.wb.utility.replayFromLocalStroage(this.gObj.tempReplayObjs)):
null==document.getElementById("commandToolsWrapper")&&roles.hasControls()&&virtualclass.wb.attachToolFunction(vcan.cmdWrapperDiv,!0);"undefined"!=typeof this.prevScreen&&this.prevScreen.hasOwnProperty("currentStream")&&this.prevScreen.unShareScreen();null!=document.getElementById("canvas")&&(vcan.utility.canvasCalcOffset(vcan.main.canid),0==this.gObj.tempReplayObjs.length&&virtualclass.wb.utility.makeCanvasEnable());"virtualclassScreenShare"==this.previous&&roles.hasControls()&&(virtualclass.vutil.dimensionMatch("virtualclassWhiteboard",
"virtualclassScreenShare")||virtualclass.wb.utility.lockvirtualclass());this.previous=this.wbConfig.id;roles.hasControls()&&virtualclass.gObj.resize&&virtualclass.wb.utility.lockvirtualclass()},ScreenShare:function(a){"object"!=typeof this.ss&&(this.ss=new c.screenShare(virtualclass.ssConfig));this.ss.init({type:"ss",app:a})},Yts:function(a,b,d){"undefined"!=typeof d&&null!=d?virtualclass.yts.init(d,d.startFrom):null==document.querySelector("iframe#player")&&virtualclass.yts.init();this.previous=
virtualclass.ytsConfig.id},EditorRich:function(a){this.appInitiator.editor.call(virtualclass,a)},EditorCode:function(a){this.appInitiator.editor.call(virtualclass,a)},editor:function(a){this.user.control.toggleDisplayEditorController(a.substring(a.indexOf("virtualclass"),a.length),"block");var b=[];a==this.apps[3]?(virtualclass.editorRich.init(0,b,"",""),this.previous=virtualclass.edConfig.id):(virtualclass.editorCode.init(0,b,"",""),this.previous=virtualclass.edCodeConfig.id);var b=JSON.parse(localStorage.getItem(virtualclass.vutil.smallizeFirstLetter(a))),
d=virtualclass.vutil.smallizeFirstLetter(a);roles.hasAdmin()||(null==b?(this[d].cm.setOption("readOnly","nocursor"),this.user.control.toggleDisplayWriteModeMsgBox(a,!1),console.log("message box is created "+a)):(this.user.control.toggleDisplayWriteModeMsgBox(a,b),b?this[d].cm.setOption("readOnly",!1):this[d].cm.setOption("readOnly","nocursor")),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(d))}},attachFunction:function(){for(var a=document.getElementsByClassName("appOptions"),b=0;b<a.length;b++){var d=
a[b].getElementsByTagName("a")[0],f=this;clickedAnchor=d;d.onclick=function(){f.initlizer(this)}}},initlizer:function(a){a=a.parentNode.id.split("virtualclass")[1];"SessionEndTool"==a?virtualclass.popup.confirmInput(virtualclass.lang.getString("savesession"),function(a){a?(ioStorage.completeStorage(void 0,void 0,"sessionend"),setTimeout(function(){virtualclass.getContent=!0;virtualclass.vutil.beforeSend({sEnd:!0,cf:"sEnd"});io.sock.close();virtualclass.recorder.startUploadProcess()},300)):virtualclass.popup.confirmInput(virtualclass.lang.getString("startnewsession"),
function(a){a?virtualclass.clearSession():console.log("Not start new session")})}):(a=a.substring(0,a.indexOf("Tool")),this.PrvAndCurrIsWss(this.previous,a)?alert(virtualclass.lang.getString("screensharealready")):this.makeAppReady(a,"byclick"));"ScreenShare"!=a&&virtualclass.vutil.removeClass("audioWidget","fixed")},PrvAndCurrIsWss:function(a,b){return"virtualclassWholeScreenShare"==a&&b==this.apps[2]?!0:!1},prvCurrUsersSame:function(){var a=localStorage.getItem("prvUser");if(null==a)virtualclass.setPrvUser();
else if(a=JSON.parse(a),a.id!=wbUser.id||a.room!=wbUser.room)virtualclass.gObj.sessionClear=!0,virtualclass.setPrvUser(),roles.hasControls()&&localStorage.setItem("uRole",this.gObj.uRole)},setPrvUser:function(){localStorage.clear();localStorage.setItem("prvUser",JSON.stringify({id:wbUser.id,room:wbUser.room}))}}}})(window);(function(c,a){var b={cmdWrapperDiv:"commandToolsWrapper",create:function(a){if("#"==a.charAt(0)){var f=a.substring(1,a.length);b.utility.canvasCalcOffset(f);return new b.main(a)}console.log("there is a problem with canvas id")},main:function(d){b.main.children=[];b.main.id=0;b.main.uid=0;b.main.canvas=a.querySelector(d);b.main.canid=d.substring(1,d.length);b.main.currentTransform="";b.main.replayObjs=[];b.main.dragMode=!1;b.main.scaleMode=!1;b.main.usrCurrAction="";b.main.currObj="";b.main.textObj=
!1;b.main.action="create";b.wb={};b.wb.sentPack=!1;b.activMouse=new b.mouse;b.activMouse.init()},extend:function(a,b){if("object"==typeof a&&"object"==typeof b){for(var g in b)a[g]=b[g];return a}console.log("it seems that the arguments you passed are not object")},transform:function(a,b){a.translate(b.x,b.y);a.rotate(b.theta);a.scale(b.scaleX*(b.flipX?-1:1),b.scaleY*(b.flipY?-1:1))},getStates:function(a){return b.main[a]},setValInMain:function(a,f){return b.main[a]=f},ArrayIndexOf:function(a,b){if(!b||
"function"!=typeof b||!a||!a.length||1>a.length)return-1;for(var g=0;g<a.length;g++)if(b(a[g]))return g;return-1},renderAll:function(a){var f=b.main.children.length;"object"!=typeof a&&(a=b.main.canvas.getContext("2d"));b.clearContext(a);if(f)for(var g=0;g<f;++g)"freeDrawing"==b.main.children[g].type?b.fhdRender(a,b.main.children[g]):b.render(a,b.main.children[g])},clearContext:function(a){var f=b.main.canvas;a.clearRect(0,0,f.width,f.height);return f},deactivateAll:function(){for(var a=b.main.children,
f=0,g=a.length;f<g;f++)a[f].setActive(!1)},makeDispObject:function(a){return{coreObj:a,bind:function(a,b){this.addEventListener("on"+a,b)}}},remove:function(a){var f=b.main.canvas,g=b.ArrayIndexOf(b.main.children,function(b){return b.id==a.id&&(b.mt==a.mt||!0==a.multiuser)});0<=g&&b.main.children.splice(g,1);var g=f.height,c=f.width,f=f.getContext("2d");f.beginPath();f.clearRect(0,0,c,g);f.closePath();b.renderAll()},render:function(a,f,g){a.beginPath();a.save();a.lineWidth=void 0!==a.lineWidth?f.lineWidth:
2;g||b.transform(a,f);a.strokeStyle=void 0!=f.borderColor?f.borderColor:"#000000";"rectangle"==f.type?b.objRect.draw(a,f,g):"line"==f.type?b.objLine.draw(a,f,g):"oval"==f.type?b.objOval.draw(a,f,g):"triangle"==f.type?b.objTri.draw(a,f,g):"text"==f.type&&b.objTxt.draw(a,f,g);f.active&&!g&&(f.drawBorders(a),f.hideCorners||f.drawCorners(a));a.closePath();a.restore()},fhdRender:function(a,f,g){a.save();var c=f.transformMatrix;c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);g||b.transform(a,f);f.overlayFill?
a.fillStyle=f.overlayFill:f.fill&&(a.fillStyle=f.fill);f.stroke&&(a.strokeStyle=f.stroke);a.beginPath();var m;m=c=0;for(var p=-(f.width/2),s=-(f.height/2),v=0,x=f.path.length;v<x;++v)switch(m=f.path[v],m[0]){case "L":c=m[1];m=m[2];a.lineTo(c+p,m+s);break;case "M":c=m[1],m=m[2],a.moveTo(c+p,m+s)}f.fill&&a.fill();f.stroke&&(a.strokeStyle=f.stroke,a.lineWidth=f.strokeWidth,a.lineCap=a.lineJoin="round",a.stroke());!g&&f.active&&(f.drawBorders(a),f.hideCorners||f.drawCorners(a));a.restore()},makeStackObj:function(a,
b,g,c){return{mt:a,ac:b,x:g,y:c}}};c.vcan=b})(window,document);(function(c,a){c.whiteboard=function(b){var d=b.hasOwnProperty("id")?b.id:"appWhitebaordCont";b=b.hasOwnProperty("class");return{id:d,classes:b,tool:"",obj:{},prvObj:"",replayTime:0,uid:0,lt:"",view:{},lang:{},system:{},user:{},gObj:{myrepObj:[],replayObjs:[],myArr:[],displayedObjId:0,packQueue:[],queue:[],virtualWindow:!1},init:function(){virtualclass.wb.vcan=c.vcan;var a=virtualclass.wb.vcan;virtualclass.wb.canvas=a.create("#canvas");a=a.main.canvas;a.setAttribute("tabindex","0");a.focus();c.onkeydown=
virtualclass.wb.utility.keyOperation;virtualclass.system.setAppDimension();"undefined"!==typeof Storage&&(c.virtualclass.wb=virtualclass.wb);this.arrowInit();this._init()},_init:function(){virtualclass.wb.oTeacher=roles.hasAdmin();virtualclass.vutil.chkValueInLocalStorage("rcvdPackId")?virtualclass.wb.gObj.rcvdPackId=parseInt(localStorage.rcvdPackId):virtualclass.wb.gObj.rcvdPackId=0;c.addEventListener("resize",function(){virtualclass.gObj.resize=!0;roles.hasControls()&&"Whiteboard"==virtualclass.currApp&&
virtualclass.wb.utility.lockvirtualclass()});c.addEventListener("click",function(){virtualclass.view.disappearBox("WebRtc");virtualclass.view.disappearBox("Canvas");virtualclass.view.disappearBox("drawArea")});virtualclass.wb.utility.crateCanvasDrawMesssage()},arrowInit:function(){this.arrImg=new Image;this.arrImg.src="undefined"!=typeof c.whiteboardPath?c.whiteboardPath+"/images/arrow.png":"/images/arrow.png";this.arrImgDraw=!1;var a=this;this.arrImg.onload=function(){a.arrImgDraw=!0}},createCommand:function(){if(virtualclass.wb.utility.alreadyExistToolBar()||
null!=localStorage.getItem("educator")&&localStorage.reclaim)return!0;var a=virtualclass.vutil.createCommandWrapper();virtualclass.vutil.createDiv("t_rectangle","rectangle",a,"tool");virtualclass.vutil.createDiv("t_line","line",a,"tool");virtualclass.vutil.createDiv("t_freeDrawing","freeDrawing",a,"tool");virtualclass.vutil.createDiv("t_oval","oval",a,"tool");virtualclass.vutil.createDiv("t_triangle","triangle",a,"tool");virtualclass.vutil.createDiv("t_text","text",a,"tool");virtualclass.vutil.createDiv("t_activeall",
"activeAll",a,"tool");virtualclass.vutil.createDiv("t_clearall","clearAll",a,"tool");virtualclass.wb.socketOn=parseInt(wbUser.socketOn);1==virtualclass.wb.socketOn&&virtualclass.wb.utility.setClass("vcanvas","socketon")},createCommandWrapper:function(){var b=a.createElement("div");b.id=virtualclass.gObj.commandToolsWrapperId;var d=a.getElementById(vcan.canvasWrapperId);null!=d?a.getElementById("containerWb").insertBefore(b,d):a.getElementById("containerWb").appendChild(b);return b},createDiv_old:function(b,
d,c,m){var p=d;d=virtualclass.lang.getString(d);var s=a.createElement("a");s.href="#";var v=a.createElement("div");v.id=b;"undefined"!=typeof m&&(v.className=m);m=a.createElement("span");m.className="icon-"+p;s.appendChild(m);s.dataset.title=d;s.className="tooltip";v.appendChild(s);"t_reclaim"==b?(b=a.getElementById(virtualclass.html.id),c.appendChild(v),b.insertBefore(c,b.firstChild)):c.appendChild(v)},createCanvas:function(){var b=a.createElement("div");b.id=vcan.canvasWrapperId;vcan.canvasWrapperId=
b.id;var d=a.createElement("canvas");d.id="canvas";d.innerHTML="Canvas is missing in your browsers. Please update the latest version of your browser";b.appendChild(d);a.getElementById("containerWb").appendChild(b)},objInit:function(a){roles.hasControls()&&"t_clearall"!=this.parentNode.id&&virtualclass.wb.utility.makeActiveTool(this.parentNode.id);"t_replay"==this.parentNode.id?(virtualclass.wb.utility.clearAll(!1),virtualclass.vutil.beforeSend({replayAll:!0,cf:replayAll})):virtualclass.wb.toolInit(this.parentNode.id);
if("t_replay"!=this.parentNode.id&&"t_clearall"!=this.parentNode.id&&"t_reclaim"!=this.parentNode.id&&"t_assign"!=this.parentNode.id){a=(new Date).getTime();virtualclass.wb.lt=this.parentNode.id;var b={cmd:this.parentNode.id,mt:a};virtualclass.wb.uid++;b.uid=virtualclass.wb.uid;vcan.main.replayObjs.push(b);virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs));virtualclass.vutil.beforeSend({repObj:[b],cf:"repObj"})}"t_clearall"!=this.parentNode.id&&(virtualclass.wb.prvTool=this.parentNode.id,
virtualclass.wb.prvToolInfo=b)},attachToolFunction:function(b,d){virtualclass.wb.createCommand(d);for(var c=a.getElementById(b).getElementsByTagName("div"),m=0;m<c.length;m++)c[m].getElementsByTagName("a")[0].addEventListener("click",virtualclass.wb.objInit)},toolInit:function(b,d,c,m){"object"==typeof virtualclass.wb.obj.drawTextObj&&!0==virtualclass.wb.obj.drawTextObj.wmode&&vcan.main.canvas.getContext("2d");0<virtualclass.wb.vcan.getStates("children").length?"t_clearall"!=b&&("undefined"!=typeof c&&
"t_replay"==b||virtualclass.wb.utility.deActiveFrmDragDrop(),!0!=c&&"t_replay"!=b&&virtualclass.wb.vcan.renderAll()):virtualclass.wb.vcan.main.action="create";virtualclass.wb.utility.IsObjEmpty(virtualclass.wb.obj.freeDrawObj&&!1==c)||(virtualclass.wb.obj.freeDrawObj.freesvg=!1);virtualclass.wb.vcan.main.currUserCommand=b+"Init";"t_activeall"==b?virtualclass.wb.utility.t_activeallInit():"t_replay"==b?("undefined"==typeof c&&vcan.setValInMain("id",0),"undefined"!=typeof m?virtualclass.wb.t_replayInit(d,
m):virtualclass.wb.t_replayInit(d)):"t_clearall"==b?virtualclass.popup.confirmInput(virtualclass.lang.getString("clearAllWarnMessage"),function(b){if(!b)return!0;virtualclass.wb.utility.t_clearallInit();virtualclass.wb.utility.makeDefaultValue(d);virtualclass.storage.clearSingleTable("wbData");virtualclass.vutil.beforeSend({clearAll:!0,cf:"clearAll"});var d=virtualclass.wb.hasOwnProperty("prvToolInfo")&&"object"==typeof virtualclass.wb.prvToolInfo?virtualclass.wb.prvToolInfo.cmd:"t_triangle";b=a.getElementById(d).getElementsByTagName("a")[0];
null!=b&&b.click()}):"t_assign"==b?(d=localStorage.getItem("toolHeight"),null!=d?virtualclass.vutil.beforeSend({assignRole:!0,toolHeight:d,socket:virtualclass.wb.socketOn}):virtualclass.vutil.beforeSend({assignRole:!0,socket:virtualclass.wb.socketOn,cf:"assignRole"})):"t_reclaim"==b&&virtualclass.wb.utility._reclaimRole();"t_activeall"!=b&&"t_replay"!=b&&"t_clearallInit"!=b&&"t_assign"!=b&&"t_reclaim"!=b&&(virtualclass.wb.tool=new virtualclass.wb.tool_obj(b),virtualclass.wb.utility.attachEventHandlers())},
tool_obj:function(a){this.cmd=a;"t_freeDrawing"!=a&&(virtualclass.wb.obj.freeDrawObj="");"t_text"==a||virtualclass.vutil.exitTextWrapper()||(virtualclass.wb.obj.drawTextObj="");"t_freeDrawing"==a?(virtualclass.wb.obj.freeDrawObj=new virtualclass.wb.readyFreeHandObj("#424240","3"),virtualclass.wb.obj.freeDrawObj.init()):"t_text"==a&&(virtualclass.wb.obj.drawTextObj=new virtualclass.wb.readyTextObj,virtualclass.wb.obj.drawTextObj.init("canvasWrapper"));a=a.slice(2,a.length);virtualclass.wb.draw_object(a,
virtualclass.wb.canvas,this)},t_replayInit:function(a,b){"fromFile"==a?(virtualclass.gObj.chat.removeAllChat(),virtualclass.wb.recordAudio=!0,virtualclass.recorder.init()):(virtualclass.wb.replay=virtualclass.wb._replay(),"undefined"!=typeof b?(virtualclass.wb.replay.init(a,b),virtualclass.wb.replay.renderObj(b)):(virtualclass.wb.replay.init(a),virtualclass.wb.replay.renderObj()))}}}})(window,document);(function(c){c.utility=function(){return{userIds:[],isObjExistRE:function(a){if(0<=virtualclass.wb.replay.removeElements.length){var b=virtualclass.wb.vcan.ArrayIndexOf(virtualclass.wb.replay.removeElements,function(b){return b.id==a.id});if(0<=b)return b}},IsObjEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},stringToNumber:function(a){" "==a[a.length-1]&&(a=a.substring(0,a.length-1));return a=Number(a)},clickOutSidebox:function(a){return 1!=a%2?!0:!1},keyOperation:function(a){8==
a.keyCode||46==a.keyCode?(a=virtualclass.wb.vcan,""!=a.main.currObj&&roles.hasControls()&&(console.log("Delete whiteboard obj:- Invoke the command"),a=virtualclass.wb.utility.removeSelectedItem(a.main.currObj),virtualclass.vutil.beforeSend({repObj:[a],cf:"repObj"}))):27==a.keyCode&&"object"==typeof virtualclass.wb&&virtualclass.wb.obj.drawTextObj.finalizeTextIfAny()},removeSelectedItem:function(a,b,d){virtualclass.wb.canvas.removeObject(vcan.main.currObj);a={mt:(new Date).getTime(),ac:"del"};"undefined"==
typeof b&&virtualclass.wb.uid++;a.uid=virtualclass.wb.uid;roles.hasControls()?"undefined"==typeof d&&(console.log("Delete:- Saving the delete command with id "+a.uid),vcan.main.replayObjs.push(a),virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs))):virtualclass.storage.store(JSON.stringify(virtualclass.wb.gObj.replayObjs));vcan.main.currObj="";console.log("Delete:- Removing the whitboard object");return a},attachEventHandlers:function(){virtualclass.wb.canvas.bind("mousedown",virtualclass.wb.utility.ev_canvas);
virtualclass.wb.canvas.bind("mousemove",virtualclass.wb.utility.ev_canvas);virtualclass.wb.canvas.bind("mouseup",virtualclass.wb.utility.ev_canvas)},t_clearallInit:function(){virtualclass.wb.utility.clearAll(!0)},clearAll:function(a,b){virtualclass.wb.uid=0;virtualclass.wb.lt="";for(var d=virtualclass.wb.vcan;0<d.main.children.length;)virtualclass.wb.canvas.removeObject(d.main.children[0]);!0==a&&d.main.replayObjs.splice(0,d.main.replayObjs.length);void 0!=virtualclass.wb.replay&&(virtualclass.wb.replay.objNo=
0);"move"==d.getStates("action")&&d.setValInMain("action","create");d=document.getElementById("sendPackCont");if(null!=d&&(d=d.getElementsByClassName("numbers"),0<d.length))for(var f=0;f<d.length;f++)d[f].innerHTML=0;d=document.getElementById("serverErrorCont");null!=d&&(d.parentNode.removeChild(d),console.log("Some ERROR removed."))},deActiveFrmDragDrop:function(){var a=virtualclass.wb.vcan,b=a.main.children;if("move"==a.getStates("action")){a.setValInMain("action","create");for(a=0;a<b.length;a++)b[a].dragDrop(!1),
b[a].setActive(!1);return!0}return!1},getOffset:function(a){for(var b=a.target,d=y=0;b&&!isNaN(b.offsetLeft)&&!isNaN(b.offsetTop);)d+=b.offsetLeft-b.scrollLeft,y+=b.offsetTop-b.scrollTop,b=b.offsetParent;d=a.clientX-d;y=a.clientY-y;return{x:d,y:y}},ev_canvas:function(a){var b=virtualclass.wb.vcan.utility.getReltivePoint(a);a.currX=b.x;a.currY=b.y;if(b=virtualclass.wb.tool[a.type])return b(a),this.ev_canvas},t_activeallInit:function(){var a=virtualclass.wb.vcan,b=a.getStates("children");if(1<=b.length)for(a.setValInMain("action",
"move"),a=0;a<b.length;a++)b[a].dragDrop(!0)},drawArrowImg:function(a,b){var d=virtualclass.wb.vcan.main.canvas.getContext("2d");d.clearRect(0,0,virtualclass.wb.vcan.main.canvas.width,virtualclass.wb.vcan.main.canvas.height);vcan.renderAll();d.save();d.beginPath();d.translate(b.mp.x,b.mp.y);d.drawImage(a,-3,-3,18,24);d.closePath();d.restore()},assignRole:function(a){virtualclass.wb.tool="";"move"==vcan.main.action&&virtualclass.wb.utility.deActiveFrmDragDrop();if("undefined"!=typeof a)roles.isEducator()&&
(a=document.getElementById(virtualclass.gObj.commandToolsWrapperId),a.parentNode.removeChild(a)),virtualclass.gObj.uRole="p",localStorage.setItem("uRole",virtualclass.gObj.uRole),virtualclass.user.assignRole(virtualclass.gObj.uRole,virtualclass.currApp),vcan.utility.canvasCalcOffset(vcan.main.canid),"Yts"==virtualclass.currApp&&(virtualclass.yts.UI.inputURL(),virtualclass.yts.seekChangeInterval());else{"Yts"==virtualclass.currApp&&(virtualclass.yts.UI.removeinputURL(),virtualclass.yts.hasOwnProperty("tsc")&&
clearInterval(virtualclass.yts.tsc));virtualclass.gObj.uRole="s";a=document.getElementById(virtualclass.gObj.commandToolsWrapperId);if(null!=a)for(;a.hasChildNodes();)a.removeChild(a.lastChild);virtualclass.wb.utility.makeCanvasDisable();roles.hasAdmin()?(virtualclass.vutil.createReclaimButton(a),virtualclassCont=document.getElementById("virtualclassCont"),virtualclassCont.className+=" educator"):null!=a&&a.parentNode.removeChild(a);localStorage.setItem("uRole",virtualclass.gObj.uRole);virtualclass.wb.utility.uniqueArrOfObjsToStudent()}},
reclaimRole:function(){virtualclass.gObj.controlAssign=!1;virtualclass.wb.response.assignRole(virtualclass.gObj.uid,virtualclass.gObj.uid,!0)},dispQueuePacket:function(a){(roles.hasControls()||roles.isEducator())&&virtualclass.wb.utility.toolWrapperEnable();virtualclass.wb.drawMode=!1;roles.hasControls()&&(virtualclass.wb.utility.makeCanvasEnable(),virtualclass.wb.utility.enableAppsBar())},makeCanvasDisable:function(){var a=vcan.main.canvas;a.style.position="relative";a.style.pointerEvents="none"},
makeCanvasEnable:function(){!roles.hasControls()||virtualclass.wb.hasOwnProperty("canvasDisable")&&virtualclass.wb.canvasDisable||(vcan.main.canvas.style.pointerEvents="visible")},removeToolBox:function(){var a=document.getElementById(vcan.cmdWrapperDiv);a.parentNode.removeChild(a)},createReclaimButton:function(a){virtualclass.vutil.createDiv("t_reclaim","reclaim",a);document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",virtualclass.wb.objInit)},chkValueInLocalStorage:function(a){return null===
localStorage.getItem(a)?!1:localStorage[a]},uniqueArrOfObjsToStudent:function(){var a="";virtualclass.wb.gObj.replayObjs=[];for(var b=0;b<vcan.main.replayObjs.length;b++)a=vcan.extend({},vcan.main.replayObjs[b]),virtualclass.wb.gObj.replayObjs.push(a)},uniqueArrOfObjsToTeacher:function(){vcan.main.replayObjs=[];for(var a="",b=0;b<virtualclass.wb.gObj.replayObjs.length;b++)a=vcan.extend({},virtualclass.wb.gObj.replayObjs[b]),vcan.main.replayObjs.push(a)},makeDefaultValue:function(a){"undefined"!=typeof a&&
"t_clearall"==a||virtualclass.wb.utility.makeDeActiveTool();virtualclass.wb.gObj.myrepObj=[];virtualclass.wb.gObj.replayObjs=[];virtualclass.wb.gObj.rcvdPackId=0;virtualclass.wb.gObj.displayedObjId=0;virtualclass.wb.gObj.packQueue=[];virtualclass.wb.gObj.queue=[];virtualclass.wb.uid=0;localStorage.setItem("rcvdPackId",0);virtualclass.vutil.chkValueInLocalStorage("wbrtcMsg");virtualclass.vutil.chkValueInLocalStorage("canvasDrwMsg");virtualclass.vutil.chkValueInLocalStorage("toolHeight");JSON.parse(virtualclass.vutil.chkValueInLocalStorage("prvUser"));
JSON.parse(virtualclass.vutil.chkValueInLocalStorage("tc"));virtualclass.gObj.video.audio.bufferSize=0;virtualclass.gObj.video.audio.encMode="alaw";virtualclass.gObj.video.audio.rec="";virtualclass.gObj.video.audio.audioNodes=[];"undefined"!=typeof vcan.objTxt&&vcan.objTxt.removeTextNode();"undefined"!=typeof vcan.main.currentTransform&&(vcan.main.currentTransform="");virtualclass.gObj.video.audio.updateInfo()},clearCurrentTool:function(){virtualclass.wb.hasOwnProperty("tool")&&(virtualclass.wb.tool=
"")},setOrginalTeacherContent:function(){localStorage.setItem("canvasDrwMsg",!0)},checkWebRtcConnected:function(){return"undefined"==typeof cthis||!cthis.pc[0].hasOwnProperty("iceConnectionState")&&"undefined"==typeof cthis.pc[0].iceConnectionState?!1:!0},createVirtualWindow:function(a){virtualclass.wb.gObj.virtualWindow=!0;var b=document.createElement("div");virtualclass.wb.utility.removeVirtualWindow("virtualWindow");b.setAttribute("id","virtualWindow");b.style.width=a.width+"px";if("undefined"!=
typeof assignRoleAtStudent)var d=0;else d=parseInt(localStorage.getItem("toolHeight")),d=null!=d?d:0;roles.hasAdmin()?b.style.height=a.height+d+"px":roles.hasControls()?b.style.height=a.height+"px":b.style.height=a.height-d+"px";a=document.getElementById("containerWb");a.insertBefore(b,a.firstChild)},removeVirtualWindow:function(a){a=document.getElementById(a);null!=a&&(virtualclass.wb.gObj.virtualWindow=!1,a.parentNode.removeChild(a))},getWideValueAppliedByCss:function(a,b){var d=document.getElementById(a);
if(null!=d){var f=c.getComputedStyle(d);if("undefined"!=typeof f.marginTop){var g=parseInt(f.marginTop.match(/\d+/));null==g&&(g=0)}return d.clientHeight+g}return!1},isNumber:function(a){return isNaN(+a)?!1:+a},setCommandToolHeights:function(a,b){var d=document.getElementById("virtualWindow");if(null!=d){var f=parseInt(d.style.height.match(/\d+/));d.style.height="decrement"==b?f-parseInt(a)+"px":f+parseInt(a)+"px"}},setClass:function(a,b){var d=document.getElementById(a),f=d.classList,g="";0<f.length&&
(g=2>g.length?f[0]+" ":f.join(" ")+" ");d.setAttribute("class",g+b)},setStyleUserConnetion:function(a,b,d){a=document.getElementsByClassName(a)[0];null!=a&&a.setAttribute("class",b+" controlCmd")},existUserLikeMe:function(a){if(a.fromUser.userid!=wbUser.id){if(a.message.checkUser.hasOwnProperty("role")){var b=a.message.checkUser.role;if(b){if(null==localStorage.getItem("otherRole")){var d=[];if(b!=virtualclass.gObj.uRole)d.push(b);else return existUser=!0}else d=JSON.parse(localStorage.getItem("otherRole")),
-1==d.indexOf(b)&&d.push(b);"undefined"!=typeof d&&(localStorage.setItem("otherRole",JSON.stringify(d)),console.log("Other Browser "+b+" "+a.fromUser.userid))}return virtualclass.gObj.uRole==b?!0:!1}}else{if("undefined"!=typeof existUser)return!0;a=JSON.parse(localStorage.getItem("otherRole"));if(null!=a){for(b=0;b<a.length;b++)if(virtualclass.gObj.uRole==a[b])return!0;return!1}}},existUserWithSameId:function(a){this.userIds.push(a.fromUser.userid);if(1<this.userIds.length&&virtualclass.wb.utility.arrayContainsSameValue(this.userIds[0],
this.userIds))return!0},makeUserAvailable:function(){null==localStorage.getItem("repObjs")&&(virtualclass.wb.utility.toolWrapperEnable(),null!=vcan.main.canvas&&virtualclass.wb.utility.makeCanvasEnable())},displayCanvas:function(){vcan.canvasWrapperId="canvasWrapper";null==document.getElementById("canvas")&&virtualclass.wb.createCanvas();c.virtualclass.wb.init();virtualclass.wb.utility.makeCanvasDisable();virtualclass.wb.utility.toolWrapperDisable();roles.hasControls()||0==vcan.main.children&&virtualclass.wb.utility.createWhiteboardMessage()},
removeWhiteboardMessage:function(){var a=document.getElementById("whiteBoardMsg");null!=a&&a.parentNode.removeChild(a)},createWhiteboardMessage:function(){if(null==document.getElementById("whiteBoardMsg")){var a=document.createElement("div");a.id="whiteBoardMsg";a.innerHTML=virtualclass.lang.getString("msgForWhiteboard");var b=document.getElementById("canvasWrapper");null!=b&&b.appendChild(a)}},initAll:function(a){roles.hasControls()&&virtualclass.wb.utility.makeCanvasDisable();virtualclass.system.measureResoultion({width:c.outerWidth,
height:c.innerHeight})},alreadyExistToolBar:function(){var a=document.getElementById("t_rectangle");if(null!=a)return 8<=a.parentNode.getElementsByClassName("tool").length?!0:!1},toolWrapperDisable:function(a){var b=document.getElementById("commandToolsWrapper");if(null!=b)if("undefined"!=typeof a)for(a=b.getElementsByTagName("a"),b=0;b<a.length;b++)a[b].style.pointerEvents="none";else b=document.getElementById("commandToolsWrapper"),null!=b&&(b.style.pointerEvents="none")},toolWrapperEnable:function(a){var b=
document.getElementById("commandToolsWrapper");if(null!=b)if("undefined"!=typeof a)for(a=b.getElementsByTagName("a"),b=0;b<a.length;b++)a[b].style.pointerEvents="visible";else null==b||virtualclass.gObj.hasOwnProperty("errNotDesktop")||(b.style.pointerEvents="visible")},replayFromLocalStroage:function(a){"undefined"!==typeof Storage&&(!1===virtualclass.storage.reclaim&&virtualclass.vutil.disableAppsBar(),virtualclass.wb.utility.clearAll(!1,"dontClear"),virtualclass.wb.gObj.tempRepObjs=a,0<a.length&&
(virtualclass.wb.utility.makeCanvasDisable(),virtualclass.wb.utility.toolWrapperDisable(),virtualclass.wb.utility.replayObjsByFilter(a,"fromBrowser")))},setUserStatus:function(a,b){a||b?virtualclass.wb.utility.setClass("vcanvas","teacher"):(virtualclass.wb.utility.removeToolBox(),virtualclass.wb.utility.setClass("vcanvas","student"))},crateCanvasDrawMesssage:function(){roles.hasControls()&&null==localStorage.getItem("canvasDrwMsg")&&(c.virtualclass.view.canvasDrawMsg("Canvas"),c.virtualclass.view.drawLabel("drawArea"),
localStorage.canvasDrwMsg=!0)},arrayContainsSameValue:function(a,b){for(var d=0;d<b.length;d++)if(b[d]!==a)return!1;return!0},actionAfterRemovedUser:function(){virtualclass.wb.utility.makeCanvasDisable();virtualclass.wb.utility.setStyleUserConnetion("con","coff");virtualclass.wb.utility.removeVirtualWindow("virtualWindow");virtualclass.wb.user.connected=!1;localStorage.removeItem("otherRole");"undefined"!=typeof cthis&&(tempIsInitiaor=!0,cthis.isStarted&&cthis.handleRemoteHangup())},sendRequest:function(){virtualclass.vutil.beforeSend({reclaimRole:!0,
cf:"reclaimRole"})},updateSentInformation:function(a,b){if(roles.hasAdmin()){var d=JSON.parse(a),d="undefined"!=typeof b?d:d.repObj[0],f="",g;for(g in d)f+=g+" : "+d[g]+" <br />";null!=document.getElementById("sentMsgInfo")&&(document.getElementById("sentMsgInfo").innerHTML=f)}},beforeSend:function(a,b){if(a.hasOwnProperty("createArrow")){var d=JSON.stringify(a);virtualclass.wb.vcan.optimize.sendPacketWithOptimization(d,io.sock.readyState,100)}else{if(a.hasOwnProperty("repObj")){if("undefined"==typeof a.repObj[a.repObj.length-
1])return;virtualclass.wb.gObj.rcvdPackId=a.repObj[a.repObj.length-1].uid;virtualclass.wb.gObj.displayedObjId=virtualclass.wb.gObj.rcvdPackId}d=JSON.stringify(a);1==io.sock.readyState&&("undefined"==typeof b?ioAdapter.mustSend(a):ioAdapter.mustSendUser(a,b));JSON.parse(d).hasOwnProperty("repObj")&&virtualclass.wb.utility.updateSentInformation(d)}},checkCanvasHasParents:function(){for(var a=document.getElementById("vcanvas");"BODY"!=a.parentNode.tagName;)"vcanvas"!=a.id&&(a.style.margin="0",a.style.padding=
"0"),a=a.parentNode;"vcanvas"!=a.id&&(a.style.margin="0",a.style.padding="0")},lockvirtualclass:function(){if(c.earlierWidth!=c.innerWidth&&(virtualclass.wb.canvasDisable=!0,virtualclass.wb.utility.makeCanvasDisable(),virtualclass.wb.utility.toolWrapperDisable(),virtualclass.vutil.disableAppsBar(),null==document.getElementById("divForReloadMsg"))){var a=roles.hasControls()?"msgForReload":"msgStudentForReload";c.virtualclass.view.displayMsgBox("divForReloadMsg",a);c.earlierWidth=c.innerWidth}},getElementRightOffSet:function(a){var b=
20;null!=a.parentNode&&(a=a.parentNode,b=vcan.utility.getElementOffset(a),b=c.innerWidth-(a.clientWidth+(b.x-0)));return b},objPutInContainer:function(a){vcan.main.replayObjs.push(a);virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs))},makeActiveTool:function(a){a=document.getElementById(a);var b;virtualclass.wb.hasOwnProperty("prvTool")&&"t_reclaim"!=virtualclass.wb.prvTool?(b=virtualclass.vutil.removeClassFromElement(virtualclass.wb.prvTool,"active"),document.getElementById(virtualclass.wb.prvTool).className=
b):b=a.className;a.className=b+" active";localStorage.activeTool=a.id},makeDeActiveTool:function(){virtualclass.wb.tool="";document.getElementById("commandToolsWrapper");var a=document.getElementsByClassName("tool active");0<a.length&&a[0].classList.remove("active")},createAudioTransmitIcon:function(a){var b=document.cteateElement("div");b.id="audioTransmit"+uuserId;b.className="audioTransmit";document.getElementById(a+"ControlContainer")},_reclaimRole:function(){virtualclass.wb.utility.reclaimRole();
virtualclass.wb.utility.sendRequest();virtualclass.user.control.changeAttrToAssign("enable")},enableAppsBar:function(){var a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.pointerEvents="visible")},replayObjsByFilter:function(a,b){for(var d=0;d<a.length;d++)virtualclass.wb.bridge.makeQueue(a[d]),a[d].uid==virtualclass.wb.gObj.displayedObjId+1?(virtualclass.wb.uid=a[d].uid,this.executeWhiteboardData(a[d]),"undefined"!=typeof b&&(virtualclass.wb.gObj.rcvdPackId=virtualclass.wb.uid)):
console.log("Could not display whiteboard object with "+a[d].uid);console.log("Whiteboard Stored ID "+virtualclass.wb.gObj.replayObjs[virtualclass.wb.gObj.replayObjs.length-1].uid);virtualclass.storage.store(JSON.stringify(virtualclass.wb.gObj.replayObjs))},executeWhiteboardData:function(a){console.log("received uid "+a.uid);virtualclass.wb.gObj.replayObjs.push(a);virtualclass.wb.response.replayObj([a]);this.checkNextQueue(a)},checkNextQueue:function(a){(a=this.findPacketInQueue(a))&&this.executeWhiteboardData(a)},
findPacketInQueue:function(a){if(virtualclass.wb.gObj.queue.hasOwnProperty(a.uid+1))return virtualclass.wb.gObj.queue[a.uid+1];console.log("Packet"+(a.uid+1)+"not found ");return!1}}}})(window);(function(c){c.message={notSupportCanvas:'This browser does not support <a href="http://en.wikipedia.org/wiki/Canvas_element/">Canvas</a>. Please update your browser with the latest version',notSupportGetUserMedia:'The browser does not support <a href="http://dev.w3.org/2011/webrtc/editor/getusermedia.html">getUserMedia</a> for <a href="http://www.webrtc.org/">WebRtc</a>. Please update your browser with the latest version',notSupportPeerConnect:'The browser is unable to create a Peer Connection object for <a href="http://www.webrtc.org/">WebRtc</a>. Please update your browser with the latest version.',
notSupportWebSocket:'This browser does not support <a href="http://www.websocket.org/">WebSocket</a>. Please update your browser with the latest version. ',notSupportWebRtc:'This browser does not support <a href="http://www.webrtc.org/">WebRtc</a>. Please update your browser with the latest version.',line:"Line",rectangle:"Rectangle",triangle:"Triangle",oval:"Oval",assign:"Assign",reclaim:"Reclaim",freeDrawing:"Free hand",text:"Text",replay:"Replay",activeAll:"Active All",clearAll:"Clear All",drawArea:"Draw Area",
totRcvdPackets:"Total Packets Received",perSecRcvdData:"Packet Received Per Second",totSentPackets:"Total Packets Sent",perSecSentPacket:"Packets Sent Per Second ",perSecond:"Per Second",sentPackets:"Sent <br/><span>Packets</span>",receviedPackets:"Received <br/><span>Packets</span>",total:"Total",dataDetails:"Data Details",sentMessageInfo:"Sent Message <br/><span>Information</span>",receivedMessageInfo:"Received Message <br/><span>Information</span>",wbrtcMsgFireFox:'You can click on  "Share Selected Devices" to share your mic and camera feed with other users',
wbrtcMsgChrome:"You can click the deny button for not sharing your microphone and camera  with Congrea.or click allow button to share them.",canvasDrawMsg:"You can click on any tool for drawingclick and hold the left mouse button to draw",clearAllWarnMessage:"Do you really want to clear this whiteboard?",cof:"connection off",askForConnect:"This action can be performed only after another user connects",msgForReload:"Please reload this page to continue editing.",msgStudentForReload:"Please reload this page.",
reload:"Reload",whiteboard:"Whiteboard",screenshare:"Screen Share",sessionend:"Close Session.",audioTest:"Your voice will be recorded and played back to you. \n Press Ok and speak something for few seconds.",chatEnable:"Disable Chat",chatDisable:"Enable Chat",assignEnable:"Transfer Controls",assignDisable:"Reclaim Controls",editorRichDisable:"Write Mode",editorRichEnable:"Read Only",editorCodeDisable:"Write Mode",editorCodeEnable:"Read Only",audioEnable:"Mute",audioDisable:"Unmute",audioOff:"Mute",
audioOn:"Mute",minCommonChat:"Hide Chat Window",maxCommonChat:"Show Chat Window",miniuserbox:"Hide User Box",maxuserbox:"Show User Box",miniUserList:"Hide User List",maxUserList:"Show User List",startnewsession:"This session has not been saved, do you really want to end this session?",DevicesNotFoundError:"Please check your Webcam (camera/microphone) connection.",PermissionDeniedError:"Webcam access has been denied.",PERMISSION_DENIED:"You denied access to your Webcam(camera/microphone).",notSupportBrowser:"Firefox {virtualclass1} does not support Screen sharing.",
disableSpeaker:"Mute",enableSpeaker:"Unmute",notSupportChrome:"Please update your browser {virtualclass1} {virtualclass2} to Google Chrome 40 or above",errcanvas:"canvas",errwebSocket:"Web Socket",errgetusermedia:"getUserMedia",errindexeddb:"indexedDb",errwebworker:"Web worker",errwebaudio:"Web audio",errtypedarray:"Typed array",errscreenshare:"Screen share",operaBrowserIssue:"Your browser {virtualclass1} {virtualclass2} is partially supported. You will not be able to share your screen, Congrea fully support chrome and Firefox",
commonBrowserIssue:"Your browser {virtualclass1} {virtualclass2} is not supported, Congrea support Chrome and Firefox.",chFireBrowsersIssue:"Your browser {virtualclass1} {virtualclass2} needs updation, Congrea support Chrome 40+ and Firefox 35+.",studentSafariBrowserIssue:"Your browser {virtualclass1} {virtualclass2} cannot  share your webcam with other users, Congrea fully support Chrome  and Firefox.",ieBrowserIssue:"Internet Explorer is not supported, Congrea fully support Chrome  and Firefox.",
ios7support:"For Apple, Virtual Class supports iOS 8 and higher versions.",supportDesktop:"Virtual Class does not support tablets or mobiles. To present please use a desktop.",notSupportIphone:"Sorry. Virtual Class doesn't support mobile phones.",InternalError:"Please ensure that same webcam is not being used <br /> in multiple browsers or multiple applications. ",SourceUnavailableError:"Please ensure that same webcam is not being used in multiple browsers or multiple applications.",teacherSafariBrowserIssue:"Safari does not support presenter functionality. Please switch to Chrome or Firefox.",
safariBrowserIssue:"Your browser Safari {virtualclass1} is not supported, We fully support Chrome  and Firefox",savesession:"Do you want to save current Session?",plswaitwhile:"Please wait....",downloadedFile:"Your files are downloading....,  <br />File, {virtualclass1}, has been downloaded",overallprogress:"Overall Progress",playsessionmsg:"Click \u2018play\u2019 to start the session.",askplayMessage:'<span id="askplaymsg"> Should we start playing the session?</span><br /><span id="remaingmsg">Remaining data will be downloaded in the background.</span>',
youTubeUrl:"Enter YouTube Video URL.",shareYouTubeVideo:"Share YouTube Video",shareAnotherYouTubeVideo:"Share Another YouTube Video",editorCode:"Code Editor",editorRich:"Text Editor",teachermayshow:"YouTube video will be shared shortly.",youtubeshare:"YouTube Video Share",writemode:"Write Mode",readonlymode:"Read Only",msgForDownloadStart:"Unable to save data. <br /> Preparing data for download",msgForWhiteboard:"Empty Whiteboard.",educator:"Educator",supportDesktopOnly:"Sorry, presenter mode only supports desktops. Tablets and Mobile devices are not supported.",
download:"Download",downloadFile:"Download File",synchMessage:"Please wait a while.  Syncing new content.",iosAudEnable:"Tap here to enable the audio",studentAudEnable:"Student Audio Enabled",screensharealready:"The screen is being shared.",editorsynchmsg:"Editor is not in sync, please wait a few seconds and try again ",canvasmissing:"Canvas is missing in your browsers. Please update the latest version of your browser",downloadFile:"Download File",filenotsave:"Your file could not be saved.",muteAll:"Mute All",
unmuteAll:"Unmute All",enablehistory:'"Browser History" should be enabled during the Session.'}})(window);(function(c){c.getString=function(a,b){var d=c.virtualclass.lang.message[a];if("undefined"!=typeof b&&0<b.length)for(var f=0;f<b.length;f++)d=d.replace(new RegExp("{virtualclass"+(f+1)+"}"),b[f]);return d}})(window);(function(c){var a={init:function(){this.msgBoxClass="msgBox";this.window={};this.virtualWindow={};return this},displayMessage:function(a,d,f,g,c){a="undefined"==typeof c?this.createMsgBox(a,d,f):this.createMsgBox(a,d,f,c);d=document.getElementById("vcanvas");"undefined"!=typeof g?document.getElementById(g).appendChild(a):d.insertBefore(a,d.childNodes[0])},createErrorMsg:function(a,d,f){var g=document.getElementById(d);null==g?(g=document.createElement("div"),g.id=d,g.innerHTML=a):g.innerHTML=a+"<br /> "+
g.innerHTML;a=document.getElementById(f);a.parentNode.insertBefore(g,a);return g.id},removeErrorMsg:function(a,d){var f=document.getElementById(a);if("undefined"!=typeof d){var g=f.innerHTML.split(/<br>|<br\\>/);if(1<g.length){g.shift();f.innerHTML=g.join();return}}f.parentNode.removeChild(f)},removeErrorContainer:function(a){a=document.getElementById(a);a.parentNode.removeChild(a)},customCreateElement:function(a,d,f){a=document.createElement(a);"undefined"!=typeof d&&(a.id=d);"undefined"!=typeof f&&
(a.className=f);return a},createMsgBox:function(a,d,f,g){var c=this.customCreateElement("div",d,f);"undefined"==typeof g&&(f=this.customCreateElement("div",d+"img",f+"img"),c.appendChild(f));d=this.customCreateElement("p",d+"Para");d.innerHTML=a;c.appendChild(d);return c},disappearBox:function(a){a=document.getElementsByClassName(this.msgBoxClass+a);null!=a[0]&&a[0].parentNode.removeChild(a[0])},multiMediaMsg:function(a){if("Firefox"==virtualclass.system.mybrowser.name){var d=virtualclass.lang.getString("wbrtcMsgFireFox");
this.displayMessage(d,"fireFoxWebrtcCont",this.msgBoxClass+a)}else"Chrome"==virtualclass.system.mybrowser.name&&(d=virtualclass.lang.getString("wbrtcMsgChrome"),this.displayMessage(d,"chormeWebrtcCont",this.msgBoxClass+a))},canvasDrawMsg:function(a){document.getElementById("vcanvas").className="canvasMsgBoxParent";if("Firefox"==virtualclass.system.mybrowser.name){var d=virtualclass.lang.getString("canvasDrawMsg");this.displayMessage(d,"canvasDrawMsgContFirefox",this.msgBoxClass+a,"containerWb")}else"Chrome"==
virtualclass.system.mybrowser.name&&(d=virtualclass.lang.getString("canvasDrawMsg"),this.displayMessage(d,"canvasDrawMsgContChrome",this.msgBoxClass+a,"containerWb"))},drawLabel:function(a){var d=virtualclass.lang.getString("drawArea");this.displayMessage(d,"canvasDrawArea",this.msgBoxClass+a,"containerWb",!1)},displayMsgBox:function(a,d){var f=this.customCreateElement("div",a),g=this.customCreateElement("p",a+"Para");g.innerHTML=virtualclass.lang.getString(d);f.appendChild(g);g=this.customCreateElement("a",
a+"Anchor");g.href=c.location;g.innerHTML=virtualclass.lang.getString("reload");g.onclick=function(){c.location.reload()};f.appendChild(g);g=document.getElementById("virtualclassCont");g.insertBefore(f,g.firstChild)},displayServerError:function(a,d){var f=this.customCreateElement("div",a);f.innerHTML=d;var g=document.getElementById("vcanvas");g.parentNode.insertBefore(f,g)},removeElement:function(a){a=document.getElementById(a);null!=a&&a.parentNode.removeChild(a)},disableSSUI:function(){var a=document.getElementById("virtualclassScreenShareTool");
null!=a&&(a.style.opacity="0.5",a.style.pointerEvents="none")},disableLeftAppBar:function(){var a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.opacity="0.5",a.style.pointerEvents="none")}},a=a.init();count=0;a.window.resizeFinished=function(){var a=0;return function(d,f){clearTimeout(a);a=setTimeout(d,f)}}();a.window.resize=function(){var a=virtualclass.system.measureResoultion({width:c.innerWidth,height:c.innerHeight});virtualclass.vutil.setContainerWidth(a,virtualclass.currApp);
"Whiteboard"==virtualclass.currApp&&vcan.renderAll()};a.virtualWindow.manupulation=function(a){var d=a.message.virtualWindow;if(d.hasOwnProperty("removeVirtualWindow"))a.fromUser.userid!=wbUser.id&&virtualclass.wb.utility.removeVirtualWindow("virtualWindow");else if(d.hasOwnProperty("createVirtualWindow"))d.hasOwnProperty("toolHeight")&&localStorage.setItem("toolHeight",d.toolHeight),a.fromUser.userid!=wbUser.id&&virtualclass.wb.utility.createVirtualWindow(d.createVirtualWindow);else if(d.hasOwnProperty("shareBrowserWidth")){d.hasOwnProperty("toolHeight")&&
localStorage.setItem("toolHeight",d.toolHeight);if(roles.hasControls()){var f=virtualclass.wb.utility.getWideValueAppliedByCss("commandToolsWrapper");localStorage.setItem("toolHeight",f)}a.fromUser.userid!=wbUser.id?(roles.hasControls()&&virtualclass.wb.utility.makeCanvasEnable(),otherBrowser=d.browserRes):myBrowser=virtualclass.system.measureResoultion({width:c.outerWidth,height:c.innerHeight});"object"==typeof myBrowser&&"object"==typeof otherBrowser&&(myBrowser.width>otherBrowser.width?virtualclass.wb.gObj.virtualWindow||
(virtualclass.wb.utility.createVirtualWindow(otherBrowser),virtualclass.wb.gObj.virtualWindow=!0):myBrowser.width<otherBrowser.width&&!virtualclass.wb.gObj.virtualWindow&&(a=document.getElementById("vcanvas"),a=virtualclass.wb.utility.getElementRightOffSet(a),roles.hasControls()?virtualclass.vutil.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a,toolHeight:f}}):virtualclass.vutil.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a}})))}};c.view=a})(window);(function(c){var a={init:function(){this.wbRtc={};this.wbRtc.className="webrtcCont";this.mybrowser={};return this},isCanvasSupport:function(a,d,f){console.log("is canvas support");console.log(a);console.log(d);return"MSIE"==d?9!=f?!1:!0:c.CanvasRenderingContext2D?!0:!1},isWebSocketSupport:function(a,d,f){return"undefined"==typeof c.WebSocket||"function"!=typeof c.WebSocket&&"object"!=typeof c.WebSocket||!c.WebSocket.hasOwnProperty("OPEN")?!1:!0},isLocalStorageSupport:function(){return void 0!==Storage},
isGetUserMediaSupport:function(a,d){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return navigator.getUserMedia?!0:!1},isIndexedDbSupport:function(){return c.indexedDB||c.webkitIndexedDB||c.mozIndexedDB||c.msIndexedDB?!0:!1},isWorkerSupport:function(){return!!c.Worker},isAudioApiSupport:function(){return c.AudioContext||c.webkitAudioContext?!0:!1},isTypedArraySupport:function(){return!!("ArrayBuffer"in c)},isScreenShareSupport:function(a,
d){return"Firefox"==a?34<=d:"Chrome"==a?39<=d?!0:!1:!1},setValue:function(a,d){this[a]=d},checkBrowserFunctions:function(a,d){this.setValue("canvas",this.isCanvasSupport());this.setValue("webSocket",this.isWebSocketSupport());this.setValue("getusermedia",this.isGetUserMediaSupport());this.setValue("indexeddb",this.isIndexedDbSupport());this.setValue("webworker",this.isWorkerSupport());this.setValue("webaudio",this.isAudioApiSupport());this.setValue("typedarray",this.isTypedArraySupport());this.setValue("screenshare",
this.isScreenShareSupport(a,d));this.setValue("localstorage",this.isLocalStorageSupport())},measureResoultion:function(a){var d=document.getElementById("virtualclassCont"),d=vcan.utility.getElementOffset(d),f=d.x;return{width:1024>a.width?1024-(f+10):a.width-f,height:a.height-d.y}},setAppDimension:function(){var b=this.measureResoultion({width:c.innerWidth,height:c.innerHeight});virtualclass.vutil.setContainerWidth(b,virtualclass.currApp);"Whiteboard"==virtualclass.currApp&&a.setCanvasDimension(b)},
setCanvasDimension:function(a){if("undefined"!=typeof vcan.main.canvas){var d=vcan.main.canvas;ctx=vcan.main.canvas.getContext("2d");d.width=a.width;var f=virtualclass.isPlayMode?85:10,f=roles.hasControls()||roles.hasAdmin()?65:f;d.height=a.height-f;console.log("canvas width "+d.width);a=vcan.utility.getElementOffset(document.getElementById("canvas"));vcan.main.offset.x=a.x}},getResoultion:function(a){var d={};1280>a?(d.width=1024,d.height=768):1280<=a&&1366>a?(d.width=1280,d.height=1024):1366<=a&&
1920>a?(d.width=1366,d.height=768):1920<=a&&(d.width=1920,d.height=1080);return d},reportBrowser:function(a){a=this.getErrors(a);1<a.length?virtualclass.error.push(a.join(",")+" are disabled in your browser."):1==a.length&&virtualclass.error.push(a+" is disabled in your browser.")},getErrors:function(a){var d=[],f="canvas webSocket getusermedia webaudio indexeddb localstorage typedarray".split(" ");"t"!=a&&"e"!=a||f.push("webworker","screenshare");for(a=0;a<f.length;a++)this[f[a]]||("screenshare"==
f[a]&&(virtualclass.gObj.errNotScreenShare=!0),d.push(virtualclass.lang.getString("err"+f[a])));return d},isiOSDevice:function(){return parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1},isAndroid:function(){return-1<navigator.userAgent.toLowerCase().indexOf("android")},check:function(){var a=this.isiOSDevice();this.device="desktop";if(a){var d="iOS";this.device="mobTab"}else var f=
this.isAndroid(),a=this.mybrowser.detection(),d=a[0],a=parseFloat(a[1]);this.mybrowser.name=d;this.mybrowser.version=a;this.checkBrowserFunctions(d,a);"undefined"!=typeof f&&f?(this.device="mobTab",roles.hasControls()?(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("supportDesktopOnly"))):f&&("Chrome"==d?40<=a?virtualclass.vutil.initDisableAudVid():(virtualclass.error.push(virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",[d,
a]))),virtualclass.vutil.initDisableVirtualClass()):(virtualclass.error.push(virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",[d,a]))),virtualclass.vutil.initDisableVirtualClass()))):"Chrome"==d&&40<=a||"Firefox"==d&&35<=a||roles.isStudent()&&d=="OPR">a>=26?this.reportBrowser(virtualclass.gObj.uRole):"Chrome"==d&&40>a||"Firefox"==d&&35>a||roles.isStudent()&&"OPR"==d&&26>a?(this.reportBrowser(virtualclass.gObj.uRole),virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",
[d,a]))):"OPR"==d&&26<=a?(this.reportBrowser(virtualclass.gObj.uRole),roles.hasControls()&&virtualclass.error.push(virtualclass.lang.getString("operaBrowserIssue",[d,a]))):"Safari"==d?8<=a?roles.hasControls()?(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("teacherSafariBrowserIssue",[d,a]))):(virtualclass.vutil.initDisableAudVid(),virtualclass.error.push(virtualclass.lang.getString("studentSafariBrowserIssue",[d,a])),virtualclass.user.control.audioWidgetDisable()):
(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("safariBrowserIssue",[d,a]))):"iOS"==d?/(iPad)/g.test(navigator.userAgent)?roles.isStudent()?8<=a?(virtualclass.vutil.initDisableAudVid(),virtualclass.gObj.iosIpadbAudTrue=!1,d=document.createElement("div"),d.innerHTML=virtualclass.lang.getString("iosAudEnable"),d.id="iosAudioTrigger",d.addEventListener("click",function(){virtualclass.vutil.firstiOSaudioCall();this.parentNode.removeChild(this)}),f=document.getElementById("audioWidget"),
f.parentNode.insertBefore(d,f.nextSibling)):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("ios7support"))):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("supportDesktop"))):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("notSupportIphone"))):(this.mybrowser.detectIE()?(virtualclass.gObj.errIE=!0,virtualclass.error.push(virtualclass.lang.getString("ieBrowserIssue"))):
virtualclass.error.push(virtualclass.lang.getString("commonBrowserIssue",[d,a])),virtualclass.vutil.initDisableVirtualClass())}},a=a.init();c.addEventListener("resize",function(){c.earlierWidth!=c.innerWidth&&a.setAppDimension()});c.addEventListener("resize",function(){c.earlierWidth!=c.innerWidth&&virtualclass.view.window.resize()});a.mybrowser.detectIE=function(){var a=c.navigator.userAgent,d=a.indexOf("MSIE ");if(0<d)return parseInt(a.substring(d+5,a.indexOf(".",d)),10);if(0<a.indexOf("Trident/"))return d=
a.indexOf("rv:"),parseInt(a.substring(d+3,a.indexOf(".",d)),10);d=a.indexOf("Edge/");return 0<d?parseInt(a.substring(d+5,a.indexOf(".",d)),10):!1};a.mybrowser.detection=function(){var a=navigator.userAgent,d,f=a.match(/(opera|opr|OPR(?=\/))\/?\s*([\d\.]+)/i)||[];if(0>=f.length&&(f=a.match(/(chrome|safari|firefox|trident(?=\/))\/?\s*([\d\.]+)/i)||[],"Safari"==f[1])){var g=a.match(/(version(?=\/))\/?\s*([\d\.]+)/i)||[];f[2]=g[2]}if(/trident/i.test(f[1]))return d=/\brv[ :]+(\d+(\.\d+)?)/g.exec(a)||[],
"IE "+(d[1]||"");f=f[2]?[f[1],f[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(d=a.match(/version\/([\.\d]+)/i))&&(f[2]=d[1]);return f};c.system=a})(window);(function(c){c.packContainer=function(){return{createPacketContDiv:function(a,b){var d=document.createElement("div");"undefined"!=typeof a&&(d.id=a);"undefined"!=typeof b&&(d.clasName=b);return d},togglePacketCont:function(a){for(var b=this.className.split(" "),d=0;d<b.length;d++)if("display"==b[d]){this.className="hide";this.innerHTML="+";a._togglePacketCont(b[d]);break}else if("hide"==b[d]){this.className="display";this.innerHTML="-";a._togglePacketCont(b[d]);break}},_togglePacketCont:function(a){a=
"display"==a?"none":"block";document.getElementById("dataInfoHeading").style.display=a;var b=document.getElementById("packetContainer");b.style.display=a;b=document.getElementById("informationCont");b.style.display=a}}}})(window);(function(c){c.draw_object=function(a,b,d){var f=this;d.started=!1;var g,c,m=[];d.mousedown=function(b,g){(new Date).getTime();b.detail.hasOwnProperty("cevent")&&(b.clientX=b.detail.cevent.x+f.vcan.main.offset.x,b.clientY=b.detail.cevent.y+f.vcan.main.offset.y,b.x=b.detail.cevent.x+f.vcan.main.offset.x,b.y=b.detail.cevent.x+f.vcan.main.offset.y,b.pageX=b.detail.cevent.x+f.vcan.main.offset.x,b.pageY=b.detail.cevent.y+f.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);var c=f.vcan;
lastmousemovetime=null;d.startPosX=b.currX;d.startPosY=b.currY;virtualclass.wb.gObj.spx=d.startPosX;virtualclass.wb.gObj.spy=d.startPosY;if("create"==c.getStates("action")){var m=(new Date).getTime();if("text"!=a&&"t_clearall"!=f.tool.cmd){var h=c.getStates("currentTransform");if(""==h||null==h)b.detail.hasOwnProperty("cevent")||c.optimize.calculatePackets(m,"d",d.startPosX,d.startPosY),d.started=!0}else f.obj.drawTextObj.muser=!1,b.detail.hasOwnProperty("cevent")||"t_clearall"==f.tool.cmd?f.obj.drawTextObj.muser=
!0:f.utility.clickOutSidebox(f.obj.drawTextObj.textWriteMode)&&c.optimize.calculatePackets(m,"d",d.startPosX,d.startPosY),b.detail.hasOwnProperty("cevent")?b.detail.cevent.hasOwnProperty("mtext")?f.obj.drawTextObj.textUtility(d.startPosX,d.startPosY,b.detail.cevent.mtext):f.obj.drawTextObj.textUtility(d.startPosX,d.startPosY):"object"==typeof f.obj.drawTextObj&&f.obj.drawTextObj.textUtility(d.startPosX,d.startPosY)}"freeDrawing"==a&&!0==f.obj.freeDrawObj.freesvg&&f.obj.freeDrawObj.drawStart(b)};d.mousemove=
function(b,s){b.detail.hasOwnProperty("cevent")&&(b.clientX=b.detail.cevent.x+f.vcan.main.offset.x,b.clientY=b.detail.cevent.y+f.vcan.main.offset.y,b.x=b.detail.cevent.x+f.vcan.main.offset.x,b.y=b.detail.cevent.x+f.vcan.main.offset.y,b.pageX=b.detail.cevent.x+f.vcan.main.offset.x,b.pageY=b.detail.cevent.y+f.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);if(d.started&&"t_clearall"!=f.tool.cmd)if(void 0!=f.obj.freeDrawObj&&!0==f.obj.freeDrawObj.freesvg){if(f.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&
(f.obj.freeDrawObj.wb_draw(b),!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))){"undefined"!=typeof s||"undefined"!=typeof lastmousemovetime&&null!=lastmousemovetime||(lastmousemovetime=(new Date).getTime(),vcan.optimize.calculatePackets(lastmousemovetime,"m",b.currX,b.currY));var v=(new Date).getTime(),v=vcan.makeStackObj(v,"m",b.currX,b.currY);m.push(v);if("undefined"==typeof s&&(presentmousemovetime=(new Date).getTime(),2E3<=presentmousemovetime-
lastmousemovetime)){for(v=0;v<m.length;v++)f.uid++,m[v].uid=f.uid,vcan.main.replayObjs.push(m[v]);virtualclass.vutil.beforeSend({repObj:m,cf:"repObj"});virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs));m=[];lastmousemovetime=(new Date).getTime()}}}else{g=b.currX;c=b.currY;""!=f.prvObj&&f.canvas.removeObject(f.prvObj);var v=f.makeobj(d.startPosX,d.startPosY,g,c,a),x=f.canvas.readyObject(v);f.canvas.addObject(x);x.coreObj.usrCurrAction="create";v=(new Date).getTime();if("undefined"==
typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=(new Date).getTime(),(!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))&&"text"!=a&&"t_clearall"!=f.tool.cmd&&vcan.optimize.calculatePackets(v,"m",g,c);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&((!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))&&"text"!=a&&"t_clearall"!=
f.tool.cmd&&vcan.optimize.calculatePackets(v,"m",g,c),lastmousemovetime=(new Date).getTime());f.prvObj=x.coreObj}else"move"==f.vcan.main.action&&(""!=vcan.main.currentTransform&&null!=vcan.main.currentTransform||"move"!=f.vcan.main.action)||virtualclass.vutil.beforeSend({createArrow:!0,x:b.currX,y:b.currY,cf:"createArrow"})};d.mouseup=function(b,s){b.detail.hasOwnProperty("cevent")&&(b.clientX=b.detail.cevent.x+f.vcan.main.offset.x,b.clientY=b.detail.cevent.y+f.vcan.main.offset.y,b.x=b.detail.cevent.x+
f.vcan.main.offset.x,b.y=b.detail.cevent.x+f.vcan.main.offset.y,b.pageX=b.detail.cevent.x+f.vcan.main.offset.x,b.pageY=b.detail.cevent.y+f.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);g=b.currX;c=b.currY;lastmousemovetime=null;if(d.started&&"text"!=a){d.mousemove(b,"up");if((!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))&&"freeDrawing"!=a){var v=(new Date).getTime();vcan.optimize.calculatePackets(v,"u",g,c)}if(void 0!=
f.obj.freeDrawObj&&!0==f.obj.freeDrawObj.freesvg&&(f.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&f.obj.freeDrawObj.finalizeDraw(b),(!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))&&0<m.length)){v=(new Date).getTime();v=vcan.makeStackObj(v,"u",g,c);m.push(v);for(v=0;v<m.length;v++)f.uid++,m[v].uid=f.uid,vcan.main.replayObjs.push(m[v]);virtualclass.vutil.beforeSend({repObj:m,cf:"repObj"});virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs));
m=[]}""!=f.prvObj&&(f.prvObj="");f.prvObj="";d.started=!1}f.vcan.wb.sentPack&&(f.vcan.wb.sentPack=!1)}}})(window);(function(c){c.makeobj=function(a,b,d,f,g){var c={mp:{}};c.mp.x=d;c.mp.y=f;if(a>d){var m=d,p=f;d=a;f=b;a=m;b=p;c.dRoad="b2t"}else c.dRoad="t2b";c.type=g;if("rectangle"==g||"triangle"==g)c.sx=a,c.sy=b,c.ex=d,c.ey=f;if("line"==g)c.lineColor="#424240",c.lineWidth=3,c.start={x:a,y:b},c.end={x:d,y:f};else if("rectangle"==g)c.width=d-a,c.height=f-b,c.borderColor="#424240",c.lineWidth=3;else if("oval"==g)c.lineWidth=3,c.borderColor="#424240",c.width=d-a,c.height=f-b,c.x=d-c.width/2,c.y=f-c.height/2,c.rx=
c.width/2,c.ry=c.height/2;else if("triangle"==g)c.lineWidth=3,c.borderColor="#424240";else if("text"==g)return;return c}})(window);(function(c){var a=c.vcan;a.utility={canvasCalcOffset:function(b){var d=a.main;b=document.getElementById(b);b=a.utility.getElementOffset(b);return d.offset=b},getElementOffset:function(a){var d=0,f=0;do d+=a.offsetTop||0,f+=a.offsetLeft||0,a=a.offsetParent;while(a);return{x:f,y:d}},setVal:function(b,d,f){("scaleX"===d||"scaleY"===d)&&f<b.MIN_SCALE_LIMIT&&(f=b.MIN_SCALE_LIMIT);if("object"==typeof d)for(var c in d)a.utility.setVal(b,c,d[c]);else"angle"===d?a.utility.setAngle(b,f):b[d]=f;return b},getVal:function(a,
d){return a[d]},setAngle:function(a,d){a.theta=d/180*Math.PI;a.angle=d;return a},actualPointer:function(b){return{x:a.utility.pointerX(b),y:a.utility.pointerY(b)}},pointerX:function(a){var d=document.documentElement,f=document.body||{scrollLeft:0};return a.pageX||("unknown"!=typeof a.clientX?a.clientX:0)+(d.scrollLeft||f.scrollLeft)-(d.clientLeft||0)},pointerY:function(a){var d=document.documentElement,f=document.body||{scrollTop:0};return a.pageY||("unknown"!=typeof a.clientY?a.clientY:0)+(d.scrollTop||
f.scrollTop)-(d.clientTop||0)},getReltivePoint:function(b){var d=a.main.offset;b=a.utility.actualPointer(b);return{x:b.x-d.x,y:b.y-d.y}},degreesToRadians:function(a){return Math.PI/180*a},setActiveObject:function(b){a.main.activeObject&&a.main.activeObject.setActive(!1);a.main.activeObject=b;b.setActive(!0);return b},updateObj:function(a){var d={};for(prop in a)"oCoords"!=prop?d[prop]=a[prop]:(d.start={},d.end={},d.start.x=a[prop].tl.x,d.start.y=a[prop].tl.y,d.end.x=a[prop].br.x,d.end.y=a[prop].br.y);
return d},setCursorFromEvent:function(a,d,f){var c=a.upperCanvasEl.style;if(f)if(d=f.findTargetCorner(d))if(d in a.cursorMap)c.cursor=a.cursorMap[d];else if("mtr"===d&&f.hasRotatingPoint)c.cursor=a.rotationCursor;else return c.cursor=this.defaulCursor,!1;else c.cursor=a.hoverCursor;else return c.cursor=this.defaultCursor,!1;return!0},getChildren:function(){return a.main.children}}})(window);(function(c){var a=c.vcan;a.main.prototype={addObject:function(b){if("object"==typeof b.coreObj){"freehand"!=b.coreObj.type&&a.main.children.push(b.coreObj);var d=a.main.canvas.getContext("2d");a.render(d,b.coreObj)}},removeObject:function(b){a.remove(b)},bind:function(b,d){a.events().bind(a.main.canvas,b,d)},readyObject:function(b,d){b=a.extend({},b);d||void 0!=b.id||(a.main.id++,b.id=a.main.id);b.cornersize=12;b.rotatingPointOffset=40;b.selectable=!0;b.downObj=!1;b.active=!1;b.cornersize=12;b.padding=
0;b.hasControls=!0;b.cornerColor="rgba(102,153,255,0.5)";void 0==b.borderColor&&(b.borderColor="#000");b.flipX=!1;b.flipY=!1;b.draggable=!1;b.hasBorders=!0;b.hasRotatingPoint=!1;b.hideCorners=!1;b.lockRotation=!1;b.MIN_SCALE_LIMIT=.1;b.borderOpacityWhenMoving=.4;b.hasOwnProperty("theta")||(b.theta=0);b.hasOwnProperty("scaleX")||(b.scaleX=1);b.hasOwnProperty("scaleY")||(b.scaleY=1);"line"==b.type?(a.objLine=new a.line,a.objLine.init(b)):"rectangle"==b.type?(a.objRect=new a.rectangle,a.objRect.init(b)):
"oval"==b.type?(a.objOval=new a.oval,a.objOval.init(b)):"triangle"==b.type?(a.objTri=new a.triangle,a.objTri.init(b)):"text"==b.type&&(a.objTxt=new a.text,a.objTxt.init(b));b.getWidth=function(){return this.width*this.scaleX};b.getHeight=function(){return this.height*this.scaleY};b.setCoords=function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this.hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this.angle=Math.atan(this.currentHeight/
this.currentWidth);this.theta=this.theta;var d=Math.cos(this.angle+this.theta)*this.hypotenuse,c=Math.sin(this.angle+this.theta)*this.hypotenuse,h=this.theta,m=Math.sin(h),h=Math.cos(h),d={x:this.x-d,y:this.y-c},c={x:d.x+this.currentWidth*h,y:d.y+this.currentWidth*m},p={x:d.x-this.currentHeight*m,y:d.y+this.currentHeight*h};this.oCoords={tl:d,tr:c,br:{x:c.x-this.currentHeight*m,y:c.y+this.currentHeight*h},bl:p,ml:{x:d.x-this.currentHeight/2*m,y:d.y+this.currentHeight/2*h},mt:{x:d.x+this.currentWidth/
2*h,y:d.y+this.currentWidth/2*m},mr:{x:c.x-this.currentHeight/2*m,y:c.y+this.currentHeight/2*h},mb:{x:p.x+this.currentWidth/2*h,y:p.y+this.currentWidth/2*m},mtr:{x:d.x+this.currentWidth/2*h,y:d.y+this.currentWidth/2*m}};this.setCornerCoords();b.findTargetCorner=function(d){var f=a.main.offset;if(!this.hasControls)return!1;var c=a.utility.actualPointer(d);d=c.x-f.x;var f=c.y-f.y,g;for(g in this.oCoords){if("mtr"===g&&!this.hasRotatingPoint)break;c=a.virtual_box.getImageLines(this.oCoords[g].corner,
g);c=a.virtual_box.findCrossPoints(d,f,c);if(1==c%2&&0!=c)return b.corner=g}return!1};return this};b.drawBorders=function(a){if(this.hasBorders){var d=this.padding,b=2*d;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var c=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX),p=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(c,p);c=this.getWidth();p=this.getHeight();
a.strokeRect(~~(-(c/2)-d)+.5,~~(-(p/2)-d)+.5,~~(c+b),~~(p+b));!this.hasRotatingPoint||this.hideCorners||this.lockRotation||(d=(this.flipY?p:-p)/2,a.beginPath(),a.moveTo(0,d),a.lineTo(0,d+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),a.closePath(),a.stroke());a.restore();return this}};b.drawCorners=function(a){if(this.hasControls){var d=this.cornersize,b=d/2,c=this.padding,p=-(this.width/2),s=-(this.height/2),v=d/this.scaleX,x=d/this.scaleY,t=(c+b)/this.scaleY,w=(c+b)/this.scaleX,
q=(c+b-d)/this.scaleX,b=(c+b-d)/this.scaleY,c=this.height;a.save();a.fillStyle=this.cornerColor;a.fillRect(p-w,s-t,v,x);d=p+this.width-w;a.fillRect(d,s-t,v,x);a.fillRect(p-w,s+c+b,v,x);d=p+this.width+q;a.fillRect(d,s+c+b,v,x);d=p+this.width/2-w;a.fillRect(d,s-t,v,x);d=p+this.width/2-w;a.fillRect(d,s+c+b,v,x);d=p+this.width+q;a.fillRect(d,s+c/2-t,v,x);a.fillRect(p-w,s+c/2-t,v,x);this.hasRotatingPoint&&(d=p+this.width/2-w,p=this.flipY?s+c+this.rotatingPointOffset/this.scaleY-x/2:s-this.rotatingPointOffset/
this.scaleY-x/2,a.fillRect(d,p,v,x));a.restore();return this}};b.setActive=function(a){this.active=!!a;return this};b.dragDrop=function(a){this.draggable=void 0!=a?a:!1};b.setCornerCoords=function(){var d=this.oCoords,b=a.utility.degreesToRadians(45-this.getAngle()),c=Math.sqrt(2*Math.pow(this.cornersize,2))/2,m=c*Math.cos(b),b=c*Math.sin(b),c=Math.sin(this.theta),p=Math.cos(this.theta);d.tl.corner={tl:{x:d.tl.x-b,y:d.tl.y-m},tr:{x:d.tl.x+m,y:d.tl.y-b},bl:{x:d.tl.x-m,y:d.tl.y+b},br:{x:d.tl.x+b,y:d.tl.y+
m}};d.tr.corner={tl:{x:d.tr.x-b,y:d.tr.y-m},tr:{x:d.tr.x+m,y:d.tr.y-b},br:{x:d.tr.x+b,y:d.tr.y+m},bl:{x:d.tr.x-m,y:d.tr.y+b}};d.bl.corner={tl:{x:d.bl.x-b,y:d.bl.y-m},bl:{x:d.bl.x-m,y:d.bl.y+b},br:{x:d.bl.x+b,y:d.bl.y+m},tr:{x:d.bl.x+m,y:d.bl.y-b}};d.br.corner={tr:{x:d.br.x+m,y:d.br.y-b},bl:{x:d.br.x-m,y:d.br.y+b},br:{x:d.br.x+b,y:d.br.y+m},tl:{x:d.br.x-b,y:d.br.y-m}};d.ml.corner={tl:{x:d.ml.x-b,y:d.ml.y-m},tr:{x:d.ml.x+m,y:d.ml.y-b},bl:{x:d.ml.x-m,y:d.ml.y+b},br:{x:d.ml.x+b,y:d.ml.y+m}};d.mt.corner=
{tl:{x:d.mt.x-b,y:d.mt.y-m},tr:{x:d.mt.x+m,y:d.mt.y-b},bl:{x:d.mt.x-m,y:d.mt.y+b},br:{x:d.mt.x+b,y:d.mt.y+m}};d.mr.corner={tl:{x:d.mr.x-b,y:d.mr.y-m},tr:{x:d.mr.x+m,y:d.mr.y-b},bl:{x:d.mr.x-m,y:d.mr.y+b},br:{x:d.mr.x+b,y:d.mr.y+m}};d.mb.corner={tl:{x:d.mb.x-b,y:d.mb.y-m},tr:{x:d.mb.x+m,y:d.mb.y-b},bl:{x:d.mb.x-m,y:d.mb.y+b},br:{x:d.mb.x+b,y:d.mb.y+m}};d.mtr.corner={tl:{x:d.mtr.x-b+c*this.rotatingPointOffset,y:d.mtr.y-m-p*this.rotatingPointOffset},tr:{x:d.mtr.x+m+c*this.rotatingPointOffset,y:d.mtr.y-
b-p*this.rotatingPointOffset},bl:{x:d.mtr.x-m+c*this.rotatingPointOffset,y:d.mtr.y+b-p*this.rotatingPointOffset},br:{x:d.mtr.x+b+c*this.rotatingPointOffset,y:d.mtr.y+m-p*this.rotatingPointOffset}}};b.getAngle=function(){return 180*this.theta/Math.PI};b.setZindex=function(){for(var d=0;d<a.main.children.length;d++)if(this.id==a.main.children[d].id){var b=a.main.children[d];a.main.children.splice(d,1);break}return" "!=b?(a.main.children.push(b),!0):!1};b.setupCurrentTransform=function(d){var b=a.main,
c="drag",m=a.utility.actualPointer(d);if(d=this.findTargetCorner(d))c="ml"===d||"mr"===d?"scaleX":"mt"===d||"mb"===d?"scaleY":"mtr"===d?"rotate":this.hasRotatingPoint?"scale":"rotate";b.currentTransform={target:this,action:c,scaleX:this.scaleX,scaleY:this.scaleY,offsetX:m.x-this.x,offsetY:m.y-this.y,ex:m.x,ey:m.y,x:this.x,y:this.y,theta:this.theta,width:this.width*this.scaleX};b.currentTransform.original={x:this.x,y:this.y}};"text"!=b.type&&b.setCoords();return a.makeDispObject(b)}}})(window);(function(c){var a=c.vcan;a.events=function(){return{bind:function(a,d,f){a["on"+d]=f},findTarget:function(b){for(var d,f=a.main.children,c=f.length;c--;)if(f[c]&&a.virtual_box.containsPoint(b,f[c])){d=f[c];break}if(d&&d.selectable)return d}}}})(window);(function(c){var a=c.vcan;a.virtual_box={findCrossPoints:function(a,d,f){var c,h,m,p=0,s;for(s in f)if(m=f[s],!(m.o.y<d&&m.d.y<d||m.o.y>=d&&m.d.y>=d)&&(m.o.x==m.d.x&&m.o.x>=a?c=m.o.x:(c=(m.d.y-m.o.y)/(m.d.x-m.o.x),h=d-0*a,m=m.o.y-c*m.o.x,c=-(h-m)/(0-c)),c>=a&&(p+=1),2==p))break;return p},getImageLines:function(a,d){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},containsPoint:function(b,d){var f=a.utility.getReltivePoint(b),c=f.x,f=f.y,
h=a.virtual_box.getImageLines(d.oCoords);return(c=a.virtual_box.findCrossPoints(c,f,h))&&1===c%2||d.findTargetCorner(b)?!0:!1}}})(window);(function(c){var a=c.vcan;a.interact={rotateObject:function(b,d){var f=a.main.currentTransform,c=a.main.offset;if(!f.target.lockRotation){var h=Math.atan2(f.ey-f.y-c.y,f.ex-f.x-c.x),c=Math.atan2(d-f.y-c.y,b-f.x-c.x);a.utility.setVal(f.target,"theta",c-h+f.theta)}},scaleObject:function(b,d,f){var c=a.main.currentTransform,h=a.main.offset;target=c.target;if(!target.lockScalingX||!target.lockScalingY){var m=Math.sqrt(Math.pow(c.ey-c.y-h.y,2)+Math.pow(c.ex-c.x-h.x,2));b=Math.sqrt(Math.pow(d-c.y-h.y,2)+
Math.pow(b-c.x-h.x,2));target.scaling=!0;f?"x"!==f||target.lockUniScaling?"y"!==f||target.lockUniScaling||target.lockScalingY||a.utility.setVal(target,"scaleY",c.scaleY*b/m):target.lockScalingX||a.utility.setVal(target,"scaleX",c.scaleX*b/m):(target.lockScalingX||a.utility.setVal(target,"scaleX",c.scaleX*b/m),target.lockScalingY||a.utility.setVal(target,"scaleY",c.scaleY*b/m))}},translateObject:function(b,d){var f=a.main.currentTransform.target;f.lockMovementX||a.utility.setVal(f,"x",b-a.main.currentTransform.offsetX);
f.lockMovementY||a.utility.setVal(f,"y",d-a.main.currentTransform.offsetY);return f}}})(window);(function(c){c.vcan.rectangle=function(){return{type:"rectangle",init:function(a){void 0==a.x&&(a.x=a.ex-a.width/2);void 0==a.y&&(a.y=a.ey-a.height/2);return a},draw:function(a,b,d){d=-b.width/2;var f=-b.height/2,c=b.width,h=b.height;a.beginPath();a.strokeStyle=void 0!=b.borderColor?'"'+b.strokeColor+'"':"#000";a.moveTo(d,f);a.stroke();a.lineTo(d+c,f);a.stroke();a.lineTo(d+c,f+h);a.stroke();a.lineTo(d,f+h);a.stroke();a.lineTo(d,f);a.fillStyle=void 0!=b.fillColor?b.fillColor:" ";a.closePath();a.stroke();
void 0!=b.fillColor&&(a.fillStyle=b.fillColor,a.fill())}}}})(window);(function(c){c.vcan.oval=function(){return{type:"oval",init:function(a){void 0==a.width&&(a.width=2*a.rx);void 0==a.height&&(a.height=2*a.ry);void 0==a.borderColor&&(a.borderColor="#000000");void 0!=a.fillColor&&(a.fillStyle=a.fillColor);return a},draw:function(a,b,d){a.beginPath();a.save();var c=2*Math.PI;a.lineWidth=b.lineWidth;var g=b.ry/b.rx,g=g.toFixed(3);0==g&&(g=.01);a.transform(1,0,0,g,0,0);a.arc(d?b.x:0,d?b.y:0,b.rx,0,c,!1);a.closePath();void 0!=b.fillStyle&&(a.fillStyle=b.fillStyle,a.fill());
void 0!=b.borderColor&&(a.fillStyle=b.borderColor,a.stroke());a.restore()}}}})(window);(function(c){c.vcan.triangle=function(){return{type:"triangle",init:function(a){a.fillStyle=a.fillColor;void 0==a.dRoad&&(a.dRoad="ltr");void 0==a.width&&(a.width=a.ex-a.sx);void 0==a.height&&(a.height=a.ey-a.sy);void 0==a.x&&(a.x=a.ex-a.width/2);void 0==a.y&&(a.y=a.ey-a.height/2);return a},draw:function(a,b,d){a.beginPath();if("t2b"==b.dRoad){d=b.width/2;var c=b.height/2}else d=-b.width/2,c=-b.height/2;a.lineWidth=b.lineWidth;void 0!=b.borderColor&&(a.strokeStyle=b.borderColor);a.moveTo(-d,c);a.lineTo(0,
-c);a.lineTo(d,c);a.closePath();void 0!=b.fillStyle&&(a.fillStyle=b.fillStyle,a.fill());a.stroke()}}}})(window);(function(c){c.vcan.line=function(){return{type:"line",init:function(a){var b=a.start.x,d=a.start.y,c=a.end.x,g=a.end.y;void 0==a.width&&(a.width=c-b,a.height=g-d);a.x=b+(c-b)/2;a.y=d+(g-d)/2;return a},draw:function(a,b,d){a.beginPath();d=1===b.width?0:b.width/2;var c=1===b.height?0:b.height/2;a.moveTo(1===b.width?0:-b.width/2,1===b.height?0:-b.height/2);a.lineTo(d,c);a.lineWidth=b.lineWidth;void 0!=b.lineColor&&(a.strokeStyle=b.lineColor);a.closePath();a.stroke()}}}})(window);(function(c){c.vcan.text=function(){return{type:"text",init:function(a){a.lineHeight=1.3;void 0==a.fontSize&&(a.fontSize=30);a.font=a.fontSize+"px Times New Roman";return a},draw:function(a,b,d){a.font=b.font;d=b.text.split(/\r?\n/);b.height=this.getTextHeight(a,d,b);b.width=this.getTextWidth(a,d);a.beginPath();for(var c=0,g=d.length;c<g;c++)a.fillText(d[c],-b.width/2,-b.height/2+c*b.fontSize*b.lineHeight+b.fontSize);a.closePath();b.setCoords()},getTextWidth:function(a,b){for(var d=a.measureText(b[0]).width,
c=1,g=b.length;c<g;c++){var h=a.measureText(b[c]).width;h>d&&(d=h)}return d},getTextHeight:function(a,b,d){return d.fontSize*b.length*d.lineHeight},removeTextNode:function(){for(var a=document.getElementsByClassName("textBoxContainer"),b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])}}}})(window);(function(c){var a=c.vcan;a.main.freeHandDrawing=function(b){return{type:"freeDrawing",init:function(){this.contextTop={};this.isCurrentlyDrawing=!1;this.freeDrawingXPoints=[];this.freeDrawingYPoints=[];this.mdTime=[];this.freeDrawingColor=void 0==b.borderColor?"#000000":b.borderColor;this.freeDrawingLineWidth=void 0!=b.lineWidth?b.lineWidth:"3";return this},fhdStart:function(a,b,c){c=(new Date).getTime();this.contextTop=a;this.isCurrentlyDrawing=!0;this.freeDrawingXPoints.push(b.x);this.freeDrawingYPoints.push(b.y);
this.contextTop.beginPath();this.contextTop.save();this.contextTop.moveTo(b.x,b.y);this.mdTime.push(c);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},fhRendering:function(a,b){var c=(new Date).getTime();this.freeDrawingXPoints.push(a.x);this.freeDrawingYPoints.push(a.y);this.contextTop.lineTo(a.x,a.y);this.contextTop.stroke();this.mdTime.push(c)},finalizeDrawingPath:function(d,c,g){(new Date).getTime();
this.contextTop.closePath();this.isCurrentlyDrawing=!1;var h=this.utility.min(this.freeDrawingXPoints);c=this.utility.min(this.freeDrawingYPoints);var m=this.utility.max(this.freeDrawingXPoints);g=this.utility.max(this.freeDrawingYPoints);var p=[],s,v,x,t=this.freeDrawingXPoints,w=this.freeDrawingYPoints,q=this.mdTime;p.push("M ",t[0]-h," ",w[0]-c," ",q[0]," ");for(var r=1;s=t[r],v=w[r],x=q[r];r++)p.push("L ",s-h," ",v-c," ",x," ");p=p.join("");if("M 0 0 L 0 0 "!==p)return s=this.freeDrawingXPoints[this.freeDrawingXPoints.length-
1],v=this.freeDrawingYPoints[this.freeDrawingYPoints.length-1],x=new a.Path(p,this),x.mp={},x.mp.x=s,x.mp.y=v,x.init(p),x=d.readyObject(x),x.coreObj.type="freeDrawing",x=x.coreObj,x.fill=null,x.stroke=this.freeDrawingColor,x.strokeWidth=this.freeDrawingLineWidth,x.minX=h,x.minY=c,this.utility.objAdd(x),d=a.utility.setVal(x,"x",h+(m-h)/2),d=a.utility.setVal(d,"y",c+(g-c)/2),d.setCoords(),"object"==typeof b&&this.contextTop.restore(),a.renderAll(this.contextTop),d},utility:{max:function(a,b){if(a&&
0!==a.length){var c=a.length-1,h=b?a[c][b]:a[c];if(b)for(;c--;)a[c][b]>=h&&(h=a[c][b]);else for(;c--;)a[c]>=h&&(h=a[c]);return h}},min:function(a,b){if(a&&0!==a.length){var c=a.length-1,h=b?a[c][b]:a[c];if(b)for(;c--;)a[c][b]<h&&(h=a[c][b]);else for(;c--;)a[c]<h&&(h=a[c]);return h}},objAdd:function(d){a.main.children.push(d);return this}}}}})(window);(function(c){var a=c.vcan;a.Path=function(b,d){return{objectType:"path",init:function(a,d){d=d||{};this.commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};if(!a)throw Error("`path` argument is required");if(this.path=a.match&&a.match(/[a-zA-Z][^a-zA-Z]*/g))return this.initializeFromArray(d),this},initializeFromArray:function(a){var d="width"in a,b="height"in a;this.path=this._parsePath();d&&b||(this.utility.extend(this,this._parseDimensions()),d&&(this.width=a.width),b&&(this.height=a.height))},
_render:function(a){var d,b=0;d=0;for(var c=-(this.width/2),p=-(this.height/2),s=0,v=this.path.length;s<v;++s)switch(d=this.path[s],d[0]){case "L":b=d[1];d=d[2];a.lineTo(b+c,d+p);break;case "M":b=d[1],d=d[2],a.moveTo(b+c,d+p)}},replay_render:function(a,d,b,c){var p=y=0;switch(d[0]){case "L":p+=d[1];y+=d[2];a.lineTo(p+b,y+c);a.stroke();break;case "M":p+=d[1],y+=d[2],a.moveTo(p+b,y+c)}},render:function(d,b){d.save();var c=this.transformMatrix;c&&d.transform(c[0],c[1],c[2],c[3],c[4],c[5]);b||a.transform(d,
this);this.overlayFill?d.fillStyle=this.overlayFill:this.fill&&(d.fillStyle=this.fill);this.stroke&&(d.strokeStyle=this.stroke);d.beginPath();this._render(d);this.fill&&d.fill();this.stroke&&(d.strokeStyle=this.stroke,d.lineWidth=this.strokeWidth,d.lineCap=d.lineJoin="round",d.stroke());!b&&this.active&&(this.drawBorders(d),this.hideCorners||this.drawCorners(d));d.restore()},_parsePath:function(){for(var a=[],d,b,c,p=0,s,v=this.path.length;p<v;p++){var x=/\d+\s$/.exec(this.path[p]);null!=x&&(d=this.path[p].indexOf(x),
this.path[p]=this.path[p].substring(0,d));d=this.path[p];b=d.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);d=[d.charAt(0)];s=0;for(var t=b.length;s<t;s++)c=parseFloat(b[s]),isNaN(c)||d.push(c);b=d[0].toLowerCase();b=this.commandLengths[b];if(d.length-1>b)for(c=1,s=d.length;c<s;c+=b)null==x?a.push([d[0]].concat(d.slice(c,c+b))):(a.push([d[0]].concat(d.slice(c,c+b))),d.push(x),a.push(d));else null!=x&&d.push(x[0]),a.push(d)}return a},_parseDimensions:function(){var a=[],b=[],c,m,p=!1,
s,v;this.path.forEach(function(d,x){if(" "!=d[3])var q=d.splice(3);"H"!==d[0]&&(c=0===x?this.utility.getX(d):this.utility.getX(this.path[x-1]));"V"!==d[0]&&(m=0===x?this.utility.getY(d):this.utility.getY(this.path[x-1]));d[0]===d[0].toLowerCase()&&(p=!0);s=p?c+this.utility.getX(d):"V"===d[0]?c:this.utility.getX(d);v=p?m+this.utility.getY(d):"H"===d[0]?m:this.utility.getY(d);var r=parseInt(s,10);isNaN(r)||a.push(r);r=parseInt(v,10);isNaN(r)||b.push(r);void 0!=q&&1<=q.length&&d.push(q[0])},this);var x=
d.utility.min(a),x={y:d.utility.min(b)-0,x:x-0,bottom:d.utility.max(b)-0,right:d.utility.max(a)-0};x.width=x.right-x.x;x.height=x.bottom-x.y;return x},utility:{getX:function(a){return"H"===a[0]?a[1]:a[a.length-2]},getY:function(a){return"V"===a[0]?a[1]:a[a.length-1]},extend:function(a,d){for(var b in d)a[b]=d[b];return a}}}}})(window);(function(c){var a=c.vcan;a.mouse=function(){return{init:function(){this.bindHandlers()},bindHandlers:function(){canvasElement=a.main.canvas;var b={mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup"};for(type in b)"mousedown"==type?canvasElement.addEventListener(type,this.mousedown,!1):"mousemove"==type?canvasElement.addEventListener(type,this.mousemove,!1):"mouseup"==type&&canvasElement.addEventListener(type,this.mouseup,!1)},mousedown:function(b,d){b.detail.hasOwnProperty("cevent")&&
"create"!=a.main.action&&(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);lastmousemovetime=null;this.moveChunk=[];if("move"==a.main.action){if(!a.main.currentTransform){var c=a.events().findTarget(b);a.utility.getReltivePoint(b);c?(0<a.main.children.length&&
c.setZindex(),c.downObj=!0,c.setupCurrentTransform(b),a.utility.setActiveObject(c),a.main.currObj=c):a.deactivateAll();void 0!=c&&a.renderAll();b.detail.hasOwnProperty("cevent")||(c=(new Date).getTime(),c=a.makeStackObj(c,"d",b.clientX-a.main.offset.x,b.clientY-a.main.offset.y),virtualclass.wb.uid++,console.log("uid "+virtualclass.wb.uid),c.uid=virtualclass.wb.uid,a.main.replayObjs.push(c),virtualclass.vutil.beforeSend({repObj:[c],cf:"repObj"}))}}else"create"==a.main.action&&(b.detail.hasOwnProperty("cevent")&&
(b.clientX=b.detail.cevent.x+virtualclass.wb.vcan.main.offset.x,b.clientY=b.detail.cevent.y+virtualclass.wb.vcan.main.offset.y,b.x=b.detail.cevent.x+virtualclass.wb.vcan.main.offset.x,b.y=b.detail.cevent.x+virtualclass.wb.vcan.main.offset.y,b.pageX=b.detail.cevent.x+virtualclass.wb.vcan.main.offset.x,b.pageY=b.detail.cevent.y+virtualclass.wb.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y),c=a.events().findTarget(b),a.utility.getReltivePoint(b),c&&"text"==c.type&&"t_text"==
virtualclass.wb.tool.cmd&&c.setupCurrentTransform(b))},mousemove:function(b){b.detail.hasOwnProperty("cevent")&&(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);if("move"==a.main.action){var d=a.main;if(d.currentTransform){var c=a.utility.actualPointer(b),
g=c.x,c=c.y;d.currentTransform.target.isMoving=!0;if("rotate"===d.currentTransform.action)a.interact.rotateObject(g,c),d.currentTransform.target.hasRotatingPoint||a.interact.scaleObject(g,c),b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b);else if("scale"===d.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b),a.interact.scaleObject(g,c);else if("scaleX"===d.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b),a.interact.scaleObject(g,
c,"x");else if("scaleY"===d.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b),a.interact.scaleObject(g,c,"y");else if(d.currentTransform.target.draggable){var h=a.extend({},a.main.currentTransform.target);(new Date).getTime();!0==d.currentTransform.target.downObj&&(a.main.dragMode=!0,d.currentTransform.target.downObj=!1);h=a.interact.translateObject(g,c);b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b);h.setActive(!0);h.setCoords()}if("scaleX"===d.currentTransform.action||
"scaleY"===d.currentTransform.action||"rotate"===d.currentTransform.action&&!d.currentTransform.target.hasRotatingPoint)a.main.scaleMode=!0,(new Date).getTime(),d.currentTransform.target.downObj&&(d.currentTransform.target.downObj=!1),h=a.extend({},a.main.currentTransform.target),h.setCoords();a.renderAll()}else a.events().findTarget(b)}},mouseup:function(b){b.detail.hasOwnProperty("cevent")&&(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+
b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);lastmousemovetime=null;if("move"==a.main.action){a.activMouse.mousemove(b);var d=a.main;if(d.currentTransform){var c=d.currentTransform.target;c.scaling&&(c.scaling=!1);for(c=d.children.length;c--;)d.children[c].setCoords()}d.currentTransform=null;a.renderAll();if(!0==a.main.dragMode||!0==a.main.scaleMode){a.utility.actualPointer(b);
var g=(new Date).getTime();(!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))&&a.optimize.calculatePackets(g,"u",b.clientX-a.main.offset.x,b.clientY-a.main.offset.y);a.main.dragMode&&(a.main.dragMode=!1);a.main.scaleMode&&(a.main.scaleMode=!1)}else!b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast")&&a.optimize.calculatePackets(g,"u",b.clientX-a.main.offset.x,b.clientY-a.main.offset.y);
a.wb.sentPack=!0}}}}})(window);(function(c){c.readyFreeHandObj=function(a,b){return{init:function(){this.freesvg=!0;this.fdObj={};this.borderColor=a;this.freeDrawingLineWidth=b},drawStart:function(a){var b=virtualclass.wb.vcan;if(!0==virtualclass.wb.obj.freeDrawObj.freesvg){var c=b.main.canvas.getContext("2d");this.fdObj=b.main.freeHandDrawing({borderColor:this.borderColor,lineWidth:this.freeDrawingLineWidth});this.fdObj.init();pointer=b.utility.getReltivePoint(a);this.fdObj.fhdStart(c,pointer)}},wb_draw:function(a){a=vcan.utility.getReltivePoint(a);
this.fdObj.fhRendering(a)},finalizeDraw:function(a){a=virtualclass.wb.vcan;virtualclass.wb.prvObj=this.fdObj.finalizeDrawingPath(virtualclass.wb.canvas);a.main.children[a.main.children.length-1].mt=virtualclass.wb.utility.stringToNumber(virtualclass.wb.prvObj.path[virtualclass.wb.prvObj.path.length-1][3])}}}})(window);(function(c){_replay=function(){return{init:function(a,b){var d=virtualclass.wb.vcan;this.objs="undefined"!=typeof b?d.getStates("replayObjs"):recorder.items;this.objNo=0;this.repMode=a;this.callBkfunc="";this.rendering=!1},makeCustomEvent:function(a,b){var d=a.hasOwnProperty("mtext")?{detail:{cevent:{x:a.x,y:a.y,mtext:a.mtext}}}:{detail:{cevent:{x:a.x,y:a.y}}};"undefined"!=typeof b&&(d.detail.broadCast=!0);d=new CustomEvent(event,d);vcan.main.canvas.dispatchEvent(d)},renderObj:function(a){if("undefined"==
typeof this.objs[this.objNo])console.log(this.objs+"is undefined cannot continue play.");else{this.rendering=virtualclass.wb.drawMode=!0;"undefined"!=typeof a&&(this.callBkfunc=a);if(this.objs[this.objNo].hasOwnProperty("cmd"))virtualclass.wb.gObj.displayedObjId=this.objs[this.objNo].uid,virtualclass.wb.toolInit(this.objs[this.objNo].cmd,"fromFile",!0);else{a="";if("del"==this.objs[this.objNo].ac)""!=vcan.main.currObj&&(virtualclass.wb.utility.removeSelectedItem(vcan.main.currObj,!0,!0),console.log("Whiteboard Delete:-  Performing delete operation:-"));
else{"d"==this.objs[this.objNo].ac?a="mousedown":"m"==this.objs[this.objNo].ac?a="mousemove":"u"==this.objs[this.objNo].ac&&(a="mouseup");var b=this.objs[this.objNo],b=b.hasOwnProperty("mtext")?{detail:{cevent:{x:b.x,y:b.y,mtext:b.mtext}}}:{detail:{cevent:{x:b.x,y:b.y}}};a=new CustomEvent(a,b);vcan.main.canvas.dispatchEvent(a)}virtualclass.wb.gObj.displayedObjId=this.objs[this.objNo].uid}console.log("Whiteboard : Till now play "+virtualclass.wb.gObj.displayedObjId);this.objs[this.objs.length-1].uid==
virtualclass.wb.gObj.displayedObjId&&("function"==typeof this.callBkfunc&&this.callBkfunc("callBkfunc"),this.rendering=!1);roles.hasControls()&&virtualclass.wb.gObj.tempRepObjs[virtualclass.wb.gObj.tempRepObjs.length-1].uid==virtualclass.wb.gObj.displayedObjId&&(vcan.main.replayObjs=virtualclass.wb.gObj.tempRepObjs);if("object"==typeof this.objs[this.objNo+1]){virtualclass.wb.replayTime="undefined"!=typeof this.repMode&&"fromBrowser"==this.repMode?0:0==this.objNo?0:this.objs[this.objNo+1].mt-this.objs[this.objNo].mt;
this.objNo++;var d=this;setTimeout(function(){d.renderObj.call(d)},virtualclass.wb.replayTime)}}}}};c._replay=_replay})(window);(function(c){c.readyTextObj=function(){return{init:function(a){this.currTextObjWrapper=this.prevTextObj="";this.currObject={};this.prvModTextObj={};this.prvCurrTransform={};this.totalBox=this.textWriteMode=0;this.boxContainer=a;this.muser=!1},textUtility:function(a,b,d){this.startPosX=a;this.startPosY=b;var c=virtualclass.wb.vcan,g=c.main.canvas.getContext("2d"),h={};this.textWriteMode++;this.wmode=!0;void 0!=c.main.currentTransform&&""!=c.main.currentTransform?(this.currObject=c.main.currentTransform.target,
void 0!=this.currObject&&"text"==this.currObject.type&&(h={width:300,height:100,x:this.currObject.oCoords.tl.x,y:this.currObject.oCoords.tl.y,text:this.currObject.text},virtualclass.wb.utility.clickOutSidebox(this.textWriteMode)||virtualclass.wb.obj.drawTextObj.drawTextBoxWrapper(h,this.currObject.id),c.main.currentTransform=""),virtualclass.wb.utility.clickOutSidebox(this.textWriteMode)&&virtualclass.wb.obj.drawTextObj.renderText(this.prvCurrTransform,this.prvModTextObj,g),void 0!=this.currObject&&
"text"==this.currObject.type&&(this.prvModTextObj={prvObjId:this.currObject.id,prvText:this.currObject.text,x:this.currObject.x,y:this.currObject.y},this.prvTextObj=this.currObject),this.prvCurrTransform=this.currObject):virtualclass.wb.utility.clickOutSidebox(this.textWriteMode)?"undefined"!=typeof d?virtualclass.wb.obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,g,d):virtualclass.wb.obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,g):(this.totalBox++,h={x:a,y:b,width:300,
height:100},"undefined"==typeof d?virtualclass.wb.obj.drawTextObj.drawTextBoxWrapper(h,this.totalBox):virtualclass.wb.obj.drawTextObj.drawTextBoxWrapper(h,this.totalBox,d))},drawTextBoxWrapper:function(a,b,d){var c=virtualclass.wb.vcan;d=document.createElement("div");d.id="box"+b;d.className="textBoxContainer";d.style.position="absolute";d.style.left=c.main.offset.x+a.x+"px";d.style.top=a.y+"px";b=document.createElement("textarea");b.id=d.id+"textarea";b.className="whiteBoardTextBox";b.rows=8;b.cols=
41;void 0!=a.text&&""!=a.text&&(b.value=a.text);d.appendChild(b);document.getElementById(this.boxContainer).appendChild(d);this.prevTextObj=d;this.currTextObjWrapper=a;this.prevTextObj.measure=a;virtualclass.wb.utility.toolWrapperDisable(!0);roles.hasControls()||(b.style.display="none",roles.hasAdmin()&&virtualclass.wb.utility.toolWrapperEnable(!0));console.log("Text Command:- Create text wrapper box")},renderText:function(a,b,d,c){var g=virtualclass.wb.vcan;if(""!=this.prevTextObj){if(!virtualclass.wb.utility.IsObjEmpty(a))for(var h=
0;h<g.main.children.length;h++)if(a.id==g.main.children[h].id){g.main.children.splice(h,1);this.currObject="";break}virtualclass.wb.utility.IsObjEmpty(a)?"undefined"!=typeof c?this.finalizeText(d,this.prevTextObj,"undefined",c):this.finalizeText(d,this.prevTextObj):"undefined"!=typeof c?this.finalizeText(d,this.prevTextObj,b,c):this.finalizeText(d,this.prevTextObj,b);virtualclass.wb.obj.drawTextObj.wmode=!1}},finalizeText:function(a,b,d,c){d=virtualclass.wb.vcan;var g=document.getElementById(b.id),
h="";if("undefined"==typeof c){c=g.getElementsByTagName("textarea");for(var m=0;m<c.length;m++)if(c[m].id==g.id+"textarea"){h=c[m].value;break}}else h=c;a.font="20px Times New Roman";var p=0,s=h.split(/\r?\n/),p=a.measureText(s[0]).width;c=13;for(m=1;m<s.length;m++){c+=13;var v=a.measureText(s[m]).width;v>p&&(p=v)}p/=2;m=(new Date).getTime();a={type:"text",text:h,x:b.measure.x+p,y:b.measure.y+c,fontSize:20,fontWidth:a.measureText(h).width,mp:{x:b.measure.x,y:b.measure.y}};!1==virtualclass.wb.obj.drawTextObj.muser&&
(h={mt:m,ac:"d",x:this.startPosX,y:this.startPosY,mtext:a.text},virtualclass.wb.uid++,h.uid=virtualclass.wb.uid,d.main.replayObjs.push(h),virtualclass.storage.store(JSON.stringify(d.main.replayObjs)),virtualclass.vutil.beforeSend({repObj:[h],cf:"repObj"}));a=virtualclass.wb.canvas.readyObject(a);virtualclass.wb.canvas.addObject(a);d.main.children[d.main.children.length-1].mt=m;g.parentNode.removeChild(b);d.renderAll();virtualclass.wb.utility.toolWrapperEnable(!0)},finalizeTextIfAny:function(a){var b=
document.getElementById("canvasWrapper");null!=b&&null!=b.getElementsByClassName("whiteBoardTextBox")&&("undefined"==typeof a||"undefined"!=typeof a&&0!=virtualclass.wb.obj.drawTextObj.textWriteMode%2)&&virtualclass.wb.obj.drawTextObj.textUtility()}}}})(window);(function(c){c.keyBoard={prvTool:"",skey:!1,triggerActiveAll:function(a){a.shiftKey&&(virtualclass.wb.keyBoard.skey=!0,virtualclass.wb.keyBoard.prvTool=virtualclass.wb.tool.cmd,virtualclass.wb.toolInit("t_activeall"),a={cmd:"t_activeall",mt:(new Date).getTime()},vcan.main.replayObjs.push(a),virtualclass.vutil.beforeSend({repObj:[a],cf:"repObj"}),virtualclass.wb.vcan.main.action="move")},triggerdeActiveAll:function(a){virtualclass.wb.keyBoard.skey&&(a=(new Date).getTime(),virtualclass.wb.utility.deActiveFrmDragDrop(),
virtualclass.wb.toolInit(virtualclass.wb.keyBoard.prvTool),a={cmd:virtualclass.wb.keyBoard.prvTool,mt:a},vcan.main.replayObjs.push(a),virtualclass.vutil.beforeSend({repObj:[a],cf:"repObj"}))}}})(window);(function(c){c.adapter=function(){return{RTCPeerConnection:null,webrtcDetectedBrowser:null,init:function(a){virtualclass.system.getusermedia&&(a.mozGetUserMedia?(c.webrtcDetectedBrowser="firefox",this.RTCPeerConnection=mozRTCPeerConnection,this.RTCSessionDescription=mozRTCSessionDescription,this.RTCIceCandidate=mozRTCIceCandidate,a.getUserMedia=a.mozGetUserMedia,this.attachMediaStream=function(a,d){this.videoAdd=!0;var f=c.URL||c.webkitURL;a.src=f?f.createObjectURL(d):d;a.play()},reattachMediaStream=
function(a,d){console.log("Reattaching media stream");a.mozSrcObject=d.mozSrcObject;a.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]}):a.webkitGetUserMedia?(console.log("This appears to be Chrome"),c.webrtcDetectedBrowser="chrome",this.RTCPeerConnection=webkitRTCPeerConnection,this.RTCSessionDescription=RTCSessionDescription,this.RTCIceCandidate=RTCIceCandidate,a.getUserMedia=a.webkitGetUserMedia,this.attachMediaStream=function(a,
d){var f=c.URL||c.webkitURL;a.src=f?f.createObjectURL(d):d;a.play();this.videoAdd=!0},reattachMediaStream=function(a,d){a.src=d.src},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=
function(){return this.remoteStreams})):console.log("Browser does not appear to be WebRTC-capable"));return a}}}})(window);function Resampler(c,a,b,d,f){this.fromSampleRate=c;this.toSampleRate=a;this.channels=b|0;this.outputBufferSize=d;this.noReturn=!!f;this.initialize()}
Resampler.prototype.initialize=function(){if(0<this.fromSampleRate&&0<this.toSampleRate&&0<this.channels)this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1):(this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.initializeBuffers());else throw Error("Invalid settings specified for the resampler.");
};
Resampler.prototype.compileLinearInterpolationFunction=function(){for(var c="var bufferLength = buffer.length;\tvar outLength = this.outputBufferSize;\tif ((bufferLength % "+this.channels+") == 0) {\t\tif (bufferLength > 0) {\t\t\tvar ratioWeight = this.ratioWeight;\t\t\tvar weight = this.lastWeight;\t\t\tvar firstWeight = 0;\t\t\tvar secondWeight = 0;\t\t\tvar sourceOffset = 0;\t\t\tvar outputOffset = 0;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tfor (; weight < 1; weight += ratioWeight) {\t\t\t\tsecondWeight = weight % 1;\t\t\t\tfirstWeight = 1 - secondWeight;",a=
0;a<this.channels;++a)c+="outputBuffer[outputOffset++] = (this.lastOutput["+a+"] * firstWeight) + (buffer["+a+"] * secondWeight);";c+="}\t\t\tweight -= 1;\t\t\tfor (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; outputOffset < outLength && sourceOffset < bufferLength;) {\t\t\t\tsecondWeight = weight % 1;\t\t\t\tfirstWeight = 1 - secondWeight;";for(a=0;a<this.channels;++a)c+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(0<a?" + "+a:"")+"] * firstWeight) + (buffer[sourceOffset + "+
(this.channels+a)+"] * secondWeight);";c+="weight += ratioWeight;\t\t\t\tsourceOffset = Math.floor(weight) * "+this.channels+";\t\t\t}";for(a=0;a<this.channels;++a)c+="this.lastOutput["+a+"] = buffer[sourceOffset++];";this.resampler=Function("buffer",c+'this.lastWeight = weight % 1;\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.compileMultiTapFunction=function(){for(var c="var bufferLength = buffer.length;\tvar outLength = this.outputBufferSize;\tif ((bufferLength % "+this.channels+") == 0) {\t\tif (bufferLength > 0) {\t\t\tvar ratioWeight = this.ratioWeight;\t\t\tvar weight = 0;",a=0;a<this.channels;++a)c+="var output"+a+" = 0;";c+="var actualPosition = 0;\t\t\tvar amountToNext = 0;\t\t\tvar alreadyProcessedTail = !this.tailExists;\t\t\tthis.tailExists = false;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tvar outputOffset = 0;\t\t\tvar currentPosition = 0;\t\t\tdo {\t\t\t\tif (alreadyProcessedTail) {\t\t\t\t\tweight = ratioWeight;";
for(a=0;a<this.channels;++a)c+="output"+a+" = 0;";c+="}\t\t\t\telse {\t\t\t\t\tweight = this.lastWeight;";for(a=0;a<this.channels;++a)c+="output"+a+" = this.lastOutput["+a+"];";c+="alreadyProcessedTail = true;\t\t\t\t}\t\t\t\twhile (weight > 0 && actualPosition < bufferLength) {\t\t\t\t\tamountToNext = 1 + actualPosition - currentPosition;\t\t\t\t\tif (weight >= amountToNext) {";for(a=0;a<this.channels;++a)c+="output"+a+" += buffer[actualPosition++] * amountToNext;";c+="currentPosition = actualPosition;\t\t\t\t\t\tweight -= amountToNext;\t\t\t\t\t}\t\t\t\t\telse {";
for(a=0;a<this.channels;++a)c+="output"+a+" += buffer[actualPosition"+(0<a?" + "+a:"")+"] * weight;";c+="currentPosition += weight;\t\t\t\t\t\tweight = 0;\t\t\t\t\t\tbreak;\t\t\t\t\t}\t\t\t\t}\t\t\t\tif (weight == 0) {";for(a=0;a<this.channels;++a)c+="outputBuffer[outputOffset++] = output"+a+" / ratioWeight;";c+="}\t\t\t\telse {\t\t\t\t\tthis.lastWeight = weight;";for(a=0;a<this.channels;++a)c+="this.lastOutput["+a+"] = output"+a+";";this.resampler=Function("buffer",c+'this.tailExists = true;\t\t\t\t\tbreak;\t\t\t\t}\t\t\t} while (actualPosition < bufferLength && outputOffset < outLength);\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.bypassResampler=function(c){return this.noReturn?(this.outputBuffer=c,c.length):c};Resampler.prototype.bufferSlice=function(c){if(this.noReturn)return c;try{return this.outputBuffer.subarray(0,c)}catch(a){try{return this.outputBuffer.length=c,this.outputBuffer}catch(b){return this.outputBuffer.slice(0,c)}}};
Resampler.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch(c){this.outputBuffer=[],this.lastOutput=[]}};(function(c){repMode=!1;var a=0,b=0,d=0,f=0,g=65535,h=0;c.media=function(){return{isChannelReady:"",isInitiator:!1,isStarted:"",localStream:"",pc:[],cn:0,ba:!1,bb:!1,bc:!1,bNotRender:!1,remoteStream:"",turnReady:"",oneExecuted:!1,videoControlId:"videoContainer",videoContainerId:"videos",util:{imageReplaceWithVideo:function(a,d){var b=document.getElementById("ml"+a);virtualclass.vutil.elemHasAnyClass("ml"+a)&&b.classList.remove("userImg");var b=b.getElementsByTagName("a")[0],c=b.getElementsByTagName("img")[0];
b.className+=" hasVideo";b.replaceChild(d,c)}},audio:{audioStreamArr:[],tempAudioStreamArr:[],recordingLength:0,bufferSize:0,encMode:"alaw",recordAudio:!1,resampler:new Resampler(44100,8E3,1,4096),rec:"",otherSound:!1,audioNodes:[],sdElem:"silenceDetect",Html5Audio:{audioContext:new (c.AudioContext||c.webkitAudioContext)},init:function(){var a=document.getElementById("speakerPressOnce").dataset.audioPlaying;virtualclass.gObj.audMouseDown="true"==a?!0:!1;this.graph={height:56,width:4,average:0,display:function(){var a=
cthis.video;roles.hasControls()&&this._display(a.tempVidCont,this.height-this.height*this.average/100)},_display:function(a,d){a.beginPath();a.moveTo(this.width,this.height);a.lineTo(this.width,d);a.lineWidth=this.width;a.strokeStyle="rgba(32, 37, 247, 0.8)";a.closePath();a.stroke()},canvasForVideo:function(){var a=cthis.video.myVideo.parentNode,d=document.createElement("canvas");d.width=this.width+3;d.height=this.height;d.id="graphCanvas";a.style.position="relative";d.style.position="absolute";d.style.left=
0;d.style.top=-7;a.appendChild(d)}};this.attachFunctionsToAudioWidget()},audioSend:function(a,d){if(virtualclass.gObj.audMouseDown&&1==io.sock.readyState){var b=virtualclass.vutil.breakintobytes(virtualclass.gObj.uid,8),b=new Int8Array([101,b[0],b[1],b[2],b[3]]),c=new Int8Array(a.length+b.length);c.set(b);c.set(a,b.length);ioAdapter.sendBinary(c);virtualclass.gObj.video.audio.setAudioStatus(d)}else virtualclass.gObj.video.audio.setAudioStatus("stop")},slienceDetection:function(c,p){var s=0,v=0,x=
0;for(i=0;i<p.length;i++)x=Math.abs(p[i]),s<x&&(s=x),v+=x;f=v/p.length;x=Math.abs(f^2-d^2);d=f;5>x&&(g=s);g>s&&(g=s);h<s&&(h=s);50*g<h&&(g*=5);h/50>g&&(h=s);v=h/g;switch(!0){case 8<v:x=2.5;break;case 5<v:x=2;break;case 3<v:x=1.2;break;default:x=1}2<=v&&s>=g*x?(0==a&&0!=b&&(this.audioSend(b),b=0),this.audioSend(c,"sending"),a=9):0<a?(this.audioSend(c,"sending"),a--):2>v?this.audioSend(c,"sending"):(this.setAudioStatus("notSending"),10<v&&(h*=.8),b=c);return c},setAudioStatus:function(a){if("undefined"==
typeof d)var d=document.getElementById("audioWidget").getElementsByClassName(this.sdElem)[0];d.setAttribute("data-silence-detect",a)},makeIconNotDraggable:function(a,d){var b=document.getElementById(a,d).getContext("2d"),f=new Image;f.onload=function(){b.drawImage(f,0,0)};f.src=c.whiteboardPath+"images/"+d},attachFunctionsToAudioWidget:function(){for(var a=document.getElementById("audioWidget").getElementsByClassName("audioTool"),d=0;d<a.length;d++)"speakerPressOnce"!=a[d].id&&"speakerPressing"==
a[d].id&&this.attachSpeakToStudent(a[d].id),"speakerPressing"!=a[d].id&&a[d].addEventListener("click",this.audioToolInit)},audioToolInit:function(){var a=virtualclass.gObj.video.audio;if("speakerPressOnce"==this.id)a.clickOnceSpeaker(this.id);else if("audioTest"==this.id){var d=this;virtualclass.popup.confirmInput(virtualclass.lang.getString("audioTest"),function(b){b&&a.testInit(d.id)})}else"silenceDetect"==this.id&&(this.getElementsByTagName("a"),a.sd?(a.sd=!1,this.className+=" sdDisable"):(a.sd=
!0,this.className+=" sdEnable"))},attachSpeakToStudent:function(a){var d=this,b=document.getElementById(a),c=!1;b.addEventListener("mousedown",function(){if(!virtualclass.gObj.audMouseDown){d.studentSpeak(b);c=!0;var a=document.getElementById("speakerPressonceLabel");null!=a&&virtualclass.vutil.elemHasAnyClass("speakerPressonceLabel")&&a.classList.contains("silenceDetect")&&(a.removeAttribute("data-silence-detect"),a.classList.remove("silenceDetect"),0>=a.classList.length&&a.removeAttribute("class"),
a=a.getElementsByTagName("i")[0],null!=a&&(a.setAttribute("data-silence-detect","stop"),a.className+=" silenceDetect"))}});b.addEventListener("mouseup",function(){if(c){d.studentNotSpeak(b);c=!1;var a=document.getElementById("speakerPressonceLabel"),f=a.getElementsByTagName("i")[0];"undefined"!=typeof f.classList&&f.classList.contains("silenceDetect")&&(f.classList.remove("silenceDetect"),0>=f.classList.length&&f.removeAttribute("class"),a.removeAttribute("data-silence-detect"));null!==a&&(a.setAttribute("data-silence-detect",
"stop"),a.className=f.className+" silenceDetect")}})},attachAudioPressOnce:function(){var a=document.getElementById("speakerPressOnce");a.setAttribute("data-audio-playing","false");var d=this;a.addEventListener("click",function(){d.clickOnceSpeaker.call(d,a.id)})},clickOnceSpeaker:function(a,d){var b=document.getElementById(a),c=document.getElementById("speakerPressing"),f=b.getElementsByClassName("tooltip")[0];"false"==b.getAttribute("data-audio-playing")&&"undefined"==typeof d?(this.studentSpeak(c),
b.setAttribute("data-audio-playing","true"),f.setAttribute("data-title",virtualclass.lang.getString("disableSpeaker")),b.className="audioTool active"):(this.studentNotSpeak(c),b.setAttribute("data-audio-playing","false"),f.setAttribute("data-title",virtualclass.lang.getString("enableSpeaker")),b.className="audioTool deactive")},studentSpeak:function(a){"undefined"!=typeof a&&(document.getElementById(a.id+"Button"),a.classList.remove("deactive"),a.classList.add("active"));virtualclass.gObj.audMouseDown=
!0;virtualclass.vutil.beforeSend({sad:!0,cf:"sad"})},studentNotSpeak:function(a){virtualclass.gObj.hasOwnProperty("audMouseDown")&&virtualclass.gObj.audMouseDown&&("undefined"!=typeof a&&(document.getElementById(a.id+"Button"),a.classList.remove("active"),a.classList.add("deactive")),a=document.getElementById("speakerPressOnce"),a.setAttribute("data-audio-playing","false"),a.className="audioTool deactive",virtualclass.gObj.audMouseDown=!1,virtualclass.gObj.video.audio.setAudioStatus("stop"),virtualclass.vutil.beforeSend({sad:!1,
cf:"sad"},null,!0))},ab2str:function(a){return String.fromCharCode.apply(null,new Int8Array(a))},str2ab:function(a){for(var d=new ArrayBuffer(a.length),d=new Int8Array(d),b=0,c=a.length;b<c;b++)d[b]=a.charCodeAt(b);return d},recorderProcess:function(a){(new Date).getTime();if(!repMode){a=a.inputBuffer.getChannelData(0);a=this.resampler.resampler(a);this.recordAudio||(this.recordingLength+=this.bufferSize);l=a.length;for(buf=new Int16Array(l);l--;)buf[l]=32767*Math.min(1,a[l]);a=buf;var d=this.audioInLocalStorage(a);
this.hasOwnProperty("storeAudio")&&this.storeAudio&&this.audioForTesting(a);virtualclass.gObj.audMouseDown&&1==io.sock.readyState&&this.slienceDetection(d,a)}},audioInLocalStorage:function(a){return G711.encode(a,{alaw:"alaw"==this.encMode?!0:!1})},testInit:function(a){var d=document.getElementById(a);d.classList.add("audioIsTesting");this.studentNotSpeak();virtualclass.gObj.audioForTest=[];this.storeAudio=!0;var b=this;b.otherSound=!0;b.hasOwnProperty("testAudio")&&clearTimeout(b.testAudio);b.testAudio=
setTimeout(function(){b.playRecordedAudio(virtualclass.gObj.audioForTest,virtualclass.gObj.uid,!0)},5E3);setTimeout(function(){console.log("testing");d.classList.remove("audioIsTesting");b.otherSound=!1},11E3)},audioForTesting:function(a){a=G711.encode(a,{alaw:"alaw"==this.encMode?!0:!1});virtualclass.gObj.audioForTest.push(a);virtualclass.gObj[virtualclass.gObj.uid]=!1},playRecordedAudio:function(a,d,b){var c;this.myaudioNodes=[];for(var f=0,g=0;g<a.length;g++)c=a[g],c=G711.decode(c,{alaw:"alaw"==
this.encMode?!0:!1,floating_point:!0,Eight:!0}),this.myaudioNodes.push(new Float32Array(c)),f+=c.length;c=this.mergeBuffers(this.myaudioNodes,f);"undefined"!=typeof b?virtualclass.gObj.video.audio.play(c,d,b):virtualclass.gObj.video.audio.play(c,d)},play:function(a,d,b){var c=JSON.parse(localStorage.getItem("virtualclass"+d));"undefined"==typeof receivedResampler&&(receivedResampler=new Resampler(8E3,44100,1,16384E3));a=receivedResampler.resampler(a);var f=this.Html5Audio.audioContext.createBuffer(1,
a.length,44100);f.getChannelData(0).set(a);a=this.Html5Audio.audioContext.createBufferSource();a.buffer=f;f=this.Html5Audio.audioContext.createGain();f.gain.value=.9;a.connect(f);f.connect(this.Html5Audio.audioContext.destination);null!=c&&c.ad&&c.aud&&(virtualclass.user.control.iconAttrManupulate(d,"icon-audioEnaGreen"),f=document.getElementById(c.id+"contrAudAnch"),null!=f&&f.setAttribute("data-title",virtualclass.lang.getString("audioOn")));a.onended=function(){c=JSON.parse(localStorage.getItem("virtualclass"+
d));"undefined"==typeof b&&(clearTimeout(virtualclass.gObj[d].out),virtualclass.gObj[d].isplaying=!1,0<virtualclass.gObj.video.audio.audioToBePlay[d].length?virtualclass.gObj.video.audio.getChunks(d):null!=c&&c.ad&&c.aud&&virtualclass.user.control.iconAttrManupulate(d,"icon-audioEnaOrange"))};a.start(1);virtualclass.gObj[d].isplaying=!0;"undefined"==typeof b&&(virtualclass.gObj[d].out=setTimeout(function(){virtualclass.gObj[d].isplaying=!1;0<virtualclass.gObj.video.audio.audioToBePlay[d].length&&
virtualclass.gObj.video.audio.getChunks(d)},1E3*a.buffer.duration+10))},calcAverage:function(){var a=new Uint8Array(analyser.frequencyBinCount);analyser.getByteFrequencyData(a);for(var d=0,b=a.length,c=0;c<b;c++)d+=a[c];this.graph.average=d/b},audioInGraph:function(){var a=cthis.video;if(roles.hasControls()){var d=this.graph.height-this.graph.height*this.graph.average/100;a.tempVidCont.beginPath();a.tempVidCont.moveTo(a.tempVid.width-this.graph.width,this.graph.height);a.tempVidCont.lineTo(a.tempVid.width-
this.graph.width,d);a.tempVidCont.lineWidth=this.graph.width;a.tempVidCont.strokeStyle="rgba(247, 25, 77, 1)";a.tempVidCont.closePath();a.tempVidCont.stroke()}},queue:function(a,d){this.hasOwnProperty("audioToBePlay")||(this.audioToBePlay={});this.audioToBePlay.hasOwnProperty(d)||(this.audioToBePlay[d]=[]);this.audioToBePlay[d].push(a)},getChunks:function(a,d){8<this.audioToBePlay[a].length?(this.audioToBePlay[a].length=0,virtualclass.gObj[a].isplaying=!1):0<this.audioToBePlay[a].length?(this.playRecordedAudio(this.audioToBePlay[a],
a),this.audioToBePlay[a].length=0):virtualclass.gObj[a].isplaying=!1},replay:function(a,d){repMode=!0;var b,c,f;0<this.audioNodes.length&&(b=this.mergeBuffers(this.audioNodes),c=this.Html5Audio.audioContext.currentTime+a,f=this.Html5Audio.audioContext.createBuffer(1,b.length,7800),f.getChannelData(0).set(b),b=this.Html5Audio.audioContext.createBufferSource(),b.buffer=f,b.connect(this.Html5Audio.audioContext.destination),b.start(c,d))},mergeBuffers:function(a,d){for(var b=new Float32Array(d),c=0,f=
a.length,g=0;g<f;g++){var h=a[g];b.set(h,c);c+=h.length}return b},assignFromLocal:function(a,d){this.init();for(var b=0;b<a.length;b++){var c=LZString.decompressFromBase64(a[b]),c=this.str2ab(c);samples=G711.decode(c,{alaw:"alaw"==this.encMode?!0:!1,floating_point:!0,Eight:!0});this.audioNodes.push(new Float32Array(samples));this.recordingLength+=16384}"undefined"!=typeof d&&d()},manuPulateStream:function(){var a=cthis.audio.Html5Audio.audioContext.createMediaStreamSource(cthis.stream);cthis.audio.bufferSize=
16384;grec=cthis.audio.Html5Audio.audioContext.createScriptProcessor(cthis.audio.bufferSize,1,1);grec.onaudioprocess=cthis.audio.recorderProcess.bind(cthis.audio);var d=cthis.audio.Html5Audio.audioContext.createGain();d.gain.value=.9;a.connect(d);d.connect(grec);grec.connect(cthis.audio.Html5Audio.audioContext.destination)},updateInfo:function(){this.audioStreamArr=[];repMode=this.recordAudio=!1},receivedAudioProcess:function(a){if(!virtualclass.gObj.hasOwnProperty("iosTabAudTrue")||!1!=virtualclass.gObj.iosTabAudTrue){a=
this.extractData(a);var d=a[0];if("undefined"==typeof b)var b={};b.hasOwnProperty(d)||(b[d]={},b[d].ad=!0,b=virtualclass.user.control.updateUser(d,"ad",!0),virtualclass.user.control.audioSign(b,"create"));virtualclass.gObj.video.audio.queue(a[1],d);virtualclass.gObj.hasOwnProperty(d)&&virtualclass.gObj[d].hasOwnProperty("isplaying")?!1==virtualclass.gObj[d].isplaying&&virtualclass.gObj.video.audio.getChunks(d):(virtualclass.gObj[d]={},virtualclass.gObj[d].isplaying=!0,virtualclass.gObj.video.audio.getChunks(d))}},
extractData:function(a){a=new Int8Array(a);return[virtualclass.vutil.numValidateFour(a[1],a[2],a[3],a[4]),a.subarray(5,a.length)]}},video:{width:75,height:56,tempVid:"",tempVidCont:"",myVideo:"",remoteVid:"",remoteVidCont:"",maxHeight:250,init:function(){this.videoCont=document.getElementById("allVideosCont");null!=this.videoCont&&(this.videoCont.style.maxHeight=this.maxHeight+"px")},calcDimension:function(){this.myVideo.width=this.width;this.myVideo.height=this.height},removeUser:function(a){a=document.getElementById("user"+
a);null!=a&&a.parentNode.removeChild(a)},createElement:function(a){var d=document.createElement("div");d.className="videoWrapper";var b=document.createElement("div");b.className="videoSubWrapper";b.id="user"+a.id;d.appendChild(b);vidId=a.id;var c=document.createElement("canvas");c.id="video"+vidId;c.className="userVideos";c.width=this.width;c.height=this.height;b.appendChild(c);virtualclass.gObj.video.util.imageReplaceWithVideo(a.id,d)},updateHightInSideBar:function(a){var d=document.getElementById("widgetRightSide").offsetHeight;
document.getElementById("chatContainer").style.height=d-a+"px"},send:function(){function a(){function g(){try{b.tempVidCont.drawImage(b.myVideo,0,0,b.width,b.height)}catch(a){if("NS_ERROR_NOT_AVAILABLE"==a.name)setTimeout(g,100);else throw a;}}if(roles.hasControls()){if("undefined"==typeof h){var h=document.getElementById("graphCanvas");null!=h&&(cthis.audio.graph.cvCont=h.getContext("2d"))}null!=h&&cthis.audio.graph.cvCont.clearRect(0,0,h.width,h.height)}b.tempVidCont.clearRect(0,0,b.tempVid.width,
b.tempVid.height);c.navigator.userAgent.match("Firefox")?g():b.tempVidCont.drawImage(b.myVideo,0,0,b.width,b.height);roles.hasControls()&&cthis.audio.graph.display();h={name:virtualclass.gObj.uName,id:virtualclass.gObj.uid};roles.hasControls()&&(h.role=virtualclass.gObj.uRole);virtualclass.vutil.beforeSend({videoByImage:h,cf:"videoByImage"},null,!0);var h=b.tempVidCont.getImageData(0,0,b.tempVid.width,b.tempVid.height),h=virtualclass.dirtyCorner.encodeRGB(h.data),w=d(virtualclass.gObj.uid,8),w=new Uint8ClampedArray([11,
w[0],w[1],w[2],w[3]]),q=new Uint8ClampedArray(h.length+w.length);q.set(w);q.set(h,w.length);ioAdapter.sendBinary(q);clearInterval(virtualclass.gObj.video.smallVid);h=2E3+2500*virtualclass.gObj.totalUser.length;f!=virtualclass.gObj.totalUser?(f=virtualclass.gObj.totalUser.length,w=virtualclass.gObj.totalUser.indexOf(virtualclass.gObj.uId),virtualclass.gObj.video.smallVid=setInterval(a,h+h/f*w)):virtualclass.gObj.video.smallVid=setInterval(a,h)}function d(a,b){for(var c=a.toString(),f=c.length;f<b;f++)c=
"0"+c;return c.match(/[\S]{1,2}/g)||[]}virtualclass.gObj.video.hasOwnProperty("smallVid")&&clearInterval(virtualclass.gObj.video.smallVid);var b=this;randomTime=Math.floor(10001*Math.random())+5E3;var f=-1;virtualclass.gObj.video.smallVid=setInterval(a,300)},startToStream:function(){cthis.video.calcDimension();cthis.video.send()},playWithoutSlice:function(a,d){this.remoteVid=document.getElementById("video"+a);if(null!=this.remoteVid){this.remoteVidCont=this.remoteVid.getContext("2d");var b=virtualclass.dirtyCorner.decodeRGB(d,
this.remoteVidCont,this.remoteVid);this.remoteVidCont.putImageData(b,0,0)}},justForDemo:function(){var a=0,d=document.getElementById("allVideosCont");d.style.maxHeight="250px";setInterval(function(){if(20>=++a){d=document.getElementById("allVideosCont");var b=document.createElement("div");b.className="videoWrapper";var c=document.createElement("div");c.className="videoSubWrapper";c.setAttribute("data-uname","suman"+a);b.appendChild(c);var f=document.createElement("video");f.className="userVideo";
f.src="http://html5demos.com/assets/dizzy.mp4";c.appendChild(f);d.appendChild(b);250<=d.offsetHeight&&"undefined"!=d.style.overflowY&&"scroll"!=d.style.overflowY&&(d.style.overflowY="scroll",document.getElementById(virtualclass.gObj.chat.mainChatBoxId).style.borderTop="3px solid #bbb")}},200)},createVideoElement:function(){var a=document.createElement("div");a.className="videoWrapper";var d=document.createElement("div");d.className="videoSubWrapper";a.appendChild(d);var b=document.createElement("video");
b.id="video"+virtualclass.gObj.uid;b.autoplay=!0;d.appendChild(b);return a},insertTempVideo:function(a){var d=document.createElement("canvas");d.id="tempVideo";a.parentNode.insertBefore(d,a)},tempVideoInit:function(){cthis.video.tempVid=document.getElementById("tempVideo");cthis.video.tempVid.width=cthis.video.width;cthis.video.tempVid.height=cthis.video.height;cthis.video.tempVidCont=cthis.video.tempVid.getContext("2d")},process:function(a){var d=new Uint8ClampedArray(a);a=virtualclass.vutil.numValidateFour(d[1],
d[2],d[3],d[4]);d=d.subarray(5,d.length);virtualclass.gObj.video.video.playWithoutSlice(a,d)}},init:function(a){cthis=this;vcan.oneExecuted=!0;a={audio:!0,video:!0};cthis.video.init();virtualclass.vutil.isPlayMode()||(virtualclass.adpt=new virtualclass.adapter,virtualclass.adpt.init(navigator).getUserMedia(a,this.handleUserMedia,this.handleUserMediaError));virtualclass.system.wbRtc.peerCon&&"undefined"==typeof localStorage.wbrtcMsg&&(virtualclass.view.multiMediaMsg("WebRtc"),localStorage.wbrtcMsg=
!0)},handleUserMedia:function(a){localStorage.removeItem("dvid");var d=document.getElementById("audioWidget"),b=localStorage.getItem("audEnable");null!=b?(b=JSON.parse(b),"false"==b.ac?"vd"==b.r?virtualclass.user.control.audioWidgetEnable():virtualclass.user.control.audioWidgetDisable():virtualclass.user.control.audioWidgetEnable()):virtualclass.vutil.elemHasAnyClass("audioWidget")&&d.classList.contains("deactive")&&virtualclass.user.control.audioWidgetEnable();cthis.video.tempStream=a;cthis.audio.init();
a=document.getElementById("ml"+virtualclass.gObj.uid);null!=a&&null!=a.getElementsByTagName("video")&&cthis._handleUserMedia(virtualclass.gObj.uid)},addUserRole:function(a,d){var b=document.getElementById("ml"+a);b.setAttribute("data-role",d);b.classList.add("s"==d?"student":"teacher")},_handleUserMedia:function(a){document.getElementById(a);var d=cthis.video.tempStream;"undefined"!=typeof d&&(a=cthis.video.createVideoElement(),virtualclass.gObj.video.util.imageReplaceWithVideo(virtualclass.gObj.uid,
a),cthis.video.insertTempVideo(a),cthis.video.tempVideoInit(),cthis.video.myVideo=document.getElementById("video"+virtualclass.gObj.uid),virtualclass.adpt.attachMediaStream(cthis.video.myVideo,d),cthis.video.myVideo.muted=!0,d.ontimeupdate=function(){console.log("raja"+d.currentTime)},virtualclass.jId==virtualclass.gObj.uid&&(cthis.stream=cthis.video.tempStream,cthis.audio.manuPulateStream(),cthis.audio.graph.canvasForVideo()),cthis.video.myVideo.onloadedmetadata=function(){cthis.video.startToStream()});
userMedia=!0},updateVidContHeight:function(){var a=document.getElementById("virtualclassCont"),a=vcan.utility.getElementOffset(a),a=c.innerHeight-(a.y+75);document.getElementById("chat_div").style.maxHeight=a+"px"},close:function(){virtualclass.gObj.video.hasOwnProperty("smallVid")&&clearInterval(virtualclass.gObj.video.smallVid)},dispAllVideo:function(a){setTimeout(function(){var d=document.getElementById(a);if(null!=d)for(var d=d.getElementsByTagName("video"),b=0;b<d.length;b++)d[b].play()},1040)},
existVideoContainer:function(a){for(var d=document.getElementsByClassName("userVideos"),b=0;b<d.length;b++)if(d[b].id=="video"+a.id)return!0;return!1},handleUserMediaError:function(a){a="object"==typeof a?virtualclass.lang.getString(a.name):virtualclass.lang.getString(a);virtualclass.view.createErrorMsg(a,"errorContainer","chatWidget");virtualclass.user.control.audioWidgetDisable("vd");virtualclass.view.disappearBox("WebRtc");localStorage.setItem("dvid",!0);console.log("navigator.getUserMedia error: ",
a)}}}})(window);(function(c){var a={requestPackets:function(a){1<a.length&&(virtualclass.wb.gObj.myArr=a);virtualclass.wb.sentReq=!0;return[0==virtualclass.wb.gObj.displayedObjId?0:virtualclass.wb.gObj.rcvdPackId,a[0].uid]},makeQueue2:function(a){virtualclass.wb.gObj.rcvdPackId!=virtualclass.wb.gObj.displayedObjId&&(virtualclass.wb.gObj.packQueue=virtualclass.wb.gObj.packQueue.concat(a.message.repObj))},makeQueue3:function(a){for(var d=0;d<a.message.repObj.length;d++)virtualclass.wb.gObj.packQueue[a.message.repObj[d].uid]=
a.message.repObj[d]},makeQueue:function(a){virtualclass.wb.gObj.queue[a.uid]=a},sendPackets:function(a,d){if(0==a.message.getMsPckt[0])var c=-1;else for(c=0;c<virtualclass.wb.gObj.myrepObj.length&&a.message.getMsPckt[0]!=virtualclass.wb.gObj.myrepObj[c].uid;c++);for(c+=1;c<a.message.getMsPckt[1];c++)d.push(virtualclass.wb.gObj.myrepObj[c]);return d},handleMissedPackets:function(b,d,c){c=this.removeDupObjs(c);virtualclass.wb.gObj.replayObjs=virtualclass.wb.gObj.replayObjs.concat(c);a.sortingReplyObjs();
b!=d&&virtualclass.storage.store(JSON.stringify(virtualclass.wb.gObj.replayObjs));this.containsIfQueuePacks(b,d,virtualclass.wb.gObj.displayedObjId,c)},removeDupObjs:function(a){0<virtualclass.wb.gObj.myArr.length&&(a[a.length-1].uid==virtualclass.wb.gObj.myArr[0].uid&&(virtualclass.wb.gObj.myArr[0].hasOwnProperty("cmd")||virtualclass.wb.gObj.myArr.shift()),a=a.concat(virtualclass.wb.gObj.myArr),virtualclass.wb.gObj.myArr=[]);return a},containsIfQueuePacks:function(a,d,c,g){a!=d&&c+1!=g[0].uid&&0<
virtualclass.wb.gObj.packQueue.length&&g[g.length-1].uid==virtualclass.wb.gObj.packQueue[0].uid&&(virtualclass.wb.gObj.packQueue=g.concat(virtualclass.wb.gObj.packQueue))},sortingReplyObjs:function(){virtualclass.wb.gObj.replayObjs=virtualclass.wb.gObj.replayObjs.sort(function(a,d){return a.uid-d.uid})}};c.bridge=a})(window);(function(c){vcan.optimize={sendPacketWithOptimization:function(a,b,d){"undefined"==typeof this.lastarrowtime&&(this.lastarrowtime=(new Date).getTime(),1==b&&virtualclass.vutil.beforeSend(JSON.parse(a)),virtualclass.wb.utility.updateSentInformation(a,!0));this.presentarrowtime=(new Date).getTime();this.presentarrowtime-this.lastarrowtime>=d&&(1==b&&(b=JSON.parse(a),b.hasOwnProperty("createArrow")?ioAdapter.send(b):ioAdapter.mustSend(b)),virtualclass.wb.utility.updateSentInformation(a,!0),this.lastarrowtime=
(new Date).getTime())},doOptiMize:function(a){if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=(new Date).getTime(),a.detail.hasOwnProperty("cevent")||vcan.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-vcan.main.offset.x,a.clientY-vcan.main.offset.y);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&((new Date).getTime(),a.detail.hasOwnProperty("cevent")||vcan.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-
vcan.main.offset.x,a.clientY-vcan.main.offset.y),vcan.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-vcan.main.offset.x,a.clientY-vcan.main.offset.y),lastmousemovetime=(new Date).getTime())},calculatePackets:function(a,b,d,c){a=vcan.makeStackObj(a,b,d,c);virtualclass.wb.uid++;a.uid=virtualclass.wb.uid;vcan.main.replayObjs.push(a);virtualclass.vutil.beforeSend({repObj:[a],cf:"repObj"});virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs))}}})(window);(function(c){c.response={reclaimRole:function(a,b){a!=b&&(virtualclass.user.control._assign(b,"notsent",a),virtualclass.user.displayStudentSpeaker(!0),null!=localStorage.getItem("aId")&&localStorage.removeItem("aId"),virtualclass.user.control.removeAudioFromParticipate(a),"mobTab"==virtualclass.system.device&&((virtualclass.system.mybrowser.name=8<=virtualclass.system.mybrowser.version)&&/(iPad)/g.test(navigator.userAgent)&&virtualclass.vutil.enableVirtualClass(),virtualclass.view.removeErrorMsg("errorContainer",
!0)))},assignRole:function(a,b,d){if(a!=b||"undefined"!=typeof d)if(virtualclass.vutil.assignRole(b),virtualclass.wb.utility.uniqueArrOfObjsToTeacher(),roles.hasAdmin())a=document.getElementById("chat_div").getElementsByClassName("currTeacher")[0],null!=a&&virtualclass.user.control.removeCurrTeacherFromControl(a.id),virtualclass.user.control.changeAttrToAssign("enable");else{virtualclass.vutil.removeSessionTool();b=document.getElementById("ml"+a);d=["assign"];var c=document.getElementById(a+"ControlContainer");
null!=c?virtualclass.user.createAssignControl(c,a,!0):(d=virtualclass.user.createControl(a,d),b.appendChild(d));localStorage.setItem("aId",a)}virtualclass.vutil.attachClickOutSideCanvas();"mobTab"==virtualclass.system.device&&(virtualclass.vutil.disableVirtualClass(),virtualclass.view.createErrorMsg(virtualclass.lang.getString("supportDesktop"),"errorContainer","chatWidget"))},checkUser:function(a,b,d){"undefined"!=typeof vcan.teacher||d||virtualclass.wb.utility.makeCanvasDisable();virtualclass.vutil.initDefaultInfo(a,
wbUser.role,virtualclass.currApp);virtualclass.wb.utility.makeUserAvailable(a.message.checkUser.e.clientLen)},clearAll:function(a,b,d,c){a!=b&&(virtualclass.wb.tool=new virtualclass.wb.tool_obj("t_clearall"),virtualclass.wb.utility.t_clearallInit(),virtualclass.wb.utility.makeDefaultValue(),virtualclass.storage.clearSingleTable("wbData"))},replayAll:function(){c.virtualclass.wb.vcan.main.replayObjs=virtualclass.wb.gObj.replayObjs;virtualclass.wb.utility.clearAll(!1);virtualclass.wb.toolInit("t_replay",
"fromFile")},createArrow:function(a,b){var d=virtualclass.wb.arrImg,c={};c.mp={x:a.x,y:a.y};virtualclass.wb.utility.drawArrowImg(d,c)},replayObj2:function(a){c.virtualclass.wb.vcan.main.replayObjs=[];0<a.length&&(virtualclass.wb.gObj.displayedObjId+1==a[0].uid?(c.virtualclass.wb.vcan.main.replayObjs=a,console.log("Whiteboard:-  recieved "+a[a.length-1].uid),virtualclass.wb.toolInit("t_replay","fromBrowser",!0,virtualclass.wb.utility.dispQueuePacket)):console.log("Whiteboard:- Problem between display id "+
virtualclass.wb.gObj.displayedObjId+" and recived first packet"+a[0].uid))},replayObj:function(a){c.virtualclass.wb.vcan.main.replayObjs=[];0<a.length&&(c.virtualclass.wb.vcan.main.replayObjs=a,virtualclass.wb.toolInit("t_replay","fromBrowser",!0,virtualclass.wb.utility.dispQueuePacket))},chunk:function(a,b,d){virtualclass.wb.bridge.handleMissedPackets(a,b,d)},repObjForMissedPkts:function(a){(0!==virtualclass.wb.gObj.rcvdPackId||0<virtualclass.wb.uid&&0===virtualclass.wb.gObj.rcvdPackId)&&("object"===
typeof a||a instanceof Array)&&a[0].hasOwnProperty("uid")&&!a.hasOwnProperty("chunk")&&(Number(virtualclass.wb.gObj.rcvdPackId+1)<Number(a[0].uid)||virtualclass.wb.gObj.rcvdPackId!=virtualclass.wb.gObj.displayedObjId)&&(a=virtualclass.wb.bridge.requestPackets(a),virtualclass.vutil.beforeSend({getMsPckt:a,cf:"getMsPckt"}))}}})(window);var LZString={_f:String.fromCharCode,_keyStrBase64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_keyStrUriSafe:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",_getBaseValue:function(c,a){LZString._baseReverseDic||(LZString._baseReverseDic={});if(!LZString._baseReverseDic[c]){LZString._baseReverseDic[c]={};for(var b=0;b<c.length;b++)LZString._baseReverseDic[c][c[b]]=b}return LZString._baseReverseDic[c][a]},compressToBase64:function(c){if(null==c)return"";
c=LZString._compress(c,6,function(a){return LZString._keyStrBase64.charAt(a)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(c){return null==c?"":""==c?null:LZString._decompress(c.length,32,function(a){return LZString._getBaseValue(LZString._keyStrBase64,c.charAt(a))})},compressToUTF16:function(c){return null==c?"":LZString._compress(c,15,function(a){return String.fromCharCode(a+32)})+" "},decompressFromUTF16:function(c){return null==
c?"":""==c?null:LZString._decompress(c.length,16384,function(a){return c.charCodeAt(a)-32})},compressToUint8Array:function(c){c=LZString.compress(c);for(var a=new Uint8Array(2*c.length),b=0,d=c.length;b<d;b++){var f=c.charCodeAt(b);a[2*b]=f>>>8;a[2*b+1]=f%256}return a},decompressFromUint8Array:function(c){if(null===c||void 0===c)return LZString.decompress(c);for(var a=Array(c.length/2),b=0,d=a.length;b<d;b++)a[b]=256*c[2*b]+c[2*b+1];var f=[];a.forEach(function(a){f.push(String.fromCharCode(a))});
return LZString.decompress(f.join(""))},compressToEncodedURIComponent:function(c){return null==c?"":LZString._compress(c,6,function(a){return LZString._keyStrUriSafe.charAt(a)})},decompressFromEncodedURIComponent:function(c){if(null==c)return"";if(""==c)return null;c=c.replace(/ /g,"+");return LZString._decompress(c.length,32,function(a){return LZString._getBaseValue(LZString._keyStrUriSafe,c.charAt(a))})},compress:function(c){return LZString._compress(c,16,function(a){return String.fromCharCode(a)})},
_compress:function(c,a,b){if(null==c)return"";var d,f,g={},h={},m="",p="",s="",v=2,x=3,t=2,w=[],q=0,r=0,u;for(u=0;u<c.length;u+=1)if(m=c[u],Object.prototype.hasOwnProperty.call(g,m)||(g[m]=x++,h[m]=!0),p=s+m,Object.prototype.hasOwnProperty.call(g,p))s=p;else{if(Object.prototype.hasOwnProperty.call(h,s)){if(256>s.charCodeAt(0)){for(d=0;d<t;d++)q<<=1,r==a-1?(r=0,w.push(b(q)),q=0):r++;f=s.charCodeAt(0);for(d=0;8>d;d++)q=q<<1|f&1,r==a-1?(r=0,w.push(b(q)),q=0):r++,f>>=1}else{f=1;for(d=0;d<t;d++)q=q<<1|
f,r==a-1?(r=0,w.push(b(q)),q=0):r++,f=0;f=s.charCodeAt(0);for(d=0;16>d;d++)q=q<<1|f&1,r==a-1?(r=0,w.push(b(q)),q=0):r++,f>>=1}v--;0==v&&(v=Math.pow(2,t),t++);delete h[s]}else for(f=g[s],d=0;d<t;d++)q=q<<1|f&1,r==a-1?(r=0,w.push(b(q)),q=0):r++,f>>=1;v--;0==v&&(v=Math.pow(2,t),t++);g[p]=x++;s=String(m)}if(""!==s){if(Object.prototype.hasOwnProperty.call(h,s)){if(256>s.charCodeAt(0)){for(d=0;d<t;d++)q<<=1,r==a-1?(r=0,w.push(b(q)),q=0):r++;f=s.charCodeAt(0);for(d=0;8>d;d++)q=q<<1|f&1,r==a-1?(r=0,w.push(b(q)),
q=0):r++,f>>=1}else{f=1;for(d=0;d<t;d++)q=q<<1|f,r==a-1?(r=0,w.push(b(q)),q=0):r++,f=0;f=s.charCodeAt(0);for(d=0;16>d;d++)q=q<<1|f&1,r==a-1?(r=0,w.push(b(q)),q=0):r++,f>>=1}v--;0==v&&(v=Math.pow(2,t),t++);delete h[s]}else for(f=g[s],d=0;d<t;d++)q=q<<1|f&1,r==a-1?(r=0,w.push(b(q)),q=0):r++,f>>=1;v--;0==v&&(Math.pow(2,t),t++)}f=2;for(d=0;d<t;d++)q=q<<1|f&1,r==a-1?(r=0,w.push(b(q)),q=0):r++,f>>=1;for(;;)if(q<<=1,r==a-1){w.push(b(q));break}else r++;return w.join("")},decompress:function(c){return null==
c?"":""==c?null:LZString._decompress(c.length,32768,function(a){return c.charCodeAt(a)})},_decompress:function(c,a,b){var d=[],f=4,g=4,h=3,m="",p=[],s,v,x,t,w,q=LZString._f,r=b(0),u=a,A=1;for(s=0;3>s;s+=1)d[s]=s;m=0;x=Math.pow(2,2);for(t=1;t!=x;)v=r&u,u>>=1,0==u&&(u=a,r=b(A++)),m|=(0<v?1:0)*t,t<<=1;switch(m){case 0:m=0;x=Math.pow(2,8);for(t=1;t!=x;)v=r&u,u>>=1,0==u&&(u=a,r=b(A++)),m|=(0<v?1:0)*t,t<<=1;w=q(m);break;case 1:m=0;x=Math.pow(2,16);for(t=1;t!=x;)v=r&u,u>>=1,0==u&&(u=a,r=b(A++)),m|=(0<v?
1:0)*t,t<<=1;w=q(m);break;case 2:return""}s=d[3]=w;for(p.push(w);;){if(A>c)return"";m=0;x=Math.pow(2,h);for(t=1;t!=x;)v=r&u,u>>=1,0==u&&(u=a,r=b(A++)),m|=(0<v?1:0)*t,t<<=1;switch(w=m){case 0:m=0;x=Math.pow(2,8);for(t=1;t!=x;)v=r&u,u>>=1,0==u&&(u=a,r=b(A++)),m|=(0<v?1:0)*t,t<<=1;d[g++]=q(m);w=g-1;f--;break;case 1:m=0;x=Math.pow(2,16);for(t=1;t!=x;)v=r&u,u>>=1,0==u&&(u=a,r=b(A++)),m|=(0<v?1:0)*t,t<<=1;d[g++]=q(m);w=g-1;f--;break;case 2:return p.join("")}0==f&&(f=Math.pow(2,h),h++);if(d[w])m=d[w];else if(w===
g)m=s+s[0];else return null;p.push(m);d[g++]=s+m[0];f--;s=m;0==f&&(f=Math.pow(2,h),h++)}}};"undefined"!==typeof module&&null!=module&&(module.exports=LZString);(function(c){var a={BIAS:132,CLIP:32635,tables:{ulaw:{compress:[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],decompress:[-32124,-31100,-30076,-29052,-28028,-27004,-25980,-24956,-23932,-22908,-21884,-20860,-19836,-18812,-17788,-16764,-15996,-15484,-14972,-14460,-13948,-13436,-12924,-12412,-11900,-11388,-10876,-10364,-9852,-9340,-8828,-8316,-7932,-7676,-7420,-7164,-6908,-6652,-6396,-6140,-5884,-5628,-5372,-5116,-4860,-4604,-4348,-4092,-3900,-3772,-3644,-3516,-3388,-3260,-3132,-3004,-2876,-2748,-2620,-2492,-2364,-2236,-2108,-1980,-1884,
-1820,-1756,-1692,-1628,-1564,-1500,-1436,-1372,-1308,-1244,-1180,-1116,-1052,-988,-924,-876,-844,-812,-780,-748,-716,-684,-652,-620,-588,-556,-524,-492,-460,-428,-396,-372,-356,-340,-324,-308,-292,-276,-260,-244,-228,-212,-196,-180,-164,-148,-132,-120,-112,-104,-96,-88,-80,-72,-64,-56,-48,-40,-32,-24,-16,-8,0,32124,31100,30076,29052,28028,27004,25980,24956,23932,22908,21884,20860,19836,18812,17788,16764,15996,15484,14972,14460,13948,13436,12924,12412,11900,11388,10876,10364,9852,9340,8828,8316,7932,
7676,7420,7164,6908,6652,6396,6140,5884,5628,5372,5116,4860,4604,4348,4092,3900,3772,3644,3516,3388,3260,3132,3004,2876,2748,2620,2492,2364,2236,2108,1980,1884,1820,1756,1692,1628,1564,1500,1436,1372,1308,1244,1180,1116,1052,988,924,876,844,812,780,748,716,684,652,620,588,556,524,492,460,428,396,372,356,340,324,308,292,276,260,244,228,212,196,180,164,148,132,120,112,104,96,88,80,72,64,56,48,40,32,24,16,8,0]},alaw:{compress:[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],decompress:[-5504,-5248,-6016,-5760,-4480,-4224,-4992,-4736,-7552,-7296,-8064,-7808,-6528,-6272,-7040,-6784,-2752,-2624,-3008,-2880,-2240,-2112,-2496,-2368,-3776,-3648,-4032,-3904,-3264,-3136,-3520,-3392,-22016,-20992,-24064,-23040,-17920,-16896,-19968,-18944,-30208,-29184,-32256,-31232,-26112,-25088,-28160,-27136,-11008,
-10496,-12032,-11520,-8960,-8448,-9984,-9472,-15104,-14592,-16128,-15616,-13056,-12544,-14080,-13568,-344,-328,-376,-360,-280,-264,-312,-296,-472,-456,-504,-488,-408,-392,-440,-424,-88,-72,-120,-104,-24,-8,-56,-40,-216,-200,-248,-232,-152,-136,-184,-168,-1376,-1312,-1504,-1440,-1120,-1056,-1248,-1184,-1888,-1824,-2016,-1952,-1632,-1568,-1760,-1696,-688,-656,-752,-720,-560,-528,-624,-592,-944,-912,-1008,-976,-816,-784,-880,-848,5504,5248,6016,5760,4480,4224,4992,4736,7552,7296,8064,7808,6528,6272,
7040,6784,2752,2624,3008,2880,2240,2112,2496,2368,3776,3648,4032,3904,3264,3136,3520,3392,22016,20992,24064,23040,17920,16896,19968,18944,30208,29184,32256,31232,26112,25088,28160,27136,11008,10496,12032,11520,8960,8448,9984,9472,15104,14592,16128,15616,13056,12544,14080,13568,344,328,376,360,280,264,312,296,472,456,504,488,408,392,440,424,88,72,120,104,24,8,56,40,216,200,248,232,152,136,184,168,1376,1312,1504,1440,1120,1056,1248,1184,1888,1824,2016,1952,1632,1568,1760,1696,688,656,752,720,560,528,
624,592,944,912,1008,976,816,784,880,848]}},encode:function(b,d){d=d||{};b.constructor==Array&&(b.byteLength=2*b.length);for(var c=new ArrayBuffer(b.byteLength/2),c=new Int8Array(c),g=a[d.alaw?"alaw":"ulaw"],h=0;h<b.byteLength/2;h++)c[h]=g(b[h]);return c},decode:function(b,d){d=d||{};"undefined"==typeof b.byteLength&&(b.byteLength=b.length);for(var c=!!d.floating_point,g=new ArrayBuffer(b.byteLength*(c?4:2)),g=c?new Float32Array(g):new Int16Array(g),h=a[(d.alaw?"alaw":"ulaw")+"_dec"],m,p=0;p<b.byteLength;p++)m=
h(b[p]),g[p]=c?m/32768:m;return g},alaw:function(b){var d=new ArrayBuffer(2),c=new ArrayBuffer(1),d=new Int16Array(d),c=new Int8Array(c),g;g=~b>>8&128;128!=g&&(d[0]=-b,b=d[0]);b>a.CLIP&&(b=a.CLIP);256<=b?(d=a.tables.alaw.compress[b>>8&127],c[0]=d<<4|b>>d+3&15):c[0]=b>>4;c[0]=c[0]^g^85;return c[0]},alaw_dec:function(b){var d=new ArrayBuffer(2),d=new Int8Array(d);b=a.tables.alaw.decompress[b&255];d[0]=b;d[1]=b>>8;return(new Int16Array(d.buffer))[0]},ulaw:function(b){var d=new ArrayBuffer(2),c=new ArrayBuffer(1),
d=new Int16Array(d),c=new Int8Array(c),g;0>b?(d[0]=a.BIAS-b,b=d[0],d=127):(b+=a.BIAS,d=255);g=a.tables.ulaw.compress[b>>8&127];if(8<=g)return 127^d;c[0]=g<<4|b>>g+3&15;return c[0]^d},ulaw_dec:function(b){var d=new ArrayBuffer(2),d=new Int8Array(d);b=a.tables.ulaw.decompress[b&255];d[0]=b;d[1]=b>>8;return(new Int16Array(d.buffer))[0]},ulaw_dec_slow:function(b){var d=new ArrayBuffer(2),d=new Int16Array(d);d[0]=~b;b=d[0];d=((b&15)<<3)+a.BIAS;d<<=(b&112)>>4;b=128==(b&128);var c=new ArrayBuffer(2),c=new Int16Array(c);
c[0]=b?a.BIAS-d:d-a.BIAS;return c[0]}};c.G711=a;c.version="0.0.1"})("undefined"!==typeof exports?module.exports:window);window.addEventListener("message",function(c){if(c.origin==window.location.origin)if("gotScreen"==c.data.type){var a;if(""===c.data.sourceId){if(c=Error("NavigatorUserMediaError"),c.name="PERMISSION_DENIED",virtualclass.hasOwnProperty("ss"))virtualclass.ss.onError(c)}else a=a||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:c.data.sourceId,maxWidth:1440,maxHeight:9999},optional:[{maxFrameRate:3},{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},virtualclass.adpt=
new virtualclass.adapter,navigator2=virtualclass.adpt.init(navigator),navigator2.getUserMedia(a,function(a){virtualclass.ss._init();roles.hasControls()&&virtualclass.ss.initializeRecorder.call(virtualclass.ss,a)},function(a){virtualclass.ss.onError.call(virtualclass.ss,a)})}else"getScreenPending"==c.data.type?window.clearTimeout(c.data.id):"yes"==c.data.type&&(virtualclass.gObj.ext=!0)});(function(c){c.dirtyCorner={decodeRGB:function(a,b,d){b=b.createImageData(d.width,d.height);for(d=0;d<4*a.length;d++)b.data[4*d+0]=36.5*(a[d]>>5),b.data[4*d+1]=36.5*((a[d]&28)>>2),b.data[4*d+2]=85*(a[d]&3),b.data[4*d+3]=255;return b},decodeRGBSlice:function(a,b,d){b=b.createImageData(d.w,d.h);for(d=0;d<4*a.length;d++)b.data[4*d+0]=36.5*(a[d]>>5),b.data[4*d+1]=36.5*((a[d]&28)>>2),b.data[4*d+2]=85*(a[d]&3),b.data[4*d+3]=255;return b},encodeRGB:function(a){for(var b=a.length/4,d=new Uint8ClampedArray(b),
c,g,h,m=0;m<b;m++)c=a[4*m+0],g=a[4*m+1],h=a[4*m+2],c=(Math.round(c/36.5)<<5)+(Math.round(g/36.5)<<2)+Math.round(h/85),d[m]=c;return d},str2ImageData:function(a,b){var d=context2.createImageData(b.w,b.h),c=new ArrayBuffer(a.length);d.data=new Uint8Array(c);for(c=0;c<strLen;c++)d.data[c]=a.charCodeAt(c);return d},doClearCanvas:function(){context2.clearRect(0,0,canvas2.width,canvas2.height)}}})(window);(function(c){c.vutil={createDOM:function(a,b,d){a=document.createElement(a);"undefined"!=typeof b&&(a.id=b);if("undefined"!=typeof d){b="";if(0<d.length)for(var c=0;c<d.length;c++)b+=d[c]+" ";a.className=b}return a},ab2str:function(a){return String.fromCharCode.apply(null,new Uint8ClampedArray(a))},str2ab:function(a){for(var b=new ArrayBuffer(a.length),b=new Uint8ClampedArray(b),d=0,c=a.length;d<c;d++)b[d]=a.charCodeAt(d);return b},sidebarHeightInit:function(){document.getElementById("widgetRightSide").style.height=
c.innerHeight+"px"},isSystemCompatible:function(){if(0<virtualclass.error.length){var a=1<virtualclass.error.length?virtualclass.error.join("<br />"):virtualclass.error[0];virtualclass.view.createErrorMsg(a,"errorContainer","chatWidget");virtualclass.gObj.hasOwnProperty("errIE")&&virtualclass.vutil.disableVirtualClass();virtualclass.gObj.hasOwnProperty("audIntDisable")&&virtualclass.user.control.audioWidgetDisable();virtualclass.gObj.hasOwnProperty("errNotDesktop")&&(virtualclass.user.control.audioWidgetDisable(),
virtualclass.vutil.disableVirtualClass())}else(virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable"))&&virtualclass.user.control.audioWidgetDisable()},chkValueInLocalStorage:function(a){return null===localStorage.getItem(a)?!1:localStorage[a]},setContainerWidth:function(a,b){var d="virtualclassWhiteboard";"undefined"!=typeof virtualclass.previous&&(d="virtualclass"+b!=virtualclass.previous?"virtualclass"+b:virtualclass.previous);var d=d.split("virtualclass")[1],
d="virtualclass"+virtualclass.vutil.capitalizeFirstLetter(d),c=document.getElementById(d);if(null!=c){var g=5,h;if("Whiteboard"==b)h=0;else{h=document.getElementById("virtualclassOptionsCont");if(null!=h){var m=vcan.utility.getElementOffset(h);h=h.offsetWidth+m.x}else h=0;"Yts"==b?g=roles.hasControls()?60:15:"EditorRich"==virtualclass.currApp||"EditorCode"==virtualclass.currApp?0<h?g=12:h=roles.hasControls()?70:5:g="ScreenShare"==b?70:65}m=70;virtualclass.isPlayMode&&(m+=75);var p=document.getElementById("commandToolsWrapper");
null!=p?m=m+p.clientHeight+3:(roles.isEducator()||roles.hasControls())&&"Whiteboard"==virtualclass.currApp&&(m=m+46+3);a.width-=g+h+0;c.style.width=a.width+"px";c.style.height=a.height-m+"px";"virtualclassScreenShare"==d&&(g=document.getElementById(d+"Local"),a.width-=10,c.style.width=a.width,g.style.width=a.width+"px",virtualclass.vutil.setScreenInnerTagsWidth(d))}else console.log(c+" is not found ")},setScreenInnerTagsWidth:function(a){document.getElementById(a);document.getElementById(a+"Local");
document.getElementById(a+"LocalVideo")},makeActiveApp:function(a,b){if(a!=b&&"undefined"!=typeof b)b+="Tool",document.getElementById(b).className=virtualclass.vutil.removeClassFromElement(b,"active");else{for(var d=document.getElementsByClassName("appOptions"),c=0;c<d.length;c++)d[c].classList.contains("active")&&d[c].classList.remove("active");console.log("Whiteboard Tool class:- is "+b+" with app "+a)}document.getElementById(a+"Tool").className+=" active"},initInstallChromeExt:function(a){"EXTENSION_UNAVAILABLE"==
a.name&&(console.log("ask for inline installation"),chrome.webstore.install("https://chrome.google.com/webstore/detail/ijhofagnokdeoghaohcekchijfeffbjl",function(a){c.location.reload()},function(a){alert(a)}))},removeAppPanel:function(){var a=document.getElementById("virtualclassOptionsCont");null!=a&&a.parentNode.removeChild(a)},removeTempVideo:function(a){a=document.getElementById(a);a.parentNode.removeChild(a)},createLocalTempVideo:function(a,b){if("string"==typeof a||"String"==typeof a)a=document.getElementById(a);
var d=virtualclass.vutil.createDOM("div",b),c=virtualclass.vutil.createDOM("canvas",b+"Video");d.appendChild(c);a.appendChild(d)},initLocCanvasCont:function(a){var b;b="ScreenShare"==virtualclass.currApp?"ss":"wss";virtualclass[b].localtempCanvas=document.getElementById(a);console.log(virtualclass[b].localtempCanvas);virtualclass[b].localtempCont=virtualclass[b].localtempCanvas.getContext("2d")},videoTeacher2Student:function(a,b){var d=a,c=document.getElementById("virtualclass"+a+"LocalVideo");if(null!=
c&&"VIDEO"==c.tagName){var g=document.createElement("canvas");g.id=c.id;g.width=c.offsetWidth;g.height=c.offsetHeight;c.parentNode.replaceChild(g,c);"ScreenShare"==d&&(d="ss");"undefined"!=typeof b||"undefined"==typeof d||"ss"!=d&&"wss"!=d||(virtualclass[d].localCanvas=g,virtualclass[d].localCont=virtualclass[d].localCanvas.getContext("2d"),c=virtualclass[d].localtempCont.getImageData(0,0,virtualclass[d].localtempCanvas.width,virtualclass[d].localtempCanvas.height),virtualclass[d].localCont.putImageData(c,
0,0));virtualclass.vutil.removeTempVideo("virtualclass"+a+"LocalTemp")}},clickOutSideCanvas:function(){this.exitTextWrapper()&&virtualclass.wb.obj.drawTextObj.textUtility(virtualclass.wb.gObj.spx,virtualclass.wb.gObj.spy)},exitTextWrapper:function(){return 0<document.getElementsByClassName("textBoxContainer").length},attachClickOutSideCanvas:function(){function a(a){a=document.getElementById(a);null!=a&&(a.onclick=function(){roles.hasControls()&&virtualclass.vutil.clickOutSideCanvas()})}a("commandToolsWrapper");
a("virtualclassOptionsCont");a("audioWidget");a("chatWidget")},dimensionMatch:function(a,b){var d=document.getElementById(a).offsetWidth,c=document.getElementById("virtualclassOptionsCont").offsetWidth;return document.getElementById(b).offsetWidth+c==d},disableAppsBar:function(){var a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.pointerEvents="none")},isMiniFileIncluded:function(a){a=new RegExp(a+".js?=*([0-9]*)");for(var b=document.getElementsByTagName("script"),d=0;d<b.length;d++)if(a.test(b[d].src))return!0;
return!1},clearAllChat:function(){localStorage.removeItem(virtualclass.gObj.uid);localStorage.clear("chatroom");virtualclass.chat.idList.length=0;clearAllChatBox();var a=document.getElementById("chatWidget").getElementsByClassName("ui-chatbox-msg");if(0<a.length)for(;null!=a[0];)a[0].parentNode.removeChild(a[0])},isObjectEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},removeSessionTool:function(){if(!roles.hasAdmin()){var a=document.getElementById("virtualclassSessionEndTool");
null!=a&&a.parentNode.removeChild(a)}},addClass:function(a,b){var d=document.getElementById(a);virtualclass.vutil.elemHasAnyClass(a)?d.classList.add(b):d.className=b},removeClass:function(a,b){var d=document.getElementById(a);virtualclass.vutil.elemHasAnyClass(a)&&d.classList.contains(b)&&d.classList.remove(b)},breakIntoBytes:function(a,b){for(var d=a.toString(),c=d.length;c<b;c++)d="0"+d;return d.match(/[\S]{1,2}/g)||[]},numValidateFour:function(a,b,d,c){a=this.preNumValidateTwo(a);b=this.preNumValidateTwo(b);
d=this.preNumValidateTwo(d);c=this.preNumValidateTwo(c);return parseInt(a+b+d+c)},numValidateTwo:function(a,b){a=this.preNumValidateTwo(a);b=this.preNumValidateTwo(b);return parseInt(a+b)},preNumValidateTwo:function(a){a=a.toString();if(1==a.length)return"0"+a;if(2==a.length)return a},elemHasAnyClass:function(a){a=document.getElementById(a);return null!=a?"undefined"!=typeof a.classList:!1},userIsOrginalTeacher:function(a){return roles.hasAdmin()},isUserTeacher:function(a){return roles.hasControls()},
initDisableAudVid:function(){virtualclass.gObj.audIntDisable=!0;virtualclass.gObj.vidIntDisable=!0},initDisableVirtualClass:function(){this.initDisableAudVid();virtualclass.gObj.errNotDesktop=!0;virtualclass.gObj.errNotScreenShare=!0;virtualclass.gObj.errAppBar=!0},disableVirtualClass:function(){var a=document.getElementById("virtualclassCont");a.style.opacity=.6;a.style.pointerEvents="none"},enableVirtualClass:function(){var a=document.getElementById("virtualclassCont");a.style.opacity=1;a.style.pointerEvents=
"visible"},firstiOSaudioCall:function(){virtualclass.gObj.hasOwnProperty("audioPlayMessage")&&(virtualclass.gObj.iosIpadbAudTrue=!0,virtualclass.gObj.video.audio.receivedAudioProcess(virtualclass.gObj.audioPlayMessage))},beforeLoad:function(){if(0==localStorage.length)virtualclass.storage.clearStorageData();else{if("undefined"!=typeof virtualclass.storage.wholeStoreData){var a=JSON.parse(virtualclass.storage.wholeStoreData);a.beforeRefresh=!0;virtualclass.storage.wholeStore(a,"put")}localStorage.setItem("executedSerial",
JSON.stringify(ioMissingPackets.executedSerial));localStorage.setItem("executedUserSerial",JSON.stringify(ioMissingPackets.executedUserSerial));localStorage.removeItem("otherRole");virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.video.audio.studentNotSpeak();virtualclass.vutil.clickOutSideCanvas();localStorage.setItem(wbUser.sid,JSON.stringify(virtualclass.chat.vmstorage));virtualclass.hasOwnProperty("editorRich")&&"object"==typeof virtualclass.editorRich.vcAdapter&&virtualclass.editorRich.saveIntoLocalStorage();
virtualclass.hasOwnProperty("editorCode")&&"object"==typeof virtualclass.editorCode.vcAdapter&&virtualclass.editorCode.saveIntoLocalStorage();a={name:virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp)};"ScreenShare"==virtualclass.currApp?a.name="EditorRich":"Yts"==virtualclass.currApp&&(a.metaData="undefined"!=typeof virtualclass.yts.videoId&&"object"==typeof virtualclass.yts.player?{init:virtualclass.yts.videoId,startFrom:virtualclass.yts.player.getCurrentTime()}:null);roles.hasView()&&
"Yts"==virtualclass.currApp&&(a={name:"Yts",metaData:null});localStorage.setItem("prevApp",JSON.stringify(a));io.disconnect()}},initOnBeforeUnload:function(a){"iOS"==a?document.body.onunload=function(){virtualclass.vutil.beforeLoad()}:c.onbeforeunload=function(){var a=virtualclass.vutil.smallizeFirstLetter(virtualclass.currApp);virtualclass.vutil.beforeLoad();if(("editorRich"==a||"editorCode"==a)&&"Synchronized"!=virtualclass[a].cmClient.state.constructor.name)return virtualclass.lang.getString("editorinsync")}},
isPlayMode:function(){return!0==c.wbUser.virtualclassPlay},progressBar:function(a,b,d,c){b>a&&(b=a,document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"));a=0==a&&0==b?0:Math.round(100*b/a);document.getElementById(d).style.width=a+"%";document.getElementById(c).innerHTML=a+"%"},hidePrevIcon:function(a){var b=document.getElementById(virtualclass.previous);null!=b&&(b.style.display="none",console.log("Hide previous screen with display new "+a),"ss"==a?"object"==
typeof virtualclass[a]&&(document.getElementById(virtualclass[a].id).style.display="block"):document.getElementById(virtualclass[a].id).style.display="block")},getUserInfo:function(a,b,d){for(var c=0;c<d.length;c++)if(d[c].userid==b)return d[c][a]},smallizeFirstLetter:function(a){return a.charAt(0).toLowerCase()+a.slice(1)},capitalizeFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},initDefaultInfo:function(a,b){"t"==a&&"Whiteboard"==b?roles.hasAdmin()||(virtualclass.wb.utility.setOrginalTeacherContent(),
virtualclass.wb.attachToolFunction(vcan.cmdWrapperDiv,!0)):"s"==a&&(vcan.studentId=wbUser.id,roles.hasControls()||localStorage.setItem("uRole",a),virtualclass.vutil.removeSessionTool());virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable")||(virtualclass.gObj.video.init(),virtualclass.gObj.video.isInitiator=!0);vcan.oneExecuted=!1},removeClassFromElement:function(a,b){if("t_reclaim"!=a){var d=document.getElementById(a);if(0<d.classList.length)return d.classList.remove(b),
d.className;console.log("Whiteboard Tool class:- could not remove "+b)}},beforeSend:function(a,b,d){if(a.hasOwnProperty("createArrow"))a=JSON.stringify(a),virtualclass.wb.vcan.optimize.sendPacketWithOptimization(a,io.sock.readyState,100);else{if(a.hasOwnProperty("repObj")){if("undefined"==typeof a.repObj[a.repObj.length-1])return;virtualclass.wb.gObj.rcvdPackId=a.repObj[a.repObj.length-1].uid;virtualclass.wb.gObj.displayedObjId=virtualclass.wb.gObj.rcvdPackId;console.log("Last send data "+virtualclass.wb.gObj.rcvdPackId)}JSON.stringify(a);
"undefined"!=typeof d&&!0===d?"undefined"==typeof b||!1===b||null===b?ioAdapter.send(a):ioAdapter.sendUser(a,b):"undefined"==typeof b||!1===b||null===b?ioAdapter.mustSend(a):ioAdapter.mustSendUser(a,b)}},breakintobytes:function(a,b){for(var d=a.toString(),c=d.length;c<b;c++)d="0"+d;return d.match(/[\S]{1,2}/g)||[]},createReclaimButton:function(a){this.createDiv("t_reclaim","educator",a);var b=this;document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",function(){b._reclaimRole()})},
createDiv:function(a,b,d,c){var g=b;b=virtualclass.lang.getString(b);var h=document.createElement("a");h.href="#";var m=document.createElement("div");m.id=a;"undefined"!=typeof c&&(m.className=c);c=document.createElement("span");c.className="icon-"+g;h.appendChild(c);h.dataset.title=b;h.className="tooltip";m.appendChild(h);"t_reclaim"==a?(a=document.getElementById(virtualclass.html.id),d.appendChild(m),a.insertBefore(d,a.firstChild)):d.appendChild(m)},assignRole:function(a){"object"==typeof virtualclass.wb&&
(virtualclass.wb.tool="","move"==vcan.main.action&&virtualclass.wb.utility.deActiveFrmDragDrop());if("undefined"!=typeof a){if(roles.isEducator()){var b=document.getElementById(virtualclass.gObj.commandToolsWrapperId);b.parentNode.removeChild(b);virtualclass.vutil.removeClass("virtualclassCont","educator")}else virtualclass.vutil.addClass("virtualclassCont","presentor");roles.hasAdmin()?virtualclass.gObj.uRole="t":virtualclass.gObj.uRole="p";localStorage.setItem("uRole",virtualclass.gObj.uRole);virtualclass.user.assignRole(virtualclass.gObj.uRole,
virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp),a);"object"==typeof virtualclass.wb&&vcan.utility.canvasCalcOffset(vcan.main.canid);"Yts"==virtualclass.currApp&&(a=document.getElementById("virtualclassYts"),null!=a?null==document.getElementById("player")&&virtualclass.yts.UI.createPlayerTag(a):virtualclass.yts.UI.container(),virtualclass.yts.UI.inputURL(),"object"==typeof virtualclass.yts.player?virtualclass.yts.seekChangeInterval():console.log("Player object is not ready"))}else{"Yts"==
virtualclass.currApp&&(virtualclass.yts.UI.removeinputURL(),virtualclass.yts.hasOwnProperty("tsc")&&clearInterval(virtualclass.yts.tsc));roles.hasAdmin()?virtualclass.gObj.uRole="e":virtualclass.gObj.uRole="s";b=document.getElementById(virtualclass.gObj.commandToolsWrapperId);if(null!=b)for(;b.hasChildNodes();)b.removeChild(b.lastChild);else b=virtualclass.vutil.createCommandWrapper();"object"==typeof virtualclass.wb&&virtualclass.wb.utility.makeCanvasDisable();roles.hasAdmin()?(document.getElementById("virtualclassCont"),
virtualclass.vutil.createReclaimButton(b),virtualclass.vutil.addClass("virtualclassCont","educator")):(virtualclass.vutil.removeClass("virtualclassCont","presentor"),null!=b&&b.parentNode.removeChild(b));localStorage.setItem("uRole",virtualclass.gObj.uRole);"object"==typeof virtualclass.wb&&virtualclass.wb.utility.uniqueArrOfObjsToStudent()}virtualclass.system.setAppDimension();virtualclass.vutil.renderWhiteboardObjectsIfAny();roles.hasAdmin()||(io.disconnect(),setTimeout(function(){virtualclass.uInfo.userobj.role=
virtualclass.gObj.uRole;io.init(virtualclass.uInfo)},500))},renderWhiteboardObjectsIfAny:function(){"object"==typeof virtualclass.wb&&0<virtualclass.wb.vcan.main.children.length&&virtualclass.wb.vcan.renderAll()},createCommandWrapper:function(){var a=document.createElement("div");a.id=virtualclass.gObj.commandToolsWrapperId;var b=document.getElementById(vcan.canvasWrapperId);null!=b?document.getElementById("containerWb").insertBefore(a,b):document.getElementById("containerWb").appendChild(a);return a},
_reclaimRole:function(){virtualclass.vutil.beforeSend({reclaimRole:!0,cf:"reclaimRole"});var a=document.getElementById("t_reclaim");a.style.pointerEvents="none";a.style.opacity="0.5";var b=this;setTimeout(function(){b.reclaimRole();virtualclass.user.control.changeAttrToAssign("enable")},2E3)},reclaimRole:function(){virtualclass.gObj.controlAssign=!1;this.vcResponseAssignRole(virtualclass.gObj.uid,virtualclass.gObj.uid,!0)},vcResponseAssignRole:function(a,b,d){if(a!=b||"undefined"!=typeof d)if(virtualclass.vutil.assignRole(b),
"object"==typeof virtualclass.wb&&virtualclass.wb.utility.uniqueArrOfObjsToTeacher(),roles.hasAdmin())a=document.getElementById("chat_div").getElementsByClassName("currTeacher")[0],null!=a&&virtualclass.user.control.removeCurrTeacherFromControl(a.id),virtualclass.user.control.changeAttrToAssign("enable");else{virtualclass.vutil.removeSessionTool();b=document.getElementById("ml"+a);d=["assign"];var c=document.getElementById(a+"ControlContainer");null!=c?virtualclass.user.createAssignControl(c,a,!0):
(d=virtualclass.user.createControl(a,d),b.appendChild(d));localStorage.setItem("aId",a)}virtualclass.vutil.attachClickOutSideCanvas();"mobTab"==virtualclass.system.device&&(virtualclass.vutil.disableVirtualClass(),virtualclass.view.createErrorMsg(virtualclass.lang.getString("supportDesktop"),"errorContainer","chatWidget"))},vcResponseAReclaimRole:function(a,b){if(a!=b){if("object"==typeof virtualclass.wb){var d=virtualclass.wb.vcan.main.replayObjs[virtualclass.wb.vcan.main.replayObjs.length-1];if("object"==
typeof d&&"del"==d.ac)console.log("Delete command:- Transferring the delete command"),virtualclass.vutil.beforeSend({repObj:[d],cf:"repObj"});else if("t_text"==virtualclass.wb.tool.cmd&&"create"==virtualclass.wb.vcan.main.action)virtualclass.wb.obj.drawTextObj.finalizeTextIfAny(!0),console.log("Text command:- Transferring text command");else if(virtualclass.wb.tool.hasOwnProperty("started")&&!0==virtualclass.wb.tool.started||"move"==virtualclass.wb.vcan.main.action)d=vcan.extend({},virtualclass.wb.vcan.main.replayObjs[virtualclass.wb.vcan.main.replayObjs.length-
1]),d.ac="u",d=d.hasOwnProperty("mtext")?{detail:{cevent:{x:d.x,y:d.y,mtext:d.mtext}}}:{detail:{cevent:{x:d.x,y:d.y}}},d.detail.broadCast=!0,d=new CustomEvent("mouseup",d),vcan.main.canvas.dispatchEvent(d),console.log("Whiteboard:- Transfering the assign role to Teacher");console.log("Role assign with reclaim")}virtualclass.user.control._assign(b,"notsent",a);virtualclass.user.displayStudentSpeaker(!0);null!=localStorage.getItem("aId")&&localStorage.removeItem("aId");virtualclass.user.control.removeAudioFromParticipate(a);
"mobTab"==virtualclass.system.device&&((virtualclass.system.mybrowser.name=8<=virtualclass.system.mybrowser.version)&&/(iPad)/g.test(navigator.userAgent)&&virtualclass.vutil.enableVirtualClass(),virtualclass.view.removeErrorMsg("errorContainer",!0))}},createReclaimButtonIfNeed:function(){if(roles.isEducator()){var a=virtualclass.vutil.createCommandWrapper();virtualclass.vutil.createReclaimButton(a);return!0}return!1},whoIsTeacher:function(){if(virtualclass.hasOwnProperty("connectedUsers"))for(var a=
0;a<virtualclass.connectedUsers.length;a++)if("t"==virtualclass.connectedUsers[a].role||"e"==virtualclass.connectedUsers[a].role)return virtualclass.connectedUsers[a].userid;return 0},enablePresentatorEditors:function(a){a={toUser:a,status:!0};virtualclass.user.control.received_editorRich(a);virtualclass.user.control.received_editorCode(a)},getClassName:function(a){var b;"t"==a?b="teacher":"e"==a?b="educator":"s"==a?b="student":"p"==a&&(b="presentor");return b},isPresenterExist:function(){for(var a=
0;a<virtualclass.connectedUsers.length;a++)if("p"==virtualclass.connectedUsers[a].role)return!0;return!1},setReadModeWhenTeacherIsDisConn:function(a){if(!roles.hasAdmin()){var b=localStorage.getItem("oTDisconn");null!=b&&((b=JSON.parse(b))?virtualclass.hasOwnProperty(a)?"object"==typeof virtualclass[a].cm?virtualclass[a].cm.setOption("readOnly","nocursor"):console.log("Editor CM is not defined for editor "+a):console.log("Editor type "+a+" is not ready."):console.log("Teacher is connected."))}},setReadModeWhenTeacherIsConn:function(a){localStorage.removeItem("oTDisconn");
var b=document.getElementById(virtualclass.vutil.capitalizeFirstLetter(a)+"writeModeBox");null!=b?"true"==b.getAttribute("data-write-mode")?virtualclass[a].cm.setOption("readOnly",!1):virtualclass[a].cm.setOption("readOnly","nocursor"):console.log("Editor:- writemode element is not found for "+a)}}})(window);(function(c){var a,b,d,f,g,h;c.studentScreen=function(){return{ssProcess:function(a,d,b,c){var f=a[0];a=new Uint8ClampedArray(d);var g,h,q,r;switch(f){case 102:case 202:q=virtualclass.vutil.numValidateTwo(a[1],a[2]);h=virtualclass.vutil.numValidateTwo(a[3],a[4]);d=a.subarray(5,a.length);this.initStudentScreen(d,{w:q,h:h},b,c);break;case 103:case 203:d=7;for(q=0;q+7<=a.length;q=r+1)f=virtualclass.vutil.numValidateTwo(a[q+1],a[q+2]),g=virtualclass.vutil.numValidateTwo(a[q+3],a[q+4]),h=parseInt(a[q+
5]),q=parseInt(a[q+6]),r=d+h*q-1,d=a.subarray(d,r+1),this.initStudentScreen(d,{x:f,y:g,w:q,h:h},b,c),d=r+7+1;break;case 104:case 204:f=virtualclass.vutil.numValidateTwo(a[1],a[2]),g=virtualclass.vutil.numValidateTwo(a[3],a[4]),h=virtualclass.vutil.numValidateTwo(a[5],a[6]),q=virtualclass.vutil.numValidateTwo(a[7],a[8]),d=a.subarray(9,a.length),a={d:{w:f,h:g},vc:{w:h,h:q}},this.initStudentScreen(d,a,b,c)}},initStudentScreen:function(a,d,c,f){virtualclass.vutil.addClass("audioWidget","fixed");g=c;c=
document.getElementById("virtualclass"+virtualclass.apps[1]);"object"!=typeof virtualclass[g]||null==c?("undefined"!=typeof vtype&&(virtualclass.recorder.recImgPlay=!0),virtualclass.makeAppReady(f)):(virtualclass.currApp=f,virtualclass.vutil.hidePrevIcon(g));if(d.hasOwnProperty("d"))virtualclass[g].dimensionStudentScreenResize(d),h=!0,virtualclass[g].drawImages(a);else{if("undefined"==typeof h||"undefined"!=typeof b&&b!=d.w&&!d.hasOwnProperty("x"))h=!0,virtualclass[g].dimensionStudentScreen(d.w,d.h),
b=d.w;d.hasOwnProperty("x")?virtualclass[g].drawImages(a,d):(d.hasOwnProperty("w")&&(virtualclass[g].localCanvas.width=d.w,virtualclass[g].localCanvas.height=d.h),virtualclass[g].drawImages(a))}virtualclass.previous=virtualclass[g].id}}};c.screenShare=function(b){virtualclass.getSceenFirefox=function(){var a=parseInt(c.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);33<=a?(virtualclass.adpt=new virtualclass.adapter,virtualclass.adpt.init(navigator).getUserMedia({video:{mozMediaSource:"window",mediaSource:"window"}},
function(a,d){virtualclass.ss._init();if(roles.hasControls()){if(virtualclass.ss.initializeRecorder.call(virtualclass.ss,a),"undefined"==typeof d)var b=a.currentTime,f=c.setInterval(function(){a||c.clearInterval(f);if(a.currentTime==b&&(c.clearInterval(f),a.onended))a.onended();b=a.currentTime},500)}else console.log("Set previous app as current app if teacher reclaim role during screen share"),virtualclass.ss.setCurrentApp()},function(a){virtualclass.ss.setCurrentApp();"string"==typeof a?"PERMISSION_DENIED"===
a&&c.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus():"object"==typeof a&&"PermissionDeniedError"===a.name&&c.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus()})):alert(virtualclass.lang.getString("notSupportBrowser",[a]))};return{prevStream:!1,init:function(a){this.type=a.type;this.ssByClick=!0;this.manualStop=!1;roles.hasControls()&&!virtualclass.recorder.recImgPlay?this.readyTostart(a.app):this._init()},_init:function(){this.currApp=this.tempCurrApp;
document.getElementById("virtualclassCont").dataset.currapp=virtualclass.currApp;virtualclass.previous!=b.id&&(document.getElementById(virtualclass.previous).style.display="none",virtualclass.previous=b.id);var a=document.getElementById(b.id);null!=a&&(a.style.display="block");if(!this.hasOwnProperty("id")){this.dc=virtualclass.dirtyCorner;this.postFix="Cont";this.id=b.hasOwnProperty("id")?b.id:"virtualclassScreenShare";this.className="virtualclass";this.label="Local";this.local=this.id+this.label;
this.localTemp=this.id+this.label+"Temp";this.classes=b.hasOwnProperty("class")?b.classes:"";this.initPrevImage();a=document.getElementById(this.id);null!=a&&a.parentNode.removeChild(a);var a=this.html.UI.call(this,virtualclass.gObj.uRole),d=document.getElementById(virtualclass.rWidgetConfig.id);document.getElementById(virtualclass.html.id).insertBefore(a,d);roles.hasControls()&&!virtualclass.recorder.recImgPlay&&virtualclass.vutil.initLocCanvasCont(this.localTemp+"Video")}},readyTostart:function(a){a==
virtualclass.apps[1]&&this.getScreen()},onError:function(a){virtualclass.ss.setCurrentApp();console.log("Error "+a)},getScreen:function(a){"Chrome"==virtualclass.system.mybrowser.name?virtualclass.gObj.hasOwnProperty("ext")&&virtualclass.gObj.ext?c.postMessage({type:"getScreen",id:1},"*"):chrome.webstore.install("https://chrome.google.com/webstore/detail/ijhofagnokdeoghaohcekchijfeffbjl",function(){c.location.reload()}):"Firefox"==virtualclass.system.mybrowser.name&&virtualclass.getSceenFirefox()},
unShareScreen:function(){this.video.src="";this.localtempCont.clearRect(0,0,this.localtempCanvas.width,this.localtempCanvas.height);clearInterval(virtualclass.clear);this.initPrevImage();this.hasOwnProperty("currentStream")&&this.currentStream.stop();virtualclass.vutil.beforeSend({unshareScreen:!0,st:this.type,cf:"unshareScreen"})},removeStream:function(){virtualclass.vutil.removeClass("audioWidget","fixed");this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height)},initializeRecorder:function(d){virtualclass.vutil.addClass("audioWidget",
"fixed");a=1;this.prevStream&&(this.ssByClick=!1);"undefined"!=typeof virtualclass.prevScreen&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&virtualclass.prevScreen.unShareScreen();this.video=document.getElementById(this.local+"Video");if("VIDEO"!=this.video.tagName){var b=this.video,f=document.createElement("video");f.id=b.id;this.video.parentNode.replaceChild(f,this.video);this.video=document.getElementById(this.local+"Video");this.video.autoplay=!0;virtualclass.vutil.createLocalTempVideo("virtualclassScreenShare",
this.local+"Temp");virtualclass.vutil.initLocCanvasCont(this.local+"TempVideo")}this.currentStream=d;var g=this;virtualclass.adpt.attachMediaStream(this.video,d);this.prevStream=!0;this.currentStream.onended=function(a){g.ssByClick?(g.video.src="",g.localtempCont.clearRect(0,0,g.localtempCanvas.width,g.localtempCanvas.height),clearInterval(virtualclass.clear),g.initPrevImage(),virtualclass.vutil.beforeSend({unshareScreen:!0,st:g.type,cf:"unshareScreen"}),g.prevStream=!1,g.prevScreen="",virtualclass.prevScreen=
""):g.ssByClick=!0};d={};d.width=c.innerWidth;d.height=c.innerHeight-140;var b=document.getElementById(this.local),m=this.html.getDimension(d);b.style.width=Math.round(m.width)+"px";b.style.height=Math.round(m.height)+"px";g=this;this.video.onloadedmetadata=function(){g.width=m.width;g.height=m.height;g.localtempCanvas.width=g.video.offsetWidth;g.localtempCanvas.height=g.video.offsetHeight;virtualclass.prevScreen=g;var a=virtualclass.system.measureResoultion({width:c.innerWidth,height:c.innerHeight});
g.sharing();virtualclass.vutil.setContainerWidth(a,virtualclass.currApp);roles.hasControls()&&(virtualclass.vutil.makeActiveApp(g.id,virtualclass.previrtualclass),"virtualclassYts"==virtualclass.previrtualclass&&virtualclass.yts.destroyYT());virtualclass.previrtualclass=g.id}},sharing:function(){function b(a,d){for(var c=a.toString(),f=c.length;f<d;f++)c="0"+c;return c.match(/[\S]{1,2}/g)||[]}function g(){clearInterval(virtualclass.clear);if("undefined"!=typeof d&&"undefined"!=typeof f){if(d!=r.video.offsetWidth||
f!=r.video.offsetHeight)a=1}else d=r.video.offsetWidth,f=r.video.offsetHeight;1==a?setTimeout(h,2E3):t(r.type)}function m(a){switch(!0){case 300>=a||"undefined"==typeof a:u=300;break;case 3E3>=a:u=a;break;case 5E3>=a:u=3E3;break;default:u=5E3}}function h(){console.log("RESIZE");if(roles.hasControls()){d=r.video.offsetWidth;f=r.video.offsetHeight;w=Math.round(r.localtempCanvas.height/12);q=Math.round(r.localtempCanvas.width/12);var t=r.type;r.localtempCanvas.width=r.video.offsetWidth;r.localtempCanvas.height=
r.video.offsetHeight;r.localtempCont.drawImage(r.video,0,0,r.video.offsetWidth,r.video.offsetHeight);var x=r.localtempCont.getImageData(0,0,r.localtempCanvas.width,r.localtempCanvas.height),x=r.dc.encodeRGB(x.data),H=Math.round(r.localtempCanvas.width/q),S=Math.round(r.localtempCanvas.height/w),E,O,N,W;W=r.getContainerDimension();"undefined"!=typeof d&&"undefined"!=typeof f?(E=b(d,4),O=b(f,4)):(E=b(r.video.offsetWidth,4),O=b(r.video.offsetHeight,4));N=b(W.width,4);W=b(W.height,4);t=new Uint8ClampedArray(["ss"==
t?104:204,E[0],E[1],O[0],O[1],N[0],N[1],W[0],W[1]]);E=new Uint8ClampedArray(x.length+t.length);E.set(t);E.set(x,t.length);c.Worker&&sworker.postMessage({img:x,resize:1,resA:w,resB:q,dw:H,dh:S,offsetWidth:r.video.offsetWidth,offsetHeight:r.video.offsetHeight},[x.buffer]);ioAdapter.sendBinary(E);m(E.length/128);a=0;clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,u)}}function t(a){r.localtempCanvas.width=r.video.offsetWidth;r.localtempCanvas.height=r.video.offsetHeight;r.localtempCont.drawImage(r.video,
0,0,r.video.offsetWidth,r.video.offsetHeight);a=Math.round(r.localtempCanvas.width/q);var d=Math.round(r.localtempCanvas.height/w),b=r.localtempCont.getImageData(0,0,r.video.offsetWidth,r.video.offsetHeight);c.Worker&&(sworker.postMessage({img:b.data,resA:w,resB:q,dw:a,dh:d,offsetWidth:r.video.offsetWidth,offsetHeight:r.video.offsetHeight,type:r.type},[b.data.buffer]),sworker.onmessage=function(a){if(1==a.data.needFullScreen){a=virtualclass.getDataFullScreen(r.type);ioAdapter.sendBinary(a);var d=
a.length/128}else null!=a.data.masterSlice&&(ioAdapter.sendBinary(a.data.masterSlice),d=a.data.masterSlice.length/128);m(d);clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,u)});clearInterval(virtualclass.clear)}var w=Math.round(this.localtempCanvas.height/12),q=Math.round(this.localtempCanvas.width/12),r=this;virtualclass.hasOwnProperty("wholeImage")&&clearInterval(virtualclass.wholeImage);virtualclass.hasOwnProperty("clear")&&clearInterval(virtualclass.clear);var u=1E3;virtualclass.getDataFullScreen=
function(a){r.localtempCanvas.width=r.video.offsetWidth;r.localtempCanvas.height=r.video.offsetHeight;r.localtempCont.drawImage(r.video,0,0,r.video.offsetWidth,r.video.offsetHeight);var d=r.localtempCont.getImageData(0,0,r.localtempCanvas.width,r.localtempCanvas.height),d=r.dc.encodeRGB(d.data),c=b(r.localtempCanvas.height,4),f=b(r.localtempCanvas.width,4);a=new Uint8ClampedArray(["ss"==a?102:202,f[0],f[1],c[0],c[1]]);c=new Uint8ClampedArray(d.length+a.length);c.set(a);c.set(d,a.length);return c};
clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,u)},getContainerDimension:function(){var a=document.getElementById(this.id+"Local");return{width:a.offsetWidth,height:a.offsetHeight}},drawImages:function(a,d){if("undefined"!=typeof d){var b=this.dc.decodeRGBSlice(a,this.localCont,d);this.localCont.putImageData(b,d.x,d.y)}else b=this.dc.decodeRGB(a,this.localCont,this.localCanvas),this.localCont.putImageData(b,0,0)},drawSingleImage:function(a){a=this.dc.decodeRGB(a,this.localCont,
this.localCanvas);this.localCont.putImageData(a,0,0)},dimensionStudentScreen:function(a,d){this.localCanvas=document.getElementById(virtualclass[g].local+"Video");this.localCont=virtualclass[g].localCanvas.getContext("2d");this.localCanvas.width=a;this.localCanvas.height=d;console.log("normal width "+this.localCanvas.width)},dimensionStudentScreenResize:function(a,d){this.hasOwnProperty("vac")||(this.vac=!0,this.localCanvas=document.getElementById(virtualclass[g].local+"Video"),this.localCont=virtualclass[g].localCanvas.getContext("2d"));
a.hasOwnProperty("d")&&(this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height),this.localCanvas.width=a.d.w,this.localCanvas.height=a.d.h);if(a.hasOwnProperty("vc")){var b=document.getElementById(virtualclass[g].local);b.style.width=a.vc.w+"px";b.style.height=a.vc.h+"px"}"virtualclassScreenShare"==virtualclass.previous&&virtualclass.vutil.setScreenInnerTagsWidth(virtualclass.previous)},html:{UI:function(a){a=virtualclass.vutil.createDOM("div",this.id,[this.className]);var d=
virtualclass.vutil.createDOM("div",this.local,[this.label]);if(roles.hasControls()){if(virtualclass.recorder.recImgPlay)var b=virtualclass.vutil.createDOM("canvas",this.local+"Video");else b=virtualclass.vutil.createDOM("video",this.local+"Video"),b.setAttribute("autoplay",!0);d.style.cssText+=";position:relative"}else b=virtualclass.vutil.createDOM("canvas",this.local+"Video");d.appendChild(b);a.appendChild(d);roles.hasControls()&&!virtualclass.recorder.recImgPlay&&virtualclass.vutil.createLocalTempVideo(a,
this.localTemp);return a},getDimension:function(a,d){return{height:a.height,width:a.width}}},initPrevImage:function(){sworker.postMessage({initPrevImg:!0})},setCurrentApp:function(){virtualclass.hasOwnProperty("previousApp")&&"object"==typeof virtualclass.previousApp&&(virtualclass.currApp=virtualclass.previousApp.name,document.getElementById("virtualclassCont").dataset.currapp=virtualclass.currApp)}}}})(window);(function(c){function a(a){document.body.removeChild(a.target)}var b,d={},f=1,g=1,h={items:[],recImgPlay:!1,objn:0,playTimeout:"",totalSent:0,fileQueue:[],rnum:1,storeDone:0,emn:0,allFileFound:!1,waitServer:!1,waitPopup:!1,tempRecData:[],alreadyAskForPlay:!1,playStart:!1,error:0,mkDownloadLink:"",tillPlayTime:0,getPlayTotTime:!1,importfilepath:c.importfilepath,exportfilepath:c.exportfilepath,sessionKey:randomString(11),alreadyDownload:!1,init:function(a){var d=virtualclass.wb.vcan;if("undefined"!=
typeof myfunc)this.objs=d.getStates("replayObjs");else{var c=this;if("fromplay"==a)virtualclass.storage.getAllObjs(["allData"],function(){c.play()});else{for(var d=this.hasOwnProperty("prvNum")?this.prvNum:0,f=0;f<a.length;f++)this.items.push(a[f]);for(k=0;k<a.length;k++){if(a[k].hasOwnProperty("bd"))for("a"==a[k].bd?b=virtualclass.dtCon.base64DecToArrInt(a[k].recObjs):"c"==a[k].bd&&(b=virtualclass.dtCon.base64DecToArrclm(a[k].recObjs)),this.items[d].recObjs=b,f=0;f<b.length;f++)this.items[d].recObjs[f]=
b[f];d++}this.hasOwnProperty("prvNum")||c.play();this.prvNum=d}}},replayFromStart:function(){var a=[],a=this.items;virtualclass.storage.config.endSession();virtualclass.popup.closeElem();this.recImgPlay=!1;this.objn=0;this.playTimeout="";this.totalSent=0;this.fileQueue=[];this.rnum=1;this.emn=this.storeDone=0;this.waitPopup=this.waitServer=!1;this.tempRecData=[];this.playStart=this.alreadyAskForPlay=!1;this.error=0;this.mkDownloadLink="";this.tillPlayTime=0;this.getPlayTotTime=!1;this.controller.ff=
1;this.items=a;this.playProgressBar();this.play()},startUploadProcess:function(){virtualclass.recorder.startUpload=!0;virtualclass.recorder.exportData(function(){});virtualclass.popup.sendBackOtherElems()},exportData:function(a){virtualclass.popup.openProgressBar();virtualclass.recorder.items=[];virtualclass.storage.getAllObjs(["allData"],function(){"function"==typeof a&&a()})},convertInto:function(a){if("string"==typeof a.data)return a;a.data=a.data.buffer;return a},clearPopups:function(){virtualclass.popup.closeElem();
virtualclass.pbar.renderProgressBar(0,0,"progressBar","progressValue");virtualclass.storage.config.endSession()},playProgressBar:function(){this.getPlayTotTime||(this.totPlayTime=this.items.reduce(function(a,d){return d.hasOwnProperty("playTime")?{playTime:a.playTime+d.playTime}:a.playTime}),this.getPlayTotTime=!0);if(0<this.tillPlayTime){this.tillPlayTime>this.totPlayTime&&(this.tillPlayTime=this.totPlayTime);virtualclass.pbar.renderProgressBar(this.totPlayTime,this.tillPlayTime,"playProgressBar",
void 0);var a=this.convertIntoReadable(this.tillPlayTime);document.getElementById("tillRepTime").innerHTML=a.m+" : "+a.s;"undefined"==typeof alreadyCalcTotTime&&(a=this.convertIntoReadable(this.totPlayTime),document.getElementById("totalRepTime").innerHTML=a.m+" : "+a.s,alreadyCalcTotTime=!0)}else virtualclass.pbar.renderProgressBar(this.totPlayTime,0,"playProgressBar",void 0)},convertIntoReadable:function(a){a/=1E3;return{s:Math.floor(a%60),m:Math.floor(a/60)}},xhrsenddata:function(a,d,b){"undefined"!=
typeof d&&(virtualclass.recorder.error=1);"undefined"!=typeof b&&(virtualclass.recorder.mkDownloadLink=b);if(1!=virtualclass.recorder.storeDone){"undefined"!=typeof earlierTimeout&&clearTimeout(earlierTimeout);if("undefined"==typeof a||""==a)a="first";virtualclass.recorder.rnum=a;virtualclass.storage.getrowData(["chunkData"],function(a,d){if("string"==typeof a||"undefined"==typeof a)earlierTimeout=setTimeout(function(){virtualclass.recorder.xhrsenddata(virtualclass.recorder.rnum)},1E3);else if(a.hasOwnProperty("status")&&
"done"==a.status)console.log("should invoked download function on "),virtualclass.recorder.storeDone=1,console.log("From here actuall recorder finished"),"undefined"!=typeof virtualclass.recorder.mkDownloadLink&&""!=virtualclass.recorder.mkDownloadLink?virtualclass.recorder.mkDownloadLink():setTimeout(function(){virtualclass.recorder.afterRecording()},1E3);else if("undefined"!=typeof d&&(virtualclass.recorder.rnum=d),1==virtualclass.recorder.error)0==virtualclass.recorder.storeDone&&(virtualclass.recorder.xhrsenddata(virtualclass.recorder.rnum,
"error"),virtualclass.recorder.rnum++);else{var b=new FormData;b.append("record_data",JSON.stringify(a));b.append("user",virtualclass.gObj.uid);b.append("cn",g);b.append("sesseionkey",virtualclass.recorder.sessionKey);virtualclass.recorder.items=[];virtualclass.xhr.send(b,importfilepath,function(d){"done"===d?(virtualclass.pbar.renderProgressBar(a.totalStore,a.totalSent,"progressBar","progressValue"),virtualclass.recorder.rnum++,g++,virtualclass.recorder.xhrsenddata(virtualclass.recorder.rnum)):"ERROR"===
d?virtualclass.recorder.alreadyDownload||virtualclass.recorder.makeAvailDownloadFile():alert(d)})}},virtualclass.recorder.rnum)}},afterRecording:function(){virtualclass.clearSession();document.getElementById("progressContainer").style.display="none";var a=document.getElementById("recordFinishedMessageBox");a.style.display="block";a.classList.add("MessageBoxFinished");var d=document.getElementById("recordingContainer");d.classList.add("recordingFinished");var b=document.getElementById("recordingClose");
virtualclass.recorder.alreadyDownload=!0;b.addEventListener("click",function(){virtualclass.popup.closeElem();var b=document.getElementById("progressContainer");a.style.display="none";b.style.display="block";virtualclass.pbar.renderProgressBar(0,0,"progressBar","progressValue");virtualclass.pbar.renderProgressBar(0,0,"indProgressBar","indProgressValue");d.classList.remove("recordingFinished")})},makeAvailDownloadFile:function(){console.log("DOWNLLOAD MESSAGE");var d=document.getElementById("recordingContainer"),
b=document.createElement("div");b.id="downloadFileCont";var f=document.createElement("div");f.id="errormsessage";f.innerHTML=virtualclass.lang.getString("msgForDownloadStart");document.getElementById("progressContainer").style.display="none";b.appendChild(f);d.appendChild(b);this.alreadyDownload=!0;virtualclass.storage.getAllDataForDownload(["chunkData"],function(d){virtualclass.gObj.saveSession=!0;var g=document.createElement("button");g.id="downloadButton";g.innerHTML=virtualclass.lang.getString("downloadFile");
var m=document.createElement("a");m.id="dlink";m.href="";m.download="session.vcp";m.innerHTML=virtualclass.lang.getString("download");f.innerHTML=virtualclass.lang.getString("filenotsave");b.appendChild(g);document.getElementById("recordingHeader").innerHTML=virtualclass.lang.getString("downloadFile");var h=new Blob([d],{type:"application/virtualclass"});g.addEventListener("click",function(){null!=c.webkitURL?m.href=c.webkitURL.createObjectURL(h):(m.href=c.URL.createObjectURL(h),m.onclick=a,document.body.appendChild(m));
m.click();virtualclass.storage.config.endSession()})})},sendDataToServer:function(){virtualclass.storage.db.transaction(["chunkData"],"readwrite").objectStore("chunkData").clear();virtualclass.popup.waitBlockAction("none");c.Worker&&(mvDataWorker.postMessage({rdata:virtualclass.recorder.items,makeChunk:!0}),mvDataWorker.onmessage=function(a){virtualclass.storage.chunkStorage(a.data)})},displayWaitPopupIfNot:function(){!1==this.waitPopup&&(virtualclass.popup.sendBackOtherElems(),document.getElementById("recordingContainer").style.display=
"none",virtualclass.popup.waitBlockAction("block"),virtualclass.pbar.renderProgressBar(0,0,"downloadProgressBar","downloadProgressValue"),virtualclass.popup.waitBlock(),this.waitPopup=!0)},requestDataFromServer:function(a,d){this.displayWaitPopupIfNot(virtualclass.lang.getString("plswaitwhile"));var b=new FormData;b.append("prvfile",d);b.append("fileBundelId",a);virtualclass.xhr.send(b,exportfilepath,function(d){virtualclass.recorder.sendToWorker(d,a)})},sendToWorker:function(a,d){c.Worker&&(mvDataWorker.postMessage({rdata:a,
getData:!0}),mvDataWorker.onmessage=function(a){f++;var b=virtualclass.recorder.isUptoBaseValue(a.data.alldata.totalSent,a.data.alldata.totalStore,30);virtualclass.recorder.ctotalStore=a.data.alldata.totalStore;virtualclass.recorder.ctotalSent=a.data.alldata.totalSent;virtualclass.pbar.renderProgressBar(a.data.alldata.totalStore,a.data.alldata.totalSent,"downloadProgressBar","downloadProgressValue");b&&!virtualclass.recorder.alreadyAskForPlay?(a.data.alldata.totalSent>a.data.alldata.totalStore?virtualclass.recorder.askToPlay("completed"):
virtualclass.recorder.askToPlay(),virtualclass.recorder.alreadyAskForPlay=!0,virtualclass.recorder.tempRecData.push(a.data.alldata.rdata)):b&&virtualclass.recorder.playStart&&!1==virtualclass.recorder.waitServer?virtualclass.recorder.init(a.data.alldata.rdata):(virtualclass.recorder.tempRecData.push(a.data.alldata.rdata),!0==virtualclass.recorder.waitServer&&(virtualclass.recorder.alreadyPlayed=!0));a.data.alldata.rdata[a.data.alldata.rdata.length-1].hasOwnProperty("sessionEnd")?(console.log("Request file  Finished Here"),
virtualclass.recorder.allFileFound=!0,!0==virtualclass.recorder.waitServer&&(virtualclass.storage.config.endSession(),a=virtualclass.recorder.tempRecData.reduce(function(a,d){return a.concat(d)}),virtualclass.recorder.objn=0,virtualclass.recorder.init(a),virtualclass.recorder.play(),virtualclass.recorder.waitServer=!1,virtualclass.popup.closeElem())):(console.log("request file"),virtualclass.recorder.requestDataFromServer(d,f))})},playInt:function(){var a=virtualclass.recorder.tempRecData.reduce(function(a,
d){return a.concat(d)});virtualclass.popup.closeElem();virtualclass.recorder.init(a);virtualclass.recorder.playStart=!0;virtualclass.recorder.tempRecData.length=0;localStorage.setItem("mySession","thisismyplaymode");virtualclass.recorder.initController()},askToPlay:function(a){"undefined"!=typeof a?document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"):document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("askplayMessage");document.getElementById("askPlay").style.display=
"block";a=document.getElementById("playButton");null!=a&&(a.style.display="block",a.addEventListener("click",this.playInt))},isUptoBaseValue:function(a,d,b){return a>=d*b/100?!0:!1},play:function(){if(0==this.objn){var a=document.getElementById("recPlay");this.doControlActive(a)}var b=this;this.controller.pause||("undefined"==typeof b.playTimeout&&""==b.playTimeout||clearTimeout(b.playTimeout),this.hasOwnProperty("playTime")||(this.playTime=this.items[0].playTime,d.data=JSON.parse(this.items[this.objn].recObjs),
io.cfg=d.data,virtualclass.gObj.uRole="s"),"undefined"==typeof this.items[this.objn+1]||this.items[this.objn].hasOwnProperty("sessionEnd")?(this.items[this.objn].hasOwnProperty("sessionEnd")||(d.data=this.items[this.objn].recObjs,io.onRecMessage(b.convertInto(d))),!1==virtualclass.recorder.allFileFound?(virtualclass.recorder.waitServer=!0,virtualclass.recorder.waitPopup=!1,this.displayWaitPopupIfNot(),(virtualclass.recorder.hasOwnProperty("ctotalStore")||virtualclass.recorder.hasOwnProperty("ctotalSent"))&&
virtualclass.pbar.renderProgressBar(virtualclass.recorder.ctotalStore,virtualclass.recorder.ctotalSent,"downloadProgressBar","downloadProgressValue")):this.items[this.objn].hasOwnProperty("sessionEnd")&&(virtualclass.popup.replayWindow(),virtualclass.popup.sendBackOtherElems(),document.getElementById("replayClose").addEventListener("click",function(){c.close()}),document.getElementById("replayButton").addEventListener("click",function(){virtualclass.recorder.replayFromStart.call(virtualclass.recorder)}))):
b.playTimeout=setTimeout(function(){var a={};a.data=b.items[b.objn].recObjs;try{io.onRecMessage(b.convertInto(a))}catch(d){console.log("PLAY ERROR "+d.errorCode)}b.objn++;b.play.call(b);"object"==typeof b.items[b.objn]&&(b.playTime=b.items[b.objn].playTime/b.controller.ff,b.tillPlayTime+=b.playTime*b.controller.ff,b.allFileFound&&"object"==typeof b.items[b.objn+1]&&(b.playProgressBar(),virtualclass.popup.sendBackOtherElems()))},b.playTime))},initController:function(){var a=document.getElementById("playControllerCont");
if(null!=a){a.style.display="block";for(var d=this,a=document.getElementsByClassName("ff"),b=0;b<a.length;b++)a[b].onclick=function(){var a=this.id.split("ff")[1];d.controller.fastForward(parseInt(a,10));d.doControlActive(this)};document.getElementById("recPlay").addEventListener("click",function(){d.controller._play();d.doControlActive(this)});document.getElementById("recPause").addEventListener("click",function(){d.controller._pause();d.doControlActive(this)});document.getElementById("replayFromStart").addEventListener("click",
function(){d.replayFromStart()})}},doControlActive:function(a){for(var d=document.getElementById("playControllerCont").getElementsByClassName("recButton"),b=0;b<d.length;b++)d[b].classList.remove("controlActive");a.parentNode.classList.add("controlActive")},controller:{pause:!1,ff:1,_play:function(){this.ff=1;this.pause=!1;virtualclass.recorder.play()},_pause:function(){this.puase||(this.pause=!0)},fastForward:function(a){this.ff=a;this.pause=!1;virtualclass.recorder.play()}}};c.recorder=h})(window);
function randomString(c){for(var a="";0<c;--c)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*Math.random())];return a};(function(c){function a(a){"function"==typeof a&&(virtualclass.recorder.sendDataToServer(),setTimeout(function(){virtualclass.recorder.xhrsenddata()},100),a.apply(virtualclass.recorder))}var b;c.storage={dbVersion:4,init:function(a){this.reclaim=roles.isEducator();b=this;this.tables="wbData allData chunkData config dataAdapterAll dataUserAdapterAll executedStoreAll executedUserStoreAll".split(" ");var f=c.indexedDB.open("vidya_apps",b.dbVersion);f.onerror=function(a){console.log("Error opening db");
console.dir(a);"InvalidStateError"==a.target.error.name&&alert(virtualclass.lang.getString("enablehistory"));indexedDB.deleteDatabase("vidya_apps").onsuccess=function(){b.init()}};f.onupgradeneeded=function(a){a=a.target.result;a.objectStoreNames.contains("wbData")||a.createObjectStore("wbData",{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("allData")||a.createObjectStore("allData",{autoIncrement:!0});a.objectStoreNames.contains("config")||a.createObjectStore("config",{keyPath:"timeStamp",
autoIncrement:!0});a.objectStoreNames.contains("chunkData")||a.createObjectStore("chunkData",{autoIncrement:!0});a.objectStoreNames.contains("dataAdapterAll")||a.createObjectStore("dataAdapterAll",{keyPath:"serialKey"});a.objectStoreNames.contains("dataUserAdapterAll")||a.createObjectStore("dataUserAdapterAll",{keyPath:"serialKey"});a.objectStoreNames.contains("executedStoreAll")||a.createObjectStore("executedStoreAll",{keyPath:"serialKey"});a.objectStoreNames.contains("executedUserStoreAll")||a.createObjectStore("executedUserStoreAll",
{keyPath:"serialKey"})};f.onsuccess=function(c){b.db=c.target.result;for(c=0;c<b.tables.length;c++)try{b.db.transaction([b.tables[c]],"readwrite")}catch(f){indexedDB.deleteDatabase("vidya_apps").onsuccess=function(){b.init()};return}(new Date).getTime();virtualclass.gObj.sessionClear?b.config.endSession(!0):b.getAllObjs(b.tables,function(a){if("undefined"==typeof a)b.config.createNewSession();else{var d=a.createdDate;(72E5<(new Date).getTime()-d||a.room!=wbUser.room)&&b.config.endSession()}},"allData");
b.db.onerror=function(a){console.dir(a.target)};a()}},store:function(a){var c=b.db.transaction(["wbData"],"readwrite");c.objectStore("wbData").clear();console.log("Whiteboard Total Store "+JSON.parse(a).length);c.objectStore("wbData").add({repObjs:a,timeStamp:(new Date).getTime(),id:1});return!1},dataExecutedStoreAll:function(a,c){var g=b.db.transaction(["executedStoreAll"],"readwrite");g.objectStore("executedStoreAll");g.objectStore("executedStoreAll").put({executedData:a,id:6,serialKey:c});g.onerror=
function(a){a.preventDefault()}},dataAdapterAllStore:function(a,c){var g=b.db.transaction(["dataAdapterAll"],"readwrite");g.objectStore("dataAdapterAll");g.objectStore("dataAdapterAll").put({adaptData:a,id:5,serialKey:c});g.onerror=function(a){a.preventDefault()}},dataUserAdapterAllStore:function(a,c){var g=b.db.transaction(["dataUserAdapterAll"],"readwrite");g.objectStore("dataUserAdapterAll");g.objectStore("dataUserAdapterAll").put({adaptUserData:a,id:7,serialKey:c});g.onerror=function(a){a.preventDefault()}},
dataExecutedUserStoreAll:function(a,c){var g=b.db.transaction(["executedUserStoreAll"],"readwrite");g.objectStore("executedUserStoreAll");g.objectStore("executedUserStoreAll").put({executedUserData:a,id:8,serialKey:c});g.onerror=function(a){a.preventDefault()}},completeStorage:function(a,c,g,h){var m=b.db.transaction(["allData"],"readwrite");"undefined"!=typeof h?m.objectStore("allData").add({recObjs:"",sessionEnd:!0,id:3}):"undefined"==typeof g?m.objectStore("allData").add({recObjs:c,playTime:a,
id:3}):m.objectStore("allData").add({recObjs:c,playTime:a,id:3,bd:g.type})},chunkStorage:function(a){var c=b.db.transaction(["chunkData"],"readwrite");a.id=4;c.objectStore("chunkData").add(a)},wholeStore:function(a,f,g){f.peTime=c.pageEnter;a=JSON.stringify(f);f=(new Date).getTime();"undefined"!=typeof this.prevTime&&f==this.prevTime&&(f+=1);var h=b.db.transaction(["allData"],"readwrite");"undefined"==typeof g?h.objectStore("allData").add({recObjs:a,timeStamp:f,id:3}):h.objectStore("allData").put({recObjs:a,
timeStamp:this.prevTime,id:3});this.wholeStoreData=a;this.prevTime=f},displayData:function(){b.db.transaction(["virtualclass"],"readonly").objectStore("virtualclass").openCursor().onsuccess=b.handleResult},getAllObjs:function(a,c,g,h){c="undefined"!=typeof c?c:"";for(var m=0;m<a.length;m++)b.db.transaction(a[m],"readonly").objectStore(a[m]).openCursor().onsuccess=function(c,f){if(a[c]!=g)return function(g){"function"==typeof f?"undefined"!=typeof h?b[a[c]].handleResult(g,f,h):"chunkData"!=a[c]&&b[a[c]].handleResult(g,
f):"undefined"!=typeof h?b[a[c]].handleResult(g,void 0,h):b[a[c]].handleResult(g)}}(m,c)},getAllDataForDownload:function(a,c){var g=[];b.db.transaction(a,"readonly").objectStore(a[0]).openCursor().onsuccess=function(a){(a=a.target.result)?(g.push(a.value),a["continue"]()):c(JSON.stringify(g))}},getrowData:function(a,c,g){a=b.db.transaction(a,"readonly").objectStore(a[0]);if("string"==typeof g&&"first"==g)a.openCursor().onsuccess=function(a){(a=a.target.result)?c(a.value,a.key):c("No Such Row")};else{var h=
a.get(g);h.onerror=function(a){return"No Such Row"};h.onsuccess=function(a){c(h.result)}}},wbData:{handleResult:function(a,b){var c=a.target.result;c?(c.value.hasOwnProperty("repObjs")&&("object"==typeof virtualclass.wb?(console.log("Total Whiteboard Length "+JSON.parse(c.value.repObjs).length+" From indexeddb"),virtualclass.wb.utility.replayFromLocalStroage(JSON.parse(c.value.repObjs))):virtualclass.gObj.tempReplayObjs=JSON.parse(c.value.repObjs),virtualclass.gObj.tempReplayObjs=JSON.parse(c.value.repObjs),
storeFirstObj=!0),c["continue"]()):"undefined"==typeof storeFirstObj&&"Whiteboard"==virtualclass.currApp&&virtualclass.wb.utility.makeUserAvailable()}},allData:{chunk:0,handleResult:function(d,b){var c=d.target.result;if(c){if(c.value.hasOwnProperty("recObjs")){if(c.value.hasOwnProperty("sessionEnd")){virtualclass.recorder.items.push({playTime:c.value.playTime,recObjs:c.value.recObjs,sessionEnd:!0});console.log("Start Upload Process");a(b);return}c.value.hasOwnProperty("bd")?virtualclass.recorder.items.push({playTime:c.value.playTime,
recObjs:c.value.recObjs,bd:c.value.bd}):virtualclass.recorder.items.push({playTime:c.value.playTime,recObjs:c.value.recObjs})}c["continue"]()}}},dataAdapterAll:{handleResult:function(a,b){var c=a.target.result;if(c){if(c.value.hasOwnProperty("adaptData")){var h=JSON.parse(c.value.adaptData);parseInt(c.value.serialKey)>ioAdapter.serial&&(ioAdapter.serial=parseInt(c.value.serialKey));ioAdapter.adapterMustData[ioAdapter.serial]=h}c["continue"]()}}},dataUserAdapterAll:{handleResult:function(a,b){var c=
a.target.result;if(c){if(c.value.hasOwnProperty("adaptUserData")){var h=JSON.parse(c.value.adaptUserData),m=c.value.serialKey.split("_"),p=parseInt(m[0]),m=parseInt(m[1]);ioAdapter.validateAllVariables(p);m>ioAdapter.userSerial[p]&&(ioAdapter.userSerial[p]=m);ioAdapter.userAdapterMustData[p][m]=h}c["continue"]()}}},executedStoreAll:{handleResult:function(a,b){var c=a.target.result;if(c){if(c.value.hasOwnProperty("executedData")){var h=JSON.parse(c.value.executedData),m=c.value.serialKey.split("_"),
p=parseInt(m[0]),m=parseInt(m[1]);ioMissingPackets.validateAllVariables(p);ioMissingPackets.executedStore[p][m]=h}c["continue"]()}}},executedUserStoreAll:{handleResult:function(a,b){var c=a.target.result;if(c){if(c.value.hasOwnProperty("executedUserData")){var h=JSON.parse(c.value.executedUserData),m=c.value.serialKey.split("_"),p=parseInt(m[0]),m=parseInt(m[1]);ioMissingPackets.validateAllUserVariables(p);ioMissingPackets.executedUserStore[p][m]=h}c["continue"]()}}},config:{handleResult:function(a,
b){var c=a.target.result;if(c){if(c.value.hasOwnProperty("myconfig")){var h=JSON.parse(c.value.myconfig);"undefined"!=typeof b&&(mc=!0,b(h))}c["continue"]()}else"undefined"!=typeof b&&"undefined"==typeof mc&&b()},createNewSession:function(){roles.hasAdmin()&&ioStorage.completeStorage(JSON.stringify(virtualclass.uInfo));virtualclass.makeAppReady(virtualclass.apps[3]);var a=(new Date).getTime();if("undefined"!=typeof b.db){var c=b.db.transaction(["config"],"readwrite").objectStore("config"),a=JSON.stringify({createdDate:a,
room:wbUser.room});c.add({myconfig:a,timeStamp:(new Date).getTime()})}else console.log("The Datbase is not created for Applicatoin.")},endSession:function(a){localStorage.clear();virtualclass.recorder.items=[];virtualclass.recorder.totalSent=0;a||("object"==typeof virtualclass.wb&&(virtualclass.wb.utility.t_clearallInit(),virtualclass.wb.utility.makeDefaultValue(),"object"==typeof virtualclass.wb.replay&&(virtualclass.wb.replay.rendering=!1)),virtualclass.vutil.clearAllChat(),virtualclass.editorRich.removeEditorData(),
virtualclass.editorCode.removeEditorData());virtualclass.vutil.removeClass("audioWidget","fixed");virtualclass.hasOwnProperty("notPLayed")||virtualclass.storage.clearStorageData();virtualclass.currApp="EditorRich";virtualclass.user.control.audioWidgetEnable();virtualclass.user.control.allChatEnable();roles.hasAdmin()&&(document.getElementById("virtualclassSessionEndTool").className=virtualclass.vutil.removeClassFromElement("virtualclassSessionEndTool","active"));"object"==typeof virtualclass.yts&&
clearInterval(virtualclass.yts.tsc);console.log("Session End.");virtualclass.previous="virtualclassEditorRich";virtualclass.getContent=!1;virtualclass.recorder.storeDone=0;virtualclass.chat.removeChatHighLight("chatrm");virtualclass.setPrvUser();io.sock&&io.sock.close();b.config.createNewSession();virtualclass.popup.waitMsg()}},shapesData:{handleResult:function(){virtualclass.recorder.items.push(JSON.parse(cursor.value.recObjs))}},clearSingleTable:function(a){var b=this.db.transaction(a,"readwrite");
"undefined"!=typeof b?(b.objectStore(a).clear(),console.log("Cleared IDDB Table "+a)):console.log("There is no table "+a+" at IDDB.")},clearStorageData:function(){ioAdapter.adapterMustData=[];ioAdapter.serial=-1;ioAdapter.userSerial=[];ioAdapter.userAdapterMustData=[];ioMissingPackets.executedStore=[];ioMissingPackets.executedSerial={};ioMissingPackets.missRequest=[];ioMissingPackets.aheadPackets=[];ioMissingPackets.missRequestFlag=0;ioMissingPackets.executedUserStore=[];ioMissingPackets.executedUserSerial=
{};ioMissingPackets.missUserRequest=[];ioMissingPackets.aheadUserPackets=[];for(var a=ioMissingPackets.missUserRequestFlag=0;a<this.tables.length;a++)"allData"==this.tables[a]?virtualclass.vutil.isPlayMode()||this.clearSingleTable(this.tables[a]):this.clearSingleTable(this.tables[a])},handleResultNoUsing:function(){var a=event.target.result;if(a){if(a.value.hasOwnProperty("repObjs")){var b=JSON.parse(a.value.repObjs);virtualclass.wb.utility.replayFromLocalStroage(b)}else a.value.hasOwnProperty("audiostream")?
(b=JSON.parse(a.value.audiostream),virtualclass.gObj.video.audio.assignFromLocal(b)):a.value.hasOwnProperty("recObjs")&&virtualclass.recorder.items.push(JSON.parse(a.value.recObjs));a["continue"]()}}}})(window);(function(c,a){c.user=function(b){return{assignRole:function(a,b,g){roles.hasControls()&&(roles.isEducator()||virtualclass.html.leftAppBar(),virtualclass.attachFunction(),"Whiteboard"==b&&c.virtualclass.wb.attachToolFunction(vcan.cmdWrapperDiv,!0),virtualclass.hasOwnProperty("previrtualclass")?virtualclass.vutil.makeActiveApp("virtualclass"+b,virtualclass.previrtualclass):virtualclass.vutil.makeActiveApp("virtualclass"+b),"object"==typeof virtualclass.wb&&virtualclass.wb.utility.makeCanvasEnable())},
teacherIsAlreadyExist:function(){for(var d=a.getElementById("chat_div").getElementsByClassName("ui-memblist-usr"),b,c=0;c<d.length;c++)if(b=d[c].getAttribute("data-role"),"t"==b||"e"==b)return!0;return!1},createControl:function(d,b){var c=a.createElement("div");c.id=d+"ControlContainer";c.className="controls";this.createControlDivs(c,d,b);return c},createControllerElement:function(d,b){var c=a.createElement("span");c.id=d+b+"Img";var h=a.createElement("a");h.id=d+b+"Anch";h.className="tooltip";h.appendChild(c);
var m=a.createElement("div");m.id=d+b+"Cont";m.className="controleCont";m.appendChild(h);return[m,c]},createAssignControl:function(d,b,c,h){var m=this,p=this.createControllerElement(b,"contrAssign"),s=p[0],v=p[1],p=a.getElementById(b+"ControlContainer");null!=p?0>=p.getElementsByClassName("controleCont").length?p.appendChild(s):p.insertBefore(s,p.firstChild):d.appendChild(s);virtualclass.user.control.changeAttribute(b,v,c,"assign","aRole");"undefined"!=typeof h&&(v.className+=" currTeacher");v.addEventListener("click",
function(){m.control.init.call(m,v)})},createControlDivs:function(a,b,c){var h=this,m=!1,p=localStorage.getItem("virtualclass"+b);if(null!=p&&(m=!0,p=JSON.parse(p),p.hasOwnProperty("currTeacher")))if(virtualclass.gObj[b+"currTeacher"]={},!0==p.currTeacher){var s=virtualclass.user.control.currTeacherAlready=!0;virtualclass.gObj[b+"currTeacher"].ct=!0}else virtualclass.gObj[b+"currTeacher"].ct=!1;var v=roles.isEducator()?!1:!0,x=virtualclass.vutil.userIsOrginalTeacher(b);virtualclass.vutil.isUserTeacher(b);
for(var t=0;t<c.length;t++)if("assign"==c[t]&&x)"undefined"!=typeof s?this.createAssignControl(a,b,v,s):this.createAssignControl(a,b,v);else if("audio"==c[t]){var w=this.createControllerElement(b,"contrAud"),q=w[0],r=w[1];a.appendChild(q);q=m&&p.hasOwnProperty("aud")?p.aud?!0:!1:!0;virtualclass.user.control.changeAttribute(b,r,q,"audio","aud");x&&r.addEventListener("click",function(){h.control.init.call(h,r)})}else if("chat"==c[t]){var w=this.createControllerElement(b,"contrChat"),q=w[0],u=w[1];a.appendChild(q);
x&&u.addEventListener("click",function(){h.control.init.call(h,u)});q=m&&p.hasOwnProperty("chat")?p.chat?!0:!1:!0;virtualclass.user.control.changeAttribute(b,u,q,"chat","chat")}else if(("editorRich"==c[t]||"editorCode"==c[t])&&roles.hasAdmin()){var A=m&&p.hasOwnProperty(c[t])?p[c[t]]?!0:!1:!1,w=this.createControllerElement(b,"contr"+c[t]),q=w[0],w=w[1];q.className+=" controller"+c[t];a.appendChild(q);virtualclass.currApp!=virtualclass.vutil.capitalizeFirstLetter(c[t])&&(q.style.display="none");virtualclass.user.control.changeAttribute(b,
w,A,c[t],c[t]);x&&w.addEventListener("click",h.closureEditor(h,w))}},closureEditor:function(a,b){return function(){a.control.init.call(a,b)}},control:{toggleDisplayWriteModeMsgBox:function(d,b){var c=a.getElementById(d+"writeModeBox"),h=b?virtualclass.lang.getString("writemode"):virtualclass.lang.getString("readonlymode"),m=a.getElementById("virtualclass"+d+"Body");null==c&&null!=m&&(c=a.createElement("div"),c.id=d+"writeModeBox",m.appendChild(c));null!=c&&(c.className="writeModeBox",c.dataset.writeMode=
b,c.innerHTML=h);"EditorRich"==d&&this.tooglDisplayEditorToolBar(b)},tooglDisplayEditorToolBar:function(d){var b=a.getElementsByClassName("vceditor-toolbar"),c=b[0];0<b.length&&(d?(c.style.pointerEvents="visible",c.style.opacity="1"):(c.style.pointerEvents="none",c.style.opacity="0.5"))},received_editorRich:function(a){a.status?(virtualclass.gObj.uid==a.toUser?"object"!=typeof virtualclass.editorRich.cm||virtualclass.isPlayMode||virtualclass.editorRich.cm.setOption("readOnly",!1):this.enable(a.toUser,
"editorRich","editorRich","editorRich"),virtualclass.isPlayMode&&virtualclass.editorRich.control.toggleDisplayWriteModeMsgBox(!1),a=!0):(virtualclass.gObj.uid==a.toUser?"object"==typeof virtualclass.editorRich.cm&&virtualclass.editorRich.cm.setOption("readOnly","nocursor"):this.disable(a.toUser,"editorRich","editorRich","editorRich"),a=!1);localStorage.setItem("editorRich",a);roles.hasAdmin()||this.toggleDisplayWriteModeMsgBox("EditorRich",a);virtualclass.vutil.setReadModeWhenTeacherIsDisConn("editorRich")},
received_editorCode:function(a){a.status?(virtualclass.gObj.uid==a.toUser?"object"!=typeof virtualclass.editorCode.cm||virtualclass.isPlayMode||virtualclass.editorCode.cm.setOption("readOnly",!1):this.enable(a.toUser,"editorCode","editorCode","editorCode"),virtualclass.isPlayMode&&virtualclass.editorCode.control.toggleDisplayWriteModeMsgBox(!1),a=!0):(virtualclass.gObj.uid==a.toUser?"object"==typeof virtualclass.editorCode.cm&&virtualclass.editorCode.cm.setOption("readOnly","nocursor"):this.disable(a.toUser,
"editorCode","editorCode","editorCode"),a=!1);localStorage.setItem("editorCode",a);roles.hasAdmin()||this.toggleDisplayWriteModeMsgBox("EditorCode",a);virtualclass.vutil.setReadModeWhenTeacherIsDisConn("editorCode")},onmessage:function(a){this["received_"+a.message.control](a.message)},addCurrTeacherToControl:function(b){var c=a.getElementById(b);null!=c&&(virtualclass.vutil.elemHasAnyClass(b)?c.classList.add("currTeacher"):c.className="currTeacher")},removeCurrTeacherFromControl:function(b){var c=
a.getElementById(b);virtualclass.vutil.elemHasAnyClass(b)&&(c.classList.remove("currTeacher"),c=b.indexOf("contr"),b=b.substring(0,c),virtualclass.user.control.updateUser(b,"currTeacher",!1))},removeAudioFromParticipate:function(b){b=a.getElementById(b+"contrAssignCont");null!=b&&b.parentNode.removeChild(b)},disable:function(b,c,g,h){g=a.getElementById(b+"contr"+g+"Img");null!=g&&virtualclass.user.control._disable(g,c,b,h)},_disable:function(a,b,c,h){a.parentNode.setAttribute("data-title",virtualclass.lang.getString(b+
"Disable"));a.setAttribute("data-"+b+"-disable","true");a.className="icon-"+b+"Img block "+b+"Img";"assign"==b?(a.parentNode.classList.remove("tooltip"),this.addCurrTeacherToControl(a.id),a=localStorage.getItem("virtualclass"+c),a=JSON.parse(a),virtualclass.gObj.hasOwnProperty(c+"currTeacher")?(virtualclass.gObj[c+"currTeacher"].ct||virtualclass.gObj.hasOwnProperty("controlAssign")&&virtualclass.gObj.controlAssign&&a.currTeacher)&&virtualclass.user.control.updateUser(c,"currTeacher",!0):virtualclass.gObj.hasOwnProperty("controlAssign")&&
virtualclass.gObj.controlAssignId==c&&virtualclass.user.control.updateUser(c,"currTeacher",!0)):"audio"==b&&(a.className="icon-"+b+"DisImg block "+b+"DisImg");virtualclass.user.control.updateUser(c,h,!1)},enable:function(b,c,g,h){g=a.getElementById(b+"contr"+g+"Img");null==g?console.log("Element is Null"):virtualclass.user.control._enable(g,c,b,h)},_enable:function(a,b,c,h){a.parentNode.setAttribute("data-title",virtualclass.lang.getString(b+"Enable"));"audio"==b&&a.parentNode.setAttribute("data-title",
virtualclass.lang.getString(b+"Off"));a.setAttribute("data-"+b+"-disable","false");a.className="icon-"+b+"Img enable "+b+"Img";virtualclass.user.control.updateUser(c,h,!0)},changeAttribute:function(a,b,c,h,m){c?virtualclass.user.control._enable(b,h,a,m):virtualclass.user.control._disable(b,h,a,m)},init:function(a,b,c){"undefined"==typeof c&&(c="Img");var h=a.id,m=h.indexOf("contr"),m=h.substring(0,m),h=h.split("contr")[1];c=h.indexOf(c);c=h.substring(0,c);if("Assign"==c)virtualclass.gObj.controlAssign=
!0,virtualclass.gObj.controlAssignId=m,b="true"==a.getAttribute("data-assign-disable")?!0:!1,b||(this.control.changeAttribute(m,a,b,"assign","aRole"),virtualclass.user.control._assign(m),virtualclass.user.control.changeAttrToAssign("block")),roles.hasAdmin()||virtualclass.user.control.removeAudioFromParticipate(m);else{var p;"Chat"==c?(a.className="contrChatBlock",h="chat"):h="Aud"==c?"audio":c;"undefined"!=typeof b?b=(p="enable"==b?!0:!1)?"enable":"block":"true"==a.getAttribute("data-"+h+"-disable")?
(b="enable",p=!0):(b="block",p=!1);this.control.changeAttribute(m,a,p,h,virtualclass.vutil.smallizeFirstLetter(c));this.control["_"+h].call(this.control,m,b)}},init_old:function(a){var b=a.id,c=b.indexOf("contr"),c=b.substring(0,c),b=b.split("contr")[1],h=b.indexOf("Img"),b=b.substring(0,h);"Assign"==b?(virtualclass.gObj.controlAssign=!0,virtualclass.gObj.controlAssignId=c,b="true"==a.getAttribute("data-assign-disable")?!0:!1,b||(this.control.changeAttribute(c,a,b,"assign","aRole"),virtualclass.user.control._assign(c),
virtualclass.user.control.changeAttrToAssign("block")),roles.hasAdmin()||virtualclass.user.control.removeAudioFromParticipate(c)):"Chat"==b?("true"==a.getAttribute("data-chat-disable")?(a.className="contrChatBlock",b="enable",this.control.changeAttribute(c,a,!0,"chat","chat")):(b="block",this.control.changeAttribute(c,a,!1,"chat","chat")),this.control._chat(c,b)):"Aud"==b&&("true"==a.getAttribute("data-audio-disable")?(b="enable",this.control.changeAttribute(c,a,!0,"audio","aud")):(b="block",this.control.changeAttribute(c,
a,!1,"audio","aud")),this.control._audio(c,b))},_assign:function(b,c,g){virtualclass.vutil.assignRole();virtualclass.vutil.removeAppPanel();virtualclass.system.setAppDimension();virtualclass.vutil.renderWhiteboardObjectsIfAny();if(!roles.hasAdmin()){var h=a.getElementById("vcanvas");h.className=h.className.replace(/\bteacher\b/," ");h.className="student"}localStorage.setItem("canvasDrwMsg",!0);h=a.getElementById("virtualclassScreenShareLocalVideo");null!=h&&"VIDEO"==h.tagName&&virtualclass.vutil.videoTeacher2Student("ScreenShare",
!0);"ScreenShare"==virtualclass.currApp&&(virtualclass.ss.hasOwnProperty("currentStream")&&virtualclass.ss.currentStream.stop(),virtualclass.ss="");"undefined"==typeof c&&(virtualclass.vutil.beforeSend({assignRole:!0,toUser:b,cf:"assignRole"},b),roles.hasAdmin()&&(c=a.getElementById(b+"contreditorRichImg"),"true"==c.dataset.editorrichDisable&&virtualclass.user.control.init.call(virtualclass.user,c),c=a.getElementById(b+"contreditorCodeImg"),"true"==c.dataset.editorcodeDisable&&virtualclass.user.control.init.call(virtualclass.user,
c)));roles.hasAdmin()||("undefined"==typeof g&&(g=b),b=a.getElementById(g+"ControlContainer").getElementsByClassName("controleCont")[0],b.removeChild(b.firstChild),localStorage.removeItem("aId"))},_chat:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({enc:!0,toUser:a,cf:"enc"},a):(virtualclass.user.control.updateUser(a,"chat",!1),virtualclass.vutil.beforeSend({dic:!0,toUser:a,cf:"dic"},a))},_audio:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({ena:!0,toUser:a,cf:"ena"},a):virtualclass.vutil.beforeSend({dia:!0,
toUser:a,cf:"dia"},a)},_audioAll:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({ena:!0,toUser:a,cf:"ena"},a):virtualclass.vutil.beforeSend({dia:!0,toUser:a,cf:"dia"},a)},_editorRich:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({status:!0,control:"editorRich",toUser:a,cf:"control"},a):virtualclass.vutil.beforeSend({status:!1,control:"editorRich",toUser:a,cf:"control"},a)},_editorCode:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({status:!0,control:"editorCode",toUser:a,
cf:"control"},a):virtualclass.vutil.beforeSend({status:!1,control:"editorCode",toUser:a,cf:"control"},a)},_audio:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({ena:!0,toUser:a,cf:"ena"},a):virtualclass.vutil.beforeSend({dia:!0,toUser:a,cf:"dia"},a)},audioWidgetEnable:function(){localStorage.setItem("audEnable",JSON.stringify({ac:"true"}));if(null==localStorage.getItem("dvid")){var b=a.getElementById("audioWidget");b.className="active";b.style.opacity="1";b.style.pointerEvents="visible"}},
audioWidgetDisable:function(b){var c={ac:"false"},g=localStorage.getItem("audEnable");null!=g?(g=JSON.parse(g),"false"!=g.ac&&"undefined"!=typeof b&&(c.r=b)):"unefined"!=typeof b&&(c.r=b);localStorage.setItem("audEnable",JSON.stringify(c));b=a.getElementById("audioWidget");b.style.opacity="0.5";b.style.pointerEvents="none";b.className="deactive";b=a.getElementById("speakerPressing");virtualclass.gObj.hasOwnProperty("video")&&(virtualclass.gObj.video.audio.studentNotSpeak(b),virtualclass.gObj.video.audio.clickOnceSpeaker("speakerPressOnce",
"alwaysDisable"))},allChatDisable:function(){localStorage.setItem("chatEnable","false");this.disableCommonChat();this.disbaleAllChatBox();this.disableOnLineUser()},disableCommonChat:function(){var b=a.getElementById("chatrm");null!=b&&this.makeElemDisable(b)},disbaleAllChatBox:function(){for(var b=a.getElementById("stickybar").getElementsByClassName("ui-chatbox"),c=0;c<b.length;c++)this.makeElemDisable(b[c])},disableOnLineUser:function(){for(var b=a.getElementsByClassName("ui-memblist-usr"),c=0;c<
b.length;c++)b[c].style.pointerEvents="none"},makeElemDisable:function(a){virtualclass.vutil.elemHasAnyClass(a.id)?(a.classList.remove("enable"),a.classList.add("disable")):a.className="disable";a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!0)},allChatEnable:function(){localStorage.setItem("chatEnable","true");var b=a.getElementById("chatrm");null!=b&&this.makeElemEnable(b);for(var c=a.getElementById("stickybar").getElementsByClassName("ui-chatbox"),b=0;b<c.length;b++)this.makeElemEnable(c[b]);
c=a.getElementsByClassName("ui-memblist-usr");for(b=0;b<c.length;b++)c[b].style.pointerEvents="visible"},makeElemEnable:function(a){virtualclass.vutil.elemHasAnyClass(a.id)?(a.classList.remove("disable"),a.classList.add("enable")):a.className="enable";a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!1)},toggleAllEditorController:function(b,c){b=virtualclass.vutil.smallizeFirstLetter(b);var g=a.getElementsByClassName("controleCont");if(0<g.length)for(var h=0;h<g.length;h++)if(0<
g[h].id.indexOf(b)){var m=g[h].id.indexOf("Cont");0<m&&(m=g[h].id.substr(0,m),m=a.getElementById(m+"Img"),this.control.init.call(this,m,c))}},toggleDisplayEditorController:function(b,c){b=virtualclass.vutil.smallizeFirstLetter(b);for(var g=a.getElementsByClassName("controller"+b),h=0;h<g.length;h++)g[h].style.display=c},updateUser:function(a,b,c){var h=localStorage.getItem("virtualclass"+a),m={};null==h?m.id=a:m=JSON.parse(h);m[b]=c;localStorage["virtualclass"+m.id]=JSON.stringify(m);return m},audioSign2:function(b,
f){if("create"==f){if(null==a.getElementById(b.id+"AudEnableSign")){var g=a.createElement("div");g.id=b.id+"AudEnableSign";var h=a.createElement("img");imgName="audioenable";h.id=b.id+imgName+"Img";h.src=c.whiteboardPath+"images/"+imgName+".png";var m=a.createElement("a");m.id=b.id+imgName+"Anch";m.className="audEnableSign tooltip controleCont";m.setAttribute("data-title",virtualclass.lang.getString("studentAudEnable"));m.appendChild(h);g.appendChild(m);a.getElementById(b.id+"ControlContainer").appendChild(g)}}else g=
a.getElementById(b.id+"AudEnableSign"),g.parentNode.removeChild(g)},audioSign:function(a,b){"create"==b?this.iconAttrManupulate(a.id,"icon-audioEnaGreen"):a.aud?this.iconAttrManupulate(a.id,"icon-audioImg"):this.iconAttrManupulate(a.id,"icon-audioDisImg")},iconAttrManupulate:function(b,c){var g=a.getElementById(b+"contrAudImg");if(null!=g)for(var h=0;h<g.classList.length;h++)if("icon-"==g.classList[h].substring(0,5)){g.classList.remove(g.classList[h]);g.classList.add(c);break}},shouldApply:function(a){var b=
localStorage.getItem("virtualclass"+a);null!=b&&(b=JSON.parse(b),b.ad&&virtualclass.user.control.audioSign({id:a},"create"))},changeAttrToAssign:function(b){for(var c=a.getElementById("chatWidget").getElementsByClassName("assignImg"),g=0;g<c.length;g++)"enable"==b?(c[g].classList.remove("block"),c[g].classList.add("enable"),c[g].parentNode.classList.add("tooltip"),c[g].parentNode.setAttribute("data-title",virtualclass.lang.getString("assignEnable")),c[g].setAttribute("data-assign-disable","false")):
(c[g].classList.remove("enable"),c[g].classList.add("block"),c[g].parentNode.classList.remove("tooltip"),c[g].setAttribute("data-assign-disable","true"))}},displayStudentSpeaker:function(b){var c=a.getElementById("alwaysPress");null!=c&&(c.style.display=b?"block":"none")},toggleAllAudio:function(b){var c=a.getElementsByClassName("controleCont");if(0<c.length)for(var g=0;g<c.length;g++)if(0<c[g].id.indexOf("Aud")){var h=c[g].id.indexOf("Cont");0<h&&(h=c[g].id.substr(0,h),h=a.getElementById(h+"Img"),
this.control.init.call(this,h,b))}},UIaudioAll:function(b,c){var g=a.createElement("a");g.id="contrAudioAll";var h=a.createElement("span");h.id="contrAudioAllImg";var m=localStorage.getItem("allAudAction");null!=m&&"disable"==m?(h.setAttribute("data-action","enable"),h.className="icon-all-audio-enable tooltip",h.dataset.title=virtualclass.lang.getString("unmuteAll")):(h.setAttribute("data-action","disable"),h.className="icon-all-audio-disable tooltip",h.dataset.title=virtualclass.lang.getString("muteAll"));
if(virtualclass.isPlayMode)g.pointerEvents="none",g.style.cursor="default";else{var p=this;h.addEventListener("click",function(){a.getElementById("contrAudioAllImg");var b=p.toogleAudioIcon();"undefined"!=typeof b&&(localStorage.setItem("allAudAction",b),p.toggleAllAudio.call(virtualclass.user,b))})}g.appendChild(h);a.getElementById(b).getElementsByClassName(c)[0].appendChild(g)},toogleAudioIcon:function(){var b=a.getElementById("contrAudioAllImg");if(null!=b)return actionToPerform=b.dataset.action,
"enable"==b.dataset.action?(b.dataset.action="disable",b.className="icon-all-audio-disable tooltip",b.dataset.title=virtualclass.lang.getString("muteAll")):(b.dataset.action="enable",b.className="icon-all-audio-enable tooltip",b.dataset.title=virtualclass.lang.getString("unmuteAll")),actionToPerform},changeRoleOnFooter:function(b,c){a.getElementById("ml"+b).dataset.role=c}}}})(window,document);(function(c){c.xhr={init:function(){this.httpObj=c.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.httpObj.upload.addEventListener("progress",this.onProgress);this.onReadStateChange();this.httpObj.onerror=function(a){virtualclass.recorder.alreadyDownload||virtualclass.recorder.makeAvailDownloadFile();console.log("Error "+a)};this.httpObj.onabort=function(a){console.log("Error abort "+a)}},onProgress:function(a){virtualclass.pbar.currVal=a.loaded;""!=virtualclass.pbar.prvVal&&
"undefined"!=typeof virtualclass.pbar.prvVal||virtualclass.isPlayMode||virtualclass.pbar.progressInit();virtualclass.pbar.renderProgressBar(a.total,a.loaded,"indProgressBar","indProgressValue")},onReadStateChange:function(){var a=this;this.httpObj.onreadystatechange=function(){4==a.httpObj.readyState&&"undefined"!=typeof a.cb&&(200==a.httpObj.status?a.cb(a.httpObj.responseText):a.cb("ERROR"))}},send:function(a,b,c){this.cb=c;this.httpObj.open("POST",b,!0);this.httpObj.send(a)}}})(window);var PopUp=function(c,a){function b(a){this.init(a);return this}function d(a,b){var c={},d;for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(c[d]=b[d]);return c}function f(a){var b=document.createElement("div");b.classList.add("rv-vanilla-modal-overlay");document.querySelector("body").appendChild(b);"function"===typeof a&&a()}"use strict";b.prototype.init=function(a){var b=this;this.settings=d({selector:"[data-rv-vanilla-modal]",
modalSelector:".rv-vanilla-modal",closeSelector:".rv-vanilla-modal-close",showModalClassName:"rv-vanilla-modal-is-open",showOverlay:!0},a);this.modalElements=document.querySelectorAll(this.settings.modalSelector);this.triggers=document.querySelectorAll(this.settings.selector);this.settings.showOverlay&&f(function(){b.overlayElement=document.querySelector(".rv-vanilla-modal-overlay")})};b.prototype.close=function(a){a.classList.remove(this.settings.showModalClassName);this.settings.showOverlay&&this.overlayElement.classList.remove("is-shown")};
b.prototype.open=function(a){document.getElementById("popupContainer").style.display="block";this.sendBackOtherElems();this.closeShownModal();a.classList.add(this.settings.showModalClassName);this.settings.showOverlay&&this.overlayElement.classList.add("is-shown")};b.prototype.each=function(a){[].forEach.call(this.triggers,function(b){"function"===typeof a&&a(b)})};b.prototype.closeShownModal=function(){var a=this.settings.showModalClassName;[].forEach.call(this.modalElements,function(b){b.classList.contains(a)&&
b.classList.remove(a)})};b.prototype.closeElem=function(){console.log("close popup");if(!1==virtualclass.recorder.waitServer){var a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.zIndex=100);a=document.getElementById("stickybar");null!=a&&(a.style.zIndex=2E3);a=document.getElementById("commandToolsWrapper");null!=a&&(a.style.pointerEvents="visible");a=document.getElementById("about-modal");null!=a&&virtualclass.popup.close(a);document.getElementById("sessionEndMsgCont").dataset.displaying=
"false"}};b.prototype.waitBlock=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();document.getElementById("recordPlay").style.display="block";virtualclass.popup.replayWindowAction("none")};b.prototype.waitBlockAction=function(a){document.getElementById("recordPlay").style.display=a};b.prototype.sendBackOtherElems=function(a){a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.zIndex=0);a=document.getElementById("commandToolsWrapper");
null!=a&&(a.style.pointerEvents="none");a=document.getElementById("stickybar");null!=a&&(a.style.zIndex=0);a=document.getElementById("chatrm");null!=a&&(a.style.zIndex=0);a=document.getElementById("audioWidget");null!=a&&(a.style.zIndex=0);a=document.getElementById("audioWidget");null!=a&&(a.style.zIndex=0);a=document.getElementById("memlist");null!=a&&(a.style.zIndex=0)};b.prototype.openProgressBar=function(a){a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();
document.getElementById("recordingContainer").style.display="block"};b.prototype.replayWindow=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();virtualclass.popup.replayWindowAction("block")};b.prototype.sesseionEndWindow=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();a=document.getElementById("sessionEndMsgCont");a.style.display="block";a.dataset.displaying=!0;document.getElementById("sessionEndClose").addEventListener("click",
function(){virtualclass.popup.closeElem()})};b.prototype.replayWindowAction=function(a){document.getElementById("replayContainer").style.display=a};b.prototype.progressBarAction=function(a){document.getElementById("recordingContainer").style.display=a};b.prototype.confirmInput=function(a,b,c){var d=document.getElementById("about-modal");virtualclass.popup.open(d);this.hideAllPopups();d=document.getElementById("confirm");d.style.display="block";var f=d.getElementsByClassName("confirmChild");if(0<f.length)for(;1<=
f.length;)f[0].parentNode.removeChild(f[0]);f=document.createElement("div");f.id="confirmMessage";f.className="confirmChild";f.innerHTML=a;d.appendChild(f);var v=this;a=function(){v.confirmInit(this.id,b,c)};f=document.createElement("div");f.id="confirmOk";f.className="confirmButton confirmChild";f.addEventListener("click",a);var x=document.createElement("button");x.id="confirmOkButton";x.className="icon-check";x.innerHTML="OK";f.appendChild(x);d.appendChild(f);f=document.createElement("div");f.id=
"confirmCancel";f.className="confirmButton confirmChild";f.addEventListener("click",a);a=document.createElement("button");a.id="confirmCancelButton";a.className="icon-close";a.innerHTML="Cancel";f.appendChild(a);d.appendChild(f)};b.prototype.confirmInit=function(a,b,c){virtualclass.popup.closeElem();a="confirmOk"==a?virtualclass.popup.confirmOk():virtualclass.popup.confirmCancel();b(a,c)};b.prototype.confirmCancel=function(){return!1};b.prototype.confirmOk=function(){return!0};b.prototype.waitMsg=
function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();document.getElementById("waitMsgCont").style.display="block"};b.prototype.hideAllPopups=function(){for(var a=document.getElementsByClassName("popupWindow"),b=0;b<a.length;b++)a[b].style.display="none"};b.prototype.closePopup=function(){virtualclass.popup.closeElem();"true"==document.getElementById("sessionEndMsgCont").dataset.displaying&&this.sesseionEndWindow()};return b}(window);(function(c){c.converter=function(){function a(a,b){for(var c=a.replace(/[^A-Za-z0-9\+\/]/g,""),h=c.length,m=b?Math.ceil((3*h+1>>2)/b)*b:3*h+1>>2,p=new Uint8Array(m),s,v=0,x=0,t=0;t<h;t++){s=t&3;var w=c.charCodeAt(t),v=v|(64<w&&91>w?w-65:96<w&&123>w?w-71:47<w&&58>w?w+4:43===w?62:47===w?63:0)<<6*(3-s);if(3===s||1===h-t){for(s=0;3>s&&x<m;s++,x++)p[x]=v>>>(16>>>s&24)&255;v=0}}return p}function b(a){return 26>a?a+65:52>a?a+71:62>a?a-4:62===a?43:63===a?47:65}return{base64EncArrInt:function(a){for(var b=
new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=0>a[c]?-1*a[c]+127:a[c];return this.base64EncArr(b)},base64EncArr:function(a){for(var c=2,g="",h=a.length,m=0,p=0;p<h;p++)if(c=p%3,0<p&&0===4*p/3%76&&(g+="\r\n"),m|=a[p]<<(16>>>c&24),2===c||1===a.length-p)g+=String.fromCharCode(b(m>>>18&63),b(m>>>12&63),b(m>>>6&63),b(m&63)),m=0;return g.substr(0,g.length-2+c)+(2===c?"":1===c?"=":"==")},base64DecToArrInt:function(b){b=a(b);for(var c=new Int8Array(b.length),g=0;g<b.length;g++)c[g]=128<=b[g]?-1*(b[g]-
127):b[g];return c},base64DecToArrclm:function(b){b=a(b);return new Uint8ClampedArray(b.buffer)}}}})(window);var progressBar={prvVal:"",currVal:"",progressInit:function(){var c=this;"undefined"!=typeof prvTimeout&&clearTimeout(prvTimeout);prvTimeout=setTimeout(function(){c.prvVal==c.currVal?virtualclass.recorder.alreadyDownload||virtualclass.recorder.makeAvailDownloadFile():(c.prvVal=c.currVal,c.progressInit())},5E4)},renderProgressBar:function(c,a,b,d){a>c&&(a=c,document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"));c=0==c&&0==a?0:Math.round(100*a/c);b=document.getElementById(b);
null!=b&&(b.style.width=c+"%");b=document.getElementById(d);null!=b&&(b.innerHTML=c+"%");100<=d&&(d=document.getElementById("recordingClose"),recordingClose.style.display="block",d.addEventListener("click",function(){virtualclass.popup.closeElem()}))}};if(!window.YT)var YT={loading:0,loaded:0};if(!window.YTConfig)var YTConfig={host:"http://www.youtube.com"};
YT.loading||(YT.loading=1,function(){var c=[];YT.ready=function(a){YT.loaded?a():c.push(a)};window.onYTReady=function(){YT.loaded=1;for(var a=0;a<c.length;a++)try{c[a]()}catch(b){}};YT.setConfig=function(a){for(var b in a)a.hasOwnProperty(b)&&(YTConfig[b]=a[b])};var a=document.createElement("script");a.type="text/javascript";a.id="www-widgetapi-script";a.src="https://s.ytimg.com/yts/jsbin/www-widgetapi-vfltoz0n9/www-widgetapi.js";a.async=!0;var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,
b)}());(function(c,a){var b=function(c){var f=0,g=-2,h=-1;return{retryForPalyer:1,player:"",init:function(a,b){if("undefined"!=typeof a&&"studentlayout"!=a.init)var c=a.init;if(!roles.hasAdmin()||roles.isEducator())if("undefined"==typeof c&&roles.isStudent())this.UI.defaultLayoutForStudent();else if(this.UI.container(),roles.hasControls()){if("undefined"!=typeof c)this.onYTIframApi(c,b,"fromReload");this.UI.inputURL();ioAdapter.mustSend({yts:{init:"studentlayout"},cf:"yts"})}else"undefined"!=typeof a?a.hasOwnProperty("fromReload")||
("undefined"==typeof c?this.UI.defaultLayoutForStudent():"undefined"==typeof b?this.onYTIframApi(c):this.onYTIframApi(c,b)):this.UI.defaultLayoutForStudent();else{this.UI.container();if("undefined"!=typeof b)this.onYTIframApi(c,b,"fromReload");this.UI.inputURL();ioAdapter.mustSend({yts:{init:"studentlayout"},cf:"yts"})}},destroyYT:function(){"object"==typeof virtualclass.yts.player&&(virtualclass.yts.player.destroy(),virtualclass.yts.player="",virtualclass.yts.hasOwnProperty("tsc")&&clearInterval(virtualclass.yts.tsc))},
UI:{id:"virtualclassYts","class":"virtualclass",container:function(){var b=a.getElementById(this.id);null!=b&&b.parentNode.removeChild(b);b=a.createElement("div");b.id=this.id;b.className=this["class"];this.createPlayerTag(b);var c=a.getElementById(virtualclass.rWidgetConfig.id);a.getElementById(virtualclass.html.id).insertBefore(b,c)},createPlayerTag:function(b){var c=a.createElement("div");c.id="player";b.appendChild(c)},defaultLayoutForStudent:function(){var b=a.getElementById(this.id);if(null==
b){b=a.createElement("div");b.id=this.id;b.className=this["class"];var c=a.getElementById(virtualclass.rWidgetConfig.id);a.getElementById(virtualclass.html.id).insertBefore(b,c)}c=a.getElementById("youtubeUrlContainer");null!=c&&c.parentNode.removeChild(c);null==a.getElementById("messageLayout")&&(c=a.createElement("p"),c.id="messageLayout",c.innerHTML=virtualclass.lang.getString("teachermayshow"),b.appendChild(c))},inputURL:function(){var b=a.getElementById("messageLayout");null!=b&&b.parentNode.removeChild(b);
if(null==a.getElementById("youtubeUrlContainer")){b=a.createElement("div");b.id="youtubeUrlContainer";var c=a.createElement("input");c.id="youtubeurl";c.cols=70;c.rows=3;c.placeholder=virtualclass.lang.getString("youTubeUrl");a.getElementById("virtualclassYts").appendChild(c);b.appendChild(c);c=a.createElement("button");c.id="submitURL";c.innerHTML=virtualclass.lang.getString("shareYouTubeVideo");b.appendChild(c);var d=a.getElementById("virtualclassYts"),f=a.getElementById("player");d.insertBefore(b,
f.nextSibling);c.addEventListener("click",function(){var b=a.getElementById("youtubeurl").value,b=virtualclass.yts.getVideoId(b);"boolean"==typeof b?alert("Invalid YouTube URL."):(virtualclass.yts.videoId=b,virtualclass.yts.onYTIframApi(b),ioAdapter.mustSend({yts:{init:b},cf:"yts"}))})}},removeinputURL:function(){var b=a.getElementById("youtubeUrlContainer");null!=b&&b.parentNode.removeChild(b)}},getVideoId:function(a){a=a.match(/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|\&v(?:i)?=))([^#\&\?]*).*/);
return null!=a&&1<a.length&&(a=a[1].substring(0,11),11==a.length)?a:!1},onmessage:function(a){"string"==typeof a.yts?"play"==a.yts?this.player.playVideo():"pause"==a.yts?this.player.pauseVideo():"mute"==a.yts?this.player.mute():"unmute"==a.yts&&this.player.unMute():a.yts.hasOwnProperty("init")?virtualclass.makeAppReady("Yts",void 0,a.yts):(a=parseInt(a.yts.seekto,10),this.player.hasOwnProperty("seekTo")&&this.player.seekTo(a))},onYTIframApi:function(c,d,f){"undefined"!=typeof c&&(this.videoId=c);
if("object"==typeof this.player&&roles.hasControls())this.player.loadVideoById(c);else{var g=0;roles.hasControls()&&(g=1);g={playerVars:{autohide:0,disablekb:1,enablejsapi:1,modestbranding:1,controls:g,rel:0,fs:0,showinfo:0,start:"undefined"!=typeof d?Math.round(d):0},videoId:c,events:{onReady:this.onPlayerReady}};"undefined"!=typeof d&&(g.start=d);console.log("Player object is CREATED");if("undefined"!=typeof f){var h=this;if(b.hasOwnProperty("ytApiReady"))h.player=new YT.Player("player",g);else{console.log("onYouTubeIframeAPIReady is not ready ");
setTimeout(function(){h.onYTIframApi(c,d,f)},300);return}}else this.player=new YT.Player("player",g);g=a.getElementById(this.UI.id);g.className+=" youTubeSharing"}},triggerOnSeekChange:function(){console.log("there should happend something after each 2 second");if(0==f||-2==g||-1==h)f=this.player.getCurrentTime(),g=this.player.getPlayerState(),h=this.player.isMuted();else{var a=Math.abs(this.player.getCurrentTime()-f);f=this.player.getCurrentTime();console.log(f);console.log(this.player.getCurrentTime());
4<a&&this.ytOnSeek(this.player.getCurrentTime());this.player.getPlayerState()!=g&&3!=this.player.getPlayerState()&&(this.ytOnChange(this.player.getPlayerState()),g=this.player.getPlayerState());this.player.isMuted()!=h&&(this.ytOnMuted(this.player.isMuted()),h=this.player.isMuted())}},ytOnMuted:function(a){a?ioAdapter.mustSend({yts:"mute",cf:"yts"}):ioAdapter.mustSend({yts:"unmute",cf:"yts"});console.log("MUTED "+a)},ytOnSeek:function(a){ioAdapter.mustSend({yts:{seekto:a},cf:"yts"});console.log("SEEK CHANGED "+
a)},ytOnChange:function(a){console.log("STATE CHANGED "+a);1==a?ioAdapter.mustSend({yts:"play",cf:"yts"}):2==a&&ioAdapter.mustSend({yts:"pause",cf:"yts"})},onPlayerReady:function(b){roles.hasControls()&&(a.getElementById("submitURL").innerHTML=virtualclass.lang.getString("shareAnotherYouTubeVideo"));b.target.playVideo();virtualclass.yts.player.unMute();virtualclass.yts.player.setVolume(40);roles.hasControls()&&virtualclass.yts.seekChangeInterval()},seekChangeInterval:function(){virtualclass.yts.tsc=
setInterval(function(){virtualclass.yts.triggerOnSeekChange()},2E3)}}};c.onYouTubeIframeAPIReady=function(){b.ytApiReady=!0;console.log("onYouTubeIframeAPIReady is ready now")};c.yts=b})(window,document);var CodeMirror=function(){function c(D,b){if(!(this instanceof c))return new c(D,b);this.options=b=b?oa(b):{};oa(of,b,!1);t(b);var d=b.value;"string"==typeof d&&(d=new ha(d,b.mode,null,b.lineSeparator));this.doc=d;var pa=new c.inputStyles[b.inputStyle](this),pa=this.display=new a(D,d,pa);pa.wrapper.CodeMirror=this;p(this);h(this);b.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");b.autofocus&&!ub&&pa.input.focus();u(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,
delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new vb,keySeq:null,specialChars:null};var n=this;M&&11>U&&setTimeout(function(){n.display.input.reset(!0)},20);pf(this);Dd||(qf(),Dd=!0);bb(this);this.curOp.forceUpdate=!0;Ed(this,d);b.autofocus&&!ub||n.hasFocus()?setTimeout(wb(Nc,this),20):xb(this);for(var f in cb)if(cb.hasOwnProperty(f))cb[f](this,b[f],Fd);E(this);b.finishInit&&b.finishInit(this);for(d=0;d<Oc.length;++d)Oc[d](this);db(this);
Y&&b.lineWrapping&&"optimizelegibility"==getComputedStyle(pa.lineDiv).textRendering&&(pa.lineDiv.style.textRendering="auto")}function a(a,b,c){this.input=c;this.scrollbarFiller=C("div",null,"CodeMirror-scrollbar-filler");this.scrollbarFiller.setAttribute("cm-not-content","true");this.gutterFiller=C("div",null,"CodeMirror-gutter-filler");this.gutterFiller.setAttribute("cm-not-content","true");this.lineDiv=C("div",null,"CodeMirror-code");this.selectionDiv=C("div",null,null,"position: relative; z-index: 1");
this.cursorDiv=C("div",null,"CodeMirror-cursors");this.measure=C("div",null,"CodeMirror-measure");this.lineMeasure=C("div",null,"CodeMirror-measure");this.lineSpace=C("div",[this.measure,this.lineMeasure,this.selectionDiv,this.cursorDiv,this.lineDiv],null,"position: relative; outline: none");this.mover=C("div",[C("div",[this.lineSpace],"CodeMirror-lines")],null,"position: relative");this.sizer=C("div",[this.mover],"CodeMirror-sizer");this.sizerWidth=null;this.heightForcer=C("div",null,null,"position: absolute; height: "+
Gd+"px; width: 1px;");this.gutters=C("div",null,"CodeMirror-gutters");this.lineGutter=null;this.scroller=C("div",[this.sizer,this.heightForcer,this.gutters],"CodeMirror-scroll");this.scroller.setAttribute("tabIndex","-1");this.wrapper=C("div",[this.scrollbarFiller,this.gutterFiller,this.scroller],"CodeMirror");M&&8>U&&(this.gutters.style.zIndex=-1,this.scroller.style.paddingRight=0);Y||Oa&&ub||(this.scroller.draggable=!0);a&&(a.appendChild?a.appendChild(this.wrapper):a(this.wrapper));this.reportedViewFrom=
this.reportedViewTo=this.viewFrom=this.viewTo=b.first;this.view=[];this.externalMeasured=this.renderedView=null;this.lastWrapHeight=this.lastWrapWidth=this.viewOffset=0;this.updateLineNumbers=null;this.nativeBarWidth=this.barHeight=this.barWidth=0;this.scrollbarsClipped=!1;this.lineNumWidth=this.lineNumInnerWidth=this.lineNumChars=null;this.alignWidgets=!1;this.maxLine=this.cachedCharWidth=this.cachedTextHeight=this.cachedPaddingH=null;this.maxLineLength=0;this.maxLineChanged=!1;this.wheelDX=this.wheelDY=
this.wheelStartX=this.wheelStartY=null;this.shift=!1;this.activeTouch=this.selForContextMenu=null;c.init(this)}function b(a){a.doc.mode=c.getMode(a.options,a.doc.modeOption);d(a)}function d(a){a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null)});a.doc.frontier=a.doc.first;yb(a,100);a.state.modeGen++;a.curOp&&ia(a)}function f(a){var b=Pa(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/zb(a.display)-3);return function(n){if(Qa(a.doc,
n))return 0;var f=0;if(n.widgets)for(var g=0;g<n.widgets.length;g++)n.widgets[g].height&&(f+=n.widgets[g].height);return c?f+(Math.ceil(n.text.length/d)||1)*b:f+b}}function g(a){var b=a.doc,c=f(a);b.iter(function(a){var D=c(a);D!=a.height&&va(a,D)})}function h(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-");Ab(a)}function m(a){p(a);ia(a);setTimeout(function(){S(a)},20)}function p(a){var b=a.display.gutters,c=a.options.gutters;
Ra(b);for(var d=0;d<c.length;++d){var n=c[d],f=b.appendChild(C("div",null,"CodeMirror-gutter "+n));"CodeMirror-linenumbers"==n&&(a.display.lineGutter=f,f.style.width=(a.display.lineNumWidth||1)+"px")}b.style.display=d?"":"none";s(a)}function s(a){a.display.sizer.style.marginLeft=a.display.gutters.offsetWidth+"px"}function v(a){if(0==a.height)return 0;for(var b=a.text.length,c,d=a;c=Sa(d,!0);)c=c.find(0,!0),d=c.from.line,b+=c.from.ch-c.to.ch;for(d=a;c=Sa(d,!1);)c=c.find(0,!0),b-=d.text.length-c.from.ch,
d=c.to.line,b+=d.text.length-c.to.ch;return b}function x(a){var b=a.display;a=a.doc;b.maxLine=B(a,a.first);b.maxLineLength=v(b.maxLine);b.maxLineChanged=!0;a.iter(function(a){var D=v(a);D>b.maxLineLength&&(b.maxLineLength=D,b.maxLine=a)})}function t(a){var b=ca(a.gutters,"CodeMirror-linenumbers");-1==b&&a.lineNumbers?a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):-1<b&&!a.lineNumbers&&(a.gutters=a.gutters.slice(0),a.gutters.splice(b,1))}function w(a){var b=a.display,c=b.gutters.offsetWidth,
d=Math.round(a.doc.height+Pc(a.display));return{clientHeight:b.scroller.clientHeight,viewHeight:b.wrapper.clientHeight,scrollWidth:b.scroller.scrollWidth,clientWidth:b.scroller.clientWidth,viewWidth:b.wrapper.clientWidth,barLeft:a.options.fixedGutter?c:0,docHeight:d,scrollHeight:d+wa(a)+b.barHeight,nativeBarWidth:b.nativeBarWidth,gutterWidth:c}}function q(a,b,c){this.cm=c;var d=this.vert=C("div",[C("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),n=this.horiz=C("div",[C("div",null,null,
"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");a(d);a(n);F(d,"scroll",function(){d.clientHeight&&b(d.scrollTop,"vertical")});F(n,"scroll",function(){n.clientWidth&&b(n.scrollLeft,"horizontal")});this.checkedOverlay=!1;M&&8>U&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")}function r(){}function u(a){a.display.scrollbars&&(a.display.scrollbars.clear(),a.display.scrollbars.addClass&&Bb(a.display.wrapper,a.display.scrollbars.addClass));a.display.scrollbars=new c.scrollbarModel[a.options.scrollbarStyle](function(b){a.display.wrapper.insertBefore(b,
a.display.scrollbarFiller);F(b,"mousedown",function(){a.state.focused&&setTimeout(function(){a.display.input.focus()},0)});b.setAttribute("cm-not-content","true")},function(b,c){"horizontal"==c?eb(a,b):Cb(a,b)},a);a.display.scrollbars.addClass&&Db(a.display.wrapper,a.display.scrollbars.addClass)}function A(a,b){b||(b=w(a));var c=a.display.barWidth,d=a.display.barHeight;K(a,b);for(var n=0;4>n&&c!=a.display.barWidth||d!=a.display.barHeight;n++)c!=a.display.barWidth&&a.options.lineWrapping&&ac(a),K(a,
w(a)),c=a.display.barWidth,d=a.display.barHeight}function K(a,b){var c=a.display,d=c.scrollbars.update(b);c.sizer.style.paddingRight=(c.barWidth=d.right)+"px";c.sizer.style.paddingBottom=(c.barHeight=d.bottom)+"px";d.right&&d.bottom?(c.scrollbarFiller.style.display="block",c.scrollbarFiller.style.height=d.bottom+"px",c.scrollbarFiller.style.width=d.right+"px"):c.scrollbarFiller.style.display="";d.bottom&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(c.gutterFiller.style.display="block",
c.gutterFiller.style.height=d.bottom+"px",c.gutterFiller.style.width=b.gutterWidth+"px"):c.gutterFiller.style.display=""}function H(a,b,c){var d=c&&null!=c.top?Math.max(0,c.top):a.scroller.scrollTop,d=Math.floor(d-a.lineSpace.offsetTop),n=c&&null!=c.bottom?c.bottom:d+a.wrapper.clientHeight,d=Ta(b,d),n=Ta(b,n);if(c&&c.ensure){var f=c.ensure.from.line;c=c.ensure.to.line;f<d?(d=f,n=Ta(b,xa(B(b,f))+a.wrapper.clientHeight)):Math.min(c,b.lastLine())>=n&&(d=Ta(b,xa(B(b,c))-a.wrapper.clientHeight),n=c)}return{from:d,
to:Math.max(n,d+1)}}function S(a){var b=a.display,c=b.view;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var d=N(b)-b.scroller.scrollLeft+a.doc.scrollLeft,n=b.gutters.offsetWidth,f=d+"px",g=0;g<c.length;g++)if(!c[g].hidden){a.options.fixedGutter&&c[g].gutter&&(c[g].gutter.style.left=f);var h=c[g].alignable;if(h)for(var m=0;m<h.length;m++)h[m].style.left=f}a.options.fixedGutter&&(b.gutters.style.left=d+n+"px")}}function E(a){if(!a.options.lineNumbers)return!1;var b=a.doc,b=O(a.options,
b.first+b.size-1),c=a.display;if(b.length!=c.lineNumChars){var d=c.measure.appendChild(C("div",[C("div",b)],"CodeMirror-linenumber CodeMirror-gutter-elt")),n=d.firstChild.offsetWidth,d=d.offsetWidth-n;c.lineGutter.style.width="";c.lineNumInnerWidth=Math.max(n,c.lineGutter.offsetWidth-d)+1;c.lineNumWidth=c.lineNumInnerWidth+d;c.lineNumChars=c.lineNumInnerWidth?b.length:-1;c.lineGutter.style.width=c.lineNumWidth+"px";s(a);return!0}return!1}function O(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}
function N(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function W(a,b,c){var d=a.display;this.viewport=b;this.visible=H(d,a.doc,b);this.editorIsHidden=!d.wrapper.offsetWidth;this.wrapperHeight=d.wrapper.clientHeight;this.wrapperWidth=d.wrapper.clientWidth;this.oldDisplayWidth=Ia(a);this.force=c;this.dims=Qc(a);this.events=[]}function Q(a,b){var c=a.display,d=a.doc;if(b.editorIsHidden)return Ja(a),!1;if(!b.force&&b.visible.from>=c.viewFrom&&b.visible.to<=
c.viewTo&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo)&&c.renderedView==c.view&&0==Hd(a))return!1;E(a)&&(Ja(a),b.dims=Qc(a));var n=d.first+d.size,f=Math.max(b.visible.from-a.options.viewportMargin,d.first),g=Math.min(n,b.visible.to+a.options.viewportMargin);c.viewFrom<f&&20>f-c.viewFrom&&(f=Math.max(d.first,c.viewFrom));c.viewTo>g&&20>c.viewTo-g&&(g=Math.min(n,c.viewTo));Ka&&(f=Rc(a.doc,f),g=Id(a.doc,g));d=f!=c.viewFrom||g!=c.viewTo||c.lastWrapHeight!=b.wrapperHeight||c.lastWrapWidth!=
b.wrapperWidth;n=a.display;0==n.view.length||f>=n.viewTo||g<=n.viewFrom?(n.view=bc(a,f,g),n.viewFrom=f):(n.viewFrom>f?n.view=bc(a,f,n.viewFrom).concat(n.view):n.viewFrom<f&&(n.view=n.view.slice(Ua(a,f))),n.viewFrom=f,n.viewTo<g?n.view=n.view.concat(bc(a,n.viewTo,g)):n.viewTo>g&&(n.view=n.view.slice(0,Ua(a,g))));n.viewTo=g;c.viewOffset=xa(B(a.doc,c.viewFrom));a.display.mover.style.top=c.viewOffset+"px";g=Hd(a);if(!d&&0==g&&!b.force&&c.renderedView==c.view&&(null==c.updateLineNumbers||c.updateLineNumbers>=
c.viewTo))return!1;f=ya();4<g&&(c.lineDiv.style.display="none");rf(a,c.updateLineNumbers,b.dims);4<g&&(c.lineDiv.style.display="");c.renderedView=c.view;f&&ya()!=f&&f.offsetHeight&&f.focus();Ra(c.cursorDiv);Ra(c.selectionDiv);c.gutters.style.height=c.sizer.style.minHeight=0;d&&(c.lastWrapHeight=b.wrapperHeight,c.lastWrapWidth=b.wrapperWidth,yb(a,400));c.updateLineNumbers=null;return!0}function fb(a,b){for(var c=b.viewport,d=!0;;d=!1){if(!d||!a.options.lineWrapping||b.oldDisplayWidth==Ia(a))if(c&&
null!=c.top&&(c={top:Math.min(a.doc.height+Pc(a.display)-Sc(a),c.top)}),b.visible=H(a.display,a.doc,c),b.visible.from>=a.display.viewFrom&&b.visible.to<=a.display.viewTo)break;if(!Q(a,b))break;ac(a);d=w(a);Eb(a);Tc(a,d);A(a,d)}b.signal(a,"update",a);if(a.display.viewFrom!=a.display.reportedViewFrom||a.display.viewTo!=a.display.reportedViewTo)b.signal(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo),a.display.reportedViewFrom=a.display.viewFrom,a.display.reportedViewTo=a.display.viewTo}function La(a,
b){var c=new W(a,b);if(Q(a,c)){ac(a);fb(a,c);var d=w(a);Eb(a);Tc(a,d);A(a,d);c.finish()}}function Tc(a,b){a.display.sizer.style.minHeight=b.docHeight+"px";var c=b.docHeight+a.display.barHeight;a.display.heightForcer.style.top=c+"px";a.display.gutters.style.height=Math.max(c+wa(a),b.clientHeight)+"px"}function ac(a){a=a.display;for(var b=a.lineDiv.offsetTop,c=0;c<a.view.length;c++){var d=a.view[c],n;if(!d.hidden){if(M&&8>U){var f=d.node.offsetTop+d.node.offsetHeight;n=f-b;b=f}else n=d.node.getBoundingClientRect(),
n=n.bottom-n.top;f=d.line.height-n;2>n&&(n=Pa(a));if(.001<f||-.001>f)if(va(d.line,n),Jd(d.line),d.rest)for(n=0;n<d.rest.length;n++)Jd(d.rest[n])}}}function Jd(a){if(a.widgets)for(var b=0;b<a.widgets.length;++b)a.widgets[b].height=a.widgets[b].node.offsetHeight}function Qc(a){for(var b=a.display,c={},d={},n=b.gutters.clientLeft,f=b.gutters.firstChild,g=0;f;f=f.nextSibling,++g)c[a.options.gutters[g]]=f.offsetLeft+f.clientLeft+n,d[a.options.gutters[g]]=f.clientWidth;return{fixedPos:N(b),gutterTotalWidth:b.gutters.offsetWidth,
gutterLeft:c,gutterWidth:d,wrapperWidth:b.wrapper.clientWidth}}function rf(a,b,c){function d(b){var c=b.nextSibling;Y&&qa&&a.display.currentWheelTarget==b?b.style.display="none":b.parentNode.removeChild(b);return c}for(var n=a.display,f=a.options.lineNumbers,g=n.lineDiv,h=g.firstChild,m=n.view,n=n.viewFrom,p=0;p<m.length;p++){var q=m[p];if(!q.hidden)if(q.node&&q.node.parentNode==g){for(;h!=q.node;)h=d(h);h=f&&null!=b&&b<=n&&q.lineNumber;q.changes&&(-1<ca(q.changes,"gutter")&&(h=!1),Kd(a,q,n,c));h&&
(Ra(q.lineNumber),q.lineNumber.appendChild(document.createTextNode(O(a.options,n))));h=q.node.nextSibling}else{var r=sf(a,q,n,c);g.insertBefore(r,h)}n+=q.size}for(;h;)h=d(h)}function Kd(a,b,c,d){for(var n=0;n<b.changes.length;n++){var f=b.changes[n];if("text"==f){var f=b,g=f.text.className,h=Ld(a,f);f.text==f.node&&(f.node=h.pre);f.text.parentNode.replaceChild(h.pre,f.text);f.text=h.pre;h.bgClass!=f.bgClass||h.textClass!=f.textClass?(f.bgClass=h.bgClass,f.textClass=h.textClass,Uc(f)):g&&(f.text.className=
g)}else if("gutter"==f)Md(a,b,c,d);else if("class"==f)Uc(b);else if("widget"==f){f=a;g=b;h=d;g.alignable&&(g.alignable=null);for(var m=g.node.firstChild,p=void 0;m;m=p)p=m.nextSibling,"CodeMirror-linewidget"==m.className&&g.node.removeChild(m);Nd(f,g,h)}}b.changes=null}function Fb(a){a.node==a.text&&(a.node=C("div",null,null,"position: relative"),a.text.parentNode&&a.text.parentNode.replaceChild(a.node,a.text),a.node.appendChild(a.text),M&&8>U&&(a.node.style.zIndex=2));return a.node}function Ld(a,
b){var c=a.display.externalMeasured;return c&&c.line==b.line?(a.display.externalMeasured=null,b.measure=c.measure,c.built):Od(a,b)}function Uc(a){var b=a.bgClass?a.bgClass+" "+(a.line.bgClass||""):a.line.bgClass;b&&(b+=" CodeMirror-linebackground");if(a.background)b?a.background.className=b:(a.background.parentNode.removeChild(a.background),a.background=null);else if(b){var c=Fb(a);a.background=c.insertBefore(C("div",null,b),c.firstChild)}a.line.wrapClass?Fb(a).className=a.line.wrapClass:a.node!=
a.text&&(a.node.className="");a.text.className=(a.textClass?a.textClass+" "+(a.line.textClass||""):a.line.textClass)||""}function Md(a,b,c,d){b.gutter&&(b.node.removeChild(b.gutter),b.gutter=null);b.gutterBackground&&(b.node.removeChild(b.gutterBackground),b.gutterBackground=null);if(b.line.gutterClass){var n=Fb(b);b.gutterBackground=C("div",null,"CodeMirror-gutter-background "+b.line.gutterClass,"left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px; width: "+d.gutterTotalWidth+"px");
n.insertBefore(b.gutterBackground,b.text)}var f=b.line.gutterMarkers;if(a.options.lineNumbers||f){var n=Fb(b),g=b.gutter=C("div",null,"CodeMirror-gutter-wrapper","left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px");a.display.input.setUneditable(g);n.insertBefore(g,b.text);b.line.gutterClass&&(g.className+=" "+b.line.gutterClass);!a.options.lineNumbers||f&&f["CodeMirror-linenumbers"]||(b.lineNumber=g.appendChild(C("div",O(a.options,c),"CodeMirror-linenumber CodeMirror-gutter-elt",
"left: "+d.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+a.display.lineNumInnerWidth+"px")));if(f)for(b=0;b<a.options.gutters.length;++b)c=a.options.gutters[b],(n=f.hasOwnProperty(c)&&f[c])&&g.appendChild(C("div",[n],"CodeMirror-gutter-elt","left: "+d.gutterLeft[c]+"px; width: "+d.gutterWidth[c]+"px"))}}function sf(a,b,c,d){var n=Ld(a,b);b.text=b.node=n.pre;n.bgClass&&(b.bgClass=n.bgClass);n.textClass&&(b.textClass=n.textClass);Uc(b);Md(a,b,c,d);Nd(a,b,d);return b.node}function Nd(a,b,c){Pd(a,
b.line,b,c,!0);if(b.rest)for(var d=0;d<b.rest.length;d++)Pd(a,b.rest[d],b,c,!1)}function Pd(a,b,c,d,n){if(b.widgets){var f=Fb(c),g=0;for(b=b.widgets;g<b.length;++g){var h=b[g],m=C("div",[h.node],"CodeMirror-linewidget");h.handleMouseEvents||m.setAttribute("cm-ignore-events","true");var p=h,q=m,r=d;if(p.noHScroll){(c.alignable||(c.alignable=[])).push(q);var s=r.wrapperWidth;q.style.left=r.fixedPos+"px";p.coverGutter||(s-=r.gutterTotalWidth,q.style.paddingLeft=r.gutterTotalWidth+"px");q.style.width=
s+"px"}p.coverGutter&&(q.style.zIndex=5,q.style.position="relative",p.noHScroll||(q.style.marginLeft=-r.gutterTotalWidth+"px"));a.display.input.setUneditable(m);n&&h.above?f.insertBefore(m,c.gutter||c.text):f.appendChild(m);da(h,"redraw")}}}function Vc(a){return z(a.line,a.ch)}function cc(a,b){return 0>J(a,b)?b:a}function dc(a,b){return 0>J(a,b)?a:b}function Qd(a){a.state.focused||(a.display.input.focus(),Nc(a))}function ec(a){return a.options.readOnly||a.doc.cantEdit}function fc(a,b,c,d,n){var f=
a.doc;a.display.shift=!1;d||(d=f.sel);var g=a.state.pasteIncoming||"paste"==n,h=f.splitLines(b),m=null;if(g&&1<d.ranges.length)if(la&&la.join("\n")==b){if(0==d.ranges.length%la.length)for(var m=[],p=0;p<la.length;p++)m.push(f.splitLines(la[p]))}else h.length==d.ranges.length&&(m=gc(h,function(a){return[a]}));for(p=d.ranges.length-1;0<=p;p--){var q=d.ranges[p],r=q.from(),s=q.to();q.empty()&&(c&&0<c?r=z(r.line,r.ch-c):a.state.overwrite&&!g&&(s=z(s.line,Math.min(B(f,s.line).text.length,s.ch+P(h).length))));
q=a.curOp.updateInput;r={from:r,to:s,text:m?m[p%m.length]:h,origin:n||(g?"paste":a.state.cutIncoming?"cut":"+input")};gb(a.doc,r);da(a,"inputRead",a,r)}b&&!g&&Rd(a,b);hb(a);a.curOp.updateInput=q;a.curOp.typing=!0;a.state.pasteIncoming=a.state.cutIncoming=!1}function Sd(a,b){var c=a.clipboardData&&a.clipboardData.getData("text/plain");if(c)return a.preventDefault(),ja(b,function(){fc(b,c,0,null,"paste")}),!0}function Rd(a,b){if(a.options.electricChars&&a.options.smartIndent)for(var c=a.doc.sel,d=c.ranges.length-
1;0<=d;d--){var n=c.ranges[d];if(!(100<n.head.ch||d&&c.ranges[d-1].head.line==n.head.line)){var f=a.getModeAt(n.head),g=!1;if(f.electricChars)for(var h=0;h<f.electricChars.length;h++){if(-1<b.indexOf(f.electricChars.charAt(h))){g=Gb(a,n.head.line,"smart");break}}else f.electricInput&&f.electricInput.test(B(a.doc,n.head.line).text.slice(0,n.head.ch))&&(g=Gb(a,n.head.line,"smart"));g&&da(a,"electricInput",a,n.head.line)}}}function Td(a){for(var b=[],c=[],d=0;d<a.doc.sel.ranges.length;d++){var n=a.doc.sel.ranges[d].head.line,
n={anchor:z(n,0),head:z(n+1,0)};c.push(n);b.push(a.getRange(n.anchor,n.head))}return{text:b,ranges:c}}function Ud(a){a.setAttribute("autocorrect","off");a.setAttribute("autocapitalize","off");a.setAttribute("spellcheck","false")}function Wc(a){this.cm=a;this.prevInput="";this.pollingFast=!1;this.polling=new vb;this.hasSelection=this.inaccurateSelection=!1;this.composing=null}function Vd(){var a=C("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none"),b=C("div",
[a],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");Y?a.style.width="1000px":a.setAttribute("wrap","off");ib&&(a.style.border="1px solid black");Ud(a);return b}function Xc(a){this.cm=a;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new vb;this.gracePeriod=!1}function Wd(a,b){var c=Yc(a,b.line);if(!c||c.hidden)return null;var d=B(a.doc,b.line),c=Xd(c,d,b.line),d=ra(d),n="left";d&&(n=hc(d,b.ch)%2?"right":"left");c=Yd(c.map,
b.ch,n);c.offset="right"==c.collapse?c.end:c.start;return c}function jb(a,b){b&&(a.bad=!0);return a}function ic(a,b,c){var d;if(b==a.display.lineDiv){d=a.display.lineDiv.childNodes[c];if(!d)return jb(a.clipPos(z(a.display.viewTo-1)),!0);b=null;c=0}else for(d=b;;d=d.parentNode){if(!d||d==a.display.lineDiv)return null;if(d.parentNode&&d.parentNode==a.display.lineDiv)break}for(var n=0;n<a.display.view.length;n++){var f=a.display.view[n];if(f.node==d)return tf(f,b,c)}}function tf(a,b,c){function d(b,
c,L){for(var aa=-1;aa<(p?p.length:0);aa++)for(var pa=0>aa?m.map:p[aa],n=0;n<pa.length;n+=3){var f=pa[n+2];if(f==b||f==c){c=R(0>aa?a.line:a.rest[aa]);aa=pa[n]+L;if(0>L||f!=b)aa=pa[n+(L?1:0)];return z(c,aa)}}}var n=a.text.firstChild,f=!1;if(!b||!Zc(n,b))return jb(z(R(a.line),0),!0);if(b==n&&(f=!0,b=n.childNodes[c],c=0,!b))return c=a.rest?P(a.rest):a.line,jb(z(R(c),c.text.length),f);var g=3==b.nodeType?b:null,h=b;g||1!=b.childNodes.length||3!=b.firstChild.nodeType||(g=b.firstChild,c&&(c=g.nodeValue.length));
for(;h.parentNode!=n;)h=h.parentNode;var m=a.measure,p=m.maps;if(b=d(g,h,c))return jb(b,f);n=h.nextSibling;for(g=g?g.nodeValue.length-c:0;n;n=n.nextSibling){if(b=d(n,n.firstChild,0))return jb(z(b.line,b.ch-g),f);g+=n.textContent.length}h=h.previousSibling;for(g=c;h;h=h.previousSibling){if(b=d(h,h.firstChild,-1))return jb(z(b.line,b.ch+g),f);g+=n.textContent.length}}function uf(a,b,c,d,n){function f(a){return function(D){return D.id==a}}function g(b){if(1==b.nodeType){var c=b.getAttribute("cm-text");
if(null!=c)""==c&&(c=b.textContent.replace(/\u200b/g,"")),h+=c;else{var c=b.getAttribute("cm-marker"),L;if(c)b=a.findMarks(z(d,0),z(n+1,0),f(+c)),b.length&&(L=b[0].find())&&(h+=Va(a.doc,L.from,L.to).join(p));else if("false"!=b.getAttribute("contenteditable")){for(L=0;L<b.childNodes.length;L++)g(b.childNodes[L]);/^(pre|div|p)$/i.test(b.nodeName)&&(m=!0)}}}else 3==b.nodeType&&(b=b.nodeValue)&&(m&&(h+=p,m=!1),h+=b)}for(var h="",m=!1,p=a.doc.lineSeparator();;){g(b);if(b==c)break;b=b.nextSibling}return h}
function Ea(a,b){this.ranges=a;this.primIndex=b}function T(a,b){this.anchor=a;this.head=b}function sa(a,b){var c=a[b];a.sort(function(a,D){return J(a.from(),D.from())});b=ca(a,c);for(c=1;c<a.length;c++){var d=a[c],n=a[c-1];if(0<=J(n.to(),d.from())){var f=dc(n.from(),d.from()),g=cc(n.to(),d.to()),d=n.empty()?d.from()==d.head:n.from()==n.head;c<=b&&--b;a.splice(--c,2,new T(d?g:f,d?f:g))}}return new Ea(a,b)}function za(a,b){return new Ea([new T(a,b||a)],0)}function I(a,b){if(b.line<a.first)return z(a.first,
0);var c=a.first+a.size-1;if(b.line>c)return z(c,B(a,c).text.length);var c=B(a,b.line).text.length,d=b.ch,c=null==d||d>c?z(b.line,c):0>d?z(b.line,0):b;return c}function Hb(a,b){return b>=a.first&&b<a.first+a.size}function Ib(a,b,c,d){return a.cm&&a.cm.display.shift||a.extend?(a=b.anchor,d&&(b=0>J(c,a),b!=0>J(d,a)?(a=c,c=d):b!=0>J(c,d)&&(c=d)),new T(a,c)):new T(d||c,c)}function jc(a,b,c,d){Z(a,new Ea([Ib(a,a.sel.primary(),b,c)],0),d)}function Zd(a,b,c){for(var d=[],n=0;n<a.sel.ranges.length;n++)d[n]=
Ib(a,a.sel.ranges[n],b[n],null);b=sa(d,a.sel.primIndex);Z(a,b,c)}function $c(a,b,c,d){var n=a.sel.ranges.slice(0);n[b]=c;Z(a,sa(n,a.sel.primIndex),d)}function vf(a,b){var c={ranges:b.ranges,update:function(b){this.ranges=[];for(var c=0;c<b.length;c++)this.ranges[c]=new T(I(a,b[c].anchor),I(a,b[c].head))}};X(a,"beforeSelectionChange",a,c);a.cm&&X(a.cm,"beforeSelectionChange",a.cm,c);return c.ranges!=b.ranges?sa(c.ranges,c.ranges.length-1):b}function $d(a,b,c){var d=a.history.done,n=P(d);n&&n.ranges?
(d[d.length-1]=b,kc(a,b,c)):Z(a,b,c)}function Z(a,b,c){kc(a,b,c);b=a.sel;var d=a.cm?a.cm.curOp.id:NaN,n=a.history,f=c&&c.origin,g;if(!(g=d==n.lastSelOp)&&(g=f&&n.lastSelOrigin==f)&&!(g=n.lastModTime==n.lastSelTime&&n.lastOrigin==f)){g=P(n.done);var h=f.charAt(0);g="*"==h||"+"==h&&g.ranges.length==b.ranges.length&&g.somethingSelected()==b.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}g?n.done[n.done.length-1]=b:lc(b,n.done);n.lastSelTime=+new Date;n.lastSelOrigin=
f;n.lastSelOp=d;c&&!1!==c.clearRedo&&ae(n.undone)}function kc(a,b,c){if(ma(a,"beforeSelectionChange")||a.cm&&ma(a.cm,"beforeSelectionChange"))b=vf(a,b);var d=c&&c.bias||(0>J(b.primary().head,a.sel.primary().head)?-1:1);be(a,ce(a,b,d,!0));c&&!1===c.scroll||!a.cm||hb(a.cm)}function be(a,b){b.equals(a.sel)||(a.sel=b,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0,de(a.cm)),da(a,"cursorActivity",a))}function ee(a){be(a,ce(a,a.sel,null,!1),Aa)}function ce(a,b,c,d){for(var n,f=0;f<b.ranges.length;f++){var g=
b.ranges[f],h=nc(a,g.anchor,c,d),m=nc(a,g.head,c,d);if(n||h!=g.anchor||m!=g.head)n||(n=b.ranges.slice(0,f)),n[f]=new T(h,m)}return n?sa(n,b.primIndex):b}function nc(a,b,c,d){var n=!1,f=b,g=c||1;a.cantEdit=!1;a:for(;;){var h=B(a,f.line);if(h.markedSpans)for(var m=0;m<h.markedSpans.length;++m){var p=h.markedSpans[m],q=p.marker;if((null==p.from||(q.inclusiveLeft?p.from<=f.ch:p.from<f.ch))&&(null==p.to||(q.inclusiveRight?p.to>=f.ch:p.to>f.ch))){if(d&&(X(q,"beforeCursorEnter"),q.explicitlyCleared))if(h.markedSpans){--m;
continue}else break;if(q.atomic){m=q.find(0>g?-1:1);if(0==J(m,f)&&(m.ch+=g,0>m.ch?m=m.line>a.first?I(a,z(m.line-1)):null:m.ch>h.text.length&&(m=m.line<a.first+a.size-1?z(m.line+1,0):null),!m)){if(n){if(!d)return nc(a,b,c,!0);a.cantEdit=!0;return z(a.first,0)}n=!0;m=b;g=-g}f=m;continue a}}}return f}}function Eb(a){a.display.input.showSelection(a.display.input.prepareSelection())}function fe(a,b){for(var c=a.doc,d={},n=d.cursors=document.createDocumentFragment(),f=d.selection=document.createDocumentFragment(),
g=0;g<c.sel.ranges.length;g++)if(!1!==b||g!=c.sel.primIndex){var h=c.sel.ranges[g],m=h.empty();if(m||a.options.showCursorWhenSelecting){var p=a,q=n,r=Fa(p,h.head,"div",null,null,!p.options.singleCursorHeightPerLine),s=q.appendChild(C("div","\u00a0","CodeMirror-cursor"));s.style.left=r.left+"px";s.style.top=r.top+"px";s.style.height=Math.max(0,r.bottom-r.top)*p.options.cursorHeight+"px";r.other&&(p=q.appendChild(C("div","\u00a0","CodeMirror-cursor CodeMirror-secondarycursor")),p.style.display="",p.style.left=
r.other.left+"px",p.style.top=r.other.top+"px",p.style.height=.85*(r.other.bottom-r.other.top)+"px")}m||wf(a,h,f)}return d}function wf(a,b,c){function d(a,b,D,c){0>b&&(b=0);b=Math.round(b);c=Math.round(c);h.appendChild(C("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+b+"px; width: "+(null==D?q-a:D)+"px; height: "+(c-b)+"px"))}function n(b,c,L){var aa=B(g,b),n=aa.text.length,f,h;xf(ra(aa),c||0,null==L?n:L,function(g,m,ga){var r=oc(a,z(b,g),"div",aa,"left"),s,$b;g==m?(s=
r,ga=$b=r.left):(s=oc(a,z(b,m-1),"div",aa,"right"),"rtl"==ga&&(ga=r,r=s,s=ga),ga=r.left,$b=s.right);null==c&&0==g&&(ga=p);3<s.top-r.top&&(d(ga,r.top,null,r.bottom),ga=p,r.bottom<s.top&&d(ga,r.bottom,null,s.top));null==L&&m==n&&($b=q);if(!f||r.top<f.top||r.top==f.top&&r.left<f.left)f=r;if(!h||s.bottom>h.bottom||s.bottom==h.bottom&&s.right>h.right)h=s;ga<p+1&&(ga=p);d(ga,s.top,$b-ga,s.bottom)});return{start:f,end:h}}var f=a.display,g=a.doc,h=document.createDocumentFragment(),m=ge(a.display),p=m.left,
q=Math.max(f.sizerWidth,Ia(a)-f.sizer.offsetLeft)-m.right,f=b.from();b=b.to();if(f.line==b.line)n(f.line,f.ch,b.ch);else{var r=B(g,f.line),m=B(g,b.line),m=Ba(r)==Ba(m),f=n(f.line,f.ch,m?r.text.length+1:null).end;b=n(b.line,m?0:null,b.ch).start;m&&(f.top<b.top-2?(d(f.right,f.top,null,f.bottom),d(p,b.top,b.left,b.bottom)):d(f.right,f.top,b.left-f.right,f.bottom));f.bottom<b.top&&d(p,f.bottom,null,b.top)}c.appendChild(h)}function ad(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=
!0;b.cursorDiv.style.visibility="";0<a.options.cursorBlinkRate?b.blinker=setInterval(function(){b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate):0>a.options.cursorBlinkRate&&(b.cursorDiv.style.visibility="hidden")}}function yb(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.viewTo&&a.state.highlight.set(b,wb(yf,a))}function yf(a){var b=a.doc;b.frontier<b.first&&(b.frontier=b.first);if(!(b.frontier>=a.display.viewTo)){var c=+new Date+a.options.workTime,d=kb(b.mode,Jb(a,
b.frontier)),n=[];b.iter(b.frontier,Math.min(b.first+b.size,a.display.viewTo+500),function(f){if(b.frontier>=a.display.viewFrom){var g=f.styles,h=he(a,f,d,!0);f.styles=h.styles;var m=f.styleClasses;(h=h.classes)?f.styleClasses=h:m&&(f.styleClasses=null);m=!g||g.length!=f.styles.length||m!=h&&(!m||!h||m.bgClass!=h.bgClass||m.textClass!=h.textClass);for(h=0;!m&&h<g.length;++h)m=g[h]!=f.styles[h];m&&n.push(b.frontier);f.stateAfter=kb(b.mode,d)}else bd(a,f.text,d),f.stateAfter=0==b.frontier%5?kb(b.mode,
d):null;++b.frontier;if(+new Date>c)return yb(a,a.options.workDelay),!0});n.length&&ja(a,function(){for(var b=0;b<n.length;b++)Ga(a,n[b],"text")})}}function zf(a,b,c){for(var d,n,f=a.doc,g=c?-1:b-(a.doc.mode.innerMode?1E3:100);b>g;--b){if(b<=f.first)return f.first;var h=B(f,b-1);if(h.stateAfter&&(!c||b<=f.frontier))return b;h=ta(h.text,null,a.options.tabSize);if(null==n||d>h)n=b-1,d=h}return n}function Jb(a,b,c){var d=a.doc,n=a.display;if(!d.mode.startState)return!0;var f=zf(a,b,c),g=f>d.first&&B(d,
f-1).stateAfter,g=g?kb(d.mode,g):Af(d.mode);d.iter(f,b,function(c){bd(a,c.text,g);c.stateAfter=f==b-1||0==f%5||f>=n.viewFrom&&f<n.viewTo?kb(d.mode,g):null;++f});c&&(d.frontier=f);return g}function Pc(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function ge(a){if(a.cachedPaddingH)return a.cachedPaddingH;var b=na(a.measure,C("pre","x")),b=window.getComputedStyle?window.getComputedStyle(b):b.currentStyle,b={left:parseInt(b.paddingLeft),right:parseInt(b.paddingRight)};isNaN(b.left)||isNaN(b.right)||
(a.cachedPaddingH=b);return b}function wa(a){return Gd-a.display.nativeBarWidth}function Ia(a){return a.display.scroller.clientWidth-wa(a)-a.display.barWidth}function Sc(a){return a.display.scroller.clientHeight-wa(a)-a.display.barHeight}function Xd(a,b,c){if(a.line==b)return{map:a.measure.map,cache:a.measure.cache};for(var d=0;d<a.rest.length;d++)if(a.rest[d]==b)return{map:a.measure.maps[d],cache:a.measure.caches[d]};for(d=0;d<a.rest.length;d++)if(R(a.rest[d])>c)return{map:a.measure.maps[d],cache:a.measure.caches[d],
before:!0}}function Yc(a,b){if(b>=a.display.viewFrom&&b<a.display.viewTo)return a.display.view[Ua(a,b)];var c=a.display.externalMeasured;if(c&&b>=c.lineN&&b<c.lineN+c.size)return c}function pc(a,b){var c=R(b),d=Yc(a,c);d&&!d.text?d=null:d&&d.changes&&(Kd(a,d,c,Qc(a)),a.curOp.forceUpdate=!0);if(!d){var n;n=Ba(b);d=R(n);n=a.display.externalMeasured=new ie(a.doc,n,d);n.lineN=d;d=n.built=Od(a,n);n.text=d.pre;na(a.display.lineMeasure,d.pre);d=n}c=Xd(d,b,c);return{line:b,view:d,rect:null,map:c.map,cache:c.cache,
before:c.before,hasHeights:!1}}function cd(a,b,c,d,n){b.before&&(c=-1);var f=c+(d||"");if(b.cache.hasOwnProperty(f))a=b.cache[f];else{b.rect||(b.rect=b.view.text.getBoundingClientRect());if(!b.hasHeights){var g=b.view,h=b.rect,m=a.options.lineWrapping,p=m&&Ia(a);if(!g.measure.heights||m&&g.measure.width!=p){var q=g.measure.heights=[];if(m)for(g.measure.width=p,g=g.text.firstChild.getClientRects(),m=0;m<g.length-1;m++){var p=g[m],r=g[m+1];2<Math.abs(p.bottom-r.bottom)&&q.push((p.bottom+r.top)/2-h.top)}q.push(h.bottom-
h.top)}b.hasHeights=!0}g=d;m=Yd(b.map,c,g);d=m.node;h=m.start;p=m.end;c=m.collapse;var s;if(3==d.nodeType){for(q=0;4>q;q++){for(;h&&Kb(b.line.text.charAt(m.coverStart+h));)--h;for(;m.coverStart+p<m.coverEnd&&Kb(b.line.text.charAt(m.coverStart+p));)++p;if(M&&9>U&&0==h&&p==m.coverEnd-m.coverStart)s=d.parentNode.getBoundingClientRect();else if(M&&a.options.lineWrapping){var u=Wa(d,h,p).getClientRects();s=u.length?u["right"==g?u.length-1:0]:dd}else s=Wa(d,h,p).getBoundingClientRect()||dd;if(s.left||s.right||
0==h)break;p=h;h-=1;c="right"}if(M&&11>U){if(u=window.screen&&null!=screen.logicalXDPI&&screen.logicalXDPI!=screen.deviceXDPI)null!=ed?u=ed:(q=na(a.display.measure,C("span","x")),u=q.getBoundingClientRect(),q=Wa(q,0,1).getBoundingClientRect(),u=ed=1<Math.abs(u.left-q.left));u&&(u=screen.logicalXDPI/screen.deviceXDPI,q=screen.logicalYDPI/screen.deviceYDPI,s={left:s.left*u,right:s.right*u,top:s.top*q,bottom:s.bottom*q})}}else 0<h&&(c=g="right"),s=a.options.lineWrapping&&1<(u=d.getClientRects()).length?
u["right"==g?u.length-1:0]:d.getBoundingClientRect();!(M&&9>U)||h||s&&(s.left||s.right)||(s=(s=d.parentNode.getClientRects()[0])?{left:s.left,right:s.left+zb(a.display),top:s.top,bottom:s.bottom}:dd);u=s.top-b.rect.top;d=s.bottom-b.rect.top;h=(u+d)/2;g=b.view.measure.heights;for(q=0;q<g.length-1&&!(h<g[q]);q++);c={left:("right"==c?s.right:s.left)-b.rect.left,right:("left"==c?s.left:s.right)-b.rect.left,top:q?g[q-1]:0,bottom:g[q]};s.left||s.right||(c.bogus=!0);a.options.singleCursorHeightPerLine||
(c.rtop=u,c.rbottom=d);a=c;a.bogus||(b.cache[f]=a)}return{left:a.left,right:a.right,top:n?a.rtop:a.top,bottom:n?a.rbottom:a.bottom}}function Yd(a,b,c){for(var d,n,f,g,h=0;h<a.length;h+=3){var m=a[h],p=a[h+1];if(b<m)n=0,f=1,g="left";else if(b<p)n=b-m,f=n+1;else if(h==a.length-3||b==p&&a[h+3]>b)f=p-m,n=f-1,b>=p&&(g="right");if(null!=n){d=a[h+2];m==p&&c==(d.insertLeft?"left":"right")&&(g=c);if("left"==c&&0==n)for(;h&&a[h-2]==a[h-3]&&a[h-1].insertLeft;)d=a[(h-=3)+2],g="left";if("right"==c&&n==p-m)for(;h<
a.length-3&&a[h+3]==a[h+4]&&!a[h+5].insertLeft;)d=a[(h+=3)+2],g="right";break}}return{node:d,start:n,end:f,collapse:g,coverStart:m,coverEnd:p}}function je(a){if(a.measure&&(a.measure.cache={},a.measure.heights=null,a.rest))for(var b=0;b<a.rest.length;b++)a.measure.caches[b]={}}function ke(a){a.display.externalMeasure=null;Ra(a.display.lineMeasure);for(var b=0;b<a.display.view.length;b++)je(a.display.view[b])}function Ab(a){ke(a);a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=
null;a.options.lineWrapping||(a.display.maxLineChanged=!0);a.display.lineNumChars=null}function fd(a,b,c,d){if(b.widgets)for(var n=0;n<b.widgets.length;++n)if(b.widgets[n].above){var f=Lb(b.widgets[n]);c.top+=f;c.bottom+=f}if("line"==d)return c;d||(d="local");b=xa(b);b="local"==d?b+a.display.lineSpace.offsetTop:b-a.display.viewOffset;if("page"==d||"window"==d)a=a.display.lineSpace.getBoundingClientRect(),b+=a.top+("window"==d?0:window.pageYOffset||(document.documentElement||document.body).scrollTop),
d=a.left+("window"==d?0:window.pageXOffset||(document.documentElement||document.body).scrollLeft),c.left+=d,c.right+=d;c.top+=b;c.bottom+=b;return c}function le(a,b,c){if("div"==c)return b;var d=b.left;b=b.top;"page"==c?(d-=window.pageXOffset||(document.documentElement||document.body).scrollLeft,b-=window.pageYOffset||(document.documentElement||document.body).scrollTop):"local"!=c&&c||(c=a.display.sizer.getBoundingClientRect(),d+=c.left,b+=c.top);a=a.display.lineSpace.getBoundingClientRect();return{left:d-
a.left,top:b-a.top}}function oc(a,b,c,d,n){d||(d=B(a.doc,b.line));var f=d;b=b.ch;d=cd(a,pc(a,d),b,n);return fd(a,f,d,c)}function Fa(a,b,c,d,n,f){function g(b,L){var h=cd(a,n,b,L?"right":"left",f);L?h.left=h.right:h.right=h.left;return fd(a,d,h,c)}function h(a,b){var D=m[b],c=D.level%2;a==gd(D)&&b&&D.level<m[b-1].level?(D=m[--b],a=hd(D)-(D.level%2?0:1),c=!0):a==hd(D)&&b<m.length-1&&D.level<m[b+1].level&&(D=m[++b],a=gd(D)-D.level%2,c=!1);return c&&a==D.to&&a>D.from?g(a-1):g(a,c)}d=d||B(a.doc,b.line);
n||(n=pc(a,d));var m=ra(d);b=b.ch;if(!m)return g(b);var p=hc(m,b),p=h(b,p);null!=Mb&&(p.other=h(b,Mb));return p}function me(a,b){var c=0;b=I(a.doc,b);a.options.lineWrapping||(c=zb(a.display)*b.ch);var d=B(a.doc,b.line),n=xa(d)+a.display.lineSpace.offsetTop;return{left:c,right:c,top:n,bottom:n+d.height}}function qc(a,b,c,d){a=z(a,b);a.xRel=d;c&&(a.outside=!0);return a}function id(a,b,c){var d=a.doc;c+=a.display.viewOffset;if(0>c)return qc(d.first,0,!0,-1);var n=Ta(d,c),f=d.first+d.size-1;if(n>f)return qc(d.first+
d.size-1,B(d,f).text.length,!0,1);0>b&&(b=0);for(d=B(d,n);;)if(n=Bf(a,d,n,b,c),f=(d=Sa(d,!1))&&d.find(0,!0),d&&(n.ch>f.from.ch||n.ch==f.from.ch&&0<n.xRel))n=R(d=f.to.line);else return n}function Bf(a,b,c,d,n){function f(d){d=Fa(a,z(c,d),"line",b,p);h=!0;if(g>d.bottom)return d.left-m;if(g<d.top)return d.left+m;h=!1;return d.left}var g=n-xa(b),h=!1,m=2*a.display.wrapper.clientWidth,p=pc(a,b),q=ra(b),r=b.text.length;n=rc(b);var s=sc(b),u=f(n),t=h,v=f(s),x=h;if(d>v)return qc(c,s,x,1);for(;;){if(q?s==
n||s==jd(b,n,1):1>=s-n){q=d<u||d-u<=v-d?n:s;for(d-=q==n?u:v;Kb(b.text.charAt(q));)++q;return qc(c,q,q==n?t:x,-1>d?-1:1<d?1:0)}var w=Math.ceil(r/2),A=n+w;if(q)for(var A=n,H=0;H<w;++H)A=jd(b,A,1);H=f(A);if(H>d){s=A;v=H;if(x=h)v+=1E3;r=w}else n=A,u=H,t=h,r-=w}}function Pa(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==Xa){Xa=C("pre");for(var b=0;49>b;++b)Xa.appendChild(document.createTextNode("x")),Xa.appendChild(C("br"));Xa.appendChild(document.createTextNode("x"))}na(a.measure,Xa);
b=Xa.offsetHeight/50;3<b&&(a.cachedTextHeight=b);Ra(a.measure);return b||1}function zb(a){if(null!=a.cachedCharWidth)return a.cachedCharWidth;var b=C("span","xxxxxxxxxx"),c=C("pre",[b]);na(a.measure,c);b=b.getBoundingClientRect();b=(b.right-b.left)/10;2<b&&(a.cachedCharWidth=b);return b||10}function bb(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,
scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Cf};lb?lb.ops.push(a.curOp):a.curOp.ownsGroup=lb={ops:[a.curOp],delayedCallbacks:[]}}function db(a){if(a=a.curOp.ownsGroup)try{var b=a.delayedCallbacks,c=0;do{for(;c<b.length;c++)b[c].call(null);for(var d=0;d<a.ops.length;d++){var n=a.ops[d];if(n.cursorActivityHandlers)for(;n.cursorActivityCalled<n.cursorActivityHandlers.length;)n.cursorActivityHandlers[n.cursorActivityCalled++].call(null,n.cm)}}while(c<b.length)}finally{lb=null;for(b=
0;b<a.ops.length;b++)a.ops[b].cm.curOp=null;a=a.ops;for(b=0;b<a.length;b++){var n=a[b],c=n.cm,d=c.display,f=c,g=f.display;!g.scrollbarsClipped&&g.scroller.offsetWidth&&(g.nativeBarWidth=g.scroller.offsetWidth-g.scroller.clientWidth,g.heightForcer.style.height=wa(f)+"px",g.sizer.style.marginBottom=-g.nativeBarWidth+"px",g.sizer.style.borderRightWidth=wa(f)+"px",g.scrollbarsClipped=!0);n.updateMaxLine&&x(c);n.mustUpdate=n.viewChanged||n.forceUpdate||null!=n.scrollTop||n.scrollToPos&&(n.scrollToPos.from.line<
d.viewFrom||n.scrollToPos.to.line>=d.viewTo)||d.maxLineChanged&&c.options.lineWrapping;n.update=n.mustUpdate&&new W(c,n.mustUpdate&&{top:n.scrollTop,ensure:n.scrollToPos},n.forceUpdate)}for(b=0;b<a.length;b++)n=a[b],n.updatedDisplay=n.mustUpdate&&Q(n.cm,n.update);for(b=0;b<a.length;b++)if(n=a[b],c=n.cm,d=c.display,n.updatedDisplay&&ac(c),n.barMeasure=w(c),d.maxLineChanged&&!c.options.lineWrapping&&(f=n,g=d.maxLine.text.length,g=cd(c,pc(c,d.maxLine),g,void 0),f.adjustWidthTo=g.left+3,c.display.sizerWidth=
n.adjustWidthTo,n.barMeasure.scrollWidth=Math.max(d.scroller.clientWidth,d.sizer.offsetLeft+n.adjustWidthTo+wa(c)+c.display.barWidth),n.maxScrollLeft=Math.max(0,d.sizer.offsetLeft+n.adjustWidthTo-Ia(c))),n.updatedDisplay||n.selectionChanged)n.preparedSelection=d.input.prepareSelection();for(b=0;b<a.length;b++)n=a[b],c=n.cm,null!=n.adjustWidthTo&&(c.display.sizer.style.minWidth=n.adjustWidthTo+"px",n.maxScrollLeft<c.doc.scrollLeft&&eb(c,Math.min(c.display.scroller.scrollLeft,n.maxScrollLeft),!0),c.display.maxLineChanged=
!1),n.preparedSelection&&c.display.input.showSelection(n.preparedSelection),n.updatedDisplay&&Tc(c,n.barMeasure),(n.updatedDisplay||n.startHeight!=c.doc.height)&&A(c,n.barMeasure),n.selectionChanged&&ad(c),c.state.focused&&n.updateInput&&c.display.input.reset(n.typing),n.focus&&n.focus==ya()&&Qd(n.cm);for(b=0;b<a.length;b++){n=a[b];c=n.cm;d=c.display;f=c.doc;n.updatedDisplay&&fb(c,n.update);null==d.wheelStartX||null==n.scrollTop&&null==n.scrollLeft&&!n.scrollToPos||(d.wheelStartX=d.wheelStartY=null);
null==n.scrollTop||d.scroller.scrollTop==n.scrollTop&&!n.forceScroll||(f.scrollTop=Math.max(0,Math.min(d.scroller.scrollHeight-d.scroller.clientHeight,n.scrollTop)),d.scrollbars.setScrollTop(f.scrollTop),d.scroller.scrollTop=f.scrollTop);null==n.scrollLeft||d.scroller.scrollLeft==n.scrollLeft&&!n.forceScroll||(f.scrollLeft=Math.max(0,Math.min(d.scroller.scrollWidth-Ia(c),n.scrollLeft)),d.scrollbars.setScrollLeft(f.scrollLeft),d.scroller.scrollLeft=f.scrollLeft,S(c));if(n.scrollToPos){var h=void 0,
g=I(f,n.scrollToPos.from),h=I(f,n.scrollToPos.to),m=n.scrollToPos.margin;null==m&&(m=0);for(var p=0;5>p;p++){var q=!1,r=Fa(c,g),s=h&&h!=g?Fa(c,h):r,s=tc(c,Math.min(r.left,s.left),Math.min(r.top,s.top)-m,Math.max(r.left,s.left),Math.max(r.bottom,s.bottom)+m),u=c.doc.scrollTop,t=c.doc.scrollLeft;null!=s.scrollTop&&(Cb(c,s.scrollTop),1<Math.abs(c.doc.scrollTop-u)&&(q=!0));null!=s.scrollLeft&&(eb(c,s.scrollLeft),1<Math.abs(c.doc.scrollLeft-t)&&(q=!0));if(!q)break}h=r;n.scrollToPos.isCursor&&c.state.focused&&
(Ca(c,"scrollCursorIntoView")||(m=c.display,p=m.sizer.getBoundingClientRect(),g=null,0>h.top+p.top?g=!0:h.bottom+p.top>(window.innerHeight||document.documentElement.clientHeight)&&(g=!1),null==g||Df||(h=C("div","\u200b",null,"position: absolute; top: "+(h.top-m.viewOffset-c.display.lineSpace.offsetTop)+"px; height: "+(h.bottom-h.top+wa(c)+m.barHeight)+"px; left: "+h.left+"px; width: 2px;"),c.display.lineSpace.appendChild(h),h.scrollIntoView(g),c.display.lineSpace.removeChild(h))))}g=n.maybeHiddenMarkers;
h=n.maybeUnhiddenMarkers;if(g)for(m=0;m<g.length;++m)g[m].lines.length||X(g[m],"hide");if(h)for(m=0;m<h.length;++m)h[m].lines.length&&X(h[m],"unhide");d.wrapper.offsetHeight&&(f.scrollTop=c.display.scroller.scrollTop);n.changeObjs&&X(c,"changes",c,n.changeObjs);n.update&&n.update.finish()}}}function ja(a,b){if(a.curOp)return b();bb(a);try{return b()}finally{db(a)}}function V(a,b){return function(){if(a.curOp)return b.apply(a,arguments);bb(a);try{return b.apply(a,arguments)}finally{db(a)}}}function ba(a){return function(){if(this.curOp)return a.apply(this,
arguments);bb(this);try{return a.apply(this,arguments)}finally{db(this)}}}function ea(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);bb(b);try{return a.apply(this,arguments)}finally{db(b)}}}function ie(a,b,c){for(var d=this.line=b,n;d=Sa(d,!1);)d=d.find(1,!0).line,(n||(n=[])).push(d);this.size=(this.rest=n)?R(P(this.rest))-c+1:1;this.node=this.text=null;this.hidden=Qa(a,b)}function bc(a,b,c){var d=[],n;for(n=b;n<c;)b=new ie(a.doc,B(a.doc,n),n),n+=b.size,d.push(b);
return d}function ia(a,b,c,d){null==b&&(b=a.doc.first);null==c&&(c=a.doc.first+a.doc.size);d||(d=0);var n=a.display;d&&c<n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>b)&&(n.updateLineNumbers=b);a.curOp.viewChanged=!0;if(b>=n.viewTo)Ka&&Rc(a.doc,b)<n.viewTo&&Ja(a);else if(c<=n.viewFrom)Ka&&Id(a.doc,c+d)>n.viewFrom?Ja(a):(n.viewFrom+=d,n.viewTo+=d);else if(b<=n.viewFrom&&c>=n.viewTo)Ja(a);else if(b<=n.viewFrom){var f=uc(a,c,c+d,1);f?(n.view=n.view.slice(f.index),n.viewFrom=f.lineN,n.viewTo+=
d):Ja(a)}else if(c>=n.viewTo)(f=uc(a,b,b,-1))?(n.view=n.view.slice(0,f.index),n.viewTo=f.lineN):Ja(a);else{var f=uc(a,b,b,-1),g=uc(a,c,c+d,1);f&&g?(n.view=n.view.slice(0,f.index).concat(bc(a,f.lineN,g.lineN)).concat(n.view.slice(g.index)),n.viewTo+=d):Ja(a)}if(a=n.externalMeasured)c<a.lineN?a.lineN+=d:b<a.lineN+a.size&&(n.externalMeasured=null)}function Ga(a,b,c){a.curOp.viewChanged=!0;var d=a.display,n=a.display.externalMeasured;n&&b>=n.lineN&&b<n.lineN+n.size&&(d.externalMeasured=null);b<d.viewFrom||
b>=d.viewTo||(a=d.view[Ua(a,b)],null!=a.node&&(a=a.changes||(a.changes=[]),-1==ca(a,c)&&a.push(c)))}function Ja(a){a.display.viewFrom=a.display.viewTo=a.doc.first;a.display.view=[];a.display.viewOffset=0}function Ua(a,b){if(b>=a.display.viewTo)return null;b-=a.display.viewFrom;if(0>b)return null;for(var c=a.display.view,d=0;d<c.length;d++)if(b-=c[d].size,0>b)return d}function uc(a,b,c,d){var n=Ua(a,b),f=a.display.view;if(!Ka||c==a.doc.first+a.doc.size)return{index:n,lineN:c};for(var g=0,h=a.display.viewFrom;g<
n;g++)h+=f[g].size;if(h!=b){if(0<d){if(n==f.length-1)return null;b=h+f[n].size-b;n++}else b=h-b;c+=b}for(;Rc(a.doc,c)!=c;){if(n==(0>d?0:f.length-1))return null;c+=d*f[n-(0>d?1:0)].size;n+=d}return{index:n,lineN:c}}function Hd(a){a=a.display.view;for(var b=0,c=0;c<a.length;c++){var d=a[c];d.hidden||d.node&&!d.changes||++b}return b}function pf(a){function b(){d.activeTouch&&(n=setTimeout(function(){d.activeTouch=null},1E3),f=d.activeTouch,f.end=+new Date)}function c(a,b){if(null==b.left)return!0;var d=
b.left-a.left,D=b.top-a.top;return 400<d*d+D*D}var d=a.display;F(d.scroller,"mousedown",V(a,ne));M&&11>U?F(d.scroller,"dblclick",V(a,function(b){if(!Ca(a,b)){var c=mb(a,b);!c||kd(a,b,"gutterClick",!0,da)||Ha(a.display,b)||(fa(b),b=a.findWordAt(c),jc(a.doc,b.anchor,b.head))}})):F(d.scroller,"dblclick",function(b){Ca(a,b)||fa(b)});ld||F(d.scroller,"contextmenu",function(b){oe(a,b)});var n,f={end:0};F(d.scroller,"touchstart",function(a){var b;1!=a.touches.length?b=!1:(b=a.touches[0],b=1>=b.radiusX&&
1>=b.radiusY);b||(clearTimeout(n),b=+new Date,d.activeTouch={start:b,moved:!1,prev:300>=b-f.end?f:null},1==a.touches.length&&(d.activeTouch.left=a.touches[0].pageX,d.activeTouch.top=a.touches[0].pageY))});F(d.scroller,"touchmove",function(){d.activeTouch&&(d.activeTouch.moved=!0)});F(d.scroller,"touchend",function(n){var f=d.activeTouch;if(f&&!Ha(d,n)&&null!=f.left&&!f.moved&&300>new Date-f.start){var g=a.coordsChar(d.activeTouch,"page"),f=!f.prev||c(f,f.prev)?new T(g,g):!f.prev.prev||c(f,f.prev.prev)?
a.findWordAt(g):new T(z(g.line,0),I(a.doc,z(g.line+1,0)));a.setSelection(f.anchor,f.head);a.focus();fa(n)}b()});F(d.scroller,"touchcancel",b);F(d.scroller,"scroll",function(){d.scroller.clientHeight&&(Cb(a,d.scroller.scrollTop),eb(a,d.scroller.scrollLeft,!0),X(a,"scroll",a))});F(d.scroller,"mousewheel",function(b){pe(a,b)});F(d.scroller,"DOMMouseScroll",function(b){pe(a,b)});F(d.wrapper,"scroll",function(){d.wrapper.scrollTop=d.wrapper.scrollLeft=0});d.dragFunctions={simple:function(b){Ca(a,b)||md(b)},
start:function(b){if(M&&(!a.state.draggingText||100>+new Date-qe))md(b);else if(!Ca(a,b)&&!Ha(a.display,b)&&(b.dataTransfer.setData("Text",a.getSelection()),b.dataTransfer.setDragImage&&!re)){var c=C("img",null,null,"position: fixed; left: 0; top: 0;");c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";ua&&(c.width=c.height=1,a.display.wrapper.appendChild(c),c._top=c.offsetTop);b.dataTransfer.setDragImage(c,0,0);ua&&c.parentNode.removeChild(c)}},drop:V(a,Ef)};var g=
d.input.getField();F(g,"keyup",function(b){se.call(a,b)});F(g,"keydown",V(a,te));F(g,"keypress",V(a,ue));F(g,"focus",wb(Nc,a));F(g,"blur",wb(xb,a))}function Ff(a){var b=a.display;if(b.lastWrapHeight!=b.wrapper.clientHeight||b.lastWrapWidth!=b.wrapper.clientWidth)b.cachedCharWidth=b.cachedTextHeight=b.cachedPaddingH=null,b.scrollbarsClipped=!1,a.setSize()}function Ha(a,b){for(var c=b.target||b.srcElement;c!=a.wrapper;c=c.parentNode)if(!c||1==c.nodeType&&"true"==c.getAttribute("cm-ignore-events")||
c.parentNode==a.sizer&&c!=a.mover)return!0}function mb(a,b,c,d){var n=a.display;if(!c&&"true"==(b.target||b.srcElement).getAttribute("cm-not-content"))return null;var f,g;c=n.lineSpace.getBoundingClientRect();try{f=b.clientX-c.left,g=b.clientY-c.top}catch(h){return null}b=id(a,f,g);var m;d&&1==b.xRel&&(m=B(a.doc,b.line).text).length==b.ch&&(d=ta(m,m.length,a.options.tabSize)-m.length,b=z(b.line,Math.max(0,Math.round((f-ge(a.display).left)/zb(a.display))-d)));return b}function ne(a){var b=this.display;
if(!(b.activeTouch&&b.input.supportsTouch()||Ca(this,a)))if(b.shift=a.shiftKey,Ha(b,a))Y||(b.scroller.draggable=!1,setTimeout(function(){b.scroller.draggable=!0},100));else if(!kd(this,a,"gutterClick",!0,da)){var c=mb(this,a);window.focus();switch(ve(a)){case 1:c?Gf(this,a,c):(a.target||a.srcElement)==b.scroller&&fa(a);break;case 2:Y&&(this.state.lastMiddleDown=+new Date);c&&jc(this.doc,c);setTimeout(function(){b.input.focus()},20);fa(a);break;case 3:ld?oe(this,a):Hf(this)}}}function Gf(a,b,c){M?
setTimeout(wb(Qd,a),0):a.curOp.focus=ya();var d=+new Date,n;vc&&vc.time>d-400&&0==J(vc.pos,c)?n="triple":wc&&wc.time>d-400&&0==J(wc.pos,c)?(n="double",vc={time:d,pos:c}):(n="single",wc={time:d,pos:c});var d=a.doc.sel,f=qa?b.metaKey:b.ctrlKey,g;a.options.dragDrop&&If&&!ec(a)&&"single"==n&&-1<(g=d.contains(c))&&(0>J((g=d.ranges[g]).from(),c)||0<c.xRel)&&(0<J(g.to(),c)||0>c.xRel)?Jf(a,b,c,f):Kf(a,b,c,n,f)}function Jf(a,b,c,d){var n=a.display,f=+new Date,g=V(a,function(h){Y&&(n.scroller.draggable=!1);
a.state.draggingText=!1;Da(document,"mouseup",g);Da(n.scroller,"drop",g);10>Math.abs(b.clientX-h.clientX)+Math.abs(b.clientY-h.clientY)&&(fa(h),!d&&+new Date-200<f&&jc(a.doc,c),Y||M&&9==U?setTimeout(function(){document.body.focus();n.input.focus()},20):n.input.focus())});Y&&(n.scroller.draggable=!0);a.state.draggingText=g;n.scroller.dragDrop&&n.scroller.dragDrop();F(document,"mouseup",g);F(n.scroller,"drop",g)}function Kf(a,b,c,d,n){function f(b){if(0!=J(v,b))if(v=b,"rect"==d){for(var L=[],n=a.options.tabSize,
g=ta(B(p,c.line).text,c.ch,n),h=ta(B(p,b.line).text,b.ch,n),m=Math.min(g,h),g=Math.max(g,h),h=Math.min(c.line,b.line),ga=Math.min(a.lastLine(),Math.max(c.line,b.line));h<=ga;h++){var u=B(p,h).text,t=we(u,m,n);m==g?L.push(new T(z(h,t),z(h,t))):u.length>t&&L.push(new T(z(h,t),z(h,we(u,g,n))))}L.length||L.push(new T(c,c));Z(p,sa(s.ranges.slice(0,r).concat(L),r),{origin:"*mouse",scroll:!1});a.scrollIntoView(b)}else L=q,n=L.anchor,m=b,"single"!=d&&(b="double"==d?a.findWordAt(b):new T(z(b.line,0),I(p,z(b.line+
1,0))),0<J(b.anchor,n)?(m=b.head,n=dc(L.from(),b.anchor)):(m=b.anchor,n=cc(L.to(),b.head))),L=s.ranges.slice(0),L[r]=new T(I(p,n),m),Z(p,sa(L,r),nd)}function g(b){var c=++w,L=mb(a,b,!0,"rect"==d);if(L)if(0!=J(L,v)){a.curOp.focus=ya();f(L);var n=H(m,p);(L.line>=n.to||L.line<n.from)&&setTimeout(V(a,function(){w==c&&g(b)}),150)}else{var aa=b.clientY<x.top?-20:b.clientY>x.bottom?20:0;aa&&setTimeout(V(a,function(){w==c&&(m.scroller.scrollTop+=aa,g(b))}),50)}}function h(a){w=Infinity;fa(a);m.input.focus();
Da(document,"mousemove",A);Da(document,"mouseup",K);p.history.lastSelOrigin=null}var m=a.display,p=a.doc;fa(b);var q,r,s=p.sel,u=s.ranges;n&&!b.shiftKey?(r=p.sel.contains(c),q=-1<r?u[r]:new T(c,c)):(q=p.sel.primary(),r=p.sel.primIndex);if(b.altKey)d="rect",n||(q=new T(c,c)),c=mb(a,b,!0,!0),r=-1;else if("double"==d){var t=a.findWordAt(c);q=a.display.shift||p.extend?Ib(p,q,t.anchor,t.head):t}else"triple"==d?(t=new T(z(c.line,0),I(p,z(c.line+1,0))),q=a.display.shift||p.extend?Ib(p,q,t.anchor,t.head):
t):q=Ib(p,q,c);n?-1==r?(r=u.length,Z(p,sa(u.concat([q]),r),{scroll:!1,origin:"*mouse"})):1<u.length&&u[r].empty()&&"single"==d&&!b.shiftKey?(Z(p,sa(u.slice(0,r).concat(u.slice(r+1)),0)),s=p.sel):$c(p,r,q,nd):(r=0,Z(p,new Ea([q],0),nd),s=p.sel);var v=c,x=m.wrapper.getBoundingClientRect(),w=0,A=V(a,function(a){ve(a)?g(a):h(a)}),K=V(a,h);F(document,"mousemove",A);F(document,"mouseup",K)}function kd(a,b,c,d,n){try{var f=b.clientX,g=b.clientY}catch(h){return!1}if(f>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;
d&&fa(b);d=a.display;var m=d.lineDiv.getBoundingClientRect();if(g>m.bottom||!ma(a,c))return od(b);g-=m.top-d.viewOffset;for(m=0;m<a.options.gutters.length;++m){var p=d.gutters.childNodes[m];if(p&&p.getBoundingClientRect().right>=f)return f=Ta(a.doc,g),n(a,c,a,f,a.options.gutters[m],b),od(b)}}function Ef(a){var b=this;if(!Ca(b,a)&&!Ha(b.display,a)){fa(a);M&&(qe=+new Date);var c=mb(b,a,!0),d=a.dataTransfer.files;if(c&&!ec(b))if(d&&d.length&&window.FileReader&&window.File){var n=d.length,f=Array(n),
g=0;a=function(a,d){var D=new FileReader;D.onload=V(b,function(){f[d]=D.result;if(++g==n){c=I(b.doc,c);var a={from:c,to:c,text:b.doc.splitLines(f.join(b.doc.lineSeparator())),origin:"paste"};gb(b.doc,a);$d(b.doc,za(c,Ya(a)))}});D.readAsText(a)};for(var h=0;h<n;++h)a(d[h],h)}else if(b.state.draggingText&&-1<b.doc.sel.contains(c))b.state.draggingText(a),setTimeout(function(){b.display.input.focus()},20);else try{if(f=a.dataTransfer.getData("Text")){if(b.state.draggingText&&(qa?!a.altKey:!a.ctrlKey))var m=
b.listSelections();kc(b.doc,za(c,c));if(m)for(h=0;h<m.length;++h)nb(b.doc,"",m[h].anchor,m[h].head,"drag");b.replaceSelection(f,"around","paste");b.display.input.focus()}}catch(p){}}}function Cb(a,b){2>Math.abs(a.doc.scrollTop-b)||(a.doc.scrollTop=b,Oa||La(a,{top:b}),a.display.scroller.scrollTop!=b&&(a.display.scroller.scrollTop=b),a.display.scrollbars.setScrollTop(b),Oa&&La(a),yb(a,100))}function eb(a,b,c){(c?b==a.doc.scrollLeft:2>Math.abs(a.doc.scrollLeft-b))||(b=Math.min(b,a.display.scroller.scrollWidth-
a.display.scroller.clientWidth),a.doc.scrollLeft=b,S(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbars.setScrollLeft(b))}function pe(a,b){var c=xe(b),d=c.x,c=c.y,n=a.display,f=n.scroller;if(d&&f.scrollWidth>f.clientWidth||c&&f.scrollHeight>f.clientHeight){if(c&&qa&&Y){var g=b.target,h=n.view;a:for(;g!=f;g=g.parentNode)for(var m=0;m<h.length;m++)if(h[m].node==g){a.display.currentWheelTarget=g;break a}}!d||Oa||ua||null==ka?(c&&null!=ka&&(g=c*ka,h=a.doc.scrollTop,
m=h+n.wrapper.clientHeight,0>g?h=Math.max(0,h+g-50):m=Math.min(a.doc.height,m+g+50),La(a,{top:h,bottom:m})),20>xc&&(null==n.wheelStartX?(n.wheelStartX=f.scrollLeft,n.wheelStartY=f.scrollTop,n.wheelDX=d,n.wheelDY=c,setTimeout(function(){if(null!=n.wheelStartX){var a=f.scrollLeft-n.wheelStartX,b=f.scrollTop-n.wheelStartY,a=b&&n.wheelDY&&b/n.wheelDY||a&&n.wheelDX&&a/n.wheelDX;n.wheelStartX=n.wheelStartY=null;a&&(ka=(ka*xc+a)/(xc+1),++xc)}},200)):(n.wheelDX+=d,n.wheelDY+=c))):(c&&Cb(a,Math.max(0,Math.min(f.scrollTop+
c*ka,f.scrollHeight-f.clientHeight))),eb(a,Math.max(0,Math.min(f.scrollLeft+d*ka,f.scrollWidth-f.clientWidth))),fa(b),n.wheelStartX=null)}}function yc(a,b,c){if("string"==typeof b&&(b=zc[b],!b))return!1;a.display.input.ensurePolled();var d=a.display.shift,n=!1;try{ec(a)&&(a.state.suppressEdits=!0),c&&(a.display.shift=!1),n=b(a)!=ye}finally{a.display.shift=d,a.state.suppressEdits=!1}return n}function Lf(a,b,c){for(var d=0;d<a.state.keyMaps.length;d++){var n=Nb(b,a.state.keyMaps[d],c,a);if(n)return n}return a.options.extraKeys&&
Nb(b,a.options.extraKeys,c,a)||Nb(b,a.options.keyMap,c,a)}function Ac(a,b,c,d){var n=a.state.keySeq;if(n){if(Mf(b))return"handled";Nf.set(50,function(){a.state.keySeq==n&&(a.state.keySeq=null,a.display.input.reset())});b=n+" "+b}d=Lf(a,b,d);"multi"==d&&(a.state.keySeq=b);"handled"==d&&da(a,"keyHandled",a,b,c);if("handled"==d||"multi"==d)fa(c),ad(a);return n&&!d&&/\'$/.test(b)?(fa(c),!0):!!d}function ze(a,b){var c=Of(b,!0);return c?b.shiftKey&&!a.state.keySeq?Ac(a,"Shift-"+c,b,function(b){return yc(a,
b,!0)})||Ac(a,c,b,function(b){if("string"==typeof b?/^go[A-Z]/.test(b):b.motion)return yc(a,b)}):Ac(a,c,b,function(b){return yc(a,b)}):!1}function Pf(a,b,c){return Ac(a,"'"+c+"'",b,function(b){return yc(a,b,!0)})}function te(a){this.curOp.focus=ya();if(!Ca(this,a)){M&&11>U&&27==a.keyCode&&(a.returnValue=!1);var b=a.keyCode;this.display.shift=16==b||a.shiftKey;var c=ze(this,a);ua&&(pd=c?b:null,!c&&88==b&&!Ae&&(qa?a.metaKey:a.ctrlKey)&&this.replaceSelection("",null,"cut"));18!=b||/\bCodeMirror-crosshair\b/.test(this.display.lineDiv.className)||
Qf(this)}}function Qf(a){function b(a){18!=a.keyCode&&a.altKey||(Bb(c,"CodeMirror-crosshair"),Da(document,"keyup",b),Da(document,"mouseover",b))}var c=a.display.lineDiv;Db(c,"CodeMirror-crosshair");F(document,"keyup",b);F(document,"mouseover",b)}function se(a){16==a.keyCode&&(this.doc.sel.shift=!1);Ca(this,a)}function ue(a){if(!(Ha(this.display,a)||Ca(this,a)||a.ctrlKey&&!a.altKey||qa&&a.metaKey)){var b=a.keyCode,c=a.charCode;if(ua&&b==pd)pd=null,fa(a);else if(!ua||a.which&&!(10>a.which)||!ze(this,
a))if(b=String.fromCharCode(null==c?b:c),!Pf(this,a,b))this.display.input.onKeyPress(a)}}function Hf(a){a.state.delayingBlurEvent=!0;setTimeout(function(){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1,xb(a))},100)}function Nc(a){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1);"nocursor"!=a.options.readOnly&&(a.state.focused||(X(a,"focus",a),a.state.focused=!0,Db(a.display.wrapper,"CodeMirror-focused"),a.curOp||a.display.selForContextMenu==a.doc.sel||(a.display.input.reset(),Y&&
setTimeout(function(){a.display.input.reset(!0)},20)),a.display.input.receivedFocus()),ad(a))}function xb(a){a.state.delayingBlurEvent||(a.state.focused&&(X(a,"blur",a),a.state.focused=!1,Bb(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||(a.display.shift=!1)},150))}function oe(a,b){var c;(c=Ha(a.display,b))||(c=ma(a,"gutterContextMenu")?kd(a,b,"gutterContextMenu",!1,X):!1);if(!c)a.display.input.onContextMenu(b)}function Be(a,b){if(0>
J(a,b.from))return a;if(0>=J(a,b.to))return Ya(b);var c=a.line+b.text.length-(b.to.line-b.from.line)-1,d=a.ch;a.line==b.to.line&&(d+=Ya(b).ch-b.to.ch);return z(c,d)}function qd(a,b){for(var c=[],d=0;d<a.sel.ranges.length;d++){var n=a.sel.ranges[d];c.push(new T(Be(n.anchor,b),Be(n.head,b)))}return sa(c,a.sel.primIndex)}function Ce(a,b,c){return a.line==b.line?z(c.line,a.ch-b.ch+c.ch):z(c.line+(a.line-b.line),a.ch)}function De(a,b,c){b={canceled:!1,from:b.from,to:b.to,text:b.text,origin:b.origin,cancel:function(){this.canceled=
!0}};c&&(b.update=function(b,c,d,L){b&&(this.from=I(a,b));c&&(this.to=I(a,c));d&&(this.text=d);void 0!==L&&(this.origin=L)});X(a,"beforeChange",a,b);a.cm&&X(a.cm,"beforeChange",a.cm,b);return b.canceled?null:{from:b.from,to:b.to,text:b.text,origin:b.origin}}function gb(a,b,c){if(a.cm){if(!a.cm.curOp)return V(a.cm,gb)(a,b,c);if(a.cm.state.suppressEdits)return}if(ma(a,"beforeChange")||a.cm&&ma(a.cm,"beforeChange"))if(b=De(a,b,!0),!b)return;if(c=Ee&&!c&&Rf(a,b.from,b.to))for(var d=c.length-1;0<=d;--d)Fe(a,
{from:c[d].from,to:c[d].to,text:d?[""]:b.text});else Fe(a,b)}function Fe(a,b){if(1!=b.text.length||""!=b.text[0]||0!=J(b.from,b.to)){var c=qd(a,b);Ge(a,b,c,a.cm?a.cm.curOp.id:NaN);Ob(a,b,c,rd(a,b));var d=[];Za(a,function(a,c){c||-1!=ca(d,a.history)||(He(a.history,b),d.push(a.history));Ob(a,b,null,rd(a,b))})}}function Bc(a,b,c){if(!a.cm||!a.cm.state.suppressEdits){for(var d=a.history,n,f=a.sel,g="undo"==b?d.done:d.undone,h="undo"==b?d.undone:d.done,m=0;m<g.length&&(n=g[m],c?!n.ranges||n.equals(a.sel):
n.ranges);m++);if(m!=g.length){for(d.lastOrigin=d.lastSelOrigin=null;;)if(n=g.pop(),n.ranges){lc(n,h);if(c&&!n.equals(a.sel)){Z(a,n,{clearRedo:!1});return}f=n}else break;c=[];lc(f,h);h.push({changes:c,generation:d.generation});d.generation=n.generation||++d.maxGeneration;d=ma(a,"beforeChange")||a.cm&&ma(a.cm,"beforeChange");for(m=n.changes.length-1;0<=m;--m){var p=n.changes[m];p.origin=b;if(d&&!De(a,p,!1)){g.length=0;break}c.push(sd(a,p));f=m?qd(a,p):P(g);Ob(a,p,f,Ie(a,p));!m&&a.cm&&a.cm.scrollIntoView({from:p.from,
to:Ya(p)});var q=[];Za(a,function(a,b){b||-1!=ca(q,a.history)||(He(a.history,p),q.push(a.history));Ob(a,p,null,Ie(a,p))})}}}}function Je(a,b){if(0!=b&&(a.first+=b,a.sel=new Ea(gc(a.sel.ranges,function(a){return new T(z(a.anchor.line+b,a.anchor.ch),z(a.head.line+b,a.head.ch))}),a.sel.primIndex),a.cm)){ia(a.cm,a.first,a.first-b,b);for(var c=a.cm.display,d=c.viewFrom;d<c.viewTo;d++)Ga(a.cm,d,"gutter")}}function Ob(a,b,c,d){if(a.cm&&!a.cm.curOp)return V(a.cm,Ob)(a,b,c,d);if(b.to.line<a.first)Je(a,b.text.length-
1-(b.to.line-b.from.line));else if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var n=b.text.length-1-(a.first-b.from.line);Je(a,n);b={from:z(a.first,0),to:z(b.to.line+n,b.to.ch),text:[P(b.text)],origin:b.origin}}n=a.lastLine();b.to.line>n&&(b={from:b.from,to:z(n,B(a,n).text.length),text:[b.text[0]],origin:b.origin});b.removed=Va(a,b.from,b.to);c||(c=qd(a,b));a.cm?Sf(a.cm,b,d):td(a,b,d);kc(a,c,Aa)}}function Sf(a,b,c){var d=a.doc,n=a.display,g=b.from,h=b.to,m=!1,p=g.line;a.options.lineWrapping||
(p=R(Ba(B(d,g.line))),d.iter(p,h.line+1,function(a){if(a==n.maxLine)return m=!0}));-1<d.sel.contains(b.from,b.to)&&de(a);td(d,b,c,f(a));a.options.lineWrapping||(d.iter(p,g.line+b.text.length,function(a){var b=v(a);b>n.maxLineLength&&(n.maxLine=a,n.maxLineLength=b,n.maxLineChanged=!0,m=!1)}),m&&(a.curOp.updateMaxLine=!0));d.frontier=Math.min(d.frontier,g.line);yb(a,400);c=b.text.length-(h.line-g.line)-1;b.full?ia(a):g.line!=h.line||1!=b.text.length||Ke(a.doc,b)?ia(a,g.line,h.line+1,c):Ga(a,g.line,
"text");c=ma(a,"changes");if((d=ma(a,"change"))||c)b={from:g,to:h,text:b.text,removed:b.removed,origin:b.origin},d&&da(a,"change",a,b),c&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(b);a.display.selForContextMenu=null}function nb(a,b,c,d,n){d||(d=c);if(0>J(d,c)){var f=d;d=c;c=f}"string"==typeof b&&(b=a.splitLines(b));gb(a,{from:c,to:d,text:b,origin:n})}function tc(a,b,c,d,n){var f=a.display,g=Pa(a.display);0>c&&(c=0);var h=a.curOp&&null!=a.curOp.scrollTop?a.curOp.scrollTop:f.scroller.scrollTop,
m=Sc(a),p={};n-c>m&&(n=c+m);var q=a.doc.height+Pc(f),r=c<g,g=n>q-g;c<h?p.scrollTop=r?0:c:n>h+m&&(c=Math.min(c,(g?q:n)-m),c!=h&&(p.scrollTop=c));h=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:f.scroller.scrollLeft;a=Ia(a)-(a.options.fixedGutter?f.gutters.offsetWidth:0);(f=d-b>a)&&(d=b+a);10>b?p.scrollLeft=0:b<h?p.scrollLeft=Math.max(0,b-(f?0:10)):d>a+h-3&&(p.scrollLeft=d+(f?0:10)-a);return p}function Cc(a,b,c){null==b&&null==c||Dc(a);null!=b&&(a.curOp.scrollLeft=(null==a.curOp.scrollLeft?a.doc.scrollLeft:
a.curOp.scrollLeft)+b);null!=c&&(a.curOp.scrollTop=(null==a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+c)}function hb(a){Dc(a);var b=a.getCursor(),c=b,d=b;a.options.lineWrapping||(c=b.ch?z(b.line,b.ch-1):b,d=z(b.line,b.ch+1));a.curOp.scrollToPos={from:c,to:d,margin:a.options.cursorScrollMargin,isCursor:!0}}function Dc(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=me(a,b.from),d=me(a,b.to),b=tc(a,Math.min(c.left,d.left),Math.min(c.top,d.top)-b.margin,Math.max(c.right,d.right),
Math.max(c.bottom,d.bottom)+b.margin);a.scrollTo(b.scrollLeft,b.scrollTop)}}function Gb(a,b,c,d){var n=a.doc,f;null==c&&(c="add");"smart"==c&&(n.mode.indent?f=Jb(a,b):c="prev");var g=a.options.tabSize,h=B(n,b),m=ta(h.text,null,g);h.stateAfter&&(h.stateAfter=null);var p=h.text.match(/^\s*/)[0],q;if(!d&&!/\S/.test(h.text))q=0,c="not";else if("smart"==c&&(q=n.mode.indent(f,h.text.slice(p.length),h.text),q==ye||150<q)){if(!d)return;c="prev"}"prev"==c?q=b>n.first?ta(B(n,b-1).text,null,g):0:"add"==c?q=
m+a.options.indentUnit:"subtract"==c?q=m-a.options.indentUnit:"number"==typeof c&&(q=m+c);q=Math.max(0,q);c="";d=0;if(a.options.indentWithTabs)for(a=Math.floor(q/g);a;--a)d+=g,c+="\t";d<q&&(c+=Le(q-d));if(c!=p)return nb(n,c,z(b,0),z(b,p.length),"+input"),h.stateAfter=null,!0;for(a=0;a<n.sel.ranges.length;a++)if(g=n.sel.ranges[a],g.head.line==b&&g.head.ch<p.length){d=z(b,p.length);$c(n,a,new T(d,d));break}}function Ec(a,b,c,d){var n=b,f=b;"number"==typeof b?f=B(a,Math.max(a.first,Math.min(b,a.first+
a.size-1))):n=R(b);if(null==n)return null;d(f,n)&&a.cm&&Ga(a.cm,n,c);return f}function ob(a,b){for(var c=a.doc.sel.ranges,d=[],n=0;n<c.length;n++){for(var f=b(c[n]);d.length&&0>=J(f.from,P(d).to);){var g=d.pop();if(0>J(g.from,f.from)){f.from=g.from;break}}d.push(f)}ja(a,function(){for(var b=d.length-1;0<=b;b--)nb(a.doc,"",d[b].from,d[b].to,"+delete");hb(a)})}function ud(a,b,c,d,n){function f(b){var d=(n?jd:Me)(p,h,c,!0);if(null==d){if(b=!b)b=g+c,b<a.first||b>=a.first+a.size?b=q=!1:(g=b,b=p=B(a,b));
if(b)h=n?(0>c?sc:rc)(p):0>c?p.text.length:0;else return q=!1}else h=d;return!0}var g=b.line,h=b.ch,m=c,p=B(a,g),q=!0;if("char"==d)f();else if("column"==d)f(!0);else if("word"==d||"group"==d){var r=null;d="group"==d;b=a.cm&&a.cm.getHelper(b,"wordChars");for(var s=!0;!(0>c)||f(!s);s=!1){var u=p.text.charAt(h)||"\n",u=Fc(u,b)?"w":d&&"\n"==u?"n":!d||/\s/.test(u)?null:"p";!d||s||u||(u="s");if(r&&r!=u){0>c&&(c=1,f());break}u&&(r=u);if(0<c&&!f(!s))break}}m=nc(a,z(g,h),m,!0);q||(m.hitSide=!0);return m}function Ne(a,
b,c,d){var n=a.doc,f=b.left,g;"page"==d?(d=Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),g=b.top+c*(d-(0>c?1.5:.5)*Pa(a.display))):"line"==d&&(g=0<c?b.bottom+3:b.top-3);for(;;){var h=id(a,f,g);if(!h.outside)break;if(0>c?0>=g:g>=n.height){h.hitSide=!0;break}g+=5*c}return h}function G(a,b,d,f){c.defaults[a]=b;d&&(cb[a]=f?function(a,b,c){c!=Fd&&d(a,b,c)}:d)}function Tf(a){var b=a.split(/-(?!$)/);a=b[b.length-1];for(var c,d,n,f,g=0;g<b.length-1;g++){var h=
b[g];if(/^(cmd|meta|m)$/i.test(h))f=!0;else if(/^a(lt)?$/i.test(h))c=!0;else if(/^(c|ctrl|control)$/i.test(h))d=!0;else if(/^s(hift)$/i.test(h))n=!0;else throw Error("Unrecognized modifier name: "+h);}c&&(a="Alt-"+a);d&&(a="Ctrl-"+a);f&&(a="Cmd-"+a);n&&(a="Shift-"+a);return a}function Gc(a){return"string"==typeof a?Ma[a]:a}function pb(a,b,c,d,n){if(d&&d.shared)return Uf(a,b,c,d,n);if(a.cm&&!a.cm.curOp)return V(a.cm,pb)(a,b,c,d,n);var f=new $a(a,n);n=J(b,c);d&&oa(d,f,!1);if(0<n||0==n&&!1!==f.clearWhenEmpty)return f;
f.replacedWith&&(f.collapsed=!0,f.widgetNode=C("span",[f.replacedWith],"CodeMirror-widget"),d.handleMouseEvents||f.widgetNode.setAttribute("cm-ignore-events","true"),d.insertLeft&&(f.widgetNode.insertLeft=!0));if(f.collapsed){if(Oe(a,b.line,b,c,f)||b.line!=c.line&&Oe(a,c.line,b,c,f))throw Error("Inserting collapsed marker partially overlapping an existing one");Ka=!0}f.addToHistory&&Ge(a,{from:b,to:c,origin:"markText"},a.sel,NaN);var g=b.line,h=a.cm,m;a.iter(g,c.line+1,function(a){h&&f.collapsed&&
!h.options.lineWrapping&&Ba(a)==h.display.maxLine&&(m=!0);f.collapsed&&g!=b.line&&va(a,0);var d=new Hc(f,g==b.line?b.ch:null,g==c.line?c.ch:null);a.markedSpans=a.markedSpans?a.markedSpans.concat([d]):[d];d.marker.attachLine(a);++g});f.collapsed&&a.iter(b.line,c.line+1,function(b){Qa(a,b)&&va(b,0)});f.clearOnEnter&&F(f,"beforeCursorEnter",function(){f.clear()});f.readOnly&&(Ee=!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory());f.collapsed&&(f.id=++vd,f.atomic=!0);if(h){m&&(h.curOp.updateMaxLine=
!0);if(f.collapsed)ia(h,b.line,c.line+1);else if(f.className||f.title||f.startStyle||f.endStyle||f.css)for(d=b.line;d<=c.line;d++)Ga(h,d,"text");f.atomic&&ee(h.doc);da(h,"markerAdded",h,f)}return f}function Uf(a,b,c,d,f){d=oa(d);d.shared=!1;var g=[pb(a,b,c,d,f)],h=g[0],m=d.widgetNode;Za(a,function(a){m&&(d.widgetNode=m.cloneNode(!0));g.push(pb(a,I(a,b),I(a,c),d,f));for(var D=0;D<a.linked.length;++D)if(a.linked[D].isParent)return;h=P(g)});return new Ic(g,h)}function Pe(a){return a.findMarks(z(a.first,
0),a.clipPos(z(a.lastLine())),function(a){return a.parent})}function Vf(a){for(var b=0;b<a.length;b++){var c=a[b],d=[c.primary.doc];Za(c.primary.doc,function(a){d.push(a)});for(var f=0;f<c.markers.length;f++){var g=c.markers[f];-1==ca(d,g.doc)&&(g.parent=null,c.markers.splice(f--,1))}}}function Hc(a,b,c){this.marker=a;this.from=b;this.to=c}function Pb(a,b){if(a)for(var c=0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function rd(a,b){if(b.full)return null;var c=Hb(a,b.from.line)&&B(a,b.from.line).markedSpans,
d=Hb(a,b.to.line)&&B(a,b.to.line).markedSpans;if(!c&&!d)return null;var f=b.from.ch,g=b.to.ch,h=0==J(b.from,b.to);if(c)for(var m=0,p;m<c.length;++m){var q=c[m],r=q.marker;if(null==q.from||(r.inclusiveLeft?q.from<=f:q.from<f)||!(q.from!=f||"bookmark"!=r.type||h&&q.marker.insertLeft)){var s=null==q.to||(r.inclusiveRight?q.to>=f:q.to>f);(p||(p=[])).push(new Hc(r,q.from,s?null:q.to))}}c=p;if(d)for(var m=0,u;m<d.length;++m)if(p=d[m],q=p.marker,null==p.to||(q.inclusiveRight?p.to>=g:p.to>g)||p.from==g&&
"bookmark"==q.type&&(!h||p.marker.insertLeft))r=null==p.from||(q.inclusiveLeft?p.from<=g:p.from<g),(u||(u=[])).push(new Hc(q,r?null:p.from-g,null==p.to?null:p.to-g));d=u;h=1==b.text.length;u=P(b.text).length+(h?f:0);if(c)for(g=0;g<c.length;++g)if(m=c[g],null==m.to)(p=Pb(d,m.marker),p)?h&&(m.to=null==p.to?null:p.to+u):m.to=f;if(d)for(g=0;g<d.length;++g)m=d[g],null!=m.to&&(m.to+=u),null==m.from?(p=Pb(c,m.marker),p||(m.from=u,h&&(c||(c=[])).push(m))):(m.from+=u,h&&(c||(c=[])).push(m));c&&(c=Qe(c));d&&
d!=c&&(d=Qe(d));f=[c];if(!h){var h=b.text.length-2,t;if(0<h&&c)for(g=0;g<c.length;++g)null==c[g].to&&(t||(t=[])).push(new Hc(c[g].marker,null,null));for(g=0;g<h;++g)f.push(t);f.push(d)}return f}function Qe(a){for(var b=0;b<a.length;++b){var c=a[b];null!=c.from&&c.from==c.to&&!1!==c.marker.clearWhenEmpty&&a.splice(b--,1)}return a.length?a:null}function Ie(a,b){var c;if(c=b["spans_"+a.id]){for(var d=0,f=[];d<b.text.length;++d)f.push(Wf(c[d]));c=f}else c=null;d=rd(a,b);if(!c)return d;if(!d)return c;
for(f=0;f<c.length;++f){var g=c[f],h=d[f];if(g&&h){var m=0;a:for(;m<h.length;++m){for(var p=h[m],q=0;q<g.length;++q)if(g[q].marker==p.marker)continue a;g.push(p)}}else h&&(c[f]=h)}return c}function Rf(a,b,c){var d=null;a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||d&&-1!=ca(d,c)||(d||(d=[])).push(c)}});if(!d)return null;a=[{from:b,to:c}];for(b=0;b<d.length;++b){c=d[b];for(var f=c.find(0),g=0;g<a.length;++g){var h=
a[g];if(!(0>J(h.to,f.from)||0<J(h.from,f.to))){var m=[g,1],p=J(h.from,f.from),q=J(h.to,f.to);(0>p||!c.inclusiveLeft&&!p)&&m.push({from:h.from,to:f.from});(0<q||!c.inclusiveRight&&!q)&&m.push({from:f.to,to:h.to});a.splice.apply(a,m);g+=m.length-1}}}return a}function Re(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function Se(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function Te(a,b){var c=a.lines.length-
b.lines.length;if(0!=c)return c;var c=a.find(),d=b.find(),f=J(c.from,d.from)||(a.inclusiveLeft?-1:0)-(b.inclusiveLeft?-1:0);return f?-f:(c=J(c.to,d.to)||(a.inclusiveRight?1:0)-(b.inclusiveRight?1:0))?c:b.id-a.id}function Sa(a,b){var c=Ka&&a.markedSpans,d;if(c)for(var f,g=0;g<c.length;++g)f=c[g],f.marker.collapsed&&null==(b?f.from:f.to)&&(!d||0>Te(d,f.marker))&&(d=f.marker);return d}function Oe(a,b,c,d,f){a=B(a,b);if(a=Ka&&a.markedSpans)for(b=0;b<a.length;++b){var g=a[b];if(g.marker.collapsed){var h=
g.marker.find(0),m=J(h.from,c)||(g.marker.inclusiveLeft?-1:0)-(f.inclusiveLeft?-1:0),p=J(h.to,d)||(g.marker.inclusiveRight?1:0)-(f.inclusiveRight?1:0);if(!(0<=m&&0>=p||0>=m&&0<=p)&&(0>=m&&(0<J(h.to,c)||g.marker.inclusiveRight&&f.inclusiveLeft)||0<=m&&(0>J(h.from,d)||g.marker.inclusiveLeft&&f.inclusiveRight)))return!0}}}function Ba(a){for(var b;b=Sa(a,!0);)a=b.find(-1,!0).line;return a}function Rc(a,b){var c=B(a,b),d=Ba(c);return c==d?b:R(d)}function Id(a,b){if(b>a.lastLine())return b;var c=B(a,b),
d;if(!Qa(a,c))return b;for(;d=Sa(c,!1);)c=d.find(1,!0).line;return R(c)+1}function Qa(a,b){var c=Ka&&b.markedSpans;if(c)for(var d,f=0;f<c.length;++f)if(d=c[f],d.marker.collapsed&&(null==d.from||!d.marker.widgetNode&&0==d.from&&d.marker.inclusiveLeft&&wd(a,b,d)))return!0}function wd(a,b,c){if(null==c.to)return b=c.marker.find(1,!0),wd(a,b.line,Pb(b.line.markedSpans,c.marker));if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var d,f=0;f<b.markedSpans.length;++f)if(d=b.markedSpans[f],d.marker.collapsed&&
!d.marker.widgetNode&&d.from==c.to&&(null==d.to||d.to!=c.from)&&(d.marker.inclusiveLeft||c.marker.inclusiveRight)&&wd(a,b,d))return!0}function Lb(a){if(null!=a.height)return a.height;var b=a.doc.cm;if(!b)return 0;if(!Zc(document.body,a.node)){var c="position: relative;";a.coverGutter&&(c+="margin-left: -"+b.display.gutters.offsetWidth+"px;");a.noHScroll&&(c+="width: "+b.display.wrapper.clientWidth+"px;");na(b.display.measure,C("div",[a.node],null,c))}return a.height=a.node.offsetHeight}function Xf(a,
b,c,d){var f=new Jc(a,c,d),g=a.cm;g&&f.noHScroll&&(g.display.alignWidgets=!0);Ec(a,b,"widget",function(b){var c=b.widgets||(b.widgets=[]);null==f.insertAt?c.push(f):c.splice(Math.min(c.length-1,Math.max(0,f.insertAt)),0,f);f.line=b;g&&!Qa(a,b)&&(c=xa(b)<a.scrollTop,va(b,b.height+Lb(f)),c&&Cc(g,null,f.height),g.curOp.forceUpdate=!0);return!0});return f}function Ue(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!c)break;a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var d=
c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:(new RegExp("(?:^|s)"+c[2]+"(?:$|s)")).test(b[d])||(b[d]+=" "+c[2])}return a}function Ve(a,b){if(a.blankLine)return a.blankLine(b);if(a.innerMode){var d=c.innerMode(a,b);if(d.mode.blankLine)return d.mode.blankLine(d.state)}}function xd(a,b,d,f){for(var g=0;10>g;g++){f&&(f[0]=c.innerMode(a,d).mode);var h=a.token(b,d);if(b.pos>b.start)return h}throw Error("Mode "+a.name+" failed to advance stream.");}function We(a,b,c,d){function f(a){return{start:r.start,
end:r.pos,string:r.current(),type:m||null,state:a?kb(g.mode,q):q}}var g=a.doc,h=g.mode,m;b=I(g,b);var p=B(g,b.line),q=Jb(a,b.line,c),r=new Kc(p.text,a.options.tabSize),s;for(d&&(s=[]);(d||r.pos<b.ch)&&!r.eol();)r.start=r.pos,m=xd(h,r,q),d&&s.push(f(!0));return d?s:f()}function Xe(a,b,c,d,f,g,h){var m=c.flattenSpans;null==m&&(m=a.options.flattenSpans);var p=0,q=null,r=new Kc(b,a.options.tabSize),s,u=a.options.addModeClass&&[null];for(""==b&&Ue(Ve(c,d),g);!r.eol();){r.pos>a.options.maxHighlightLength?
(m=!1,h&&bd(a,b,d,r.pos),r.pos=b.length,s=null):s=Ue(xd(c,r,d,u),g);if(u){var t=u[0].name;t&&(s="m-"+(s?t+" "+s:t))}if(!m||q!=s){for(;p<r.start;)p=Math.min(r.start,p+5E4),f(p,q);q=s}r.start=r.pos}for(;p<r.pos;)a=Math.min(r.pos,p+5E4),f(a,q),p=a}function he(a,b,c,d){var f=[a.state.modeGen],g={};Xe(a,b.text,a.doc.mode,c,function(a,b){f.push(a,b)},g,d);for(c=0;c<a.state.overlays.length;++c){var h=a.state.overlays[c],m=1,p=0;Xe(a,b.text,h.mode,!0,function(a,b){for(var c=m;p<a;){var d=f[m];d>a&&f.splice(m,
1,a,f[m+1],d);m+=2;p=Math.min(a,d)}if(b)if(h.opaque)f.splice(c,m-c,a,"cm-overlay "+b),m=c+2;else for(;c<m;c+=2)d=f[c+1],f[c+1]=(d?d+" ":"")+"cm-overlay "+b},g)}return{styles:f,classes:g.bgClass||g.textClass?g:null}}function Ye(a,b,c){if(!b.styles||b.styles[0]!=a.state.modeGen){var d=he(a,b,b.stateAfter=Jb(a,R(b)));b.styles=d.styles;d.classes?b.styleClasses=d.classes:b.styleClasses&&(b.styleClasses=null);c===a.doc.frontier&&a.doc.frontier++}return b.styles}function bd(a,b,c,d){var f=a.doc.mode,g=new Kc(b,
a.options.tabSize);g.start=g.pos=d||0;for(""==b&&Ve(f,c);!g.eol()&&g.pos<=a.options.maxHighlightLength;)xd(f,g,c),g.start=g.pos}function Ze(a,b){if(!a||/^\s*$/.test(a))return null;var c=b.addModeClass?Yf:Zf;return c[a]||(c[a]=a.replace(/\S+/g,"cm-$&"))}function Od(a,b){var c=C("span",null,null,Y?"padding-right: .1px":null),c={pre:C("pre",[c],"CodeMirror-line"),content:c,col:0,pos:0,cm:a,splitSpaces:(M||Y)&&a.getOption("lineWrapping")};b.measure={};for(var d=0;d<=(b.rest?b.rest.length:0);d++){var f=
d?b.rest[d-1]:b.line,g;c.pos=0;c.addToken=$f;var h;if(null!=yd)h=yd;else{h=na(a.display.measure,document.createTextNode("A\u062eA"));var m=Wa(h,0,1).getBoundingClientRect();h=m&&m.left!=m.right?yd=3>Wa(h,1,2).getBoundingClientRect().right-m.right:!1}h&&(g=ra(f))&&(c.addToken=ag(c.addToken,g));c.map=[];m=b!=a.display.externalMeasured&&R(f);a:{h=c;var m=Ye(a,f,m),p=f.markedSpans,q=f.text,r=0;if(p)for(var s=q.length,u=0,t=1,v="",x=void 0,w=void 0,A=0,H=void 0,K=void 0,S=void 0,z=void 0,E=void 0;;){if(A==
u){for(var H=K=S=z=w="",E=null,A=Infinity,O=[],B=0;B<p.length;++B){var Q=p[B],N=Q.marker;"bookmark"==N.type&&Q.from==u&&N.widgetNode?O.push(N):Q.from<=u&&(null==Q.to||Q.to>u||N.collapsed&&Q.to==u&&Q.from==u)?(null!=Q.to&&Q.to!=u&&A>Q.to&&(A=Q.to,K=""),N.className&&(H+=" "+N.className),N.css&&(w=N.css),N.startStyle&&Q.from==u&&(S+=" "+N.startStyle),N.endStyle&&Q.to==A&&(K+=" "+N.endStyle),N.title&&!z&&(z=N.title),N.collapsed&&(!E||0>Te(E.marker,N))&&(E=Q)):Q.from>u&&A>Q.from&&(A=Q.from)}if(E&&(E.from||
0)==u){$e(h,(null==E.to?s+1:E.to)-u,E.marker,null==E.from);if(null==E.to)break a;E.to==u&&(E=!1)}if(!E&&O.length)for(B=0;B<O.length;++B)$e(h,0,O[B])}if(u>=s)break;for(O=Math.min(s,A);;){if(v){B=u+v.length;E||(Q=B>O?v.slice(0,O-u):v,h.addToken(h,Q,x?x+H:H,S,u+Q.length==A?K:"",z,w));if(B>=O){v=v.slice(O-u);u=O;break}u=B;S=""}v=q.slice(r,r=m[t++]);x=Ze(m[t++],h.cm.options)}}else for(var t=1;t<m.length;t+=2)h.addToken(h,q.slice(r,r=m[t]),Ze(m[t+1],h.cm.options))}f.styleClasses&&(f.styleClasses.bgClass&&
(c.bgClass=zd(f.styleClasses.bgClass,c.bgClass||"")),f.styleClasses.textClass&&(c.textClass=zd(f.styleClasses.textClass,c.textClass||"")));0==c.map.length&&c.map.push(0,0,c.content.appendChild(bg(a.display.measure)));0==d?(b.measure.map=c.map,b.measure.cache={}):((b.measure.maps||(b.measure.maps=[])).push(c.map),(b.measure.caches||(b.measure.caches=[])).push({}))}Y&&/\bcm-tab\b/.test(c.content.lastChild.className)&&(c.content.className="cm-tab-wrap-hack");X(a,"renderLine",a,b.line,c.pre);c.pre.className&&
(c.textClass=zd(c.pre.className,c.textClass||""));return c}function $f(a,b,c,d,f,g,h){if(b){var m=a.splitSpaces?b.replace(/ {3,}/g,cg):b,p=a.cm.state.specialChars,q=!1;if(p.test(b))for(var r=document.createDocumentFragment(),s=0;;){p.lastIndex=s;var u=p.exec(b),t=u?u.index-s:b.length-s;if(t){var v=document.createTextNode(m.slice(s,s+t));M&&9>U?r.appendChild(C("span",[v])):r.appendChild(v);a.map.push(a.pos,a.pos+t,v);a.col+=t;a.pos+=t}if(!u)break;s+=t+1;"\t"==u[0]?(v=a.cm.options.tabSize,u=v-a.col%
v,v=r.appendChild(C("span",Le(u),"cm-tab")),v.setAttribute("role","presentation"),v.setAttribute("cm-text","\t"),a.col+=u):("\r"==u[0]||"\n"==u[0]?(v=r.appendChild(C("span","\r"==u[0]?"\u240d":"\u2424","cm-invalidchar")),v.setAttribute("cm-text",u[0])):(v=a.cm.options.specialCharPlaceholder(u[0]),v.setAttribute("cm-text",u[0]),M&&9>U?r.appendChild(C("span",[v])):r.appendChild(v)),a.col+=1);a.map.push(a.pos,a.pos+1,v);a.pos++}else{a.col+=b.length;var r=document.createTextNode(m);a.map.push(a.pos,a.pos+
b.length,r);M&&9>U&&(q=!0);a.pos+=b.length}if(c||d||f||q||h)return b=c||"",d&&(b+=d),f&&(b+=f),d=C("span",[r],b,h),g&&(d.title=g),a.content.appendChild(d);a.content.appendChild(r)}}function cg(a){for(var b=" ",c=0;c<a.length-2;++c)b+=c%2?" ":"\u00a0";return b+" "}function ag(a,b){return function(c,d,f,g,h,m,p){f=f?f+" cm-force-border":"cm-force-border";for(var q=c.pos,r=q+d.length;;){for(var s=0;s<b.length;s++){var u=b[s];if(u.to>q&&u.from<=q)break}if(u.to>=r)return a(c,d,f,g,h,m,p);a(c,d.slice(0,
u.to-q),f,g,null,m,p);g=null;d=d.slice(u.to-q);q=u.to}}}function $e(a,b,c,d){var f=!d&&c.widgetNode;f&&a.map.push(a.pos,a.pos+b,f);!d&&a.cm.display.input.needsContentAttribute&&(f||(f=a.content.appendChild(document.createElement("span"))),f.setAttribute("cm-marker",c.id));f&&(a.cm.display.input.setUneditable(f),a.content.appendChild(f));a.pos+=b}function Ke(a,b){return 0==b.from.ch&&0==b.to.ch&&""==P(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function td(a,b,c,d){function f(a,c,D){a.text=
c;a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null);null!=a.order&&(a.order=null);Re(a);Se(a,D);c=d?d(a):1;c!=a.height&&va(a,c);da(a,"change",a,b)}function g(a,b){for(var D=a,f=[];D<b;++D)f.push(new Qb(p[D],c?c[D]:null,d));return f}var h=b.from,m=b.to,p=b.text,q=B(a,h.line),r=B(a,m.line),s=P(p),u=c?c[p.length-1]:null,t=m.line-h.line;if(b.full)a.insert(0,g(0,p.length)),a.remove(p.length,a.size-p.length);else if(Ke(a,b)){var v=g(0,p.length-1);f(r,r.text,u);t&&a.remove(h.line,t);v.length&&
a.insert(h.line,v)}else q==r?1==p.length?f(q,q.text.slice(0,h.ch)+s+q.text.slice(m.ch),u):(v=g(1,p.length-1),v.push(new Qb(s+q.text.slice(m.ch),u,d)),f(q,q.text.slice(0,h.ch)+p[0],c?c[0]:null),a.insert(h.line+1,v)):1==p.length?(f(q,q.text.slice(0,h.ch)+p[0]+r.text.slice(m.ch),c?c[0]:null),a.remove(h.line+1,t)):(f(q,q.text.slice(0,h.ch)+p[0],c?c[0]:null),f(r,s+r.text.slice(m.ch),u),v=g(1,p.length-1),1<t&&a.remove(h.line+1,t-1),a.insert(h.line+1,v));da(a,"change",a,b)}function Rb(a){this.lines=a;this.parent=
null;for(var b=0,c=0;b<a.length;++b)a[b].parent=this,c+=a[b].height;this.height=c}function Sb(a){this.children=a;for(var b=0,c=0,d=0;d<a.length;++d){var f=a[d],b=b+f.chunkSize(),c=c+f.height;f.parent=this}this.size=b;this.height=c;this.parent=null}function Za(a,b,c){function d(a,D,f){if(a.linked)for(var g=0;g<a.linked.length;++g){var h=a.linked[g];if(h.doc!=D){var m=f&&h.sharedHist;if(!c||m)b(h.doc,m),d(h.doc,a,m)}}}d(a,null,!0)}function Ed(a,c){if(c.cm)throw Error("This document is already in use.");
a.doc=c;c.cm=a;g(a);b(a);a.options.lineWrapping||x(a);a.options.mode=c.modeOption;ia(a)}function B(a,b){b-=a.first;if(0>b||b>=a.size)throw Error("There is no line "+(b+a.first)+" in the document.");for(var c=a;!c.lines;)for(var d=0;;++d){var f=c.children[d],g=f.chunkSize();if(b<g){c=f;break}b-=g}return c.lines[b]}function Va(a,b,c){var d=[],f=b.line;a.iter(b.line,c.line+1,function(a){a=a.text;f==c.line&&(a=a.slice(0,c.ch));f==b.line&&(a=a.slice(b.ch));d.push(a);++f});return d}function Ad(a,b,c){var d=
[];a.iter(b,c,function(a){d.push(a.text)});return d}function va(a,b){var c=b-a.height;if(c)for(var d=a;d;d=d.parent)d.height+=c}function R(a){if(null==a.parent)return null;var b=a.parent;a=ca(b.lines,a);for(var c=b.parent;c;b=c,c=c.parent)for(var d=0;c.children[d]!=b;++d)a+=c.children[d].chunkSize();return a+b.first}function Ta(a,b){var c=a.first;a:do{for(var d=0;d<a.children.length;++d){var f=a.children[d],g=f.height;if(b<g){a=f;continue a}b-=g;c+=f.chunkSize()}return c}while(!a.lines);for(d=0;d<
a.lines.length;++d){f=a.lines[d].height;if(b<f)break;b-=f}return c+d}function xa(a){a=Ba(a);for(var b=0,c=a.parent,d=0;d<c.lines.length;++d){var f=c.lines[d];if(f==a)break;else b+=f.height}for(a=c.parent;a;c=a,a=c.parent)for(d=0;d<a.children.length&&(f=a.children[d],f!=c);++d)b+=f.height;return b}function ra(a){var b=a.order;null==b&&(b=a.order=dg(a.text));return b}function Lc(a){this.done=[];this.undone=[];this.undoDepth=Infinity;this.lastModTime=this.lastSelTime=0;this.lastOrigin=this.lastSelOrigin=
this.lastOp=this.lastSelOp=null;this.generation=this.maxGeneration=a||1}function sd(a,b){var c={from:Vc(b.from),to:Ya(b),text:Va(a,b.from,b.to)};af(a,c,b.from.line,b.to.line+1);Za(a,function(a){af(a,c,b.from.line,b.to.line+1)},!0);return c}function ae(a){for(;a.length;)if(P(a).ranges)a.pop();else break}function Ge(a,b,c,d){var f=a.history;f.undone.length=0;var g=+new Date,h,m;if(m=f.lastOp==d||f.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&f.lastModTime>g-a.cm.options.historyEventDelay||
"*"==b.origin.charAt(0)))f.lastOp==d?(ae(f.done),h=P(f.done)):f.done.length&&!P(f.done).ranges?h=P(f.done):1<f.done.length&&!f.done[f.done.length-2].ranges?(f.done.pop(),h=P(f.done)):h=void 0,m=h;if(m){var p=P(h.changes);0==J(b.from,b.to)&&0==J(b.from,p.to)?p.to=Ya(b):h.changes.push(sd(a,b))}else for((h=P(f.done))&&h.ranges||lc(a.sel,f.done),h={changes:[sd(a,b)],generation:f.generation},f.done.push(h);f.done.length>f.undoDepth;)f.done.shift(),f.done[0].ranges||f.done.shift();f.done.push(c);f.generation=
++f.maxGeneration;f.lastModTime=f.lastSelTime=g;f.lastOp=f.lastSelOp=d;f.lastOrigin=f.lastSelOrigin=b.origin;p||X(a,"historyAdded")}function lc(a,b){var c=P(b);c&&c.ranges&&c.equals(a)||b.push(a)}function af(a,b,c,d){var f=b["spans_"+a.id],g=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(c){c.markedSpans&&((f||(f=b["spans_"+a.id]={}))[g]=c.markedSpans);++g})}function Wf(a){if(!a)return null;for(var b=0,c;b<a.length;++b)a[b].marker.explicitlyCleared?c||(c=a.slice(0,b)):c&&c.push(a[b]);
return c?c.length?c:null:a}function qb(a,b,c){for(var d=0,f=[];d<a.length;++d){var g=a[d];if(g.ranges)f.push(c?Ea.prototype.deepCopy.call(g):g);else{var g=g.changes,h=[];f.push({changes:h});for(var m=0;m<g.length;++m){var p=g[m],q;h.push({from:p.from,to:p.to,text:p.text});if(b)for(var r in p)(q=r.match(/^spans_(\d+)$/))&&-1<ca(b,Number(q[1]))&&(P(h)[r]=p[r],delete p[r])}}}return f}function bf(a,b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)}function cf(a,b,c,d){for(var f=0;f<a.length;++f){var g=
a[f],h=!0;if(g.ranges){g.copied||(g=a[f]=g.deepCopy(),g.copied=!0);for(var m=0;m<g.ranges.length;m++)bf(g.ranges[m].anchor,b,c,d),bf(g.ranges[m].head,b,c,d)}else{for(m=0;m<g.changes.length;++m){var p=g.changes[m];if(c<p.from.line)p.from=z(p.from.line+d,p.from.ch),p.to=z(p.to.line+d,p.to.ch);else if(b<=p.to.line){h=!1;break}}h||(a.splice(0,f+1),f=0)}}}function He(a,b){var c=b.from.line,d=b.to.line,f=b.text.length-(d-c)-1;cf(a.done,c,d,f);cf(a.undone,c,d,f)}function od(a){return null!=a.defaultPrevented?
a.defaultPrevented:!1==a.returnValue}function ve(a){var b=a.which;null==b&&(a.button&1?b=1:a.button&2?b=3:a.button&4&&(b=2));qa&&a.ctrlKey&&1==b&&(b=3);return b}function da(a,b){function c(a){return function(){a.apply(null,f)}}var d=a._handlers&&a._handlers[b];if(d){var f=Array.prototype.slice.call(arguments,2),g;lb?g=lb.delayedCallbacks:Tb?g=Tb:(g=Tb=[],setTimeout(eg,0));for(var h=0;h<d.length;++h)g.push(c(d[h]))}}function eg(){var a=Tb;Tb=null;for(var b=0;b<a.length;++b)a[b]()}function Ca(a,b,c){"string"==
typeof b&&(b={type:b,preventDefault:function(){this.defaultPrevented=!0}});X(a,c||b.type,a,b);return od(b)||b.codemirrorIgnore}function de(a){var b=a._handlers&&a._handlers.cursorActivity;if(b){a=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=[]);for(var c=0;c<b.length;++c)-1==ca(a,b[c])&&a.push(b[c])}}function ma(a,b){var c=a._handlers&&a._handlers[b];return c&&0<c.length}function rb(a){a.prototype.on=function(a,b){F(this,a,b)};a.prototype.off=function(a,b){Da(this,a,b)}}function vb(){this.id=
null}function we(a,b,c){for(var d=0,f=0;;){var g=a.indexOf("\t",d);-1==g&&(g=a.length);var h=g-d;if(g==a.length||f+h>=b)return d+Math.min(h,b-f);f+=g-d;f+=c-f%c;d=g+1;if(f>=b)return d}}function Le(a){for(;Mc.length<=a;)Mc.push(P(Mc)+" ");return Mc[a]}function P(a){return a[a.length-1]}function ca(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return c;return-1}function gc(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=b(a[d],d);return c}function Ub(){}function df(a,b){var c;Object.create?c=Object.create(a):
(Ub.prototype=a,c=new Ub);b&&oa(b,c);return c}function oa(a,b,c){b||(b={});for(var d in a)!a.hasOwnProperty(d)||!1===c&&b.hasOwnProperty(d)||(b[d]=a[d]);return b}function wb(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function Fc(a,b){return b?-1<b.source.indexOf("\\w")&&ef(a)?!0:b.test(a):ef(a)}function ff(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function Kb(a){return 768<=a.charCodeAt(0)&&fg.test(a)}function C(a,b,c,d){a=document.createElement(a);
c&&(a.className=c);d&&(a.style.cssText=d);if("string"==typeof b)a.appendChild(document.createTextNode(b));else if(b)for(c=0;c<b.length;++c)a.appendChild(b[c]);return a}function Ra(a){for(var b=a.childNodes.length;0<b;--b)a.removeChild(a.firstChild);return a}function na(a,b){return Ra(a).appendChild(b)}function ya(){for(var a=document.activeElement;a&&a.root&&a.root.activeElement;)a=a.root.activeElement;return a}function Vb(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}function zd(a,b){for(var c=
a.split(" "),d=0;d<c.length;d++)c[d]&&!Vb(c[d]).test(b)&&(b+=" "+c[d]);return b}function gf(a){if(document.body.getElementsByClassName)for(var b=document.body.getElementsByClassName("CodeMirror"),c=0;c<b.length;c++){var d=b[c].CodeMirror;d&&a(d)}}function qf(){var a;F(window,"resize",function(){null==a&&(a=setTimeout(function(){a=null;gf(Ff)},100))});F(window,"blur",function(){gf(xb)})}function bg(a){if(null==Bd){var b=C("span","\u200b");na(a,C("span",[b,document.createTextNode("x")]));0!=a.firstChild.offsetHeight&&
(Bd=1>=b.offsetWidth&&2<b.offsetHeight&&!(M&&8>U))}a=Bd?C("span","\u200b"):C("span","\u00a0",null,"display: inline-block; width: 1px; margin-right: -1px");a.setAttribute("cm-text","");return a}function xf(a,b,c,d){if(!a)return d(b,c,"ltr");for(var f=!1,g=0;g<a.length;++g){var h=a[g];if(h.from<c&&h.to>b||b==c&&h.to==b)d(Math.max(h.from,b),Math.min(h.to,c),1==h.level?"rtl":"ltr"),f=!0}f||d(b,c,"ltr")}function gd(a){return a.level%2?a.to:a.from}function hd(a){return a.level%2?a.from:a.to}function rc(a){return(a=
ra(a))?gd(a[0]):0}function sc(a){var b=ra(a);return b?hd(P(b)):a.text.length}function hf(a,b){var c=B(a.doc,b),d=Ba(c);d!=c&&(b=R(d));d=(c=ra(d))?c[0].level%2?sc(d):rc(d):0;return z(b,d)}function jf(a,b){var c=hf(a,b.line),d=B(a.doc,c.line),f=ra(d);return f&&0!=f[0].level?c:(d=Math.max(0,d.text.search(/\S/)),z(c.line,b.line==c.line&&b.ch<=d&&b.ch?0:d))}function hc(a,b){Mb=null;for(var c=0,d;c<a.length;++c){var f=a[c];if(f.from<b&&f.to>b)return c;if(f.from==b||f.to==b)if(null==d)d=c;else{var g;g=f.level;
var h=a[d].level,m=a[0].level;g=g==m?!0:h==m?!1:g<h;if(g)return f.from!=f.to&&(Mb=d),c;f.from!=f.to&&(Mb=c);break}}return d}function Cd(a,b,c,d){if(!d)return b+c;do b+=c;while(0<b&&Kb(a.text.charAt(b)));return b}function jd(a,b,c,d){var f=ra(a);if(!f)return Me(a,b,c,d);var g=hc(f,b),h=f[g];for(b=Cd(a,b,h.level%2?-c:c,d);;){if(b>h.from&&b<h.to)return b;if(b==h.from||b==h.to){if(hc(f,b)==g)return b;h=f[g+c];return 0<c==h.level%2?h.to:h.from}h=f[g+=c];if(!h)return null;b=0<c==h.level%2?Cd(a,h.to,-1,
d):Cd(a,h.from,1,d)}}function Me(a,b,c,d){b+=c;if(d)for(;0<b&&Kb(a.text.charAt(b));)b+=c;return 0>b||b>a.text.length?null:b}var Oa=/gecko\/\d/i.test(navigator.userAgent),kf=/MSIE \d/.test(navigator.userAgent),lf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),M=kf||lf,U=M&&(kf?document.documentMode||6:lf[1]),Y=/WebKit\//.test(navigator.userAgent),gg=Y&&/Qt\/\d+\.\d+/.test(navigator.userAgent),hg=/Chrome\//.test(navigator.userAgent),ua=/Opera\//.test(navigator.userAgent),re=/Apple Computer/.test(navigator.vendor),
ig=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Df=/PhantomJS/.test(navigator.userAgent),ib=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),ub=ib||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),qa=ib||/Mac/.test(navigator.platform),jg=/win/i.test(navigator.platform),ab=ua&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);ab&&(ab=Number(ab[1]));ab&&15<=ab&&(ua=!1,Y=!0);var mf=qa&&(gg||ua&&(null==ab||12.11>ab)),ld=Oa||
M&&9<=U,Ee=!1,Ka=!1;q.prototype=oa({update:function(a){var b=a.scrollWidth>a.clientWidth+1,c=a.scrollHeight>a.clientHeight+1,d=a.nativeBarWidth;c?(this.vert.style.display="block",this.vert.style.bottom=b?d+"px":"0",this.vert.firstChild.style.height=Math.max(0,a.scrollHeight-a.clientHeight+(a.viewHeight-(b?d:0)))+"px"):(this.vert.style.display="",this.vert.firstChild.style.height="0");b?(this.horiz.style.display="block",this.horiz.style.right=c?d+"px":"0",this.horiz.style.left=a.barLeft+"px",this.horiz.firstChild.style.width=
a.scrollWidth-a.clientWidth+(a.viewWidth-a.barLeft-(c?d:0))+"px"):(this.horiz.style.display="",this.horiz.firstChild.style.width="0");!this.checkedOverlay&&0<a.clientHeight&&(0==d&&this.overlayHack(),this.checkedOverlay=!0);return{right:c?d:0,bottom:b?d:0}},setScrollLeft:function(a){this.horiz.scrollLeft!=a&&(this.horiz.scrollLeft=a)},setScrollTop:function(a){this.vert.scrollTop!=a&&(this.vert.scrollTop=a)},overlayHack:function(){this.horiz.style.minHeight=this.vert.style.minWidth=qa&&!ig?"12px":
"18px";var a=this,b=function(b){(b.target||b.srcElement)!=a.vert&&(b.target||b.srcElement)!=a.horiz&&V(a.cm,ne)(b)};F(this.vert,"mousedown",b);F(this.horiz,"mousedown",b)},clear:function(){var a=this.horiz.parentNode;a.removeChild(this.horiz);a.removeChild(this.vert)}},q.prototype);r.prototype=oa({update:function(){return{bottom:0,right:0}},setScrollLeft:function(){},setScrollTop:function(){},clear:function(){}},r.prototype);c.scrollbarModel={"native":q,"null":r};W.prototype.signal=function(a,b){ma(a,
b)&&this.events.push(arguments)};W.prototype.finish=function(){for(var a=0;a<this.events.length;a++)X.apply(null,this.events[a])};var z=c.Pos=function(a,b){if(!(this instanceof z))return new z(a,b);this.line=a;this.ch=b},J=c.cmpPos=function(a,b){return a.line-b.line||a.ch-b.ch},la=null;Wc.prototype=oa({init:function(a){function b(a){if(d.somethingSelected())la=d.getSelections(),c.inaccurateSelection&&(c.prevInput="",c.inaccurateSelection=!1,g.value=la.join("\n"),sb(g));else if(d.options.lineWiseCopyCut){var f=
Td(d);la=f.text;"cut"==a.type?d.setSelections(f.ranges,null,Aa):(c.prevInput="",g.value=f.text.join("\n"),sb(g))}else return;"cut"==a.type&&(d.state.cutIncoming=!0)}var c=this,d=this.cm,f=this.wrapper=Vd(),g=this.textarea=f.firstChild;a.wrapper.insertBefore(f,a.wrapper.firstChild);ib&&(g.style.width="0px");F(g,"input",function(){M&&9<=U&&c.hasSelection&&(c.hasSelection=null);c.poll()});F(g,"paste",function(a){if(Sd(a,d))return!0;d.state.pasteIncoming=!0;c.fastPoll()});F(g,"cut",b);F(g,"copy",b);F(a.scroller,
"paste",function(b){Ha(a,b)||(d.state.pasteIncoming=!0,c.focus())});F(a.lineSpace,"selectstart",function(b){Ha(a,b)||fa(b)});F(g,"compositionstart",function(){var a=d.getCursor("from");c.composing={start:a,range:d.markText(a,d.getCursor("to"),{className:"CodeMirror-composing"})}});F(g,"compositionend",function(){c.composing&&(c.poll(),c.composing.range.clear(),c.composing=null)})},prepareSelection:function(){var a=this.cm,b=a.display,c=a.doc,d=fe(a);if(a.options.moveInputWithCursor){var a=Fa(a,c.sel.primary().head,
"div"),c=b.wrapper.getBoundingClientRect(),f=b.lineDiv.getBoundingClientRect();d.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,a.top+f.top-c.top));d.teLeft=Math.max(0,Math.min(b.wrapper.clientWidth-10,a.left+f.left-c.left))}return d},showSelection:function(a){var b=this.cm.display;na(b.cursorDiv,a.cursors);na(b.selectionDiv,a.selection);null!=a.teTop&&(this.wrapper.style.top=a.teTop+"px",this.wrapper.style.left=a.teLeft+"px")},reset:function(a){if(!this.contextMenuPending){var b,c,d=this.cm,
f=d.doc;d.somethingSelected()?(this.prevInput="",b=f.sel.primary(),c=(b=Ae&&(100<b.to().line-b.from().line||1E3<(c=d.getSelection()).length))?"-":c||d.getSelection(),this.textarea.value=c,d.state.focused&&sb(this.textarea),M&&9<=U&&(this.hasSelection=c)):a||(this.prevInput=this.textarea.value="",M&&9<=U&&(this.hasSelection=null));this.inaccurateSelection=b}},getField:function(){return this.textarea},supportsTouch:function(){return!1},focus:function(){if("nocursor"!=this.cm.options.readOnly&&(!ub||
ya()!=this.textarea))try{this.textarea.focus()}catch(a){}},blur:function(){this.textarea.blur()},resetPosition:function(){this.wrapper.style.top=this.wrapper.style.left=0},receivedFocus:function(){this.slowPoll()},slowPoll:function(){var a=this;a.pollingFast||a.polling.set(this.cm.options.pollInterval,function(){a.poll();a.cm.state.focused&&a.slowPoll()})},fastPoll:function(){function a(){c.poll()||b?(c.pollingFast=!1,c.slowPoll()):(b=!0,c.polling.set(60,a))}var b=!1,c=this;c.pollingFast=!0;c.polling.set(20,
a)},poll:function(){var a=this.cm,b=this.textarea,c=this.prevInput;if(this.contextMenuPending||!a.state.focused||kg(b)&&!c&&!this.composing||ec(a)||a.options.disableInput||a.state.keySeq)return!1;var d=b.value;if(d==c&&!a.somethingSelected())return!1;if(M&&9<=U&&this.hasSelection===d||qa&&/[\uf700-\uf7ff]/.test(d))return a.display.input.reset(),!1;if(a.doc.sel==a.display.selForContextMenu){var f=d.charCodeAt(0);8203!=f||c||(c="\u200b");if(8666==f)return this.reset(),this.cm.execCommand("undo")}for(var g=
0,f=Math.min(c.length,d.length);g<f&&c.charCodeAt(g)==d.charCodeAt(g);)++g;var h=this;ja(a,function(){fc(a,d.slice(g),c.length-g,null,h.composing?"*compose":null);1E3<d.length||-1<d.indexOf("\n")?b.value=h.prevInput="":h.prevInput=d;h.composing&&(h.composing.range.clear(),h.composing.range=a.markText(h.composing.start,a.getCursor("to"),{className:"CodeMirror-composing"}))});return!0},ensurePolled:function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},onKeyPress:function(){M&&9<=U&&(this.hasSelection=
null);this.fastPoll()},onContextMenu:function(a){function b(){if(null!=h.selectionStart){var a=f.somethingSelected(),c="\u200b"+(a?h.value:"");h.value="\u21da";h.value=c;d.prevInput=a?"":"\u200b";h.selectionStart=1;h.selectionEnd=c.length;g.selForContextMenu=f.doc.sel}}function c(){d.contextMenuPending=!1;d.wrapper.style.position="relative";h.style.cssText=q;M&&9>U&&g.scrollbars.setScrollTop(g.scroller.scrollTop=p);if(null!=h.selectionStart){(!M||M&&9>U)&&b();var a=0,D=function(){g.selForContextMenu==
f.doc.sel&&0==h.selectionStart&&0<h.selectionEnd&&"\u200b"==d.prevInput?V(f,zc.selectAll)(f):10>a++?g.detectingSelectAll=setTimeout(D,500):g.input.reset()};g.detectingSelectAll=setTimeout(D,200)}}var d=this,f=d.cm,g=f.display,h=d.textarea,m=mb(f,a),p=g.scroller.scrollTop;if(m&&!ua){f.options.resetSelectionOnContextMenu&&-1==f.doc.sel.contains(m)&&V(f,Z)(f.doc,za(m),Aa);var q=h.style.cssText;d.wrapper.style.position="absolute";h.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(a.clientY-
5)+"px; left: "+(a.clientX-5)+"px; z-index: 1000; background: "+(M?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";if(Y)var r=window.scrollY;g.input.focus();Y&&window.scrollTo(null,r);g.input.reset();f.somethingSelected()||(h.value=d.prevInput=" ");d.contextMenuPending=!0;g.selForContextMenu=f.doc.sel;clearTimeout(g.detectingSelectAll);M&&9<=U&&b();if(ld){md(a);var s=function(){Da(window,"mouseup",
s);setTimeout(c,20)};F(window,"mouseup",s)}else setTimeout(c,50)}},setUneditable:Ub,needsContentAttribute:!1},Wc.prototype);Xc.prototype=oa({init:function(a){function b(a){if(d.somethingSelected())la=d.getSelections(),"cut"==a.type&&d.replaceSelection("",null,"cut");else if(d.options.lineWiseCopyCut){var c=Td(d);la=c.text;"cut"==a.type&&d.operation(function(){d.setSelections(c.ranges,0,Aa);d.replaceSelection("",null,"cut")})}else return;if(a.clipboardData&&!ib)a.preventDefault(),a.clipboardData.clearData(),
a.clipboardData.setData("text/plain",la.join("\n"));else{var f=Vd();a=f.firstChild;d.display.lineSpace.insertBefore(f,d.display.lineSpace.firstChild);a.value=la.join("\n");var g=document.activeElement;sb(a);setTimeout(function(){d.display.lineSpace.removeChild(f);g.focus()},50)}}var c=this,d=c.cm;a=c.div=a.lineDiv;a.contentEditable="true";Ud(a);F(a,"paste",function(a){Sd(a,d)});F(a,"compositionstart",function(a){a=a.data;c.composing={sel:d.doc.sel,data:a,startData:a};if(a){var b=d.doc.sel.primary(),
f=d.getLine(b.head.line).indexOf(a,Math.max(0,b.head.ch-a.length));-1<f&&f<=b.head.ch&&(c.composing.sel=za(z(b.head.line,f),z(b.head.line,f+a.length)))}});F(a,"compositionupdate",function(a){c.composing.data=a.data});F(a,"compositionend",function(a){var b=c.composing;b&&(a.data==b.startData||/\u200b/.test(a.data)||(b.data=a.data),setTimeout(function(){b.handled||c.applyComposition(b);c.composing==b&&(c.composing=null)},50))});F(a,"touchstart",function(){c.forceCompositionEnd()});F(a,"input",function(){c.composing||
c.pollContent()||ja(c.cm,function(){ia(d)})});F(a,"copy",b);F(a,"cut",b)},prepareSelection:function(){var a=fe(this.cm,!1);a.focus=this.cm.state.focused;return a},showSelection:function(a){a&&this.cm.display.view.length&&(a.focus&&this.showPrimarySelection(),this.showMultipleSelections(a))},showPrimarySelection:function(){var a=window.getSelection(),b=this.cm.doc.sel.primary(),c=ic(this.cm,a.anchorNode,a.anchorOffset),d=ic(this.cm,a.focusNode,a.focusOffset);if(!c||c.bad||!d||d.bad||0!=J(dc(c,d),b.from())||
0!=J(cc(c,d),b.to()))if(c=Wd(this.cm,b.from()),d=Wd(this.cm,b.to()),c||d){var f=this.cm.display.view,b=a.rangeCount&&a.getRangeAt(0);c?d||(d=f[f.length-1].measure,d=d.maps?d.maps[d.maps.length-1]:d.map,d={node:d[d.length-1],offset:d[d.length-2]-d[d.length-3]}):c={node:f[0].measure.map[2],offset:0};try{var g=Wa(c.node,c.offset,d.offset,d.node)}catch(h){}g&&(a.removeAllRanges(),a.addRange(g),b&&null==a.anchorNode?a.addRange(b):Oa&&this.startGracePeriod());this.rememberSelection()}},startGracePeriod:function(){var a=
this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){a.gracePeriod=!1;a.selectionChanged()&&a.cm.operation(function(){a.cm.curOp.selectionChanged=!0})},20)},showMultipleSelections:function(a){na(this.cm.display.cursorDiv,a.cursors);na(this.cm.display.selectionDiv,a.selection)},rememberSelection:function(){var a=window.getSelection();this.lastAnchorNode=a.anchorNode;this.lastAnchorOffset=a.anchorOffset;this.lastFocusNode=a.focusNode;this.lastFocusOffset=a.focusOffset},selectionInEditor:function(){var a=
window.getSelection();if(!a.rangeCount)return!1;a=a.getRangeAt(0).commonAncestorContainer;return Zc(this.div,a)},focus:function(){"nocursor"!=this.cm.options.readOnly&&this.div.focus()},blur:function(){this.div.blur()},getField:function(){return this.div},supportsTouch:function(){return!0},receivedFocus:function(){function a(){b.cm.state.focused&&(b.pollSelection(),b.polling.set(b.cm.options.pollInterval,a))}var b=this;this.selectionInEditor()?this.pollSelection():ja(this.cm,function(){b.cm.curOp.selectionChanged=
!0});this.polling.set(this.cm.options.pollInterval,a)},selectionChanged:function(){var a=window.getSelection();return a.anchorNode!=this.lastAnchorNode||a.anchorOffset!=this.lastAnchorOffset||a.focusNode!=this.lastFocusNode||a.focusOffset!=this.lastFocusOffset},pollSelection:function(){if(!this.composing&&!this.gracePeriod&&this.selectionChanged()){var a=window.getSelection(),b=this.cm;this.rememberSelection();var c=ic(b,a.anchorNode,a.anchorOffset),d=ic(b,a.focusNode,a.focusOffset);c&&d&&ja(b,function(){Z(b.doc,
za(c,d),Aa);if(c.bad||d.bad)b.curOp.selectionChanged=!0})}},pollContent:function(){var a=this.cm,b=a.display,c=a.doc.sel.primary(),d=c.from(),c=c.to();if(d.line<b.viewFrom||c.line>b.viewTo-1)return!1;var f;d.line==b.viewFrom||0==(f=Ua(a,d.line))?(d=R(b.view[0].line),f=b.view[0].node):(d=R(b.view[f].line),f=b.view[f-1].node.nextSibling);var g=Ua(a,c.line);g==b.view.length-1?(c=b.viewTo-1,b=b.lineDiv.lastChild):(c=R(b.view[g+1].line)-1,b=b.view[g+1].node.previousSibling);b=a.doc.splitLines(uf(a,f,b,
d,c));for(f=Va(a.doc,z(d,0),z(c,B(a.doc,c).text.length));1<b.length&&1<f.length;)if(P(b)==P(f))b.pop(),f.pop(),c--;else if(b[0]==f[0])b.shift(),f.shift(),d++;else break;for(var h=0,g=0,m=b[0],p=f[0],q=Math.min(m.length,p.length);h<q&&m.charCodeAt(h)==p.charCodeAt(h);)++h;m=P(b);p=P(f);for(q=Math.min(m.length-(1==b.length?h:0),p.length-(1==f.length?h:0));g<q&&m.charCodeAt(m.length-g-1)==p.charCodeAt(p.length-g-1);)++g;b[b.length-1]=m.slice(0,m.length-g);b[0]=b[0].slice(h);d=z(d,h);c=z(c,f.length?P(f).length-
g:0);if(1<b.length||b[0]||J(d,c))return nb(a.doc,b,d,c,"+input"),!0},ensurePolled:function(){this.forceCompositionEnd()},reset:function(){this.forceCompositionEnd()},forceCompositionEnd:function(){this.composing&&!this.composing.handled&&(this.applyComposition(this.composing),this.composing.handled=!0,this.div.blur(),this.div.focus())},applyComposition:function(a){a.data&&a.data!=a.startData&&V(this.cm,fc)(this.cm,a.data,0,a.sel)},setUneditable:function(a){a.setAttribute("contenteditable","false")},
onKeyPress:function(a){a.preventDefault();V(this.cm,fc)(this.cm,String.fromCharCode(null==a.charCode?a.keyCode:a.charCode),0)},onContextMenu:Ub,resetPosition:Ub,needsContentAttribute:!0},Xc.prototype);c.inputStyles={textarea:Wc,contenteditable:Xc};Ea.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=a.ranges[b];
if(0!=J(c.anchor,d.anchor)||0!=J(c.head,d.head))return!1}return!0},deepCopy:function(){for(var a=[],b=0;b<this.ranges.length;b++)a[b]=new T(Vc(this.ranges[b].anchor),Vc(this.ranges[b].head));return new Ea(a,this.primIndex)},somethingSelected:function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1},contains:function(a,b){b||(b=a);for(var c=0;c<this.ranges.length;c++){var d=this.ranges[c];if(0<=J(b,d.from())&&0>=J(a,d.to()))return c}return-1}};T.prototype={from:function(){return dc(this.anchor,
this.head)},to:function(){return cc(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var dd={left:0,right:0,top:0,bottom:0},Xa,lb=null,Cf=0,wc,vc,qe=0,xc=0,ka=null;M?ka=-.53:Oa?ka=15:hg?ka=-.7:re&&(ka=-1/3);var xe=function(a){var b=a.wheelDeltaX,c=a.wheelDeltaY;null==b&&a.detail&&a.axis==a.HORIZONTAL_AXIS&&(b=a.detail);null==c&&a.detail&&a.axis==a.VERTICAL_AXIS?c=a.detail:null==c&&(c=a.wheelDelta);return{x:b,y:c}};c.wheelEventPixels=
function(a){a=xe(a);a.x*=ka;a.y*=ka;return a};var Nf=new vb,pd=null,Ya=c.changeEnd=function(a){return a.text?z(a.from.line+a.text.length-1,P(a.text).length+(1==a.text.length?a.from.ch:0)):a.to};c.prototype={constructor:c,focus:function(){window.focus();this.display.input.focus()},setOption:function(a,b){var c=this.options,d=c[a];if(c[a]!=b||"mode"==a)c[a]=b,cb.hasOwnProperty(a)&&V(this,cb[a])(this,b,d)},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,
b){this.state.keyMaps[b?"push":"unshift"](Gc(a))},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==a||b[c].name==a)return b.splice(c,1),!0},addOverlay:ba(function(a,b){var d=a.token?a:c.getMode(this.options,a);if(d.startState)throw Error("Overlays may not be stateful.");this.state.overlays.push({mode:d,modeSpec:a,opaque:b&&b.opaque});this.state.modeGen++;ia(this)}),removeOverlay:ba(function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var d=b[c].modeSpec;if(d==
a||"string"==typeof a&&d.name==a){b.splice(c,1);this.state.modeGen++;ia(this);break}}}),indentLine:ba(function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract");Hb(this.doc,a)&&Gb(this,a,b,c)}),indentSelection:ba(function(a){for(var b=this.doc.sel.ranges,c=-1,d=0;d<b.length;d++){var f=b[d];if(f.empty())f.head.line>c&&(Gb(this,f.head.line,a,!0),c=f.head.line,d==this.doc.sel.primIndex&&hb(this));else{for(var g=f.from(),f=f.to(),h=Math.max(c,
g.line),c=Math.min(this.lastLine(),f.line-(f.ch?0:1))+1,f=h;f<c;++f)Gb(this,f,a);f=this.doc.sel.ranges;0==g.ch&&b.length==f.length&&0<f[d].from().ch&&$c(this.doc,d,new T(g,f[d].to()),Aa)}}}),getTokenAt:function(a,b){return We(this,a,b)},getLineTokens:function(a,b){return We(this,z(a),b,!0)},getTokenTypeAt:function(a){a=I(this.doc,a);var b=Ye(this,B(this.doc,a.line)),c=0,d=(b.length-1)/2;a=a.ch;var f;if(0==a)f=b[2];else for(;;){var g=c+d>>1;if((g?b[2*g-1]:0)>=a)d=g;else if(b[2*g+1]<a)c=g+1;else{f=
b[2*g+2];break}}b=f?f.indexOf("cm-overlay "):-1;return 0>b?f:0==b?null:f.slice(0,b-1)},getModeAt:function(a){var b=this.doc.mode;return b.innerMode?c.innerMode(b,this.getTokenAt(a).state).mode:b},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var c=[];if(!tb.hasOwnProperty(b))return c;var d=tb[b],f=this.getModeAt(a);if("string"==typeof f[b])d[f[b]]&&c.push(d[f[b]]);else if(f[b])for(var g=0;g<f[b].length;g++){var h=d[f[b][g]];h&&c.push(h)}else f.helperType&&d[f.helperType]?
c.push(d[f.helperType]):d[f.name]&&c.push(d[f.name]);for(g=0;g<d._global.length;g++)h=d._global[g],h.pred(f,this)&&-1==ca(c,h.val)&&c.push(h.val);return c},getStateAfter:function(a,b){var c=this.doc;a=Math.max(c.first,Math.min(null==a?c.first+c.size-1:a,c.first+c.size-1));return Jb(this,a+1,b)},cursorCoords:function(a,b){var c;c=this.doc.sel.primary();c=null==a?c.head:"object"==typeof a?I(this.doc,a):a?c.from():c.to();return Fa(this,c,b||"page")},charCoords:function(a,b){return oc(this,I(this.doc,
a),b||"page")},coordsChar:function(a,b){a=le(this,a,b||"page");return id(this,a.left,a.top)},lineAtHeight:function(a,b){a=le(this,{top:a,left:0},b||"page").top;return Ta(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b){var c=!1,d;"number"==typeof a?(d=this.doc.first+this.doc.size-1,a<this.doc.first?a=this.doc.first:a>d&&(a=d,c=!0),d=B(this.doc,a)):d=a;return fd(this,d,{top:0,left:0},b||"page").top+(c?this.doc.height-xa(d):0)},defaultTextHeight:function(){return Pa(this.display)},defaultCharWidth:function(){return zb(this.display)},
setGutterMarker:ba(function(a,b,c){return Ec(this.doc,a,"gutter",function(a){var d=a.gutterMarkers||(a.gutterMarkers={});d[b]=c;!c&&ff(d)&&(a.gutterMarkers=null);return!0})}),clearGutter:ba(function(a){var b=this,c=b.doc,d=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&(c.gutterMarkers[a]=null,Ga(b,d,"gutter"),ff(c.gutterMarkers)&&(c.gutterMarkers=null));++d})}),lineInfo:function(a){if("number"==typeof a){if(!Hb(this.doc,a))return null;var b=a;a=B(this.doc,a);if(!a)return null}else if(b=
R(a),null==b)return null;return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,d,f){var g=this.display;a=Fa(this,I(this.doc,a));var h=a.bottom,m=a.left;b.style.position="absolute";b.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(b);g.sizer.appendChild(b);if("over"==d)h=a.top;
else if("above"==d||"near"==d){var p=Math.max(g.wrapper.clientHeight,this.doc.height),q=Math.max(g.sizer.clientWidth,g.lineSpace.clientWidth);("above"==d||a.bottom+b.offsetHeight>p)&&a.top>b.offsetHeight?h=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=p&&(h=a.bottom);m+b.offsetWidth>q&&(m=q-b.offsetWidth)}b.style.top=h+"px";b.style.left=b.style.right="";"right"==f?(m=g.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==f?m=0:"middle"==f&&(m=(g.sizer.clientWidth-b.offsetWidth)/2),b.style.left=
m+"px");c&&(a=tc(this,m,h,m+b.offsetWidth,h+b.offsetHeight),null!=a.scrollTop&&Cb(this,a.scrollTop),null!=a.scrollLeft&&eb(this,a.scrollLeft))},triggerOnKeyDown:ba(te),triggerOnKeyPress:ba(ue),triggerOnKeyUp:se,execCommand:function(a){if(zc.hasOwnProperty(a))return zc[a].call(null,this)},triggerElectric:ba(function(a){Rd(this,a)}),findPosH:function(a,b,c,d){var f=1;0>b&&(f=-1,b=-b);var g=0;for(a=I(this.doc,a);g<b&&(a=ud(this.doc,a,f,c,d),!a.hitSide);++g);return a},moveH:ba(function(a,b){var c=this;
c.extendSelectionsBy(function(d){return c.display.shift||c.doc.extend||d.empty()?ud(c.doc,d.head,a,b,c.options.rtlMoveVisually):0>a?d.from():d.to()},Wb)}),deleteH:ba(function(a,b){var c=this.doc;this.doc.sel.somethingSelected()?c.replaceSelection("",null,"+delete"):ob(this,function(d){var f=ud(c,d.head,a,b,!1);return 0>a?{from:f,to:d.head}:{from:d.head,to:f}})}),findPosV:function(a,b,c,d){var f=1;0>b&&(f=-1,b=-b);var g=0;for(a=I(this.doc,a);g<b&&(a=Fa(this,a,"div"),null==d?d=a.left:a.left=d,a=Ne(this,
a,f,c),!a.hitSide);++g);return a},moveV:ba(function(a,b){var c=this,d=this.doc,f=[],g=!c.display.shift&&!d.extend&&d.sel.somethingSelected();d.extendSelectionsBy(function(h){if(g)return 0>a?h.from():h.to();var m=Fa(c,h.head,"div");null!=h.goalColumn&&(m.left=h.goalColumn);f.push(m.left);var p=Ne(c,m,a,b);"page"==b&&h==d.sel.primary()&&Cc(c,null,oc(c,p,"div").top-m.top);return p},Wb);if(f.length)for(var h=0;h<d.sel.ranges.length;h++)d.sel.ranges[h].goalColumn=f[h]}),findWordAt:function(a){var b=B(this.doc,
a.line).text,c=a.ch,d=a.ch;if(b){var f=this.getHelper(a,"wordChars");(0>a.xRel||d==b.length)&&c?--c:++d;for(var g=b.charAt(c),g=Fc(g,f)?function(a){return Fc(a,f)}:/\s/.test(g)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!Fc(a)};0<c&&g(b.charAt(c-1));)--c;for(;d<b.length&&g(b.charAt(d));)++d}return new T(z(a.line,c),z(a.line,d))},toggleOverwrite:function(a){if(null==a||a!=this.state.overwrite)(this.state.overwrite=!this.state.overwrite)?Db(this.display.cursorDiv,"CodeMirror-overwrite"):
Bb(this.display.cursorDiv,"CodeMirror-overwrite"),X(this,"overwriteToggle",this,this.state.overwrite)},hasFocus:function(){return this.display.input.getField()==ya()},scrollTo:ba(function(a,b){null==a&&null==b||Dc(this);null!=a&&(this.curOp.scrollLeft=a);null!=b&&(this.curOp.scrollTop=b)}),getScrollInfo:function(){var a=this.display.scroller;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-wa(this)-this.display.barHeight,width:a.scrollWidth-wa(this)-this.display.barWidth,clientHeight:Sc(this),
clientWidth:Ia(this)}},scrollIntoView:ba(function(a,b){null==a?(a={from:this.doc.sel.primary().head,to:null},null==b&&(b=this.options.cursorScrollMargin)):"number"==typeof a?a={from:z(a,0),to:null}:null==a.from&&(a={from:a,to:null});a.to||(a.to=a.from);a.margin=b||0;if(null!=a.from.line)Dc(this),this.curOp.scrollToPos=a;else{var c=tc(this,Math.min(a.from.left,a.to.left),Math.min(a.from.top,a.to.top)-a.margin,Math.max(a.from.right,a.to.right),Math.max(a.from.bottom,a.to.bottom)+a.margin);this.scrollTo(c.scrollLeft,
c.scrollTop)}}),setSize:ba(function(a,b){function c(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a}var d=this;null!=a&&(d.display.wrapper.style.width=c(a));null!=b&&(d.display.wrapper.style.height=c(b));d.options.lineWrapping&&ke(this);var f=d.display.viewFrom;d.doc.iter(f,d.display.viewTo,function(a){if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(a.widgets[b].noHScroll){Ga(d,f,"widget");break}++f});d.curOp.forceUpdate=!0;X(d,"refresh",this)}),operation:function(a){return ja(this,
a)},refresh:ba(function(){var a=this.display.cachedTextHeight;ia(this);this.curOp.forceUpdate=!0;Ab(this);this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop);s(this);(null==a||.5<Math.abs(a-Pa(this.display)))&&g(this);X(this,"refresh",this)}),swapDoc:ba(function(a){var b=this.doc;b.cm=null;Ed(this,a);Ab(this);this.display.input.reset();this.scrollTo(a.scrollLeft,a.scrollTop);this.curOp.forceScroll=!0;da(this,"swapDoc",this,b);return b}),getInputField:function(){return this.display.input.getField()},
getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};rb(c);var of=c.defaults={},cb=c.optionHandlers={},Fd=c.Init={toString:function(){return"CodeMirror.Init"}};G("value","",function(a,b){a.setValue(b)},!0);G("mode",null,function(a,c){a.doc.modeOption=c;b(a)},!0);G("indentUnit",2,b,!0);G("indentWithTabs",!1);G("smartIndent",!0);G("tabSize",4,function(a){d(a);Ab(a);ia(a)},!0);G("lineSeparator",
null,function(a,b){if(a.doc.lineSep=b){var c=[],d=a.doc.first;a.doc.iter(function(a){for(var f=0;;){var g=a.text.indexOf(b,f);if(-1==g)break;f=g+b.length;c.push(z(d,g))}d++});for(var f=c.length-1;0<=f;f--)nb(a.doc,b,c[f],z(c[f].line,c[f].ch+b.length))}});G("specialChars",/[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g,function(a,b,d){a.state.specialChars=new RegExp(b.source+(b.test("\t")?"":"|\t"),"g");d!=c.Init&&a.refresh()});G("specialCharPlaceholder",function(a){var b=C("span","\u2022",
"cm-invalidchar");b.title="\\u"+a.charCodeAt(0).toString(16);b.setAttribute("aria-label",b.title);return b},function(a){a.refresh()},!0);G("electricChars",!0);G("inputStyle",ub?"contenteditable":"textarea",function(){throw Error("inputStyle can not (yet) be changed in a running editor");},!0);G("rtlMoveVisually",!jg);G("wholeLineUpdateBefore",!0);G("theme","default",function(a){h(a);m(a)},!0);G("keyMap","default",function(a,b,d){b=Gc(b);(d=d!=c.Init&&Gc(d))&&d.detach&&d.detach(a,b);b.attach&&b.attach(a,
d||null)});G("extraKeys",null);G("lineWrapping",!1,function(a){a.options.lineWrapping?(Db(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth="",a.display.sizerWidth=null):(Bb(a.display.wrapper,"CodeMirror-wrap"),x(a));g(a);ia(a);Ab(a);setTimeout(function(){A(a)},100)},!0);G("gutters",[],function(a){t(a.options);m(a)},!0);G("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?N(a.display)+"px":"0";a.refresh()},!0);G("coverGutterNextToScrollbar",!1,function(a){A(a)},!0);G("scrollbarStyle",
"native",function(a){u(a);A(a);a.display.scrollbars.setScrollTop(a.doc.scrollTop);a.display.scrollbars.setScrollLeft(a.doc.scrollLeft)},!0);G("lineNumbers",!1,function(a){t(a.options);m(a)},!0);G("firstLineNumber",1,m,!0);G("lineNumberFormatter",function(a){return a},m,!0);G("showCursorWhenSelecting",!1,Eb,!0);G("resetSelectionOnContextMenu",!0);G("lineWiseCopyCut",!0);G("readOnly",!1,function(a,b){"nocursor"==b?(xb(a),a.display.input.blur(),a.display.disabled=!0):(a.display.disabled=!1,b||a.display.input.reset())});
G("disableInput",!1,function(a,b){b||a.display.input.reset()},!0);G("dragDrop",!0,function(a,b,d){!b!=!(d&&d!=c.Init)&&(d=a.display.dragFunctions,b=b?F:Da,b(a.display.scroller,"dragstart",d.start),b(a.display.scroller,"dragenter",d.simple),b(a.display.scroller,"dragover",d.simple),b(a.display.scroller,"drop",d.drop))});G("cursorBlinkRate",530);G("cursorScrollMargin",0);G("cursorHeight",1,Eb,!0);G("singleCursorHeightPerLine",!0,Eb,!0);G("workTime",100);G("workDelay",100);G("flattenSpans",!0,d,!0);
G("addModeClass",!1,d,!0);G("pollInterval",100);G("undoDepth",200,function(a,b){a.doc.history.undoDepth=b});G("historyEventDelay",1250);G("viewportMargin",10,function(a){a.refresh()},!0);G("maxHighlightLength",1E4,d,!0);G("moveInputWithCursor",!0,function(a,b){b||a.display.input.resetPosition()});G("tabindex",null,function(a,b){a.display.input.getField().tabIndex=b||""});G("autofocus",null);var nf=c.modes={},Xb=c.mimeModes={};c.defineMode=function(a,b){c.defaults.mode||"null"==a||(c.defaults.mode=
a);2<arguments.length&&(b.dependencies=Array.prototype.slice.call(arguments,2));nf[a]=b};c.defineMIME=function(a,b){Xb[a]=b};c.resolveMode=function(a){if("string"==typeof a&&Xb.hasOwnProperty(a))a=Xb[a];else if(a&&"string"==typeof a.name&&Xb.hasOwnProperty(a.name)){var b=Xb[a.name];"string"==typeof b&&(b={name:b});a=df(b,a);a.name=b.name}else if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a))return c.resolveMode("application/xml");return"string"==typeof a?{name:a}:a||{name:"null"}};c.getMode=
function(a,b){b=c.resolveMode(b);var d=nf[b.name];if(!d)return c.getMode(a,"text/plain");d=d(a,b);if(Yb.hasOwnProperty(b.name)){var f=Yb[b.name],g;for(g in f)f.hasOwnProperty(g)&&(d.hasOwnProperty(g)&&(d["_"+g]=d[g]),d[g]=f[g])}d.name=b.name;b.helperType&&(d.helperType=b.helperType);if(b.modeProps)for(g in b.modeProps)d[g]=b.modeProps[g];return d};c.defineMode("null",function(){return{token:function(a){a.skipToEnd()}}});c.defineMIME("text/plain","null");var Yb=c.modeExtensions={};c.extendMode=function(a,
b){var c=Yb.hasOwnProperty(a)?Yb[a]:Yb[a]={};oa(b,c)};c.defineExtension=function(a,b){c.prototype[a]=b};c.defineDocExtension=function(a,b){ha.prototype[a]=b};c.defineOption=G;var Oc=[];c.defineInitHook=function(a){Oc.push(a)};var tb=c.helpers={};c.registerHelper=function(a,b,d){tb.hasOwnProperty(a)||(tb[a]=c[a]={_global:[]});tb[a][b]=d};c.registerGlobalHelper=function(a,b,d,f){c.registerHelper(a,b,f);tb[a]._global.push({pred:d,val:f})};var kb=c.copyState=function(a,b){if(!0===b)return b;if(a.copyState)return a.copyState(b);
var c={},d;for(d in b){var f=b[d];f instanceof Array&&(f=f.concat([]));c[d]=f}return c},Af=c.startState=function(a,b,c){return a.startState?a.startState(b,c):!0};c.innerMode=function(a,b){for(;a.innerMode;){var c=a.innerMode(b);if(!c||c.mode==a)break;b=c.state;a=c.mode}return c||{mode:a,state:b}};var zc=c.commands={selectAll:function(a){a.setSelection(z(a.firstLine(),0),z(a.lastLine()),Aa)},singleSelection:function(a){a.setSelection(a.getCursor("anchor"),a.getCursor("head"),Aa)},killLine:function(a){ob(a,
function(b){if(b.empty()){var c=B(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?{from:b.head,to:z(b.head.line+1,0)}:{from:b.head,to:z(b.head.line,c)}}return{from:b.from(),to:b.to()}})},deleteLine:function(a){ob(a,function(b){return{from:z(b.from().line,0),to:I(a.doc,z(b.to().line+1,0))}})},delLineLeft:function(a){ob(a,function(a){return{from:z(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){ob(a,function(b){var c=a.charCoords(b.head,"div").top+5;return{from:a.coordsChar({left:0,
top:c},"div"),to:b.from()}})},delWrappedLineRight:function(a){ob(a,function(b){var c=a.charCoords(b.head,"div").top+5,c=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div");return{from:b.from(),to:c}})},undo:function(a){a.undo()},redo:function(a){a.redo()},undoSelection:function(a){a.undoSelection()},redoSelection:function(a){a.redoSelection()},goDocStart:function(a){a.extendSelection(z(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(z(a.lastLine()))},goLineStart:function(a){a.extendSelectionsBy(function(b){return hf(a,
b.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(a){a.extendSelectionsBy(function(b){return jf(a,b.head)},{origin:"+move",bias:1})},goLineEnd:function(a){a.extendSelectionsBy(function(b){b=b.head.line;for(var c,d=B(a.doc,b);c=Sa(d,!1);)d=c.find(1,!0).line,b=null;c=(c=ra(d))?c[0].level%2?rc(d):sc(d):d.text.length;return z(null==b?R(d):b,c)},{origin:"+move",bias:-1})},goLineRight:function(a){a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+
100,top:b},"div")},Wb)},goLineLeft:function(a){a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:0,top:b},"div")},Wb)},goLineLeftSmart:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5,c=a.coordsChar({left:0,top:c},"div");return c.ch<a.getLine(c.line).search(/\S/)?jf(a,b.head):c},Wb)},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,
"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,"char")},goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,"word")},goGroupRight:function(a){a.moveH(1,"group")},goGroupLeft:function(a){a.moveH(-1,"group")},goWordRight:function(a){a.moveH(1,"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},
delWordAfter:function(a){a.deleteH(1,"word")},delGroupBefore:function(a){a.deleteH(-1,"group")},delGroupAfter:function(a){a.deleteH(1,"group")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("\t")},insertSoftTab:function(a){for(var b=[],c=a.listSelections(),d=a.options.tabSize,f=0;f<c.length;f++){var g=c[f].from(),g=ta(a.getLine(g.line),g.ch,d);b.push(Array(d-
g%d+1).join(" "))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){ja(a,function(){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++){var f=b[d].head,g=B(a.doc,f.line).text;if(g)if(f.ch==g.length&&(f=new z(f.line,f.ch-1)),0<f.ch)f=new z(f.line,f.ch+1),a.replaceRange(g.charAt(f.ch-1)+g.charAt(f.ch-2),z(f.line,f.ch-2),f,"+transpose");else if(f.line>a.doc.first){var h=B(a.doc,f.line-1).text;h&&a.replaceRange(g.charAt(0)+
a.doc.lineSeparator()+h.charAt(h.length-1),z(f.line-1,h.length-1),z(f.line,1),"+transpose")}c.push(new T(f,f))}a.setSelections(c)})},newlineAndIndent:function(a){ja(a,function(){for(var b=a.listSelections().length,c=0;c<b;c++){var d=a.listSelections()[c];a.replaceRange(a.doc.lineSeparator(),d.anchor,d.head,"+input");a.indentLine(d.from().line+1,null,!0);hb(a)}})},toggleOverwrite:function(a){a.toggleOverwrite()}},Ma=c.keyMap={};Ma.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",
End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"};Ma.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft",
"Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"};Ma.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown",
"Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"};Ma.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft",
"Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",
fallthrough:["basic","emacsy"]};Ma["default"]=qa?Ma.macDefault:Ma.pcDefault;c.normalizeKeyMap=function(a){var b={},c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!/^(name|fallthrough|(de|at)tach)$/.test(c)){if("..."!=d)for(var f=gc(c.split(" "),Tf),g=0;g<f.length;g++){var h,m;g==f.length-1?(m=f.join(" "),h=d):(m=f.slice(0,g+1).join(" "),h="...");var p=b[m];if(!p)b[m]=h;else if(p!=h)throw Error("Inconsistent bindings for "+m);}delete a[c]}}for(var q in b)a[q]=b[q];return a};var Nb=c.lookupKey=
function(a,b,c,d){b=Gc(b);var f=b.call?b.call(a,d):b[a];if(!1===f)return"nothing";if("..."===f)return"multi";if(null!=f&&c(f))return"handled";if(b.fallthrough){if("[object Array]"!=Object.prototype.toString.call(b.fallthrough))return Nb(a,b.fallthrough,c,d);for(f=0;f<b.fallthrough.length;f++){var g=Nb(a,b.fallthrough[f],c,d);if(g)return g}}},Mf=c.isModifierKey=function(a){a="string"==typeof a?a:Na[a.keyCode];return"Ctrl"==a||"Alt"==a||"Shift"==a||"Mod"==a},Of=c.keyName=function(a,b){if(ua&&34==a.keyCode&&
a["char"])return!1;var c=Na[a.keyCode],d=c;if(null==d||a.altGraphKey)return!1;a.altKey&&"Alt"!=c&&(d="Alt-"+d);(mf?a.metaKey:a.ctrlKey)&&"Ctrl"!=c&&(d="Ctrl-"+d);(mf?a.ctrlKey:a.metaKey)&&"Cmd"!=c&&(d="Cmd-"+d);!b&&a.shiftKey&&"Shift"!=c&&(d="Shift-"+d);return d};c.fromTextArea=function(a,b){function d(){a.value=q.getValue()}b=b?oa(b):{};b.value=a.value;!b.tabindex&&a.tabIndex&&(b.tabindex=a.tabIndex);!b.placeholder&&a.placeholder&&(b.placeholder=a.placeholder);if(null==b.autofocus){var f=ya();b.autofocus=
f==a||null!=a.getAttribute("autofocus")&&f==document.body}if(a.form&&(F(a.form,"submit",d),!b.leaveSubmitMethodAlone)){var g=a.form,h=g.submit;try{var m=g.submit=function(){d();g.submit=h;g.submit();g.submit=m}}catch(p){}}b.finishInit=function(b){b.save=d;b.getTextArea=function(){return a};b.toTextArea=function(){b.toTextArea=isNaN;d();a.parentNode.removeChild(b.getWrapperElement());a.style.display="";a.form&&(Da(a.form,"submit",d),"function"==typeof a.form.submit&&(a.form.submit=h))}};a.style.display=
"none";var q=c(function(b){a.parentNode.insertBefore(b,a.nextSibling)},b);return q};var Kc=c.StringStream=function(a,b){this.pos=this.start=0;this.string=a;this.tabSize=b||8;this.lineStart=this.lastColumnPos=this.lastColumnValue=0};Kc.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(a){var b=
this.string.charAt(this.pos);if("string"==typeof a?b==a:b&&(a.test?a.test(b):a(b)))return++this.pos,b},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){a=this.string.indexOf(a,this.pos);if(-1<a)return this.pos=a,!0},backUp:function(a){this.pos-=a},column:function(){this.lastColumnPos<this.start&&
(this.lastColumnValue=ta(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start);return this.lastColumnValue-(this.lineStart?ta(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return ta(this.string,null,this.tabSize)-(this.lineStart?ta(this.string,this.lineStart,this.tabSize):0)},match:function(a,b,c){if("string"==typeof a){var d=function(a){return c?a.toLowerCase():a},f=this.string.substr(this.pos,a.length);if(d(f)==d(a))return!1!==
b&&(this.pos+=a.length),!0}else{if((a=this.string.slice(this.pos).match(a))&&0<a.index)return null;a&&!1!==b&&(this.pos+=a[0].length);return a}},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}}};var vd=0,$a=c.TextMarker=function(a,b){this.lines=[];this.type=b;this.doc=a;this.id=++vd};rb($a);$a.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;b&&bb(a);if(ma(this,
"clear")){var c=this.find();c&&da(this,"clear",c.from,c.to)}for(var d=c=null,f=0;f<this.lines.length;++f){var g=this.lines[f],h=Pb(g.markedSpans,this);a&&!this.collapsed?Ga(a,R(g),"text"):a&&(null!=h.to&&(d=R(g)),null!=h.from&&(c=R(g)));for(var m=g,p=g.markedSpans,q=h,r=void 0,s=0;s<p.length;++s)p[s]!=q&&(r||(r=[])).push(p[s]);m.markedSpans=r;null==h.from&&this.collapsed&&!Qa(this.doc,g)&&a&&va(g,Pa(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(f=0;f<this.lines.length;++f)g=Ba(this.lines[f]),
h=v(g),h>a.display.maxLineLength&&(a.display.maxLine=g,a.display.maxLineLength=h,a.display.maxLineChanged=!0);null!=c&&a&&this.collapsed&&ia(a,c,d+1);this.lines.length=0;this.explicitlyCleared=!0;this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&ee(a.doc));a&&da(a,"markerCleared",a,this);b&&db(a);this.parent&&this.parent.clear()}};$a.prototype.find=function(a,b){null==a&&"bookmark"==this.type&&(a=1);for(var c,d,f=0;f<this.lines.length;++f){var g=this.lines[f],h=Pb(g.markedSpans,this);if(null!=
h.from&&(c=z(b?g:R(g),h.from),-1==a))return c;if(null!=h.to&&(d=z(b?g:R(g),h.to),1==a))return d}return c&&{from:c,to:d}};$a.prototype.changed=function(){var a=this.find(-1,!0),b=this,c=this.doc.cm;a&&c&&ja(c,function(){var d=a.line,f=R(a.line);if(f=Yc(c,f))je(f),c.curOp.selectionChanged=c.curOp.forceUpdate=!0;c.curOp.updateMaxLine=!0;Qa(b.doc,d)||null==b.height||(f=b.height,b.height=null,(f=Lb(b)-f)&&va(d,d.height+f))})};$a.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=
this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=ca(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)};$a.prototype.detachLine=function(a){this.lines.splice(ca(this.lines,a),1);!this.lines.length&&this.doc.cm&&(a=this.doc.cm.curOp,(a.maybeHiddenMarkers||(a.maybeHiddenMarkers=[])).push(this))};var vd=0,Ic=c.SharedTextMarker=function(a,b){this.markers=a;this.primary=b;for(var c=0;c<a.length;++c)a[c].parent=this};rb(Ic);Ic.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=
!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();da(this,"clear")}};Ic.prototype.find=function(a,b){return this.primary.find(a,b)};var Jc=c.LineWidget=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.doc=a;this.node=b};rb(Jc);Jc.prototype.clear=function(){var a=this.doc.cm,b=this.line.widgets,c=this.line,d=R(c);if(null!=d&&b){for(var f=0;f<b.length;++f)b[f]==this&&b.splice(f--,1);b.length||(c.widgets=null);var g=Lb(this);va(c,Math.max(0,c.height-g));a&&
ja(a,function(){var b=-g;xa(c)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&Cc(a,null,b);Ga(a,d,"widget")})}};Jc.prototype.changed=function(){var a=this.height,b=this.doc.cm,c=this.line;this.height=null;var d=Lb(this)-a;d&&(va(c,c.height+d),b&&ja(b,function(){b.curOp.forceUpdate=!0;xa(c)<(b.curOp&&b.curOp.scrollTop||b.doc.scrollTop)&&Cc(b,null,d)}))};var Qb=c.Line=function(a,b,c){this.text=a;Se(this,b);this.height=c?c(this):1};rb(Qb);Qb.prototype.lineNo=function(){return R(this)};var Zf={},Yf={};
Rb.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,d=a+b;c<d;++c){var f=this.lines[c];this.height-=f.height;var g=f;g.parent=null;Re(g);da(f,"delete")}this.lines.splice(a,b)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,b,c){this.height+=c;this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));for(a=0;a<b.length;++a)b[a].parent=this},iterN:function(a,b,c){for(b=a+b;a<b;++a)if(c(this.lines[a]))return!0}};Sb.prototype=
{chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var d=this.children[c],f=d.chunkSize();if(a<f){var g=Math.min(b,f-a),h=d.height;d.removeInner(a,g);this.height-=h-d.height;f==g&&(this.children.splice(c--,1),d.parent=null);if(0==(b-=g))break;a=0}else a-=f}25>this.size-b&&(1<this.children.length||!(this.children[0]instanceof Rb))&&(c=[],this.collapse(c),this.children=[new Rb(c)],this.children[0].parent=this)},collapse:function(a){for(var b=
0;b<this.children.length;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length;this.height+=c;for(var d=0;d<this.children.length;++d){var f=this.children[d],g=f.chunkSize();if(a<=g){f.insertInner(a,b,c);if(f.lines&&50<f.lines.length){for(;50<f.lines.length;)a=f.lines.splice(f.lines.length-25,25),a=new Rb(a),f.height-=a.height,this.children.splice(d+1,0,a),a.parent=this;this.maybeSpill()}break}a-=g}},maybeSpill:function(){if(!(10>=this.children.length)){var a=this;do{var b=
a.children.splice(a.children.length-5,5),b=new Sb(b);if(a.parent){a.size-=b.size;a.height-=b.height;var c=ca(a.parent.children,a);a.parent.children.splice(c+1,0,b)}else c=new Sb(a.children),c.parent=a,a.children=[c,b],a=c;b.parent=a.parent}while(10<a.children.length);a.parent.maybeSpill()}},iterN:function(a,b,c){for(var d=0;d<this.children.length;++d){var f=this.children[d],g=f.chunkSize();if(a<g){g=Math.min(b,g-a);if(f.iterN(a,g,c))return!0;if(0==(b-=g))break;a=0}else a-=g}}};var lg=0,ha=c.Doc=function(a,
b,c,d){if(!(this instanceof ha))return new ha(a,b,c,d);null==c&&(c=0);Sb.call(this,[new Rb([new Qb("",null)])]);this.first=c;this.scrollTop=this.scrollLeft=0;this.cantEdit=!1;this.cleanGeneration=1;this.frontier=c;c=z(c,0);this.sel=za(c);this.history=new Lc(null);this.id=++lg;this.modeOption=b;this.lineSep=d;"string"==typeof a&&(a=this.splitLines(a));td(this,{from:c,to:c,text:a});Z(this,za(c),Aa)};ha.prototype=df(Sb.prototype,{constructor:ha,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,
this.first+this.size,a)},insert:function(a,b){for(var c=0,d=0;d<b.length;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=Ad(this,this.first,this.first+this.size);return!1===a?b:b.join(a||this.lineSeparator())},setValue:ea(function(a){var b=z(this.first,0),c=this.first+this.size-1;gb(this,{from:b,to:z(c,B(this,c).text.length),text:this.splitLines(a),origin:"setValue",full:!0},!0);Z(this,za(b))}),replaceRange:function(a,
b,c,d){b=I(this,b);c=c?I(this,c):b;nb(this,a,b,c,d)},getRange:function(a,b,c){a=Va(this,I(this,a),I(this,b));return!1===c?a:a.join(c||this.lineSeparator())},getLine:function(a){return(a=this.getLineHandle(a))&&a.text},getLineHandle:function(a){if(Hb(this,a))return B(this,a)},getLineNumber:function(a){return R(a)},getLineHandleVisualStart:function(a){"number"==typeof a&&(a=B(this,a));return Ba(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+
this.size-1},clipPos:function(a){return I(this,a)},getCursor:function(a){var b=this.sel.primary();return null==a||"head"==a?b.head:"anchor"==a?b.anchor:"end"==a||"to"==a||!1===a?b.to():b.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:ea(function(a,b,c){a=I(this,"number"==typeof a?z(a,b||0):a);Z(this,za(a,null),c)}),setSelection:ea(function(a,b,c){var d=I(this,a);a=I(this,b||a);Z(this,za(d,a),c)}),extendSelection:ea(function(a,
b,c){jc(this,I(this,a),b&&I(this,b),c)}),extendSelections:ea(function(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=I(this,a[d]);Zd(this,c)}),extendSelectionsBy:ea(function(a,b){Zd(this,gc(this.sel.ranges,a),b)}),setSelections:ea(function(a,b,c){if(a.length){for(var d=0,f=[];d<a.length;d++)f[d]=new T(I(this,a[d].anchor),I(this,a[d].head));null==b&&(b=Math.min(a.length-1,this.sel.primIndex));Z(this,sa(f,b),c)}}),addSelection:ea(function(a,b,c){var d=this.sel.ranges.slice(0);d.push(new T(I(this,a),I(this,
b||a)));Z(this,sa(d,d.length-1),c)}),getSelection:function(a){for(var b=this.sel.ranges,c,d=0;d<b.length;d++){var f=Va(this,b[d].from(),b[d].to());c=c?c.concat(f):f}return!1===a?c:c.join(a||this.lineSeparator())},getSelections:function(a){for(var b=[],c=this.sel.ranges,d=0;d<c.length;d++){var f=Va(this,c[d].from(),c[d].to());!1!==a&&(f=f.join(a||this.lineSeparator()));b[d]=f}return b},replaceSelection:function(a,b,c){for(var d=[],f=0;f<this.sel.ranges.length;f++)d[f]=a;this.replaceSelections(d,b,
c||"+input")},replaceSelections:ea(function(a,b,c){for(var d=[],f=this.sel,g=0;g<f.ranges.length;g++){var h=f.ranges[g];d[g]={from:h.from(),to:h.to(),text:this.splitLines(a[g]),origin:c}}if(g=b&&"end"!=b){g=[];c=a=z(this.first,0);for(f=0;f<d.length;f++){var m=d[f],h=Ce(m.from,a,c),p=Ce(Ya(m),a,c);a=m.to;c=p;"around"==b?(m=this.sel.ranges[f],m=0>J(m.head,m.anchor),g[f]=new T(m?p:h,m?h:p)):g[f]=new T(h,h)}g=new Ea(g,this.sel.primIndex)}b=g;for(g=d.length-1;0<=g;g--)gb(this,d[g]);b?$d(this,b):this.cm&&
hb(this.cm)}),undo:ea(function(){Bc(this,"undo")}),redo:ea(function(){Bc(this,"redo")}),undoSelection:ea(function(){Bc(this,"undo",!0)}),redoSelection:ea(function(){Bc(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,b=0,c=0,d=0;d<a.done.length;d++)a.done[d].ranges||++b;for(d=0;d<a.undone.length;d++)a.undone[d].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=new Lc(this.history.maxGeneration)},
markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null);return this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:qb(this.history.done),undone:qb(this.history.undone)}},setHistory:function(a){var b=this.history=new Lc(this.history.maxGeneration);b.done=qb(a.done.slice(0),null,!0);b.undone=qb(a.undone.slice(0),
null,!0)},addLineClass:ea(function(a,b,c){return Ec(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass";if(a[d]){if(Vb(c).test(a[d]))return!1;a[d]+=" "+c}else a[d]=c;return!0})}),removeLineClass:ea(function(a,b,c){return Ec(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass",f=a[d];if(f)if(null==c)a[d]=null;else{var g=f.match(Vb(c));
if(!g)return!1;var h=g.index+g[0].length;a[d]=f.slice(0,g.index)+(g.index&&h!=f.length?" ":"")+f.slice(h)||null}else return!1;return!0})}),addLineWidget:ea(function(a,b,c){return Xf(this,a,b,c)}),removeLineWidget:function(a){a.clear()},markText:function(a,b,c){return pb(this,I(this,a),I(this,b),c,"range")},setBookmark:function(a,b){var c={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared,handleMouseEvents:b&&b.handleMouseEvents};a=I(this,
a);return pb(this,a,a,c,"bookmark")},findMarksAt:function(a){a=I(this,a);var b=[],c=B(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var f=c[d];(null==f.from||f.from<=a.ch)&&(null==f.to||f.to>=a.ch)&&b.push(f.marker.parent||f.marker)}return b},findMarks:function(a,b,c){a=I(this,a);b=I(this,b);var d=[],f=a.line;this.iter(a.line,b.line+1,function(g){if(g=g.markedSpans)for(var h=0;h<g.length;h++){var m=g[h];f==a.line&&a.ch>m.to||null==m.from&&f!=a.line||f==b.line&&m.from>b.ch||c&&!c(m.marker)||
d.push(m.marker.parent||m.marker)}++f});return d},getAllMarks:function(){var a=[];this.iter(function(b){if(b=b.markedSpans)for(var c=0;c<b.length;++c)null!=b[c].from&&a.push(b[c].marker)});return a},posFromIndex:function(a){var b,c=this.first;this.iter(function(d){d=d.text.length+1;if(d>a)return b=a,!0;a-=d;++c});return I(this,z(c,b))},indexFromPos:function(a){a=I(this,a);var b=a.ch;if(a.line<this.first||0>a.ch)return 0;this.iter(this.first,a.line,function(a){b+=a.text.length+1});return b},copy:function(a){var b=
new ha(Ad(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep);b.scrollTop=this.scrollTop;b.scrollLeft=this.scrollLeft;b.sel=this.sel;b.extend=!1;a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory()));return b},linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from);null!=a.to&&a.to<c&&(c=a.to);b=new ha(Ad(this,b,c),a.mode||this.modeOption,b,this.lineSep);a.sharedHist&&(b.history=this.history);(this.linked||
(this.linked=[])).push({doc:b,sharedHist:a.sharedHist});b.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}];a=Pe(this);for(c=0;c<a.length;c++){var d=a[c],f=d.find(),g=b.clipPos(f.from),f=b.clipPos(f.to);J(g,f)&&(g=pb(b,g,f,d.primary,d.primary.type),d.markers.push(g),g.parent=d)}return b},unlinkDoc:function(a){a instanceof c&&(a=a.doc);if(this.linked)for(var b=0;b<this.linked.length;++b)if(this.linked[b].doc==a){this.linked.splice(b,1);a.unlinkDoc(this);Vf(Pe(this));break}if(a.history==this.history){var d=
[a.id];Za(a,function(a){d.push(a.id)},!0);a.history=new Lc(null);a.history.done=qb(this.history.done,d);a.history.undone=qb(this.history.undone,d)}},iterLinkedDocs:function(a){Za(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(a){return this.lineSep?a.split(this.lineSep):mg(a)},lineSeparator:function(){return this.lineSep||"\n"}});ha.prototype.eachLine=ha.prototype.iter;var ng="iter insert remove copy getEditor constructor".split(" "),Zb;for(Zb in ha.prototype)ha.prototype.hasOwnProperty(Zb)&&
0>ca(ng,Zb)&&(c.prototype[Zb]=function(a){return function(){return a.apply(this.doc,arguments)}}(ha.prototype[Zb]));rb(ha);var fa=c.e_preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},og=c.e_stopPropagation=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},md=c.e_stop=function(a){fa(a);og(a)},F=c.on=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):(a=a._handlers||(a._handlers={}),(a[b]||(a[b]=[])).push(c))},
Da=c.off=function(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else if(a=a._handlers&&a._handlers[b])for(b=0;b<a.length;++b)if(a[b]==c){a.splice(b,1);break}},X=c.signal=function(a,b){var c=a._handlers&&a._handlers[b];if(c)for(var d=Array.prototype.slice.call(arguments,2),f=0;f<c.length;++f)c[f].apply(null,d)},Tb=null,Gd=30,ye=c.Pass={toString:function(){return"CodeMirror.Pass"}},Aa={scroll:!1},nd={origin:"*mouse"},Wb={origin:"+move"};
vb.prototype.set=function(a,b){clearTimeout(this.id);this.id=setTimeout(b,a)};var ta=c.countColumn=function(a,b,c,d,f){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));d=d||0;for(f=f||0;;){var g=a.indexOf("\t",d);if(0>g||g>=b)return f+(b-d);f+=g-d;f+=c-f%c;d=g+1}},Mc=[""],sb=function(a){a.select()};ib?sb=function(a){a.selectionStart=0;a.selectionEnd=a.value.length}:M&&(sb=function(a){try{a.select()}catch(b){}});var pg=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,
ef=c.isWordChar=function(a){return/\w/.test(a)||"\u0080"<a&&(a.toUpperCase()!=a.toLowerCase()||pg.test(a))},fg=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,
Wa;Wa=document.createRange?function(a,b,c,d){var f=document.createRange();f.setEnd(d||a,c);f.setStart(a,b);return f}:function(a,b,c){var d=document.body.createTextRange();try{d.moveToElementText(a.parentNode)}catch(f){return d}d.collapse(!0);d.moveEnd("character",c);d.moveStart("character",b);return d};var Zc=c.contains=function(a,b){3==b.nodeType&&(b=b.parentNode);if(a.contains)return a.contains(b);do if(11==b.nodeType&&(b=b.host),b==a)return!0;while(b=b.parentNode)};M&&11>U&&(ya=function(){try{return document.activeElement}catch(a){return document.body}});
var Bb=c.rmClass=function(a,b){var c=a.className,d=Vb(b).exec(c);if(d){var f=c.slice(d.index+d[0].length);a.className=c.slice(0,d.index)+(f?d[1]+f:"")}},Db=c.addClass=function(a,b){var c=a.className;Vb(b).test(c)||(a.className+=(c?" ":"")+b)},Dd=!1,If=function(){if(M&&9>U)return!1;var a=C("div");return"draggable"in a||"dragDrop"in a}(),Bd,yd,mg=c.splitLines=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;b<=d;){var f=a.indexOf("\n",b);-1==f&&(f=a.length);var g=a.slice(b,"\r"==
a.charAt(f-1)?f-1:f),h=g.indexOf("\r");-1!=h?(c.push(g.slice(0,h)),b+=h+1):(c.push(g),b=f+1)}return c}:function(a){return a.split(/\r\n?|\n/)},kg=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(b){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(c){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},Ae=function(){var a=C("div");if("oncopy"in a)return!0;a.setAttribute("oncopy","return;");return"function"==typeof a.oncopy}(),
ed=null,Na={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",
63276:"PageUp",63277:"PageDown",63302:"Insert"};c.keyNames=Na;(function(){for(var a=0;10>a;a++)Na[a+48]=Na[a+96]=String(a);for(a=65;90>=a;a++)Na[a]=String.fromCharCode(a);for(a=1;12>=a;a++)Na[a+111]=Na[a+63235]="F"+a})();var Mb,dg=function(){function a(b){return 247>=b?c.charAt(b):1424<=b&&1524>=b?"R":1536<=b&&1773>=b?d.charAt(b-1536):1774<=b&&2220>=b?"r":8192<=b&&8203>=b?"w":8204==b?"b":"L"}function b(a,c,d){this.level=a;this.from=c;this.to=d}var c="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",
d="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm",f=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,g=/[stwN]/,h=/[LRr]/,m=/[Lb1n]/,p=/[1n]/;return function(c){if(!f.test(c))return!1;for(var d=c.length,q=[],r=0,s;r<d;++r)q.push(a(c.charCodeAt(r)));for(var r=0,u="L";r<d;++r)s=q[r],"m"==s?q[r]=u:u=s;r=0;for(u="L";r<
d;++r)s=q[r],"1"==s&&"r"==u?q[r]="n":h.test(s)&&(u=s,"r"==s&&(q[r]="R"));r=1;for(u=q[0];r<d-1;++r)s=q[r],"+"==s&&"1"==u&&"1"==q[r+1]?q[r]="1":","!=s||u!=q[r+1]||"1"!=u&&"n"!=u||(q[r]=u),u=s;for(r=0;r<d;++r)if(s=q[r],","==s)q[r]="N";else if("%"==s){for(u=r+1;u<d&&"%"==q[u];++u);var t=r&&"!"==q[r-1]||u<d&&"1"==q[u]?"1":"N";for(s=r;s<u;++s)q[s]=t;r=u-1}r=0;for(u="L";r<d;++r)s=q[r],"L"==u&&"1"==s?q[r]="L":h.test(s)&&(u=s);for(r=0;r<d;++r)if(g.test(q[r])){for(u=r+1;u<d&&g.test(q[u]);++u);s="L"==(u<d?q[u]:
"L");t="L"==(r?q[r-1]:"L")||s?"L":"R";for(s=r;s<u;++s)q[s]=t;r=u-1}for(var u=[],v,r=0;r<d;)if(m.test(q[r])){s=r;for(++r;r<d&&m.test(q[r]);++r);u.push(new b(0,s,r))}else{var x=r,t=u.length;for(++r;r<d&&"L"!=q[r];++r);for(s=x;s<r;)if(p.test(q[s])){x<s&&u.splice(t,0,new b(1,x,s));x=s;for(++s;s<r&&p.test(q[s]);++s);u.splice(t,0,new b(2,x,s));x=s}else++s;x<r&&u.splice(t,0,new b(1,x,r))}1==u[0].level&&(v=c.match(/^\s+/))&&(u[0].from=v[0].length,u.unshift(new b(0,0,v[0].length)));1==P(u).level&&(v=c.match(/\s+$/))&&
(P(u).to-=v[0].length,u.push(new b(0,d-v[0].length,d)));2==u[0].level&&u.unshift(new b(1,u[0].to,u[0].to));u[0].level!=P(u).level&&u.push(new b(u[0].level,d,d));return u}}();c.version="5.5.1";return c}();Server=function(c){function a(a,c){this.document=a;this.operations=c||[]}a.prototype.receiveOperation=function(a,c){console.log("Operations "+this.operations.length+" Revision "+a);if(0>a||this.operations.length<a)return console.log("operation revision "+a+" not in history"),!1;for(var f=this.operations.slice(a),g=c.constructor.transform,h=0;h<f.length;h++)c=g(c,f[h])[0];this.document=c.apply(this.document);this.operations.push(c);return c};return a}(this);
"object"===typeof module&&(module.exports=ot.Server);(function(c){var a={makeEventEmitter:function(a,c){a.prototype.allowedEvents_=c;a.prototype.on=function(a,b,c){this.validateEventType_(a);this.eventListeners_=this.eventListeners_||{};this.eventListeners_[a]=this.eventListeners_[a]||[];this.eventListeners_[a].push({callback:b,context:c})};a.prototype.off=function(a,b){this.validateEventType_(a);this.eventListeners_=this.eventListeners_||{};for(var c=this.eventListeners_[a]||[],d=0;d<c.length;d++)if(c[d].callback===b){c.splice(d,1);break}};a.prototype.trigger=
function(a){this.eventListeners_=this.eventListeners_||{};for(var b=this.eventListeners_[a]||[],c=0;c<b.length;c++)b[c].callback.apply(b[c].context,Array.prototype.slice.call(arguments,1))};a.prototype.validateEventType_=function(a){if(this.allowedEvents_){for(var b=!1,c=0;c<this.allowedEvents_.length;c++)if(this.allowedEvents_[c]===a){b=!0;break}if(!b)throw Error('Unknown event "'+a+'"');}}},elt:function(b,c,f){b=document.createElement(b);if("string"===typeof c)a.setTextContent(b,c);else if(c)for(var g=
0;g<c.length;++g)b.appendChild(c[g]);for(var h in f||{})b.setAttribute(h,f[h]);return b},setTextContent:function(a,c){a.innerHTML="";a.appendChild(document.createTextNode(c))},on:function(a,c,f,g){a.addEventListener?a.addEventListener(c,f,g||!1):a.attachEvent&&a.attachEvent("on"+c,f)},off:function(a,c,f,g){a.removeEventListener?a.removeEventListener(c,f,g||!1):a.detachEvent&&a.detachEvent("on"+c,f)},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(a){a.stopPropagation?
a.stopPropagation():a.cancelBubble=!0},stopEvent:function(b){a.preventDefault(b);a.stopPropagation(b)},stopEventAnd:function(b){return function(c){b(c);a.stopEvent(c);return!1}},trim:function(a){return a.replace(/^\s+/g,"").replace(/\s+$/g,"")},stringEndsWith:function(a,c){for(var f="string"==typeof c?[c]:c,g=0;g<f.length;g++)if(c=f[g],-1!==a.indexOf(c,a.length-c.length))return!0;return!1},assert:function(a,c){if(!a)throw Error(c||"assertion error");},log:function(){if("undefined"!==typeof console&&
"undefined"!==typeof console.log){for(var a=["Vceditor:"],c=0;c<arguments.length;c++)a.push(arguments[c]);console.log.apply(console,a)}}};c.utils=a})(window);(function(c){var a=function(a){function d(a){this.imageInsertionUI=a;this.element_=this.makeElement_()}var f=c.utils;f.makeEventEmitter(d,"bold italic underline strike font font-size color left center right unordered-list ordered-list todo-list indent-increase indent-decrease undo redo insert-image".split(" "));d.prototype.element=function(){return this.element_};d.prototype.makeButton_=function(a,b){var c=this,d=f.elt("a",[f.elt("span","",{"class":"vceditor-tb-"+(b||a)})],{"class":"vceditor-btn"});
f.on(d,"click",f.stopEventAnd(function(){c.trigger(a)}));return d};d.prototype.makeElement_=function(){var a=this.makeFontDropdown_(),b=this.makeFontSizeDropdown_(),c=this.makeColorDropdown_(),a=[f.elt("div",[a],{"class":"vceditor-btn-group"}),f.elt("div",[b],{"class":"vceditor-btn-group"}),f.elt("div",[c],{"class":"vceditor-btn-group"}),f.elt("div",[this.makeButton_("bold"),this.makeButton_("italic"),this.makeButton_("underline"),this.makeButton_("strike","strikethrough")],{"class":"vceditor-btn-group"}),
f.elt("div",[this.makeButton_("unordered-list","list-2"),this.makeButton_("ordered-list","numbered-list"),this.makeButton_("todo-list","list")],{"class":"vceditor-btn-group"}),f.elt("div",[this.makeButton_("indent-decrease"),this.makeButton_("indent-increase")],{"class":"vceditor-btn-group"}),f.elt("div",[this.makeButton_("left","paragraph-left"),this.makeButton_("center","paragraph-center"),this.makeButton_("right","paragraph-right")],{"class":"vceditor-btn-group"}),f.elt("div",[this.makeButton_("undo"),
this.makeButton_("redo")],{"class":"vceditor-btn-group"})];this.imageInsertionUI&&a.push(f.elt("div",[this.makeButton_("insert-image")],{"class":"vceditor-btn-group"}));a=f.elt("div",a,{"class":"vceditor-toolbar-wrapper"});b=f.elt("div",null,{"class":"vceditor-toolbar"});b.appendChild(a);return b};d.prototype.makeFontDropdown_=function(){for(var a="Arial;Comic Sans MS;Courier New;Impact;Times New Roman;Verdana".split(";"),b=[],c=0;c<a.length;c++){var d=f.elt("span",a[c]);d.setAttribute("style","font-family:"+
a[c]);b.push({content:d,value:a[c]})}return this.makeDropdown_("Font","font",b)};d.prototype.makeFontSizeDropdown_=function(){for(var a=[9,10,12,14,18,24,32,42],b=[],c=0;c<a.length;c++){var d=f.elt("span",a[c].toString());d.setAttribute("style","font-size:"+a[c]+"px; line-height:"+(a[c]-6)+"px;");b.push({content:d,value:a[c]})}return this.makeDropdown_("Size","font-size",b,"px")};d.prototype.makeColorDropdown_=function(){for(var a="black red green blue yellow cyan magenta grey".split(" "),b=[],c=
0;c<a.length;c++){var d=f.elt("div");d.className="vceditor-color-dropdown-item";d.setAttribute("style","background-color:"+a[c]);b.push({content:d,value:a[c]})}return this.makeDropdown_("Color","color",b)};d.prototype.makeDropdown_=function(a,b,c,d){function s(){w&&(t.style.display="",f.off(document,"click",s,!0),w=!1);q=!0;setTimeout(function(){q=!1},0)}function v(a,c){"object"!==typeof a&&(a=document.createTextNode(String(a)));var g=f.elt("a",[a]);f.on(g,"click",f.stopEventAnd(function(){s();x.trigger(b,
c+d)}));t.appendChild(g)}d=d||"";var x=this;a=f.elt("a",a+" \u25be",{"class":"vceditor-btn vceditor-dropdown"});var t=f.elt("ul",[],{"class":"vceditor-dropdown-menu"});a.appendChild(t);for(var w=!1,q=!1,r=0;r<c.length;r++)v(c[r].content,c[r].value);f.on(a,"click",f.stopEventAnd(function(){q||w||(t.style.display="block",f.on(document,"click",s,!0),w=!0)}));return a};return d}();c.RichTextToolbar=a})(window);(function(c){var a=function(){function a(b,c,h){this.type=b;this.attributes=this.text=this.chars=null;"insert"===b?(this.text=c,d.assert("string"===typeof this.text),this.attributes=h||{},d.assert("object"===typeof this.attributes)):"delete"===b?(this.chars=c,d.assert("number"===typeof this.chars)):"retain"===b&&(this.chars=c,d.assert("number"===typeof this.chars),this.attributes=h||{},d.assert("object"===typeof this.attributes))}var d=c.utils;a.prototype.isInsert=function(){return"insert"===this.type};
a.prototype.isDelete=function(){return"delete"===this.type};a.prototype.isRetain=function(){return"retain"===this.type};a.prototype.equals=function(a){return this.type===a.type&&this.text===a.text&&this.chars===a.chars&&this.attributesEqual(a.attributes)};a.prototype.attributesEqual=function(a){for(var b in this.attributes)if(this.attributes[b]!==a[b])return!1;for(b in a)if(this.attributes[b]!==a[b])return!1;return!0};a.prototype.hasEmptyAttributes=function(){var a=!0,b;for(b in this.attributes){a=
!1;break}return a};return a}();c.TextOp=a})(window);(function(c){TextOperation=function(){function a(){if(!this||this.constructor!==a)return new a;this.ops=[];this.targetLength=this.baseLength=0}function b(a){a=a.ops;switch(a.length){case 1:return a[0];case 2:return a[0].isRetain()?a[1]:a[1].isRetain()?a[0]:null;case 3:if(a[0].isRetain()&&a[2].isRetain())return a[1]}return null}function d(a){return a.ops[0].isRetain()?a.ops[0].chars:0}var f=c.TextOp,g=c.utils;a.prototype.equals=function(a){if(this.baseLength!==a.baseLength||this.targetLength!==a.targetLength||
this.ops.length!==a.ops.length)return!1;for(var b=0;b<this.ops.length;b++)if(!this.ops[b].equals(a.ops[b]))return!1;return!0};a.prototype.retain=function(a,b){if("number"!==typeof a||0>a)throw Error("retain expects a positive integer.");if(0===a)return this;this.baseLength+=a;this.targetLength+=a;b=b||{};var c=0<this.ops.length?this.ops[this.ops.length-1]:null;c&&c.isRetain()&&c.attributesEqual(b)?c.chars+=a:this.ops.push(new f("retain",a,b));return this};a.prototype.insert=function(a,b){if("string"!==
typeof a)throw Error("insert expects a string");if(""===a)return this;b=b||{};this.targetLength+=a.length;var c=0<this.ops.length?this.ops[this.ops.length-1]:null,d=1<this.ops.length?this.ops[this.ops.length-2]:null;c&&c.isInsert()&&c.attributesEqual(b)?c.text+=a:c&&c.isDelete()?d&&d.isInsert()&&d.attributesEqual(b)?d.text+=a:(this.ops[this.ops.length-1]=new f("insert",a,b),this.ops.push(c)):this.ops.push(new f("insert",a,b));return this};a.prototype["delete"]=function(a){"string"===typeof a&&(a=
a.length);if("number"!==typeof a||0>a)throw Error("delete expects a positive integer or a string");if(0===a)return this;this.baseLength+=a;var b=0<this.ops.length?this.ops[this.ops.length-1]:null;b&&b.isDelete()?b.chars+=a:this.ops.push(new f("delete",a));return this};a.prototype.isNoop=function(){return 0===this.ops.length||1===this.ops.length&&this.ops[0].isRetain()&&this.ops[0].hasEmptyAttributes()};a.prototype.clone=function(){for(var b=new a,c=0;c<this.ops.length;c++)if(this.ops[c].isRetain())b.retain(this.ops[c].chars,
this.ops[c].attributes);else if(this.ops[c].isInsert())b.insert(this.ops[c].text,this.ops[c].attributes);else b["delete"](this.ops[c].chars);return b};a.prototype.toString=function(){return(Array.prototype.map||function(a){for(var b=[],c=0,d=this.length;c<d;c++)b[c]=a(this[c]);return b}).call(this.ops,function(a){return a.isRetain()?"retain "+a.chars:a.isInsert()?"insert '"+a.text+"'":"delete "+a.chars}).join(", ")};a.prototype.toJSON=function(){for(var a=[],b=0;b<this.ops.length;b++)this.ops[b].hasEmptyAttributes()||
a.push(this.ops[b].attributes),"retain"===this.ops[b].type?a.push(this.ops[b].chars):"insert"===this.ops[b].type?a.push(this.ops[b].text):"delete"===this.ops[b].type&&a.push(-this.ops[b].chars);0===a.length&&a.push(0);return a};a.fromJSON=function(b){for(var c=new a,d=0,f=b.length;d<f;d++){var v=b[d],x={};"object"===typeof v&&(x=v,d++,v=b[d]);if("number"===typeof v)if(0<v)c.retain(v,x);else c["delete"](-v);else g.assert("string"===typeof v),c.insert(v,x)}return c};a.prototype.apply=function(a,b,c){b=
b||[];c=c||[];if(a.length!==this.baseLength)throw Error("The operation's base length must be equal to the string's length.");for(var d=[],f=0,x,t,w=0,q=this.ops,r=0,u=q.length;r<u;r++){var A=q[r];if(A.isRetain()){if(w+A.chars>a.length)throw Error("Operation can't retain more characters than are left in the string.");d[f++]=a.slice(w,w+A.chars);for(x=0;x<A.chars;x++){var K=b[w+x]||{},H={};for(t in K)H[t]=K[t],g.assert(!1!==H[t]);for(t in A.attributes)!1===A.attributes[t]?delete H[t]:H[t]=A.attributes[t],
g.assert(!1!==H[t]);c.push(H)}w+=A.chars}else if(A.isInsert())for(d[f++]=A.text,x=0;x<A.text.length;x++){K={};for(t in A.attributes)K[t]=A.attributes[t],g.assert(!1!==K[t]);c.push(K)}else w+=A.chars}if(w!==a.length)throw Error("The operation didn't operate on the whole string.");a=d.join("");g.assert(a.length===c.length);return a};a.prototype.invert=function(b){for(var c=0,d=new a,f=this.ops,g=0,x=f.length;g<x;g++){var t=f[g];if(t.isRetain())d.retain(t.chars),c+=t.chars;else if(t.isInsert())d["delete"](t.text.length);
else d.insert(b.slice(c,c+t.chars)),c+=t.chars}return d};a.prototype.compose=function(b){function c(a,b,d){var f={},g;for(g in a)f[g]=a[g];for(g in b)d&&!1===b[g]?delete f[g]:f[g]=b[g];return f}if(this.targetLength!==b.baseLength)throw Error("The base length of the second operation has to be the target length of the first operation");var d=new a,f=this.clone().ops;b=b.clone().ops;for(var g=0,x=0,t=f[g++],w=b[x++],q;"undefined"!==typeof t||"undefined"!==typeof w;)if(t&&t.isDelete())d["delete"](t.chars),
t=f[g++];else if(w&&w.isInsert())d.insert(w.text,w.attributes),w=b[x++];else{if("undefined"===typeof t)throw Error("Cannot compose operations: first operation is too short.");if("undefined"===typeof w)throw Error("Cannot compose operations: first operation is too long.");if(t.isRetain()&&w.isRetain())q=c(t.attributes,w.attributes),t.chars>w.chars?(d.retain(w.chars,q),t.chars-=w.chars,w=b[x++]):t.chars===w.chars?(d.retain(t.chars,q),t=f[g++],w=b[x++]):(d.retain(t.chars,q),w.chars-=t.chars,t=f[g++]);
else if(t.isInsert()&&w.isDelete())t.text.length>w.chars?(t.text=t.text.slice(w.chars),w=b[x++]):t.text.length===w.chars?(t=f[g++],w=b[x++]):(w.chars-=t.text.length,t=f[g++]);else if(t.isInsert()&&w.isRetain())q=c(t.attributes,w.attributes,!0),t.text.length>w.chars?(d.insert(t.text.slice(0,w.chars),q),t.text=t.text.slice(w.chars),w=b[x++]):t.text.length===w.chars?(d.insert(t.text,q),t=f[g++],w=b[x++]):(d.insert(t.text,q),w.chars-=t.text.length,t=f[g++]);else if(t.isRetain()&&w.isDelete())t.chars>
w.chars?(d["delete"](w.chars),t.chars-=w.chars,w=b[x++]):t.chars===w.chars?(d["delete"](w.chars),t=f[g++],w=b[x++]):(d["delete"](t.chars),w.chars-=t.chars,t=f[g++]);else throw Error("This shouldn't happen: op1: "+JSON.stringify(t)+", op2: "+JSON.stringify(w));}return d};a.prototype.shouldBeComposedWith=function(a){if(this.isNoop()||a.isNoop())return!0;var c=d(this),f=d(a),g=b(this);a=b(a);return g&&a?g.isInsert()&&a.isInsert()?c+g.text.length===f:g.isDelete()&&a.isDelete()?f+a.chars===c||c===f:!1:
!1};a.prototype.shouldBeComposedWithInverted=function(a){if(this.isNoop()||a.isNoop())return!0;var c=d(this),f=d(a),g=b(this);a=b(a);return g&&a?g.isInsert()&&a.isInsert()?c+g.text.length===f||c===f:g.isDelete()&&a.isDelete()?f+a.chars===c:!1:!1};a.transformAttributes=function(a,b){var c={},d={},f,x={};for(f in a)x[f]=!0;for(f in b)x[f]=!0;for(f in x){var x=a[f],t=b[f];g.assert(null!=x||null!=t);null==x?d[f]=t:null==t?c[f]=x:x!==t&&(c[f]=x)}return[c,d]};a.transform=function(b,c){if(b.baseLength!==
c.baseLength)throw Error("Both operations have to have the same base length");for(var d=new a,f=new a,g=b.clone().ops,x=c.clone().ops,t=0,w=0,q=g[t++],r=x[w++];"undefined"!==typeof q||"undefined"!==typeof r;)if(q&&q.isInsert())d.insert(q.text,q.attributes),f.retain(q.text.length),q=g[t++];else if(r&&r.isInsert())d.retain(r.text.length),f.insert(r.text,r.attributes),r=x[w++];else{if("undefined"===typeof q)throw Error("Cannot transform operations: first operation is too short.");if("undefined"===typeof r)throw Error("Cannot transform operations: first operation is too long.");
var u;if(q.isRetain()&&r.isRetain()){var A=a.transformAttributes(q.attributes,r.attributes);q.chars>r.chars?(u=r.chars,q.chars-=r.chars,r=x[w++]):q.chars===r.chars?(u=r.chars,q=g[t++],r=x[w++]):(u=q.chars,r.chars-=q.chars,q=g[t++]);d.retain(u,A[0]);f.retain(u,A[1])}else if(q.isDelete()&&r.isDelete())q.chars>r.chars?(q.chars-=r.chars,r=x[w++]):q.chars===r.chars?(q=g[t++],r=x[w++]):(r.chars-=q.chars,q=g[t++]);else if(q.isDelete()&&r.isRetain())q.chars>r.chars?(u=r.chars,q.chars-=r.chars,r=x[w++]):q.chars===
r.chars?(u=r.chars,q=g[t++],r=x[w++]):(u=q.chars,r.chars-=q.chars,q=g[t++]),d["delete"](u);else if(q.isRetain()&&r.isDelete())q.chars>r.chars?(u=r.chars,q.chars-=r.chars,r=x[w++]):q.chars===r.chars?(u=q.chars,q=g[t++],r=x[w++]):(u=q.chars,r.chars-=q.chars,q=g[t++]),f["delete"](u);else throw Error("The two operations aren't compatible");}return[d,f]};return a}();c.TextOperation=TextOperation})(window);(function(c){var a=function(a){function c(a,b){this.wrapped=a;this.meta=b}function f(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])}function g(a,b){return a&&"object"===typeof a&&"function"===typeof a.transform?a.transform(b):a}c.prototype.apply=function(){return this.wrapped.apply.apply(this.wrapped,arguments)};c.prototype.invert=function(){var a=this.meta;return new c(this.wrapped.invert.apply(this.wrapped,arguments),a&&"object"===typeof a&&"function"===typeof a.invert?a.invert.apply(a,arguments):
a)};c.prototype.compose=function(a){var b=this.wrapped.compose(a.wrapped),g;g=this.meta;a=a.meta;if(g&&"object"===typeof g)if("function"===typeof g.compose)g=g.compose(a);else{var s={};f(g,s);f(a,s);g=s}else g=a;return new c(b,g)};c.transform=function(a,b){var f=a.wrapped.constructor.transform,f=f(a.wrapped,b.wrapped);return[new c(f[0],g(a.meta,b.wrapped)),new c(f[1],g(b.meta,a.wrapped))]};return c}();c.WrappedOperation=a})(window);(function(c){var a=function(){function a(b,c){this.position=b;this.selectionEnd=c}a.fromJSON=function(c){return new a(c.position,c.selectionEnd)};a.prototype.equals=function(a){return this.position===a.position&&this.selectionEnd===a.selectionEnd};a.prototype.compose=function(a){return a};a.prototype.transform=function(c){function f(a){for(var b=a,f=c.ops,g=0,v=c.ops.length;g<v&&!(f[g].isRetain()?a-=f[g].chars:f[g].isInsert()?b+=f[g].text.length:(b-=Math.min(a,f[g].chars),a-=f[g].chars),0>a);g++);
return b}var g=f(this.position);return this.position===this.selectionEnd?new a(g,g):new a(g,f(this.selectionEnd))};return a}();c.Cursor=a})(window);(function(c){var a=function(){function a(b){this.maxItems=b||50;this.state=f;this.dontCompose=!1;this.undoStack=[];this.redoStack=[]}function c(a,b){for(var d=[],f=b.constructor,s=a.length-1;0<=s;s--){var v=f.transform(a[s],b);"function"===typeof v[0].isNoop&&v[0].isNoop()||d.push(v[0]);b=v[1]}return d.reverse()}var f="normal";a.prototype.add=function(a,b){if("undoing"===this.state)this.redoStack.push(a),this.dontCompose=!0;else if("redoing"===this.state)this.undoStack.push(a),this.dontCompose=!0;
else{var c=this.undoStack;!this.dontCompose&&b&&0<c.length?c.push(a.compose(c.pop())):(c.push(a),c.length>this.maxItems&&c.shift());this.dontCompose=!1;this.redoStack=[]}};a.prototype.transform=function(a){this.undoStack=c(this.undoStack,a);this.redoStack=c(this.redoStack,a)};a.prototype.performUndo=function(a){this.state="undoing";if(0===this.undoStack.length)throw Error("undo not possible");a(this.undoStack.pop());this.state=f};a.prototype.performRedo=function(a){this.state="redoing";if(0===this.redoStack.length)throw Error("redo not possible");
a(this.redoStack.pop());this.state=f};a.prototype.canUndo=function(){return 0!==this.undoStack.length};a.prototype.canRedo=function(){return 0!==this.redoStack.length};a.prototype.isUndoing=function(){return"undoing"===this.state};a.prototype.isRedoing=function(){return"redoing"===this.state};return a}();c.UndoManager=a})(window);(function(c){var a=function(){function a(b){this.revision=b;this.state=h}function c(){}function f(a){this.outstanding=a}function g(a,b){this.outstanding=a;this.buffer=b}a.prototype.setState=function(a){this.state=a};a.prototype.applyClient=function(a){this.setState(this.state.applyClient(this,a))};a.prototype.applyServer=function(a){this.revision++;this.setState(this.state.applyServer(this,a))};a.prototype.serverAck=function(){this.revision++;this.setState(this.state.serverAck(this))};a.prototype.serverRetry=
function(){this.setState(this.state.serverRetry(this))};a.prototype.transformCursor=function(a){return this.state.transformCursor(a)};a.prototype.sendOperation=function(a){throw Error("sendOperation must be defined in child class");};a.prototype.applyOperation=function(a){throw Error("applyOperation must be defined in child class");};a.Synchronized=c;c.prototype.applyClient=function(a,b){a.sendOperation(a.revision,b);return new f(b)};c.prototype.applyServer=function(a,b){a.applyOperation(b);return this};
c.prototype.transformCursor=function(a){return a};c.prototype.serverAck=function(a){throw Error("There is no pending operation.");};c.prototype.serverRetry=function(a){throw Error("There is no pending operation.");};var h=new c;a.AwaitingConfirm=f;f.prototype.applyClient=function(a,b){return new g(this.outstanding,b)};f.prototype.applyServer=function(a,b){var c=b.constructor.transform(this.outstanding,b);a.applyOperation(c[1]);return new f(c[0])};f.prototype.serverAck=function(a){return h};f.prototype.serverRetry=
function(a){a.sendOperation(this.outstanding);return this};f.prototype.transformCursor=function(a){return a.transform(this.outstanding)};a.AwaitingWithBuffer=g;g.prototype.applyClient=function(a,b){var c=this.buffer.compose(b);return new g(this.outstanding,c)};g.prototype.applyServer=function(a,b){var c=b.constructor.transform,d=c(this.outstanding,b),c=c(this.buffer,d[1]);a.applyOperation(c[1]);return new g(d[0],c[0])};g.prototype.serverRetry=function(a){var b=this.outstanding.compose(this.buffer);
a.sendOperation(b);return new f(b)};g.prototype.serverAck=function(a){a.sendOperation(a.revision,this.buffer);return new f(this.buffer)};g.prototype.transformCursor=function(a){return a.transform(this.outstanding).transform(this.buffer)};return a}();c.Client=a})(window);(function(c){var a=function(){function a(b,c){this.cursorBefore=b;this.cursorAfter=c}function d(a,b){this.id=a;this.editorAdapter=b;this.li=document.createElement("li")}function f(a,b,c,d){h.call(this,a);this.serverAdapter=c;this.editorAdapter=d;this.undoManager=new p;this.clients={};var f=this;this.editorAdapter.registerCallbacks({change:function(a,b){f.onChange(a,b)},cursorActivity:function(){f.onCursorActivity()},blur:function(){f.onBlur()},focus:function(){f.onFocus()}});this.editorAdapter.registerUndo(function(){f.undo()});
this.editorAdapter.registerRedo(function(){f.redo()});this.serverAdapter.registerCallbacks({client_left:function(a){f.onClientLeft(a)},set_name:function(a,b){f.getClientObject(a).setName(b)},ack:function(){f.serverAck()},operation:function(a){f.applyServer(s.fromJSON(a))},cursor:function(a,b){b?f.getClientObject(a).updateCursor(f.transformCursor(m.fromJSON(b))):f.getClientObject(a).removeCursor()},clients:function(a){for(var b in f.clients)if(f.clients.hasOwnProperty(b)&&!a.hasOwnProperty(b))f.onClientLeft(b);
for(b in a)if(a.hasOwnProperty(b)){var c=f.getClientObject(b);a[b].name&&c.setName(a[b].name);(c=a[b].selection)?f.clients[b].updateSelection(f.transformSelection(Selection.fromJSON(c))):f.clients[b].removeSelection()}},reconnect:function(){f.serverReconnect()}})}function g(a){return a[a.length-1]}var h=c.Client,m=c.Cursor,p=c.UndoManager,s=c.TextOperation,v=c.WrappedOperation;a.prototype.invert=function(){return new a(this.cursorAfter,this.cursorBefore)};a.prototype.compose=function(c){return new a(this.cursorBefore,
c.cursorAfter)};a.prototype.transform=function(c){return new a(this.cursorBefore?this.cursorBefore.transform(c):null,this.cursorAfter?this.cursorAfter.transform(c):null)};d.prototype.setColor=function(a){this.color=a};d.prototype.updateCursor=function(a){this.color="#86BA7D";this.removeCursor();this.cursor=a;this.mark=this.editorAdapter.setOtherCursor(a,this.color,this.id)};d.prototype.removeCursor=function(){this.mark&&this.mark.clear()};(function(a,b){function c(){}c.prototype=b.prototype;a.prototype=
new c;a.prototype.constructor=a})(f,h);f.prototype.getClientObject=function(a){var b=this.clients[a];return b?b:this.clients[a]=new d(a,this.editorAdapter)};f.prototype.applyUnredo=function(a){this.undoManager.add(this.editorAdapter.invertOperation(a));this.editorAdapter.applyOperation(a.wrapped);(this.cursor=a.meta.cursorAfter)&&this.editorAdapter.setCursor(this.cursor);this.applyClient(a.wrapped)};f.prototype.undo=function(){var a=this;this.undoManager.canUndo()&&this.undoManager.performUndo(function(b){a.applyUnredo(b)})};
f.prototype.redo=function(){var a=this;this.undoManager.canRedo()&&this.undoManager.performRedo(function(b){a.applyUnredo(b)})};f.prototype.onChange=function(c,d){var f=this.cursor;this.updateCursor();var h=0<this.undoManager.undoStack.length&&d.shouldBeComposedWithInverted(g(this.undoManager.undoStack).wrapped),f=new a(this.cursor,f);this.undoManager.add(new v(d,f),h);this.applyClient(c)};f.prototype.updateCursor=function(){this.cursor=this.editorAdapter.getCursor()};f.prototype.onCursorActivity=
function(){var a=this.cursor;this.updateCursor();!this.focused||a&&this.cursor.equals(a)||this.sendCursor(this.cursor)};f.prototype.onBlur=function(){this.cursor=null;this.sendCursor(null);this.focused=!1};f.prototype.onFocus=function(){this.focused=!0;this.onCursorActivity()};f.prototype.sendCursor=function(a){this.state instanceof h.AwaitingWithBuffer||this.serverAdapter.sendCursor(a)};f.prototype.sendOperation=function(a,b){this.serverAdapter.sendOperation(a,b.toJSON(),this.cursor,this.editorAdapter.cm.options.keyMap)};
f.prototype.applyOperation=function(a){this.editorAdapter.applyOperation(a);this.updateCursor();this.undoManager.transform(new v(a,null))};f.prototype.emitStatus=function(){var a=this;setTimeout(function(){a.trigger("synced",a.state instanceof h.Synchronized)},0)};return f}();c.EditorClient=a})(window);(function(c){var a=function(){function a(b,c){this.pos=b;this.length=c}a.prototype.end=function(){return this.pos+this.length};return a}();c.Span=a})(window);(function(c){var a=function(){function a(b,c){if(!b)throw Error("AnnotationList assertion failed"+(c?": "+c:""));}function d(a,b){this.pos=a;this.length=b.length;this.annotation=b.annotation;this.attachedObject_=b.attachedObject}function f(a,b){this.pos=a;this.length=b.length;this.annotation=b.annotation;this.node_=b}function g(a){this.head_=new h(0,p);this.changeHandler_=a}function h(a,b){this.length=a;this.annotation=b;this.next=this.attachedObject=null}var m=c.Span;d.prototype.getAttachedObject=
function(){return this.attachedObject_};f.prototype.attachObject=function(a){this.node_.attachedObject=a};var p={equals:function(){return!1}};g.prototype.insertAnnotatedSpan=function(c,d){this.wrapOperation_(new m(c.pos,0),function(f,g){a(!g||null===g.next);var m=new h(c.length,d);if(g){a(c.pos>f&&c.pos<f+g.length);var q=new h(0,p);q.next=new h(c.pos-f,g.annotation);q.next.next=m;m.next=new h(f+g.length-c.pos,g.annotation);return q.next}return m})};g.prototype.removeSpan=function(c){0!==c.length&&
this.wrapOperation_(c,function(d,f){a(null!==f);var g=new h(0,p),m=g;c.pos>d&&(m.next=new h(c.pos-d,f.annotation),m=m.next);for(;c.end()>d+f.length;)d+=f.length,f=f.next;var q=d+f.length-c.end();0<q&&(m.next=new h(q,f.annotation));return g.next})};g.prototype.updateSpan=function(c,d){0!==c.length&&this.wrapOperation_(c,function(f,g){a(null!==g);var m=new h(0,p),q=m,r=f,u=c.pos-r;a(u<g.length);0<u&&(q.next=new h(u,g.annotation),q=q.next,r+=q.length);for(;null!==g&&c.end()>=f+g.length;)r=f+g.length-
r,q.next=new h(r,d(g.annotation,r)),q=q.next,f+=g.length,g=g.next,r=f;u=c.end()-r;0<u&&(a(u<g.length),q.next=new h(u,d(g.annotation,u)),q=q.next,r+=q.length,q.next=new h(f+g.length-r,g.annotation));return m.next})};g.prototype.wrapOperation_=function(a,b){if(0>a.pos)throw Error("Span start cannot be negative.");var c=[],g=[],m=this.getAffectedNodes_(a),q;null!==m.start?(q=m.end.next,m.end.next=null):q=m.succ;var p=b(m.startPos,m.start),u=!1,A=!1;if(p){this.mergeNodesWithSameAnnotations_(p);var K;
m.pred&&m.pred.annotation.equals(p.annotation)?(u=!0,p.length+=m.pred.length,m.beforePred.next=p,K=m.predPos):(m.beforeStart.next=p,K=m.startPos);for(;p.next;)g.push(new f(K,p)),K+=p.length,p=p.next;m.succ&&m.succ.annotation.equals(p.annotation)?(p.length+=m.succ.length,A=!0,p.next=m.succ.next):p.next=q;g.push(new f(K,p))}else m.pred&&m.succ&&m.pred.annotation.equals(m.succ.annotation)?(A=u=!0,p=new h(m.pred.length+m.succ.length,m.pred.annotation),m.beforePred.next=p,p.next=m.succ.next,g.push(new f(m.startPos-
m.pred.length,p))):m.beforeStart.next=q;u&&c.push(new d(m.predPos,m.pred));q=m.startPos;for(p=m.start;null!==p;)c.push(new d(q,p)),q+=p.length,p=p.next;A&&c.push(new d(q,m.succ));this.changeHandler_(c,g)};g.prototype.getAffectedNodes_=function(a){for(var b={},c=null,d=this.head_,f=d.next,g=0;null!==f&&a.pos>=g+f.length;)g+=f.length,c=d,d=f,f=f.next;if(null===f&&(0!==a.length||a.pos!==g))throw Error("Span start exceeds the bounds of the AnnotationList.");b.startPos=g;b.start=0===a.length&&a.pos===
g?null:f;b.beforeStart=d;g===a.pos&&0<g?(b.pred=d,b.predPos=g-d.length,b.beforePred=c):b.pred=null;for(;null!==f&&a.end()>g;)g+=f.length,d=f,f=f.next;if(a.end()>g)throw Error("Span end exceeds the bounds of the AnnotationList.");0===a.length&&a.end()===g?b.end=null:b.end=d;b.succ=g===a.end()?f:null;return b};g.prototype.mergeNodesWithSameAnnotations_=function(a){if(a)for(var b=null;a;)b&&b.annotation.equals(a.annotation)?(b.length+=a.length,b.next=a.next):b=a,a=a.next};g.prototype.forEach=function(a){for(var b=
this.head_.next;null!==b;)a(b.length,b.annotation,b.attachedObject),b=b.next};g.prototype.getAnnotatedSpansForPos=function(a){for(var b=0,c=this.head_.next,f=null;null!==c&&b+c.length<=a;)b+=c.length,f=c,c=c.next;if(null===c&&b!==a)throw Error("pos exceeds the bounds of the AnnotationList");var g=[];b===a&&f&&g.push(new d(b-f.length,f));c&&g.push(new d(b,c));return g};g.prototype.getAnnotatedSpansForSpan=function(a){if(0===a.length)return[];for(var b=[],c=this.getAffectedNodes_(a),d=c.startPos,c=
c.start;null!==c&&d<a.end();){var f=Math.max(d,a.pos),g=Math.min(d+c.length,a.end()),f=new m(f,g-f);f.annotation=c.annotation;b.push(f);d+=c.length;c=c.next}return b};g.prototype.count=function(){for(var c=0,d=this.head_.next,f=null;null!==d;)f&&a(!f.annotation.equals(d.annotation)),f=d,d=d.next,c++;return c};h.prototype.clone=function(){var a=new h(this.spanLength,this.annotation);a.next=this.next;return a};return g}();c.AnnotationList=a})(window);(function(c){c.AttributeConstants={BOLD:"b",ITALIC:"i",UNDERLINE:"u",STRIKE:"s",FONT:"f",FONT_SIZE:"fs",COLOR:"c",BACKGROUND_COLOR:"bc",ENTITY_SENTINEL:"ent",LINE_SENTINEL:"l",LINE_INDENT:"li",LINE_ALIGN:"la",LIST_TYPE:"lt"}})(window);(function(c){var a=function(){function a(c){if(!(this instanceof a))return new a(c);this.attributes=c||{};this.attributes[d.LINE_SENTINEL]=!0}var d=c.AttributeConstants;a.LIST_TYPE={NONE:!1,ORDERED:"o",UNORDERED:"u",TODO:"t",TODOCHECKED:"tc"};a.prototype.cloneWithNewAttribute_=function(c,d){var h={},m;for(m in this.attributes)h[m]=this.attributes[m];!1===d?delete h[c]:h[c]=d;return new a(h)};a.prototype.indent=function(a){return this.cloneWithNewAttribute_(d.LINE_INDENT,a)};a.prototype.align=function(a){return this.cloneWithNewAttribute_(d.LINE_ALIGN,
a)};a.prototype.listItem=function(a){vceditor.utils.assert(!1===a||"u"===a||"o"===a||"t"===a||"tc"===a);return this.cloneWithNewAttribute_(d.LIST_TYPE,a)};a.prototype.getIndent=function(){return this.attributes[d.LINE_INDENT]||0};a.prototype.getAlign=function(){return this.attributes[d.LINE_ALIGN]||0};a.prototype.getListItem=function(){return this.attributes[d.LIST_TYPE]||!1};return a}();c.LineFormatting=a})(window);(function(c){var a=function(){function a(b){return b===h.ORDERED?"</ol>":"</ul>"}function d(a,b){return a===b||a===h.TODO&&b===h.TODOCHECKED||a===h.TODOCHECKED&&b===h.TODO}var f=c.utils,g=c.AttributeConstants,h=c.LineFormatting.LIST_TYPE;return function(c,p){for(var s="",v=!0,x=[],t=!1,w=!0,q=!0,r=0,u=c.ops[r],A=!1;u;){f.assert(u.isInsert());var K=u.attributes;if(v){var v=!1,H=0,S=null,E="left";g.LINE_SENTINEL in K&&(H=K[g.LINE_INDENT]||0,S=K[g.LIST_TYPE]||null,E=K[g.LINE_ALIGN]||"left");S&&(H=H||
1);t?(s+="</li>",t=!1):w||(q&&(s+="<br/>"),s+="</div>");w=!1;for(f.assert(0<=H,"Indent must not be negative.");x.length>H||H===x.length&&null!==S&&!d(S,x[x.length-1]);)s+=a(x.pop());for(;x.length<H;)q=S||h.UNORDERED,A=S==h.TODO||S==h.TODOCHECKED||A,s+=q===h.ORDERED?"<ol>":q===h.UNORDERED?"<ul>":'<ul class="vceditor-todo">',x.push(q);q="left"!==E?' style="text-align:'+E+'"':"";if(S){t="";switch(S){case h.TODOCHECKED:t=' class="vceditor-checked"';break;case h.TODO:t=' class="vceditor-unchecked"'}s+=
"<li"+t+q+">";t=!0}else s+="<div"+q+">";q=!0}if(g.LINE_SENTINEL in K)u=c.ops[++r];else if(g.ENTITY_SENTINEL in K){for(S=0;S<u.text.length;S++)H=vceditor.Entity.fromAttributes(K),H=p.exportToElement(H),s+=H.outerHTML;u=c.ops[++r]}else{var H=S="",O;for(O in K){var E=K[O],N,W;O===g.BOLD||O===g.ITALIC||O===g.UNDERLINE||O===g.STRIKE?(f.assert(!0===E),N=W=O):O===g.FONT_SIZE?(N='span style="font-size: '+E,N+="string"!==typeof E||-1===E.indexOf("px",E.length-2)?'px"':'"',W="span"):O===g.FONT?(N='span style="font-family: '+
E+'"',W="span"):O===g.COLOR?(N='span style="color: '+E+'"',W="span"):O===g.BACKGROUND_COLOR?(N='span style="background-color: '+E+'"',W="span"):f.log(!1,"Encountered unknown attribute while rendering html: "+O);N&&(S+="<"+N+">");W&&(H="</"+W+">"+H)}var E=u.text,Q=E.indexOf("\n");0<=Q?(v=!0,u=Q<E.length-1?new vceditor.TextOp("insert",E.substr(Q+1),K):c.ops[++r],E=E.substr(0,Q)):u=c.ops[++r];E=E.replace(/  +/g,function(a){return Array(a.length+1).join("\u00a0")}).replace(/^ /,"\u00a0").replace(/ $/,
"\u00a0");0<E.length&&(q=!1);s+=S+E.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g,"&nbsp;")+H}}t?s+="</li>":w||(q&&(s+="&nbsp;"),s+="</div>");for(;0<x.length;)s+=a(x.pop());A&&(s='<style>ul.vceditor-todo { list-style: none; margin-left: 0; padding-left: 0; } ul.vceditor-todo > li { padding-left: 1em; text-indent: -1em; } ul.vceditor-todo > li:before { content: "\\2610"; padding-right: 5px; } ul.vceditor-todo > li.vceditor-checked:before { content: "\\2611"; padding-right: 5px; }</style>\n'+
s);return s}}();c.SerializeHtml=a})(window);(function(c){var a=function(){function a(b,c,d){this.listType=b||m.UNORDERED;this.lineFormatting=c||vceditor.LineFormatting();this.textFormatting=d||vceditor.Formatting()}function d(){this.lines=[];this.currentLine=[];this.currentLineListItemType=null}function f(a,b,c){if(a.nodeType===s.ELEMENT_NODE){var d=p.fromElement(a);if(d){c.currentLine.push(new vceditor.Text(vceditor.sentinelConstants.ENTITY_SENTINEL_CHARACTER,new vceditor.Formatting(d.toAttributes())));return}}switch(a.nodeType){case s.TEXT_NODE:a=
a.nodeValue.replace(/[ \n\t]+/g," ");c.currentLine.push(vceditor.Text(a,b.textFormatting));break;case s.ELEMENT_NODE:switch(d=a.getAttribute("style")||"",b=h(b,d),a.nodeName.toLowerCase()){case "div":case "h1":case "h2":case "h3":case "p":c.newlineIfNonEmpty(b);g(a,b,c);c.newlineIfNonEmpty(b);break;case "center":b=b.withAlign("center");c.newlineIfNonEmpty(b);g(a,b.withAlign("center"),c);c.newlineIfNonEmpty(b);break;case "b":case "strong":g(a,b.withTextFormatting(b.textFormatting.bold(!0)),c);break;
case "u":g(a,b.withTextFormatting(b.textFormatting.underline(!0)),c);break;case "i":case "em":g(a,b.withTextFormatting(b.textFormatting.italic(!0)),c);break;case "s":g(a,b.withTextFormatting(b.textFormatting.strike(!0)),c);break;case "font":var d=a.getAttribute("face"),f=a.getAttribute("color"),r=parseInt(a.getAttribute("size"));d&&(b=b.withTextFormatting(b.textFormatting.font(d)));f&&(b=b.withTextFormatting(b.textFormatting.color(f)));r&&(b=b.withTextFormatting(b.textFormatting.fontSize(r)));g(a,
b,c);break;case "br":c.newline(b);break;case "ul":c.newlineIfNonEmptyOrListItem(b);d="vceditor-todo"===a.getAttribute("class")?m.TODO:m.UNORDERED;g(a,b.withListType(d).withIncreasedIndent(),c);c.newlineIfNonEmpty(b);break;case "ol":c.newlineIfNonEmptyOrListItem(b);g(a,b.withListType(m.ORDERED).withIncreasedIndent(),c);c.newlineIfNonEmpty(b);break;case "li":c.newlineIfNonEmptyOrListItem(b);d="vceditor-checked"===a.getAttribute("class")?m.TODOCHECKED:b.listType;c.makeListItem(d);d=c.currentLine;g(a,
b,c);(d===c.currentLine||0<c.currentLine.length)&&c.newline(b);break;case "style":break;default:g(a,b,c)}}}function g(a,b,c){if(a.hasChildNodes())for(var d=0;d<a.childNodes.length;d++)f(a.childNodes[d],b,c)}function h(a,b){for(var c=a.textFormatting,d=a.lineFormatting,f=b.split(";"),g=0;g<f.length;g++){var h=f[g].split(":");if(2===h.length){var m=vceditor.utils.trim(h[0]).toLowerCase(),h=vceditor.utils.trim(h[1]).toLowerCase();switch(m){case "text-decoration":m=0<=h.indexOf("underline");h=0<=h.indexOf("line-through");
c=c.underline(m).strike(h);break;case "font-weight":h="bold"===h||600<=parseInt(h);c=c.bold(h);break;case "font-style":c=c.italic("italic"===h||"oblique"===h);break;case "color":c=c.color(h);break;case "background-color":c=c.backgroundColor(h);break;case "text-align":d=d.align(h);break;case "font-size":m=null;vceditor.utils.stringEndsWith(h,"px pt % em xx-small x-small small medium large x-large xx-large smaller larger".split(" "))?m=h:parseInt(h)&&(m=parseInt(h)+"px");m&&(c=c.fontSize(m));break;
case "font-family":h=vceditor.utils.trim(h.split(",")[0]),h=h.replace(/['"]/g,""),h=h.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}),c=c.font(h)}}}return a.withLineFormatting(d).withTextFormatting(c)}var m=c.LineFormatting.LIST_TYPE;a.prototype.withTextFormatting=function(c){return new a(this.listType,this.lineFormatting,c)};a.prototype.withLineFormatting=function(c){return new a(this.listType,c,this.textFormatting)};a.prototype.withListType=function(c){return new a(c,
this.lineFormatting,this.textFormatting)};a.prototype.withIncreasedIndent=function(){var c=this.lineFormatting.indent(this.lineFormatting.getIndent()+1);return new a(this.listType,c,this.textFormatting)};a.prototype.withAlign=function(c){c=this.lineFormatting.align(c);return new a(this.listType,c,this.textFormatting)};d.prototype.newlineIfNonEmpty=function(a){this.cleanLine_();0<this.currentLine.length&&this.newline(a)};d.prototype.newlineIfNonEmptyOrListItem=function(a){this.cleanLine_();(0<this.currentLine.length||
null!==this.currentLineListItemType)&&this.newline(a)};d.prototype.newline=function(a){this.cleanLine_();a=a.lineFormatting;null!==this.currentLineListItemType&&(a=a.listItem(this.currentLineListItemType),this.currentLineListItemType=null);this.lines.push(vceditor.Line(this.currentLine,a));this.currentLine=[]};d.prototype.makeListItem=function(a){this.currentLineListItemType=a};d.prototype.cleanLine_=function(){if(0<this.currentLine.length){var a=this.currentLine.length-1;this.currentLine[0].text=
this.currentLine[0].text.replace(/^ +/,"");this.currentLine[a].text=this.currentLine[a].text.replace(/ +$/g,"");for(a=0;a<this.currentLine.length;a++)this.currentLine[a].text=this.currentLine[a].text.replace(/\u00a0/g," ")}1===this.currentLine.length&&""===this.currentLine[0].text&&(this.currentLine=[])};var p,s=s||{ELEMENT_NODE:1,TEXT_NODE:3};return function(c,g){var h=(vceditor.document||document).createElement("div");h.innerHTML=c;p=g;var m=new d,q=new a;f(h,q,m);return m.lines}}();c.ParseHtml=
a})(window);(function(c){RichTextCodeMirrorAdapter=function(){function a(a){this.rtcm=a;this.cm=a.codeMirror;d(this,"onChange");d(this,"onAttributesChange");d(this,"onCursorActivity");d(this,"onFocus");d(this,"onBlur");this.rtcm.on("change",this.onChange);this.rtcm.on("attributesChange",this.onAttributesChange);this.cm.on("cursorActivity",this.onCursorActivity);this.cm.on("focus",this.onFocus);this.cm.on("blur",this.onBlur)}function b(a){var b=a.lineCount()-1;return a.indexFromPos({line:b,ch:a.getLine(b).length})}
function d(a,b){var c=a[b];a[b]=function(){c.apply(a,arguments)}}function f(a){for(var b in a)return!1;return!0}var g=c.TextOperation,h=c.WrappedOperation,m=c.Cursor;a.prototype.detach=function(){this.rtcm.off("change",this.onChange);this.rtcm.off("attributesChange",this.onAttributesChange);this.cm.off("cursorActivity",this.onCursorActivity);this.cm.off("focus",this.onFocus);this.cm.off("blur",this.onBlur)};a.operationFromCodeMirrorChanges=function(a,c){for(var d=b(c),f=(new g).retain(d),h=(new g).retain(d),
m=a.length-1;0<=m;m--)var q=a[m],r=q.start,u=d-r-q.text.length,f=(new g).retain(r)["delete"](q.removed.length).insert(q.text,q.attributes).retain(u).compose(f),h=h.compose((new g).retain(r)["delete"](q.text.length).insert(q.removed,q.removedAttributes).retain(u)),d=d+(q.removed.length-q.text.length);return[f,h]};a.operationFromAttributesChanges=function(a,c){for(var d=b(c),f=new g,h=new g,m=0,q=0;q<a.length;q++){var r=a[q],m=r.start-m;if(!(0<=m))throw Error("assertion error");f.retain(m);h.retain(m);
m=r.end-r.start;f.retain(m,r.attributes);h.retain(m,r.attributesInverse);m=r.start+m}f.retain(d-m);h.retain(d-m);return[f,h]};a.applyOperationToCodeMirror=function(a,b){10<a.ops.length&&b.codeMirror.getWrapperElement().setAttribute("style","display: none");for(var c=a.ops,d=0,g=0,h=c.length;g<h;g++){var m=c[g];m.isRetain()?(f(m.attributes)||b.updateTextAttributes(d,d+m.chars,function(a){for(var b in m.attributes)!1===m.attributes[b]?delete a[b]:a[b]=m.attributes[b]},"RTCMADAPTER",!0),d+=m.chars):
m.isInsert()?(b.insertText(d,m.text,m.attributes,"RTCMADAPTER"),d+=m.text.length):m.isDelete()&&b.removeText(d,d+m.chars,"RTCMADAPTER")}10<a.ops.length&&(b.codeMirror.getWrapperElement().setAttribute("style",""),b.codeMirror.refresh())};a.prototype.registerCallbacks=function(a){this.callbacks=a};a.prototype.onChange=function(b,c){if("RTCMADAPTER"!==c[0].origin){var d=a.operationFromCodeMirrorChanges(c,this.cm);this.trigger("change",d[0],d[1])}};a.prototype.onAttributesChange=function(b,c){if("RTCMADAPTER"!==
c[0].origin){var d=a.operationFromAttributesChanges(c,this.cm);this.trigger("change",d[0],d[1])}};a.prototype.onCursorActivity=function(){this.trigger("cursorActivity")};a.prototype.onFocus=function(){this.trigger("focus")};a.prototype.onBlur=function(){this.cm.somethingSelected()||this.trigger("blur")};a.prototype.getValue=function(){return this.cm.getValue()};a.prototype.getCursor=function(){var a=this.cm,b=a.getCursor(),c=a.indexFromPos(b);if(a.somethingSelected())var d=a.getCursor(!0),b=0===(b.line<
d.line?-1:b.line>d.line?1:b.ch<d.ch?-1:b.ch>d.ch?1:0)?a.getCursor(!1):d,a=a.indexFromPos(b);else a=c;return new m(c,a)};a.prototype.setCursor=function(a){this.cm.setSelection(this.cm.posFromIndex(a.position),this.cm.posFromIndex(a.selectionEnd))};a.prototype.addStyleRule=function(a){if("undefined"!==typeof document&&null!==document){if(!this.addedStyleRules){this.addedStyleRules={};var b=document.createElement("style");document.documentElement.getElementsByTagName("head")[0].appendChild(b);this.addedStyleSheet=
b.sheet}if(!this.addedStyleRules[a])return this.addedStyleRules[a]=!0,this.addedStyleSheet.insertRule(a,0)}};a.prototype.setOtherCursor=function(a,b,c){var d=this.cm.posFromIndex(a.position);if("string"===typeof b&&b.match(/^#[a-fA-F0-9]{3,6}$/)){var f=this.rtcm.end();if("object"===typeof a&&"number"===typeof a.position&&"number"===typeof a.selectionEnd&&!(0>a.position||a.position>f||0>a.selectionEnd||a.selectionEnd>f)){var g=this.cm.cursorCoords(d),f=document.createElement("span");f.className="other-client";
f.id="cursorId"+c;f.style.borderLeftWidth="3px";f.style.borderLeftStyle="solid";f.style.borderLeftColor=b;f.style.marginLeft=f.style.marginRight="-3px";f.style.height=.9*(g.bottom-g.top)+"px";f.setAttribute("data-clientname",virtualclass.vutil.getUserInfo("name",c,virtualclass.connectedUsers));f.setAttribute("data-clientid",c);f.style.position="relative";g=document.getElementById("cursorId"+c);null!=g&&g.parentNode.removeChild(g);if(c!=virtualclass.gObj.uid){if(a.position===a.selectionEnd)return f.style.zIndex=
0,this.cm.setBookmark(d,{widget:f,insertLeft:!0});this.cm.setBookmark(d,{widget:f,insertLeft:!0});c="selection-"+b.replace("#","");this.addStyleRule("."+c+" { background: "+b+"; }");a.selectionEnd>a.position?(b=d,a=this.cm.posFromIndex(a.selectionEnd)):(b=this.cm.posFromIndex(a.selectionEnd),a=d);return this.cm.markText(b,a,{className:c})}}}};a.prototype.trigger=function(a){var b=Array.prototype.slice.call(arguments,1),c=this.callbacks&&this.callbacks[a];c&&c.apply(this,b)};a.prototype.applyOperation=
function(b){a.applyOperationToCodeMirror(b,this.rtcm)};a.prototype.registerUndo=function(a){this.cm.undo=a};a.prototype.registerRedo=function(a){this.cm.redo=a};a.prototype.invertOperation=function(a){for(var b=0,c=this.rtcm.codeMirror,d,m,w=new g,q=0;q<a.wrapped.ops.length;q++){var r=a.wrapped.ops[q];if(r.isRetain())if(f(r.attributes))w.retain(r.chars),b+=r.chars;else for(d=this.rtcm.getAttributeSpans(b,b+r.chars),m=0;m<d.length;m++){var u={},A;for(A in r.attributes){var K=r.attributes[A],H=d[m].attributes[A];
!1===K?H&&(u[A]=H):K!==H&&(u[A]=H||!1)}w.retain(d[m].length,u);b+=d[m].length}else if(r.isInsert())w["delete"](r.text.length);else if(r.isDelete()){u=c.getRange(c.posFromIndex(b),c.posFromIndex(b+r.chars));d=this.rtcm.getAttributeSpans(b,b+r.chars);for(m=K=0;m<d.length;m++)w.insert(u.substr(K,d[m].length),d[m].attributes),K+=d[m].length;b+=r.chars}}return new h(w,a.meta.invert())};return a}();c.Client=RichTextCodeMirrorAdapter})(window);otAdapter=function(){function c(a,b){b=b.charAt(0).toLowerCase()+b.slice(1);var c=Vceditor.getvcEditor();if(a.operations&&a.revision>a.operations.length){var f=[];f[a.revision-a.operations.length-1]=null;this.operations=f.concat(a.operations)}else this.operations=a.operations?a.operations:[];this.server=new c.Server(a.doc,this.operations);this.trigger=function(a){this.callbacks[a].apply(this,Array.prototype.slice.call(arguments,1))};this.teacherOT=function(a){a=this.doOT(a);"undefined"!=typeof a&&
this.preSend(a,!0)};this.doOT=function(a){if(1!==this.myOTrequestData)try{if("virtualclass-editor-operation"==a.eddata){var b=JSON.parse(a.data),f=new c.WrappedOperation(c.TextOperation.fromJSON(b.operation),b.cursor&&c.Cursor.fromJSON(b.cursor)),p=this.server.receiveOperation(b.revision,f);if(!p){console.log("there is some problem on revision of history");return}a.data=p.wrapped.toJSON();a.meta=p.meta}return a}catch(s){console.log("ERROR "+s),roles.isTeacher()&&(this.myOTrequestData=1,virtualclass[a.et].responseToRequest())}};
this.processOp=function(a){if(1!==this.myrequestData&&1!==this.myOTrequestData)try{var b=a.message;b.hasOwnProperty("edFrom")&&(a.fromUser.userid=b.edFrom);b.hasOwnProperty("eddata")?"virtualclass-editor-cursor"==b.eddata?this.trigger("cursor",a.fromUser.userid,JSON.parse(b.data)):"selection"==b.eddata?this.trigger("selection",virtualclass.gObj.uid,b.data):"virtualclass-editor-operation"==b.eddata&&(this.trigger("operation",b.data),this.trigger("cursor",a.fromUser.userid,b.meta),this.storeOperationIfStudent(b)):
console.log("Editor : processOP - No EDDATA")}catch(c){roles.hasAdmin()?(this.myOTrequestData=1,virtualclass[a.message.et].responseToRequest(),console.log("Teacher : send whlole editor data ")):(this.removeOperations(a),virtualclass[a.message.et].requestData(),this.myrequestData=1,console.log("Student : send whlole editor data "))}};this.storeOperationIfStudent=function(a){if(!roles.hasAdmin()){var b={};b.wrapped=c.TextOperation.fromJSON(a.data);b.meta=a.meta;this.server.operations.push(b)}};this.receivedMessage=
function(a){if(!virtualclass.isPlayMode||""===a.toUser){var b=a.message;if("t"!=a.fromUser.role&&"e"!=a.fromUser.role||b.hasOwnProperty("edFrom"))if(b.hasOwnProperty("edFrom")||"t"==a.fromUser.role||"e"==a.fromUser.role)if(b.edFrom==virtualclass.gObj.uid){if("virtualclass-editor-operation"==b.eddata)try{this.trigger("ack"),this.storeOperationIfStudent(b)}catch(c){1===ioMissingPackets.missRequestFlag&&(virtualclass[b.et].cmClient.revision--,this.processOp(a),console.log("Failed Acknolwdgement processOp()")),
console.log("ACK Too Late "+c)}}else this.processOp(a);else b=this.doOT(b),"undefined"!=typeof b&&(a.message=b,b.edFrom=a.fromUser.userid,this.preSend(b,!0));else if(roles.hasAdmin()){if("virtualclass-editor-operation"==b.eddata)try{this.trigger("ack")}catch(d){console.log("ACK Too Late "+d)}}else this.processOp(a)}};this.removeOperations=function(a){a=a.message.et;this.server.operations=[];this.server.document="";virtualclass[a].cmClient.revision=0;if(null!=b){var b=document.getElementById("virtualclassEditorRichBody");
b.parentNode.removeChild(b)}}}c.myrequestData=0;c.myOTrequestData=0;c.prototype.sendOperation=function(a,b,c,f){if("undefined"!=typeof f)var g="richtext"==f?"editorRich":"editorCode";b={eddata:"virtualclass-editor-operation",data:JSON.stringify({revision:a,operation:b,cursor:c}),et:g,cf:"eddata"};console.log("from send operation "+a);this.beforeSend(b);console.log("send operation")};c.prototype.sendSelection=function(a){this.beforeSend({eddata:"selection",data:JSON.stringify(a),cf:"eddata"})};c.prototype.sendCursor=
function(a){this.beforeSend({eddata:"virtualclass-editor-cursor",data:JSON.stringify(a),cf:"eddata"})};c.prototype.registerCallbacks=function(a){this.callbacks=a};c.prototype.beforeSend=function(a){if(1!=this.myrequestData)if(roles.hasAdmin())this.teacherOT(a);else{var b=virtualclass.vutil.whoIsTeacher();a=this.setEditorTypeOnPacket(a);ioAdapter.mustSendUser(a,b)}};c.prototype.setEditorTypeOnPacket=function(a){if(a.hasOwnProperty("eddata")&&"initVcEditor"!=a.eddata&&"virtualclass-editor-operation"!=
a.eddata)if("EditorRich"==virtualclass.currApp||"editorRich"==virtualclass.currApp)a.et="editorRich";else if("EditorCode"==virtualclass.currApp||"editorCode"==virtualclass.currApp)a.et="editorCode";return a};c.prototype.preSend=function(a,b){a=this.setEditorTypeOnPacket(a);"undefined"==typeof b||!1==b||null==b?ioAdapter.mustSend(a):ioAdapter.mustSendAll(a)};return c}();var Vceditor=function(){var c=c||{};c.utils=window.utils;c=c||{};c.Span=window.Span;c.TextOp=window.TextOp;c.TextOperation=window.TextOperation;"object"===typeof module&&(module.exports=c.TextOperation);c.AnnotationList=window.AnnotationList;c.Cursor=window.Cursor;c.RichTextToolbar=window.RichTextToolbar;c.WrappedOperation=window.WrappedOperation;c.UndoManager=window.UndoManager;c.Client=window.Client;Client=c.Client;c.EditorClient=window.EditorClient;c.utils.makeEventEmitter(c.EditorClient,["synced"]);
c.AttributeConstants=window.AttributeConstants;c.sentinelConstants={LINE_SENTINEL_CHARACTER:"\ue000",ENTITY_SENTINEL_CHARACTER:"\ue001"};c.EntityManager=function(){function a(){this.entities_={};var a="src alt width height style class".split(" ");this.register("img",{render:function(a){b.assert(a.src,"image entity should have 'src'!");for(var c="src alt width height style class".split(" "),d="<img ",m=0;m<c.length;m++){var p=c[m];p in a&&(d+=" "+p+'="'+a[p]+'"')}return d+">"},fromElement:function(b){for(var c=
{},h=0;h<a.length;h++){var m=a[h];b.hasAttribute(m)&&(c[m]=b.getAttribute(m))}return c}})}var b=c.utils;a.prototype.register=function(a,b){c.utils.assert(b.render,"Entity options should include a 'render' function!");c.utils.assert(b.fromElement,"Entity options should include a 'fromElement' function!");this.entities_[a]=b};a.prototype.renderToElement=function(a,b){return this.tryRenderToElement_(a,"render",b)};a.prototype.exportToElement=function(a){var b=this.tryRenderToElement_(a,"export")||this.tryRenderToElement_(a,
"getHtml")||this.tryRenderToElement_(a,"render");b.setAttribute("data-vceditor-entity",a.type);return b};a.prototype.updateElement=function(a,b){var c=a.type,h=a.info;this.entities_[c]&&"undefined"!=typeof this.entities_[c].update&&this.entities_[c].update(h,b)};a.prototype.fromElement=function(a){var b=a.getAttribute("data-vceditor-entity");b||(b=a.nodeName.toLowerCase());if(b&&this.entities_[b])return a=this.entities_[b].fromElement(a),new c.Entity(b,a)};a.prototype.tryRenderToElement_=function(a,
b,g){var h=a.type;a=a.info;if(this.entities_[h]&&this.entities_[h][b]&&(b=this.entities_[h][b](a,g,c.document||window&&window.document))){if("string"===typeof b)return h=(c.document||document).createElement("div"),h.innerHTML=b,h.childNodes[0];if("object"===typeof b)return c.utils.assert("undefined"!==typeof b.nodeType,"Error rendering "+h+" entity.  render() function must return an html string or a DOM element."),b}};a.prototype.entitySupportsUpdate=function(a){return this.entities_[a]&&this.entities_[a].update};
return a}();c=c||{};c.Entity=window.entity;c.Entity=function(){function a(b,c){if(!(this instanceof a))return new a(b,c);this.type=b;this.info=c||{}}var b=c.AttributeConstants.ENTITY_SENTINEL,d=b+"_";a.prototype.toAttributes=function(){var a={};a[b]=this.type;for(var c in this.info)a[d+c]=this.info[c];return a};a.fromAttributes=function(c){var g=c[b],h={},m;for(m in c)0===m.indexOf(d)&&(h[m.substr(d.length)]=c[m]);return new a(g,h)};return a}();c.RichTextCodeMirror=function(){function a(a,b,c){this.codeMirror=
a;this.options_=c||{};this.entityManager_=b;this.currentAttributes_=null;var d=this;this.annotationList_=new h(function(a,b){d.onAnnotationsChanged_(a,b)});this.initAnnotationList_();g(this,"onCodeMirrorBeforeChange_");g(this,"onCodeMirrorChange_");g(this,"onCursorActivity_");if(/^4\./.test(CodeMirror.version))this.codeMirror.on("changes",this.onCodeMirrorChange_);else this.codeMirror.on("change",this.onCodeMirrorChange_);this.codeMirror.on("beforeChange",this.onCodeMirrorBeforeChange_);this.codeMirror.on("cursorActivity",
this.onCursorActivity_);this.changeId_=0;this.outstandingChanges_={};this.dirtyLines_=[]}function b(a,b){return a.line-b.line||a.ch-b.ch}function d(a){if(0===a.length)return 0;for(var b=0,c=0;c<a.length;c++)b+=a[c].length;return b+a.length-1}function f(a){this.attributes=a||{}}function g(a,b){var c=a[b];a[b]=function(){c.apply(a,arguments)}}var h=c.AnnotationList,m=c.Span,p=c.utils,s=c.AttributeConstants,v={c:"color",bc:"background-color",fs:"font-size",li:function(a){return"padding-left: "+40*a+
"px"}},x={};p.makeEventEmitter(a,["change","attributesChange","newLine"]);var t=c.sentinelConstants.LINE_SENTINEL_CHARACTER,w=c.sentinelConstants.ENTITY_SENTINEL_CHARACTER;a.prototype.detach=function(){this.codeMirror.off("beforeChange",this.onCodeMirrorBeforeChange_);this.codeMirror.off("change",this.onCodeMirrorChange_);this.codeMirror.off("changes",this.onCodeMirrorChange_);this.codeMirror.off("cursorActivity",this.onCursorActivity_);this.clearAnnotations_()};a.prototype.toggleAttribute=function(a,
b){var c=b||!0;if(this.emptySelection_()){var d=this.getCurrentAttributes_();d[a]===c?delete d[a]:d[a]=c;this.currentAttributes_=d}else c=this.getCurrentAttributes_()[a]!==c?c:!1,this.setAttribute(a,c)};a.prototype.setAttribute=function(a,b){var c=this.codeMirror;this.emptySelection_()?(c=this.getCurrentAttributes_(),!1===b?delete c[a]:c[a]=b,this.currentAttributes_=c):(this.updateTextAttributes(c.indexFromPos(c.getCursor("start")),c.indexFromPos(c.getCursor("end")),function(c){!1===b?delete c[a]:
c[a]=b}),this.updateCurrentAttributes_())};a.prototype.updateTextAttributes=function(a,b,c,d,g){var h=[],p=a,t=this;this.annotationList_.updateSpan(new m(a,b-a),function(a,b){var m={},q;for(q in a.attributes)m[q]=a.attributes[q];m[s.LINE_SENTINEL]&&!g||c(m);q={};var r={};t.computeChangedAttributes_(a.attributes,m,q,r);var v;a:{for(v in q){v=!1;break a}v=!0}v||h.push({start:p,end:p+b,attributes:q,attributesInverse:r,origin:d});p+=b;return new f(m)});0<h.length&&this.trigger("attributesChange",this,
h)};a.prototype.computeChangedAttributes_=function(a,b,c,d){var f={},g;for(g in a)f[g]=!0;for(g in b)f[g]=!0;for(g in f)g in b?g in a?a[g]!==b[g]&&(c[g]=b[g],d[g]=a[g]):(c[g]=b[g],d[g]=!1):(c[g]=!1,d[g]=a[g])};a.prototype.toggleLineAttribute=function(a,b){var c=this.getCurrentLineAttributes_();this.setLineAttribute(a,a in c&&c[a]===b?!1:b)};a.prototype.setLineAttribute=function(a,b){this.updateLineAttributesForSelection(function(c){!1===b?delete c[a]:c[a]=b})};a.prototype.updateLineAttributesForSelection=
function(a){var b=this.codeMirror,c=b.getCursor("start"),d=b.getCursor("end"),c=c.line,f=d.line,b=b.getLine(f),d=this.areLineSentinelCharacters_(b.substr(0,d.ch));f>c&&d&&f--;this.updateLineAttributes(c,f,a)};a.prototype.updateLineAttributes=function(a,b,c){for(;a<=b;a++){var d=this.codeMirror.getLine(a),f=this.codeMirror.indexFromPos({line:a,ch:0});d[0]!==t?(d={},d[s.LINE_SENTINEL]=!0,c(d),this.insertText(f,t,d)):this.updateTextAttributes(f,f+1,c,null,!0)}};a.prototype.replaceText=function(a,b,c,
d,f){this.changeId_++;var g="cmrt-"+this.changeId_;this.outstandingChanges_[g]={origOrigin:f,attributes:d};d=this.codeMirror;a=d.posFromIndex(a);b="number"===typeof b?d.posFromIndex(b):null;d.replaceRange(c,a,b,g)};a.prototype.insertText=function(a,b,c,d){var f=this.codeMirror,g=f.getCursor(),h="RTCMADAPTER"==d&&!f.somethingSelected()&&a==f.indexFromPos(g);this.replaceText(a,null,b,c,d);h&&f.setCursor(g)};a.prototype.removeText=function(a,b,c){var d=this.codeMirror;d.replaceRange("",d.posFromIndex(a),
d.posFromIndex(b),c)};a.prototype.insertEntityAtCursor=function(a,b,c){var d=this.codeMirror,d=d.indexFromPos(d.getCursor("head"));this.insertEntityAt(d,a,b,c)};a.prototype.insertEntityAt=function(a,b,d,f){this.insertEntity_(a,new c.Entity(b,d),f)};a.prototype.insertEntity_=function(a,b,c){this.replaceText(a,null,w,b.toAttributes(),c)};a.prototype.getAttributeSpans=function(a,b){for(var c=[],d=this.annotationList_.getAnnotatedSpansForSpan(new m(a,b-a)),f=0;f<d.length;f++)c.push({length:d[f].length,
attributes:d[f].annotation.attributes});return c};a.prototype.end=function(){var a=this.codeMirror.lineCount()-1;return this.codeMirror.indexFromPos({line:a,ch:this.codeMirror.getLine(a).length})};a.prototype.getRange=function(a,b){var c=this.codeMirror.posFromIndex(a),d=this.codeMirror.posFromIndex(b);return this.codeMirror.getRange(c,d)};a.prototype.initAnnotationList_=function(){var a=this.end();0!==a&&this.annotationList_.insertAnnotatedSpan(new m(0,a),new f)};a.prototype.onAnnotationsChanged_=
function(a,b){var c,d={};this.tryToUpdateEntitiesInPlace(a,b);for(var f=0;f<a.length;f++)s.LINE_SENTINEL in a[f].annotation.attributes&&(d[this.codeMirror.posFromIndex(a[f].pos).line]=!0),(c=a[f].getAttachedObject())&&c.clear();for(f=0;f<b.length;f++){var g=b[f].annotation,h=s.LINE_SENTINEL in g.attributes,m=s.ENTITY_SENTINEL in g.attributes;c=this.codeMirror.posFromIndex(b[f].pos);h?d[c.line]=!0:m?this.markEntity_(b[f]):(g=this.getClassNameForAttributes_(g.attributes),""!==g&&(h=this.codeMirror.posFromIndex(b[f].pos+
b[f].length),c=this.codeMirror.markText(c,h,{className:g}),b[f].attachObject(c)))}for(var p in d)this.dirtyLines_.push(this.codeMirror.getLineHandle(Number(p))),this.queueLineMarking_()};a.prototype.tryToUpdateEntitiesInPlace=function(a,b){for(var c=a.length;c--;)for(var d=a[c],f=b.length;f--;){var g=b[f];if(d.pos==g.pos&&d.annotation.attributes.ent&&d.annotation.attributes.ent==g.annotation.attributes.ent&&this.entityManager_.entitySupportsUpdate(g.annotation.attributes.ent)){a.splice(c,1);b.splice(f,
1);var h=d.getAttachedObject();h.update(g.annotation.attributes);g.attachObject(h)}}};a.prototype.queueLineMarking_=function(){if(null==this.lineMarkTimeout_){var a=this;this.lineMarkTimeout_=setTimeout(function(){a.lineMarkTimeout_=null;for(var b=[],c=0;c<a.dirtyLines_.length;c++){var d=a.codeMirror.getLineNumber(a.dirtyLines_[c]);b.push(Number(d))}a.dirtyLines_=[];b.sort(function(a,b){return a-b});d=-1;for(c=0;c<b.length;c++){var f=b[c];f>d&&(d=a.markLineSentinelCharactersForChangedLines_(f,f))}},
0)}};a.prototype.addStyleWithCSS_=function(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a));b.appendChild(c)};a.prototype.getClassNameForAttributes_=function(a){var b="",d;for(d in a){var f=a[d];if(d===s.LINE_SENTINEL)c.utils.assert(!0===f,"LINE_SENTINEL attribute should be true if it exists.");else{var g=(this.options_.cssPrefix||"cmrt-")+d;if(!0!==f){d===s.FONT_SIZE&&
"string"!==typeof f&&(f+="px");var h=f.toString().toLowerCase().replace(/[^a-z0-9-_]/g,"-"),g=g+("-"+h);v[d]&&(x[d]||(x[d]={}),x[d][h]||(x[d][h]=!0,h=v[d],f="function"===typeof h?h(f):h+": "+f,this.addStyleWithCSS_((d==s.LINE_INDENT?"pre."+g:"."+g)+" { "+f+" }")))}b=b+" "+g}}return b};a.prototype.markEntity_=function(a){for(var b=c.Entity.fromAttributes(a.annotation.attributes),d=this.codeMirror,f=this,g=[],h=0;h<a.length;h++){var m=d.posFromIndex(a.pos+h),p=d.posFromIndex(a.pos+h+1),s={collapsed:!0,
atomic:!0,inclusiveLeft:!1,inclusiveRight:!1},t=this.createEntityHandle_(b,a.pos),v=this.entityManager_.renderToElement(b,t);v&&(s.replacedWith=v);m=d.markText(m,p,s);g.push(m);t.setMarker(m)}a.attachObject({clear:function(){for(var a=0;a<g.length;a++)g[a].clear()},update:function(a){a=c.Entity.fromAttributes(a);for(var b=0;b<g.length;b++)f.entityManager_.updateElement(a,g[b].replacedWith)}});this.queueRefresh_()};a.prototype.queueRefresh_=function(){var a=this;this.refreshTimer_||(this.refreshTimer_=
setTimeout(function(){a.codeMirror.refresh();a.refreshTimer_=null},0))};a.prototype.createEntityHandle_=function(a,b){function d(){if(f){var a=f.find();return a?g.codeMirror.indexFromPos(a.from):null}return b}var f=null,g=this;return{find:d,remove:function(){var a=d();null!=a&&(g.codeMirror.focus(),g.removeText(a,a+1))},replace:function(b){var f=c.AttributeConstants.ENTITY_SENTINEL,h=f+"_",m=d();g.updateTextAttributes(m,m+1,function(c){for(var d in c)delete c[d];c[f]=a.type;for(var g in b)c[h+g]=
b[g]})},setMarker:function(a){f=a}}};a.prototype.lineClassRemover_=function(a){var b=this.codeMirror,c=b.getLineHandle(a);return{clear:function(){b.removeLineClass(c,"text",".*")}}};a.prototype.emptySelection_=function(){var a=this.codeMirror.getCursor("start"),b=this.codeMirror.getCursor("end");return a.line===b.line&&a.ch===b.ch};a.prototype.onCodeMirrorBeforeChange_=function(a,b){if("+input"===b.origin||"paste"===b.origin){for(var c=[],d=0;d<b.text.length;d++){var f=b.text[d],f=f.replace(new RegExp("["+
t+w+"]","g"),"");c.push(f)}b.update(b.from,b.to,c)}};a.prototype.onCodeMirrorChange_=function(a,b){if("object"===typeof b.from){for(var c=[];b;)c.push(b),b=b.next;b=c}for(var c=this.convertCoordinateSystemForChanges_(b),d=[],g=0;g<c.length;g++){var h=c[g],p=h.start,s=h.text,t=h.removed,v=h.origin;if(0<t.length){for(var w=this.annotationList_.getAnnotatedSpansForSpan(new m(p,t.length)),x=0,fb=0;fb<w.length;fb++){var La=w[fb];d.push({start:p,end:p+La.length,removedAttributes:La.annotation.attributes,
removed:t.substr(x,La.length),attributes:{},text:"",origin:h.origin});x+=La.length}this.annotationList_.removeSpan(new m(p,t.length))}0<s.length&&("+input"===h.origin||"paste"===h.origin?h=this.currentAttributes_||{}:v in this.outstandingChanges_?(h=this.outstandingChanges_[v].attributes,v=this.outstandingChanges_[v].origOrigin,delete this.outstandingChanges_[v]):h={},this.annotationList_.insertAnnotatedSpan(new m(p,s.length),new f(h)),d.push({start:p,end:p,removedAttributes:{},removed:"",text:s,
attributes:h,origin:v}))}this.markLineSentinelCharactersForChanges_(b);0<d.length&&this.trigger("change",this,d)};a.prototype.convertCoordinateSystemForChanges_=function(a){function c(a,f){return function(c){if(0>=b(c,f.from))return a(c);if(0>=b(f.to,c)){var g=c.line+f.text.length-1-(f.to.line-f.from.line);if(f.to.line<c.line)c=c.ch;else if(1>=f.text.length)c=c.ch-(f.to.ch-f.from.ch)+d(f.text);else{var h=f.text;c=c.ch-f.to.ch+h[h.length-1].length}return a({line:g,ch:c})+d(f.removed)-d(f.text)}return f.from.line===
c.line?a(f.from)+c.ch-f.from.ch:a(f.from)+d(f.removed.slice(0,c.line-f.from.line))+1+c.ch}}for(var f=this,g=function(a){return f.codeMirror.indexFromPos(a)},h=[],m=a.length-1;0<=m;m--){var p=a[m],g=c(g,p),s=g(p.from),t=p.removed.join("\n"),v=p.text.join("\n");h.unshift({start:s,end:s+t.length,removed:t,text:v,origin:p.origin})}return h};a.prototype.markLineSentinelCharactersForChanges_=function(a){for(var b=Number.MAX_VALUE,c=-1,d=0;d<a.length;d++){var f=a[d],g=f.from.line;if(1<f.removed.length||
0<=f.removed[0].indexOf(t))b=Math.min(b,g),c=Math.max(c,g);1<f.text.length?(b=Math.min(b,g),c=Math.max(c,g+f.text.length-1)):0<=f.text[0].indexOf(t)&&(b=Math.min(b,g),c=Math.max(c,g))}c=Math.min(c,this.codeMirror.lineCount()-1);this.markLineSentinelCharactersForChangedLines_(b,c)};a.prototype.markLineSentinelCharactersForChangedLines_=function(a,b){if(a<Number.MAX_VALUE)for(;0<a&&this.lineIsListItemOrIndented_(a-1);)a--;if(-1<b)for(var c=this.codeMirror.lineCount();b+1<c&&this.lineIsListItemOrIndented_(b+
1);)b++;for(var c=[],d=this.codeMirror,f=a;f<=b;f++){var g=d.getLine(f),h=d.getLineHandle(f);d.removeLineClass(h,"text",".*");if(0<g.length)for(h=g.indexOf(t);0<=h;){for(var m=h;h<g.length&&g[h]===t;){for(var p=d.findMarksAt({line:f,ch:h}),s=0;s<p.length;s++)p[s].isForLineSentinel&&p[s].clear();h++}this.markLineSentinelCharacters_(f,m,h,c);h=g.indexOf(t,h)}else c=[]}return b};a.prototype.markLineSentinelCharacters_=function(a,b,c,d){var f=this.codeMirror,g=null,h=null,m=function(){var a=h.find();
return a?a.from.line:null};if(0===b){var p=this.getLineAttributes_(a),t=p[s.LIST_TYPE],v=p[s.LINE_INDENT]||0;for(t&&0===v&&(v=1);v>=d.length;)d.push(1);"o"===t?(g=this.makeOrderedListElement_(d[v]),d[v]++):"u"===t?(g=this.makeUnorderedListElement_(),d[v]=1):"t"===t?(g=this.makeTodoListElement_(!1,m),d[v]=1):"tc"===t&&(g=this.makeTodoListElement_(!0,m),d[v]=1);m=this.getClassNameForAttributes_(p);""!==m&&this.codeMirror.addLineClass(a,"text",m);d=d.slice(0,v+1)}d={inclusiveLeft:!0,collapsed:!0};g&&
(d.replacedWith=g);h=f.markText({line:a,ch:b},{line:a,ch:c},d);h.isForLineSentinel=!0};a.prototype.makeOrderedListElement_=function(a){return p.elt("div",a+".",{"class":"vceditor-list-left"})};a.prototype.makeUnorderedListElement_=function(){return p.elt("div","\u2022",{"class":"vceditor-list-left"})};a.prototype.toggleTodo=function(a){var b=s.LIST_TYPE,c=this.getCurrentLineAttributes_(),d;b in c&&("t"===c[b]||"tc"===c[b])?"t"===c[b]?d="tc":"tc"===c[b]&&(d=a?"t":!1):d="t";this.setLineAttribute(b,
d)};a.prototype.makeTodoListElement_=function(a,b){var c={type:"checkbox","class":"vceditor-todo-left"};a&&(c.checked=!0);var c=p.elt("input",!1,c),d=this;p.on(c,"click",p.stopEventAnd(function(a){d.codeMirror.setCursor({line:b(),ch:1});d.toggleTodo(!0)}));return c};a.prototype.lineIsListItemOrIndented_=function(a){a=this.getLineAttributes_(a);return!1!==(a[s.LIST_TYPE]||!1)||0!==(a[s.LINE_INDENT]||0)};a.prototype.onCursorActivity_=function(){var a=this;clearTimeout(a.cursorTimeout);a.cursorTimeout=
setTimeout(function(){a.updateCurrentAttributes_()},1)};a.prototype.getCurrentAttributes_=function(){this.currentAttributes_||this.updateCurrentAttributes_();return this.currentAttributes_};a.prototype.updateCurrentAttributes_=function(){var a=this.codeMirror,b=a.indexFromPos(a.getCursor("anchor")),d=a.indexFromPos(a.getCursor("head")),a=d;if(b>d){for(;a<this.end();){b=this.getRange(a,a+1);if("\n"!==b&&b!==t)break;a++}a<this.end()&&a++}else for(;0<a;){b=this.getRange(a-1,a);if("\n"!==b&&b!==t)break;
a--}b=this.annotationList_.getAnnotatedSpansForPos(a);this.currentAttributes_={};a={};0<b.length&&!(s.LINE_SENTINEL in b[0].annotation.attributes)?a=b[0].annotation.attributes:1<b.length&&(c.utils.assert(!(s.LINE_SENTINEL in b[1].annotation.attributes),"Cursor can't be between two line sentinel characters."),a=b[1].annotation.attributes);for(var f in a)"l"!==f&&"lt"!==f&&"li"!==f&&0!==f.indexOf(s.ENTITY_SENTINEL)&&(this.currentAttributes_[f]=a[f])};a.prototype.getCurrentLineAttributes_=function(){var a=
this.codeMirror,b=a.getCursor("anchor"),a=a.getCursor("head"),c=a.line;0===a.ch&&b.line<a.line&&c--;return this.getLineAttributes_(c)};a.prototype.getLineAttributes_=function(a){var b={},d=this.codeMirror.getLine(a);if(0<d.length&&d[0]===t){a=this.codeMirror.indexFromPos({line:a,ch:0});a=this.annotationList_.getAnnotatedSpansForSpan(new m(a,1));c.utils.assert(1===a.length);for(var f in a[0].annotation.attributes)b[f]=a[0].annotation.attributes[f]}return b};a.prototype.clearAnnotations_=function(){this.annotationList_.updateSpan(new m(0,
this.end()),function(a,b){return new f({})})};a.prototype.newline=function(){var a=this.codeMirror,b=this;if(this.emptySelection_()){var c=a.getCursor("head").line,d=this.getLineAttributes_(c),f=d[s.LIST_TYPE];f&&1===a.getLine(c).length?this.updateLineAttributes(c,c,function(a){delete a[s.LIST_TYPE];delete a[s.LINE_INDENT]}):(a.replaceSelection("\n","end","+input"),this.updateLineAttributes(c+1,c+1,function(a){for(var g in d)a[g]=d[g];"tc"===f&&(a[s.LIST_TYPE]="t");b.trigger("newLine",{line:c+1,attr:a})}))}else a.replaceSelection("\n",
"end","+input")};a.prototype.deleteLeft=function(){var a=this.codeMirror,b=a.getCursor("head"),c=this.getLineAttributes_(b.line),d=c[s.LIST_TYPE],c=c[s.LINE_INDENT],f=this.emptySelection_()&&1===b.ch;f&&d?this.updateLineAttributes(b.line,b.line,function(a){delete a[s.LIST_TYPE];delete a[s.LINE_INDENT]}):f&&c&&0<c?this.updateLineAttributes(b.line,b.line,function(a){a[s.LINE_INDENT]--}):a.deleteH(-1,"char")};a.prototype.deleteRight=function(){var a=this.codeMirror,b=a.getCursor("head"),c=a.getLine(b.line),
c=this.areLineSentinelCharacters_(c),d=b.line+1<a.lineCount()?a.getLine(b.line+1):"";this.emptySelection_()&&c&&d[0]===t?a.replaceRange("",{line:b.line,ch:0},{line:b.line+1,ch:0},"+input"):a.deleteH(1,"char")};a.prototype.indent=function(){this.updateLineAttributesForSelection(function(a){var b=a[s.LIST_TYPE];a[s.LINE_INDENT]?a[s.LINE_INDENT]++:a[s.LINE_INDENT]=b?2:1})};a.prototype.unindent=function(){this.updateLineAttributesForSelection(function(a){var b=a[s.LINE_INDENT];b&&1<b?a[s.LINE_INDENT]=
b-1:(delete a[s.LIST_TYPE],delete a[s.LINE_INDENT])})};a.prototype.getText=function(){return this.codeMirror.getValue().replace(new RegExp(t,"g"),"")};a.prototype.areLineSentinelCharacters_=function(a){for(var b=0;b<a.length;b++)if(a[b]!==t)return!1;return!0};f.prototype.equals=function(a){if(!(a instanceof f))return!1;for(var b in this.attributes)if(a.attributes[b]!==this.attributes[b])return!1;for(b in a.attributes)if(a.attributes[b]!==this.attributes[b])return!1;return!0};return a}();c=c||{};c.RichTextCodeMirrorAdapter=
window.RichTextCodeMirrorAdapter;c=c||{};c.Formatting=function(){function a(b){if(!(this instanceof a))return new a(b);this.attributes=b||{}}var b=c.AttributeConstants;a.prototype.cloneWithNewAttribute_=function(b,c){var g={},h;for(h in this.attributes)g[h]=this.attributes[h];!1===c?delete g[b]:g[b]=c;return new a(g)};a.prototype.bold=function(a){return this.cloneWithNewAttribute_(b.BOLD,a)};a.prototype.italic=function(a){return this.cloneWithNewAttribute_(b.ITALIC,a)};a.prototype.underline=function(a){return this.cloneWithNewAttribute_(b.UNDERLINE,
a)};a.prototype.strike=function(a){return this.cloneWithNewAttribute_(b.STRIKE,a)};a.prototype.font=function(a){return this.cloneWithNewAttribute_(b.FONT,a)};a.prototype.fontSize=function(a){return this.cloneWithNewAttribute_(b.FONT_SIZE,a)};a.prototype.color=function(a){return this.cloneWithNewAttribute_(b.COLOR,a)};a.prototype.backgroundColor=function(a){return this.cloneWithNewAttribute_(b.BACKGROUND_COLOR,a)};return a}();c=c||{};c.Text=function(){function a(b,d){if(!(this instanceof a))return new a(b,
d);this.text=b;this.formatting=d||c.Formatting()}return a}();c.LineFormatting=window.LineFormatting;c.Line=function(){function a(b,d){if(!(this instanceof a))return new a(b,d);"[object Array]"!==Object.prototype.toString.call(b)&&(b="undefined"===typeof b?[]:[b]);this.textPieces=b;this.formatting=d||c.LineFormatting()}return a}();c.ParseHtml=window.ParseHtml;c.SerializeHtml=Window.SerializeHtml;c.textPiecesToInserts=function(a,b){function d(b,d){b instanceof c.Text&&(d=b.formatting.attributes,b=b.text);
g.push({string:b,attributes:d});a="\n"===b[b.length-1]}function f(b){a&&d(c.sentinelConstants.LINE_SENTINEL_CHARACTER,b.formatting.attributes);for(var f=0;f<b.textPieces.length;f++)d(b.textPieces[f]);d("\n")}for(var g=[],h=0;h<b.length;h++)b[h]instanceof c.Line?f(b[h]):d(b[h]);return g};c=c||{};c.Vceditor=function(a){function b(a,c,f,g){if(!(this instanceof b))return new b(a,c,f,g);if(!q&&!r)throw Error("Couldn't find CodeMirror or ACE.  Did you forget to include codemirror.js or ace.js?");if(q&&
c instanceof q)this.codeMirror_=this.editor_=c,a=this.codeMirror_.getValue(),""!==a&&console.log("Can't initialize Vceditor with a CodeMirror instance that already contains text.");else if(r&&c&&c.session instanceof r.EditSession){if(this.ace_=this.editor_=c,a=this.ace_.getValue(),""!==a)throw Error("Can't initialize Vceditor with an ACE instance that already contains text.");}else this.codeMirror_=this.editor_=new q(c);a=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.vcEditorWrapper_=
w.elt("div",null,{"class":"vceditor"});a.parentNode.replaceChild(this.vcEditorWrapper_,a);this.vcEditorWrapper_.appendChild(a);w.on(a,"dragstart",w.stopEvent);this.editor_.vceditor=this;this.options_=f||{};this.getOption("richTextShortcuts",!1)&&(q.keyMap.richtext||this.initializeKeyMap_(),this.codeMirror_.setOption("keyMap","richtext"),this.vcEditorWrapper_.className+=" vceditor-richtext");this.imageInsertionUI=this.getOption("imageInsertionUI",!0);this.getOption("richTextToolbar",!1)&&(this.addToolbar_(),
this.vcEditorWrapper_.className+=" vceditor-richtext vceditor-with-toolbar");this.addPoweredByLogo_();this.codeMirror_&&this.codeMirror_.refresh();this.getOption("userColor",d("JqrwCaZm29-CLg-Pfz2"));this.entityManager_=new x;a=g.revision;c=[];this.codeMirror_?(this.richTextCodeMirror_=new m(this.codeMirror_,this.entityManager_,{cssPrefix:"vceditor-"}),this.editorAdapter_=new h(this.richTextCodeMirror_)):this.editorAdapter_=new s(this.ace_);f.hasOwnProperty("richTextToolbar")?(virtualclass.editorRich.vcAdapter=
new otAdapter(g,"EditorRich"),virtualclass.editorRich.cmClient=new v(a,c,virtualclass.editorRich.vcAdapter,this.editorAdapter_)):(virtualclass.editorCode.vcAdapter=new otAdapter(g,"EditorCode"),virtualclass.editorCode.cmClient=new v(a,c,virtualclass.editorCode.vcAdapter,this.editorAdapter_));"Microsoft Internet Explorer"==navigator.appName&&navigator.userAgent.match(/MSIE 8\./)&&(window.onload=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css";
b.styleSheet.cssText=":before,:after{content:none !important;}";a.appendChild(b);setTimeout(function(){a.removeChild(b)},0)})}function d(a){for(var b=1,c=0;c<a.length;c++)b=17*(b+a.charCodeAt(c))%360;return g(b/360,1,.85)}function f(a,b,c){function d(a){a=Math.round(255*a).toString(16);return 1===a.length?"0"+a:a}return"#"+d(a)+d(b)+d(c)}function g(a,b,c){if(0===b)return f(c,c,c);var d=.5>c?c*(1+b):c+b-b*c,g=2*c-d;b=function(a){0>a&&(a+=1);1<a&&(a-=1);return 1>6*a?g+6*(d-g)*a:1>2*a?d:2>3*a?g+6*(d-
g)*(2/3-a):g};return f(b(a+1/3),b(a),b(a-1/3))}if(!c.RichTextCodeMirrorAdapter)throw Error("Oops! It looks like you're trying to include lib/vceditor.js directly.  This is actually one of many source files that make up vceditor.  You want dist/vceditor.js instead.");var h=c.RichTextCodeMirrorAdapter,m=c.RichTextCodeMirror,p=c.RichTextToolbar,s=c.ACEAdapter,v=c.EditorClient,x=c.EntityManager,t=c.AttributeConstants,w=c.utils,q=a.CodeMirror,r=a.ace;w.makeEventEmitter(b);b.fromCodeMirror=b;b.fromACE=
b;b.prototype.dispose=function(){this.zombie_=!0;var a=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.vcEditorWrapper_.removeChild(a);this.vcEditorWrapper_.parentNode.replaceChild(a,this.vcEditorWrapper_);this.editor_.vceditor=null;this.codeMirror_&&"richtext"===this.codeMirror_.getOption("keyMap")&&this.codeMirror_.setOption("keyMap","default");this.vcAdapter.dispose();this.editorAdapter_.detach();this.richTextCodeMirror_&&this.richTextCodeMirror_.detach()};b.prototype.setUserId=
function(a){this.vcAdapter.setUserId(a)};b.prototype.setUserColor=function(a){this.vcAdapter.setColor(a)};b.prototype.getText=function(){this.assertReady_("getText");return this.codeMirror_?this.richTextCodeMirror_.getText():this.ace_.getSession().getDocument().getValue()};b.prototype.setText=function(a){if(this.ace_)return this.ace_.getSession().getDocument().setValue(a);this.codeMirror_.getWrapperElement().setAttribute("style","display: none");this.codeMirror_.setValue("");this.insertText(0,a);
this.codeMirror_.getWrapperElement().setAttribute("style","");this.codeMirror_.refresh()};b.prototype.insertTextAtCursor=function(a){this.insertText(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),a)};b.prototype.insertText=function(a,b){w.assert(!this.ace_,"Not supported for ace yet.");this.assertReady_("insertText");"[object Array]"!==Object.prototype.toString.call(b)&&(b=[b]);for(var d=c.textPiecesToInserts(0===a,b),f=0;f<d.length;f++){var g=d[f].string;this.richTextCodeMirror_.insertText(a,
g,d[f].attributes);a+=g.length}};b.prototype.getOperationForSpan=function(a,b){for(var d=this.richTextCodeMirror_.getRange(a,b),f=this.richTextCodeMirror_.getAttributeSpans(a,b),g=0,h=new c.TextOperation,m=0;m<f.length;m++)h.insert(d.substr(g,f[m].length),f[m].attributes),g+=f[m].length;return h};b.prototype.getHtml=function(){return this.getHtmlFromRange(null,null)};b.prototype.getHtmlFromSelection=function(){var a=this.codeMirror_.getCursor("start"),b=this.codeMirror_.getCursor("end"),a=this.codeMirror_.indexFromPos(a),
b=this.codeMirror_.indexFromPos(b);return this.getHtmlFromRange(a,b)};b.prototype.getHtmlFromRange=function(a,b){var d=null!=a&&null!=b?this.getOperationForSpan(a,b):this.getOperationForSpan(0,this.codeMirror_.getValue().length);return c.SerializeHtml(d,this.entityManager_)};b.prototype.insertHtml=function(a,b){var d=c.ParseHtml(b,this.entityManager_);this.insertText(a,d)};b.prototype.insertHtmlAtCursor=function(a){this.insertHtml(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),a)};b.prototype.setHtml=
function(a){a=c.ParseHtml(a,this.entityManager_);this.setText(a)};b.prototype.isHistoryEmpty=function(){this.assertReady_("isHistoryEmpty");return this.vcAdapter.isHistoryEmpty()};b.prototype.bold=function(){this.richTextCodeMirror_.toggleAttribute(t.BOLD);this.codeMirror_.focus()};b.prototype.italic=function(){this.richTextCodeMirror_.toggleAttribute(t.ITALIC);this.codeMirror_.focus()};b.prototype.underline=function(){this.richTextCodeMirror_.toggleAttribute(t.UNDERLINE);this.codeMirror_.focus()};
b.prototype.strike=function(){this.richTextCodeMirror_.toggleAttribute(t.STRIKE);this.codeMirror_.focus()};b.prototype.fontSize=function(a){this.richTextCodeMirror_.setAttribute(t.FONT_SIZE,a);this.codeMirror_.focus()};b.prototype.font=function(a){this.richTextCodeMirror_.setAttribute(t.FONT,a);this.codeMirror_.focus()};b.prototype.color=function(a){this.richTextCodeMirror_.setAttribute(t.COLOR,a);this.codeMirror_.focus()};b.prototype.highlight=function(){this.richTextCodeMirror_.toggleAttribute(t.BACKGROUND_COLOR,
"rgba(255,255,0,.65)");this.codeMirror_.focus()};b.prototype.align=function(a){if("left"!==a&&"center"!==a&&"right"!==a)throw Error('align() must be passed "left", "center", or "right".');this.richTextCodeMirror_.setLineAttribute(t.LINE_ALIGN,a);this.codeMirror_.focus()};b.prototype.orderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(t.LIST_TYPE,"o");this.codeMirror_.focus()};b.prototype.unorderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(t.LIST_TYPE,"u");this.codeMirror_.focus()};
b.prototype.todo=function(){this.richTextCodeMirror_.toggleTodo();this.codeMirror_.focus()};b.prototype.newline=function(){this.richTextCodeMirror_.newline()};b.prototype.deleteLeft=function(){this.richTextCodeMirror_.deleteLeft()};b.prototype.deleteRight=function(){this.richTextCodeMirror_.deleteRight()};b.prototype.indent=function(){this.richTextCodeMirror_.indent();this.codeMirror_.focus()};b.prototype.unindent=function(){this.richTextCodeMirror_.unindent();this.codeMirror_.focus()};b.prototype.undo=
function(){this.codeMirror_.undo()};b.prototype.redo=function(){this.codeMirror_.redo()};b.prototype.insertEntity=function(a,b,c){this.richTextCodeMirror_.insertEntityAtCursor(a,b,c)};b.prototype.insertEntityAt=function(a,b,c,d){this.richTextCodeMirror_.insertEntityAt(a,b,c,d)};b.prototype.registerEntity=function(a,b){this.entityManager_.register(a,b)};b.prototype.getOption=function(a,b){return a in this.options_?this.options_[a]:b};b.prototype.assertReady_=function(a){if(!this.ready_)throw Error('You must wait for the "ready" event before calling '+
a+".");if(this.zombie_)throw Error("You can't use a Vceditor after calling dispose()!");};b.prototype.makeImageDialog_=function(){this.makeDialog_("img","Insert image url")};b.prototype.makeDialog_=function(a,b){var c=this,d=w.elt("input",null,{"class":"vceditor-dialog-input",id:a,type:"text",placeholder:b,autofocus:"autofocus"}),f=w.elt("a","Submit",{"class":"vceditor-btn",id:"submitbtn"});w.on(f,"click",w.stopEventAnd(function(){var b=document.getElementById("overlay");b.style.visibility="hidden";
var d=document.getElementById(a).value;null!==d&&c.insertEntity(a,{src:d});c.vcEditorWrapper_.removeChild(b)}));var g=w.elt("a","Cancel",{"class":"vceditor-btn"});w.on(g,"click",w.stopEventAnd(function(){var a=document.getElementById("overlay");a.style.visibility="hidden";c.vcEditorWrapper_.removeChild(a)}));f=w.elt("div",[f,g],{"class":"vceditor-btn-group"});d=w.elt("div",[d,f],{"class":"vceditor-dialog-div"});d=w.elt("div",[d],{"class":"vceditor-dialog",id:"overlay"});this.vcEditorWrapper_.appendChild(d)};
b.prototype.addToolbar_=function(){this.toolbar=new p(this.imageInsertionUI);this.toolbar.on("undo",this.undo,this);this.toolbar.on("redo",this.redo,this);this.toolbar.on("bold",this.bold,this);this.toolbar.on("italic",this.italic,this);this.toolbar.on("underline",this.underline,this);this.toolbar.on("strike",this.strike,this);this.toolbar.on("font-size",this.fontSize,this);this.toolbar.on("font",this.font,this);this.toolbar.on("color",this.color,this);this.toolbar.on("left",function(){this.align("left")},
this);this.toolbar.on("center",function(){this.align("center")},this);this.toolbar.on("right",function(){this.align("right")},this);this.toolbar.on("ordered-list",this.orderedList,this);this.toolbar.on("unordered-list",this.unorderedList,this);this.toolbar.on("todo-list",this.todo,this);this.toolbar.on("indent-increase",this.indent,this);this.toolbar.on("indent-decrease",this.unindent,this);this.toolbar.on("insert-image",this.makeImageDialog_,this);this.vcEditorWrapper_.insertBefore(this.toolbar.element(),
this.vcEditorWrapper_.firstChild)};b.prototype.addPoweredByLogo_=function(){};b.prototype.initializeKeyMap_=function(){function a(b){return function(a){setTimeout(function(){b.call(a.vceditor)},0)}}this.getOption("readOnly")?q.keyMap.richtext={fallthrough:["default"]}:q.keyMap.richtext={"Ctrl-B":a(this.bold),"Cmd-B":a(this.bold),"Ctrl-I":a(this.italic),"Cmd-I":a(this.italic),"Ctrl-U":a(this.underline),"Cmd-U":a(this.underline),"Ctrl-H":a(this.highlight),"Cmd-H":a(this.highlight),Enter:a(this.newline),
Delete:a(this.deleteRight),Backspace:a(this.deleteLeft),Tab:a(this.indent),"Shift-Tab":a(this.unindent),fallthrough:["default"]}};return b}(this);c.Vceditor.Formatting=c.Formatting;c.Vceditor.Text=c.Text;c.Vceditor.Entity=c.Entity;c.Vceditor.LineFormatting=c.LineFormatting;c.Vceditor.Line=c.Line;c.Vceditor.TextOperation=c.TextOperation;c.Vceditor.RichTextCodeMirrorAdapter=c.RichTextCodeMirrorAdapter;c.Server=Server;c.Vceditor.getvcEditor=function(){return c};return c.Vceditor}();window.Vceditor=Vceditor;(function(c){var a=function(a){return a.map(function(a){return{operation:a.wrapped.toJSON()}})},b=function(a){var b=Vceditor.getvcEditor();return a.map(function(a){return new b.WrappedOperation(b.TextOperation.fromJSON(a.operation),a.cursor&&b.Cursor.fromJSON(a.cursor))})};c.editor=function(c,f,g){this.etype=c;if("editorRich"==c)var h={lineWrapping:!0},m={richTextToolbar:!0,richTextShortcuts:!0,readOnly:!1};else h={lineNumbers:!0,mode:"markdown",readOnly:!1},m={defaultText:"Markdown Editor "};return{etype:c,
cm:"",vcAdapter:"",initialised:!1,prvEdRev:0,dataReqTry:0,stroageData:localStorage.getItem(this.etype+"_allEditorOperations"),tempstroageDataRev:localStorage.getItem(this.etype+"_edOperationRev"),readonly:!1,veryInit:function(){if(null!=this.stroageData&&""!=this.stroageData){this.stroageDataRev=null==this.tempstroageDataRev?0:this.tempstroageDataRev;var a=JSON.parse(this.stroageData),a=JSON.parse(a.data);console.log("Current Editor type "+virtualclass.currAppEditorType);virtualclass.hasOwnProperty("currAppEditor")?
virtualclass.currAppEditorType==this.etype?this.initialiseDataWithEditor(a,"displayEditor",virtualclass.currAppEditorType):this.initialiseDataWithEditor(a):this.initialiseDataWithEditor(a)}virtualclass.gObj.editorInitDone++},init:function(a,b,c,d){var f={};"undefined"!=typeof a&&(f.revision=a);"undefined"!=typeof b&&(f.clients=b);"undefined"!=typeof c&&(f.doc=c);"undefined"!=typeof d&&(f.operations=d);this.cm||"object"==typeof this.cm?virtualclass.dispvirtualclassLayout(virtualclass.currApp):(this.codemirrorWithLayout(h),
this.createEditorClient(m,f));roles.hasControls()?(roles.hasAdmin()&&this.createAllEditorController(),ioAdapter.mustSendAll({eddata:"init",et:this.etype,cf:"eddata"})):roles.hasAdmin()&&this.createAllEditorController()},createAllEditorController:function(){var a=this.etype,b="all"+a+"Container";if(null==document.getElementById(b)){var c="enable",d=document.createElement("div");d.id=b;d["class"]="editorController";var f=document.createElement("a");f.id=d.id+"Anch";f.href="#";f.innerHTML="Enable All";
f.dataset.action=c;d.appendChild(f);a=virtualclass.vutil.capitalizeFirstLetter(a);document.getElementById("virtualclass"+a+"Body").appendChild(d);f.addEventListener("click",function(){var d=document.getElementById(b+"Anch");null!=d&&(c=d.dataset.action,"enable"==d.dataset.action?(d.dataset.action="disable",d.innerHTML="Disable All"):(d.dataset.action="enable",d.innerHTML="Enable All"));virtualclass.user.control.toggleAllEditorController.call(virtualclass.user,a,c)})}},createEditorClient:function(a,
b){roles.hasAdmin()&&(this.cm.setOption("readOnly",!1),this.createAllEditorController(),a.readOnly=!1);virtualclass.isPlayMode&&(this.readOnlyMode("enable","notCreateSyncBox"),this.cm.setOption("readOnly","nocursor"));Vceditor.fromCodeMirror({},this.cm,a,b);console.log("Creating Rich Text Layout")},codemirrorWithLayout:function(a){this.UI.container(this.etype);document.getElementById(this.UI.edId);"object"!=typeof this.cm&&(console.log("Code mirror instance is created "),this.cm=CodeMirror(document.getElementById(this.UI.edId),
a))},requestData:function(){var a=virtualclass.vutil.whoIsTeacher();this.readOnlyMode("enable");ioAdapter.mustSendUser({eddata:"requestForEditorData",et:this.etype,cf:"eddata"},a)},readOnlyMode:function(a,b){"object"==typeof this.cm&&("enable"==a?this.readonly||(this.cm.setOption("readOnly","nocursor"),"undefined"==typeof b&&this.UI.createSynchMessageBox(),this.readonly="nocursor"):this.readonly&&!virtualclass.isPlayMode&&(this.cm.setOption("readOnly",!1),this.readonly=!1,this.UI.hideSynchMessageBox()),
virtualclass.vutil.setReadModeWhenTeacherIsDisConn(virtualclass.vutil.smallizeFirstLetter(this.etype)))},isVcAdapterIsReady:function(a){return virtualclass[a].hasOwnProperty("vcAdapter")&&"object"==typeof virtualclass[a].vcAdapter},receivedOperations:{currAppEditor:function(a){a.fromUser.userid!=virtualclass.gObj.userid&&(console.log("curr app editor"),virtualclass.currAppEditor=!0,virtualclass.currAppEditorType=a.message.et,virtualclass.dispvirtualclassLayout(virtualclass.currAppEditorType))},init:function(a,
b){a.fromUser.userid==virtualclass.gObj.uid&&"1"!=wbUser.virtualclassPlay||virtualclass.makeAppReady(b)},initVcEditor:function(a){console.log("received whole data");roles.hasView()&&"function"==typeof virtualclass[a.message.et].vcAdapter.removeOperations&&virtualclass[a.message.et].vcAdapter.removeOperations(a);if(!roles.hasControls()||roles.hasControls()&&a.fromUser.userid!=virtualclass.gObj.uid&&(a.message.hasOwnProperty("resFromUser")||a.message.hasOwnProperty("allEdData"))){var b=JSON.parse(a.message.data);
a.message.hasOwnProperty("layoutEd")?this.initialiseDataWithEditor(b,a.message):this.initialiseDataWithEditor(b)}},requestForEditorData:function(a){a.fromUser.userid!=virtualclass.gObj.uid?"object"!=typeof this.vcAdapter||0==this.vcAdapter.operations.length?ioAdapter.mustSendAll({eddata:"noDataForEditor",cf:"eddata"}):this.responseToRequest(a.fromUser.userid):console.log("Cannot send requestForEditorData to self")},noDataForEditor:function(){roles.hasControls()},"virtualclass-editor-operation":function(a){"object"==
typeof this.vcAdapter&&(this.readOnlyMode("disable"),this.vcAdapter.receivedMessage(a))},"virtualclass-editor-cursor":function(a){"object"==typeof this.vcAdapter&&this.vcAdapter.receivedMessage(a)},select:function(){"object"==typeof this.vcAdapter&&this.vcAdapter.receivedMessage(e)}},onmessage:function(a,b){this.receivedOperations[a.message.eddata].call(this,a,b);"object"!=typeof this.vcAdapter&&(roles.hasAdmin()&&"virtualclass-editor-operation"==a.message.eddata&&(virtualclass.makeAppReady(b),this.vcAdapter.receivedMessage(a,
onmessage)),console.log("virtualclass adapter is not ready for editor"))},UI:{id:f,"class":"vmApp virtualclass",edId:g,container:function(a){if(null==document.getElementById(this.id)){var b=document.createElement("div");b.id=this.id;b.className=this["class"]+" "+a;a=document.createElement("div");a.id=this.edId;b.appendChild(a);a=document.getElementById(virtualclass.rWidgetConfig.id);document.getElementById(virtualclass.html.id).insertBefore(b,a)}},createSynchMessageBox:function(){if(null!=document.getElementById("synchMessageBox"))this.showSynchMessageBox();
else{var a=document.createElement("div");a.id="synchMessageBox";a.style.width="340px";a.style.height="15px";var b=document.createElement("p");b.id="readOnlyMsg";b.innerHTML=virtualclass.lang.getString("synchMessage");a.appendChild(b);b=document.getElementById(this.id);b.insertBefore(a,b.firstChild)}},showSynchMessageBox:function(){var a=document.getElementById("synchMessageBox");null!=a&&(a.style.display="block")},hideSynchMessageBox:function(){var a=document.getElementById("synchMessageBox");null!=
a&&(a.style.display="none")}},responseToRequest:function(a){var b=this.getWrappedOperations(!0);b.layoutEd="1";roles.isTeacher()&&(b.capp=virtualclass.currApp);b.et=this.etype;a?(b.resFromUser=!0,ioAdapter.mustSendUser(b,a),console.log("Sending responseToRequest to "+a)):(b.allEdData=!0,ioAdapter.mustSend(b),console.log("Sending responseToRequest to all"),virtualclass[b.et].vcAdapter.removeOperations({message:{et:b.et}}),a=JSON.parse(b.data),virtualclass[b.et].initialiseDataWithEditor(a),virtualclass[b.et].vcAdapter.myOTrequestData=
0)},isEidtorWithTeacher:function(){return roles.hasControls()&&("EditorRich"==virtualclass.currApp||"EditorCode"==virtualclass.currApp)},getWrappedOperations:function(b){b=this.vcAdapter&&this.vcAdapter.operations?a(this.vcAdapter.operations):[];return{eddata:"initVcEditor",data:JSON.stringify({operations:b}),et:this.etype,cf:"eddata"}},getStudentAllText:function(){return this.cm.getValue("\n")},removeCodeMirror:function(){this.readonly=!1;var a=document.getElementById(this.UI.id);null!=a&&a.parentNode.removeChild(a);
this.cm=""},setReadMode:function(){var a=JSON.parse(localStorage.getItem(this.etype));roles.hasAdmin()||(null!=a?a?(this.cm.setOption("readOnly",!1),a=!0):(this.cm.setOption("readOnly","nocursor"),a=!1):(this.cm.setOption("readOnly","nocursor"),a=!1),virtualclass.user.control.toggleDisplayWriteModeMsgBox(virtualclass.vutil.capitalizeFirstLetter(this.etype),a),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(virtualclass.vutil.smallizeFirstLetter(this.etype)))},writeBulkDocs:function(a){var c=b(a.operations);
a.revision=0;if(this.cm){if(this.cm.getValue()!==a.str||""==a.str)this.vcAdapter=this.cmClient="",a.operations=[],a.doc="";this.createEditorClient(m,a);this.prvEdRev=a.revision}for(a=0;a<c.length;a++)virtualclass[this.etype].vcAdapter.server.receiveOperation(a,c[a]),this.vcAdapter.trigger("operation",c[a].wrapped.toJSON())},initialiseDataWithEditor:function(a,c){b(a.operations);"undefined"!=typeof c&&c.hasOwnProperty("capp")&&(virtualclass.currApp=virtualclass.vutil.capitalizeFirstLetter(c.capp));
this.removeCodeMirror();this.codemirrorWithLayout(h);virtualclass.dispvirtualclassLayout(virtualclass.currApp);this.writeBulkDocs(a);this.cm.refresh();this.setReadMode();var d=virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp);"EditorRich"==d||"EditorCode"==d?(virtualclass.previous="virtualclass"+virtualclass.currApp,virtualclass.system.setAppDimension(virtualclass.currApp)):(d=document.getElementById("virtualclassEditorRich"),null!=d&&(d.style.display="none"),d=document.getElementById("virtualclassEditorCode"),
null!=d&&(d.style.display="none"));d=document.getElementById("virtualclassEditorTool");null!=d&&(d.style.pointerEvents="visible");otAdapter.myrequestData=0},removeEditorData:function(){"object"==typeof this.cm&&("object"==typeof this.vcAdapter&&(this.vcAdapter.operations.length=0),this.removeCodeMirror(),localStorage.removeItem(this.etype+"_allEditorOperations"),localStorage.removeItem(this.etype+"_edOperationRev"))},saveIntoLocalStorage:function(){if("object"==typeof this.vcAdapter&&0<this.vcAdapter.operations.length){var a=
this.getWrappedOperations();localStorage.removeItem(this.etype+"_allEditorOperations");localStorage.setItem(this.etype+"_allEditorOperations",JSON.stringify(a));localStorage.setItem(this.etype+"_edOperationRev",this.cmClient.revision)}}}}})(window);(function(c,a){c.Chat=function(){return{init:function(){this.chatroombox=null;this.counter=0;this.idList=[];a.htab=[];a.htabIndex=[];this.vmstorage={};a("body").footerbar();"false"==localStorage.getItem("init")&&(a("#stickybar").removeClass("maximize").addClass("minimize"),a("#hide_bar input").removeClass("close").addClass("expand"));tabs=a("#tabs").tabs({cache:!0,activeOnAdd:!0});!1==browserSupportsLocalStorage()?alert(lang.sterror):(this.history(),this.UI.privateChatBox.init(),a("ul.tabs").on("click, focus",
"li",function(){a("li[aria-controls='"+a(this).attr("id")+"']").removeClass("ui-state-highlight")}))},history:function(){var a=null;null!=localStorage.getItem(wbUser.sid)&&(displayPvtChatHistory(),a=localStorage.getItem("chatEnable"),null!=a&&"false"==a&&virtualclass.user.control.disbaleAllChatBox(),this.vmstorage=JSON.parse(localStorage.getItem(wbUser.sid)));0<localStorage.length&&(displaycomChatHistory(),virtualclass.chat.removeChatHighLight("chatrm"),null!=a&&"false"==a&&virtualclass.user.control.disableCommonChat())},
UI:{privateChatBox:{init:function(){a("#tabs").delegate("span.icon-close","click",this.close);a("#tabs").on("click","li a",this.toggle)},close:function(){var b=a(this).closest("li").attr("id").substring(5);a("#"+b).chatbox("option").boxClosed(b);a("div#cb"+b+".ui-widget").hide();var c=a(this).closest("li").remove().attr("aria-controls");a("#"+c).remove();delete virtualclass.chat.vmstorage[b]},toggle:function(){var b=a(this).closest("li").attr("id").substring(5);a("#"+b).chatbox("toggleContentbox");
"hidden"==localStorage.getItem(b)?localStorage.removeItem(b):localStorage.setItem(b,"hidden")}}},removedPrvLoggedInDetail:function(){a(".ui-memblist").remove();a(".ui-chatbox").remove();a("div#chatrm").remove();virtualclass.chat.chatroombox=null;for(key in io.uniquesids)key!=io.cfg.userid&&(chatboxManager.delBox(key),a("li#tabcb"+key).remove());this.idList=0;a("#stickybar").removeClass("maximize").addClass("minimize");tabs.tabs("refresh")},removeCookieUserInfo:function(a){document.cookie="auth_user=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";
document.cookie="auth_pass=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";document.cookie="path=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";display_error(a.message)},makeUserListEmpty:function(){a("#user_list .inner_bt #usertab_icon").css({background:"url("+c.whiteboardPath+"images/offline.png)no-repeat top left"});a("#user_list .inner_bt #usertab_text").html("<span id='onlineusertext'>"+lang.whos+" (0) </span> <span id='usertab_toogle_icon' class='icon-arrow-up'></span>");a("#chatroom_bt .inner_bt #chatroom_text").text(lang.chatroom+
" (0)");a("div#memlist").css("display","none")},removeChatHighLight:function(a){a=document.getElementById(a);if(null!=a){a=a.getElementsByClassName("ui-state-highlight");for(var c=0;c<a.length;c++)a[c].classList.remove("ui-state-highlight")}}}}})(window,$);(function(c){c.widget("ui.footerbar",{options:{id:null,offset:0,width:"100%",barscroll:c(window).width()-430,boxClosed:function(a){}},init:function(a){this.elem=a},widget:function(){return this.uiFooterbar},_create:function(){var a=(this.uiFooterbar=c("<div></div>")).appendTo(document.getElementById("stickycontainer")).prop("id","stickybar").addClass("maximize"),b=(this.uiFooterbarchatroomtab=c("<div></div>")).addClass("vmchat_room_bt tooltip").attr("data-title",virtualclass.lang.getString("maxCommonChat")).prop("id",
"chatroom_bt2").appendTo(a),d=(this.uiFooterbarchatroomContent=c('<div class = "inner_bt"></div>')).appendTo(b);uiFooterbarchatroomIcon=(this.uiFooterbarchatroomIcon=c('<div id = "chatroom_icon"><span class="icon-chatroom"></span></div>')).appendTo(d);uiFooterbarchatroomText=(this.uiFooterbarchatroomText=c('<div id = "chatroom_text"></div>')).appendTo(d).html('Chatroom <span id="cc_arrow_button" class="icon-arrow-up"></span>').click(function(){if(virtualclass.chat.chatroombox)toggleCommonChatBox();
else if(0==c("div#chat_room").length){var a=document.createElement("div");a.id="chat_room";document.body.appendChild(a);virtualclass.chat.chatroombox=c("#chat_room").chatroom({id:"chat_room",user:{name:"test"},title:lang.chatroom_header,offset:"20px",messageSent:function(a,b){c("#chat_room").chatroom("option","boxManager").addMsg(a.name,b)}});virtualclass.gObj.hasOwnProperty("chatEnable")&&!virtualclass.gObj.chatEnable&&(a=document.getElementById("chatrm"),null!=a&&virtualclass.user.control.makeElemDisable(a));
a=document.getElementById("cc_arrow_button");a.classList.add("icon-arrow-down");a.classList.remove("icon-arrow-up");b.attr("data-title",virtualclass.lang.getString("minCommonChat"))}});uiFooterbarUserlisttab=(this.uiFooterbarUserlisttab=c("<div></div>")).addClass("vmchat_bar_button").prop("id","user_list").appendTo(a);uiFooterbarUserlistContent=(this.uiFooterbarUserlistContent=c('<div class="inner_bt"></div>')).appendTo(uiFooterbarUserlisttab);uiFooterbarUserlistIcon=(this.uiFooterbarUserlistIcon=
c('<div id="usertab_icon"></div>')).appendTo(uiFooterbarUserlistContent);uiFooterbarUserlistText=(this.uiFooterbarUserlistText=c('<div id="usertab_text" class="tooltip close " data-title="'+virtualclass.lang.getString("maxUserList")+'"></div>')).appendTo(uiFooterbarUserlistContent).text("Private Chat").click(function(){virtualclass.gObj.video.dispAllVideo("chat_div");0<Object.keys(io.uniquesids).length&&(c(this).hasClass("close")?(c(this).addClass("open"),c(this).removeClass("close"),c("#usertab_toogle_icon").addClass("icon-arrow-down"),
c("#usertab_toogle_icon").removeClass("close icon-arrow-up"),c(this).attr("data-title",virtualclass.lang.getString("miniUserList"))):(c(this).addClass("close"),c(this).removeClass("open"),c("#usertab_toogle_icon").addClass("icon-arrow-up"),c("#usertab_toogle_icon").removeClass("icon-arrow-down"),c(this).attr("data-title",virtualclass.lang.getString("maxUserList"))),c("#chat_div").memberlist("option","boxManager").toggleBox())});uiFooterbartabCont=(this.uiFooterbartabCont=c("<div></div>")).attr("id",
"tabs").addClass("tabs-bottom").appendTo(a);uiFooterbartabs=(this.uiFooterbartabs=c('<ul class="tabs"></ul>')).appendTo(uiFooterbartabCont);this._setWidth(this.options.width);this.init(this)},destroy:function(){this.element.remove();this._destroy()},_setWidth:function(a){this.uiFooterbar.width(a+"px")}})})(jQuery);
(function(c){c.fn.clickToggle=function(a,b){var d=[a,b];this.data("toggleclicked",0);this.click(function(){var a=c(this).data(),b=a.toggleclicked;c.proxy(d[b],this)();a.toggleclicked=(b+1)%2});return this}})(jQuery);(function(c){c.widget("ui.memberlist",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,userSent:function(a){this.boxManager.addUsr(a.name)},boxClosed:function(a){},boxManager:{init:function(a){this.elem=a},addUsr:function(a){var b=this.elem.uiChatboxLog,d=document.getElementById("ml"+a.userid);null!=d&&d.parentNode.removeChild(d);d=document.createElement("div");d.className+="userImg";b.append(d);if(a){b=document.createElement("a");b.href="#"+a.userid;b.classList.add("tooltip");
b.setAttribute("data-title","Click to chat");var f=document.createElement("img");f.src=a.img;b.appendChild(f);f=document.createElement("span");void 0==a.lname&&(a.lname="");c(f).text(a.name+" "+a.lname);b.appendChild(f);d.appendChild(b);b=["assign","audio","chat","editorRich","editorCode"];a.userid!=wbUser.id&&(b=virtualclass.user.createControl(a.userid,b),d.appendChild(b),virtualclass.user.control.shouldApply.call(virtualclass.user,a.userid));null==roles.hasControls()||roles.hasAdmin()||a.userid!=
localStorage.getItem("aId")||(b=["assign"],f=document.getElementById(a.userid+"ControlContainer"),null!=f?virtualclass.user.createAssignControl(f,a.userid,!0):(f=document.getElementById("ml"+a.userid),b=virtualclass.user.createControl(a.userid,b),f.appendChild(b)))}c(d).addClass("ui-memblist-usr");c(d).attr("id","ml"+a.userid);c(d).fadeIn();this._scrollToBottom();d=localStorage.getItem("chatEnable");null!=d&&"false"==d&&virtualclass.user.control.disableOnLineUser();virtualclass.gObj.uid==a.userid&&
(a=document.getElementById("ml"+virtualclass.gObj.uid),null!=a&&a.classList.add("mySelf"))},highlightBox:function(){var a=this;a.elem.uiChatboxTitlebar.effect("highlight",{},300);a.elem.uiChatbox.effect("bounce",{times:3},300,function(){a.highlightLock=!1;a._scrollToBottom()})},toggleBox:function(){this.elem.uiChatbox.toggle("slide",{direction:"down"},1E3)},_scrollToBottom:function(){var a=this.elem.uiChatboxLog;a.scrollTop(a.get(0).scrollHeight)}}},toggleContent:function(a){this.uiChatboxContent.toggle();
this.uiChatboxContent.is(":visible")},widget:function(){return this.uiChatbox},_create:function(){var a=this,b=a.options.title||"No Title",d=(a.uiChatbox=c("<div></div>")).appendTo(document.getElementById("chatWidget")).addClass("ui-widget ui-corner-top ui-memblist").attr("id","memlist").css("display","none").focusin(function(){a.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){a.uiChatboxTitlebar.removeClass("ui-state-focus")}),f=(a.uiChatboxTitlebar=c("<div></div>")).addClass("ui-widget-header ui-corner-top ui-memblist-titlebar ui-dialog-header").click(function(a){}).appendTo(d);
(a.uiChatboxTitle=c("<span></span>")).html('<span class="icon-user"> </span>'+b).appendTo(f);var g=(a.uiChatboxTitlebarClose=c('<a href="#"></a>')).addClass("ui-corner-all ui-memblist-icon ").attr("role","button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")});uiChatboxTitlebarMinimize=(a.uiChatboxTitlebarMinimize=c('<a href="#"></a>')).addClass("ui-corner-all ui-memblist-icon").attr("role","button").hover(function(){uiChatboxTitlebarMinimize.addClass("ui-state-hover")},
function(){uiChatboxTitlebarMinimize.removeClass("ui-state-hover")}).click(function(a){c("#chat_div").memberlist("option","boxManager").toggleBox();a=c("#usertab_text");var b=c("#usertab_toogle_icon");a.hasClass("close")?(a.addClass("open"),a.removeClass("close"),a.attr("data-title",virtualclass.lang.getString("miniUserList")),b.addClass("icon-arrow-down"),b.removeClass("close icon-arrow-up")):(a.addClass("close"),a.removeClass("open"),a.attr("data-title",virtualclass.lang.getString("maxUserList")),
b.addClass("icon-arrow-up"),b.removeClass("icon-arrow-down"));return!1}).appendTo(f);uiChatboxTitlebarMinimizeText=c("<span></span>").addClass("ui-icon icon-minus").text("").appendTo(uiChatboxTitlebarMinimize);uiChatboxContent=(a.uiChatboxContent=c("<div></div>")).addClass("ui-widget-content ui-memblist-content ").appendTo(d);uiChatboxLog=(a.uiChatboxLog=a.element).addClass("ui-widget-content ui-memblist-log").appendTo(uiChatboxContent).focusin(function(){var a=c(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)});
f.find("*").add(f).disableSelection();c(document).on("click","#chat_div .ui-memblist-usr a",function(a){a=c(this);var b=a.attr("href");"undefined"!=typeof b&&(b=b.replace("#",""),a=a.find("span").html(),-1==c.inArray(b,virtualclass.chat.idList)&&(virtualclass.chat.counter++,virtualclass.chat.idList.push(b),virtualclass.chat.vmstorage[b]=[],virtualclass.chat.vmstorage[b].push({userid:b,name:a})),chatboxManager.addBox(b,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,first_name:a}),
chatboxManager.init({user:{name:a},messageSent:function(a,b,d){c("#"+a).chatbox("option","boxManager").addMsg(b.name,d)}}),a=b=null)});a._setWidth(a.options.width);a._position(a.options.offset);a.options.boxManager.init(a);roles.hasAdmin()&&virtualclass.user.UIaudioAll("memlist","ui-memblist-titlebar")},_setOption:function(a,b){if(null!=b)switch(a){case "hidden":b?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(b);break;case "width":this._setWidth(b)}c.Widget.prototype._setOption.apply(this,
arguments)},_setWidth:function(a){this.uiChatboxTitlebar.width(a+"px");this.uiChatboxLog.width(a+"px")},_position:function(a){this.uiChatbox.css("right",a)}})})(jQuery);(function(c){c.widget("ui.chatbox",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,messageSent:function(a,b,c){this.boxManager.addMsg(b.name,c)},boxClosed:function(a){},boxManager:{init:function(a){this.elem=a},addMsg:function(a,b){var d=this.elem.uiChatboxLog,f=document.createElement("div");d.append(f);d=!1;if(a){var g=document.createElement("b");c(g).text(a+": ");f.appendChild(g)}else d=!0;d=document.createElement(d?"i":"span");c(d).text(b);f.appendChild(d);c(f).addClass("ui-chatbox-msg");
c(f).fadeIn();this._scrollToBottom();this.elem.uiChatboxTitlebar.hasClass("ui-state-focus")||this.highlightLock||(this.highlightLock=!0,this.highlightBox())},highlightBox:function(){},toggleBox:function(){this.elem.uiChatbox.toggle()},_scrollToBottom:function(){var a=this.elem.uiChatboxLog;a.scrollTop(a.get(0).scrollHeight)}}},toggleContent:function(a){},toggleContentbox:function(a){this.uiChatboxContent.is(":visible")?(this.uiChatboxInputBox.focus(),c(c('#tabs ul li[id = "tabcb'+this.options.id+
'"]')).removeClass("ui-state-active")):c(c('#tabs ul li[id="tabcb'+this.options.id+'"]')).addClass("ui-state-active");this.uiChatbox.toggle("slide",{direction:"down"},1E3)},widget:function(){return this.uiChatbox},_create:function(){createTab(this.options.id,this.options.title);var a=this,b=a.options.title||"No Title",d=(a.uiChatbox=c("<div></div>")).appendTo(document.body).addClass("ui-widget ui-corner-top ui-chatbox").attr("id","cb"+a.options.id).focusin(function(){a.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){a.uiChatboxTitlebar.removeClass("ui-state-focus")}),
f=(a.uiChatboxTitlebar=c("<div></div>")).addClass("ui-widget-header ui-corner-top ui-chatbox-titlebar ui-dialog-header").click(function(a){}).appendTo(d);(a.uiChatboxTitle=c("<span></span>")).html(b).appendTo(f);var g=(a.uiChatboxTitlebarClose=c('<a href="#"></a>')).addClass("ui-corner-all ui-chatbox-icon ").attr("role","button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")}).click(function(b){d.hide();a.options.boxClosed(a.options.id);c("#tabcb"+a.options.id).remove();
delete virtualclass.chat.vmstorage[a.options.id];localStorage.removeItem(a.options.id);return!1}).appendTo(f);c("<span ></span>").addClass("ui-icon icon-close").text("").appendTo(g);var h=(a.uiChatboxTitlebarMinimize=c('<a href = "#"></a>')).addClass("ui-corner-all ui-chatbox-icon").attr("role","button").hover(function(){h.addClass("ui-state-hover")},function(){h.removeClass("ui-state-hover")}).click(function(b){a.toggleContentbox(b);"hidden"==localStorage.getItem(a.options.id)?localStorage.removeItem(a.options.id):
localStorage.setItem(a.options.id,"hidden");return!1}).appendTo(f);c("<span></span>").addClass("ui-icon icon-minus").text("").appendTo(h);b=(a.uiChatboxContent=c("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(d);(a.uiChatboxLog=a.element).addClass("ui-widget-content ui-chatbox-log").appendTo(b);var m=(a.uiChatboxInput=c("<div></div>")).addClass("ui-widget-content ui-chatbox-input").click(function(a){}).appendTo(b),p=(a.uiChatboxInputBox=c("<textarea></textarea>")).addClass("ui-widget-content ui-chatbox-input-box ui-corner-all").prop("id",
"ta"+a.options.id).appendTo(m).keypress(function(b){if(b.keyCode&&b.keyCode==c.ui.keyCode.ENTER){msg=c.trim(c(this).val());if(0<msg.length){ioAdapter.mustSendUser({msg:msg,cf:"msg"},a.options.id);c("li[aria-controls='tabcb"+a.options.id+"']").removeClass("ui-state-highlight");c(this).val("");c("#"+a.options.id).chatbox("option").messageSent(a.options.id,{name:io.cfg.userobj.name},msg);b=a.options.id;"undefined"==typeof virtualclass.chat.vmstorage[b]&&(virtualclass.chat.vmstorage[b]=[]);var d=(new Date).getTime();
virtualclass.chat.vmstorage[b].push({userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:d})}return!1}}).focusin(function(){p.addClass("ui-chatbox-input-focus");var a=c(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)}).focusout(function(){p.removeClass("ui-chatbox-input-focus")});f.find("*").add(f).disableSelection();b.children().click(function(){a.uiChatboxInputBox.focus()});a._setWidth(a.options.width);a._position(a.options.offset);a.options.boxManager.init(a);a.options.hidden||
d.show();c(c('#tabs ul li[id = "tabcb'+a.options.id+'"]')).append(d)},_setOption:function(a,b){if(null!=b)switch(a){case "hidden":b?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(b);break;case "width":this._setWidth(b)}c.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(a){this.uiChatbox.width(a+"px");this.uiChatboxInputBox.css("width",a-14+"px")},_position:function(a){}})})(jQuery);(function(c){c.widget("ui.chatroom",{options:{id:null,title:null,user:null,hidden:!1,offset:20,width:230,messageSent:function(a,b){this.boxManager.addMsg(a.name,b)},boxClosed:function(a){},boxManager:{init:function(a){this.elem=a},addMsg:function(a,b){var d=this.elem.uiChatboxLog,f=document.createElement("div");d.append(f);d=!1;if(a){var g=document.createElement("b");c(g).text(a+": ");f.appendChild(g)}else d=!0;d=document.createElement(d?"i":"span");c(d).text(b);f.appendChild(d);c(f).addClass("ui-chatbox-msg");
c(f).fadeIn();this._scrollToBottom();this.elem.uiChatboxTitlebar.hasClass("ui-state-focus")||this.highlightLock||(this.highlightLock=!0,this.highlightBox())},highlightBox:function(){this.elem.uiChatboxTitlebar.addClass("ui-state-highlight");this.highlightLock=!1;this._scrollToBottom()},toggleBox:function(){this.elem.uiChatbox.toggle("slide",{direction:"down"},1E3)},_scrollToBottom:function(){var a=this.elem.uiChatboxLog;a.scrollTop(a.get(0).scrollHeight)}}},toggleContent:function(a){this.uiChatboxContent.toggle();
this.uiChatboxContent.is(":visible")&&this.uiChatboxInputBox.focus()},widget:function(){return this.uiChatbox},_create:function(){var a=null!=localStorage.getItem("chatEnable")?"true"==localStorage.chatEnable?"enable":"disable":"enable",b=this,d=b.options.title||"No Title",a=(b.uiChatbox=c("<div></div>")).appendTo(document.getElementById("chatWidget")).addClass("ui-widget ui-corner-top ui-chatroom "+a).prop("id","chatrm").focusin(function(){b.uiChatboxTitlebar.removeClass("ui-state-highlight");b.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){b.uiChatboxTitlebar.removeClass("ui-state-focus")}),
f=(b.uiChatboxTitlebar=c("<div></div>")).addClass("ui-widget-header ui-corner-top ui-chatroom-titlebar ui-dialog-header").click(function(a){b.uiChatboxTitlebar.removeClass("ui-state-highlight")}).appendTo(a);(b.uiChatboxTitle=c("<span></span>")).html(d).appendTo(f);var g=(b.uiChatboxTitlebarMinimize=c('<a href="#"></a>')).addClass("ui-corner-all ui-chatbox-icon").prop("role","button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")}).focus(function(){g.addClass("ui-state-focus")}).blur(function(){g.removeClass("ui-state-focus")}).click(function(a){toggleCommonChatBox();
localStorage.setItem("chatroom_status","hidden");return!1}).appendTo(f);c("<span></span>").addClass("ui-icon icon-minus").text("").appendTo(g);d=(b.uiChatboxContent=c("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(a);(b.uiChatboxLog=b.element).addClass("ui-widget-content ui-chatbox-log").appendTo(d);var h=(b.uiChatboxInput=c("<div></div>")).addClass("ui-widget-content ui-chatbox-input").click(function(a){}).appendTo(d),m=(b.uiChatboxInputBox=c("<textarea></textarea>")).addClass("ui-widget-content ui-chatbox-input-box ui-corner-all").prop("id",
"ta_chrm").appendTo(h).keydown(function(a){if(a.keyCode&&a.keyCode==c.ui.keyCode.ENTER){msg=c.trim(c(this).val());a={receiver:"chatroom",msg:msg,cf:"msg"};if(0<msg.length)if(ioAdapter.mustSend(a),c(this).val(""),b.options.messageSent({name:io.cfg.userobj.name},msg),a=(new Date).getTime(),null!=localStorage.getItem("chatroom")){var d=JSON.parse(localStorage.getItem("chatroom"));d.push({userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:a});localStorage.setItem("chatroom",JSON.stringify(d))}else localStorage.setItem("chatroom",
JSON.stringify([{userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:a}]));return!1}}).focusin(function(){m.addClass("ui-chatbox-input-focus");var a=c(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)}).focusout(function(){m.removeClass("ui-chatbox-input-focus")});f.find("*").add(f).disableSelection();d.children().click(function(){b.uiChatboxInputBox.focus()});b._setWidth(b.options.width);b._position(b.options.offset);b.options.boxManager.init(b);b.options.hidden||(a.show(),virtualclass.vutil.isPlayMode()&&
disCommonChatInput())},_setOption:function(a,b){if(null!=b)switch(a){case "hidden":b?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(b);break;case "width":this._setWidth(b)}c.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(a){this.uiChatbox.width(a+"px");this.uiChatboxInputBox.css("width",a-14+"px")},_position:function(a){this.uiChatbox.css("left",a)}})})(jQuery);Array.indexOf||(Array.prototype.indexOf=function(c){for(var a=0;a<this.length;a++)if(this[a]==c)return a;return-1});
var chatboxManager=function(){var c=[],a=[],b={width:230,gap:20,maxBoxes:5,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b,c)}},d=function(d){var f=a.indexOf(d);if(-1!=f)for(a.splice(f,1),c.splice(f,1),diff=b.width+b.gap,d=f;d<a.length;d++)offset=$("#"+a[d]).chatbox("option","offset"),$("#"+a[d]).chatbox("option","offset",offset-diff);else alert("should not happen: "+d)},f=function(a,d,f){c.indexOf(d.userid);b.messageSent(a,d,f)};return{init:function(a){$.extend(b,a)},
addBox:function(g,h,m){m=a.indexOf(g);var p=c.indexOf(g);-1==m&&(-1!=p?($("#"+g).chatbox("option","offset",285+(b.width+b.gap)*a.length),$("#"+g).chatbox("option","boxManager").toggleBox(),a.push(g),h=-1,h=$("#tabs li").index($("#tabcb"+g)),$($(".tabs li")[h]).css("display","list-item"),$("#tabs").tabs("option","active",h),$("#tabs").tabs("show")):(void 0==h.last_name&&(h.last_name=""),m=document.createElement("div"),m.setAttribute("id",g),$(m).chatbox({id:g,user:h,title:h.first_name+" "+h.last_name,
hidden:!1,width:b.width,offset:285+(b.width+b.gap)*a.length,messageSent:f,boxClosed:d}),c.push(g),a.push(g)))},delBox:function(b){a=$.grep(a,function(a){return b!=a});c=$.grep(c,function(a){return b!=a})},dispatch:function(a,b){$("#"+a.userid).chatbox("option","boxManager").addMsg(a.name,b)}}}();function memberUpdate(c,a){var b=c.message,d="undefined"===typeof whiteboardPath?"../images/online.png":window.whiteboardPath+"images/online.png";if(0<b.length){var f=b.length-1;virtualclass.gObj.totalUser=[];for(var g=0;g<b.length;g++)virtualclass.gObj.totalUser.push(b[g].id);virtualclass.gObj.totalUser.sort();$("#user_list .inner_bt #usertab_icon").css({background:"url("+d+")no-repeat top left"})}$("#user_list .inner_bt #usertab_text").html("<span id='onlineusertext'>"+lang.whos+" ( "+f+" )</span> <span id='usertab_toogle_icon' class='icon-arrow-up'></span>");
$("#chatroom_bt .inner_bt #chatroom_text").text(lang.chatroom+" ("+f+")");0<b.length?(document.getElementById("chat_div")||(d=document.createElement("div"),d.id="chat_div",document.body.appendChild(d)),$("#chat_div").memberlist({id:"chat_div",user:b,offset:"7px",title:lang.online,userSent:function(a){$("#chat_div").memberlist("option","boxManager").addUsr(a)}}),$("#chat_div .ui-memblist-usr:not(.mySelf)").remove(),$.each(b,function(b,c){null==document.getElementById("video"+c.userid)&&$("#chat_div").memberlist("option").userSent(c);
if(c.userid==io.cfg.userid&&"undefined"!=typeof a&&"removed"!=a){var d=document.getElementById("video"+c.userid);virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable")||null!=d||virtualclass.gObj.video._handleUserMedia(c.userid)}virtualclass.gObj.video.addUserRole(c.userid,c.role)})):$("div#memlist").length&&$("div#memlist").remove()}
function messageUpdate2(c){var a=$.isPlainObject(c.message)?c.message.msg:c.message,b=c.toUser,d=c.fromUser,f=io.cfg.userid,g=(new Date).getTime();if("chatroom"==c.message.receiver&&(""==b||void 0==b))f==d.userid||virtualclass.chat.chatroombox||0!=$("div#chat_room").length||(c=document.createElement("div"),c.id="chat_room",document.body.appendChild(c),virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:d,title:lang.chatroom_header,messageSent:function(a,b){$("#chat_room").chatroom("option",
"boxManager").addMsg(a.name,b)}})),$("#chat_room").chatroom("option").messageSent(d,a),null!=localStorage.getItem("chatroom")?(c=JSON.parse(localStorage.getItem("chatroom")),c.push({userid:d.userid,name:d.name,msg:a,time:g}),localStorage.setItem("chatroom",JSON.stringify(c))):localStorage.setItem("chatroom",JSON.stringify([{userid:d.userid,name:d.name,msg:a,time:g}]));else if(void 0!=b&&""!=b){if(f==b.userid&&d.userid!=f){-1==$.inArray(d.userid,virtualclass.chat.idList)&&(virtualclass.chat.counter++,
virtualclass.chat.idList.push(d.userid),virtualclass.chat.vmstorage[d.userid]=[],virtualclass.chat.vmstorage[d.userid].push({userid:d.userid,name:d.name+" "+d.lname}));chatboxManager.addBox(d.userid,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,first_name:d.name,last_name:d.lname});chatboxManager.init({user:d,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}});c=localStorage.getItem("chatEnable");null!=c&&"false"==c&&virtualclass.user.control.allChatDisable();
$("#"+d.userid).chatbox("option").messageSent(d.userid,d,a);$("li[aria-controls='tabcb"+d.userid+"']").addClass("ui-state-highlight");var h=d.userid}virtualclass.chat.vmstorage[h].push({userid:d.userid,name:d.name,msg:a,time:g})}}
function messageUpdate(c){var a=$.isPlainObject(c.message)?c.message.msg:c.message,b=c.toUser,d=c.fromUser,f=io.cfg.userid,g=(new Date).getTime();if("chatroom"==c.message.receiver&&(""==b||void 0==b))virtualclass.chat.chatroombox||0!=$("div#chat_room").length||(c=document.createElement("div"),c.id="chat_room",document.body.appendChild(c),virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:d,title:lang.chatroom_header,messageSent:function(a,b){$("#chat_room").chatroom("option",
"boxManager").addMsg(a.name,b)}})),$("#chat_room").chatroom("option").messageSent(d,a),c=localStorage.getItem("chatroom"),null!=c?(c=JSON.parse(c),c.push({userid:d.userid,name:d.name,msg:a,time:g}),localStorage.setItem("chatroom",JSON.stringify(c))):localStorage.setItem("chatroom",JSON.stringify([{userid:d.userid,name:d.name,msg:a,time:g}]));else if(void 0!=b&&""!=b){if(f==b.userid&&d.userid!=f){-1==$.inArray(d.userid,virtualclass.chat.idList)&&(virtualclass.chat.counter++,virtualclass.chat.idList.push(d.userid),
virtualclass.chat.vmstorage[d.userid]=[],virtualclass.chat.vmstorage[d.userid].push({userid:d.userid,name:d.name+" "+d.lname}));chatboxManager.addBox(d.userid,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,first_name:d.name,last_name:d.lname});chatboxManager.init({user:d,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}});c=localStorage.getItem("chatEnable");null!=c&&"false"==c&&virtualclass.user.control.allChatDisable();$("#"+d.userid).chatbox("option").messageSent(d.userid,
d,a);$("li[aria-controls='tabcb"+d.userid+"']").addClass("ui-state-highlight");var h=d.userid}virtualclass.chat.vmstorage[h].push({userid:d.userid,name:d.name,msg:a,time:g})}}function statusUpdate(c,a,b){$("#"+c.userid).length&&($("#"+c.userid).chatbox("option").messageSent(c.userid,c,a),$("#ta"+c.userid).prop("disabled",b))}function common_chatbox_update(c,a){$("div#chat_room").length&&$("#chat_room").chatroom("option").messageSent(c,a)}
function newStatus(c){$.each(c.message,function(a,b){null!=c.newuser&&b.userid==c.newuser&&(statusUpdate(b,"Online",!1),common_chatbox_update(b,"Online"))})}function createTab(c,a){var b=$("#tabs").tabs(),d=$("div#tabs ul li").length;tabId="tabcb"+c;addTab(b,tabId,d,a)}
function addTab(c,a,b,d){var f=$("#tab_content");b=d||"Tab "+b;a=$(("<li id = '"+a+"' class = 'ui-state-default ui-corner-bottom ui-tabs-active ui-state-active' aria-controls = '"+a+"'><a href = '#{href}' class = 'ui-tabs-anchor'>#{label}</a> <a href = '#' role = 'button'class = 'ui-corner-all ui-chatbox-icon'><span class = 'ui-icon icon-close'></span></a></li>").replace(/#\{href\}/g,"#"+a).replace(/#\{label\}/g,b));f.val();c.find(".ui-tabs-nav").append(a)}
function browserSupportsLocalStorage(){return"localStorage"in window&&null!=window.localStorage}
function displaycomChatHistory(){var c=localStorage.getItem("chatroom");if(null!=c){var a=document.createElement("div");a.id="chat_room";document.body.appendChild(a);c=JSON.parse(c);$.each(c,function(a,c){1>a&&(virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:c,title:"Common chat",messageSent:function(a,b){$("#chat_room").chatroom("option","boxManager").addMsg(a.name,b)}}));$("#chat_room").chatroom("option").messageSent(c,c.msg)})}"hidden"==localStorage.getItem("chatroom_status")&&
$("#chatrm").hide()}
function displayPvtChatHistory(){if(null!=localStorage.getItem(wbUser.sid)){var c=JSON.parse(localStorage.getItem(wbUser.sid));$.each(c,function(a,b){virtualclass.chat.counter++;virtualclass.chat.idList.push(a);$.each(b,function(b,c){1>b?(chatboxManager.addBox(a,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,first_name:c.name}),chatboxManager.init({messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}})):$("#"+a).chatbox("option").messageSent(a,c,
c.msg)});"hidden"==localStorage.getItem(a)&&($("#cb"+a).hide(),$("#tabcb"+a).removeClass("ui-state-active"))})}}function display_error(c){$("<div id = 'dialog' title = 'VmChat Error:'></div>").prependTo("#stickybar");$("#dialog").html(c);$("#dialog").dialog()}function clearAllChatBox(){$("#chatWidget .icon-close").trigger("click")}function disCommonChatInput(){var c=document.getElementById("ta_chrm");null!=c&&(c.disabled=!0)}
function toggleCommonChatBox(){var c=$("#chatroom_bt2");"hidden"==localStorage.getItem("chatroom_status")?(localStorage.removeItem("chatroom_status"),c.attr("data-title",virtualclass.lang.getString("minCommonChat"))):(localStorage.setItem("chatroom_status","hidden"),c.attr("data-title",virtualclass.lang.getString("maxCommonChat")));c=document.getElementById("cc_arrow_button");null!=c&&(virtualclass.vutil.elemHasAnyClass("cc_arrow_button")?c.classList.contains("icon-arrow-up")?(c.classList.add("icon-arrow-down"),
c.classList.remove("icon-arrow-up")):(c.classList.add("icon-arrow-up"),c.classList.remove("icon-arrow-down")):c.className="icon-arrow-up");virtualclass.chat.chatroombox.chatroom("option","boxManager").toggleBox()};var lang={online:"Online Users",whos:"Who's online",chatroom:"Chatroom",chatroom_header:"Common Chat",error:"Something bad happend. Sorry!",wserror:"Browser does not support WebSocket",sterror:"This browser doesn't support Web Storage standard"};
