var roles={isTeacher:function(){return"t"===virtualclass.gObj.uRole},isStudent:function(){return"s"===virtualclass.gObj.uRole},isPresenter:function(){return"p"===virtualclass.gObj.uRole},isEducator:function(){return"e"===virtualclass.gObj.uRole},hasControls:function(){return"t"===virtualclass.gObj.uRole||"p"===virtualclass.gObj.uRole},hasAdmin:function(){return"t"===virtualclass.gObj.uRole||"e"===virtualclass.gObj.uRole},hasView:function(){return"s"===virtualclass.gObj.uRole||"e"===virtualclass.gObj.uRole}};var ioStorage={sendStore:function(c,a){var b;b=JSON.stringify({type:a,m:c,userto:null,user:virtualclass.uInfo.userobj});c.hasOwnProperty("sEnd")||c.hasOwnProperty("getMsPckt")||!0!=c.onrefresh&&this.completeStorage(b)},dataBinaryStore:function(c){var a;"[object Int8Array]"==Object.prototype.toString.call(c)?a="a":"[object Uint8ClampedArray]"==Object.prototype.toString.call(c)&&(a="c");dtConWorker.postMessage({dt:a,msg:c});var b=this;dtConWorker.onmessage=function(a){b.completeStorage(a.data.msg,{type:a.data.dt})}},
dataAdapterStore:function(c,a){"object"==typeof virtualclass.storage&&"object"==typeof virtualclass.storage.db?virtualclass.storage.dataAdapterAllStore(JSON.stringify(c),a):setTimeout(function(){ioStorage.dataAdapterStore(c,a)},10)},dataUserAdapterMustData:function(c,a){"object"==typeof virtualclass.storage&&"object"==typeof virtualclass.storage.db?virtualclass.storage.dataUserAdapterAllStore(JSON.stringify(c),a):setTimeout(function(){ioStorage.dataUserAdapterMustData(c,a)},10)},dataExecutedStoreAll:function(c,
a){virtualclass.storage.dataExecutedStoreAll(JSON.stringify(c),a)},dataExecutedUserStoreAll:function(c,a){virtualclass.storage.dataExecutedUserStoreAll(JSON.stringify(c),a)},ioCompleteStorageInit:function(c){try{ioStorage.completeStorage(c)}catch(a){var b=this;setTimeout(function(){b.ioCompleteStorageInit(c)},10)}},completeStorage:function(c,a,b){if(!virtualclass.hasOwnProperty("getContent")||!0!=virtualclass.getContent){if("undefined"==typeof firstTime&&(referenceTime=window.pageEnter,firstTime=
!0,!virtualclass.vutil.isPlayMode())){try{var d=virtualclass.storage.db.transaction(["allData"],"readwrite")}catch(f){this.ioCompleteStorageInit(c);return}d=virtualclass.storage.db.transaction(["allData"],"readwrite");if("undefined"!=typeof d){var g=d.objectStore("allData");g.openCursor().onsuccess=function(a){(a=a.target.result)&&a.value.hasOwnProperty("recObjs")&&(a.value.hasOwnProperty("bd")?g.clear():JSON.parse(a.value.recObjs).hasOwnProperty("authuser")||g.clear())}}}var d=(new Date).getTime(),
h=d-referenceTime;"undefined"!=typeof b?virtualclass.storage.completeStorage(h,void 0,void 0,b):"undefined"==typeof a?virtualclass.storage.completeStorage(h,c):virtualclass.storage.completeStorage(h,c,a);referenceTime=d}}};var ioMissingPackets={executedStore:[],executedSerial:null!=localStorage.getItem("executedSerial")?JSON.parse(localStorage.getItem("executedSerial")):{},missRequest:[],aheadPackets:[],missRequestFlag:0,executedUserStore:[],executedUserSerial:null!=localStorage.getItem("executedUserSerial")?JSON.parse(localStorage.getItem("executedUserSerial")):{},missUserRequest:[],aheadUserPackets:[],missUserRequestFlag:0,validateAllVariables:function(c){if("undefined"==typeof this.executedSerial||null==this.executedSerial)this.executedSerial=
{};"undefined"==typeof this.executedSerial[c]&&(this.executedSerial[c]=-1);"undefined"==typeof this.missRequest[c]&&(this.missRequest[c]=0);"undefined"==typeof this.executedStore[c]&&(this.executedStore[c]=[]);"undefined"==typeof this.aheadPackets[c]&&(this.aheadPackets[c]=[])},validateAllUserVariables:function(c){if("undefined"==typeof this.executedUserSerial||null==this.executedUserSerial)this.executedUserSerial={};"undefined"==typeof this.executedUserSerial[c]&&(this.executedUserSerial[c]=-1);
"undefined"==typeof this.missUserRequest[c]&&(this.missUserRequest[c]=0);"undefined"==typeof this.executedUserStore[c]&&(this.executedUserStore[c]=[]);"undefined"==typeof this.aheadUserPackets[c]&&(this.aheadUserPackets[c]=[])},checkMissing:function(c){var a=c.user.userid;this.validateAllVariables(a);if("t"==c.user.role&&c.m.hasOwnProperty("ping")&&c.m.hasOwnProperty("session")){var b=localStorage.getItem("mySession");if(null!=b&&c.m.session!=b){virtualclass.isPlayMode?localStorage.setItem("mySession",
"thisismyplaymode"):(localStorage.removeItem("mySession"),virtualclass.storage.config.endSession(),localStorage.setItem("mySession",c.m.session),console.log("REFRESH SESSION"));return}}1==c.m.missedpackets?this.fillExecutedStore(c):"undefined"!=typeof c.m.serial&&null!=c.m.serial?c.m.serial==this.executedSerial[a]+1?(console.log("UID "+a+" Object with Serial "+c.m.serial),this.executedSerial[a]=c.m.serial,this.executedStore[a][c.m.serial]=c,ioStorage.dataExecutedStoreAll(c,a+"_"+c.m.serial),this.onRecSave(c),
io.onRecJson(c)):c.m.serial>this.executedSerial[a]+1?(console.log("UID "+a+" requst miss packet"),this.requestMissedPackets(this.executedSerial[a]+1,c.m.serial,c,a)):(console.log("UID "+a+" no action current packet "+this.executedSerial[a]+" coming at "+c.m.serial),this.executedStore[a][c.m.serial]=c):console.log("UID "+a+" checkMissing should not be called without serial")},userCheckMissing:function(c){var a=c.user.userid;this.validateAllUserVariables(a);1==c.m.missedpackets?this.fillExecutedStore(c):
"undefined"!=typeof c.m.userSerial&&null!=c.m.userSerial?c.m.userSerial==this.executedUserSerial[a]+1?(console.log("UID "+a+" Object with userSerial "+c.m.userSerial),this.executedUserSerial[a]=c.m.userSerial,this.onRecSave(c),io.onRecJson(c),this.executedUserStore[a][c.m.userSerial]=c,ioStorage.dataExecutedStoreAll(c,a+"_"+c.m.userSerial)):c.m.userSerial>this.executedUserSerial[a]+1?(console.log("UID "+a+" requst miss packet"),this.userRequestMissedPackets(this.executedUserSerial[a]+1,c.m.userSerial,
c,a)):(console.log("UID "+a+" no action current packet "+this.executedUserSerial[a]+" coming at "+c.m.userSerial),this.executedUserStore[a][c.m.userSerial]=c):console.log("UID "+a+" checkMissing should not be called without userSerial")},requestMissedPackets:function(c,a,b,d){0>c&&(c=0);"use strict";0==this.missRequest[d]?(this.aheadPackets[d].unshift(b.m.serial),this.executedStore[d][b.m.serial]=b,a--,console.log("UID "+d+" request packet from "+c+" to "+a),this.waitAndResetmissRequest(d),ioAdapter.sendUser({reqMissPac:1,
from:c,till:a},d)):(console.log("UID "+d+" ahead packet"+b.m.serial),this.aheadPackets[d].unshift(b.m.serial),this.executedStore[d][b.m.serial]=b)},userRequestMissedPackets:function(c,a,b,d){0>c&&(c=0);"use strict";0==this.missUserRequest[d]?(this.aheadUserPackets[d].unshift(b.m.userSerial),this.executedUserStore[d][b.m.userSerial]=b,a--,console.log("UID "+d+" User request packet from "+c+" to "+a),this.userWaitAndResetmissUserRequest(d),ioAdapter.sendUser({userReqMissPac:1,from:c,till:a},d)):(console.log("UID "+
d+" User ahead packet"+b.m.userSerial),this.aheadUserPackets[d].unshift(b.m.userSerial),this.executedUserStore[d][b.m.userSerial]=b)},waitAndResetmissRequest:function(c){ioMissingPackets.missRequest[c]=1;ioMissingPackets.missRequestFlag=1;setTimeout(function(){ioMissingPackets.missRequest[c]=0;ioMissingPackets.missRequestFlag=0},15E3)},userWaitAndResetmissUserRequest:function(c){ioMissingPackets.missUserRequest[c]=1;ioMissingPackets.missUserRequestFlag=1;setTimeout(function(){ioMissingPackets.missUserRequest[c]=
0;ioMissingPackets.missUserRequestFlag=0},15E3)},sendMissedPackets:function(c){var a=c.user.userid;this.validateAllVariables(a);var b=c.m.from;0>b&&(b=0);b=ioAdapter.adapterMustData.slice(b,c.m.till+1);ioAdapter.sendUser({missedpackets:1,data:b},c.user.userid);console.log("UID "+a+" send packet total chunk length "+b.length)},userSendMissedPackets:function(c){var a=c.user.userid;this.validateAllUserVariables(a);var b=c.m.from;0>b&&(b=0);b=ioAdapter.userAdapterMustData[a].slice(b,c.m.till+1);ioAdapter.sendUser({userMissedpackets:1,
data:b},c.user.userid);console.log("UID "+a+" send packet total chunk length "+b.length)},fillExecutedStore:function(c){var a=c.user.userid;this.validateAllVariables(a);var b=c.m.data.length,d;for(d=0;d<b;d++)if(null!=c.m.data[d])if("undefined"!=typeof c.m.data[d].m.serial&&null!=c.m.data[d].m.serial){this.executedSerial[a]=c.m.data[d].m.serial;ioStorage.dataExecutedStoreAll(c.m.data[d],a+"_"+c.m.data[d].m.serial);this.onRecSave(c.m.data[d]);c.m.data[d].user=c.user;this.executedStore[a][c.m.data[d].m.serial]=
c.m.data[d];try{if(console.log("UID "+a+" Object with Serial "+c.m.data[d].m.serial),!c.m.data[d].m.hasOwnProperty("receiver"))io.onRecJson(c.m.data[d])}catch(f){console.log("Error "+f)}}else console.log("UID "+a+" Received Packed missing serial");for(this.aheadPackets[a]=this.aheadPackets[a].sort(function(a,b){return b-a});c=this.aheadPackets[a].pop();)if("undefined"!=typeof c&&null!=c)if("undefined"!=typeof this.executedStore[a][c])this.executedSerial[a]=c,this.onRecSave(this.executedStore[a][c]),
console.log("UID "+a+" Object with Serial "+this.executedStore[a][c].m.serial),ioStorage.dataExecutedStoreAll(this.executedStore[a][c],a+"_"+this.executedStore[a][c].m.serial),io.onRecJson(this.executedStore[a][c]);else{console.log("fillExecutedStore undefined");return}else console.log("UID "+a+" ahead Packed missing serial");this.missRequest[a]=0;ioMissingPackets.missRequestFlag=0},userFillExecutedStore:function(c){var a=c.user.userid;this.validateAllUserVariables(a);0<c.m.data.length||console.log("UID "+
a+" empty user data object");var b=c.m.data.length,d;for(d=0;d<b;d++)if(null!=c.m.data[d])if("undefined"!=typeof c.m.data[d].m.userSerial&&null!=c.m.data[d].m.userSerial){this.executedUserSerial[a]=c.m.data[d].m.userSerial;ioStorage.dataExecutedUserStoreAll(c.m.data[d],a+"_"+c.m.data[d].m.userSerial,c.m.data[d].m.userSerial);this.onRecSave(c.m.data[d]);c.m.data[d].user=c.user;c.m.data[d].userto=c.userto;try{console.log("UID "+a+" Object with user Serial "+c.m.data[d].m.userSerial),io.onRecJson(c.m.data[d])}catch(f){console.log("Error "+
f)}this.executedUserStore[a][c.m.data[d].m.userSerial]=c.m.data[d]}else console.log("UID "+a+" Received Packed missing User serial");for(this.aheadUserPackets[a]=this.aheadUserPackets[a].sort(function(a,b){return b-a});c=this.aheadUserPackets[a].pop();)"undefined"!=typeof c&&null!=c?(this.executedUserSerial[a]=c,this.onRecSave(this.executedUserStore[a][c]),console.log("UID "+a+" Object with Serial "+this.executedUserStore[a][c].m.userSerial),io.onRecJson(this.executedUserStore[a][c])):console.log("UID "+
a+" ahead Packed missing serial");this.missUserRequest[a]=0;ioMissingPackets.missUserRequestFlag=0},onRecSave:function(c){var a=JSON.stringify(c);io.onRecSave(c,a)}};var ioAdapter={adapterMustData:[],serial:-1,userSerial:[],userAdapterMustData:[],validateAllVariables:function(c){if("undefined"==typeof this.userSerial||null==this.userSerial)this.userSerial=[];"undefined"==typeof this.userSerial[c]&&(this.userSerial[c]=-1);if("undefined"==typeof this.userAdapterMustData||null==this.userAdapterMustData)this.userAdapterMustData=[];"undefined"==typeof this.userAdapterMustData[c]&&(this.userAdapterMustData[c]=[])},mustSend:function(c){this.serial++;console.log("s.n "+
this.serial);c.serial=this.serial;this.adapterMustData[this.serial]={type:"broadcast",m:c};this.send(c);ioStorage.dataAdapterStore({type:"broadcast",user:wbUser.id,m:c},this.serial)},send:function(c){console.log("Packet sending");io.send(c,"broadcastToAll",null);ioStorage.sendStore(c,"broadcastToAll")},mustSendAll:function(c){this.mustSendUser(c,virtualclass.gObj.uid);this.mustSend(c)},sendAll:function(c){io.send(c,"broadcast",null)},mustSendUser:function(c,a){this.validateAllVariables(a);"undefined"!=
typeof c.serial&&c.serial&&(c.serial=null);this.userSerial[a]++;console.log("USER s.n "+this.userSerial[a]+" user "+a);c.userSerial=this.userSerial[a];this.userAdapterMustData[a][c.userSerial]={type:"broadcastToAll",m:c};this.sendUser(c,a);ioStorage.dataUserAdapterMustData({type:"broadcastToAll",user:wbUser.id,m:c},a+"_"+c.userSerial)},sendUser:function(c,a){io.send(c,"broadcastToAll",a)},sendBinary:function(c){io.sendBinary(c);ioStorage.dataBinaryStore(c)}};var ioPingPong={ping:function(c){if("member_added"==c.type&&roles.hasAdmin()){var a={ping:"ping",cf:"pong",session:this.sessionName()};if(virtualclass.gObj.uid!=virtualclass.jId)ioAdapter.mustSendUser(a,virtualclass.jId),console.log("PING TO "+virtualclass.jId);else for(var b=0;b<c.message.length;b++)c.message[b].userid!=virtualclass.gObj.uid&&(ioAdapter.mustSendUser(a,c.message[b].userid),console.log("PING TO "+c.message[b].userid));ioAdapter.mustSend(a);console.log("PING BROADCAST")}},pong:function(c){c.toUser?
(console.log("PONG TO "+c.toUser.userid+" from "+c.fromUser.userid),ioAdapter.mustSendUser({ping:"pong",cf:"pongAck"},c.fromUser.userid),console.log("PONG ACK TO "+c.fromUser.userid)):(console.log("PONG BROADCAST from "+c.fromUser.userid),this.verifySession(c))},pongAck:function(c){console.log("PONG ACK FROM "+c.fromUser.userid)},sessionName:function(){var c=localStorage.getItem("mySession");null===c&&(virtualclass.gObj.hasOwnProperty("doEndSession")&&virtualclass.storage.config.endSession(),c=this.setSession());
return c},setSession:function(){var c=randomString(32);console.log("My session is created by setSession");localStorage.setItem("mySession",c);return c},verifySession:function(c){var a=c.message.session,b=localStorage.getItem("mySession");null!=b?b!==a&&"t"==c.fromUser.role&&this.sessionDestroy(a,c):(console.log("My session is created"),localStorage.setItem("mySession",a))},sessionDestroy:function(c,a){if(virtualclass.isPlayMode)console.log("My session is created"),localStorage.setItem("mySession",
"thisismyplaymode");else{var b=a.fromUser.userid;localStorage.removeItem("mySession");virtualclass.storage.config.endSession();localStorage.setItem("mySession",c);ioMissingPackets.validateAllVariables(b);console.log("REFRESH SESSION")}}};(function(c){c.virtualclass=function(){return{isPlayMode:""!=wbUser.virtualclassPlay?parseInt(wbUser.virtualclassPlay,10):0,apps:"Whiteboard ScreenShare Yts EditorRich EditorCode SharePresentation".split(" "),appSessionEnd:"virtualclassSessionEnd",appAudioTest:"virtualclassAudioTest",rWidgetConfig:{id:"audioWidget"},wb:"",ss:"",wss:"",rw:"",lang:{},error:[],gObj:{uid:c.wbUser.id,uRole:c.wbUser.role,uName:c.wbUser.name,tempReplayObjs:[],alreadyReplayFromStorage:!1,commandToolsWrapperId:"commandToolsWrapper",
editorInitDone:0,resize:!1},clearSession:function(){c.pageEnter=(new Date).getTime();virtualclass.vutil.beforeSend({sEnd:!0,cf:"sEnd"},null,!0);virtualclass.storage.config.endSession();virtualclass.hasOwnProperty("prevScreen")&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&virtualclass.prevScreen.unShareScreen();virtualclass.previrtualclass="virtualclassEditorRich"},init:function(a,b,d){a=c.wbUser;virtualclass.uInfo={userid:a.id,sid:a.sid,rid:a.path,authuser:a.auth_user,authpass:a.auth_pass,
userobj:{userid:a.id,name:a.name,lname:a.lname,img:a.imageurl,role:null!=localStorage.getItem("uRole")?localStorage.getItem("uRole"):a.role},room:a.room};this.wbConfig={id:"virtualclass"+this.apps[0],classes:"appOptions"};this.ssConfig={id:"virtualclass"+this.apps[1],classes:"appOptions"};this.ytsConfig={id:"virtualclass"+this.apps[2],classes:"appOptions"};this.edConfig={id:"virtualclass"+this.apps[3],classes:"appOptions"};this.edCodeConfig={id:"virtualclass"+this.apps[4],classes:"appOptions"};this.ptConfig=
{id:"virtualclass"+this.apps[5],classes:"appOptions"};this.user=new c.user;this.lang.getString=c.getString;this.lang.message=c.message;this.vutil=c.vutil;this.media=c.media;this.sharePt=c.sharePt;this.system=c.system;this.recorder=c.recorder;this.converter=c.converter;this.clear="";this.currApp=this.vutil.capitalizeFirstLetter(b);this.storage=c.storage;this.system.isIndexedDbSupport()?this.storage.init(function(){virtualclass.vutil.isPlayMode()||ioStorage.completeStorage(JSON.stringify(virtualclass.uInfo))}):
console.log("Indexeddb does not support");this.dirtyCorner=c.dirtyCorner;this.html.init(this);this.adapter=c.adapter;virtualclass.chat=new Chat;virtualclass.chat.init();virtualclass.system.mybrowser.hasOwnProperty("name")||this.system.setBrowserDetails();virtualclass.vutil.initOnBeforeUnload(virtualclass.system.mybrowser.name);virtualclass.xhr=c.xhr;virtualclass.xhr.init();virtualclass.dtCon=virtualclass.converter();virtualclass.pbar=progressBar;virtualclass.editorRich=c.editor("editorRich","virtualclassEditorRich",
"virtualclassEditorRichBody");virtualclass.editorCode=c.editor("editorCode","virtualclassEditorCode","virtualclassEditorCodeBody");virtualclass.yts=c.yts();null!=localStorage.uRole&&(virtualclass.gObj.uRole=localStorage.uRole,document.getElementById("virtualclassCont").classList.add(virtualclass.vutil.getClassName(virtualclass.gObj.uRole)));"undefined"==typeof d||null==d?this.makeAppReady(b,"byclick"):this.makeAppReady(b,"byclick",d);this.system.check();this.vutil.isSystemCompatible();b==this.apps[1]&&
this.system.setAppDimension();virtualclass.vutil.createReclaimButtonIfNeed();virtualclass.user.assignRole(virtualclass.gObj.uRole,b);this.gObj.video=new c.virtualclass.media;if(!virtualclass.vutil.isPlayMode())var f=this,g=setInterval(function(){2<=f.gObj.editorInitDone&&(f.initSocketConn(),clearInterval(g))},100)},initSocketConn:function(){this.system.webSocket&&(io.init(virtualclass.uInfo),c.userdata=virtualclass.uInfo)},html:{id:"virtualclassCont",optionsClass:"appOptions",init:function(a){this.virtualclass=
a},leftAppBar:function(){if(!(0<document.getElementsByClassName("appOptions").length)){var a=document.getElementById(this.id),b=this.createElement("div","virtualclassOptionsCont");a.insertBefore(b,a.firstChild);this.createDiv(virtualclass.edConfig.id+"Tool","editorRich",b,virtualclass.edConfig.classes);this.createDiv(virtualclass.wbConfig.id+"Tool","whiteboard",b,virtualclass.wbConfig.classes);this.createDiv(virtualclass.ssConfig.id+"Tool","screenshare",b,virtualclass.ssConfig.classes);this.createDiv(virtualclass.ytsConfig.id+
"Tool","youtubeshare",b,virtualclass.ytsConfig.classes);this.createDiv(virtualclass.edCodeConfig.id+"Tool","editorCode",b,virtualclass.edCodeConfig.classes);this.createDiv(virtualclass.ptConfig.id+"Tool","sharePresentation",b,virtualclass.ptConfig.classes);virtualclass.gObj.hasOwnProperty("errNotScreenShare")&&virtualclass.view.disableSSUI();roles.hasControls()&&this.createDiv(virtualclass.appSessionEnd+"Tool","sessionend",b,"appOptions");virtualclass.gObj.hasOwnProperty("errAppBar")&&virtualclass.view.disableLeftAppBar();
b.style.zIndex=1}},createDiv:function(a,b,d,f,g){var c=document.createElement("a");c.href="#";var m=document.createElement("div");m.id=a;"undefined "!=typeof f&&(m.className=f);a=document.createElement("span");a.className="icon-"+b;c.appendChild(a);c.dataset.title=virtualclass.lang.getString(b);c.className="tooltip";m.appendChild(c);"undefined"!=typeof g?(g=document.getElementById("virtualclassScreenShareTool"),d.replaceChild(m,g)):d.appendChild(m)},createElement:function(a,b,d){a=document.createElement(a);
"undefined"!=typeof b&&(a.id=b);if("undefined"!=typeof d&&1<d.length)for(b=0;b<d.length;b++)a.className+=d[b]+" ";return a}},dispvirtualclassLayout:function(a){if("undefined"!=typeof this.previous)if(this.previous.toUpperCase()!=("virtualclass"+this.currApp).toUpperCase())if(document.getElementById(virtualclass.previous).style.display="none","undefined"!=typeof a){if("EDITORRICH"==a.toUpperCase()){var b=document.getElementById("virtualclassEditorCode");null!=b&&(b.style.display="none")}else console.log("EditorRich can not be display:none "+
a);"EDITORCODE"==a.toUpperCase()?(b=document.getElementById("virtualclassEditorRich"),null!=b&&(b.style.display="none")):console.log("EditorCode can not be display:none "+a)}else console.log("appId "+a+" undefined");else for(var b=document.getElementById("virtualclassCont").getElementsByClassName("virtualclass"),d=0;d<b.length;d++)b[d].style.display="none";"undefined"!=typeof a&&(a="virtualclass"+(a.charAt(0).toUpperCase()+a.slice(1)));b=document.getElementById(a);null!=b&&(b.style.display="block",
console.log("App "+a+" block"))},makeAppReady:function(a,b,d){console.log("Application is ready"+a);this.view=c.view;this.currApp=virtualclass.vutil.capitalizeFirstLetter(a);console.log("Current App init "+this.currApp);a!=this.apps[1]&&virtualclass.hasOwnProperty("previrtualclass")&&roles.hasControls()&&virtualclass.vutil.makeActiveApp("virtualclass"+a,virtualclass.previrtualclass);if("undefined"!=typeof this.previous&&("virtualclassEditorRich"==this.previous||"virtualclassEditorCode"==this.previous)){var f=
this.previous.split("virtualclass")[1];this.user.control.toggleDisplayEditorController(f,"none")}a!=this.apps[1]&&(this.dispvirtualclassLayout(a),document.getElementById("virtualclassCont").dataset.currapp=this.currApp);"SharePresentation"==a?"virtualclass"+a!=virtualclass.previous&&this.appInitiator[a].apply(virtualclass,Array.prototype.slice.call(arguments)):(f=localStorage.getItem("prevApp"),null!=f&&(f=JSON.parse(f),"SharePresentation"==f.name&&(f.name="",localStorage.setItem("prevApp",JSON.stringify(f)))),
this.appInitiator[a].apply(virtualclass,Array.prototype.slice.call(arguments)));this.previrtualclass=this.previous;a!=this.apps[0]&&a!=this.apps[1]&&virtualclass.system.setAppDimension();a!=this.apps[1]&&a!=this.apps[2]&&virtualclass.hasOwnProperty("yts")&&virtualclass.yts.destroyYT()},appInitiator:{Whiteboard:function(a,b){"object"==typeof this.ss&&(this.ss.prevStream=!1);"undefined"!=typeof this.previous&&"undefined"!=typeof b&&"byclick"==b&&virtualclass.vutil.beforeSend({dispWhiteboard:!0,cf:"dispWhiteboard"});
"object"!=typeof this.wb?(this.wb=new c.whiteboard(this.wbConfig),this.wb.utility=new c.utility,this.wb.alreadyReplay=!1,this.wb.packContainer=new c.packContainer,this.wb.draw_object=c.draw_object,this.wb.makeobj=c.makeobj,this.wb.readyFreeHandObj=c.readyFreeHandObj,this.wb._replay=_replay,this.wb.readyTextObj=c.readyTextObj,this.wb.bridge=c.bridge,this.wb.response=c.response,virtualclass.wb.utility.displayCanvas(),roles.hasControls()&&(virtualclass.wb.utility.setOrginalTeacherContent(a),virtualclass.wb.attachToolFunction(vcan.cmdWrapperDiv,
!0),vcan.utility.canvasCalcOffset(vcan.main.canid)),!this.alreadyReplayFromStorage&&0<this.gObj.tempReplayObjs.length&&this.wb.utility.replayFromLocalStroage(this.gObj.tempReplayObjs)):null==document.getElementById("commandToolsWrapper")&&roles.hasControls()&&virtualclass.wb.attachToolFunction(vcan.cmdWrapperDiv,!0);"undefined"!=typeof this.prevScreen&&this.prevScreen.hasOwnProperty("currentStream")&&this.prevScreen.unShareScreen();null!=document.getElementById("canvas")&&(vcan.utility.canvasCalcOffset(vcan.main.canid),
0==this.gObj.tempReplayObjs.length&&virtualclass.wb.utility.makeCanvasEnable());"virtualclassScreenShare"==this.previous&&roles.hasControls()&&(virtualclass.vutil.dimensionMatch("virtualclassWhiteboard","virtualclassScreenShare")||virtualclass.wb.utility.lockvirtualclass());this.previous=this.wbConfig.id;roles.hasControls()&&virtualclass.gObj.resize&&virtualclass.wb.utility.lockvirtualclass()},ScreenShare:function(a){"object"!=typeof this.ss&&(this.ss=new c.screenShare(virtualclass.ssConfig));this.ss.init({type:"ss",
app:a})},Yts:function(a,b,d){"undefined"!=typeof d&&null!=d?virtualclass.yts.init(d,d.startFrom):null==document.querySelector("iframe#player")&&virtualclass.yts.init();this.previous=virtualclass.ytsConfig.id},EditorRich:function(a){this.appInitiator.editor.call(virtualclass,a)},EditorCode:function(a){this.appInitiator.editor.call(virtualclass,a)},SharePresentation:function(a,b){"object"==typeof this.ss&&(this.ss.prevStream=!1);"undefined"!=typeof this.prevScreen&&this.prevScreen.hasOwnProperty("currentStream")&&
this.prevScreen.unShareScreen();this.sharePt=new c.sharePt;console.log(virtualclass.sharePt.pptUrl);this.sharePt.init(a,b);console.log(virtualclass.sharePt.pptUrl);this.previous=virtualclass.ptConfig.id},editor:function(a){this.user.control.toggleDisplayEditorController(a.substring(a.indexOf("virtualclass"),a.length),"block");var b=[];a==this.apps[3]?(virtualclass.editorRich.init(0,b,"",""),this.previous=virtualclass.edConfig.id):(virtualclass.editorCode.init(0,b,"",""),this.previous=virtualclass.edCodeConfig.id);
var b=JSON.parse(localStorage.getItem(virtualclass.vutil.smallizeFirstLetter(a))),d=virtualclass.vutil.smallizeFirstLetter(a);roles.hasAdmin()||(null==b?(this[d].cm.setOption("readOnly","nocursor"),this.user.control.toggleDisplayWriteModeMsgBox(a,!1),console.log("message box is created "+a)):(this.user.control.toggleDisplayWriteModeMsgBox(a,b),b?this[d].cm.setOption("readOnly",!1):this[d].cm.setOption("readOnly","nocursor")),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(d))}},attachFunction:function(){for(var a=
document.getElementsByClassName("appOptions"),b=0;b<a.length;b++){var d=a[b].getElementsByTagName("a")[0],f=this;clickedAnchor=d;d.onclick=function(){f.initlizer(this)}}},initlizer:function(a){a=a.parentNode.id.split("virtualclass")[1];"SessionEndTool"==a?virtualclass.popup.confirmInput(virtualclass.lang.getString("savesession"),function(a){a?(ioStorage.completeStorage(void 0,void 0,"sessionend"),setTimeout(function(){virtualclass.recorder.hasOwnProperty("recordDone")&&(console.log("deleete recordDone"),
delete virtualclass.recorder.recordDone);virtualclass.recorder.alreadyDownload=!1;virtualclass.getContent=!0;virtualclass.vutil.beforeSend({sEnd:!0,cf:"sEnd"});virtualclass.recorder.smallData=!0;io.sock.close();virtualclass.recorder.startUploadProcess()},300)):virtualclass.popup.confirmInput(virtualclass.lang.getString("startnewsession"),function(a){a?(virtualclass.clearSession(),virtualclass.gObj.hasOwnProperty("beTeacher")&&roles.isTeacher()&&localStorage.setItem("uRole","t")):console.log("Not start new session")})}):
(a=a.substring(0,a.indexOf("Tool")),this.PrvAndCurrIsWss(this.previous,a)?alert(virtualclass.lang.getString("screensharealready")):this.makeAppReady(a,"byclick"));"ScreenShare"!=a&&virtualclass.vutil.removeClass("audioWidget","fixed")},PrvAndCurrIsWss:function(a,b){return"virtualclassWholeScreenShare"==a&&b==this.apps[2]?!0:!1},prvCurrUsersSame:function(){var a=localStorage.getItem("prvUser");if(null==a)virtualclass.setPrvUser();else if(a=JSON.parse(a),a.id!=wbUser.id||a.room!=wbUser.room)virtualclass.gObj.sessionClear=
!0,virtualclass.setPrvUser(),roles.hasControls()&&localStorage.setItem("uRole",this.gObj.uRole)},setPrvUser:function(){localStorage.clear();localStorage.setItem("prvUser",JSON.stringify({id:wbUser.id,room:wbUser.room}))}}}})(window);(function(c,a){var b={cmdWrapperDiv:"commandToolsWrapper",create:function(a){if("#"==a.charAt(0)){var f=a.substring(1,a.length);b.utility.canvasCalcOffset(f);return new b.main(a)}console.log("there is a problem with canvas id")},main:function(d){b.main.children=[];b.main.id=0;b.main.uid=0;b.main.canvas=a.querySelector(d);b.main.canid=d.substring(1,d.length);b.main.currentTransform="";b.main.replayObjs=[];b.main.dragMode=!1;b.main.scaleMode=!1;b.main.usrCurrAction="";b.main.currObj="";b.main.textObj=
!1;b.main.action="create";b.wb={};b.wb.sentPack=!1;b.activMouse=new b.mouse;b.activMouse.init()},extend:function(a,b){if("object"==typeof a&&"object"==typeof b){for(var g in b)a[g]=b[g];return a}console.log("it seems that the arguments you passed are not object")},transform:function(a,b){a.translate(b.x,b.y);a.rotate(b.theta);a.scale(b.scaleX*(b.flipX?-1:1),b.scaleY*(b.flipY?-1:1))},getStates:function(a){return b.main[a]},setValInMain:function(a,f){return b.main[a]=f},ArrayIndexOf:function(a,b){if(!b||
"function"!=typeof b||!a||!a.length||1>a.length)return-1;for(var g=0;g<a.length;g++)if(b(a[g]))return g;return-1},renderAll:function(a){var f=b.main.children.length;"object"!=typeof a&&(a=b.main.canvas.getContext("2d"));b.clearContext(a);if(f)for(var g=0;g<f;++g)"freeDrawing"==b.main.children[g].type?b.fhdRender(a,b.main.children[g]):b.render(a,b.main.children[g])},clearContext:function(a){var f=b.main.canvas;a.clearRect(0,0,f.width,f.height);return f},deactivateAll:function(){for(var a=b.main.children,
f=0,g=a.length;f<g;f++)a[f].setActive(!1)},makeDispObject:function(a){return{coreObj:a,bind:function(a,b){this.addEventListener("on"+a,b)}}},remove:function(a){var f=b.main.canvas,g=b.ArrayIndexOf(b.main.children,function(b){return b.id==a.id&&(b.mt==a.mt||!0==a.multiuser)});0<=g&&b.main.children.splice(g,1);var g=f.height,c=f.width,f=f.getContext("2d");f.beginPath();f.clearRect(0,0,c,g);f.closePath();b.renderAll()},render:function(a,f,g){a.beginPath();a.save();a.lineWidth=void 0!==a.lineWidth?f.lineWidth:
2;g||b.transform(a,f);a.strokeStyle=void 0!=f.borderColor?f.borderColor:"#000000";"rectangle"==f.type?b.objRect.draw(a,f,g):"line"==f.type?b.objLine.draw(a,f,g):"oval"==f.type?b.objOval.draw(a,f,g):"triangle"==f.type?b.objTri.draw(a,f,g):"text"==f.type&&b.objTxt.draw(a,f,g);f.active&&!g&&(f.drawBorders(a),f.hideCorners||f.drawCorners(a));a.closePath();a.restore()},fhdRender:function(a,f,g){a.save();var c=f.transformMatrix;c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);g||b.transform(a,f);f.overlayFill?
a.fillStyle=f.overlayFill:f.fill&&(a.fillStyle=f.fill);f.stroke&&(a.strokeStyle=f.stroke);a.beginPath();var m;m=c=0;for(var n=-(f.width/2),q=-(f.height/2),u=0,w=f.path.length;u<w;++u)switch(m=f.path[u],m[0]){case "L":c=m[1];m=m[2];a.lineTo(c+n,m+q);break;case "M":c=m[1],m=m[2],a.moveTo(c+n,m+q)}f.fill&&a.fill();f.stroke&&(a.strokeStyle=f.stroke,a.lineWidth=f.strokeWidth,a.lineCap=a.lineJoin="round",a.stroke());!g&&f.active&&(f.drawBorders(a),f.hideCorners||f.drawCorners(a));a.restore()},makeStackObj:function(a,
b,g,c){return{mt:a,ac:b,x:g,y:c}}};c.vcan=b})(window,document);(function(c,a){c.whiteboard=function(b){var d=b.hasOwnProperty("id")?b.id:"appWhitebaordCont";b=b.hasOwnProperty("class");return{id:d,classes:b,tool:"",obj:{},prvObj:"",replayTime:0,uid:0,lt:"",view:{},lang:{},system:{},user:{},gObj:{myrepObj:[],replayObjs:[],myArr:[],displayedObjId:0,packQueue:[],queue:[],virtualWindow:!1},init:function(){virtualclass.wb.vcan=c.vcan;var a=virtualclass.wb.vcan;virtualclass.wb.canvas=a.create("#canvas");a=a.main.canvas;a.setAttribute("tabindex","0");a.focus();c.onkeydown=
virtualclass.wb.utility.keyOperation;virtualclass.system.setAppDimension();"undefined"!==typeof Storage&&(c.virtualclass.wb=virtualclass.wb);this.arrowInit();this._init()},_init:function(){virtualclass.wb.oTeacher=roles.hasAdmin();virtualclass.vutil.chkValueInLocalStorage("rcvdPackId")?virtualclass.wb.gObj.rcvdPackId=parseInt(localStorage.rcvdPackId):virtualclass.wb.gObj.rcvdPackId=0;c.addEventListener("resize",function(){virtualclass.gObj.resize=!0;roles.hasControls()&&"Whiteboard"==virtualclass.currApp&&
virtualclass.wb.utility.lockvirtualclass()});c.addEventListener("click",function(){virtualclass.view.disappearBox("WebRtc");virtualclass.view.disappearBox("Canvas");virtualclass.view.disappearBox("drawArea")});virtualclass.wb.utility.crateCanvasDrawMesssage()},arrowInit:function(){this.arrImg=new Image;this.arrImg.src="undefined"!=typeof c.whiteboardPath?c.whiteboardPath+"/images/arrow.png":"/images/arrow.png";this.arrImgDraw=!1;var a=this;this.arrImg.onload=function(){a.arrImgDraw=!0}},createCommand:function(){if(virtualclass.wb.utility.alreadyExistToolBar()||
null!=localStorage.getItem("educator")&&localStorage.reclaim)return!0;var a=virtualclass.vutil.createCommandWrapper();virtualclass.vutil.createDiv("t_rectangle","rectangle",a,"tool");virtualclass.vutil.createDiv("t_line","line",a,"tool");virtualclass.vutil.createDiv("t_freeDrawing","freeDrawing",a,"tool");virtualclass.vutil.createDiv("t_oval","oval",a,"tool");virtualclass.vutil.createDiv("t_triangle","triangle",a,"tool");virtualclass.vutil.createDiv("t_text","text",a,"tool");virtualclass.vutil.createDiv("t_activeall",
"activeAll",a,"tool");virtualclass.vutil.createDiv("t_clearall","clearAll",a,"tool");virtualclass.wb.socketOn=parseInt(wbUser.socketOn);1==virtualclass.wb.socketOn&&virtualclass.wb.utility.setClass("vcanvas","socketon")},createCommandWrapper:function(){var b=a.createElement("div");b.id=virtualclass.gObj.commandToolsWrapperId;var d=a.getElementById(vcan.canvasWrapperId);null!=d?a.getElementById("containerWb").insertBefore(b,d):a.getElementById("containerWb").appendChild(b);return b},createDiv_old:function(b,
d,c,m){var n=d;d=virtualclass.lang.getString(d);var q=a.createElement("a");q.href="#";var u=a.createElement("div");u.id=b;"undefined"!=typeof m&&(u.className=m);m=a.createElement("span");m.className="icon-"+n;q.appendChild(m);q.dataset.title=d;q.className="tooltip";u.appendChild(q);"t_reclaim"==b?(b=a.getElementById(virtualclass.html.id),c.appendChild(u),b.insertBefore(c,b.firstChild)):c.appendChild(u)},createCanvas:function(){var b=a.createElement("div");b.id=vcan.canvasWrapperId;vcan.canvasWrapperId=
b.id;var d=a.createElement("canvas");d.id="canvas";d.innerHTML="Canvas is missing in your browsers. Please update the latest version of your browser";b.appendChild(d);a.getElementById("containerWb").appendChild(b)},objInit:function(a){roles.hasControls()&&"t_clearall"!=this.parentNode.id&&virtualclass.wb.utility.makeActiveTool(this.parentNode.id);"t_replay"==this.parentNode.id?(virtualclass.wb.utility.clearAll(!1),virtualclass.vutil.beforeSend({replayAll:!0,cf:replayAll})):virtualclass.wb.toolInit(this.parentNode.id);
if("t_replay"!=this.parentNode.id&&"t_clearall"!=this.parentNode.id&&"t_reclaim"!=this.parentNode.id&&"t_assign"!=this.parentNode.id){a=(new Date).getTime();virtualclass.wb.lt=this.parentNode.id;var b={cmd:this.parentNode.id,mt:a};virtualclass.wb.uid++;b.uid=virtualclass.wb.uid;vcan.main.replayObjs.push(b);virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs));virtualclass.vutil.beforeSend({repObj:[b],cf:"repObj"})}"t_clearall"!=this.parentNode.id&&(virtualclass.wb.prvTool=this.parentNode.id,
virtualclass.wb.prvToolInfo=b)},attachToolFunction:function(b,d){virtualclass.wb.createCommand(d);for(var c=a.getElementById(b).getElementsByTagName("div"),m=0;m<c.length;m++)c[m].getElementsByTagName("a")[0].addEventListener("click",virtualclass.wb.objInit)},toolInit:function(b,d,c,m){"object"==typeof virtualclass.wb.obj.drawTextObj&&!0==virtualclass.wb.obj.drawTextObj.wmode&&vcan.main.canvas.getContext("2d");0<virtualclass.wb.vcan.getStates("children").length?"t_clearall"!=b&&("undefined"!=typeof c&&
"t_replay"==b||virtualclass.wb.utility.deActiveFrmDragDrop(),!0!=c&&"t_replay"!=b&&virtualclass.wb.vcan.renderAll()):virtualclass.wb.vcan.main.action="create";virtualclass.wb.utility.IsObjEmpty(virtualclass.wb.obj.freeDrawObj&&!1==c)||(virtualclass.wb.obj.freeDrawObj.freesvg=!1);virtualclass.wb.vcan.main.currUserCommand=b+"Init";"t_activeall"==b?virtualclass.wb.utility.t_activeallInit():"t_replay"==b?("undefined"==typeof c&&vcan.setValInMain("id",0),"undefined"!=typeof m?virtualclass.wb.t_replayInit(d,
m):virtualclass.wb.t_replayInit(d)):"t_clearall"==b?virtualclass.popup.confirmInput(virtualclass.lang.getString("clearAllWarnMessage"),function(b){if(!b)return!0;virtualclass.wb.utility.t_clearallInit();virtualclass.wb.utility.makeDefaultValue(d);virtualclass.storage.clearSingleTable("wbData");virtualclass.vutil.beforeSend({clearAll:!0,cf:"clearAll"});var d=virtualclass.wb.hasOwnProperty("prvToolInfo")&&"object"==typeof virtualclass.wb.prvToolInfo?virtualclass.wb.prvToolInfo.cmd:"t_triangle";b=a.getElementById(d).getElementsByTagName("a")[0];
null!=b&&b.click()}):"t_assign"==b?(d=localStorage.getItem("toolHeight"),null!=d?virtualclass.vutil.beforeSend({assignRole:!0,toolHeight:d,socket:virtualclass.wb.socketOn}):virtualclass.vutil.beforeSend({assignRole:!0,socket:virtualclass.wb.socketOn,cf:"assignRole"})):"t_reclaim"==b&&virtualclass.wb.utility._reclaimRole();"t_activeall"!=b&&"t_replay"!=b&&"t_clearallInit"!=b&&"t_assign"!=b&&"t_reclaim"!=b&&(virtualclass.wb.tool=new virtualclass.wb.tool_obj(b),virtualclass.wb.utility.attachEventHandlers())},
tool_obj:function(a){this.cmd=a;"t_freeDrawing"!=a&&(virtualclass.wb.obj.freeDrawObj="");"t_text"==a||virtualclass.vutil.exitTextWrapper()||(virtualclass.wb.obj.drawTextObj="");"t_freeDrawing"==a?(virtualclass.wb.obj.freeDrawObj=new virtualclass.wb.readyFreeHandObj("#424240","3"),virtualclass.wb.obj.freeDrawObj.init()):"t_text"==a&&(virtualclass.wb.obj.drawTextObj=new virtualclass.wb.readyTextObj,virtualclass.wb.obj.drawTextObj.init("canvasWrapper"));a=a.slice(2,a.length);virtualclass.wb.draw_object(a,
virtualclass.wb.canvas,this)},t_replayInit:function(a,b){"fromFile"==a?(virtualclass.gObj.chat.removeAllChat(),virtualclass.wb.recordAudio=!0,virtualclass.recorder.init()):(virtualclass.wb.replay=virtualclass.wb._replay(),"undefined"!=typeof b?(virtualclass.wb.replay.init(a,b),virtualclass.wb.replay.renderObj(b)):(virtualclass.wb.replay.init(a),virtualclass.wb.replay.renderObj()))}}}})(window,document);(function(c){c.utility=function(){return{userIds:[],isObjExistRE:function(a){if(0<=virtualclass.wb.replay.removeElements.length){var b=virtualclass.wb.vcan.ArrayIndexOf(virtualclass.wb.replay.removeElements,function(b){return b.id==a.id});if(0<=b)return b}},IsObjEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},stringToNumber:function(a){" "==a[a.length-1]&&(a=a.substring(0,a.length-1));return a=Number(a)},clickOutSidebox:function(a){return 1!=a%2?!0:!1},keyOperation:function(a){8==
a.keyCode||46==a.keyCode?(a=virtualclass.wb.vcan,""!=a.main.currObj&&roles.hasControls()&&(console.log("Delete whiteboard obj:- Invoke the command"),a=virtualclass.wb.utility.removeSelectedItem(a.main.currObj),virtualclass.vutil.beforeSend({repObj:[a],cf:"repObj"}))):27==a.keyCode&&"object"==typeof virtualclass.wb&&virtualclass.wb.obj.drawTextObj.finalizeTextIfAny()},removeSelectedItem:function(a,b,d){virtualclass.wb.canvas.removeObject(vcan.main.currObj);a={mt:(new Date).getTime(),ac:"del"};"undefined"==
typeof b&&virtualclass.wb.uid++;a.uid=virtualclass.wb.uid;roles.hasControls()?"undefined"==typeof d&&(console.log("Delete:- Saving the delete command with id "+a.uid),vcan.main.replayObjs.push(a),virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs))):virtualclass.storage.store(JSON.stringify(virtualclass.wb.gObj.replayObjs));vcan.main.currObj="";console.log("Delete:- Removing the whitboard object");return a},attachEventHandlers:function(){virtualclass.wb.canvas.bind("mousedown",virtualclass.wb.utility.ev_canvas);
virtualclass.wb.canvas.bind("mousemove",virtualclass.wb.utility.ev_canvas);virtualclass.wb.canvas.bind("mouseup",virtualclass.wb.utility.ev_canvas)},t_clearallInit:function(){virtualclass.wb.utility.clearAll(!0)},clearAll:function(a,b){virtualclass.wb.uid=0;virtualclass.wb.lt="";for(var d=virtualclass.wb.vcan;0<d.main.children.length;)virtualclass.wb.canvas.removeObject(d.main.children[0]);!0==a&&d.main.replayObjs.splice(0,d.main.replayObjs.length);void 0!=virtualclass.wb.replay&&(virtualclass.wb.replay.objNo=
0);"move"==d.getStates("action")&&d.setValInMain("action","create");d=document.getElementById("sendPackCont");if(null!=d&&(d=d.getElementsByClassName("numbers"),0<d.length))for(var f=0;f<d.length;f++)d[f].innerHTML=0;d=document.getElementById("serverErrorCont");null!=d&&(d.parentNode.removeChild(d),console.log("Some ERROR removed."))},deActiveFrmDragDrop:function(){var a=virtualclass.wb.vcan,b=a.main.children;if("move"==a.getStates("action")){a.setValInMain("action","create");for(a=0;a<b.length;a++)b[a].dragDrop(!1),
b[a].setActive(!1);return!0}return!1},getOffset:function(a){for(var b=a.target,d=y=0;b&&!isNaN(b.offsetLeft)&&!isNaN(b.offsetTop);)d+=b.offsetLeft-b.scrollLeft,y+=b.offsetTop-b.scrollTop,b=b.offsetParent;d=a.clientX-d;y=a.clientY-y;return{x:d,y:y}},ev_canvas:function(a){var b=virtualclass.wb.vcan.utility.getReltivePoint(a);a.currX=b.x;a.currY=b.y;if(b=virtualclass.wb.tool[a.type])return b(a),this.ev_canvas},t_activeallInit:function(){var a=virtualclass.wb.vcan,b=a.getStates("children");if(1<=b.length)for(a.setValInMain("action",
"move"),a=0;a<b.length;a++)b[a].dragDrop(!0)},drawArrowImg:function(a,b){var d=virtualclass.wb.vcan.main.canvas.getContext("2d");d.clearRect(0,0,virtualclass.wb.vcan.main.canvas.width,virtualclass.wb.vcan.main.canvas.height);vcan.renderAll();d.save();d.beginPath();d.translate(b.mp.x,b.mp.y);d.drawImage(a,-3,-3,18,24);d.closePath();d.restore()},assignRole:function(a){virtualclass.wb.tool="";"move"==vcan.main.action&&virtualclass.wb.utility.deActiveFrmDragDrop();if("undefined"!=typeof a)roles.isEducator()&&
(a=document.getElementById(virtualclass.gObj.commandToolsWrapperId),a.parentNode.removeChild(a)),virtualclass.gObj.uRole="p",localStorage.setItem("uRole",virtualclass.gObj.uRole),virtualclass.user.assignRole(virtualclass.gObj.uRole,virtualclass.currApp),vcan.utility.canvasCalcOffset(vcan.main.canid),"Yts"==virtualclass.currApp&&(virtualclass.yts.UI.inputURL(),virtualclass.yts.seekChangeInterval());else{"Yts"==virtualclass.currApp&&(virtualclass.yts.UI.removeinputURL(),virtualclass.yts.hasOwnProperty("tsc")&&
clearInterval(virtualclass.yts.tsc));virtualclass.gObj.uRole="s";a=document.getElementById(virtualclass.gObj.commandToolsWrapperId);if(null!=a)for(;a.hasChildNodes();)a.removeChild(a.lastChild);virtualclass.wb.utility.makeCanvasDisable();roles.hasAdmin()?(virtualclass.vutil.createReclaimButton(a),virtualclassCont=document.getElementById("virtualclassCont"),virtualclassCont.className+=" educator"):null!=a&&a.parentNode.removeChild(a);localStorage.setItem("uRole",virtualclass.gObj.uRole);virtualclass.wb.utility.uniqueArrOfObjsToStudent()}},
reclaimRole:function(){virtualclass.gObj.controlAssign=!1;virtualclass.wb.response.assignRole(virtualclass.gObj.uid,virtualclass.gObj.uid,!0)},dispQueuePacket:function(a){(roles.hasControls()||roles.isEducator())&&virtualclass.wb.utility.toolWrapperEnable();virtualclass.wb.drawMode=!1;roles.hasControls()&&(virtualclass.wb.utility.makeCanvasEnable(),virtualclass.wb.utility.enableAppsBar())},makeCanvasDisable:function(){var a=vcan.main.canvas;a.style.position="relative";a.style.pointerEvents="none"},
makeCanvasEnable:function(){!roles.hasControls()||virtualclass.wb.hasOwnProperty("canvasDisable")&&virtualclass.wb.canvasDisable||(vcan.main.canvas.style.pointerEvents="visible")},removeToolBox:function(){var a=document.getElementById(vcan.cmdWrapperDiv);a.parentNode.removeChild(a)},createReclaimButton:function(a){virtualclass.vutil.createDiv("t_reclaim","reclaim",a);document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",virtualclass.wb.objInit)},chkValueInLocalStorage:function(a){return null===
localStorage.getItem(a)?!1:localStorage[a]},uniqueArrOfObjsToStudent:function(){var a="";virtualclass.wb.gObj.replayObjs=[];for(var b=0;b<vcan.main.replayObjs.length;b++)a=vcan.extend({},vcan.main.replayObjs[b]),virtualclass.wb.gObj.replayObjs.push(a)},uniqueArrOfObjsToTeacher:function(){vcan.main.replayObjs=[];for(var a="",b=0;b<virtualclass.wb.gObj.replayObjs.length;b++)a=vcan.extend({},virtualclass.wb.gObj.replayObjs[b]),vcan.main.replayObjs.push(a)},makeDefaultValue:function(a){"undefined"!=typeof a&&
"t_clearall"==a||virtualclass.wb.utility.makeDeActiveTool();virtualclass.wb.gObj.myrepObj=[];virtualclass.wb.gObj.replayObjs=[];virtualclass.wb.gObj.rcvdPackId=0;virtualclass.wb.gObj.displayedObjId=0;virtualclass.wb.gObj.packQueue=[];virtualclass.wb.gObj.queue=[];virtualclass.wb.uid=0;localStorage.setItem("rcvdPackId",0);virtualclass.vutil.chkValueInLocalStorage("wbrtcMsg");virtualclass.vutil.chkValueInLocalStorage("canvasDrwMsg");virtualclass.vutil.chkValueInLocalStorage("toolHeight");JSON.parse(virtualclass.vutil.chkValueInLocalStorage("prvUser"));
JSON.parse(virtualclass.vutil.chkValueInLocalStorage("tc"));virtualclass.gObj.video.audio.bufferSize=0;virtualclass.gObj.video.audio.encMode="alaw";virtualclass.gObj.video.audio.rec="";virtualclass.gObj.video.audio.audioNodes=[];"undefined"!=typeof vcan.objTxt&&vcan.objTxt.removeTextNode();"undefined"!=typeof vcan.main.currentTransform&&(vcan.main.currentTransform="");virtualclass.gObj.video.audio.updateInfo()},clearCurrentTool:function(){virtualclass.wb.hasOwnProperty("tool")&&(virtualclass.wb.tool=
"")},setOrginalTeacherContent:function(){localStorage.setItem("canvasDrwMsg",!0)},checkWebRtcConnected:function(){return"undefined"==typeof cthis||!cthis.pc[0].hasOwnProperty("iceConnectionState")&&"undefined"==typeof cthis.pc[0].iceConnectionState?!1:!0},createVirtualWindow:function(a){virtualclass.wb.gObj.virtualWindow=!0;var b=document.createElement("div");virtualclass.wb.utility.removeVirtualWindow("virtualWindow");b.setAttribute("id","virtualWindow");b.style.width=a.width+"px";if("undefined"!=
typeof assignRoleAtStudent)var d=0;else d=parseInt(localStorage.getItem("toolHeight")),d=null!=d?d:0;roles.hasAdmin()?b.style.height=a.height+d+"px":roles.hasControls()?b.style.height=a.height+"px":b.style.height=a.height-d+"px";a=document.getElementById("containerWb");a.insertBefore(b,a.firstChild)},removeVirtualWindow:function(a){a=document.getElementById(a);null!=a&&(virtualclass.wb.gObj.virtualWindow=!1,a.parentNode.removeChild(a))},getWideValueAppliedByCss:function(a,b){var d=document.getElementById(a);
if(null!=d){var f=c.getComputedStyle(d);if("undefined"!=typeof f.marginTop){var g=parseInt(f.marginTop.match(/\d+/));null==g&&(g=0)}return d.clientHeight+g}return!1},isNumber:function(a){return isNaN(+a)?!1:+a},setCommandToolHeights:function(a,b){var d=document.getElementById("virtualWindow");if(null!=d){var f=parseInt(d.style.height.match(/\d+/));d.style.height="decrement"==b?f-parseInt(a)+"px":f+parseInt(a)+"px"}},setClass:function(a,b){var d=document.getElementById(a),f=d.classList,g="";0<f.length&&
(g=2>g.length?f[0]+" ":f.join(" ")+" ");d.setAttribute("class",g+b)},setStyleUserConnetion:function(a,b,d){a=document.getElementsByClassName(a)[0];null!=a&&a.setAttribute("class",b+" controlCmd")},existUserLikeMe:function(a){if(a.fromUser.userid!=wbUser.id){if(a.message.checkUser.hasOwnProperty("role")){var b=a.message.checkUser.role;if(b){if(null==localStorage.getItem("otherRole")){var d=[];if(b!=virtualclass.gObj.uRole)d.push(b);else return existUser=!0}else d=JSON.parse(localStorage.getItem("otherRole")),
-1==d.indexOf(b)&&d.push(b);"undefined"!=typeof d&&(localStorage.setItem("otherRole",JSON.stringify(d)),console.log("Other Browser "+b+" "+a.fromUser.userid))}return virtualclass.gObj.uRole==b?!0:!1}}else{if("undefined"!=typeof existUser)return!0;a=JSON.parse(localStorage.getItem("otherRole"));if(null!=a){for(b=0;b<a.length;b++)if(virtualclass.gObj.uRole==a[b])return!0;return!1}}},existUserWithSameId:function(a){this.userIds.push(a.fromUser.userid);if(1<this.userIds.length&&virtualclass.wb.utility.arrayContainsSameValue(this.userIds[0],
this.userIds))return!0},makeUserAvailable:function(){null==localStorage.getItem("repObjs")&&(virtualclass.wb.utility.toolWrapperEnable(),null!=vcan.main.canvas&&virtualclass.wb.utility.makeCanvasEnable())},displayCanvas:function(){vcan.canvasWrapperId="canvasWrapper";null==document.getElementById("canvas")&&virtualclass.wb.createCanvas();c.virtualclass.wb.init();virtualclass.wb.utility.makeCanvasDisable();virtualclass.wb.utility.toolWrapperDisable();roles.hasControls()||roles.hasAdmin()||0==vcan.main.children&&
virtualclass.wb.utility.createWhiteboardMessage()},removeWhiteboardMessage:function(){var a=document.getElementById("whiteBoardMsg");null!=a&&a.parentNode.removeChild(a)},createWhiteboardMessage:function(){if(null==document.getElementById("whiteBoardMsg")){var a=document.createElement("div");a.id="whiteBoardMsg";a.innerHTML=virtualclass.lang.getString("msgForWhiteboard");var b=document.getElementById("canvasWrapper");null!=b&&b.appendChild(a)}},initAll:function(a){roles.hasControls()&&virtualclass.wb.utility.makeCanvasDisable();
virtualclass.system.measureResoultion({width:c.outerWidth,height:c.innerHeight})},alreadyExistToolBar:function(){var a=document.getElementById("t_rectangle");if(null!=a)return 8<=a.parentNode.getElementsByClassName("tool").length?!0:!1},toolWrapperDisable:function(a){var b=document.getElementById("commandToolsWrapper");if(null!=b)if("undefined"!=typeof a)for(a=b.getElementsByTagName("a"),b=0;b<a.length;b++)a[b].style.pointerEvents="none";else b=document.getElementById("commandToolsWrapper"),null!=
b&&(b.style.pointerEvents="none")},toolWrapperEnable:function(a){var b=document.getElementById("commandToolsWrapper");if(null!=b)if("undefined"!=typeof a)for(a=b.getElementsByTagName("a"),b=0;b<a.length;b++)a[b].style.pointerEvents="visible";else null==b||virtualclass.gObj.hasOwnProperty("errNotDesktop")||(b.style.pointerEvents="visible")},replayFromLocalStroage:function(a){"undefined"!==typeof Storage&&(!1===virtualclass.storage.reclaim&&virtualclass.vutil.disableAppsBar(),virtualclass.wb.utility.clearAll(!1,
"dontClear"),virtualclass.wb.gObj.tempRepObjs=a,0<a.length&&(virtualclass.wb.utility.makeCanvasDisable(),virtualclass.wb.utility.toolWrapperDisable(),virtualclass.wb.utility.replayObjsByFilter(a,"fromBrowser")))},setUserStatus:function(a,b){a||b?virtualclass.wb.utility.setClass("vcanvas","teacher"):(virtualclass.wb.utility.removeToolBox(),virtualclass.wb.utility.setClass("vcanvas","student"))},crateCanvasDrawMesssage:function(){roles.hasControls()&&null==localStorage.getItem("canvasDrwMsg")&&(c.virtualclass.view.canvasDrawMsg("Canvas"),
c.virtualclass.view.drawLabel("drawArea"),localStorage.canvasDrwMsg=!0)},arrayContainsSameValue:function(a,b){for(var d=0;d<b.length;d++)if(b[d]!==a)return!1;return!0},actionAfterRemovedUser:function(){virtualclass.wb.utility.makeCanvasDisable();virtualclass.wb.utility.setStyleUserConnetion("con","coff");virtualclass.wb.utility.removeVirtualWindow("virtualWindow");virtualclass.wb.user.connected=!1;localStorage.removeItem("otherRole");"undefined"!=typeof cthis&&(tempIsInitiaor=!0,cthis.isStarted&&
cthis.handleRemoteHangup())},sendRequest:function(){virtualclass.vutil.beforeSend({reclaimRole:!0,cf:"reclaimRole"})},updateSentInformation:function(a,b){if(roles.hasAdmin()){var d=JSON.parse(a),d="undefined"!=typeof b?d:d.repObj[0],f="",g;for(g in d)f+=g+" : "+d[g]+" <br />";null!=document.getElementById("sentMsgInfo")&&(document.getElementById("sentMsgInfo").innerHTML=f)}},beforeSend:function(a,b){if(a.hasOwnProperty("createArrow")){var d=JSON.stringify(a);virtualclass.wb.vcan.optimize.sendPacketWithOptimization(d,
io.sock.readyState,100)}else{if(a.hasOwnProperty("repObj")){if("undefined"==typeof a.repObj[a.repObj.length-1])return;virtualclass.wb.gObj.rcvdPackId=a.repObj[a.repObj.length-1].uid;virtualclass.wb.gObj.displayedObjId=virtualclass.wb.gObj.rcvdPackId}d=JSON.stringify(a);1==io.sock.readyState&&("undefined"==typeof b?ioAdapter.mustSend(a):ioAdapter.mustSendUser(a,b));JSON.parse(d).hasOwnProperty("repObj")&&virtualclass.wb.utility.updateSentInformation(d)}},checkCanvasHasParents:function(){for(var a=
document.getElementById("vcanvas");"BODY"!=a.parentNode.tagName;)"vcanvas"!=a.id&&(a.style.margin="0",a.style.padding="0"),a=a.parentNode;"vcanvas"!=a.id&&(a.style.margin="0",a.style.padding="0")},lockvirtualclass:function(){if(c.earlierWidth!=c.innerWidth&&(virtualclass.wb.canvasDisable=!0,virtualclass.wb.utility.makeCanvasDisable(),virtualclass.wb.utility.toolWrapperDisable(),virtualclass.vutil.disableAppsBar(),null==document.getElementById("divForReloadMsg"))){var a=roles.hasControls()?"msgForReload":
"msgStudentForReload";c.virtualclass.view.displayMsgBox("divForReloadMsg",a);c.earlierWidth=c.innerWidth}},getElementRightOffSet:function(a){var b=20;null!=a.parentNode&&(a=a.parentNode,b=vcan.utility.getElementOffset(a),b=c.innerWidth-(a.clientWidth+(b.x-0)));return b},objPutInContainer:function(a){vcan.main.replayObjs.push(a);virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs))},makeActiveTool:function(a){a=document.getElementById(a);var b;virtualclass.wb.hasOwnProperty("prvTool")&&
"t_reclaim"!=virtualclass.wb.prvTool?(b=virtualclass.vutil.removeClassFromElement(virtualclass.wb.prvTool,"active"),document.getElementById(virtualclass.wb.prvTool).className=b):b=a.className;a.className=b+" active";localStorage.activeTool=a.id},makeDeActiveTool:function(){virtualclass.wb.tool="";document.getElementById("commandToolsWrapper");var a=document.getElementsByClassName("tool active");0<a.length&&a[0].classList.remove("active")},createAudioTransmitIcon:function(a){var b=document.cteateElement("div");
b.id="audioTransmit"+uuserId;b.className="audioTransmit";document.getElementById(a+"ControlContainer")},_reclaimRole:function(){virtualclass.wb.utility.reclaimRole();virtualclass.wb.utility.sendRequest();virtualclass.user.control.changeAttrToAssign("enable")},enableAppsBar:function(){var a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.pointerEvents="visible")},replayObjsByFilter:function(a,b){for(var d=0;d<a.length;d++)virtualclass.wb.bridge.makeQueue(a[d]),a[d].uid==virtualclass.wb.gObj.displayedObjId+
1?(virtualclass.wb.uid=a[d].uid,this.executeWhiteboardData(a[d]),"undefined"!=typeof b&&(virtualclass.wb.gObj.rcvdPackId=virtualclass.wb.uid)):console.log("Could not display whiteboard object with "+a[d].uid);console.log("Whiteboard Stored ID "+virtualclass.wb.gObj.replayObjs[virtualclass.wb.gObj.replayObjs.length-1].uid);virtualclass.storage.store(JSON.stringify(virtualclass.wb.gObj.replayObjs))},executeWhiteboardData:function(a){console.log("received uid "+a.uid);virtualclass.wb.gObj.replayObjs.push(a);
virtualclass.wb.response.replayObj([a]);this.checkNextQueue(a)},checkNextQueue:function(a){(a=this.findPacketInQueue(a))&&this.executeWhiteboardData(a)},findPacketInQueue:function(a){if(virtualclass.wb.gObj.queue.hasOwnProperty(a.uid+1))return virtualclass.wb.gObj.queue[a.uid+1];console.log("Packet"+(a.uid+1)+"not found ");return!1}}}})(window);(function(c){c.message={notSupportCanvas:'This browser does not support <a href="http://en.wikipedia.org/wiki/Canvas_element/">Canvas</a>. Please update your browser with the latest version',notSupportGetUserMedia:'The browser does not support <a href="http://dev.w3.org/2011/webrtc/editor/getusermedia.html">getUserMedia</a> for <a href="http://www.webrtc.org/">WebRtc</a>. Please update your browser with the latest version',notSupportPeerConnect:'The browser is unable to create a Peer Connection object for <a href="http://www.webrtc.org/">WebRtc</a>. Please update your browser with the latest version.',
notSupportWebSocket:'This browser does not support <a href="http://www.websocket.org/">WebSocket</a>. Please update your browser with the latest version. ',notSupportWebRtc:'This browser does not support <a href="http://www.webrtc.org/">WebRtc</a>. Please update your browser with the latest version.',line:"Line",rectangle:"Rectangle",triangle:"Triangle",oval:"Oval",assign:"Assign",reclaim:"Reclaim",freeDrawing:"Free hand",text:"Text",replay:"Replay",activeAll:"Active All",clearAll:"Clear All",drawArea:"Draw Area",
totRcvdPackets:"Total Packets Received",perSecRcvdData:"Packet Received Per Second",totSentPackets:"Total Packets Sent",perSecSentPacket:"Packets Sent Per Second ",perSecond:"Per Second",sentPackets:"Sent <br/><span>Packets</span>",receviedPackets:"Received <br/><span>Packets</span>",total:"Total",dataDetails:"Data Details",sentMessageInfo:"Sent Message <br/><span>Information</span>",receivedMessageInfo:"Received Message <br/><span>Information</span>",wbrtcMsgFireFox:'You can click on  "Share Selected Devices" to share your mic and camera feed with other users',
wbrtcMsgChrome:"You can click the deny button for not sharing your microphone and camera  with Congrea.or click allow button to share them.",canvasDrawMsg:"You can click on any tool for drawingclick and hold the left mouse button to draw",clearAllWarnMessage:"Do you really want to clear this whiteboard?",cof:"connection off",askForConnect:"This action can be performed only after another user connects",msgForReload:"Please reload this page to continue editing.",msgStudentForReload:"Please reload this page.",
reload:"Reload",whiteboard:"Whiteboard",screenshare:"Screen Share",sharePresentation:"share presentation",sessionend:"Close Session.",audioTest:"Your voice will be recorded and played back to you. \n Press Ok and speak something for few seconds.",chatEnable:"Disable Chat",chatDisable:"Enable Chat",assignEnable:"Transfer Controls",assignDisable:"Reclaim Controls",editorRichDisable:"Write Mode",editorRichEnable:"Read Only",editorCodeDisable:"Write Mode",editorCodeEnable:"Read Only",audioEnable:"Mute",
audioDisable:"Unmute",audioOff:"Mute",audioOn:"Mute",minCommonChat:"Hide Chat Window",maxCommonChat:"Show Chat Window",miniuserbox:"Hide User Box",maxuserbox:"Show User Box",miniUserList:"Hide User List",maxUserList:"Show User List",startnewsession:"This session has not been saved, do you really want to end this session?",DevicesNotFoundError:"Please check your Webcam (camera/microphone) connection.",PermissionDeniedError:"Webcam access has been denied.",PERMISSION_DENIED:"You denied access to your Webcam(camera/microphone).",
notSupportBrowser:"Firefox {virtualclass1} does not support Screen sharing.",disableSpeaker:"Mute",enableSpeaker:"Unmute",notSupportChrome:"Please update your browser {virtualclass1} {virtualclass2} to Google Chrome 40 or above",errcanvas:"canvas",errwebSocket:"Web Socket",errgetusermedia:"getUserMedia",errindexeddb:"indexedDb",errwebworker:"Web worker",errwebaudio:"Web audio",errtypedarray:"Typed array",errscreenshare:"Screen share",operaBrowserIssue:"Your browser {virtualclass1} {virtualclass2} is partially supported. You will not be able to share your screen, Congrea fully support chrome and Firefox",
commonBrowserIssue:"Your browser {virtualclass1} {virtualclass2} is not supported, Congrea support Chrome and Firefox.",chFireBrowsersIssue:"Your browser {virtualclass1} {virtualclass2} needs updation, Congrea support Chrome 40+ and Firefox 35+.",studentSafariBrowserIssue:"Your browser {virtualclass1} {virtualclass2} cannot  share your webcam with other users, Congrea fully support Chrome  and Firefox.",ieBrowserIssue:"Internet Explorer is not supported, Congrea fully support Chrome  and Firefox.",
ios7support:"For Apple, Virtual Class supports iOS 8 and higher versions.",supportDesktop:"Virtual Class does not support tablets or mobiles. To present please use a desktop.",notSupportIphone:"Sorry. Virtual Class doesn't support mobile phones.",InternalError:"Please ensure that same webcam is not being used <br /> in multiple browsers or multiple applications. ",SourceUnavailableError:"Please ensure that same webcam is not being used in multiple browsers or multiple applications.",teacherSafariBrowserIssue:"Safari does not support presenter functionality. Please switch to Chrome or Firefox.",
safariBrowserIssue:"Your browser Safari {virtualclass1} is not supported, We fully support Chrome  and Firefox",savesession:"Do you want to save current Session?",plswaitwhile:"Please wait....",downloadedFile:"Your files are downloading....,  <br />File, {virtualclass1}, has been downloaded",overallprogress:"Overall Progress",playsessionmsg:"Click \u2018play\u2019 to start the session.",askplayMessage:'<span id="askplaymsg"> Should we start playing the session?</span><br /><span id="remaingmsg">Remaining data will be downloaded in the background.</span>',
youTubeUrl:"Enter YouTube Video URL.",shareYouTubeVideo:"Share YouTube Video",shareAnotherYouTubeVideo:"Share Another YouTube Video",editorCode:"Code Editor",editorRich:"Text Editor",teachermayshow:"YouTube video will be shared shortly.",youtubeshare:"YouTube Video Share",writemode:"Write Mode",readonlymode:"Read Only",msgForDownloadStart:"Unable to save data. <br /> Preparing data for download",msgForWhiteboard:"Empty Whiteboard.",educator:"Educator",supportDesktopOnly:"Sorry, presenter mode only supports desktops. Tablets and Mobile devices are not supported.",
download:"Download",downloadFile:"Download File",synchMessage:"Please wait a while.  Syncing new content.",iosAudEnable:"Tap here to enable the audio",studentAudEnable:"Student Audio Enabled",screensharealready:"The screen is being shared.",editorsynchmsg:"Editor is not in sync, please wait a few seconds and try again ",canvasmissing:"Canvas is missing in your browsers. Please update the latest version of your browser",downloadFile:"Download File",filenotsave:"Your file could not be saved.",muteAll:"Mute All",
unmuteAll:"Unmute All",enablehistory:'"Browser History" should be enabled during the Session.',becomeTeacher:"Become Teacher",pptscreenstudent:"Presentation will be shared shortly",confirmOk:"Yes",confirmCancel:"No",uploadsession:"Please wait until processing is complete.",VCE4:"Record data is missing",VCE5:"There is unable to Record Data.",VCE6:"Course module is missing.",invalidcmid:"Course Module is invalid.",nomdlroot:"There is no url for momodle root.",usermissing:"User is missing",cnmissing:"Chunk number is missing",
sesseionkeymissing:"Session key is missing from Front End.",keymissing:"Your software(LMS/CMS)'s key is is missing",invalidurl:"Your url is invalid",ppturl:"Enter HTML5 Presentation Url."}})(window);(function(c){c.getString=function(a,b){var d=c.virtualclass.lang.message[a];if("undefined"!=typeof b&&0<b.length)for(var f=0;f<b.length;f++)d=d.replace(new RegExp("{virtualclass"+(f+1)+"}"),b[f]);return d}})(window);(function(c){var a={init:function(){this.msgBoxClass="msgBox";this.window={};this.virtualWindow={};return this},displayMessage:function(a,d,f,g,c){a="undefined"==typeof c?this.createMsgBox(a,d,f):this.createMsgBox(a,d,f,c);d=document.getElementById("vcanvas");"undefined"!=typeof g?document.getElementById(g).appendChild(a):d.insertBefore(a,d.childNodes[0])},createErrorMsg:function(a,d,f){var g=document.getElementById(d);null==g?(g=document.createElement("div"),g.id=d,g.innerHTML=a):g.innerHTML=a+"<br /> "+
g.innerHTML;a=document.getElementById(f);a.parentNode.insertBefore(g,a);return g.id},removeErrorMsg:function(a,d){var f=document.getElementById(a);if("undefined"!=typeof d){var g=f.innerHTML.split(/<br>|<br\\>/);if(1<g.length){g.shift();f.innerHTML=g.join();return}}f.parentNode.removeChild(f)},removeErrorContainer:function(a){a=document.getElementById(a);a.parentNode.removeChild(a)},customCreateElement:function(a,d,f){a=document.createElement(a);"undefined"!=typeof d&&(a.id=d);"undefined"!=typeof f&&
(a.className=f);return a},createMsgBox:function(a,d,f,g){var c=this.customCreateElement("div",d,f);"undefined"==typeof g&&(f=this.customCreateElement("div",d+"img",f+"img"),c.appendChild(f));d=this.customCreateElement("p",d+"Para");d.innerHTML=a;c.appendChild(d);return c},disappearBox:function(a){a=document.getElementsByClassName(this.msgBoxClass+a);null!=a[0]&&a[0].parentNode.removeChild(a[0])},multiMediaMsg:function(a){if("Firefox"==virtualclass.system.mybrowser.name){var d=virtualclass.lang.getString("wbrtcMsgFireFox");
this.displayMessage(d,"fireFoxWebrtcCont",this.msgBoxClass+a)}else"Chrome"==virtualclass.system.mybrowser.name&&(d=virtualclass.lang.getString("wbrtcMsgChrome"),this.displayMessage(d,"chormeWebrtcCont",this.msgBoxClass+a))},canvasDrawMsg:function(a){document.getElementById("vcanvas").className="canvasMsgBoxParent";if("Firefox"==virtualclass.system.mybrowser.name){var d=virtualclass.lang.getString("canvasDrawMsg");this.displayMessage(d,"canvasDrawMsgContFirefox",this.msgBoxClass+a,"containerWb")}else"Chrome"==
virtualclass.system.mybrowser.name&&(d=virtualclass.lang.getString("canvasDrawMsg"),this.displayMessage(d,"canvasDrawMsgContChrome",this.msgBoxClass+a,"containerWb"))},drawLabel:function(a){var d=virtualclass.lang.getString("drawArea");this.displayMessage(d,"canvasDrawArea",this.msgBoxClass+a,"containerWb",!1)},displayMsgBox:function(a,d){var f=this.customCreateElement("div",a),g=this.customCreateElement("p",a+"Para");g.innerHTML=virtualclass.lang.getString(d);f.appendChild(g);g=this.customCreateElement("a",
a+"Anchor");g.href="#";g.innerHTML=virtualclass.lang.getString("reload");g.onclick=function(){c.location.reload()};f.appendChild(g);g=document.getElementById("virtualclassCont");g.insertBefore(f,g.firstChild)},displayServerError:function(a,d){var f=this.customCreateElement("div",a);f.innerHTML=d;var g=document.getElementById("vcanvas");g.parentNode.insertBefore(f,g)},removeElement:function(a){a=document.getElementById(a);null!=a&&a.parentNode.removeChild(a)},disableSSUI:function(){var a=document.getElementById("virtualclassScreenShareTool");
null!=a&&(a.style.opacity="0.5",a.style.pointerEvents="none")},disableLeftAppBar:function(){var a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.opacity="0.5",a.style.pointerEvents="none")}},a=a.init();count=0;a.window.resizeFinished=function(){var a=0;return function(d,f){clearTimeout(a);a=setTimeout(d,f)}}();a.window.resize=function(){var a=virtualclass.system.measureResoultion({width:c.innerWidth,height:c.innerHeight});virtualclass.vutil.setContainerWidth(a,virtualclass.currApp);
"Whiteboard"==virtualclass.currApp&&vcan.renderAll()};a.virtualWindow.manupulation=function(a){var d=a.message.virtualWindow;if(d.hasOwnProperty("removeVirtualWindow"))a.fromUser.userid!=wbUser.id&&virtualclass.wb.utility.removeVirtualWindow("virtualWindow");else if(d.hasOwnProperty("createVirtualWindow"))d.hasOwnProperty("toolHeight")&&localStorage.setItem("toolHeight",d.toolHeight),a.fromUser.userid!=wbUser.id&&virtualclass.wb.utility.createVirtualWindow(d.createVirtualWindow);else if(d.hasOwnProperty("shareBrowserWidth")){d.hasOwnProperty("toolHeight")&&
localStorage.setItem("toolHeight",d.toolHeight);if(roles.hasControls()){var f=virtualclass.wb.utility.getWideValueAppliedByCss("commandToolsWrapper");localStorage.setItem("toolHeight",f)}a.fromUser.userid!=wbUser.id?(roles.hasControls()&&virtualclass.wb.utility.makeCanvasEnable(),otherBrowser=d.browserRes):myBrowser=virtualclass.system.measureResoultion({width:c.outerWidth,height:c.innerHeight});"object"==typeof myBrowser&&"object"==typeof otherBrowser&&(myBrowser.width>otherBrowser.width?virtualclass.wb.gObj.virtualWindow||
(virtualclass.wb.utility.createVirtualWindow(otherBrowser),virtualclass.wb.gObj.virtualWindow=!0):myBrowser.width<otherBrowser.width&&!virtualclass.wb.gObj.virtualWindow&&(a=document.getElementById("vcanvas"),a=virtualclass.wb.utility.getElementRightOffSet(a),roles.hasControls()?virtualclass.vutil.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a,toolHeight:f}}):virtualclass.vutil.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a}})))}};c.view=a})(window);(function(c){var a={init:function(){this.wbRtc={};this.wbRtc.className="webrtcCont";this.mybrowser={};return this},isCanvasSupport:function(a,d,f){console.log("is canvas support");console.log(a);console.log(d);return"MSIE"==d?9!=f?!1:!0:c.CanvasRenderingContext2D?!0:!1},isWebSocketSupport:function(a,d,f){return"undefined"==typeof c.WebSocket||"function"!=typeof c.WebSocket&&"object"!=typeof c.WebSocket||!c.WebSocket.hasOwnProperty("OPEN")?!1:!0},isLocalStorageSupport:function(){return void 0!==Storage},
isGetUserMediaSupport:function(a,d){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return navigator.getUserMedia?!0:!1},isIndexedDbSupport:function(){return c.indexedDB||c.webkitIndexedDB||c.mozIndexedDB||c.msIndexedDB?!0:!1},isWorkerSupport:function(){return!!c.Worker},isAudioApiSupport:function(){return c.AudioContext||c.webkitAudioContext?!0:!1},isTypedArraySupport:function(){return!!("ArrayBuffer"in c)},isScreenShareSupport:function(a,
d){return"Firefox"==a?34<=d:"Chrome"==a?39<=d?!0:!1:!1},setValue:function(a,d){this[a]=d},checkBrowserFunctions:function(a,d){this.setValue("canvas",this.isCanvasSupport());this.setValue("webSocket",this.isWebSocketSupport());this.setValue("getusermedia",this.isGetUserMediaSupport());this.setValue("indexeddb",this.isIndexedDbSupport());this.setValue("webworker",this.isWorkerSupport());this.setValue("webaudio",this.isAudioApiSupport());this.setValue("typedarray",this.isTypedArraySupport());this.setValue("screenshare",
this.isScreenShareSupport(a,d));this.setValue("localstorage",this.isLocalStorageSupport())},measureResoultion:function(a){var d=document.getElementById("virtualclassCont"),d=vcan.utility.getElementOffset(d),f=d.x;return{width:1024>a.width?1024-(f+10):a.width-f,height:a.height-d.y}},setAppDimension:function(){var b=this.measureResoultion({width:c.innerWidth,height:c.innerHeight});virtualclass.vutil.setContainerWidth(b,virtualclass.currApp);"Whiteboard"==virtualclass.currApp&&a.setCanvasDimension(b)},
setCanvasDimension:function(a){if("undefined"!=typeof vcan.main.canvas){var d=vcan.main.canvas;ctx=vcan.main.canvas.getContext("2d");d.width=a.width;var f=virtualclass.isPlayMode?85:10,f=roles.hasControls()||roles.hasAdmin()?65:f;d.height=a.height-f;console.log("canvas width "+d.width);a=vcan.utility.getElementOffset(document.getElementById("canvas"));vcan.main.offset.x=a.x}},getResoultion:function(a){var d={};1280>a?(d.width=1024,d.height=768):1280<=a&&1366>a?(d.width=1280,d.height=1024):1366<=a&&
1920>a?(d.width=1366,d.height=768):1920<=a&&(d.width=1920,d.height=1080);return d},reportBrowser:function(a){a=this.getErrors(a);1<a.length?virtualclass.error.push(a.join(",")+" are disabled in your browser."):1==a.length&&virtualclass.error.push(a+" is disabled in your browser.")},getErrors:function(a){var d=[],f="canvas webSocket getusermedia webaudio indexeddb localstorage typedarray".split(" ");"t"!=a&&"e"!=a||f.push("webworker","screenshare");for(a=0;a<f.length;a++)this[f[a]]||("screenshare"==
f[a]&&(virtualclass.gObj.errNotScreenShare=!0),d.push(virtualclass.lang.getString("err"+f[a])));return d},isiOSDevice:function(){return parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1},isAndroid:function(){return-1<navigator.userAgent.toLowerCase().indexOf("android")},isIPad:function(){return/(iPad)/g.test(navigator.userAgent)},setBrowserDetails:function(){var a=this.isiOSDevice();
this.device="desktop";if(a){var d="iOS";this.device="mobTab"}else a=this.mybrowser.detection(),d=a[0],a=parseFloat(a[1]);this.mybrowser.name=d;this.mybrowser.version=a},check:function(){var a=this.isiOSDevice();this.device="desktop";if(a){var d="iOS";this.device="mobTab"}else var f=this.isAndroid(),a=this.mybrowser.detection(),d=a[0],a=parseFloat(a[1]);this.mybrowser.name=d;this.mybrowser.version=a;this.checkBrowserFunctions(d,a);"undefined"!=typeof f&&f?(this.device="mobTab",roles.hasControls()?
(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("supportDesktopOnly"))):f&&("Chrome"==d?40<=a?virtualclass.vutil.initDisableAudVid():(virtualclass.error.push(virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",[d,a]))),virtualclass.vutil.initDisableVirtualClass()):(virtualclass.error.push(virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",[d,a]))),virtualclass.vutil.initDisableVirtualClass()))):"Chrome"==
d&&40<=a||"Firefox"==d&&35<=a||roles.isStudent()&&d=="OPR">a>=26?this.reportBrowser(virtualclass.gObj.uRole):"Chrome"==d&&40>a||"Firefox"==d&&35>a||roles.isStudent()&&"OPR"==d&&26>a?(this.reportBrowser(virtualclass.gObj.uRole),virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",[d,a]))):"OPR"==d&&26<=a?(this.reportBrowser(virtualclass.gObj.uRole),roles.hasControls()&&virtualclass.error.push(virtualclass.lang.getString("operaBrowserIssue",[d,a]))):"Safari"==d?8<=a?roles.hasControls()?
(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("teacherSafariBrowserIssue",[d,a]))):(virtualclass.vutil.initDisableAudVid(),virtualclass.error.push(virtualclass.lang.getString("studentSafariBrowserIssue",[d,a])),virtualclass.user.control.audioWidgetDisable()):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("safariBrowserIssue",[d,a]))):"iOS"==d?this.isIPad()?roles.isStudent()?8<=a?(virtualclass.vutil.initDisableAudVid(),
virtualclass.gObj.iosIpadbAudTrue=!1,d=document.createElement("div"),d.innerHTML=virtualclass.lang.getString("iosAudEnable"),d.id="iosAudioTrigger",d.addEventListener("click",function(){virtualclass.vutil.firstiOSaudioCall();this.parentNode.removeChild(this)}),f=document.getElementById("audioWidget"),f.parentNode.insertBefore(d,f.nextSibling)):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("ios7support"))):(virtualclass.vutil.initDisableVirtualClass(),
virtualclass.error.push(virtualclass.lang.getString("supportDesktop"))):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("notSupportIphone"))):(this.mybrowser.detectIE()?(virtualclass.gObj.errIE=!0,virtualclass.error.push(virtualclass.lang.getString("ieBrowserIssue"))):virtualclass.error.push(virtualclass.lang.getString("commonBrowserIssue",[d,a])),virtualclass.vutil.initDisableVirtualClass())}},a=a.init();c.addEventListener("resize",function(){c.earlierWidth!=
c.innerWidth&&a.setAppDimension()});c.addEventListener("resize",function(){c.earlierWidth!=c.innerWidth&&virtualclass.view.window.resize()});a.mybrowser.detectIE=function(){var a=c.navigator.userAgent,d=a.indexOf("MSIE ");if(0<d)return parseInt(a.substring(d+5,a.indexOf(".",d)),10);if(0<a.indexOf("Trident/"))return d=a.indexOf("rv:"),parseInt(a.substring(d+3,a.indexOf(".",d)),10);d=a.indexOf("Edge/");return 0<d?parseInt(a.substring(d+5,a.indexOf(".",d)),10):!1};a.mybrowser.detection=function(){var a=
navigator.userAgent,d,f=a.match(/(opera|opr|OPR(?=\/))\/?\s*([\d\.]+)/i)||[];if(0>=f.length&&(f=a.match(/(chrome|safari|firefox|trident(?=\/))\/?\s*([\d\.]+)/i)||[],"Safari"==f[1])){var g=a.match(/(version(?=\/))\/?\s*([\d\.]+)/i)||[];f[2]=g[2]}if(/trident/i.test(f[1]))return d=/\brv[ :]+(\d+(\.\d+)?)/g.exec(a)||[],"IE "+(d[1]||"");f=f[2]?[f[1],f[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(d=a.match(/version\/([\.\d]+)/i))&&(f[2]=d[1]);return f};c.system=a})(window);(function(c){c.packContainer=function(){return{createPacketContDiv:function(a,b){var d=document.createElement("div");"undefined"!=typeof a&&(d.id=a);"undefined"!=typeof b&&(d.clasName=b);return d},togglePacketCont:function(a){for(var b=this.className.split(" "),d=0;d<b.length;d++)if("display"==b[d]){this.className="hide";this.innerHTML="+";a._togglePacketCont(b[d]);break}else if("hide"==b[d]){this.className="display";this.innerHTML="-";a._togglePacketCont(b[d]);break}},_togglePacketCont:function(a){a=
"display"==a?"none":"block";document.getElementById("dataInfoHeading").style.display=a;var b=document.getElementById("packetContainer");b.style.display=a;b=document.getElementById("informationCont");b.style.display=a}}}})(window);(function(c){c.draw_object=function(a,b,d){var f=this;d.started=!1;var g,c,m=[];d.mousedown=function(b,g){(new Date).getTime();b.detail.hasOwnProperty("cevent")&&(b.clientX=b.detail.cevent.x+f.vcan.main.offset.x,b.clientY=b.detail.cevent.y+f.vcan.main.offset.y,b.x=b.detail.cevent.x+f.vcan.main.offset.x,b.y=b.detail.cevent.x+f.vcan.main.offset.y,b.pageX=b.detail.cevent.x+f.vcan.main.offset.x,b.pageY=b.detail.cevent.y+f.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);var c=f.vcan;
lastmousemovetime=null;d.startPosX=b.currX;d.startPosY=b.currY;virtualclass.wb.gObj.spx=d.startPosX;virtualclass.wb.gObj.spy=d.startPosY;if("create"==c.getStates("action")){var m=(new Date).getTime();if("text"!=a&&"t_clearall"!=f.tool.cmd){var h=c.getStates("currentTransform");if(""==h||null==h)b.detail.hasOwnProperty("cevent")||c.optimize.calculatePackets(m,"d",d.startPosX,d.startPosY),d.started=!0}else f.obj.drawTextObj.muser=!1,b.detail.hasOwnProperty("cevent")||"t_clearall"==f.tool.cmd?f.obj.drawTextObj.muser=
!0:f.utility.clickOutSidebox(f.obj.drawTextObj.textWriteMode)&&c.optimize.calculatePackets(m,"d",d.startPosX,d.startPosY),b.detail.hasOwnProperty("cevent")?b.detail.cevent.hasOwnProperty("mtext")?f.obj.drawTextObj.textUtility(d.startPosX,d.startPosY,b.detail.cevent.mtext):f.obj.drawTextObj.textUtility(d.startPosX,d.startPosY):"object"==typeof f.obj.drawTextObj&&f.obj.drawTextObj.textUtility(d.startPosX,d.startPosY)}"freeDrawing"==a&&!0==f.obj.freeDrawObj.freesvg&&f.obj.freeDrawObj.drawStart(b)};d.mousemove=
function(b,q){b.detail.hasOwnProperty("cevent")&&(b.clientX=b.detail.cevent.x+f.vcan.main.offset.x,b.clientY=b.detail.cevent.y+f.vcan.main.offset.y,b.x=b.detail.cevent.x+f.vcan.main.offset.x,b.y=b.detail.cevent.x+f.vcan.main.offset.y,b.pageX=b.detail.cevent.x+f.vcan.main.offset.x,b.pageY=b.detail.cevent.y+f.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);if(d.started&&"t_clearall"!=f.tool.cmd)if(void 0!=f.obj.freeDrawObj&&!0==f.obj.freeDrawObj.freesvg){if(f.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&
(f.obj.freeDrawObj.wb_draw(b),!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))){"undefined"!=typeof q||"undefined"!=typeof lastmousemovetime&&null!=lastmousemovetime||(lastmousemovetime=(new Date).getTime(),vcan.optimize.calculatePackets(lastmousemovetime,"m",b.currX,b.currY));var u=(new Date).getTime(),u=vcan.makeStackObj(u,"m",b.currX,b.currY);m.push(u);if("undefined"==typeof q&&(presentmousemovetime=(new Date).getTime(),2E3<=presentmousemovetime-
lastmousemovetime)){for(u=0;u<m.length;u++)f.uid++,m[u].uid=f.uid,vcan.main.replayObjs.push(m[u]);virtualclass.vutil.beforeSend({repObj:m,cf:"repObj"});virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs));m=[];lastmousemovetime=(new Date).getTime()}}}else{g=b.currX;c=b.currY;""!=f.prvObj&&f.canvas.removeObject(f.prvObj);var u=f.makeobj(d.startPosX,d.startPosY,g,c,a),w=f.canvas.readyObject(u);f.canvas.addObject(w);w.coreObj.usrCurrAction="create";u=(new Date).getTime();if("undefined"==
typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=(new Date).getTime(),(!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))&&"text"!=a&&"t_clearall"!=f.tool.cmd&&vcan.optimize.calculatePackets(u,"m",g,c);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&((!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))&&"text"!=a&&"t_clearall"!=
f.tool.cmd&&vcan.optimize.calculatePackets(u,"m",g,c),lastmousemovetime=(new Date).getTime());f.prvObj=w.coreObj}else"move"==f.vcan.main.action&&(""!=vcan.main.currentTransform&&null!=vcan.main.currentTransform||"move"!=f.vcan.main.action)||virtualclass.vutil.beforeSend({createArrow:!0,x:b.currX,y:b.currY,cf:"createArrow"})};d.mouseup=function(b,q){b.detail.hasOwnProperty("cevent")&&(b.clientX=b.detail.cevent.x+f.vcan.main.offset.x,b.clientY=b.detail.cevent.y+f.vcan.main.offset.y,b.x=b.detail.cevent.x+
f.vcan.main.offset.x,b.y=b.detail.cevent.x+f.vcan.main.offset.y,b.pageX=b.detail.cevent.x+f.vcan.main.offset.x,b.pageY=b.detail.cevent.y+f.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);g=b.currX;c=b.currY;lastmousemovetime=null;if(d.started&&"text"!=a){d.mousemove(b,"up");if((!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))&&"freeDrawing"!=a){var u=(new Date).getTime();vcan.optimize.calculatePackets(u,"u",g,c)}if(void 0!=
f.obj.freeDrawObj&&!0==f.obj.freeDrawObj.freesvg&&(f.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&f.obj.freeDrawObj.finalizeDraw(b),(!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))&&0<m.length)){u=(new Date).getTime();u=vcan.makeStackObj(u,"u",g,c);m.push(u);for(u=0;u<m.length;u++)f.uid++,m[u].uid=f.uid,vcan.main.replayObjs.push(m[u]);virtualclass.vutil.beforeSend({repObj:m,cf:"repObj"});virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs));
m=[]}""!=f.prvObj&&(f.prvObj="");f.prvObj="";d.started=!1}f.vcan.wb.sentPack&&(f.vcan.wb.sentPack=!1)}}})(window);(function(c){c.makeobj=function(a,b,d,f,g){var c={mp:{}};c.mp.x=d;c.mp.y=f;if(a>d){var m=d,n=f;d=a;f=b;a=m;b=n;c.dRoad="b2t"}else c.dRoad="t2b";c.type=g;if("rectangle"==g||"triangle"==g)c.sx=a,c.sy=b,c.ex=d,c.ey=f;if("line"==g)c.lineColor="#424240",c.lineWidth=3,c.start={x:a,y:b},c.end={x:d,y:f};else if("rectangle"==g)c.width=d-a,c.height=f-b,c.borderColor="#424240",c.lineWidth=3;else if("oval"==g)c.lineWidth=3,c.borderColor="#424240",c.width=d-a,c.height=f-b,c.x=d-c.width/2,c.y=f-c.height/2,c.rx=
c.width/2,c.ry=c.height/2;else if("triangle"==g)c.lineWidth=3,c.borderColor="#424240";else if("text"==g)return;return c}})(window);(function(c){var a=c.vcan;a.utility={canvasCalcOffset:function(b){var d=a.main;b=document.getElementById(b);b=a.utility.getElementOffset(b);return d.offset=b},getElementOffset:function(a){var d=0,f=0;do d+=a.offsetTop||0,f+=a.offsetLeft||0,a=a.offsetParent;while(a);return{x:f,y:d}},setVal:function(b,d,f){("scaleX"===d||"scaleY"===d)&&f<b.MIN_SCALE_LIMIT&&(f=b.MIN_SCALE_LIMIT);if("object"==typeof d)for(var c in d)a.utility.setVal(b,c,d[c]);else"angle"===d?a.utility.setAngle(b,f):b[d]=f;return b},getVal:function(a,
d){return a[d]},setAngle:function(a,d){a.theta=d/180*Math.PI;a.angle=d;return a},actualPointer:function(b){return{x:a.utility.pointerX(b),y:a.utility.pointerY(b)}},pointerX:function(a){var d=document.documentElement,f=document.body||{scrollLeft:0};return a.pageX||("unknown"!=typeof a.clientX?a.clientX:0)+(d.scrollLeft||f.scrollLeft)-(d.clientLeft||0)},pointerY:function(a){var d=document.documentElement,f=document.body||{scrollTop:0};return a.pageY||("unknown"!=typeof a.clientY?a.clientY:0)+(d.scrollTop||
f.scrollTop)-(d.clientTop||0)},getReltivePoint:function(b){var d=a.main.offset;b=a.utility.actualPointer(b);return{x:b.x-d.x,y:b.y-d.y}},degreesToRadians:function(a){return Math.PI/180*a},setActiveObject:function(b){a.main.activeObject&&a.main.activeObject.setActive(!1);a.main.activeObject=b;b.setActive(!0);return b},updateObj:function(a){var d={};for(prop in a)"oCoords"!=prop?d[prop]=a[prop]:(d.start={},d.end={},d.start.x=a[prop].tl.x,d.start.y=a[prop].tl.y,d.end.x=a[prop].br.x,d.end.y=a[prop].br.y);
return d},setCursorFromEvent:function(a,d,f){var c=a.upperCanvasEl.style;if(f)if(d=f.findTargetCorner(d))if(d in a.cursorMap)c.cursor=a.cursorMap[d];else if("mtr"===d&&f.hasRotatingPoint)c.cursor=a.rotationCursor;else return c.cursor=this.defaulCursor,!1;else c.cursor=a.hoverCursor;else return c.cursor=this.defaultCursor,!1;return!0},getChildren:function(){return a.main.children}}})(window);(function(c){var a=c.vcan;a.main.prototype={addObject:function(b){if("object"==typeof b.coreObj){"freehand"!=b.coreObj.type&&a.main.children.push(b.coreObj);var d=a.main.canvas.getContext("2d");a.render(d,b.coreObj)}},removeObject:function(b){a.remove(b)},bind:function(b,d){a.events().bind(a.main.canvas,b,d)},readyObject:function(b,d){b=a.extend({},b);d||void 0!=b.id||(a.main.id++,b.id=a.main.id);b.cornersize=12;b.rotatingPointOffset=40;b.selectable=!0;b.downObj=!1;b.active=!1;b.cornersize=12;b.padding=
0;b.hasControls=!0;b.cornerColor="rgba(102,153,255,0.5)";void 0==b.borderColor&&(b.borderColor="#000");b.flipX=!1;b.flipY=!1;b.draggable=!1;b.hasBorders=!0;b.hasRotatingPoint=!1;b.hideCorners=!1;b.lockRotation=!1;b.MIN_SCALE_LIMIT=.1;b.borderOpacityWhenMoving=.4;b.hasOwnProperty("theta")||(b.theta=0);b.hasOwnProperty("scaleX")||(b.scaleX=1);b.hasOwnProperty("scaleY")||(b.scaleY=1);"line"==b.type?(a.objLine=new a.line,a.objLine.init(b)):"rectangle"==b.type?(a.objRect=new a.rectangle,a.objRect.init(b)):
"oval"==b.type?(a.objOval=new a.oval,a.objOval.init(b)):"triangle"==b.type?(a.objTri=new a.triangle,a.objTri.init(b)):"text"==b.type&&(a.objTxt=new a.text,a.objTxt.init(b));b.getWidth=function(){return this.width*this.scaleX};b.getHeight=function(){return this.height*this.scaleY};b.setCoords=function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this.hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this.angle=Math.atan(this.currentHeight/
this.currentWidth);this.theta=this.theta;var d=Math.cos(this.angle+this.theta)*this.hypotenuse,c=Math.sin(this.angle+this.theta)*this.hypotenuse,h=this.theta,m=Math.sin(h),h=Math.cos(h),d={x:this.x-d,y:this.y-c},c={x:d.x+this.currentWidth*h,y:d.y+this.currentWidth*m},n={x:d.x-this.currentHeight*m,y:d.y+this.currentHeight*h};this.oCoords={tl:d,tr:c,br:{x:c.x-this.currentHeight*m,y:c.y+this.currentHeight*h},bl:n,ml:{x:d.x-this.currentHeight/2*m,y:d.y+this.currentHeight/2*h},mt:{x:d.x+this.currentWidth/
2*h,y:d.y+this.currentWidth/2*m},mr:{x:c.x-this.currentHeight/2*m,y:c.y+this.currentHeight/2*h},mb:{x:n.x+this.currentWidth/2*h,y:n.y+this.currentWidth/2*m},mtr:{x:d.x+this.currentWidth/2*h,y:d.y+this.currentWidth/2*m}};this.setCornerCoords();b.findTargetCorner=function(d){var f=a.main.offset;if(!this.hasControls)return!1;var c=a.utility.actualPointer(d);d=c.x-f.x;var f=c.y-f.y,g;for(g in this.oCoords){if("mtr"===g&&!this.hasRotatingPoint)break;c=a.virtual_box.getImageLines(this.oCoords[g].corner,
g);c=a.virtual_box.findCrossPoints(d,f,c);if(1==c%2&&0!=c)return b.corner=g}return!1};return this};b.drawBorders=function(a){if(this.hasBorders){var b=this.padding,d=2*b;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var c=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX),n=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(c,n);c=this.getWidth();n=this.getHeight();
a.strokeRect(~~(-(c/2)-b)+.5,~~(-(n/2)-b)+.5,~~(c+d),~~(n+d));!this.hasRotatingPoint||this.hideCorners||this.lockRotation||(b=(this.flipY?n:-n)/2,a.beginPath(),a.moveTo(0,b),a.lineTo(0,b+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),a.closePath(),a.stroke());a.restore();return this}};b.drawCorners=function(a){if(this.hasControls){var b=this.cornersize,d=b/2,c=this.padding,n=-(this.width/2),q=-(this.height/2),u=b/this.scaleX,w=b/this.scaleY,t=(c+d)/this.scaleY,x=(c+d)/this.scaleX,
r=(c+d-b)/this.scaleX,d=(c+d-b)/this.scaleY,c=this.height;a.save();a.fillStyle=this.cornerColor;a.fillRect(n-x,q-t,u,w);b=n+this.width-x;a.fillRect(b,q-t,u,w);a.fillRect(n-x,q+c+d,u,w);b=n+this.width+r;a.fillRect(b,q+c+d,u,w);b=n+this.width/2-x;a.fillRect(b,q-t,u,w);b=n+this.width/2-x;a.fillRect(b,q+c+d,u,w);b=n+this.width+r;a.fillRect(b,q+c/2-t,u,w);a.fillRect(n-x,q+c/2-t,u,w);this.hasRotatingPoint&&(b=n+this.width/2-x,n=this.flipY?q+c+this.rotatingPointOffset/this.scaleY-w/2:q-this.rotatingPointOffset/
this.scaleY-w/2,a.fillRect(b,n,u,w));a.restore();return this}};b.setActive=function(a){this.active=!!a;return this};b.dragDrop=function(a){this.draggable=void 0!=a?a:!1};b.setCornerCoords=function(){var b=this.oCoords,d=a.utility.degreesToRadians(45-this.getAngle()),c=Math.sqrt(2*Math.pow(this.cornersize,2))/2,m=c*Math.cos(d),d=c*Math.sin(d),c=Math.sin(this.theta),n=Math.cos(this.theta);b.tl.corner={tl:{x:b.tl.x-d,y:b.tl.y-m},tr:{x:b.tl.x+m,y:b.tl.y-d},bl:{x:b.tl.x-m,y:b.tl.y+d},br:{x:b.tl.x+d,y:b.tl.y+
m}};b.tr.corner={tl:{x:b.tr.x-d,y:b.tr.y-m},tr:{x:b.tr.x+m,y:b.tr.y-d},br:{x:b.tr.x+d,y:b.tr.y+m},bl:{x:b.tr.x-m,y:b.tr.y+d}};b.bl.corner={tl:{x:b.bl.x-d,y:b.bl.y-m},bl:{x:b.bl.x-m,y:b.bl.y+d},br:{x:b.bl.x+d,y:b.bl.y+m},tr:{x:b.bl.x+m,y:b.bl.y-d}};b.br.corner={tr:{x:b.br.x+m,y:b.br.y-d},bl:{x:b.br.x-m,y:b.br.y+d},br:{x:b.br.x+d,y:b.br.y+m},tl:{x:b.br.x-d,y:b.br.y-m}};b.ml.corner={tl:{x:b.ml.x-d,y:b.ml.y-m},tr:{x:b.ml.x+m,y:b.ml.y-d},bl:{x:b.ml.x-m,y:b.ml.y+d},br:{x:b.ml.x+d,y:b.ml.y+m}};b.mt.corner=
{tl:{x:b.mt.x-d,y:b.mt.y-m},tr:{x:b.mt.x+m,y:b.mt.y-d},bl:{x:b.mt.x-m,y:b.mt.y+d},br:{x:b.mt.x+d,y:b.mt.y+m}};b.mr.corner={tl:{x:b.mr.x-d,y:b.mr.y-m},tr:{x:b.mr.x+m,y:b.mr.y-d},bl:{x:b.mr.x-m,y:b.mr.y+d},br:{x:b.mr.x+d,y:b.mr.y+m}};b.mb.corner={tl:{x:b.mb.x-d,y:b.mb.y-m},tr:{x:b.mb.x+m,y:b.mb.y-d},bl:{x:b.mb.x-m,y:b.mb.y+d},br:{x:b.mb.x+d,y:b.mb.y+m}};b.mtr.corner={tl:{x:b.mtr.x-d+c*this.rotatingPointOffset,y:b.mtr.y-m-n*this.rotatingPointOffset},tr:{x:b.mtr.x+m+c*this.rotatingPointOffset,y:b.mtr.y-
d-n*this.rotatingPointOffset},bl:{x:b.mtr.x-m+c*this.rotatingPointOffset,y:b.mtr.y+d-n*this.rotatingPointOffset},br:{x:b.mtr.x+d+c*this.rotatingPointOffset,y:b.mtr.y+m-n*this.rotatingPointOffset}}};b.getAngle=function(){return 180*this.theta/Math.PI};b.setZindex=function(){for(var b=0;b<a.main.children.length;b++)if(this.id==a.main.children[b].id){var d=a.main.children[b];a.main.children.splice(b,1);break}return" "!=d?(a.main.children.push(d),!0):!1};b.setupCurrentTransform=function(b){var d=a.main,
c="drag",m=a.utility.actualPointer(b);if(b=this.findTargetCorner(b))c="ml"===b||"mr"===b?"scaleX":"mt"===b||"mb"===b?"scaleY":"mtr"===b?"rotate":this.hasRotatingPoint?"scale":"rotate";d.currentTransform={target:this,action:c,scaleX:this.scaleX,scaleY:this.scaleY,offsetX:m.x-this.x,offsetY:m.y-this.y,ex:m.x,ey:m.y,x:this.x,y:this.y,theta:this.theta,width:this.width*this.scaleX};d.currentTransform.original={x:this.x,y:this.y}};"text"!=b.type&&b.setCoords();return a.makeDispObject(b)}}})(window);(function(c){var a=c.vcan;a.events=function(){return{bind:function(a,d,f){a["on"+d]=f},findTarget:function(b){for(var d,f=a.main.children,c=f.length;c--;)if(f[c]&&a.virtual_box.containsPoint(b,f[c])){d=f[c];break}if(d&&d.selectable)return d}}}})(window);(function(c){var a=c.vcan;a.virtual_box={findCrossPoints:function(a,d,f){var c,h,m,n=0,q;for(q in f)if(m=f[q],!(m.o.y<d&&m.d.y<d||m.o.y>=d&&m.d.y>=d)&&(m.o.x==m.d.x&&m.o.x>=a?c=m.o.x:(c=(m.d.y-m.o.y)/(m.d.x-m.o.x),h=d-0*a,m=m.o.y-c*m.o.x,c=-(h-m)/(0-c)),c>=a&&(n+=1),2==n))break;return n},getImageLines:function(a,d){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},containsPoint:function(b,d){var f=a.utility.getReltivePoint(b),c=f.x,f=f.y,
h=a.virtual_box.getImageLines(d.oCoords);return(c=a.virtual_box.findCrossPoints(c,f,h))&&1===c%2||d.findTargetCorner(b)?!0:!1}}})(window);(function(c){var a=c.vcan;a.interact={rotateObject:function(b,d){var f=a.main.currentTransform,c=a.main.offset;if(!f.target.lockRotation){var h=Math.atan2(f.ey-f.y-c.y,f.ex-f.x-c.x),c=Math.atan2(d-f.y-c.y,b-f.x-c.x);a.utility.setVal(f.target,"theta",c-h+f.theta)}},scaleObject:function(b,d,f){var c=a.main.currentTransform,h=a.main.offset;target=c.target;if(!target.lockScalingX||!target.lockScalingY){var m=Math.sqrt(Math.pow(c.ey-c.y-h.y,2)+Math.pow(c.ex-c.x-h.x,2));b=Math.sqrt(Math.pow(d-c.y-h.y,2)+
Math.pow(b-c.x-h.x,2));target.scaling=!0;f?"x"!==f||target.lockUniScaling?"y"!==f||target.lockUniScaling||target.lockScalingY||a.utility.setVal(target,"scaleY",c.scaleY*b/m):target.lockScalingX||a.utility.setVal(target,"scaleX",c.scaleX*b/m):(target.lockScalingX||a.utility.setVal(target,"scaleX",c.scaleX*b/m),target.lockScalingY||a.utility.setVal(target,"scaleY",c.scaleY*b/m))}},translateObject:function(b,d){var f=a.main.currentTransform.target;f.lockMovementX||a.utility.setVal(f,"x",b-a.main.currentTransform.offsetX);
f.lockMovementY||a.utility.setVal(f,"y",d-a.main.currentTransform.offsetY);return f}}})(window);(function(c){c.vcan.rectangle=function(){return{type:"rectangle",init:function(a){void 0==a.x&&(a.x=a.ex-a.width/2);void 0==a.y&&(a.y=a.ey-a.height/2);return a},draw:function(a,b,d){d=-b.width/2;var f=-b.height/2,c=b.width,h=b.height;a.beginPath();a.strokeStyle=void 0!=b.borderColor?'"'+b.strokeColor+'"':"#000";a.moveTo(d,f);a.stroke();a.lineTo(d+c,f);a.stroke();a.lineTo(d+c,f+h);a.stroke();a.lineTo(d,f+h);a.stroke();a.lineTo(d,f);a.fillStyle=void 0!=b.fillColor?b.fillColor:" ";a.closePath();a.stroke();
void 0!=b.fillColor&&(a.fillStyle=b.fillColor,a.fill())}}}})(window);(function(c){c.vcan.oval=function(){return{type:"oval",init:function(a){void 0==a.width&&(a.width=2*a.rx);void 0==a.height&&(a.height=2*a.ry);void 0==a.borderColor&&(a.borderColor="#000000");void 0!=a.fillColor&&(a.fillStyle=a.fillColor);return a},draw:function(a,b,d){a.beginPath();a.save();var f=2*Math.PI;a.lineWidth=b.lineWidth;var c=b.ry/b.rx,c=c.toFixed(3);0==c&&(c=.01);a.transform(1,0,0,c,0,0);a.arc(d?b.x:0,d?b.y:0,b.rx,0,f,!1);a.closePath();void 0!=b.fillStyle&&(a.fillStyle=b.fillStyle,a.fill());
void 0!=b.borderColor&&(a.fillStyle=b.borderColor,a.stroke());a.restore()}}}})(window);(function(c){c.vcan.triangle=function(){return{type:"triangle",init:function(a){a.fillStyle=a.fillColor;void 0==a.dRoad&&(a.dRoad="ltr");void 0==a.width&&(a.width=a.ex-a.sx);void 0==a.height&&(a.height=a.ey-a.sy);void 0==a.x&&(a.x=a.ex-a.width/2);void 0==a.y&&(a.y=a.ey-a.height/2);return a},draw:function(a,b,d){a.beginPath();if("t2b"==b.dRoad){d=b.width/2;var f=b.height/2}else d=-b.width/2,f=-b.height/2;a.lineWidth=b.lineWidth;void 0!=b.borderColor&&(a.strokeStyle=b.borderColor);a.moveTo(-d,f);a.lineTo(0,
-f);a.lineTo(d,f);a.closePath();void 0!=b.fillStyle&&(a.fillStyle=b.fillStyle,a.fill());a.stroke()}}}})(window);(function(c){c.vcan.line=function(){return{type:"line",init:function(a){var b=a.start.x,d=a.start.y,f=a.end.x,c=a.end.y;void 0==a.width&&(a.width=f-b,a.height=c-d);a.x=b+(f-b)/2;a.y=d+(c-d)/2;return a},draw:function(a,b,d){a.beginPath();d=1===b.width?0:b.width/2;var c=1===b.height?0:b.height/2;a.moveTo(1===b.width?0:-b.width/2,1===b.height?0:-b.height/2);a.lineTo(d,c);a.lineWidth=b.lineWidth;void 0!=b.lineColor&&(a.strokeStyle=b.lineColor);a.closePath();a.stroke()}}}})(window);(function(c){c.vcan.text=function(){return{type:"text",init:function(a){a.lineHeight=1.3;void 0==a.fontSize&&(a.fontSize=30);a.font=a.fontSize+"px Times New Roman";return a},draw:function(a,b,d){a.font=b.font;d=b.text.split(/\r?\n/);b.height=this.getTextHeight(a,d,b);b.width=this.getTextWidth(a,d);a.beginPath();for(var c=0,g=d.length;c<g;c++)a.fillText(d[c],-b.width/2,-b.height/2+c*b.fontSize*b.lineHeight+b.fontSize);a.closePath();b.setCoords()},getTextWidth:function(a,b){for(var d=a.measureText(b[0]).width,
c=1,g=b.length;c<g;c++){var h=a.measureText(b[c]).width;h>d&&(d=h)}return d},getTextHeight:function(a,b,d){return d.fontSize*b.length*d.lineHeight},removeTextNode:function(){for(var a=document.getElementsByClassName("textBoxContainer"),b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])}}}})(window);(function(c){var a=c.vcan;a.main.freeHandDrawing=function(b){return{type:"freeDrawing",init:function(){this.contextTop={};this.isCurrentlyDrawing=!1;this.freeDrawingXPoints=[];this.freeDrawingYPoints=[];this.mdTime=[];this.freeDrawingColor=void 0==b.borderColor?"#000000":b.borderColor;this.freeDrawingLineWidth=void 0!=b.lineWidth?b.lineWidth:"3";return this},fhdStart:function(a,b,c){c=(new Date).getTime();this.contextTop=a;this.isCurrentlyDrawing=!0;this.freeDrawingXPoints.push(b.x);this.freeDrawingYPoints.push(b.y);
this.contextTop.beginPath();this.contextTop.save();this.contextTop.moveTo(b.x,b.y);this.mdTime.push(c);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},fhRendering:function(a,b){var c=(new Date).getTime();this.freeDrawingXPoints.push(a.x);this.freeDrawingYPoints.push(a.y);this.contextTop.lineTo(a.x,a.y);this.contextTop.stroke();this.mdTime.push(c)},finalizeDrawingPath:function(d,c,g){(new Date).getTime();
this.contextTop.closePath();this.isCurrentlyDrawing=!1;var h=this.utility.min(this.freeDrawingXPoints);c=this.utility.min(this.freeDrawingYPoints);var m=this.utility.max(this.freeDrawingXPoints);g=this.utility.max(this.freeDrawingYPoints);var n=[],q,u,w,t=this.freeDrawingXPoints,x=this.freeDrawingYPoints,r=this.mdTime;n.push("M ",t[0]-h," ",x[0]-c," ",r[0]," ");for(var s=1;q=t[s],u=x[s],w=r[s];s++)n.push("L ",q-h," ",u-c," ",w," ");n=n.join("");if("M 0 0 L 0 0 "!==n)return q=this.freeDrawingXPoints[this.freeDrawingXPoints.length-
1],u=this.freeDrawingYPoints[this.freeDrawingYPoints.length-1],w=new a.Path(n,this),w.mp={},w.mp.x=q,w.mp.y=u,w.init(n),w=d.readyObject(w),w.coreObj.type="freeDrawing",w=w.coreObj,w.fill=null,w.stroke=this.freeDrawingColor,w.strokeWidth=this.freeDrawingLineWidth,w.minX=h,w.minY=c,this.utility.objAdd(w),d=a.utility.setVal(w,"x",h+(m-h)/2),d=a.utility.setVal(d,"y",c+(g-c)/2),d.setCoords(),"object"==typeof b&&this.contextTop.restore(),a.renderAll(this.contextTop),d},utility:{max:function(a,b){if(a&&
0!==a.length){var c=a.length-1,h=b?a[c][b]:a[c];if(b)for(;c--;)a[c][b]>=h&&(h=a[c][b]);else for(;c--;)a[c]>=h&&(h=a[c]);return h}},min:function(a,b){if(a&&0!==a.length){var c=a.length-1,h=b?a[c][b]:a[c];if(b)for(;c--;)a[c][b]<h&&(h=a[c][b]);else for(;c--;)a[c]<h&&(h=a[c]);return h}},objAdd:function(b){a.main.children.push(b);return this}}}}})(window);(function(c){var a=c.vcan;a.Path=function(b,d){return{objectType:"path",init:function(a,b){b=b||{};this.commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};if(!a)throw Error("`path` argument is required");if(this.path=a.match&&a.match(/[a-zA-Z][^a-zA-Z]*/g))return this.initializeFromArray(b),this},initializeFromArray:function(a){var b="width"in a,d="height"in a;this.path=this._parsePath();b&&d||(this.utility.extend(this,this._parseDimensions()),b&&(this.width=a.width),d&&(this.height=a.height))},
_render:function(a){var b,d=0;b=0;for(var c=-(this.width/2),n=-(this.height/2),q=0,u=this.path.length;q<u;++q)switch(b=this.path[q],b[0]){case "L":d=b[1];b=b[2];a.lineTo(d+c,b+n);break;case "M":d=b[1],b=b[2],a.moveTo(d+c,b+n)}},replay_render:function(a,b,d,c){var n=y=0;switch(b[0]){case "L":n+=b[1];y+=b[2];a.lineTo(n+d,y+c);a.stroke();break;case "M":n+=b[1],y+=b[2],a.moveTo(n+d,y+c)}},render:function(b,d){b.save();var c=this.transformMatrix;c&&b.transform(c[0],c[1],c[2],c[3],c[4],c[5]);d||a.transform(b,
this);this.overlayFill?b.fillStyle=this.overlayFill:this.fill&&(b.fillStyle=this.fill);this.stroke&&(b.strokeStyle=this.stroke);b.beginPath();this._render(b);this.fill&&b.fill();this.stroke&&(b.strokeStyle=this.stroke,b.lineWidth=this.strokeWidth,b.lineCap=b.lineJoin="round",b.stroke());!d&&this.active&&(this.drawBorders(b),this.hideCorners||this.drawCorners(b));b.restore()},_parsePath:function(){for(var a=[],b,d,c,n=0,q,u=this.path.length;n<u;n++){var w=/\d+\s$/.exec(this.path[n]);null!=w&&(b=this.path[n].indexOf(w),
this.path[n]=this.path[n].substring(0,b));b=this.path[n];d=b.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);b=[b.charAt(0)];q=0;for(var t=d.length;q<t;q++)c=parseFloat(d[q]),isNaN(c)||b.push(c);d=b[0].toLowerCase();d=this.commandLengths[d];if(b.length-1>d)for(c=1,q=b.length;c<q;c+=d)null==w?a.push([b[0]].concat(b.slice(c,c+d))):(a.push([b[0]].concat(b.slice(c,c+d))),b.push(w),a.push(b));else null!=w&&b.push(w[0]),a.push(b)}return a},_parseDimensions:function(){var a=[],b=[],c,m,n=!1,
q,u;this.path.forEach(function(d,w){if(" "!=d[3])var r=d.splice(3);"H"!==d[0]&&(c=0===w?this.utility.getX(d):this.utility.getX(this.path[w-1]));"V"!==d[0]&&(m=0===w?this.utility.getY(d):this.utility.getY(this.path[w-1]));d[0]===d[0].toLowerCase()&&(n=!0);q=n?c+this.utility.getX(d):"V"===d[0]?c:this.utility.getX(d);u=n?m+this.utility.getY(d):"H"===d[0]?m:this.utility.getY(d);var s=parseInt(q,10);isNaN(s)||a.push(s);s=parseInt(u,10);isNaN(s)||b.push(s);void 0!=r&&1<=r.length&&d.push(r[0])},this);var w=
d.utility.min(a),w={y:d.utility.min(b)-0,x:w-0,bottom:d.utility.max(b)-0,right:d.utility.max(a)-0};w.width=w.right-w.x;w.height=w.bottom-w.y;return w},utility:{getX:function(a){return"H"===a[0]?a[1]:a[a.length-2]},getY:function(a){return"V"===a[0]?a[1]:a[a.length-1]},extend:function(a,b){for(var d in b)a[d]=b[d];return a}}}}})(window);(function(c){var a=c.vcan;a.mouse=function(){return{init:function(){this.bindHandlers()},bindHandlers:function(){canvasElement=a.main.canvas;var b={mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup"};for(type in b)"mousedown"==type?canvasElement.addEventListener(type,this.mousedown,!1):"mousemove"==type?canvasElement.addEventListener(type,this.mousemove,!1):"mouseup"==type&&canvasElement.addEventListener(type,this.mouseup,!1)},mousedown:function(b,d){b.detail.hasOwnProperty("cevent")&&
"create"!=a.main.action&&(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);lastmousemovetime=null;this.moveChunk=[];if("move"==a.main.action){if(!a.main.currentTransform){var c=a.events().findTarget(b);a.utility.getReltivePoint(b);c?(0<a.main.children.length&&
c.setZindex(),c.downObj=!0,c.setupCurrentTransform(b),a.utility.setActiveObject(c),a.main.currObj=c):a.deactivateAll();void 0!=c&&a.renderAll();b.detail.hasOwnProperty("cevent")||(c=(new Date).getTime(),c=a.makeStackObj(c,"d",b.clientX-a.main.offset.x,b.clientY-a.main.offset.y),virtualclass.wb.uid++,console.log("uid "+virtualclass.wb.uid),c.uid=virtualclass.wb.uid,a.main.replayObjs.push(c),virtualclass.vutil.beforeSend({repObj:[c],cf:"repObj"}))}}else"create"==a.main.action&&(b.detail.hasOwnProperty("cevent")&&
(b.clientX=b.detail.cevent.x+virtualclass.wb.vcan.main.offset.x,b.clientY=b.detail.cevent.y+virtualclass.wb.vcan.main.offset.y,b.x=b.detail.cevent.x+virtualclass.wb.vcan.main.offset.x,b.y=b.detail.cevent.x+virtualclass.wb.vcan.main.offset.y,b.pageX=b.detail.cevent.x+virtualclass.wb.vcan.main.offset.x,b.pageY=b.detail.cevent.y+virtualclass.wb.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y),c=a.events().findTarget(b),a.utility.getReltivePoint(b),c&&"text"==c.type&&"t_text"==
virtualclass.wb.tool.cmd&&c.setupCurrentTransform(b))},mousemove:function(b){b.detail.hasOwnProperty("cevent")&&(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);if("move"==a.main.action){var d=a.main;if(d.currentTransform){var c=a.utility.actualPointer(b),
g=c.x,c=c.y;d.currentTransform.target.isMoving=!0;if("rotate"===d.currentTransform.action)a.interact.rotateObject(g,c),d.currentTransform.target.hasRotatingPoint||a.interact.scaleObject(g,c),b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b);else if("scale"===d.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b),a.interact.scaleObject(g,c);else if("scaleX"===d.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b),a.interact.scaleObject(g,
c,"x");else if("scaleY"===d.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b),a.interact.scaleObject(g,c,"y");else if(d.currentTransform.target.draggable){var h=a.extend({},a.main.currentTransform.target);(new Date).getTime();!0==d.currentTransform.target.downObj&&(a.main.dragMode=!0,d.currentTransform.target.downObj=!1);h=a.interact.translateObject(g,c);b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b);h.setActive(!0);h.setCoords()}if("scaleX"===d.currentTransform.action||
"scaleY"===d.currentTransform.action||"rotate"===d.currentTransform.action&&!d.currentTransform.target.hasRotatingPoint)a.main.scaleMode=!0,(new Date).getTime(),d.currentTransform.target.downObj&&(d.currentTransform.target.downObj=!1),h=a.extend({},a.main.currentTransform.target),h.setCoords();a.renderAll()}else a.events().findTarget(b)}},mouseup:function(b){b.detail.hasOwnProperty("cevent")&&(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+
b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);lastmousemovetime=null;if("move"==a.main.action){a.activMouse.mousemove(b);var d=a.main;if(d.currentTransform){var c=d.currentTransform.target;c.scaling&&(c.scaling=!1);for(c=d.children.length;c--;)d.children[c].setCoords()}d.currentTransform=null;a.renderAll();if(!0==a.main.dragMode||!0==a.main.scaleMode){a.utility.actualPointer(b);
var g=(new Date).getTime();(!b.detail.hasOwnProperty("cevent")||b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast"))&&a.optimize.calculatePackets(g,"u",b.clientX-a.main.offset.x,b.clientY-a.main.offset.y);a.main.dragMode&&(a.main.dragMode=!1);a.main.scaleMode&&(a.main.scaleMode=!1)}else!b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("cevent")&&b.detail.hasOwnProperty("broadCast")&&a.optimize.calculatePackets(g,"u",b.clientX-a.main.offset.x,b.clientY-a.main.offset.y);
a.wb.sentPack=!0}}}}})(window);(function(c){c.readyFreeHandObj=function(a,b){return{init:function(){this.freesvg=!0;this.fdObj={};this.borderColor=a;this.freeDrawingLineWidth=b},drawStart:function(a){var b=virtualclass.wb.vcan;if(!0==virtualclass.wb.obj.freeDrawObj.freesvg){var c=b.main.canvas.getContext("2d");this.fdObj=b.main.freeHandDrawing({borderColor:this.borderColor,lineWidth:this.freeDrawingLineWidth});this.fdObj.init();pointer=b.utility.getReltivePoint(a);this.fdObj.fhdStart(c,pointer)}},wb_draw:function(a){a=vcan.utility.getReltivePoint(a);
this.fdObj.fhRendering(a)},finalizeDraw:function(a){a=virtualclass.wb.vcan;virtualclass.wb.prvObj=this.fdObj.finalizeDrawingPath(virtualclass.wb.canvas);a.main.children[a.main.children.length-1].mt=virtualclass.wb.utility.stringToNumber(virtualclass.wb.prvObj.path[virtualclass.wb.prvObj.path.length-1][3])}}}})(window);(function(c){_replay=function(){return{init:function(a,b){var d=virtualclass.wb.vcan;this.objs="undefined"!=typeof b?d.getStates("replayObjs"):recorder.items;this.objNo=0;this.repMode=a;this.callBkfunc="";this.rendering=!1},makeCustomEvent:function(a,b){var d=a.hasOwnProperty("mtext")?{detail:{cevent:{x:a.x,y:a.y,mtext:a.mtext}}}:{detail:{cevent:{x:a.x,y:a.y}}};"undefined"!=typeof b&&(d.detail.broadCast=!0);d=new CustomEvent(event,d);vcan.main.canvas.dispatchEvent(d)},renderObj:function(a){if("undefined"==
typeof this.objs[this.objNo])console.log(this.objs+"is undefined cannot continue play.");else{this.rendering=virtualclass.wb.drawMode=!0;"undefined"!=typeof a&&(this.callBkfunc=a);if(this.objs[this.objNo].hasOwnProperty("cmd"))virtualclass.wb.gObj.displayedObjId=this.objs[this.objNo].uid,virtualclass.wb.toolInit(this.objs[this.objNo].cmd,"fromFile",!0);else{a="";if("del"==this.objs[this.objNo].ac)""!=vcan.main.currObj&&(virtualclass.wb.utility.removeSelectedItem(vcan.main.currObj,!0,!0),console.log("Whiteboard Delete:-  Performing delete operation:-"));
else{"d"==this.objs[this.objNo].ac?a="mousedown":"m"==this.objs[this.objNo].ac?a="mousemove":"u"==this.objs[this.objNo].ac&&(a="mouseup");var b=this.objs[this.objNo],b=b.hasOwnProperty("mtext")?{detail:{cevent:{x:b.x,y:b.y,mtext:b.mtext}}}:{detail:{cevent:{x:b.x,y:b.y}}};a=new CustomEvent(a,b);vcan.main.canvas.dispatchEvent(a)}virtualclass.wb.gObj.displayedObjId=this.objs[this.objNo].uid}console.log("Whiteboard : Till now play "+virtualclass.wb.gObj.displayedObjId);this.objs[this.objs.length-1].uid==
virtualclass.wb.gObj.displayedObjId&&("function"==typeof this.callBkfunc&&this.callBkfunc("callBkfunc"),this.rendering=!1);roles.hasControls()&&virtualclass.wb.gObj.tempRepObjs[virtualclass.wb.gObj.tempRepObjs.length-1].uid==virtualclass.wb.gObj.displayedObjId&&(vcan.main.replayObjs=virtualclass.wb.gObj.tempRepObjs);if("object"==typeof this.objs[this.objNo+1]){virtualclass.wb.replayTime="undefined"!=typeof this.repMode&&"fromBrowser"==this.repMode?0:0==this.objNo?0:this.objs[this.objNo+1].mt-this.objs[this.objNo].mt;
this.objNo++;var d=this;setTimeout(function(){d.renderObj.call(d)},virtualclass.wb.replayTime)}}}}};c._replay=_replay})(window);(function(c){c.readyTextObj=function(){return{init:function(a){this.currTextObjWrapper=this.prevTextObj="";this.currObject={};this.prvModTextObj={};this.prvCurrTransform={};this.totalBox=this.textWriteMode=0;this.boxContainer=a;this.muser=!1},textUtility:function(a,b,d){this.startPosX=a;this.startPosY=b;var c=virtualclass.wb.vcan,g=c.main.canvas.getContext("2d"),h={};this.textWriteMode++;this.wmode=!0;void 0!=c.main.currentTransform&&""!=c.main.currentTransform?(this.currObject=c.main.currentTransform.target,
void 0!=this.currObject&&"text"==this.currObject.type&&(h={width:300,height:100,x:this.currObject.oCoords.tl.x,y:this.currObject.oCoords.tl.y,text:this.currObject.text},virtualclass.wb.utility.clickOutSidebox(this.textWriteMode)||virtualclass.wb.obj.drawTextObj.drawTextBoxWrapper(h,this.currObject.id),c.main.currentTransform=""),virtualclass.wb.utility.clickOutSidebox(this.textWriteMode)&&virtualclass.wb.obj.drawTextObj.renderText(this.prvCurrTransform,this.prvModTextObj,g),void 0!=this.currObject&&
"text"==this.currObject.type&&(this.prvModTextObj={prvObjId:this.currObject.id,prvText:this.currObject.text,x:this.currObject.x,y:this.currObject.y},this.prvTextObj=this.currObject),this.prvCurrTransform=this.currObject):virtualclass.wb.utility.clickOutSidebox(this.textWriteMode)?"undefined"!=typeof d?virtualclass.wb.obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,g,d):virtualclass.wb.obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,g):(this.totalBox++,h={x:a,y:b,width:300,
height:100},"undefined"==typeof d?virtualclass.wb.obj.drawTextObj.drawTextBoxWrapper(h,this.totalBox):virtualclass.wb.obj.drawTextObj.drawTextBoxWrapper(h,this.totalBox,d))},drawTextBoxWrapper:function(a,b,d){var c=virtualclass.wb.vcan;d=document.createElement("div");d.id="box"+b;d.className="textBoxContainer";d.style.position="absolute";d.style.left=c.main.offset.x+a.x+"px";d.style.top=a.y+"px";b=document.createElement("textarea");b.id=d.id+"textarea";b.className="whiteBoardTextBox";b.rows=8;b.cols=
41;void 0!=a.text&&""!=a.text&&(b.value=a.text);d.appendChild(b);document.getElementById(this.boxContainer).appendChild(d);this.prevTextObj=d;this.currTextObjWrapper=a;this.prevTextObj.measure=a;virtualclass.wb.utility.toolWrapperDisable(!0);roles.hasControls()||(b.style.display="none",roles.hasAdmin()&&virtualclass.wb.utility.toolWrapperEnable(!0));console.log("Text Command:- Create text wrapper box")},renderText:function(a,b,d,c){var g=virtualclass.wb.vcan;if(""!=this.prevTextObj){if(!virtualclass.wb.utility.IsObjEmpty(a))for(var h=
0;h<g.main.children.length;h++)if(a.id==g.main.children[h].id){g.main.children.splice(h,1);this.currObject="";break}virtualclass.wb.utility.IsObjEmpty(a)?"undefined"!=typeof c?this.finalizeText(d,this.prevTextObj,"undefined",c):this.finalizeText(d,this.prevTextObj):"undefined"!=typeof c?this.finalizeText(d,this.prevTextObj,b,c):this.finalizeText(d,this.prevTextObj,b);virtualclass.wb.obj.drawTextObj.wmode=!1}},finalizeText:function(a,b,d,c){d=virtualclass.wb.vcan;var g=document.getElementById(b.id),
h="";if("undefined"==typeof c){c=g.getElementsByTagName("textarea");for(var m=0;m<c.length;m++)if(c[m].id==g.id+"textarea"){h=c[m].value;break}}else h=c;a.font="20px Times New Roman";var n=0,q=h.split(/\r?\n/),n=a.measureText(q[0]).width;c=13;for(m=1;m<q.length;m++){c+=13;var u=a.measureText(q[m]).width;u>n&&(n=u)}n/=2;m=(new Date).getTime();a={type:"text",text:h,x:b.measure.x+n,y:b.measure.y+c,fontSize:20,fontWidth:a.measureText(h).width,mp:{x:b.measure.x,y:b.measure.y}};!1==virtualclass.wb.obj.drawTextObj.muser&&
(h={mt:m,ac:"d",x:this.startPosX,y:this.startPosY,mtext:a.text},virtualclass.wb.uid++,h.uid=virtualclass.wb.uid,d.main.replayObjs.push(h),virtualclass.storage.store(JSON.stringify(d.main.replayObjs)),virtualclass.vutil.beforeSend({repObj:[h],cf:"repObj"}));a=virtualclass.wb.canvas.readyObject(a);virtualclass.wb.canvas.addObject(a);d.main.children[d.main.children.length-1].mt=m;g.parentNode.removeChild(b);d.renderAll();virtualclass.wb.utility.toolWrapperEnable(!0)},finalizeTextIfAny:function(a){var b=
document.getElementById("canvasWrapper");null!=b&&null!=b.getElementsByClassName("whiteBoardTextBox")&&("undefined"==typeof a||"undefined"!=typeof a&&0!=virtualclass.wb.obj.drawTextObj.textWriteMode%2)&&virtualclass.wb.obj.drawTextObj.textUtility()}}}})(window);(function(c){c.keyBoard={prvTool:"",skey:!1,triggerActiveAll:function(a){a.shiftKey&&(virtualclass.wb.keyBoard.skey=!0,virtualclass.wb.keyBoard.prvTool=virtualclass.wb.tool.cmd,virtualclass.wb.toolInit("t_activeall"),a={cmd:"t_activeall",mt:(new Date).getTime()},vcan.main.replayObjs.push(a),virtualclass.vutil.beforeSend({repObj:[a],cf:"repObj"}),virtualclass.wb.vcan.main.action="move")},triggerdeActiveAll:function(a){virtualclass.wb.keyBoard.skey&&(a=(new Date).getTime(),virtualclass.wb.utility.deActiveFrmDragDrop(),
virtualclass.wb.toolInit(virtualclass.wb.keyBoard.prvTool),a={cmd:virtualclass.wb.keyBoard.prvTool,mt:a},vcan.main.replayObjs.push(a),virtualclass.vutil.beforeSend({repObj:[a],cf:"repObj"}))}}})(window);(function(c){c.adapter=function(){return{RTCPeerConnection:null,webrtcDetectedBrowser:null,init:function(a){virtualclass.system.getusermedia&&(a.mozGetUserMedia?(c.webrtcDetectedBrowser="firefox",this.RTCPeerConnection=mozRTCPeerConnection,this.RTCSessionDescription=mozRTCSessionDescription,this.RTCIceCandidate=mozRTCIceCandidate,a.getUserMedia=a.mozGetUserMedia,this.attachMediaStream=function(a,d){this.videoAdd=!0;var f=c.URL||c.webkitURL;a.src=f?f.createObjectURL(d):d;a.play()},reattachMediaStream=
function(a,d){console.log("Reattaching media stream");a.mozSrcObject=d.mozSrcObject;a.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]}):a.webkitGetUserMedia?(console.log("This appears to be Chrome"),c.webrtcDetectedBrowser="chrome",this.RTCPeerConnection=webkitRTCPeerConnection,this.RTCSessionDescription=RTCSessionDescription,this.RTCIceCandidate=RTCIceCandidate,a.getUserMedia=a.webkitGetUserMedia,this.attachMediaStream=function(a,
d){var f=c.URL||c.webkitURL;a.src=f?f.createObjectURL(d):d;a.play();this.videoAdd=!0},reattachMediaStream=function(a,d){a.src=d.src},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=
function(){return this.remoteStreams})):console.log("Browser does not appear to be WebRTC-capable"));return a}}}})(window);function Resampler(c,a,b,d,f){this.fromSampleRate=c;this.toSampleRate=a;this.channels=b|0;this.outputBufferSize=d;this.noReturn=!!f;this.initialize()}
Resampler.prototype.initialize=function(){if(0<this.fromSampleRate&&0<this.toSampleRate&&0<this.channels)this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1):(this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.initializeBuffers());else throw Error("Invalid settings specified for the resampler.");
};
Resampler.prototype.compileLinearInterpolationFunction=function(){for(var c="var bufferLength = buffer.length;\tvar outLength = this.outputBufferSize;\tif ((bufferLength % "+this.channels+") == 0) {\t\tif (bufferLength > 0) {\t\t\tvar ratioWeight = this.ratioWeight;\t\t\tvar weight = this.lastWeight;\t\t\tvar firstWeight = 0;\t\t\tvar secondWeight = 0;\t\t\tvar sourceOffset = 0;\t\t\tvar outputOffset = 0;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tfor (; weight < 1; weight += ratioWeight) {\t\t\t\tsecondWeight = weight % 1;\t\t\t\tfirstWeight = 1 - secondWeight;",a=
0;a<this.channels;++a)c+="outputBuffer[outputOffset++] = (this.lastOutput["+a+"] * firstWeight) + (buffer["+a+"] * secondWeight);";c+="}\t\t\tweight -= 1;\t\t\tfor (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; outputOffset < outLength && sourceOffset < bufferLength;) {\t\t\t\tsecondWeight = weight % 1;\t\t\t\tfirstWeight = 1 - secondWeight;";for(a=0;a<this.channels;++a)c+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(0<a?" + "+a:"")+"] * firstWeight) + (buffer[sourceOffset + "+
(this.channels+a)+"] * secondWeight);";c+="weight += ratioWeight;\t\t\t\tsourceOffset = Math.floor(weight) * "+this.channels+";\t\t\t}";for(a=0;a<this.channels;++a)c+="this.lastOutput["+a+"] = buffer[sourceOffset++];";this.resampler=Function("buffer",c+'this.lastWeight = weight % 1;\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.compileMultiTapFunction=function(){for(var c="var bufferLength = buffer.length;\tvar outLength = this.outputBufferSize;\tif ((bufferLength % "+this.channels+") == 0) {\t\tif (bufferLength > 0) {\t\t\tvar ratioWeight = this.ratioWeight;\t\t\tvar weight = 0;",a=0;a<this.channels;++a)c+="var output"+a+" = 0;";c+="var actualPosition = 0;\t\t\tvar amountToNext = 0;\t\t\tvar alreadyProcessedTail = !this.tailExists;\t\t\tthis.tailExists = false;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tvar outputOffset = 0;\t\t\tvar currentPosition = 0;\t\t\tdo {\t\t\t\tif (alreadyProcessedTail) {\t\t\t\t\tweight = ratioWeight;";
for(a=0;a<this.channels;++a)c+="output"+a+" = 0;";c+="}\t\t\t\telse {\t\t\t\t\tweight = this.lastWeight;";for(a=0;a<this.channels;++a)c+="output"+a+" = this.lastOutput["+a+"];";c+="alreadyProcessedTail = true;\t\t\t\t}\t\t\t\twhile (weight > 0 && actualPosition < bufferLength) {\t\t\t\t\tamountToNext = 1 + actualPosition - currentPosition;\t\t\t\t\tif (weight >= amountToNext) {";for(a=0;a<this.channels;++a)c+="output"+a+" += buffer[actualPosition++] * amountToNext;";c+="currentPosition = actualPosition;\t\t\t\t\t\tweight -= amountToNext;\t\t\t\t\t}\t\t\t\t\telse {";
for(a=0;a<this.channels;++a)c+="output"+a+" += buffer[actualPosition"+(0<a?" + "+a:"")+"] * weight;";c+="currentPosition += weight;\t\t\t\t\t\tweight = 0;\t\t\t\t\t\tbreak;\t\t\t\t\t}\t\t\t\t}\t\t\t\tif (weight == 0) {";for(a=0;a<this.channels;++a)c+="outputBuffer[outputOffset++] = output"+a+" / ratioWeight;";c+="}\t\t\t\telse {\t\t\t\t\tthis.lastWeight = weight;";for(a=0;a<this.channels;++a)c+="this.lastOutput["+a+"] = output"+a+";";this.resampler=Function("buffer",c+'this.tailExists = true;\t\t\t\t\tbreak;\t\t\t\t}\t\t\t} while (actualPosition < bufferLength && outputOffset < outLength);\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.bypassResampler=function(c){return this.noReturn?(this.outputBuffer=c,c.length):c};Resampler.prototype.bufferSlice=function(c){if(this.noReturn)return c;try{return this.outputBuffer.subarray(0,c)}catch(a){try{return this.outputBuffer.length=c,this.outputBuffer}catch(b){return this.outputBuffer.slice(0,c)}}};
Resampler.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch(c){this.outputBuffer=[],this.lastOutput=[]}};(function(c){repMode=!1;var a=0,b=0,d=0,f=0,g=65535,h=0;c.media=function(){return{isChannelReady:"",isInitiator:!1,isStarted:"",localStream:"",pc:[],cn:0,ba:!1,bb:!1,bc:!1,bNotRender:!1,remoteStream:"",turnReady:"",oneExecuted:!1,videoControlId:"videoContainer",videoContainerId:"videos",util:{imageReplaceWithVideo:function(a,b){var d=document.getElementById("ml"+a);virtualclass.vutil.elemHasAnyClass("ml"+a)&&d.classList.remove("userImg");var d=d.getElementsByTagName("a")[0],c=d.getElementsByTagName("img")[0];
d.className+=" hasVideo";d.replaceChild(b,c)}},audio:{audioStreamArr:[],tempAudioStreamArr:[],recordingLength:0,bufferSize:0,encMode:"alaw",recordAudio:!1,resampler:new Resampler(44100,8E3,1,4096),rec:"",otherSound:!1,audioNodes:[],sdElem:"silenceDetect",Html5Audio:{audioContext:new (c.AudioContext||c.webkitAudioContext)},init:function(){var a=document.getElementById("speakerPressOnce").dataset.audioPlaying;virtualclass.gObj.audMouseDown="true"==a?!0:!1;this.graph={height:56,width:4,average:0,display:function(){var a=
cthis.video;roles.hasControls()&&this._display(a.tempVidCont,this.height-this.height*this.average/100)},_display:function(a,b){a.beginPath();a.moveTo(this.width,this.height);a.lineTo(this.width,b);a.lineWidth=this.width;a.strokeStyle="rgba(32, 37, 247, 0.8)";a.closePath();a.stroke()},canvasForVideo:function(){var a=cthis.video.myVideo.parentNode,b=document.createElement("canvas");b.width=this.width+3;b.height=this.height;b.id="graphCanvas";a.style.position="relative";b.style.position="absolute";b.style.left=
0;b.style.top=-7;a.appendChild(b)}};this.attachFunctionsToAudioWidget()},audioSend:function(a,b){if(virtualclass.gObj.audMouseDown&&1==io.sock.readyState){var d=virtualclass.vutil.breakintobytes(virtualclass.gObj.uid,8),d=new Int8Array([101,d[0],d[1],d[2],d[3]]),c=new Int8Array(a.length+d.length);c.set(d);c.set(a,d.length);ioAdapter.sendBinary(c);virtualclass.gObj.video.audio.setAudioStatus(b)}else virtualclass.gObj.video.audio.setAudioStatus("stop")},slienceDetection:function(c,n){var q=0,u=0,w=
0;for(i=0;i<n.length;i++)w=Math.abs(n[i]),q<w&&(q=w),u+=w;f=u/n.length;w=Math.abs(f^2-d^2);d=f;5>w&&(g=q);g>q&&(g=q);h<q&&(h=q);50*g<h&&(g*=5);h/50>g&&(h=q);u=h/g;switch(!0){case 8<u:w=2.5;break;case 5<u:w=2;break;case 3<u:w=1.2;break;default:w=1}2<=u&&q>=g*w?(0==a&&0!=b&&(this.audioSend(b),b=0),this.audioSend(c,"sending"),a=9):0<a?(this.audioSend(c,"sending"),a--):2>u?this.audioSend(c,"sending"):(this.setAudioStatus("notSending"),10<u&&(h*=.8),b=c);return c},setAudioStatus:function(a){if("undefined"==
typeof b)var b=document.getElementById("audioWidget").getElementsByClassName(this.sdElem)[0];b.setAttribute("data-silence-detect",a)},makeIconNotDraggable:function(a,b){var d=document.getElementById(a,b).getContext("2d"),f=new Image;f.onload=function(){d.drawImage(f,0,0)};f.src=c.whiteboardPath+"images/"+b},attachFunctionsToAudioWidget:function(){for(var a=document.getElementById("audioWidget").getElementsByClassName("audioTool"),b=0;b<a.length;b++)"speakerPressOnce"!=a[b].id&&"speakerPressing"==
a[b].id&&this.attachSpeakToStudent(a[b].id),"speakerPressing"!=a[b].id&&a[b].addEventListener("click",this.audioToolInit)},audioToolInit:function(){var a=virtualclass.gObj.video.audio;if("speakerPressOnce"==this.id)a.clickOnceSpeaker(this.id);else if("audioTest"==this.id){var b=this;virtualclass.popup.confirmInput(virtualclass.lang.getString("audioTest"),function(d){d&&a.testInit(b.id)})}else"silenceDetect"==this.id&&(this.getElementsByTagName("a"),a.sd?(a.sd=!1,this.className+=" sdDisable"):(a.sd=
!0,this.className+=" sdEnable"))},attachSpeakToStudent:function(a){var b=this,d=document.getElementById(a),c=!1;d.addEventListener("mousedown",function(){if(!virtualclass.gObj.audMouseDown){b.studentSpeak(d);c=!0;var a=document.getElementById("speakerPressonceLabel");null!=a&&virtualclass.vutil.elemHasAnyClass("speakerPressonceLabel")&&a.classList.contains("silenceDetect")&&(a.removeAttribute("data-silence-detect"),a.classList.remove("silenceDetect"),0>=a.classList.length&&a.removeAttribute("class"),
a=a.getElementsByTagName("i")[0],null!=a&&(a.setAttribute("data-silence-detect","stop"),a.className+=" silenceDetect"))}});d.addEventListener("mouseup",function(){if(c){b.studentNotSpeak(d);c=!1;var a=document.getElementById("speakerPressonceLabel"),f=a.getElementsByTagName("i")[0];"undefined"!=typeof f.classList&&f.classList.contains("silenceDetect")&&(f.classList.remove("silenceDetect"),0>=f.classList.length&&f.removeAttribute("class"),a.removeAttribute("data-silence-detect"));null!==a&&(a.setAttribute("data-silence-detect",
"stop"),a.className=f.className+" silenceDetect")}})},attachAudioPressOnce:function(){var a=document.getElementById("speakerPressOnce");a.setAttribute("data-audio-playing","false");var b=this;a.addEventListener("click",function(){b.clickOnceSpeaker.call(b,a.id)})},clickOnceSpeaker:function(a,b){var d=document.getElementById(a),c=document.getElementById("speakerPressing"),f=d.getElementsByClassName("tooltip")[0];"false"==d.getAttribute("data-audio-playing")&&"undefined"==typeof b?(this.studentSpeak(c),
d.setAttribute("data-audio-playing","true"),f.setAttribute("data-title",virtualclass.lang.getString("disableSpeaker")),d.className="audioTool active"):(this.studentNotSpeak(c),d.setAttribute("data-audio-playing","false"),f.setAttribute("data-title",virtualclass.lang.getString("enableSpeaker")),d.className="audioTool deactive")},studentSpeak:function(a){"undefined"!=typeof a&&(document.getElementById(a.id+"Button"),a.classList.remove("deactive"),a.classList.add("active"));virtualclass.gObj.audMouseDown=
!0;virtualclass.vutil.beforeSend({sad:!0,cf:"sad"})},studentNotSpeak:function(a){virtualclass.gObj.hasOwnProperty("audMouseDown")&&virtualclass.gObj.audMouseDown&&("undefined"!=typeof a&&(document.getElementById(a.id+"Button"),a.classList.remove("active"),a.classList.add("deactive")),a=document.getElementById("speakerPressOnce"),a.setAttribute("data-audio-playing","false"),a.className="audioTool deactive",virtualclass.gObj.audMouseDown=!1,virtualclass.gObj.video.audio.setAudioStatus("stop"),virtualclass.vutil.beforeSend({sad:!1,
cf:"sad"},null,!0))},ab2str:function(a){return String.fromCharCode.apply(null,new Int8Array(a))},str2ab:function(a){for(var b=new ArrayBuffer(a.length),b=new Int8Array(b),d=0,c=a.length;d<c;d++)b[d]=a.charCodeAt(d);return b},recorderProcess:function(a){(new Date).getTime();if(!repMode){a=a.inputBuffer.getChannelData(0);a=this.resampler.resampler(a);this.recordAudio||(this.recordingLength+=this.bufferSize);l=a.length;for(buf=new Int16Array(l);l--;)buf[l]=32767*Math.min(1,a[l]);a=buf;var b=this.audioInLocalStorage(a);
this.hasOwnProperty("storeAudio")&&this.storeAudio&&this.audioForTesting(a);virtualclass.gObj.audMouseDown&&1==io.sock.readyState&&this.slienceDetection(b,a)}},audioInLocalStorage:function(a){return G711.encode(a,{alaw:"alaw"==this.encMode?!0:!1})},testInit:function(a){var b=document.getElementById(a);b.classList.add("audioIsTesting");this.studentNotSpeak();virtualclass.gObj.audioForTest=[];this.storeAudio=!0;var d=this;d.otherSound=!0;d.hasOwnProperty("testAudio")&&clearTimeout(d.testAudio);d.testAudio=
setTimeout(function(){d.playRecordedAudio(virtualclass.gObj.audioForTest,virtualclass.gObj.uid,!0)},5E3);setTimeout(function(){console.log("testing");b.classList.remove("audioIsTesting");d.otherSound=!1},11E3)},audioForTesting:function(a){a=G711.encode(a,{alaw:"alaw"==this.encMode?!0:!1});virtualclass.gObj.audioForTest.push(a);virtualclass.gObj[virtualclass.gObj.uid]=!1},playRecordedAudio:function(a,b,d){var c;this.myaudioNodes=[];for(var f=0,g=0;g<a.length;g++)c=a[g],c=G711.decode(c,{alaw:"alaw"==
this.encMode?!0:!1,floating_point:!0,Eight:!0}),this.myaudioNodes.push(new Float32Array(c)),f+=c.length;c=this.mergeBuffers(this.myaudioNodes,f);"undefined"!=typeof d?virtualclass.gObj.video.audio.play(c,b,d):virtualclass.gObj.video.audio.play(c,b)},play:function(a,b,d){var c=JSON.parse(localStorage.getItem("virtualclass"+b));"undefined"==typeof receivedResampler&&(receivedResampler=new Resampler(8E3,44100,1,16384E3));a=receivedResampler.resampler(a);var f=this.Html5Audio.audioContext.createBuffer(1,
a.length,44100);f.getChannelData(0).set(a);a=this.Html5Audio.audioContext.createBufferSource();a.buffer=f;f=this.Html5Audio.audioContext.createGain();f.gain.value=.9;a.connect(f);f.connect(this.Html5Audio.audioContext.destination);null!=c&&c.ad&&c.aud&&(virtualclass.user.control.iconAttrManupulate(b,"icon-audioEnaGreen"),f=document.getElementById(c.id+"contrAudAnch"),null!=f&&f.setAttribute("data-title",virtualclass.lang.getString("audioOn")));a.onended=function(){c=JSON.parse(localStorage.getItem("virtualclass"+
b));"undefined"==typeof d&&(clearTimeout(virtualclass.gObj[b].out),virtualclass.gObj[b].isplaying=!1,0<virtualclass.gObj.video.audio.audioToBePlay[b].length?virtualclass.gObj.video.audio.getChunks(b):null!=c&&c.ad&&c.aud&&virtualclass.user.control.iconAttrManupulate(b,"icon-audioEnaOrange"))};a.start(1);virtualclass.gObj[b].isplaying=!0;"undefined"==typeof d&&(virtualclass.gObj[b].out=setTimeout(function(){virtualclass.gObj[b].isplaying=!1;0<virtualclass.gObj.video.audio.audioToBePlay[b].length&&
virtualclass.gObj.video.audio.getChunks(b)},1E3*a.buffer.duration+10))},calcAverage:function(){var a=new Uint8Array(analyser.frequencyBinCount);analyser.getByteFrequencyData(a);for(var b=0,d=a.length,c=0;c<d;c++)b+=a[c];this.graph.average=b/d},audioInGraph:function(){var a=cthis.video;if(roles.hasControls()){var b=this.graph.height-this.graph.height*this.graph.average/100;a.tempVidCont.beginPath();a.tempVidCont.moveTo(a.tempVid.width-this.graph.width,this.graph.height);a.tempVidCont.lineTo(a.tempVid.width-
this.graph.width,b);a.tempVidCont.lineWidth=this.graph.width;a.tempVidCont.strokeStyle="rgba(247, 25, 77, 1)";a.tempVidCont.closePath();a.tempVidCont.stroke()}},queue:function(a,b){this.hasOwnProperty("audioToBePlay")||(this.audioToBePlay={});this.audioToBePlay.hasOwnProperty(b)||(this.audioToBePlay[b]=[]);this.audioToBePlay[b].push(a)},getChunks:function(a,b){8<this.audioToBePlay[a].length?(this.audioToBePlay[a].length=0,virtualclass.gObj[a].isplaying=!1):0<this.audioToBePlay[a].length?(this.playRecordedAudio(this.audioToBePlay[a],
a),this.audioToBePlay[a].length=0):virtualclass.gObj[a].isplaying=!1},replay:function(a,b){repMode=!0;var d,c,f;0<this.audioNodes.length&&(d=this.mergeBuffers(this.audioNodes),c=this.Html5Audio.audioContext.currentTime+a,f=this.Html5Audio.audioContext.createBuffer(1,d.length,7800),f.getChannelData(0).set(d),d=this.Html5Audio.audioContext.createBufferSource(),d.buffer=f,d.connect(this.Html5Audio.audioContext.destination),d.start(c,b))},mergeBuffers:function(a,b){for(var d=new Float32Array(b),c=0,f=
a.length,g=0;g<f;g++){var h=a[g];d.set(h,c);c+=h.length}return d},assignFromLocal:function(a,b){this.init();for(var d=0;d<a.length;d++){var c=LZString.decompressFromBase64(a[d]),c=this.str2ab(c);samples=G711.decode(c,{alaw:"alaw"==this.encMode?!0:!1,floating_point:!0,Eight:!0});this.audioNodes.push(new Float32Array(samples));this.recordingLength+=16384}"undefined"!=typeof b&&b()},manuPulateStream:function(){var a=cthis.audio.Html5Audio.audioContext.createMediaStreamSource(cthis.stream);cthis.audio.bufferSize=
16384;grec=cthis.audio.Html5Audio.audioContext.createScriptProcessor(cthis.audio.bufferSize,1,1);grec.onaudioprocess=cthis.audio.recorderProcess.bind(cthis.audio);var b=cthis.audio.Html5Audio.audioContext.createGain();b.gain.value=.9;a.connect(b);b.connect(grec);grec.connect(cthis.audio.Html5Audio.audioContext.destination)},updateInfo:function(){this.audioStreamArr=[];repMode=this.recordAudio=!1},receivedAudioProcess:function(a){if(!virtualclass.gObj.hasOwnProperty("iosIpadbAudTrue")||!1!=virtualclass.gObj.iosIpadbAudTrue){a=
this.extractData(a);var b=a[0];if("undefined"==typeof d)var d={};d.hasOwnProperty(b)||(d[b]={},d[b].ad=!0,d=virtualclass.user.control.updateUser(b,"ad",!0),virtualclass.user.control.audioSign(d,"create"));virtualclass.gObj.video.audio.queue(a[1],b);virtualclass.gObj.hasOwnProperty(b)&&virtualclass.gObj[b].hasOwnProperty("isplaying")?!1==virtualclass.gObj[b].isplaying&&virtualclass.gObj.video.audio.getChunks(b):(virtualclass.gObj[b]={},virtualclass.gObj[b].isplaying=!0,virtualclass.gObj.video.audio.getChunks(b))}},
extractData:function(a){a=new Int8Array(a);return[virtualclass.vutil.numValidateFour(a[1],a[2],a[3],a[4]),a.subarray(5,a.length)]}},video:{width:75,height:56,tempVid:"",tempVidCont:"",myVideo:"",remoteVid:"",remoteVidCont:"",maxHeight:250,init:function(){this.videoCont=document.getElementById("allVideosCont");null!=this.videoCont&&(this.videoCont.style.maxHeight=this.maxHeight+"px")},calcDimension:function(){this.myVideo.width=this.width;this.myVideo.height=this.height},removeUser:function(a){a=document.getElementById("user"+
a);null!=a&&a.parentNode.removeChild(a)},createElement:function(a){var b=document.createElement("div");b.className="videoWrapper";var d=document.createElement("div");d.className="videoSubWrapper";d.id="user"+a.id;b.appendChild(d);vidId=a.id;var c=document.createElement("canvas");c.id="video"+vidId;c.className="userVideos";c.width=this.width;c.height=this.height;d.appendChild(c);virtualclass.gObj.video.util.imageReplaceWithVideo(a.id,b)},updateHightInSideBar:function(a){var b=document.getElementById("widgetRightSide").offsetHeight;
document.getElementById("chatContainer").style.height=b-a+"px"},send:function(){function a(){function g(){try{d.tempVidCont.drawImage(d.myVideo,0,0,d.width,d.height)}catch(a){if("NS_ERROR_NOT_AVAILABLE"==a.name)setTimeout(g,100);else throw a;}}if(roles.hasControls()){if("undefined"==typeof h){var h=document.getElementById("graphCanvas");null!=h&&(cthis.audio.graph.cvCont=h.getContext("2d"))}null!=h&&cthis.audio.graph.cvCont.clearRect(0,0,h.width,h.height)}d.tempVidCont.clearRect(0,0,d.tempVid.width,
d.tempVid.height);c.navigator.userAgent.match("Firefox")?g():d.tempVidCont.drawImage(d.myVideo,0,0,d.width,d.height);roles.hasControls()&&cthis.audio.graph.display();h={name:virtualclass.gObj.uName,id:virtualclass.gObj.uid};roles.hasControls()&&(h.role=virtualclass.gObj.uRole);virtualclass.vutil.beforeSend({videoByImage:h,cf:"videoByImage"},null,!0);var h=d.tempVidCont.getImageData(0,0,d.tempVid.width,d.tempVid.height),h=virtualclass.dirtyCorner.encodeRGB(h.data),x=b(virtualclass.gObj.uid,8),x=new Uint8ClampedArray([11,
x[0],x[1],x[2],x[3]]),r=new Uint8ClampedArray(h.length+x.length);r.set(x);r.set(h,x.length);ioAdapter.sendBinary(r);clearInterval(virtualclass.gObj.video.smallVid);h=2E3+2500*virtualclass.gObj.totalUser.length;f!=virtualclass.gObj.totalUser?(f=virtualclass.gObj.totalUser.length,x=virtualclass.gObj.totalUser.indexOf(virtualclass.gObj.uId),virtualclass.gObj.video.smallVid=setInterval(a,h+h/f*x)):virtualclass.gObj.video.smallVid=setInterval(a,h)}function b(a,d){for(var c=a.toString(),f=c.length;f<d;f++)c=
"0"+c;return c.match(/[\S]{1,2}/g)||[]}virtualclass.gObj.video.hasOwnProperty("smallVid")&&clearInterval(virtualclass.gObj.video.smallVid);var d=this;randomTime=Math.floor(10001*Math.random())+5E3;var f=-1;virtualclass.gObj.video.smallVid=setInterval(a,300)},startToStream:function(){cthis.video.calcDimension();cthis.video.send()},playWithoutSlice:function(a,b){this.remoteVid=document.getElementById("video"+a);if(null!=this.remoteVid){this.remoteVidCont=this.remoteVid.getContext("2d");var d=virtualclass.dirtyCorner.decodeRGB(b,
this.remoteVidCont,this.remoteVid);this.remoteVidCont.putImageData(d,0,0)}},justForDemo:function(){var a=0,b=document.getElementById("allVideosCont");b.style.maxHeight="250px";setInterval(function(){if(20>=++a){b=document.getElementById("allVideosCont");var d=document.createElement("div");d.className="videoWrapper";var c=document.createElement("div");c.className="videoSubWrapper";c.setAttribute("data-uname","suman"+a);d.appendChild(c);var f=document.createElement("video");f.className="userVideo";
f.src="http://html5demos.com/assets/dizzy.mp4";c.appendChild(f);b.appendChild(d);250<=b.offsetHeight&&"undefined"!=b.style.overflowY&&"scroll"!=b.style.overflowY&&(b.style.overflowY="scroll",document.getElementById(virtualclass.gObj.chat.mainChatBoxId).style.borderTop="3px solid #bbb")}},200)},createVideoElement:function(){var a=document.createElement("div");a.className="videoWrapper";var b=document.createElement("div");b.className="videoSubWrapper";a.appendChild(b);var d=document.createElement("video");
d.id="video"+virtualclass.gObj.uid;d.autoplay=!0;b.appendChild(d);return a},insertTempVideo:function(a){var b=document.createElement("canvas");b.id="tempVideo";a.parentNode.insertBefore(b,a)},tempVideoInit:function(){cthis.video.tempVid=document.getElementById("tempVideo");cthis.video.tempVid.width=cthis.video.width;cthis.video.tempVid.height=cthis.video.height;cthis.video.tempVidCont=cthis.video.tempVid.getContext("2d")},process:function(a){var b=new Uint8ClampedArray(a);a=virtualclass.vutil.numValidateFour(b[1],
b[2],b[3],b[4]);b=b.subarray(5,b.length);virtualclass.gObj.video.video.playWithoutSlice(a,b)}},init:function(a){cthis=this;vcan.oneExecuted=!0;a={audio:!0,video:!0};cthis.video.init();virtualclass.vutil.isPlayMode()||(virtualclass.adpt=new virtualclass.adapter,virtualclass.adpt.init(navigator).getUserMedia(a,this.handleUserMedia,this.handleUserMediaError));virtualclass.system.wbRtc.peerCon&&"undefined"==typeof localStorage.wbrtcMsg&&(virtualclass.view.multiMediaMsg("WebRtc"),localStorage.wbrtcMsg=
!0)},handleUserMedia:function(a){localStorage.removeItem("dvid");var b=document.getElementById("audioWidget"),d=localStorage.getItem("audEnable");null!=d?(d=JSON.parse(d),"false"==d.ac?"vd"==d.r?virtualclass.user.control.audioWidgetEnable():virtualclass.user.control.audioWidgetDisable():virtualclass.user.control.audioWidgetEnable()):virtualclass.vutil.elemHasAnyClass("audioWidget")&&b.classList.contains("deactive")&&virtualclass.user.control.audioWidgetEnable();cthis.video.tempStream=a;cthis.audio.init();
a=document.getElementById("ml"+virtualclass.gObj.uid);null!=a&&null!=a.getElementsByTagName("video")&&cthis._handleUserMedia(virtualclass.gObj.uid)},addUserRole:function(a,b){var d=document.getElementById("ml"+a);d.setAttribute("data-role",b);var c="s"==b?"student":"teacher";d.classList.add(c);"t"==virtualclass.gObj.uRole&&"student"==c&&(document.getElementById("virtualclassCont").classList.remove("student"),console.log("By removing this can be the pr"))},_handleUserMedia:function(a){document.getElementById(a);
var b=cthis.video.tempStream;"undefined"!=typeof b&&(a=cthis.video.createVideoElement(),virtualclass.gObj.video.util.imageReplaceWithVideo(virtualclass.gObj.uid,a),cthis.video.insertTempVideo(a),cthis.video.tempVideoInit(),cthis.video.myVideo=document.getElementById("video"+virtualclass.gObj.uid),virtualclass.adpt.attachMediaStream(cthis.video.myVideo,b),cthis.video.myVideo.muted=!0,b.ontimeupdate=function(){console.log("raja"+b.currentTime)},virtualclass.jId==virtualclass.gObj.uid&&(cthis.stream=
cthis.video.tempStream,cthis.audio.manuPulateStream(),cthis.audio.graph.canvasForVideo()),cthis.video.myVideo.onloadedmetadata=function(){cthis.video.startToStream()});userMedia=!0},updateVidContHeight:function(){var a=document.getElementById("virtualclassCont"),a=vcan.utility.getElementOffset(a),a=c.innerHeight-(a.y+75);document.getElementById("chat_div").style.maxHeight=a+"px"},close:function(){virtualclass.gObj.video.hasOwnProperty("smallVid")&&clearInterval(virtualclass.gObj.video.smallVid)},
dispAllVideo:function(a){setTimeout(function(){var b=document.getElementById(a);if(null!=b)for(var b=b.getElementsByTagName("video"),d=0;d<b.length;d++)b[d].play()},1040)},existVideoContainer:function(a){for(var b=document.getElementsByClassName("userVideos"),d=0;d<b.length;d++)if(b[d].id=="video"+a.id)return!0;return!1},handleUserMediaError:function(a){a="object"==typeof a?virtualclass.lang.getString(a.name):virtualclass.lang.getString(a);virtualclass.view.createErrorMsg(a,"errorContainer","chatWidget");
virtualclass.user.control.audioWidgetDisable("vd");virtualclass.view.disappearBox("WebRtc");localStorage.setItem("dvid",!0);console.log("navigator.getUserMedia error: ",a)}}}})(window);(function(c){io=c.io;c.addEventListener("message",function(a){if("SharePresentation"==virtualclass.currApp){var b=document.getElementById("pptiframe"),d=a.data,d="string"==typeof d?JSON.parse(a.data):a.data;d.hasOwnProperty("namespace")&&"reveal"==d.namespace&&(virtualclass.sharePt.state=d.state);"ready"==d.eventName&&(virtualclass.sharePt.localStoragFlag&&!virtualclass.sharePt.startFromFlag?(a=virtualclass.sharePt.stateLocalStorage,b.contentWindow.postMessage(JSON.stringify({method:"slide",args:[a.indexh,
a.indexv,a.indexf]}),"*"),virtualclass.sharePt.localStoragFlag=0):virtualclass.sharePt.startFromFlag&&b.contentWindow.postMessage(JSON.stringify({method:"slide",args:virtualclass.sharePt.startFrom}),"*"),setTimeout(function(){null!=b&&null!=b.contentWindow&&b.contentWindow.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*")},1500));roles.hasView()?"ready"==d.eventName&&(setTimeout(function(){virtualclass.sharePt.removeControls()},100),virtualclass.sharePt.studentPpt&&(virtualclass.sharePt.setSlideState(virtualclass.sharePt.studentPpt),
virtualclass.sharePt.studentPpt=0)):roles.hasControls()&&(console.log(d.eventName),"undefined"!=typeof d.eventName&&(virtualclass.sharePt[d.eventName].call(virtualclass.sharePt,d),virtualclass.sharePt.state=d.state))}else null!=b&&b.removeAttribute("src")});c.sharePt=function(){return{pptUrl:"",state:{},urlValue:"",localStoragFlag:!1,eventsObj:[],autoSlideTime:0,viewFlag:0,controlFlag:0,autoSlideFlag:0,autoSlideResumed:0,studentPpt:0,startFromFlag:0,startFrom:0,init:function(a,b){this.autoSlideResumed=
this.autoSlideTime=this.autoSlideFlag=0;"undefined"!=typeof virtualclass.previous&&"undefined"!=typeof b&&"byclick"==b&&roles.hasControls()&&virtualclass.vutil.beforeSend({ppt:!0,init:"makeAppReady",cf:"ppt"});var d=document.getElementById("virtualclassSharePresentation");null!=d&&d.parentNode.removeChild(d);this.UI.container();d=document.getElementById("pptMessageLayout");if(roles.hasControls()){this.UI.createUrlContainer();var c=document.getElementById("urlcontainer");null!=d&&(d.style.display=
"none");c.style.display="block";virtualclass.sharePt.attachEvent("submitpurl","click",virtualclass.sharePt.initNewPpt)}else roles.hasView()&&(c=document.getElementById("urlcontainer"),this.UI.messageDisplay(),null!=d&&(d.style.display="block"),null!=c&&(c.style.display="none"));this.findInStorage()},findInStorage:function(){var a=localStorage.getItem("prevApp");console.log("test pApp"+typeof a);console.log(a);null!=a&&(a=JSON.parse(a),"SharePresentation"==a.name&&(a=a.metaData,null!=a&&a.init&&(this.localStoragFlag=
!0,this.pptUrl=JSON.parse(localStorage.getItem("pptUrl")),null!=a.startFrom&&(virtualclass.sharePt.stateLocalStorage=a.startFrom)),this.localStoragFlag&&this.fromLocalStorage(virtualclass.sharePt.state)));virtualclass.previrtualclass="virtualclass"+virtualclass.currApp},fromLocalStorage:function(a){null==document.getElementById("pptiframe")&&this.UI.createIframe();document.getElementById("iframecontainer").style.display="block";a=document.getElementById("pptiframe");var b=0>this.pptUrl.search("postMessage")?
this.pptUrl+"?postMessage=true&postMessageEvents=true":this.pptUrl;a.setAttribute("src",b);this.setAutoSlideConfig();a=document.getElementById("pptMessageLayout");null!=a&&(console.log("message block"),a.style.display="none");a=document.getElementById(this.UI.id);a.classList.contains("pptSharing")||a.classList.add("pptSharing")},setAutoSlideConfig:function(){localStorage.getItem("autoSlideTime")&&(virtualclass.sharePt.autoSlideTime=JSON.parse(localStorage.getItem("autoSlideTime")),virtualclass.sharePt.autoSlideFlag=
JSON.parse(localStorage.getItem("autoSlideFlag")))},onmessage:function(a){a.hasOwnProperty("autoSlide")&&(this.autoSlideTime=a.autoSlide);"undefined"!=typeof virtualclass.sharePt&&(virtualclass.system.setAppDimension(virtualclass.currApp),this.onPptMsgReceive(a),a=document.getElementById(virtualclass.sharePt.UI.id),a.classList.contains("pptSharing")||a.classList.add("pptSharing"))},ready:function(a){console.log("teacher ready for ppt ");ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},slidechanged:function(a){this.autoSlideFlag&&
this.autoSlideResumed&&!this.autoSlideTime&&this.calculateAutoSlideTime(a);ioAdapter.mustSend({pptMsg:a,cf:"ppt",autoSlide:this.autoSlideTime,cfpt:"setPEvent"})},calculateAutoSlideTime:function(a){this.eventsObj.push({name:a.eventName,time:Date.now()});2<=this.eventsObj.length&&("slidechanged"==this.eventsObj[0].name&&"slidechanged"==this.eventsObj[1].name?(this.autoSlideTime=this.eventsObj[1].time-this.eventsObj[0].time,console.log("auto slide time withoutpause"+this.autoSlideTime)):"autoslideresumed"==
this.eventsObj[0].name&&"slidechanged"==this.eventsObj[1].name&&(this.autoSlideTime=this.eventsObj[1].time-this.eventsObj[0].time,console.log("withpause"+this.autoSlideTime)),console.log(this.eventsObj),console.log(this.autoSlideTime))},autoslidepaused:function(a){this.autoSlideFlag=1;this.autoSlideResumed=0;console.log(this.pause);ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},autoslideresumed:function(a){this.autoSlideResumed=this.autoSlideFlag=1;this.eventsObj=[];this.eventsObj.push({name:a.eventName,
time:Date.now()});ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},fragmentshown:function(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},fragmenthidden:function(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},overviewshown:function(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},overviewhidden:function(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},paused:function(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},resumed:function(a){ioAdapter.mustSend({pptMsg:a,
cf:"ppt",cfpt:"setPEvent"})},removeControls:function(){setTimeout(function(){document.getElementById("pptiframe").contentWindow.postMessage(JSON.stringify({method:"configure",args:[{controls:!1,autoSlide:0,keyboard:!1,progress:!1,touch:!1}]}),"*")},100)},cfpt:{displayFrame:function(){this.displayFrame()},setUrl:function(a){virtualclass.sharePt.localStoragFlag=0;virtualclass.sharePt.stateLocalStorage={};virtualclass.sharePt.state={indexh:0,indexv:0,indexf:0};this.setSlideUrl(a);var b=document.getElementById("pptiframe");
b.onload=function(){roles.hasView()&&null!=b.contentWindow&&"undefined"!=typeof a.pptMsg.state&&b.contentWindow.postMessage(JSON.stringify({method:"setState",args:[a.pptMsg.state]}),"*")}},setPEvent:function(a){null!=document.getElementById("pptiframe")&&virtualclass.sharePt.setSlideState(a.pptMsg);this.state=a.pptMsg.state}},onPptMsgReceive:function(a){if("undefined"!=typeof a.ppt&&"undefined"!=typeof a.ppt.startFrom){virtualclass.sharePt.startFromFlag=1;var b=document.getElementById("pptiframe");
null!=b&&(0>a.ppt.init.search("postMessage")?b.setAttribute("src",a.ppt.init+"?postMessage=true&postMessageEvents=true"):b.setAttribute("src",a.ppt.init),virtualclass.sharePt.startFrom=[a.ppt.startFrom.indexh,a.ppt.startFrom.indexv,a.ppt.startFrom.indexf])}if("undefined"!=typeof a.pptMsg){var b=document.getElementById("pptiframe"),d=document.getElementById("pptMessageLayout");null!=b&&(b.onload=function(){roles.hasView()&&null!=b.contentWindow&&"undefined"!=typeof a.pptMsg.state&&b.contentWindow.postMessage(JSON.stringify({method:"setState",
args:[a.pptMsg.state]}),"*")});null!=d&&(d.style.display="none");a.hasOwnProperty("cfpt")&&"undefined"!=typeof a.cfpt&&"undefined"!=typeof virtualclass.sharePt.cfpt[a.cfpt]&&virtualclass.sharePt.cfpt[a.cfpt].call(virtualclass.sharePt,a)}},displayFrame:function(){virtualclass.system.setAppDimension(virtualclass.currApp);var a=document.getElementById(virtualclass.sharePt.UI.id);a.classList.contains("pptSharing")||a.classList.add("pptSharing")},setSlideUrl:function(a){virtualclass.sharePt.studentPpt=
0;console.log("PPT:- invoke setSlideUrl");this.autoSlideTime=this.autoSlideFlag=this.viewFlag=0;var b=document.getElementById("pptiframe");null!=b&&b.parentNode.removeChild(b);console.log("create iframe from setslide url");this.UI.createIframe();document.getElementById("iframecontainer").style.display="block";b=document.getElementById("pptiframe");b.setAttribute("src",0>a.pptMsg.search("postMessage")?a.pptMsg+"?postMessage=true&postMessageEvents=true":a.pptMsg);console.log("test url is set");this.pptUrl=
a.pptMsg},setSlideState:function(a){var b=document.getElementById("pptiframe").contentWindow,d=[a.state.indexh,a.state.indexv,a.state.indexf],c=[a.state];switch(a.eventName){case "ready":b.postMessage(JSON.stringify({method:"setState",args:c}),"*");break;case "slidechanged":virtualclass.sharePt.studentPpt=a;console.log("test PPt:-  changed");b.postMessage(JSON.stringify({method:"slide",args:d}),"*");break;case "autoslidepaused":this.autoSlideFlag=1;b.postMessage(JSON.stringify({method:"toggleAutoSlide"}),
"*");break;case "autoslideresumed":this.autoSlideFlag=1;b.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*");break;case "fragmentshown":b.postMessage(JSON.stringify({method:"slide",args:d}),"*");break;case "fragmenthidden":b.postMessage(JSON.stringify({method:"slide",args:d}),"*");break;case "overviewshown":b.postMessage(JSON.stringify({method:"setState",args:c}),"*");break;case "overviewhidden":b.postMessage(JSON.stringify({method:"setState",args:c}),"*"),b.postMessage(JSON.stringify({method:"slide",
args:d}),"*");default:console.log("There is no event is occured")}},toProtocolRelativeUrl:function(){var a=virtualclass.sharePt.urlValue;return 0<=a.indexOf("http")?a.replace(/http:\/\/|https:\/\//,"//"):"//"+a},validUrl:function(){return virtualclass.sharePt.isUrlip(virtualclass.sharePt.urlValue)?virtualclass.sharePt.cleanupUrl(virtualclass.sharePt.urlValue):0<virtualclass.sharePt.urlValue.search("<iframe")?virtualclass.sharePt.extractUrl(virtualclass.sharePt.urlValue):virtualclass.sharePt.validURLWithDomain(virtualclass.sharePt.urlValue)?
virtualclass.sharePt.completeUrl(virtualclass.sharePt.cleanupUrl(virtualclass.sharePt.urlValue)):!1},initNewPpt:function(){virtualclass.sharePt.urlValue=document.getElementById("presentationurl").value;virtualclass.sharePt.urlValue=virtualclass.sharePt.toProtocolRelativeUrl();var a=virtualclass.sharePt.validUrl();if(a){virtualclass.sharePt.autoSlideTime=0;virtualclass.sharePt.autoSlideFlag=0;virtualclass.sharePt.localStoragFlag=0;virtualclass.sharePt.startFromFlag=0;virtualclass.sharePt.eventsObj=
[];virtualclass.sharePt.state={indexh:0,indexv:0,indexf:0};virtualclass.sharePt.stateLocalStorage={};localStorage.removeItem("autoSlideTime");localStorage.removeItem("autoSlideFlag");null==document.getElementById("iframecontainer")&&(console.log("call of iframe creater from onclick event handler"),virtualclass.sharePt.UI.createIframe());var b=document.getElementById(virtualclass.sharePt.UI.id);b.classList.contains("pptSharing")||b.classList.add("pptSharing");virtualclass.sharePt.setPptUrl(a);virtualclass.system.setAppDimension()}else alert("Invalid Url")},
cleanupUrl:function(a){var b=a.search("#");0<b&&(a=a.slice(0,b));return a},setPptUrl:function(a){console.log("test+set ppt url function");document.getElementById("iframecontainer").style.display="block";var b=document.getElementById("pptiframe");console.log("completeurl"+a);virtualclass.sharePt.pptUrl=a+"?postMessage=true&postMessageEvents=true";b.setAttribute("src",virtualclass.sharePt.pptUrl);ioAdapter.mustSend({pptMsg:"displayframe",cf:"ppt",user:"all",cfpt:"displayframe"});ioAdapter.mustSend({pptMsg:a,
cf:"ppt",user:"all",cfpt:"setUrl"});b.style.display="visible"},validURLWithDomain:function(a){return/^\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/.test(a)},completeUrl:function(a){0<a.search("slides.com")&&0>a.search("embed")&&(a+="/embed");return a},extractUrl:function(a){if(0<a.search("src")){var b=a.match(/"(.*?)"/);if(0<b.length)return JSON.parse(b[0])}return a},isUrlip:function(a){a.slice(0,2);return/(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)/.test(a)},
saveIntoLocalStorage:function(a){if(this.validURLWithDomain(a.metaData.init)||this.isUrlip(a.metaData.init))localStorage.setItem("prevApp",JSON.stringify(a)),console.log("ppt_state",a.metaData.startFrom),localStorage.setItem("ppt_state",JSON.stringify(a.metaData.startFrom)),console.log("savinlocal"),localStorage.setItem("pptUrl",JSON.stringify(a.metaData.init)),localStorage.setItem("autoSlideTime",JSON.stringify(virtualclass.sharePt.autoSlideTime)),localStorage.setItem("autoSlideFlag",JSON.stringify(virtualclass.sharePt.autoSlideFlag))},
initTeacherLayout:function(){var a=document.getElementById("pptiframe");if(null!=document.getElementById("pptiframe")){var b={controls:!0,keyboard:!0,progress:!0,touch:!0},d;virtualclass.sharePt.autoSlideTime&&virtualclass.sharePt.autoSlideFlag?d=virtualclass.sharePt.autoSlideTime:virtualclass.sharePt.autoSlideFlag&&(d=6E3);"undefined"!=typeof d&&1E3<d&&(b.autoSlide=d);a.contentWindow.postMessage(JSON.stringify({method:"configure",args:[b]}),"*");a.contentWindow.postMessage(JSON.stringify({method:"toggleAutoSlide"}),
"*")}a=document.getElementById("pptMessageLayout");null!=a&&(a.style.display="none");virtualclass.sharePt.UI.createUrlContainer();document.getElementById("urlcontainer").style.display="block";virtualclass.sharePt.eventsObj=[]},initStudentLayout:function(){var a=document.getElementById("pptiframe");virtualclass.sharePt.eventsObj=[];virtualclass.sharePt.UI.messageDisplay();null!=document.getElementById("pptiframe")?(""!=a.src&&virtualclass.sharePt.hideElement("pptMessageLayout"),a.contentWindow.postMessage(JSON.stringify({method:"configure",
args:[{controls:!1,autoSlide:0,autoSlideStoppable:!0,keyboard:!1,progress:!1,touch:!1}]}),"*")):virtualclass.sharePt.displayElement("pptMessageLayout");virtualclass.sharePt.hideElement("urlcontainer")},hideElement:function(a){a=document.getElementById(a);null!=a&&(a.style.display="none")},displayElement:function(a){a=document.getElementById(a);null!=a&&(a.style.display="block")},attachEvent:function(a,b,d){a=document.getElementById(a);null!=a&&a.addEventListener(b,d)},UI:{id:"virtualclassSharePresentation",
"class":"virtualclass",container:function(){console.log("test create main  container with id virtualclassSharePresentation");var a=document.getElementById(this.id);null!=a&&a.parentNode.removeChild(a);a=document.createElement("div");a.id=this.id;a.className=this["class"];var b=document.getElementById(virtualclass.rWidgetConfig.id);console.log(b.parentNode);b.parentNode.insertBefore(a,b)},createIframe:function(){var a=document.getElementById("iframecontainer");null!=a&&a.parentNode.removeChild(a);
console.log("test create ppt  iframe");a=document.getElementById("virtualclassSharePresentation");if(null!=a){var b=document.createElement("div");a.appendChild(b);b.style.display="none"}b=document.createElement("div");b.setAttribute("id","iframecontainer");b.style.height="100%";b.style.width="100%";a.insertBefore(b,a.firstChild);b.style.display="none";a=document.getElementById("iframecontainer");b=document.createElement("iframe");a.appendChild(b);b.setAttribute("id","pptiframe");b.style.height="100%";
b.style.width="100%"},createUrlContainer:function(){var a=document.getElementById("virtualclassSharePresentation");if(null==document.getElementById("urlcontainer")){var b=document.createElement("div");b.setAttribute("id","urlcontainer");a.appendChild(b);a=document.createElement("input");a.setAttribute("id","presentationurl");a.setAttribute("placeholder",virtualclass.lang.getString("ppturl"));b.appendChild(a);a=document.createElement("input");a.setAttribute("type","submit");a.setAttribute("id","submitpurl");
a.setAttribute("value","submit");b.appendChild(a)}},messageDisplay:function(){if(null==document.getElementById("pptMessageLayout")){var a=document.getElementById("virtualclassSharePresentation"),b=document.createElement("p");b.id="pptMessageLayout";b.innerHTML=virtualclass.lang.getString("pptscreenstudent");a.appendChild(b)}},removeIframe:function(){var a=document.getElementById("pptiframe");a&&a.parentNode.removeChild(a)}}}}})(window);(function(c){var a={requestPackets:function(a){1<a.length&&(virtualclass.wb.gObj.myArr=a);virtualclass.wb.sentReq=!0;return[0==virtualclass.wb.gObj.displayedObjId?0:virtualclass.wb.gObj.rcvdPackId,a[0].uid]},makeQueue:function(a){virtualclass.wb.gObj.queue[a.uid]=a},sendPackets:function(a,d){if(0==a.message.getMsPckt[0])var c=-1;else for(c=0;c<virtualclass.wb.gObj.myrepObj.length&&a.message.getMsPckt[0]!=virtualclass.wb.gObj.myrepObj[c].uid;c++);for(c+=1;c<a.message.getMsPckt[1];c++)d.push(virtualclass.wb.gObj.myrepObj[c]);
return d},handleMissedPackets:function(b,d,c){c=this.removeDupObjs(c);virtualclass.wb.gObj.replayObjs=virtualclass.wb.gObj.replayObjs.concat(c);a.sortingReplyObjs();b!=d&&virtualclass.storage.store(JSON.stringify(virtualclass.wb.gObj.replayObjs));this.containsIfQueuePacks(b,d,virtualclass.wb.gObj.displayedObjId,c)},removeDupObjs:function(a){0<virtualclass.wb.gObj.myArr.length&&(a[a.length-1].uid==virtualclass.wb.gObj.myArr[0].uid&&(virtualclass.wb.gObj.myArr[0].hasOwnProperty("cmd")||virtualclass.wb.gObj.myArr.shift()),
a=a.concat(virtualclass.wb.gObj.myArr),virtualclass.wb.gObj.myArr=[]);return a},containsIfQueuePacks:function(a,d,c,g){a!=d&&c+1!=g[0].uid&&0<virtualclass.wb.gObj.packQueue.length&&g[g.length-1].uid==virtualclass.wb.gObj.packQueue[0].uid&&(virtualclass.wb.gObj.packQueue=g.concat(virtualclass.wb.gObj.packQueue))},sortingReplyObjs:function(){virtualclass.wb.gObj.replayObjs=virtualclass.wb.gObj.replayObjs.sort(function(a,d){return a.uid-d.uid})}};c.bridge=a})(window);(function(c){vcan.optimize={sendPacketWithOptimization:function(a,b,d){"undefined"==typeof this.lastarrowtime&&(this.lastarrowtime=(new Date).getTime(),1==b&&virtualclass.vutil.beforeSend(JSON.parse(a)),virtualclass.wb.utility.updateSentInformation(a,!0));this.presentarrowtime=(new Date).getTime();this.presentarrowtime-this.lastarrowtime>=d&&(1==b&&(b=JSON.parse(a),b.hasOwnProperty("createArrow")?ioAdapter.send(b):ioAdapter.mustSend(b)),virtualclass.wb.utility.updateSentInformation(a,!0),this.lastarrowtime=
(new Date).getTime())},doOptiMize:function(a){if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=(new Date).getTime(),a.detail.hasOwnProperty("cevent")||vcan.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-vcan.main.offset.x,a.clientY-vcan.main.offset.y);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&((new Date).getTime(),a.detail.hasOwnProperty("cevent")||vcan.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-
vcan.main.offset.x,a.clientY-vcan.main.offset.y),vcan.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-vcan.main.offset.x,a.clientY-vcan.main.offset.y),lastmousemovetime=(new Date).getTime())},calculatePackets:function(a,b,d,c){a=vcan.makeStackObj(a,b,d,c);virtualclass.wb.uid++;a.uid=virtualclass.wb.uid;vcan.main.replayObjs.push(a);virtualclass.vutil.beforeSend({repObj:[a],cf:"repObj"});virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs))}}})(window);(function(c){c.response={reclaimRole:function(a,b){a!=b&&(virtualclass.user.control._assign(b,"notsent",a),virtualclass.user.displayStudentSpeaker(!0),null!=localStorage.getItem("aId")&&localStorage.removeItem("aId"),virtualclass.user.control.removeAudioFromParticipate(a),"mobTab"==virtualclass.system.device&&((virtualclass.system.mybrowser.name=8<=virtualclass.system.mybrowser.version)&&/(iPad)/g.test(navigator.userAgent)&&virtualclass.vutil.enableVirtualClass(),virtualclass.view.removeErrorMsg("errorContainer",
!0)))},assignRole:function(a,b,d){if(a!=b||"undefined"!=typeof d)if(virtualclass.vutil.assignRole(b),virtualclass.wb.utility.uniqueArrOfObjsToTeacher(),roles.hasAdmin())a=document.getElementById("chat_div").getElementsByClassName("currTeacher")[0],null!=a&&virtualclass.user.control.removeCurrTeacherFromControl(a.id),virtualclass.user.control.changeAttrToAssign("enable");else{virtualclass.vutil.removeSessionTool();b=document.getElementById("ml"+a);d=["assign"];var c=document.getElementById(a+"ControlContainer");
null!=c?virtualclass.user.createAssignControl(c,a,!0):(d=virtualclass.user.createControl(a,d),b.appendChild(d));localStorage.setItem("aId",a)}virtualclass.vutil.attachClickOutSideCanvas();"mobTab"==virtualclass.system.device&&(virtualclass.vutil.disableVirtualClass(),virtualclass.view.createErrorMsg(virtualclass.lang.getString("supportDesktop"),"errorContainer","chatWidget"))},checkUser:function(a,b,d){"undefined"!=typeof vcan.teacher||d||virtualclass.wb.utility.makeCanvasDisable();virtualclass.vutil.initDefaultInfo(a,
wbUser.role,virtualclass.currApp);virtualclass.wb.utility.makeUserAvailable(a.message.checkUser.e.clientLen)},clearAll:function(a,b,d,c){a!=b&&(virtualclass.wb.tool=new virtualclass.wb.tool_obj("t_clearall"),virtualclass.wb.utility.t_clearallInit(),virtualclass.wb.utility.makeDefaultValue(),virtualclass.storage.clearSingleTable("wbData"))},replayAll:function(){c.virtualclass.wb.vcan.main.replayObjs=virtualclass.wb.gObj.replayObjs;virtualclass.wb.utility.clearAll(!1);virtualclass.wb.toolInit("t_replay",
"fromFile")},createArrow:function(a,b){var d=virtualclass.wb.arrImg,c={};c.mp={x:a.x,y:a.y};virtualclass.wb.utility.drawArrowImg(d,c)},replayObj2:function(a){c.virtualclass.wb.vcan.main.replayObjs=[];0<a.length&&(virtualclass.wb.gObj.displayedObjId+1==a[0].uid?(c.virtualclass.wb.vcan.main.replayObjs=a,console.log("Whiteboard:-  recieved "+a[a.length-1].uid),virtualclass.wb.toolInit("t_replay","fromBrowser",!0,virtualclass.wb.utility.dispQueuePacket)):console.log("Whiteboard:- Problem between display id "+
virtualclass.wb.gObj.displayedObjId+" and recived first packet"+a[0].uid))},replayObj:function(a){c.virtualclass.wb.vcan.main.replayObjs=[];0<a.length&&(c.virtualclass.wb.vcan.main.replayObjs=a,virtualclass.wb.toolInit("t_replay","fromBrowser",!0,virtualclass.wb.utility.dispQueuePacket))},chunk:function(a,b,d){virtualclass.wb.bridge.handleMissedPackets(a,b,d)},repObjForMissedPkts:function(a){(0!==virtualclass.wb.gObj.rcvdPackId||0<virtualclass.wb.uid&&0===virtualclass.wb.gObj.rcvdPackId)&&("object"===
typeof a||a instanceof Array)&&a[0].hasOwnProperty("uid")&&!a.hasOwnProperty("chunk")&&(Number(virtualclass.wb.gObj.rcvdPackId+1)<Number(a[0].uid)||virtualclass.wb.gObj.rcvdPackId!=virtualclass.wb.gObj.displayedObjId)&&(a=virtualclass.wb.bridge.requestPackets(a),virtualclass.vutil.beforeSend({getMsPckt:a,cf:"getMsPckt"}))}}})(window);var LZString={_f:String.fromCharCode,_keyStrBase64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_keyStrUriSafe:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",_getBaseValue:function(c,a){LZString._baseReverseDic||(LZString._baseReverseDic={});if(!LZString._baseReverseDic[c]){LZString._baseReverseDic[c]={};for(var b=0;b<c.length;b++)LZString._baseReverseDic[c][c[b]]=b}return LZString._baseReverseDic[c][a]},compressToBase64:function(c){if(null==c)return"";
c=LZString._compress(c,6,function(a){return LZString._keyStrBase64.charAt(a)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(c){return null==c?"":""==c?null:LZString._decompress(c.length,32,function(a){return LZString._getBaseValue(LZString._keyStrBase64,c.charAt(a))})},compressToUTF16:function(c){return null==c?"":LZString._compress(c,15,function(a){return String.fromCharCode(a+32)})+" "},decompressFromUTF16:function(c){return null==
c?"":""==c?null:LZString._decompress(c.length,16384,function(a){return c.charCodeAt(a)-32})},compressToUint8Array:function(c){c=LZString.compress(c);for(var a=new Uint8Array(2*c.length),b=0,d=c.length;b<d;b++){var f=c.charCodeAt(b);a[2*b]=f>>>8;a[2*b+1]=f%256}return a},decompressFromUint8Array:function(c){if(null===c||void 0===c)return LZString.decompress(c);for(var a=Array(c.length/2),b=0,d=a.length;b<d;b++)a[b]=256*c[2*b]+c[2*b+1];var f=[];a.forEach(function(a){f.push(String.fromCharCode(a))});
return LZString.decompress(f.join(""))},compressToEncodedURIComponent:function(c){return null==c?"":LZString._compress(c,6,function(a){return LZString._keyStrUriSafe.charAt(a)})},decompressFromEncodedURIComponent:function(c){if(null==c)return"";if(""==c)return null;c=c.replace(/ /g,"+");return LZString._decompress(c.length,32,function(a){return LZString._getBaseValue(LZString._keyStrUriSafe,c.charAt(a))})},compress:function(c){return LZString._compress(c,16,function(a){return String.fromCharCode(a)})},
_compress:function(c,a,b){if(null==c)return"";var d,f,g={},h={},m="",n="",q="",u=2,w=3,t=2,x=[],r=0,s=0,v;for(v=0;v<c.length;v+=1)if(m=c[v],Object.prototype.hasOwnProperty.call(g,m)||(g[m]=w++,h[m]=!0),n=q+m,Object.prototype.hasOwnProperty.call(g,n))q=n;else{if(Object.prototype.hasOwnProperty.call(h,q)){if(256>q.charCodeAt(0)){for(d=0;d<t;d++)r<<=1,s==a-1?(s=0,x.push(b(r)),r=0):s++;f=q.charCodeAt(0);for(d=0;8>d;d++)r=r<<1|f&1,s==a-1?(s=0,x.push(b(r)),r=0):s++,f>>=1}else{f=1;for(d=0;d<t;d++)r=r<<1|
f,s==a-1?(s=0,x.push(b(r)),r=0):s++,f=0;f=q.charCodeAt(0);for(d=0;16>d;d++)r=r<<1|f&1,s==a-1?(s=0,x.push(b(r)),r=0):s++,f>>=1}u--;0==u&&(u=Math.pow(2,t),t++);delete h[q]}else for(f=g[q],d=0;d<t;d++)r=r<<1|f&1,s==a-1?(s=0,x.push(b(r)),r=0):s++,f>>=1;u--;0==u&&(u=Math.pow(2,t),t++);g[n]=w++;q=String(m)}if(""!==q){if(Object.prototype.hasOwnProperty.call(h,q)){if(256>q.charCodeAt(0)){for(d=0;d<t;d++)r<<=1,s==a-1?(s=0,x.push(b(r)),r=0):s++;f=q.charCodeAt(0);for(d=0;8>d;d++)r=r<<1|f&1,s==a-1?(s=0,x.push(b(r)),
r=0):s++,f>>=1}else{f=1;for(d=0;d<t;d++)r=r<<1|f,s==a-1?(s=0,x.push(b(r)),r=0):s++,f=0;f=q.charCodeAt(0);for(d=0;16>d;d++)r=r<<1|f&1,s==a-1?(s=0,x.push(b(r)),r=0):s++,f>>=1}u--;0==u&&(u=Math.pow(2,t),t++);delete h[q]}else for(f=g[q],d=0;d<t;d++)r=r<<1|f&1,s==a-1?(s=0,x.push(b(r)),r=0):s++,f>>=1;u--;0==u&&(Math.pow(2,t),t++)}f=2;for(d=0;d<t;d++)r=r<<1|f&1,s==a-1?(s=0,x.push(b(r)),r=0):s++,f>>=1;for(;;)if(r<<=1,s==a-1){x.push(b(r));break}else s++;return x.join("")},decompress:function(c){return null==
c?"":""==c?null:LZString._decompress(c.length,32768,function(a){return c.charCodeAt(a)})},_decompress:function(c,a,b){var d=[],f=4,g=4,h=3,m="",n=[],q,u,w,t,x,r=LZString._f,s=b(0),v=a,B=1;for(q=0;3>q;q+=1)d[q]=q;m=0;w=Math.pow(2,2);for(t=1;t!=w;)u=s&v,v>>=1,0==v&&(v=a,s=b(B++)),m|=(0<u?1:0)*t,t<<=1;switch(m){case 0:m=0;w=Math.pow(2,8);for(t=1;t!=w;)u=s&v,v>>=1,0==v&&(v=a,s=b(B++)),m|=(0<u?1:0)*t,t<<=1;x=r(m);break;case 1:m=0;w=Math.pow(2,16);for(t=1;t!=w;)u=s&v,v>>=1,0==v&&(v=a,s=b(B++)),m|=(0<u?
1:0)*t,t<<=1;x=r(m);break;case 2:return""}q=d[3]=x;for(n.push(x);;){if(B>c)return"";m=0;w=Math.pow(2,h);for(t=1;t!=w;)u=s&v,v>>=1,0==v&&(v=a,s=b(B++)),m|=(0<u?1:0)*t,t<<=1;switch(x=m){case 0:m=0;w=Math.pow(2,8);for(t=1;t!=w;)u=s&v,v>>=1,0==v&&(v=a,s=b(B++)),m|=(0<u?1:0)*t,t<<=1;d[g++]=r(m);x=g-1;f--;break;case 1:m=0;w=Math.pow(2,16);for(t=1;t!=w;)u=s&v,v>>=1,0==v&&(v=a,s=b(B++)),m|=(0<u?1:0)*t,t<<=1;d[g++]=r(m);x=g-1;f--;break;case 2:return n.join("")}0==f&&(f=Math.pow(2,h),h++);if(d[x])m=d[x];else if(x===
g)m=q+q[0];else return null;n.push(m);d[g++]=q+m[0];f--;q=m;0==f&&(f=Math.pow(2,h),h++)}}};"undefined"!==typeof module&&null!=module&&(module.exports=LZString);(function(c){var a={BIAS:132,CLIP:32635,tables:{ulaw:{compress:[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],decompress:[-32124,-31100,-30076,-29052,-28028,-27004,-25980,-24956,-23932,-22908,-21884,-20860,-19836,-18812,-17788,-16764,-15996,-15484,-14972,-14460,-13948,-13436,-12924,-12412,-11900,-11388,-10876,-10364,-9852,-9340,-8828,-8316,-7932,-7676,-7420,-7164,-6908,-6652,-6396,-6140,-5884,-5628,-5372,-5116,-4860,-4604,-4348,-4092,-3900,-3772,-3644,-3516,-3388,-3260,-3132,-3004,-2876,-2748,-2620,-2492,-2364,-2236,-2108,-1980,-1884,
-1820,-1756,-1692,-1628,-1564,-1500,-1436,-1372,-1308,-1244,-1180,-1116,-1052,-988,-924,-876,-844,-812,-780,-748,-716,-684,-652,-620,-588,-556,-524,-492,-460,-428,-396,-372,-356,-340,-324,-308,-292,-276,-260,-244,-228,-212,-196,-180,-164,-148,-132,-120,-112,-104,-96,-88,-80,-72,-64,-56,-48,-40,-32,-24,-16,-8,0,32124,31100,30076,29052,28028,27004,25980,24956,23932,22908,21884,20860,19836,18812,17788,16764,15996,15484,14972,14460,13948,13436,12924,12412,11900,11388,10876,10364,9852,9340,8828,8316,7932,
7676,7420,7164,6908,6652,6396,6140,5884,5628,5372,5116,4860,4604,4348,4092,3900,3772,3644,3516,3388,3260,3132,3004,2876,2748,2620,2492,2364,2236,2108,1980,1884,1820,1756,1692,1628,1564,1500,1436,1372,1308,1244,1180,1116,1052,988,924,876,844,812,780,748,716,684,652,620,588,556,524,492,460,428,396,372,356,340,324,308,292,276,260,244,228,212,196,180,164,148,132,120,112,104,96,88,80,72,64,56,48,40,32,24,16,8,0]},alaw:{compress:[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],decompress:[-5504,-5248,-6016,-5760,-4480,-4224,-4992,-4736,-7552,-7296,-8064,-7808,-6528,-6272,-7040,-6784,-2752,-2624,-3008,-2880,-2240,-2112,-2496,-2368,-3776,-3648,-4032,-3904,-3264,-3136,-3520,-3392,-22016,-20992,-24064,-23040,-17920,-16896,-19968,-18944,-30208,-29184,-32256,-31232,-26112,-25088,-28160,-27136,-11008,
-10496,-12032,-11520,-8960,-8448,-9984,-9472,-15104,-14592,-16128,-15616,-13056,-12544,-14080,-13568,-344,-328,-376,-360,-280,-264,-312,-296,-472,-456,-504,-488,-408,-392,-440,-424,-88,-72,-120,-104,-24,-8,-56,-40,-216,-200,-248,-232,-152,-136,-184,-168,-1376,-1312,-1504,-1440,-1120,-1056,-1248,-1184,-1888,-1824,-2016,-1952,-1632,-1568,-1760,-1696,-688,-656,-752,-720,-560,-528,-624,-592,-944,-912,-1008,-976,-816,-784,-880,-848,5504,5248,6016,5760,4480,4224,4992,4736,7552,7296,8064,7808,6528,6272,
7040,6784,2752,2624,3008,2880,2240,2112,2496,2368,3776,3648,4032,3904,3264,3136,3520,3392,22016,20992,24064,23040,17920,16896,19968,18944,30208,29184,32256,31232,26112,25088,28160,27136,11008,10496,12032,11520,8960,8448,9984,9472,15104,14592,16128,15616,13056,12544,14080,13568,344,328,376,360,280,264,312,296,472,456,504,488,408,392,440,424,88,72,120,104,24,8,56,40,216,200,248,232,152,136,184,168,1376,1312,1504,1440,1120,1056,1248,1184,1888,1824,2016,1952,1632,1568,1760,1696,688,656,752,720,560,528,
624,592,944,912,1008,976,816,784,880,848]}},encode:function(b,d){d=d||{};b.constructor==Array&&(b.byteLength=2*b.length);for(var c=new ArrayBuffer(b.byteLength/2),c=new Int8Array(c),g=a[d.alaw?"alaw":"ulaw"],h=0;h<b.byteLength/2;h++)c[h]=g(b[h]);return c},decode:function(b,d){d=d||{};"undefined"==typeof b.byteLength&&(b.byteLength=b.length);for(var c=!!d.floating_point,g=new ArrayBuffer(b.byteLength*(c?4:2)),g=c?new Float32Array(g):new Int16Array(g),h=a[(d.alaw?"alaw":"ulaw")+"_dec"],m,n=0;n<b.byteLength;n++)m=
h(b[n]),g[n]=c?m/32768:m;return g},alaw:function(b){var d=new ArrayBuffer(2),c=new ArrayBuffer(1),d=new Int16Array(d),c=new Int8Array(c),g;g=~b>>8&128;128!=g&&(d[0]=-b,b=d[0]);b>a.CLIP&&(b=a.CLIP);256<=b?(d=a.tables.alaw.compress[b>>8&127],c[0]=d<<4|b>>d+3&15):c[0]=b>>4;c[0]=c[0]^g^85;return c[0]},alaw_dec:function(b){var d=new ArrayBuffer(2),d=new Int8Array(d);b=a.tables.alaw.decompress[b&255];d[0]=b;d[1]=b>>8;return(new Int16Array(d.buffer))[0]},ulaw:function(b){var d=new ArrayBuffer(2),c=new ArrayBuffer(1),
d=new Int16Array(d),c=new Int8Array(c),g;0>b?(d[0]=a.BIAS-b,b=d[0],d=127):(b+=a.BIAS,d=255);g=a.tables.ulaw.compress[b>>8&127];if(8<=g)return 127^d;c[0]=g<<4|b>>g+3&15;return c[0]^d},ulaw_dec:function(b){var d=new ArrayBuffer(2),d=new Int8Array(d);b=a.tables.ulaw.decompress[b&255];d[0]=b;d[1]=b>>8;return(new Int16Array(d.buffer))[0]},ulaw_dec_slow:function(b){var d=new ArrayBuffer(2),d=new Int16Array(d);d[0]=~b;b=d[0];d=((b&15)<<3)+a.BIAS;d<<=(b&112)>>4;b=128==(b&128);var c=new ArrayBuffer(2),c=new Int16Array(c);
c[0]=b?a.BIAS-d:d-a.BIAS;return c[0]}};c.G711=a;c.version="0.0.1"})("undefined"!==typeof exports?module.exports:window);window.addEventListener("message",function(c){if(c.origin==window.location.origin)if("gotScreen"==c.data.type){var a;if(""===c.data.sourceId){if(c=Error("NavigatorUserMediaError"),c.name="PERMISSION_DENIED",virtualclass.hasOwnProperty("ss"))virtualclass.ss.onError(c)}else a=a||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:c.data.sourceId,maxWidth:1440,maxHeight:9999},optional:[{maxFrameRate:3},{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},virtualclass.adpt=
new virtualclass.adapter,navigator2=virtualclass.adpt.init(navigator),navigator2.getUserMedia(a,function(a){virtualclass.ss._init();roles.hasControls()&&virtualclass.ss.initializeRecorder.call(virtualclass.ss,a)},function(a){virtualclass.ss.onError.call(virtualclass.ss,a)})}else"getScreenPending"==c.data.type?window.clearTimeout(c.data.id):"yes"==c.data.type&&(virtualclass.gObj.ext=!0)});(function(c){c.dirtyCorner={decodeRGB:function(a,b,d){b=b.createImageData(d.width,d.height);for(d=0;d<4*a.length;d++)b.data[4*d+0]=36.5*(a[d]>>5),b.data[4*d+1]=36.5*((a[d]&28)>>2),b.data[4*d+2]=85*(a[d]&3),b.data[4*d+3]=255;return b},decodeRGBSlice:function(a,b,d){b=b.createImageData(d.w,d.h);for(d=0;d<4*a.length;d++)b.data[4*d+0]=36.5*(a[d]>>5),b.data[4*d+1]=36.5*((a[d]&28)>>2),b.data[4*d+2]=85*(a[d]&3),b.data[4*d+3]=255;return b},encodeRGB:function(a){for(var b=a.length/4,d=new Uint8ClampedArray(b),
c,g,h,m=0;m<b;m++)c=a[4*m+0],g=a[4*m+1],h=a[4*m+2],c=(Math.round(c/36.5)<<5)+(Math.round(g/36.5)<<2)+Math.round(h/85),d[m]=c;return d},str2ImageData:function(a,b){var d=context2.createImageData(b.w,b.h),c=new ArrayBuffer(a.length);d.data=new Uint8Array(c);for(c=0;c<strLen;c++)d.data[c]=a.charCodeAt(c);return d},doClearCanvas:function(){context2.clearRect(0,0,canvas2.width,canvas2.height)}}})(window);(function(c){c.vutil={createDOM:function(a,b,d){a=document.createElement(a);"undefined"!=typeof b&&(a.id=b);if("undefined"!=typeof d){b="";if(0<d.length)for(var c=0;c<d.length;c++)b+=d[c]+" ";a.className=b}return a},ab2str:function(a){return String.fromCharCode.apply(null,new Uint8ClampedArray(a))},str2ab:function(a){for(var b=new ArrayBuffer(a.length),b=new Uint8ClampedArray(b),d=0,c=a.length;d<c;d++)b[d]=a.charCodeAt(d);return b},sidebarHeightInit:function(){document.getElementById("widgetRightSide").style.height=
c.innerHeight+"px"},isSystemCompatible:function(){if(0<virtualclass.error.length){var a=1<virtualclass.error.length?virtualclass.error.join("<br />"):virtualclass.error[0];virtualclass.view.createErrorMsg(a,"errorContainer","chatWidget");virtualclass.gObj.hasOwnProperty("errIE")&&virtualclass.vutil.disableVirtualClass();virtualclass.gObj.hasOwnProperty("audIntDisable")&&virtualclass.user.control.audioWidgetDisable();virtualclass.gObj.hasOwnProperty("errNotDesktop")&&(virtualclass.user.control.audioWidgetDisable(),
virtualclass.vutil.disableVirtualClass())}else(virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable"))&&virtualclass.user.control.audioWidgetDisable()},chkValueInLocalStorage:function(a){return null===localStorage.getItem(a)?!1:localStorage[a]},setContainerWidth:function(a,b){var d="virtualclassWhiteboard";"undefined"!=typeof virtualclass.previous&&(d="virtualclass"+b!=virtualclass.previous?"virtualclass"+b:virtualclass.previous);var d=d.split("virtualclass")[1],
d="virtualclass"+virtualclass.vutil.capitalizeFirstLetter(d),c=document.getElementById(d);if(null!=c){var g=5,h;if("Whiteboard"==b)h=0;else{h=document.getElementById("virtualclassOptionsCont");if(null!=h){var m=vcan.utility.getElementOffset(h);h=h.offsetWidth+m.x}else h=0;"Yts"==b?g=roles.hasControls()?60:15:"SharePresentation"==b?g=roles.hasControls()?50:15:"EditorRich"==virtualclass.currApp||"EditorCode"==virtualclass.currApp?0<h?g=12:h=roles.hasControls()?70:5:g="ScreenShare"==b?70:65}m=70;"SharePresentation"==
b&&null!=document.querySelector("#virtualclass"+b+".pptSharing")&&(m=120);virtualclass.isPlayMode&&(m+=75);var n=document.getElementById("commandToolsWrapper");null!=n?m=m+n.clientHeight+3:(roles.isEducator()||roles.hasControls())&&"Whiteboard"==virtualclass.currApp&&(m=m+46+3);a.width-=g+h+0;c.style.width=a.width+"px";c.style.height=a.height-m+"px";"virtualclassScreenShare"==d&&(g=document.getElementById(d+"Local"),a.width-=10,c.style.width=a.width,g.style.width=a.width+"px",virtualclass.vutil.setScreenInnerTagsWidth(d))}else console.log(c+
" is not found ")},setScreenInnerTagsWidth:function(a){document.getElementById(a);document.getElementById(a+"Local");document.getElementById(a+"LocalVideo")},makeActiveApp:function(a,b){if(a!=b&&"undefined"!=typeof b)b+="Tool",document.getElementById(b).className=virtualclass.vutil.removeClassFromElement(b,"active");else{for(var d=document.getElementsByClassName("appOptions"),c=0;c<d.length;c++)d[c].classList.contains("active")&&d[c].classList.remove("active");console.log("Whiteboard Tool class:- is "+
b+" with app "+a)}document.getElementById(a+"Tool").className+=" active"},initInstallChromeExt:function(a){"EXTENSION_UNAVAILABLE"==a.name&&(console.log("ask for inline installation"),chrome.webstore.install("https://chrome.google.com/webstore/detail/ijhofagnokdeoghaohcekchijfeffbjl",function(a){c.location.reload()},function(a){alert(a)}))},removeAppPanel:function(){var a=document.getElementById("virtualclassOptionsCont");null!=a&&a.parentNode.removeChild(a)},removeTempVideo:function(a){a=document.getElementById(a);
a.parentNode.removeChild(a)},createLocalTempVideo:function(a,b){if("string"==typeof a||"String"==typeof a)a=document.getElementById(a);var d=virtualclass.vutil.createDOM("div",b),c=virtualclass.vutil.createDOM("canvas",b+"Video");d.appendChild(c);a.appendChild(d)},initLocCanvasCont:function(a){var b;b="ScreenShare"==virtualclass.currApp?"ss":"wss";virtualclass[b].localtempCanvas=document.getElementById(a);console.log(virtualclass[b].localtempCanvas);virtualclass[b].localtempCont=virtualclass[b].localtempCanvas.getContext("2d")},
videoTeacher2Student:function(a,b){var d=a,c=document.getElementById("virtualclass"+a+"LocalVideo");if(null!=c&&"VIDEO"==c.tagName){var g=document.createElement("canvas");g.id=c.id;g.width=c.offsetWidth;g.height=c.offsetHeight;c.parentNode.replaceChild(g,c);"ScreenShare"==d&&(d="ss");"undefined"!=typeof b||"undefined"==typeof d||"ss"!=d&&"wss"!=d||(virtualclass[d].localCanvas=g,virtualclass[d].localCont=virtualclass[d].localCanvas.getContext("2d"),c=virtualclass[d].localtempCont.getImageData(0,0,
virtualclass[d].localtempCanvas.width,virtualclass[d].localtempCanvas.height),virtualclass[d].localCont.putImageData(c,0,0));virtualclass.vutil.removeTempVideo("virtualclass"+a+"LocalTemp")}},clickOutSideCanvas:function(){this.exitTextWrapper()&&virtualclass.wb.obj.drawTextObj.textUtility(virtualclass.wb.gObj.spx,virtualclass.wb.gObj.spy)},exitTextWrapper:function(){return 0<document.getElementsByClassName("textBoxContainer").length},attachClickOutSideCanvas:function(){function a(a){a=document.getElementById(a);
null!=a&&(a.onclick=function(){roles.hasControls()&&virtualclass.vutil.clickOutSideCanvas()})}a("commandToolsWrapper");a("virtualclassOptionsCont");a("audioWidget");a("chatWidget")},dimensionMatch:function(a,b){var d=document.getElementById(a).offsetWidth,c=document.getElementById("virtualclassOptionsCont").offsetWidth;return document.getElementById(b).offsetWidth+c==d},disableAppsBar:function(){var a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.pointerEvents="none")},isMiniFileIncluded:function(a){a=
new RegExp(a+".js?=*([0-9]*)");for(var b=document.getElementsByTagName("script"),d=0;d<b.length;d++)if(a.test(b[d].src))return!0;return!1},clearAllChat:function(){localStorage.removeItem(virtualclass.gObj.uid);localStorage.clear("chatroom");virtualclass.chat.idList.length=0;clearAllChatBox();var a=document.getElementById("chatWidget").getElementsByClassName("ui-chatbox-msg");if(0<a.length)for(;null!=a[0];)a[0].parentNode.removeChild(a[0])},isObjectEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;
return!0},removeSessionTool:function(){if(!roles.hasAdmin()){var a=document.getElementById("virtualclassSessionEndTool");null!=a&&a.parentNode.removeChild(a)}},addClass:function(a,b){var d=document.getElementById(a);virtualclass.vutil.elemHasAnyClass(a)?d.classList.add(b):d.className=b},removeClass:function(a,b){var d=document.getElementById(a);virtualclass.vutil.elemHasAnyClass(a)&&d.classList.contains(b)&&d.classList.remove(b)},breakIntoBytes:function(a,b){for(var d=a.toString(),c=d.length;c<b;c++)d=
"0"+d;return d.match(/[\S]{1,2}/g)||[]},numValidateFour:function(a,b,d,c){a=this.preNumValidateTwo(a);b=this.preNumValidateTwo(b);d=this.preNumValidateTwo(d);c=this.preNumValidateTwo(c);return parseInt(a+b+d+c)},numValidateTwo:function(a,b){a=this.preNumValidateTwo(a);b=this.preNumValidateTwo(b);return parseInt(a+b)},preNumValidateTwo:function(a){a=a.toString();if(1==a.length)return"0"+a;if(2==a.length)return a},elemHasAnyClass:function(a){a=document.getElementById(a);return null!=a?"undefined"!=
typeof a.classList:!1},userIsOrginalTeacher:function(a){return roles.hasAdmin()},isUserTeacher:function(a){return roles.hasControls()},initDisableAudVid:function(){virtualclass.gObj.audIntDisable=!0;virtualclass.gObj.vidIntDisable=!0},initDisableVirtualClass:function(){this.initDisableAudVid();virtualclass.gObj.errNotDesktop=!0;virtualclass.gObj.errNotScreenShare=!0;virtualclass.gObj.errAppBar=!0},disableVirtualClass:function(){var a=document.getElementById("virtualclassCont");a.style.opacity=.6;
a.style.pointerEvents="none"},enableVirtualClass:function(){var a=document.getElementById("virtualclassCont");a.style.opacity=1;a.style.pointerEvents="visible"},firstiOSaudioCall:function(){virtualclass.gObj.hasOwnProperty("audioPlayMessage")&&(virtualclass.gObj.iosIpadbAudTrue=!0,virtualclass.gObj.video.audio.receivedAudioProcess(virtualclass.gObj.audioPlayMessage))},beforeLoad:function(){if(virtualclass.recorder.hasOwnProperty("doSessionClear"))virtualclass.clearSession();else if(0==localStorage.length)virtualclass.storage.clearStorageData();
else{if("undefined"!=typeof virtualclass.storage.wholeStoreData){var a=JSON.parse(virtualclass.storage.wholeStoreData);a.beforeRefresh=!0;virtualclass.storage.wholeStore(a,"put")}localStorage.setItem("executedSerial",JSON.stringify(ioMissingPackets.executedSerial));localStorage.setItem("executedUserSerial",JSON.stringify(ioMissingPackets.executedUserSerial));localStorage.removeItem("otherRole");virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.video.audio.studentNotSpeak();virtualclass.vutil.clickOutSideCanvas();
localStorage.setItem(wbUser.sid,JSON.stringify(virtualclass.chat.vmstorage));virtualclass.hasOwnProperty("editorRich")&&"object"==typeof virtualclass.editorRich.vcAdapter&&virtualclass.editorRich.saveIntoLocalStorage();virtualclass.hasOwnProperty("editorCode")&&"object"==typeof virtualclass.editorCode.vcAdapter&&virtualclass.editorCode.saveIntoLocalStorage();a={name:virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp)};console.log(virtualclass.currApp);"ScreenShare"==virtualclass.currApp?
a.name="EditorRich":"Yts"==virtualclass.currApp?"undefined"!=typeof virtualclass.yts.videoId&&"object"==typeof virtualclass.yts.player&&(a.metaData={init:virtualclass.yts.videoId,startFrom:virtualclass.yts.player.getCurrentTime()}):"SharePresentation"==virtualclass.currApp&&("undefined"!=typeof virtualclass.sharePt&&"object"==typeof virtualclass.sharePt?(console.log("beforeloadS"+virtualclass.sharePt.pptUrl),a.metaData={init:virtualclass.sharePt.pptUrl,startFrom:virtualclass.sharePt.state},console.log("start From"+
virtualclass.sharePt.state),virtualclass.sharePt.saveIntoLocalStorage(a)):a.metaData=null);roles.hasView()&&"Yts"==virtualclass.currApp&&(a={name:"Yts",metaData:null});localStorage.setItem("prevApp",JSON.stringify(a));io.disconnect()}},initOnBeforeUnload:function(a){"iOS"==a?document.body.onunload=function(){virtualclass.vutil.beforeLoad()}:c.onbeforeunload=function(){var a=virtualclass.vutil.smallizeFirstLetter(virtualclass.currApp);virtualclass.vutil.beforeLoad();if(("editorRich"==a||"editorCode"==
a)&&"Synchronized"!=virtualclass[a].cmClient.state.constructor.name)return virtualclass.lang.getString("editorinsync")}},isPlayMode:function(){return!0==c.wbUser.virtualclassPlay},progressBar:function(a,b,d,c){b>a&&(b=a,document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"));a=0==a&&0==b?0:Math.round(100*b/a);document.getElementById(d).style.width=a+"%";document.getElementById(c).innerHTML=a+"%"},hidePrevIcon:function(a){var b=document.getElementById(virtualclass.previous);
null!=b&&(b.style.display="none",console.log("Hide previous screen with display new "+a),"ss"==a?"object"==typeof virtualclass[a]&&(document.getElementById(virtualclass[a].id).style.display="block"):document.getElementById(virtualclass[a].id).style.display="block")},getUserInfo:function(a,b,d){for(var c=0;c<d.length;c++)if(d[c].userid==b)return d[c][a]},smallizeFirstLetter:function(a){return a.charAt(0).toLowerCase()+a.slice(1)},capitalizeFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},
initDefaultInfo:function(a,b){if("t"==a&&"Whiteboard"==b)roles.hasAdmin()||(virtualclass.wb.utility.setOrginalTeacherContent(),virtualclass.wb.attachToolFunction(vcan.cmdWrapperDiv,!0));else if("s"==a){vcan.studentId=wbUser.id;if(!roles.hasControls()){var d=localStorage.getItem("uRole");null!=d&&"e"==d&&(a="e");localStorage.setItem("uRole",a)}virtualclass.vutil.removeSessionTool()}virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable")||(virtualclass.gObj.video.init(),
virtualclass.gObj.video.isInitiator=!0);vcan.oneExecuted=!1},removeClassFromElement:function(a,b){if("t_reclaim"!=a){var d=document.getElementById(a);if(0<d.classList.length)return d.classList.remove(b),d.className;console.log("Whiteboard Tool class:- could not remove "+b)}},beforeSend:function(a,b,d){if(a.hasOwnProperty("createArrow"))a=JSON.stringify(a),virtualclass.wb.vcan.optimize.sendPacketWithOptimization(a,io.sock.readyState,100);else{if(a.hasOwnProperty("repObj")){if("undefined"==typeof a.repObj[a.repObj.length-
1])return;virtualclass.wb.gObj.rcvdPackId=a.repObj[a.repObj.length-1].uid;virtualclass.wb.gObj.displayedObjId=virtualclass.wb.gObj.rcvdPackId;console.log("Last send data "+virtualclass.wb.gObj.rcvdPackId)}JSON.stringify(a);"undefined"!=typeof d&&!0===d?"undefined"==typeof b||!1===b||null===b?ioAdapter.send(a):ioAdapter.sendUser(a,b):"undefined"==typeof b||!1===b||null===b?ioAdapter.mustSend(a):ioAdapter.mustSendUser(a,b)}},breakintobytes:function(a,b){for(var d=a.toString(),c=d.length;c<b;c++)d="0"+
d;return d.match(/[\S]{1,2}/g)||[]},createReclaimButton:function(a){this.createDiv("t_reclaim","educator",a);var b=this;document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",function(){b._reclaimRole()})},createDiv:function(a,b,d,c){var g=b;b=virtualclass.lang.getString(b);var h=document.createElement("a");h.href="#";var m=document.createElement("div");m.id=a;"undefined"!=typeof c&&(m.className=c);c=document.createElement("span");c.className="icon-"+g;h.appendChild(c);
h.dataset.title=b;h.className="tooltip";m.appendChild(h);"t_reclaim"==a?(a=document.getElementById(virtualclass.html.id),d.appendChild(m),a.insertBefore(d,a.firstChild)):d.appendChild(m)},assignRole:function(a){"object"==typeof virtualclass.wb&&(virtualclass.wb.tool="","move"==vcan.main.action&&virtualclass.wb.utility.deActiveFrmDragDrop());if("undefined"!=typeof a){if(roles.isEducator()){var b=document.getElementById(virtualclass.gObj.commandToolsWrapperId);b.parentNode.removeChild(b);virtualclass.vutil.removeClass("virtualclassCont",
"educator")}else virtualclass.vutil.addClass("virtualclassCont","presenter");virtualclass.gObj.uRole=roles.hasAdmin()?"t":"p";localStorage.setItem("uRole",virtualclass.gObj.uRole);virtualclass.user.assignRole(virtualclass.gObj.uRole,virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp),a);"object"==typeof virtualclass.wb&&vcan.utility.canvasCalcOffset(vcan.main.canid);"Yts"==virtualclass.currApp?(a=document.getElementById("virtualclassYts"),null!=a?null==document.getElementById("player")&&
virtualclass.yts.UI.createPlayerTag(a):virtualclass.yts.UI.container(),virtualclass.yts.UI.inputURL(),"object"==typeof virtualclass.yts.player?virtualclass.yts.seekChangeInterval():console.log("Player object is not ready")):"SharePresentation"==virtualclass.currApp&&(null!=document.getElementById("virtualclassSharePresentation")?null==document.getElementById("iframecontainer")&&virtualclass.sharePt.UI.createIframe():virtualclass.sharePt.UI.container(),roles.hasControls()&&virtualclass.sharePt.initTeacherLayout(),
roles.hasView()&&(virtualclass.sharePt.eventsObj=[]),virtualclass.sharePt.attachEvent("submitpurl","click",virtualclass.sharePt.initNewPpt))}else{"Yts"==virtualclass.currApp&&(virtualclass.yts.UI.removeinputURL(),virtualclass.yts.hasOwnProperty("tsc")&&clearInterval(virtualclass.yts.tsc));"SharePresentation"==virtualclass.currApp&&(roles.hasControls()&&virtualclass.sharePt.initStudentLayout(),roles.hasView()&&(virtualclass.sharePt.eventsObj=[],virtualclass.sharePt.hideElement("pptMessageLayout"),
virtualclass.sharePt.UI.createUrlContainer(),virtualclass.sharePt.displayElement("urlcontainer")),virtualclass.sharePt.attachEvent("submitpurl","click",virtualclass.sharePt.initNewPpt));virtualclass.gObj.uRole=roles.hasAdmin()?"e":"s";b=document.getElementById(virtualclass.gObj.commandToolsWrapperId);if(null!=b)for(;b.hasChildNodes();)b.removeChild(b.lastChild);else b=virtualclass.vutil.createCommandWrapper();"object"==typeof virtualclass.wb&&virtualclass.wb.utility.makeCanvasDisable();roles.hasAdmin()?
(document.getElementById("virtualclassCont"),virtualclass.vutil.createReclaimButton(b),virtualclass.vutil.addClass("virtualclassCont","educator")):(virtualclass.vutil.removeClass("virtualclassCont","presenter"),null!=b&&b.parentNode.removeChild(b));localStorage.setItem("uRole",virtualclass.gObj.uRole);"object"==typeof virtualclass.wb&&virtualclass.wb.utility.uniqueArrOfObjsToStudent()}virtualclass.system.setAppDimension();virtualclass.vutil.renderWhiteboardObjectsIfAny();roles.hasAdmin()?virtualclass.uInfo.userobj.role=
virtualclass.gObj.uRole:(io.disconnect(),setTimeout(function(){virtualclass.uInfo.userobj.role=virtualclass.gObj.uRole;io.init(virtualclass.uInfo)},500))},renderWhiteboardObjectsIfAny:function(){"object"==typeof virtualclass.wb&&0<virtualclass.wb.vcan.main.children.length&&virtualclass.wb.vcan.renderAll()},createCommandWrapper:function(){var a=document.createElement("div");a.id=virtualclass.gObj.commandToolsWrapperId;var b=document.getElementById(vcan.canvasWrapperId);null!=b?document.getElementById("containerWb").insertBefore(a,
b):document.getElementById("containerWb").appendChild(a);return a},_reclaimRole:function(){virtualclass.vutil.beforeSend({reclaimRole:!0,cf:"reclaimRole"});var a=document.getElementById("t_reclaim");a.style.pointerEvents="none";a.style.opacity="0.5";var b=this;setTimeout(function(){b.reclaimRole();virtualclass.user.control.changeAttrToAssign("enable")},2E3)},reclaimRole:function(){virtualclass.gObj.controlAssign=!1;this.vcResponseAssignRole(virtualclass.gObj.uid,virtualclass.gObj.uid,!0)},vcResponseAssignRole:function(a,
b,d){if(a!=b||"undefined"!=typeof d)if(virtualclass.vutil.assignRole(b),"object"==typeof virtualclass.wb&&virtualclass.wb.utility.uniqueArrOfObjsToTeacher(),roles.hasAdmin())a=document.getElementById("chat_div").getElementsByClassName("currTeacher")[0],null!=a&&virtualclass.user.control.removeCurrTeacherFromControl(a.id),virtualclass.user.control.changeAttrToAssign("enable");else{virtualclass.vutil.removeSessionTool();b=document.getElementById("ml"+a);d=["assign"];var c=document.getElementById(a+
"ControlContainer");null!=c?virtualclass.user.createAssignControl(c,a,!0):(d=virtualclass.user.createControl(a,d),b.appendChild(d));localStorage.setItem("aId",a)}virtualclass.vutil.attachClickOutSideCanvas();"mobTab"==virtualclass.system.device&&(virtualclass.vutil.disableVirtualClass(),virtualclass.view.createErrorMsg(virtualclass.lang.getString("supportDesktop"),"errorContainer","chatWidget"))},vcResponseAReclaimRole:function(a,b){console.log("Reclaim role :- Init");if(a!=b){if("object"==typeof virtualclass.wb){var d=
virtualclass.wb.vcan.main.replayObjs[virtualclass.wb.vcan.main.replayObjs.length-1];if("object"==typeof d&&"del"==d.ac)console.log("Delete command:- Transferring the delete command"),virtualclass.vutil.beforeSend({repObj:[d],cf:"repObj"});else if("t_text"==virtualclass.wb.tool.cmd&&"create"==virtualclass.wb.vcan.main.action)virtualclass.wb.obj.drawTextObj.finalizeTextIfAny(!0),console.log("Text command:- Transferring text command");else if(virtualclass.wb.tool.hasOwnProperty("started")&&!0==virtualclass.wb.tool.started||
"move"==virtualclass.wb.vcan.main.action)d=vcan.extend({},virtualclass.wb.vcan.main.replayObjs[virtualclass.wb.vcan.main.replayObjs.length-1]),d.ac="u",d=d.hasOwnProperty("mtext")?{detail:{cevent:{x:d.x,y:d.y,mtext:d.mtext}}}:{detail:{cevent:{x:d.x,y:d.y}}},d.detail.broadCast=!0,d=new CustomEvent("mouseup",d),vcan.main.canvas.dispatchEvent(d),console.log("Whiteboard:- Transfering the assign role to Teacher");console.log("Role assign with reclaim")}virtualclass.user.control._assign(b,"notsent",a);
console.log("Reclaim role :- peforme");virtualclass.user.displayStudentSpeaker(!0);null!=localStorage.getItem("aId")&&localStorage.removeItem("aId");virtualclass.user.control.removeAudioFromParticipate(a);"mobTab"==virtualclass.system.device&&((virtualclass.system.mybrowser.name=8<=virtualclass.system.mybrowser.version)&&/(iPad)/g.test(navigator.userAgent)&&virtualclass.vutil.enableVirtualClass(),virtualclass.view.removeErrorMsg("errorContainer",!0))}},createReclaimButtonIfNeed:function(){if(roles.isEducator()){var a=
virtualclass.vutil.createCommandWrapper();virtualclass.vutil.createReclaimButton(a);return!0}return!1},whoIsTeacher:function(){if(virtualclass.hasOwnProperty("connectedUsers"))for(var a=0;a<virtualclass.connectedUsers.length;a++)if("t"==virtualclass.connectedUsers[a].role||"e"==virtualclass.connectedUsers[a].role)return virtualclass.connectedUsers[a].userid;return 0},enablePresentatorEditors:function(a){a={toUser:a,status:!0};virtualclass.user.control.received_editorRich(a);virtualclass.user.control.received_editorCode(a)},
getClassName:function(a){var b;"t"==a?b="teacher":"e"==a?b="educator":"s"==a?b="student":"p"==a&&(b="presenter");return b},isPresenterExist:function(){for(var a=0;a<virtualclass.connectedUsers.length;a++)if("p"==virtualclass.connectedUsers[a].role)return!0;return!1},setReadModeWhenTeacherIsDisConn:function(a){if(!roles.hasAdmin()){var b=localStorage.getItem("oTDisconn");null!=b&&((b=JSON.parse(b))?virtualclass.hasOwnProperty(a)?"object"==typeof virtualclass[a].cm?virtualclass[a].cm.setOption("readOnly",
"nocursor"):console.log("Editor CM is not defined for editor "+a):console.log("Editor type "+a+" is not ready."):console.log("Teacher is connected."))}},setReadModeWhenTeacherIsConn:function(a){localStorage.removeItem("oTDisconn");var b=document.getElementById(virtualclass.vutil.capitalizeFirstLetter(a)+"writeModeBox");null!=b?"true"==b.getAttribute("data-write-mode")?virtualclass[a].cm.setOption("readOnly",!1):virtualclass[a].cm.setOption("readOnly","nocursor"):console.log("Editor:- writemode element is not found for "+
a)},isTeacherAlreadyExist:function(a){if(virtualclass.hasOwnProperty("connectedUsers"))for(var b=0;b<virtualclass.connectedUsers.length;b++)if(("t"==virtualclass.connectedUsers[b].role||"e"==virtualclass.connectedUsers[b].role)&&virtualclass.connectedUsers[b].userid!=a)return console.log("joni Id "+a),!0;return!1},isPresenterAlreadyExist:function(a){if(virtualclass.hasOwnProperty("connectedUsers"))for(var b=0;b<virtualclass.connectedUsers.length;b++)if("p"==virtualclass.connectedUsers[b].role&&virtualclass.connectedUsers[b].userid!=
a)return console.log("joniId "+a),!0;return!1},getPresenterId:function(){if(virtualclass.hasOwnProperty("connectedUsers"))for(var a=0;a<virtualclass.connectedUsers.length;a++)if("p"==virtualclass.connectedUsers[a].role)return virtualclass.connectedUsers[a].userid;return!1},isEducatorAlreadyExist:function(a){if(virtualclass.hasOwnProperty("connectedUsers"))for(var b=0;b<virtualclass.connectedUsers.length;b++)if("e"==virtualclass.connectedUsers[b].role&&virtualclass.connectedUsers[b].userid!=a)return console.log("joniId "+
a),!0;return!1},isOrginalTeacherExist:function(a){if(virtualclass.hasOwnProperty("connectedUsers"))for(var b=0;b<virtualclass.connectedUsers.length;b++)if("t"==virtualclass.connectedUsers[b].role&&virtualclass.connectedUsers[b].userid!=a)return console.log("joniId "+a),!0;return!1},getMySetTime:function(a){for(var b=0;b<a.length;b++)if(a[b].userid==virtualclass.gObj.uid)return 180*(b+1)+2E3;return 2300},createBecomeTeacherWidget:function(){if(null==document.getElementById("beTeacher")){var a=document.createElement("div");
a.id="beTeacher";var b=document.createElement("a");b.id=a.id+"Anchor";b.innerHTML=virtualclass.lang.getString("becomeTeacher");a.appendChild(b);b=document.getElementById("virtualclassCont");b.insertBefore(a,b.firstChild);a.addEventListener("click",virtualclass.vutil.initTeacherRole);a.style.pointerEvents="none";a.style.opacity="0.5";setTimeout(function(){a.style.pointerEvents="visible";a.style.opacity="1"},6E4)}},removeBecomeTeacherWidget:function(){var a=document.getElementById("beTeacher");null!=
a&&a.parentNode.removeChild(a)},initTeacherRole:function(){ioAdapter.send({cf:"bt"});virtualclass.vutil.removeBecomeTeacherWidget();setTimeout(function(){virtualclass.vutil.isOrginalTeacherExist(virtualclass.jId)?console.log("Already connected teacher"):(virtualclass.vutil.overrideRoles("t"),localStorage.setItem("beTeacher",!0),console.log("connected teacher"));c.location.reload()},virtualclass.gObj.mySetTime)},overrideRoles:function(a){virtualclass.uInfo.userobj.role=a;virtualclass.gObj.uRole=virtualclass.uInfo.userobj.role;
wbUser.role=virtualclass.uInfo.userobj.role;var b=document.getElementById("virtualclassCont");virtualclass.vutil.overrideRolesFromElem(b,a)},overrideRolesFromElem:function(a,b){"s"==b?(a.classList.remove("teacher"),a.classList.remove("orginalTeacher"),a.classList.remove("presenter"),a.classList.remove("educator"),virtualclassCont.classList.add("student")):"p"==b?(a.classList.remove("teacher"),a.classList.remove("orginalTeacher"),a.classList.remove("educator"),virtualclassCont.classList.add("student"),
virtualclassCont.classList.add("presenter")):"e"==b?(a.classList.add("teacher"),a.classList.remove("student"),a.classList.remove("presenter"),a.classList.add("educator"),a.classList.add("orginalTeacher")):"t"==b&&(a.classList.remove("student"),a.classList.remove("educator"),a.classList.remove("presenter"),a.classList.add("teacher"),a.classList.add("orginalTeacher"),console.log("add Teacher"))},sesionEndMsgBoxIsExisting:function(){var a=document.getElementById("sessionEndMsgCont");return a.hasAttribute("data-displaying")&&
"true"==a.dataset.displaying}}})(window);(function(c){var a,b,d,f,g,h;c.studentScreen=function(){return{ssProcess:function(a,b,d,c){var f=a[0];a=new Uint8ClampedArray(b);var g,h,r,s;switch(f){case 102:case 202:r=virtualclass.vutil.numValidateTwo(a[1],a[2]);h=virtualclass.vutil.numValidateTwo(a[3],a[4]);b=a.subarray(5,a.length);this.initStudentScreen(b,{w:r,h:h},d,c);break;case 103:case 203:b=7;for(r=0;r+7<=a.length;r=s+1)f=virtualclass.vutil.numValidateTwo(a[r+1],a[r+2]),g=virtualclass.vutil.numValidateTwo(a[r+3],a[r+4]),h=parseInt(a[r+
5]),r=parseInt(a[r+6]),s=b+h*r-1,b=a.subarray(b,s+1),this.initStudentScreen(b,{x:f,y:g,w:r,h:h},d,c),b=s+7+1;break;case 104:case 204:f=virtualclass.vutil.numValidateTwo(a[1],a[2]),g=virtualclass.vutil.numValidateTwo(a[3],a[4]),h=virtualclass.vutil.numValidateTwo(a[5],a[6]),r=virtualclass.vutil.numValidateTwo(a[7],a[8]),b=a.subarray(9,a.length),a={d:{w:f,h:g},vc:{w:h,h:r}},this.initStudentScreen(b,a,d,c)}},initStudentScreen:function(a,d,c,f){virtualclass.vutil.addClass("audioWidget","fixed");g=c;c=
document.getElementById("virtualclass"+virtualclass.apps[1]);"object"!=typeof virtualclass[g]||null==c?("undefined"!=typeof vtype&&(virtualclass.recorder.recImgPlay=!0),virtualclass.makeAppReady(f)):(virtualclass.currApp=f,virtualclass.vutil.hidePrevIcon(g));if(d.hasOwnProperty("d"))virtualclass[g].dimensionStudentScreenResize(d),h=!0,virtualclass[g].drawImages(a);else{if("undefined"==typeof h||"undefined"!=typeof b&&b!=d.w&&!d.hasOwnProperty("x"))h=!0,virtualclass[g].dimensionStudentScreen(d.w,d.h),
b=d.w;d.hasOwnProperty("x")?virtualclass[g].drawImages(a,d):(d.hasOwnProperty("w")&&(virtualclass[g].localCanvas.width=d.w,virtualclass[g].localCanvas.height=d.h),virtualclass[g].drawImages(a))}virtualclass.previous=virtualclass[g].id}}};c.screenShare=function(b){virtualclass.getSceenFirefox=function(){var a=parseInt(c.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);33<=a?(virtualclass.adpt=new virtualclass.adapter,virtualclass.adpt.init(navigator).getUserMedia({video:{mozMediaSource:"window",mediaSource:"window"}},
function(a,b){virtualclass.ss._init();if(roles.hasControls()){if(virtualclass.ss.initializeRecorder.call(virtualclass.ss,a),"undefined"==typeof b)var d=a.currentTime,f=c.setInterval(function(){a||c.clearInterval(f);if(a.currentTime==d&&(c.clearInterval(f),a.onended))a.onended();d=a.currentTime},500)}else console.log("Set previous app as current app if teacher reclaim role during screen share"),virtualclass.ss.setCurrentApp()},function(a){virtualclass.ss.setCurrentApp();"string"==typeof a?"PERMISSION_DENIED"===
a&&c.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus():"object"==typeof a&&("PermissionDeniedError"!==a.name&&"SecurityError"!=a.name||c.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus())})):alert(virtualclass.lang.getString("notSupportBrowser",[a]))};return{prevStream:!1,init:function(a){this.type=a.type;this.ssByClick=!0;this.manualStop=!1;roles.hasControls()&&!virtualclass.recorder.recImgPlay?this.readyTostart(a.app):this._init()},_init:function(){this.currApp=
this.tempCurrApp;document.getElementById("virtualclassCont").dataset.currapp=virtualclass.currApp;virtualclass.previous!=b.id&&(document.getElementById(virtualclass.previous).style.display="none",virtualclass.previous=b.id);var a=document.getElementById(b.id);null!=a&&(a.style.display="block");if(!this.hasOwnProperty("id")){this.dc=virtualclass.dirtyCorner;this.postFix="Cont";this.id=b.hasOwnProperty("id")?b.id:"virtualclassScreenShare";this.className="virtualclass";this.label="Local";this.local=
this.id+this.label;this.localTemp=this.id+this.label+"Temp";this.classes=b.hasOwnProperty("class")?b.classes:"";this.initPrevImage();a=document.getElementById(this.id);null!=a&&a.parentNode.removeChild(a);var a=this.html.UI.call(this,virtualclass.gObj.uRole),d=document.getElementById(virtualclass.rWidgetConfig.id);document.getElementById(virtualclass.html.id).insertBefore(a,d);roles.hasControls()&&!virtualclass.recorder.recImgPlay&&virtualclass.vutil.initLocCanvasCont(this.localTemp+"Video")}},readyTostart:function(a){a==
virtualclass.apps[1]&&this.getScreen()},onError:function(a){virtualclass.ss.setCurrentApp();console.log("Error "+a)},getScreen:function(a){"Chrome"==virtualclass.system.mybrowser.name?virtualclass.gObj.hasOwnProperty("ext")&&virtualclass.gObj.ext?c.postMessage({type:"getScreen",id:1},"*"):chrome.webstore.install("https://chrome.google.com/webstore/detail/ijhofagnokdeoghaohcekchijfeffbjl",function(){c.location.reload()},function(a){alert(a)}):"Firefox"==virtualclass.system.mybrowser.name&&virtualclass.getSceenFirefox()},
unShareScreen:function(){this.video.src="";this.localtempCont.clearRect(0,0,this.localtempCanvas.width,this.localtempCanvas.height);clearInterval(virtualclass.clear);this.initPrevImage();this.hasOwnProperty("currentStream")&&this.currentStream.getTracks()[0].stop();virtualclass.vutil.beforeSend({unshareScreen:!0,st:this.type,cf:"unshareScreen"})},removeStream:function(){virtualclass.vutil.removeClass("audioWidget","fixed");this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height)},
initializeRecorder:function(b){virtualclass.vutil.addClass("audioWidget","fixed");a=1;this.prevStream&&(this.ssByClick=!1);"undefined"!=typeof virtualclass.prevScreen&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&virtualclass.prevScreen.unShareScreen();this.video=document.getElementById(this.local+"Video");if("VIDEO"!=this.video.tagName){var d=this.video,f=document.createElement("video");f.id=d.id;this.video.parentNode.replaceChild(f,this.video);this.video=document.getElementById(this.local+
"Video");this.video.autoplay=!0;virtualclass.vutil.createLocalTempVideo("virtualclassScreenShare",this.local+"Temp");virtualclass.vutil.initLocCanvasCont(this.local+"TempVideo")}this.currentStream=b;var g=this;virtualclass.adpt.attachMediaStream(this.video,b);this.prevStream=!0;this.currentStream.onended=function(a){g.ssByClick?(g.video.src="",g.localtempCont.clearRect(0,0,g.localtempCanvas.width,g.localtempCanvas.height),clearInterval(virtualclass.clear),g.initPrevImage(),virtualclass.vutil.beforeSend({unshareScreen:!0,
st:g.type,cf:"unshareScreen"}),g.prevStream=!1,g.prevScreen="",virtualclass.prevScreen=""):g.ssByClick=!0};b={};b.width=c.innerWidth;b.height=c.innerHeight-140;var d=document.getElementById(this.local),h=this.html.getDimension(b);d.style.width=Math.round(h.width)+"px";d.style.height=Math.round(h.height)+"px";g=this;this.video.onloadedmetadata=function(){g.width=h.width;g.height=h.height;g.localtempCanvas.width=g.video.offsetWidth;g.localtempCanvas.height=g.video.offsetHeight;virtualclass.prevScreen=
g;var a=virtualclass.system.measureResoultion({width:c.innerWidth,height:c.innerHeight});g.sharing();virtualclass.vutil.setContainerWidth(a,virtualclass.currApp);roles.hasControls()&&(virtualclass.vutil.makeActiveApp(g.id,virtualclass.previrtualclass),"virtualclassYts"==virtualclass.previrtualclass&&virtualclass.yts.destroyYT());virtualclass.previrtualclass=g.id}},sharing:function(){function b(a,d){for(var c=a.toString(),f=c.length;f<d;f++)c="0"+c;return c.match(/[\S]{1,2}/g)||[]}function g(){clearInterval(virtualclass.clear);
if("undefined"!=typeof d&&"undefined"!=typeof f){if(d!=s.video.offsetWidth||f!=s.video.offsetHeight)a=1}else d=s.video.offsetWidth,f=s.video.offsetHeight;1==a?setTimeout(m,2E3):t(s.type)}function h(a){switch(!0){case 300>=a||"undefined"==typeof a:v=300;break;case 3E3>=a:v=a;break;case 5E3>=a:v=3E3;break;default:v=5E3}}function m(){console.log("RESIZE");if(roles.hasControls()){d=s.video.offsetWidth;f=s.video.offsetHeight;x=Math.round(s.localtempCanvas.height/12);r=Math.round(s.localtempCanvas.width/
12);var w=s.type;s.localtempCanvas.width=s.video.offsetWidth;s.localtempCanvas.height=s.video.offsetHeight;s.localtempCont.drawImage(s.video,0,0,s.video.offsetWidth,s.video.offsetHeight);var t=s.localtempCont.getImageData(0,0,s.localtempCanvas.width,s.localtempCanvas.height),t=s.dc.encodeRGB(t.data),J=Math.round(s.localtempCanvas.width/r),L=Math.round(s.localtempCanvas.height/x),C,R,A,T;T=s.getContainerDimension();"undefined"!=typeof d&&"undefined"!=typeof f?(C=b(d,4),R=b(f,4)):(C=b(s.video.offsetWidth,
4),R=b(s.video.offsetHeight,4));A=b(T.width,4);T=b(T.height,4);w=new Uint8ClampedArray(["ss"==w?104:204,C[0],C[1],R[0],R[1],A[0],A[1],T[0],T[1]]);C=new Uint8ClampedArray(t.length+w.length);C.set(w);C.set(t,w.length);c.Worker&&sworker.postMessage({img:t,resize:1,resA:x,resB:r,dw:J,dh:L,offsetWidth:s.video.offsetWidth,offsetHeight:s.video.offsetHeight},[t.buffer]);ioAdapter.sendBinary(C);h(C.length/128);a=0;clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,v)}}function t(a){s.localtempCanvas.width=
s.video.offsetWidth;s.localtempCanvas.height=s.video.offsetHeight;s.localtempCont.drawImage(s.video,0,0,s.video.offsetWidth,s.video.offsetHeight);a=Math.round(s.localtempCanvas.width/r);var b=Math.round(s.localtempCanvas.height/x),d=s.localtempCont.getImageData(0,0,s.video.offsetWidth,s.video.offsetHeight);c.Worker&&(sworker.postMessage({img:d.data,resA:x,resB:r,dw:a,dh:b,offsetWidth:s.video.offsetWidth,offsetHeight:s.video.offsetHeight,type:s.type},[d.data.buffer]),sworker.onmessage=function(a){if(1==
a.data.needFullScreen){a=virtualclass.getDataFullScreen(s.type);ioAdapter.sendBinary(a);var b=a.length/128}else null!=a.data.masterSlice&&(ioAdapter.sendBinary(a.data.masterSlice),b=a.data.masterSlice.length/128);h(b);clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,v)});clearInterval(virtualclass.clear)}var x=Math.round(this.localtempCanvas.height/12),r=Math.round(this.localtempCanvas.width/12),s=this;virtualclass.hasOwnProperty("wholeImage")&&clearInterval(virtualclass.wholeImage);
virtualclass.hasOwnProperty("clear")&&clearInterval(virtualclass.clear);var v=1E3;virtualclass.getDataFullScreen=function(a){s.localtempCanvas.width=s.video.offsetWidth;s.localtempCanvas.height=s.video.offsetHeight;s.localtempCont.drawImage(s.video,0,0,s.video.offsetWidth,s.video.offsetHeight);var d=s.localtempCont.getImageData(0,0,s.localtempCanvas.width,s.localtempCanvas.height),d=s.dc.encodeRGB(d.data),c=b(s.localtempCanvas.height,4),f=b(s.localtempCanvas.width,4);a=new Uint8ClampedArray(["ss"==
a?102:202,f[0],f[1],c[0],c[1]]);c=new Uint8ClampedArray(d.length+a.length);c.set(a);c.set(d,a.length);return c};clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,v)},getContainerDimension:function(){var a=document.getElementById(this.id+"Local");return{width:a.offsetWidth,height:a.offsetHeight}},drawImages:function(a,b){if("undefined"!=typeof b){var d=this.dc.decodeRGBSlice(a,this.localCont,b);this.localCont.putImageData(d,b.x,b.y)}else d=this.dc.decodeRGB(a,this.localCont,this.localCanvas),
this.localCont.putImageData(d,0,0)},drawSingleImage:function(a){a=this.dc.decodeRGB(a,this.localCont,this.localCanvas);this.localCont.putImageData(a,0,0)},dimensionStudentScreen:function(a,b){this.localCanvas=document.getElementById(virtualclass[g].local+"Video");this.localCont=virtualclass[g].localCanvas.getContext("2d");this.localCanvas.width=a;this.localCanvas.height=b;console.log("normal width "+this.localCanvas.width)},dimensionStudentScreenResize:function(a,b){this.hasOwnProperty("vac")||(this.vac=
!0,this.localCanvas=document.getElementById(virtualclass[g].local+"Video"),this.localCont=virtualclass[g].localCanvas.getContext("2d"));a.hasOwnProperty("d")&&(this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height),this.localCanvas.width=a.d.w,this.localCanvas.height=a.d.h);if(a.hasOwnProperty("vc")){var d=document.getElementById(virtualclass[g].local);d.style.width=a.vc.w+"px";d.style.height=a.vc.h+"px"}"virtualclassScreenShare"==virtualclass.previous&&virtualclass.vutil.setScreenInnerTagsWidth(virtualclass.previous)},
html:{UI:function(a){a=virtualclass.vutil.createDOM("div",this.id,[this.className]);var b=virtualclass.vutil.createDOM("div",this.local,[this.label]);if(roles.hasControls()){if(virtualclass.recorder.recImgPlay)var d=virtualclass.vutil.createDOM("canvas",this.local+"Video");else d=virtualclass.vutil.createDOM("video",this.local+"Video"),d.setAttribute("autoplay",!0);b.style.cssText+=";position:relative"}else d=virtualclass.vutil.createDOM("canvas",this.local+"Video");b.appendChild(d);a.appendChild(b);
roles.hasControls()&&!virtualclass.recorder.recImgPlay&&virtualclass.vutil.createLocalTempVideo(a,this.localTemp);return a},getDimension:function(a,b){return{height:a.height,width:a.width}}},initPrevImage:function(){sworker.postMessage({initPrevImg:!0})},setCurrentApp:function(){virtualclass.hasOwnProperty("previousApp")&&"object"==typeof virtualclass.previousApp&&(virtualclass.currApp=virtualclass.previousApp.name,document.getElementById("virtualclassCont").dataset.currapp=virtualclass.currApp)}}}})(window);(function(c){function a(a){document.body.removeChild(a.target)}var b,d={},f=1,g=1,h="VCE4 VCE5 VCE6 invalidcmid cmidmissing nomdlroot usermissing cnmissing sesseionkeymissing recorddatamissing keymissing invalidurl".split(" "),m={items:[],recImgPlay:!1,objn:0,playTimeout:"",totalSent:0,fileQueue:[],rnum:1,storeDone:0,emn:0,allFileFound:!1,waitServer:!1,waitPopup:!1,tempRecData:[],alreadyAskForPlay:!1,playStart:!1,error:0,mkDownloadLink:"",tillPlayTime:0,getPlayTotTime:!1,importfilepath:c.importfilepath,
exportfilepath:c.exportfilepath,sessionKey:randomString(11),alreadyDownload:!1,smallData:!1,uploadInProcess:!1,init:function(a){var d=virtualclass.wb.vcan;if("undefined"!=typeof myfunc)this.objs=d.getStates("replayObjs");else{var c=this;if("fromplay"==a)virtualclass.storage.getAllObjs(["allData"],function(){c.play()});else{for(var d=this.hasOwnProperty("prvNum")?this.prvNum:0,f=0;f<a.length;f++)this.items.push(a[f]);for(k=0;k<a.length;k++){if(a[k].hasOwnProperty("bd"))for("a"==a[k].bd?b=virtualclass.dtCon.base64DecToArrInt(a[k].recObjs):
"c"==a[k].bd&&(b=virtualclass.dtCon.base64DecToArrclm(a[k].recObjs)),this.items[d].recObjs=b,f=0;f<b.length;f++)this.items[d].recObjs[f]=b[f];d++}this.hasOwnProperty("prvNum")||c.play();this.prvNum=d}}},initMakeAvailDownloadFile:function(){virtualclass.gObj.downloadProgress=!0;virtualclass.recorder.dataCame=setTimeout(function(){virtualclass.recorder.hasOwnProperty("recordDone")&&(virtualclass.recorder.alreadyDownload||(console.log("Recorder:- From Interval"),virtualclass.recorder.makeAvailDownloadFile()),
clearTimeout(virtualclass.recorder.dataCame))},1500)},replayFromStart:function(){var a=[],a=this.items;virtualclass.storage.config.endSession();virtualclass.popup.closeElem();disCommonChatInput();this.recImgPlay=!1;this.objn=0;this.playTimeout="";this.totalSent=0;this.fileQueue=[];this.rnum=1;this.emn=this.storeDone=0;this.waitPopup=this.waitServer=!1;this.tempRecData=[];this.playStart=this.alreadyAskForPlay=!1;this.error=0;this.mkDownloadLink="";this.tillPlayTime=0;this.getPlayTotTime=!1;this.controller.ff=
1;this.items=a;this.playProgressBar();this.play()},startUploadProcess:function(){virtualclass.recorder.startUpload=!0;virtualclass.recorder.uploadInProcess=!0;virtualclass.recorder.exportData(function(){});virtualclass.popup.sendBackOtherElems()},exportData:function(a){virtualclass.popup.openProgressBar();virtualclass.recorder.items=[];virtualclass.storage.getAllObjs(["allData"],function(){"function"==typeof a&&a()})},convertInto:function(a){if("string"==typeof a.data)return a;a.data=a.data.buffer;
return a},clearPopups:function(){virtualclass.popup.closeElem();virtualclass.pbar.renderProgressBar(0,0,"progressBar","progressValue");virtualclass.storage.config.endSession()},playProgressBar:function(){this.getPlayTotTime||(this.totPlayTime=this.items.reduce(function(a,b){return b.hasOwnProperty("playTime")?{playTime:a.playTime+b.playTime}:a.playTime}),this.getPlayTotTime=!0);if(0<this.tillPlayTime){this.tillPlayTime>this.totPlayTime&&(this.tillPlayTime=this.totPlayTime);virtualclass.pbar.renderProgressBar(this.totPlayTime,
this.tillPlayTime,"playProgressBar",void 0);var a=this.convertIntoReadable(this.tillPlayTime);document.getElementById("tillRepTime").innerHTML=a.m+" : "+a.s;"undefined"==typeof alreadyCalcTotTime&&(a=this.convertIntoReadable(this.totPlayTime),document.getElementById("totalRepTime").innerHTML=a.m+" : "+a.s,alreadyCalcTotTime=!0)}else virtualclass.pbar.renderProgressBar(this.totPlayTime,0,"playProgressBar",void 0)},convertIntoReadable:function(a){a/=1E3;return{s:Math.floor(a%60),m:Math.floor(a/60)}},
xhrsenddata:function(a,b,d){"undefined"!=typeof b&&(virtualclass.recorder.error=1);"undefined"!=typeof d&&(virtualclass.recorder.mkDownloadLink=d);if(1!=virtualclass.recorder.storeDone){"undefined"!=typeof earlierTimeout&&clearTimeout(earlierTimeout);if("undefined"==typeof a||""==a)a="first";virtualclass.recorder.rnum=a;virtualclass.storage.getrowData(["chunkData"],function(a,b){1==g&&a.hasOwnProperty("rdata")&&(virtualclass.recorder.rdlength=a.rdata.length);if("string"==typeof a||"undefined"==typeof a)earlierTimeout=
setTimeout(function(){virtualclass.recorder.xhrsenddata(virtualclass.recorder.rnum)},1E3);else if(a.hasOwnProperty("status")&&"done"==a.status)console.log("should invoked download function on "),virtualclass.recorder.storeDone=1,console.log("From here actuall recorder finished"),"undefined"!=typeof virtualclass.recorder.mkDownloadLink&&""!=virtualclass.recorder.mkDownloadLink?virtualclass.recorder.mkDownloadLink():setTimeout(function(){virtualclass.recorder.afterRecording()},1E3);else if("undefined"!=
typeof b&&(virtualclass.recorder.rnum=b),1==virtualclass.recorder.error)0==virtualclass.recorder.storeDone&&(virtualclass.recorder.xhrsenddata(virtualclass.recorder.rnum,"error"),virtualclass.recorder.rnum++);else{var d=new FormData;d.append("record_data",JSON.stringify(a));d.append("user",virtualclass.gObj.uid);d.append("cn",g);d.append("sesseionkey",virtualclass.recorder.sessionKey);virtualclass.recorder.items=[];virtualclass.xhr.send(d,importfilepath,function(b){"done"===b?(virtualclass.pbar.renderProgressBar(a.totalStore,
a.totalSent,"progressBar","progressValue"),virtualclass.recorder.rnum++,g++,virtualclass.recorder.xhrsenddata(virtualclass.recorder.rnum)):"ERROR"===b?virtualclass.recorder.initMakeAvailDownloadFile():0<=h.indexOf(b)?(alert(virtualclass.lang.getString(b)),virtualclass.recorder.initMakeAvailDownloadFile()):console.log("Error message not found")})}},virtualclass.recorder.rnum)}},uploadFinishedBox:function(){document.getElementById("recordFinishedMessageBox").style.display="block";this.initRecordFinishEvent("recordingClose")},
initRecordFinishEvent:function(a){var b=document.getElementById("recordingHeader");b.innerHTML="";b.parentNode.classList.add("removeHeader");virtualclass.recorder.doSessionClear=!0;document.getElementById(a).addEventListener("click",function(){virtualclass.recorder.uploadInProcess=!1;setTimeout(function(){delete virtualclass.recorder.doSessionClear;document.getElementById("progressContainer").style.display="block";document.getElementById("recordFinishedMessageBox").style.display="none";b.innerHTML=
virtualclass.lang.getString("uploadsession");b.parentNode.classList.remove("removeHeader");virtualclass.recorder.startNewSessionAfterFinish();console.log("Socket "+io.sock.readyState);io.disconnect();setTimeout(function(){1!=io.sock.readyState&&io.wsconnect()},1500)},300)})},startNewSessionAfterFinish:function(){var a=document.getElementById("recordingContainer");a.classList.add("recordingFinished");console.log("Record :- after recording");virtualclass.clearSession();virtualclass.pbar.renderProgressBar(0,
0,"progressBar","progressValue");virtualclass.pbar.renderProgressBar(0,0,"indProgressBar","indProgressValue");a.classList.remove("recordingFinished")},afterRecording:function(){g=1;virtualclass.recorder.rdlength=0;document.getElementById("progressContainer").style.display="none";virtualclass.recorder.uploadFinishedBox()},makeAvailDownloadFile:function(){console.log("Recorder:- DOWNLLOAD MESSAGE");var b=document.getElementById("recordingContainer"),d=c.getComputedStyle(b).display;"none"!=d&&"block"==
d||setTimeout(function(){virtualclass.popup.openProgressBar();io.disconnect()},3E3);var f=document.getElementById("downloadFileCont");null==f&&(f=document.createElement("div"),f.id="downloadFileCont");var g=document.createElement("div");g.id="errormsessage";g.innerHTML=virtualclass.lang.getString("msgForDownloadStart");var h=document.getElementById("progressContainer");h.style.display="none";f.appendChild(g);b.appendChild(f);this.alreadyDownload=!0;virtualclass.storage.getAllDataForDownload(["chunkData"],
function(b){virtualclass.gObj.saveSession=!0;var d=document.createElement("button");d.id="downloadButton";d.innerHTML=virtualclass.lang.getString("downloadFile");var m=document.createElement("a");m.id="dlink";m.href="";m.download="session.vcp";m.innerHTML=virtualclass.lang.getString("download");g.innerHTML=virtualclass.lang.getString("filenotsave");f.appendChild(d);var n=document.getElementById("recordingHeader");n.innerHTML=virtualclass.lang.getString("downloadFile");var q=new Blob([b],{type:"application/virtualclass"});
virtualclass.hasOwnProperty("prevScreen")&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&virtualclass.prevScreen.unShareScreen();d.addEventListener("click",function(){null!=c.webkitURL?m.href=c.webkitURL.createObjectURL(q):(m.href=c.URL.createObjectURL(q),m.onclick=a,document.body.appendChild(m));m.click();n=document.getElementById("recordingHeader");n.innerHTML=virtualclass.lang.getString("uploadsession");f.parentNode.removeChild(f);h.style.display="block";virtualclass.recorder.hasOwnProperty("dataCame")&&
clearTimeout(virtualclass.recorder.dataCame);virtualclass.clearSession();delete virtualclass.gObj.saveSession;io.disconnect();io.init(virtualclass.uInfo)})})},sendDataToServer:function(){virtualclass.storage.db.transaction(["chunkData"],"readwrite").objectStore("chunkData").clear();virtualclass.popup.waitBlockAction("none");c.Worker&&(mvDataWorker.postMessage({rdata:virtualclass.recorder.items,makeChunk:!0}),mvDataWorker.onmessage=function(a){a.data.hasOwnProperty("done_problem")?console.log("done problem"):
a.data.hasOwnProperty("status")&&"done"==a.data.status&&(console.log("Recorder:- done"),delete virtualclass.recorder.startUpload,virtualclass.recorder.recordDone=!0);virtualclass.storage.chunkStorage(a.data)})},displayWaitPopupIfNot:function(){!1==this.waitPopup&&(virtualclass.popup.sendBackOtherElems(),document.getElementById("recordingContainer").style.display="none",virtualclass.popup.waitBlockAction("block"),virtualclass.pbar.renderProgressBar(0,0,"downloadProgressBar","downloadProgressValue"),
virtualclass.popup.waitBlock(),this.waitPopup=!0)},requestDataFromServer:function(a,b){this.displayWaitPopupIfNot(virtualclass.lang.getString("plswaitwhile"));var d=new FormData;d.append("prvfile",b);d.append("fileBundelId",a);var c=getUrlVars(exportfilepath);c.hasOwnProperty("cmid")&&d.append("id",c.cmid);virtualclass.xhr.send(d,exportfilepath,function(b){virtualclass.recorder.sendToWorker(b,a)})},sendToWorker:function(a,b){c.Worker&&(mvDataWorker.postMessage({rdata:a,getData:!0}),mvDataWorker.onmessage=
function(a){f++;var d=virtualclass.recorder.isUptoBaseValue(a.data.alldata.totalSent,a.data.alldata.totalStore,30);virtualclass.recorder.ctotalStore=a.data.alldata.totalStore;virtualclass.recorder.ctotalSent=a.data.alldata.totalSent;virtualclass.pbar.renderProgressBar(a.data.alldata.totalStore,a.data.alldata.totalSent,"downloadProgressBar","downloadProgressValue");d&&!virtualclass.recorder.alreadyAskForPlay?(a.data.alldata.totalSent>a.data.alldata.totalStore?virtualclass.recorder.askToPlay("completed"):
virtualclass.recorder.askToPlay(),virtualclass.recorder.alreadyAskForPlay=!0,virtualclass.recorder.tempRecData.push(a.data.alldata.rdata)):d&&virtualclass.recorder.playStart&&!1==virtualclass.recorder.waitServer?virtualclass.recorder.init(a.data.alldata.rdata):(virtualclass.recorder.tempRecData.push(a.data.alldata.rdata),!0==virtualclass.recorder.waitServer&&(virtualclass.recorder.alreadyPlayed=!0));a.data.alldata.rdata[a.data.alldata.rdata.length-1].hasOwnProperty("sessionEnd")?(console.log("Request file  Finished Here"),
virtualclass.recorder.allFileFound=!0,!0==virtualclass.recorder.waitServer&&(virtualclass.storage.config.endSession(),a=virtualclass.recorder.tempRecData.reduce(function(a,b){return a.concat(b)}),virtualclass.recorder.objn=0,virtualclass.recorder.init(a),virtualclass.recorder.play(),virtualclass.recorder.waitServer=!1,virtualclass.popup.closeElem())):(console.log("request file"),virtualclass.recorder.requestDataFromServer(b,f))})},playInt:function(){var a=virtualclass.recorder.tempRecData.reduce(function(a,
b){return a.concat(b)});virtualclass.popup.closeElem();virtualclass.recorder.init(a);virtualclass.recorder.playStart=!0;virtualclass.recorder.tempRecData.length=0;localStorage.setItem("mySession","thisismyplaymode");virtualclass.recorder.initController()},askToPlay:function(a){"undefined"!=typeof a?document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"):document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("askplayMessage");document.getElementById("askPlay").style.display=
"block";a=document.getElementById("playButton");null!=a&&(a.style.display="block",a.addEventListener("click",this.playInt))},isUptoBaseValue:function(a,b,d){return a>=b*d/100?!0:!1},play:function(){if(0==this.objn){var a=document.getElementById("recPlay");this.doControlActive(a)}var b=this;this.controller.pause||("undefined"==typeof b.playTimeout&&""==b.playTimeout||clearTimeout(b.playTimeout),this.hasOwnProperty("playTime")||(this.playTime=this.items[0].playTime,d.data=JSON.parse(this.items[this.objn].recObjs),
io.cfg=d.data,virtualclass.gObj.uRole="s"),"undefined"==typeof this.items[this.objn+1]||this.items[this.objn].hasOwnProperty("sessionEnd")?(this.items[this.objn].hasOwnProperty("sessionEnd")||(d.data=this.items[this.objn].recObjs,io.onRecMessage(b.convertInto(d))),!1==virtualclass.recorder.allFileFound?(virtualclass.recorder.waitServer=!0,virtualclass.recorder.waitPopup=!1,this.displayWaitPopupIfNot(),(virtualclass.recorder.hasOwnProperty("ctotalStore")||virtualclass.recorder.hasOwnProperty("ctotalSent"))&&
virtualclass.pbar.renderProgressBar(virtualclass.recorder.ctotalStore,virtualclass.recorder.ctotalSent,"downloadProgressBar","downloadProgressValue")):this.items[this.objn].hasOwnProperty("sessionEnd")&&(virtualclass.popup.replayWindow(),virtualclass.popup.sendBackOtherElems(),document.getElementById("replayClose").addEventListener("click",function(){c.close()}),document.getElementById("replayButton").addEventListener("click",function(){virtualclass.recorder.replayFromStart.call(virtualclass.recorder)}))):
b.playTimeout=setTimeout(function(){var a={};a.data=b.items[b.objn].recObjs;try{io.onRecMessage(b.convertInto(a))}catch(d){console.log("PLAY ERROR "+d.errorCode)}b.objn++;b.play.call(b);"object"==typeof b.items[b.objn]&&(b.playTime=b.items[b.objn].playTime/b.controller.ff,b.tillPlayTime+=b.playTime*b.controller.ff,b.allFileFound&&"object"==typeof b.items[b.objn+1]&&(b.playProgressBar(),virtualclass.popup.sendBackOtherElems()))},b.playTime))},initController:function(){var a=document.getElementById("playControllerCont");
if(null!=a){a.style.display="block";for(var b=this,a=document.getElementsByClassName("ff"),d=0;d<a.length;d++)a[d].onclick=function(){var a=this.id.split("ff")[1];b.controller.fastForward(parseInt(a,10));b.doControlActive(this)};document.getElementById("recPlay").addEventListener("click",function(){b.controller._play();b.doControlActive(this)});document.getElementById("recPause").addEventListener("click",function(){b.controller._pause();b.doControlActive(this)});document.getElementById("replayFromStart").addEventListener("click",
function(){b.replayFromStart()})}},doControlActive:function(a){for(var b=document.getElementById("playControllerCont").getElementsByClassName("recButton"),d=0;d<b.length;d++)b[d].classList.remove("controlActive");a.parentNode.classList.add("controlActive")},controller:{pause:!1,ff:1,_play:function(){this.ff=1;this.pause=!1;virtualclass.recorder.play()},_pause:function(){this.puase||(this.pause=!0)},fastForward:function(a){this.ff=a;this.pause=!1;virtualclass.recorder.play()}}};c.recorder=m})(window);
function randomString(c){for(var a="";0<c;--c)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*Math.random())];return a}function getUrlVars(c){for(var a=[],b=c.slice(c.indexOf("?")+1).split("&"),d=0;d<b.length;d++)c=b[d].split("="),a.push(c[0]),a[c[0]]=c[1];return a};(function(c){function a(a){"function"==typeof a&&(virtualclass.recorder.sendDataToServer(),setTimeout(function(){virtualclass.recorder.xhrsenddata()},100),a.apply(virtualclass.recorder))}var b;c.storage={dbVersion:4,init:function(a){this.reclaim=roles.isEducator();b=this;this.tables="wbData allData chunkData config dataAdapterAll dataUserAdapterAll executedStoreAll executedUserStoreAll".split(" ");var f=c.indexedDB.open("vidya_apps",b.dbVersion);f.onerror=function(a){console.log("Error opening db");
console.dir(a);"InvalidStateError"==a.target.error.name&&alert(virtualclass.lang.getString("enablehistory"));indexedDB.deleteDatabase("vidya_apps").onsuccess=function(){b.init()}};f.onupgradeneeded=function(a){a=a.target.result;a.objectStoreNames.contains("wbData")||a.createObjectStore("wbData",{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("allData")||a.createObjectStore("allData",{autoIncrement:!0});a.objectStoreNames.contains("config")||a.createObjectStore("config",{keyPath:"timeStamp",
autoIncrement:!0});a.objectStoreNames.contains("chunkData")||a.createObjectStore("chunkData",{autoIncrement:!0});a.objectStoreNames.contains("dataAdapterAll")||a.createObjectStore("dataAdapterAll",{keyPath:"serialKey"});a.objectStoreNames.contains("dataUserAdapterAll")||a.createObjectStore("dataUserAdapterAll",{keyPath:"serialKey"});a.objectStoreNames.contains("executedStoreAll")||a.createObjectStore("executedStoreAll",{keyPath:"serialKey"});a.objectStoreNames.contains("executedUserStoreAll")||a.createObjectStore("executedUserStoreAll",
{keyPath:"serialKey"})};f.onsuccess=function(c){b.db=c.target.result;for(c=0;c<b.tables.length;c++)try{b.db.transaction([b.tables[c]],"readwrite")}catch(f){indexedDB.deleteDatabase("vidya_apps").onsuccess=function(){b.init()};return}(new Date).getTime();virtualclass.gObj.sessionClear?b.config.endSession(!0):b.getAllObjs(b.tables,function(a){if("undefined"==typeof a)b.config.createNewSession();else{var d=a.createdDate;(72E5<(new Date).getTime()-d||a.room!=wbUser.room)&&b.config.endSession()}},"allData");
b.db.onerror=function(a){console.dir(a.target)};a()}},store:function(a){var c=b.db.transaction(["wbData"],"readwrite");c.objectStore("wbData").clear();console.log("Whiteboard Total Store "+JSON.parse(a).length);c.objectStore("wbData").add({repObjs:a,timeStamp:(new Date).getTime(),id:1});return!1},dataExecutedStoreAll:function(a,c){var g=b.db.transaction(["executedStoreAll"],"readwrite");g.objectStore("executedStoreAll");g.objectStore("executedStoreAll").put({executedData:a,id:6,serialKey:c});g.onerror=
function(a){a.preventDefault()}},dataAdapterAllStore:function(a,c){var g=b.db.transaction(["dataAdapterAll"],"readwrite");g.objectStore("dataAdapterAll");g.objectStore("dataAdapterAll").put({adaptData:a,id:5,serialKey:c});g.onerror=function(a){a.preventDefault()}},dataUserAdapterAllStore:function(a,c){var g=b.db.transaction(["dataUserAdapterAll"],"readwrite");g.objectStore("dataUserAdapterAll");g.objectStore("dataUserAdapterAll").put({adaptUserData:a,id:7,serialKey:c});g.onerror=function(a){a.preventDefault()}},
dataExecutedUserStoreAll:function(a,c){var g=b.db.transaction(["executedUserStoreAll"],"readwrite");g.objectStore("executedUserStoreAll");g.objectStore("executedUserStoreAll").put({executedUserData:a,id:8,serialKey:c});g.onerror=function(a){a.preventDefault()}},completeStorage:function(a,c,g,h){var m=b.db.transaction(["allData"],"readwrite");"undefined"!=typeof h?m.objectStore("allData").add({recObjs:"",sessionEnd:!0,id:3}):"undefined"==typeof g?m.objectStore("allData").add({recObjs:c,playTime:a,
id:3}):m.objectStore("allData").add({recObjs:c,playTime:a,id:3,bd:g.type})},chunkStorage:function(a){console.log("Chunk Storage");var c=b.db.transaction(["chunkData"],"readwrite");a.id=4;c.objectStore("chunkData").add(a)},wholeStore:function(a,f,g){f.peTime=c.pageEnter;a=JSON.stringify(f);f=(new Date).getTime();"undefined"!=typeof this.prevTime&&f==this.prevTime&&(f+=1);var h=b.db.transaction(["allData"],"readwrite");"undefined"==typeof g?h.objectStore("allData").add({recObjs:a,timeStamp:f,id:3}):
h.objectStore("allData").put({recObjs:a,timeStamp:this.prevTime,id:3});this.wholeStoreData=a;this.prevTime=f},displayData:function(){b.db.transaction(["virtualclass"],"readonly").objectStore("virtualclass").openCursor().onsuccess=b.handleResult},getAllObjs:function(a,c,g,h){c="undefined"!=typeof c?c:"";for(var m=0;m<a.length;m++)b.db.transaction(a[m],"readonly").objectStore(a[m]).openCursor().onsuccess=function(c,f){if(a[c]!=g)return function(g){"function"==typeof f?"undefined"!=typeof h?b[a[c]].handleResult(g,
f,h):"chunkData"!=a[c]&&b[a[c]].handleResult(g,f):"undefined"!=typeof h?b[a[c]].handleResult(g,void 0,h):b[a[c]].handleResult(g)}}(m,c)},getAllDataForDownload:function(a,c){var g=[];b.db.transaction(a,"readonly").objectStore(a[0]).openCursor().onsuccess=function(a){(a=a.target.result)?(g.push(a.value),a["continue"]()):0<g.length?c(JSON.stringify(g)):console.log("No data fetched from indexedDb")}},getrowData:function(a,c,g){a=b.db.transaction(a,"readonly").objectStore(a[0]);if("string"==typeof g&&
"first"==g)a.openCursor().onsuccess=function(a){(a=a.target.result)?c(a.value,a.key):c("No Such Row")};else{var h=a.get(g);h.onerror=function(a){return"No Such Row"};h.onsuccess=function(a){c(h.result)}}},wbData:{handleResult:function(a,b){var c=a.target.result;c?(c.value.hasOwnProperty("repObjs")&&("object"==typeof virtualclass.wb?(console.log("Total Whiteboard Length "+JSON.parse(c.value.repObjs).length+" From indexeddb"),virtualclass.wb.utility.replayFromLocalStroage(JSON.parse(c.value.repObjs))):
virtualclass.gObj.tempReplayObjs=JSON.parse(c.value.repObjs),virtualclass.gObj.tempReplayObjs=JSON.parse(c.value.repObjs),storeFirstObj=!0),c["continue"]()):"undefined"==typeof storeFirstObj&&"Whiteboard"==virtualclass.currApp&&virtualclass.wb.utility.makeUserAvailable()}},allData:{chunk:0,handleResult:function(b,c){var g=b.target.result;if(g){if(g.value.hasOwnProperty("recObjs")){if(g.value.hasOwnProperty("sessionEnd")){virtualclass.recorder.items.push({playTime:g.value.playTime,recObjs:g.value.recObjs,
sessionEnd:!0});console.log("Start Upload Process");a(c);return}g.value.hasOwnProperty("bd")?virtualclass.recorder.items.push({playTime:g.value.playTime,recObjs:g.value.recObjs,bd:g.value.bd}):virtualclass.recorder.items.push({playTime:g.value.playTime,recObjs:g.value.recObjs})}g["continue"]()}}},dataAdapterAll:{handleResult:function(a,b){var c=a.target.result;if(c){if(c.value.hasOwnProperty("adaptData")){var h=JSON.parse(c.value.adaptData);parseInt(c.value.serialKey)>ioAdapter.serial&&(ioAdapter.serial=
parseInt(c.value.serialKey));ioAdapter.adapterMustData[ioAdapter.serial]=h}c["continue"]()}}},dataUserAdapterAll:{handleResult:function(a,b){var c=a.target.result;if(c){if(c.value.hasOwnProperty("adaptUserData")){var h=JSON.parse(c.value.adaptUserData),m=c.value.serialKey.split("_"),n=parseInt(m[0]),m=parseInt(m[1]);ioAdapter.validateAllVariables(n);m>ioAdapter.userSerial[n]&&(ioAdapter.userSerial[n]=m);ioAdapter.userAdapterMustData[n][m]=h}c["continue"]()}}},executedStoreAll:{handleResult:function(a,
b){var c=a.target.result;if(c){if(c.value.hasOwnProperty("executedData")){var h=JSON.parse(c.value.executedData),m=c.value.serialKey.split("_"),n=parseInt(m[0]),m=parseInt(m[1]);ioMissingPackets.validateAllVariables(n);ioMissingPackets.executedStore[n][m]=h}c["continue"]()}}},executedUserStoreAll:{handleResult:function(a,b){var c=a.target.result;if(c){if(c.value.hasOwnProperty("executedUserData")){var h=JSON.parse(c.value.executedUserData),m=c.value.serialKey.split("_"),n=parseInt(m[0]),m=parseInt(m[1]);
ioMissingPackets.validateAllUserVariables(n);ioMissingPackets.executedUserStore[n][m]=h}c["continue"]()}}},config:{handleResult:function(a,b){var c=a.target.result;if(c){if(c.value.hasOwnProperty("myconfig")){var h=JSON.parse(c.value.myconfig);"undefined"!=typeof b&&(mc=!0,b(h))}c["continue"]()}else"undefined"!=typeof b&&"undefined"==typeof mc&&b()},createNewSession:function(){virtualclass.recorder.sessionKey=randomString(11);roles.hasAdmin()&&ioStorage.completeStorage(JSON.stringify(virtualclass.uInfo));
virtualclass.makeAppReady(virtualclass.apps[3]);var a=(new Date).getTime();if("undefined"!=typeof b.db){var c=b.db.transaction(["config"],"readwrite").objectStore("config"),a=JSON.stringify({createdDate:a,room:wbUser.room});c.add({myconfig:a,timeStamp:(new Date).getTime()})}else console.log("The Datbase is not created for Applicatoin.")},endSession:function(a){var c=localStorage.getItem("nEd");localStorage.clear();virtualclass.recorder.items=[];virtualclass.recorder.totalSent=0;virtualclass.gObj.tempReplayObjs.length=
0;virtualclass.recorder.hasOwnProperty("startUpload")&&delete virtualclass.recorder.startUpload;virtualclass.gObj.hasOwnProperty("downloadProgress")&&delete virtualclass.gObj.downloadProgress;a||("object"==typeof virtualclass.wb&&(virtualclass.wb.utility.t_clearallInit(),virtualclass.wb.utility.makeDefaultValue(),"object"==typeof virtualclass.wb.replay&&(virtualclass.wb.replay.rendering=!1)),virtualclass.vutil.clearAllChat(),virtualclass.editorRich.removeEditorData(),virtualclass.editorCode.removeEditorData());
virtualclass.vutil.removeClass("audioWidget","fixed");virtualclass.hasOwnProperty("notPLayed")||virtualclass.storage.clearStorageData();virtualclass.currApp="EditorRich";virtualclass.user.control.audioWidgetEnable();virtualclass.user.control.allChatEnable();roles.hasAdmin()&&(document.getElementById("virtualclassSessionEndTool").className=virtualclass.vutil.removeClassFromElement("virtualclassSessionEndTool","active"));"object"==typeof virtualclass.yts&&clearInterval(virtualclass.yts.tsc);"object"==
typeof virtualclass.sharePt&&virtualclass.sharePt.UI.removeIframe();console.log("Session End.");virtualclass.previous="virtualclassEditorRich";virtualclass.getContent=!1;virtualclass.recorder.storeDone=0;virtualclass.chat.removeChatHighLight("chatrm");virtualclass.setPrvUser();io.sock&&io.sock.close();null!=c?(console.log("Editor mode enable"),localStorage.setItem("editorRich",!0),localStorage.setItem("editorCode",!0),localStorage.removeItem("nEd")):console.log("Editor mode disable");console.log("New role before clear "+
virtualclass.gObj.uRole);b.config.createNewSession();console.log("New role after clear "+virtualclass.gObj.uRole);virtualclass.popup.waitMsg()}},shapesData:{handleResult:function(){virtualclass.recorder.items.push(JSON.parse(cursor.value.recObjs))}},clearSingleTable:function(a){var b=this.db.transaction(a,"readwrite");"undefined"!=typeof b?(b.objectStore(a).clear(),console.log("Cleared IDDB Table "+a)):console.log("There is no table "+a+" at IDDB.")},clearStorageData:function(){ioAdapter.adapterMustData=
[];ioAdapter.serial=-1;ioAdapter.userSerial=[];ioAdapter.userAdapterMustData=[];ioMissingPackets.executedStore=[];ioMissingPackets.executedSerial={};ioMissingPackets.missRequest=[];ioMissingPackets.aheadPackets=[];ioMissingPackets.missRequestFlag=0;ioMissingPackets.executedUserStore=[];ioMissingPackets.executedUserSerial={};ioMissingPackets.missUserRequest=[];ioMissingPackets.aheadUserPackets=[];for(var a=ioMissingPackets.missUserRequestFlag=0;a<this.tables.length;a++)"allData"==this.tables[a]?virtualclass.vutil.isPlayMode()||
this.clearSingleTable(this.tables[a]):this.clearSingleTable(this.tables[a])},handleResultNoUsing:function(){var a=event.target.result;if(a){if(a.value.hasOwnProperty("repObjs")){var b=JSON.parse(a.value.repObjs);virtualclass.wb.utility.replayFromLocalStroage(b)}else a.value.hasOwnProperty("audiostream")?(b=JSON.parse(a.value.audiostream),virtualclass.gObj.video.audio.assignFromLocal(b)):a.value.hasOwnProperty("recObjs")&&virtualclass.recorder.items.push(JSON.parse(a.value.recObjs));a["continue"]()}}}})(window);(function(c,a){c.user=function(b){return{assignRole:function(a,b,g){roles.hasControls()&&(roles.isEducator()||virtualclass.html.leftAppBar(),virtualclass.attachFunction(),"Whiteboard"==b&&c.virtualclass.wb.attachToolFunction(vcan.cmdWrapperDiv,!0),virtualclass.hasOwnProperty("previrtualclass")?virtualclass.vutil.makeActiveApp("virtualclass"+b,virtualclass.previrtualclass):virtualclass.vutil.makeActiveApp("virtualclass"+b),"object"==typeof virtualclass.wb&&virtualclass.wb.utility.makeCanvasEnable())},
teacherIsAlreadyExist:function(){for(var b=a.getElementById("chat_div").getElementsByClassName("ui-memblist-usr"),c,g=0;g<b.length;g++)if(c=b[g].getAttribute("data-role"),"t"==c||"e"==c)return!0;return!1},createControl:function(b,c){var g=a.createElement("div");g.id=b+"ControlContainer";g.className="controls";this.createControlDivs(g,b,c);return g},createControllerElement:function(b,c){var g=a.createElement("span");g.id=b+c+"Img";var h=a.createElement("a");h.id=b+c+"Anch";h.className="tooltip";h.appendChild(g);
var m=a.createElement("div");m.id=b+c+"Cont";m.className="controleCont";m.appendChild(h);return[m,g]},createAssignControl:function(b,c,g,h){var m=this,n=this.createControllerElement(c,"contrAssign"),q=n[0],u=n[1],n=a.getElementById(c+"ControlContainer");null!=n?0>=n.getElementsByClassName("controleCont").length?n.appendChild(q):n.insertBefore(q,n.firstChild):b.appendChild(q);virtualclass.user.control.changeAttribute(c,u,g,"assign","aRole");"undefined"!=typeof h&&(u.className+=" currTeacher");u.addEventListener("click",
function(){m.control.init.call(m,u)})},createControlDivs:function(a,b,c){var h=this,m=!1,n=localStorage.getItem("virtualclass"+b);if(null!=n&&(m=!0,n=JSON.parse(n),n.hasOwnProperty("currTeacher")))if(virtualclass.gObj[b+"currTeacher"]={},!0==n.currTeacher){var q=virtualclass.user.control.currTeacherAlready=!0;virtualclass.gObj[b+"currTeacher"].ct=!0}else virtualclass.gObj[b+"currTeacher"].ct=!1;var u=roles.isEducator()?!1:!0,w=virtualclass.vutil.userIsOrginalTeacher(b);virtualclass.vutil.isUserTeacher(b);
for(var t=0;t<c.length;t++)if("assign"==c[t]&&w)"undefined"!=typeof q?this.createAssignControl(a,b,u,q):this.createAssignControl(a,b,u);else if("audio"==c[t]){var x=this.createControllerElement(b,"contrAud"),r=x[0],s=x[1];a.appendChild(r);r=m&&n.hasOwnProperty("aud")?n.aud?!0:!1:!0;virtualclass.user.control.changeAttribute(b,s,r,"audio","aud");w&&s.addEventListener("click",function(){h.control.init.call(h,s)})}else if("chat"==c[t]){var x=this.createControllerElement(b,"contrChat"),r=x[0],v=x[1];a.appendChild(r);
w&&v.addEventListener("click",function(){h.control.init.call(h,v)});r=m&&n.hasOwnProperty("chat")?n.chat?!0:!1:!0;virtualclass.user.control.changeAttribute(b,v,r,"chat","chat")}else if(("editorRich"==c[t]||"editorCode"==c[t])&&roles.hasAdmin()){var B=m&&n.hasOwnProperty(c[t])?n[c[t]]?!0:!1:!1,x=this.createControllerElement(b,"contr"+c[t]),r=x[0],x=x[1];r.className+=" controller"+c[t];a.appendChild(r);virtualclass.currApp!=virtualclass.vutil.capitalizeFirstLetter(c[t])&&(r.style.display="none");virtualclass.user.control.changeAttribute(b,
x,B,c[t],c[t]);w&&x.addEventListener("click",h.closureEditor(h,x))}},closureEditor:function(a,b){return function(){a.control.init.call(a,b)}},control:{toggleDisplayWriteModeMsgBox:function(b,c){var g=a.getElementById(b+"writeModeBox"),h=c?virtualclass.lang.getString("writemode"):virtualclass.lang.getString("readonlymode"),m=a.getElementById("virtualclass"+b+"Body");null==g&&null!=m&&(g=a.createElement("div"),g.id=b+"writeModeBox",m.appendChild(g));null!=g&&(g.className="writeModeBox",g.dataset.writeMode=
c,g.innerHTML=h);"EditorRich"==b&&this.tooglDisplayEditorToolBar(c)},tooglDisplayEditorToolBar:function(b){var c=a.getElementsByClassName("vceditor-toolbar"),g=c[0];0<c.length&&(b?(g.style.pointerEvents="visible",g.style.opacity="1"):(g.style.pointerEvents="none",g.style.opacity="0.5"))},received_editorRich:function(a){var b;a.status?(virtualclass.gObj.uid==a.toUser?"object"!=typeof virtualclass.editorRich.cm||virtualclass.isPlayMode||virtualclass.editorRich.cm.setOption("readOnly",!1):this.enable(a.toUser,
"editorRich","editorRich","editorRich"),virtualclass.isPlayMode&&virtualclass.editorRich.control.toggleDisplayWriteModeMsgBox(!1),b=!0):(virtualclass.gObj.uid==a.toUser?"object"==typeof virtualclass.editorRich.cm&&virtualclass.editorRich.cm.setOption("readOnly","nocursor"):this.disable(a.toUser,"editorRich","editorRich","editorRich"),b=!1);localStorage.setItem("editorRich",b);roles.hasAdmin()||this.toggleDisplayWriteModeMsgBox("EditorRich",b);!roles.hasAdmin()&&"iOS"==virtualclass.system.mybrowser.name&&
virtualclass.system.isIPad()&&(a.status?virtualclass.editorRich.enableEditorByOuterLayer():virtualclass.editorRich.disableEditorByOuterLayer());virtualclass.vutil.setReadModeWhenTeacherIsDisConn("editorRich")},received_editorCode:function(a){var b;a.status?(virtualclass.gObj.uid==a.toUser?"object"!=typeof virtualclass.editorCode.cm||virtualclass.isPlayMode||virtualclass.editorCode.cm.setOption("readOnly",!1):this.enable(a.toUser,"editorCode","editorCode","editorCode"),virtualclass.isPlayMode&&virtualclass.editorCode.control.toggleDisplayWriteModeMsgBox(!1),
b=!0):(virtualclass.gObj.uid==a.toUser?"object"==typeof virtualclass.editorCode.cm&&virtualclass.editorCode.cm.setOption("readOnly","nocursor"):this.disable(a.toUser,"editorCode","editorCode","editorCode"),b=!1);localStorage.setItem("editorCode",b);roles.hasAdmin()||this.toggleDisplayWriteModeMsgBox("EditorCode",b);!roles.hasAdmin()&&"iOS"==virtualclass.system.mybrowser.name&&virtualclass.system.isIPad()&&(a.status?virtualclass.editorCode.enableEditorByOuterLayer():virtualclass.editorCode.disableEditorByOuterLayer());
virtualclass.vutil.setReadModeWhenTeacherIsDisConn("editorCode")},onmessage:function(a){this["received_"+a.message.control](a.message)},addCurrTeacherToControl:function(b){var c=a.getElementById(b);null!=c&&(virtualclass.vutil.elemHasAnyClass(b)?c.classList.add("currTeacher"):c.className="currTeacher")},removeCurrTeacherFromControl:function(b){var c=a.getElementById(b);virtualclass.vutil.elemHasAnyClass(b)&&(c.classList.remove("currTeacher"),c=b.indexOf("contr"),b=b.substring(0,c),virtualclass.user.control.updateUser(b,
"currTeacher",!1))},removeAudioFromParticipate:function(b){b=a.getElementById(b+"contrAssignCont");null!=b&&b.parentNode.removeChild(b)},disable:function(b,c,g,h){g=a.getElementById(b+"contr"+g+"Img");null!=g&&virtualclass.user.control._disable(g,c,b,h)},_disable:function(a,b,c,h){a.parentNode.setAttribute("data-title",virtualclass.lang.getString(b+"Disable"));a.setAttribute("data-"+b+"-disable","true");a.className="icon-"+b+"Img block "+b+"Img";"assign"==b?(a.parentNode.classList.remove("tooltip"),
this.addCurrTeacherToControl(a.id),a=localStorage.getItem("virtualclass"+c),a=JSON.parse(a),virtualclass.gObj.hasOwnProperty(c+"currTeacher")?(virtualclass.gObj[c+"currTeacher"].ct||virtualclass.gObj.hasOwnProperty("controlAssign")&&virtualclass.gObj.controlAssign&&a.currTeacher)&&virtualclass.user.control.updateUser(c,"currTeacher",!0):virtualclass.gObj.hasOwnProperty("controlAssign")&&virtualclass.gObj.controlAssignId==c&&virtualclass.user.control.updateUser(c,"currTeacher",!0)):"audio"==b&&(a.className=
"icon-"+b+"DisImg block "+b+"DisImg");virtualclass.user.control.updateUser(c,h,!1)},enable:function(b,c,g,h){g=a.getElementById(b+"contr"+g+"Img");null==g?console.log("Element is Null"):virtualclass.user.control._enable(g,c,b,h)},_enable:function(a,b,c,h){a.parentNode.setAttribute("data-title",virtualclass.lang.getString(b+"Enable"));"audio"==b&&a.parentNode.setAttribute("data-title",virtualclass.lang.getString(b+"Off"));a.setAttribute("data-"+b+"-disable","false");a.className="icon-"+b+"Img enable "+
b+"Img";virtualclass.user.control.updateUser(c,h,!0)},changeAttribute:function(a,b,c,h,m){c?virtualclass.user.control._enable(b,h,a,m):virtualclass.user.control._disable(b,h,a,m)},init:function(a,b,c){"undefined"==typeof c&&(c="Img");var h=a.id,m=h.indexOf("contr"),m=h.substring(0,m),h=h.split("contr")[1];c=h.indexOf(c);c=h.substring(0,c);if("Assign"==c)virtualclass.gObj.controlAssign=!0,virtualclass.gObj.controlAssignId=m,b="true"==a.getAttribute("data-assign-disable")?!0:!1,b||(this.control.changeAttribute(m,
a,b,"assign","aRole"),virtualclass.user.control._assign(m),virtualclass.user.control.changeAttrToAssign("block")),roles.hasAdmin()||virtualclass.user.control.removeAudioFromParticipate(m);else{var n;"Chat"==c?(a.className="contrChatBlock",h="chat"):h="Aud"==c?"audio":c;"undefined"!=typeof b?b=(n="enable"==b?!0:!1)?"enable":"block":"true"==a.getAttribute("data-"+h+"-disable")?(b="enable",n=!0):(b="block",n=!1);this.control.changeAttribute(m,a,n,h,virtualclass.vutil.smallizeFirstLetter(c));this.control["_"+
h].call(this.control,m,b)}},init_old:function(a){var b=a.id,c=b.indexOf("contr"),c=b.substring(0,c),b=b.split("contr")[1],h=b.indexOf("Img"),b=b.substring(0,h);"Assign"==b?(virtualclass.gObj.controlAssign=!0,virtualclass.gObj.controlAssignId=c,b="true"==a.getAttribute("data-assign-disable")?!0:!1,b||(this.control.changeAttribute(c,a,b,"assign","aRole"),virtualclass.user.control._assign(c),virtualclass.user.control.changeAttrToAssign("block")),roles.hasAdmin()||virtualclass.user.control.removeAudioFromParticipate(c)):
"Chat"==b?("true"==a.getAttribute("data-chat-disable")?(a.className="contrChatBlock",b="enable",this.control.changeAttribute(c,a,!0,"chat","chat")):(b="block",this.control.changeAttribute(c,a,!1,"chat","chat")),this.control._chat(c,b)):"Aud"==b&&("true"==a.getAttribute("data-audio-disable")?(b="enable",this.control.changeAttribute(c,a,!0,"audio","aud")):(b="block",this.control.changeAttribute(c,a,!1,"audio","aud")),this.control._audio(c,b))},_assign:function(b,c,g){virtualclass.vutil.assignRole();
virtualclass.vutil.removeAppPanel();virtualclass.system.setAppDimension();virtualclass.vutil.renderWhiteboardObjectsIfAny();if(!roles.hasAdmin()){var h=a.getElementById("vcanvas");h.className=h.className.replace(/\bteacher\b/," ");h.className="student"}localStorage.setItem("canvasDrwMsg",!0);h=a.getElementById("virtualclassScreenShareLocalVideo");null!=h&&"VIDEO"==h.tagName&&virtualclass.vutil.videoTeacher2Student("ScreenShare",!0);"ScreenShare"==virtualclass.currApp&&(virtualclass.ss.hasOwnProperty("currentStream")&&
virtualclass.ss.currentStream.getTracks()[0].stop(),virtualclass.ss="");"undefined"==typeof c&&(console.log("role transfer"),virtualclass.vutil.beforeSend({assignRole:!0,toUser:b,cf:"assignRole"},b),roles.hasAdmin()&&(c=a.getElementById(b+"contreditorRichImg"),"true"==c.dataset.editorrichDisable&&virtualclass.user.control.init.call(virtualclass.user,c),c=a.getElementById(b+"contreditorCodeImg"),"true"==c.dataset.editorcodeDisable&&virtualclass.user.control.init.call(virtualclass.user,c)));roles.hasAdmin()||
("undefined"==typeof g&&(g=b),b=a.getElementById(g+"ControlContainer").getElementsByClassName("controleCont")[0],b.removeChild(b.firstChild),localStorage.removeItem("aId"))},_chat:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({enc:!0,toUser:a,cf:"enc"},a):(virtualclass.user.control.updateUser(a,"chat",!1),virtualclass.vutil.beforeSend({dic:!0,toUser:a,cf:"dic"},a))},_audio:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({ena:!0,toUser:a,cf:"ena"},a):virtualclass.vutil.beforeSend({dia:!0,
toUser:a,cf:"dia"},a)},_audioAll:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({ena:!0,toUser:a,cf:"ena"},a):virtualclass.vutil.beforeSend({dia:!0,toUser:a,cf:"dia"},a)},_editorRich:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({status:!0,control:"editorRich",toUser:a,cf:"control"},a):virtualclass.vutil.beforeSend({status:!1,control:"editorRich",toUser:a,cf:"control"},a)},_editorCode:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({status:!0,control:"editorCode",toUser:a,
cf:"control"},a):virtualclass.vutil.beforeSend({status:!1,control:"editorCode",toUser:a,cf:"control"},a)},_audio:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({ena:!0,toUser:a,cf:"ena"},a):virtualclass.vutil.beforeSend({dia:!0,toUser:a,cf:"dia"},a)},audioWidgetEnable:function(){localStorage.setItem("audEnable",JSON.stringify({ac:"true"}));if(null==localStorage.getItem("dvid")){var b=a.getElementById("audioWidget");b.className="active";b.style.opacity="1";b.style.pointerEvents="visible"}},
audioWidgetDisable:function(b){var c={ac:"false"},g=localStorage.getItem("audEnable");null!=g?(g=JSON.parse(g),"false"!=g.ac&&"undefined"!=typeof b&&(c.r=b)):"unefined"!=typeof b&&(c.r=b);localStorage.setItem("audEnable",JSON.stringify(c));b=a.getElementById("audioWidget");b.style.opacity="0.5";b.style.pointerEvents="none";b.className="deactive";b=a.getElementById("speakerPressing");virtualclass.gObj.hasOwnProperty("video")&&(virtualclass.gObj.video.audio.studentNotSpeak(b),virtualclass.gObj.video.audio.clickOnceSpeaker("speakerPressOnce",
"alwaysDisable"))},allChatDisable:function(){localStorage.setItem("chatEnable","false");this.disableCommonChat();this.disbaleAllChatBox();this.disableOnLineUser()},disableCommonChat:function(){var b=a.getElementById("chatrm");null!=b&&this.makeElemDisable(b)},disbaleAllChatBox:function(){for(var b=a.getElementById("stickybar").getElementsByClassName("ui-chatbox"),c=0;c<b.length;c++)this.makeElemDisable(b[c])},disableOnLineUser:function(){for(var b=a.getElementsByClassName("ui-memblist-usr"),c=0;c<
b.length;c++)b[c].style.pointerEvents="none"},makeElemDisable:function(a){virtualclass.vutil.elemHasAnyClass(a.id)?(a.classList.remove("enable"),a.classList.add("disable")):a.className="disable";a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!0)},allChatEnable:function(){localStorage.setItem("chatEnable","true");var b=a.getElementById("chatrm");null!=b&&this.makeElemEnable(b);for(var c=a.getElementById("stickybar").getElementsByClassName("ui-chatbox"),b=0;b<c.length;b++)this.makeElemEnable(c[b]);
c=a.getElementsByClassName("ui-memblist-usr");for(b=0;b<c.length;b++)c[b].classList.contains("mySelf")||(c[b].style.pointerEvents="visible")},makeElemEnable:function(a){virtualclass.vutil.elemHasAnyClass(a.id)?(a.classList.remove("disable"),a.classList.add("enable")):a.className="enable";a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!1)},toggleAllEditorController:function(b,c){b=virtualclass.vutil.smallizeFirstLetter(b);var g=a.getElementsByClassName("controleCont");if(0<
g.length)for(var h=0;h<g.length;h++)if(0<g[h].id.indexOf(b)){var m=g[h].id.indexOf("Cont");0<m&&(m=g[h].id.substr(0,m),m=a.getElementById(m+"Img"),this.control.init.call(this,m,c))}},toggleDisplayEditorController:function(b,c){b=virtualclass.vutil.smallizeFirstLetter(b);for(var g=a.getElementsByClassName("controller"+b),h=0;h<g.length;h++)g[h].style.display=c},updateUser:function(a,b,c){var h=localStorage.getItem("virtualclass"+a),m={};null==h?m.id=a:m=JSON.parse(h);m[b]=c;localStorage["virtualclass"+
m.id]=JSON.stringify(m);return m},audioSign2:function(b,f){if("create"==f){if(null==a.getElementById(b.id+"AudEnableSign")){var g=a.createElement("div");g.id=b.id+"AudEnableSign";var h=a.createElement("img");imgName="audioenable";h.id=b.id+imgName+"Img";h.src=c.whiteboardPath+"images/"+imgName+".png";var m=a.createElement("a");m.id=b.id+imgName+"Anch";m.className="audEnableSign tooltip controleCont";m.setAttribute("data-title",virtualclass.lang.getString("studentAudEnable"));m.appendChild(h);g.appendChild(m);
a.getElementById(b.id+"ControlContainer").appendChild(g)}}else g=a.getElementById(b.id+"AudEnableSign"),g.parentNode.removeChild(g)},audioSign:function(a,b){"create"==b?this.iconAttrManupulate(a.id,"icon-audioEnaGreen"):a.aud?this.iconAttrManupulate(a.id,"icon-audioImg"):this.iconAttrManupulate(a.id,"icon-audioDisImg")},iconAttrManupulate:function(b,c){var g=a.getElementById(b+"contrAudImg");if(null!=g)for(var h=0;h<g.classList.length;h++)if("icon-"==g.classList[h].substring(0,5)){g.classList.remove(g.classList[h]);
g.classList.add(c);break}},shouldApply:function(a){var b=localStorage.getItem("virtualclass"+a);null!=b&&(b=JSON.parse(b),b.ad&&virtualclass.user.control.audioSign({id:a},"create"))},changeAttrToAssign:function(b){for(var c=a.getElementById("chatWidget").getElementsByClassName("assignImg"),g=0;g<c.length;g++)"enable"==b?(c[g].classList.remove("block"),c[g].classList.add("enable"),c[g].parentNode.classList.add("tooltip"),c[g].parentNode.setAttribute("data-title",virtualclass.lang.getString("assignEnable")),
c[g].setAttribute("data-assign-disable","false")):(c[g].classList.remove("enable"),c[g].classList.add("block"),c[g].parentNode.classList.remove("tooltip"),c[g].setAttribute("data-assign-disable","true"))}},displayStudentSpeaker:function(b){var c=a.getElementById("alwaysPress");null!=c&&(c.style.display=b?"block":"none")},toggleAllAudio:function(b){var c=a.getElementsByClassName("controleCont");if(0<c.length)for(var g=0;g<c.length;g++)if(0<c[g].id.indexOf("Aud")){var h=c[g].id.indexOf("Cont");0<h&&
(h=c[g].id.substr(0,h),h=a.getElementById(h+"Img"),this.control.init.call(this,h,b))}},UIaudioAll:function(b,c){var g=a.createElement("a");g.id="contrAudioAll";var h=a.createElement("span");h.id="contrAudioAllImg";var m=localStorage.getItem("allAudAction");null!=m&&"disable"==m?(h.setAttribute("data-action","enable"),h.className="icon-all-audio-enable tooltip",h.dataset.title=virtualclass.lang.getString("unmuteAll")):(h.setAttribute("data-action","disable"),h.className="icon-all-audio-disable tooltip",
h.dataset.title=virtualclass.lang.getString("muteAll"));if(virtualclass.isPlayMode)g.pointerEvents="none",g.style.cursor="default";else{var n=this;h.addEventListener("click",function(){a.getElementById("contrAudioAllImg");var b=n.toogleAudioIcon();"undefined"!=typeof b&&(localStorage.setItem("allAudAction",b),n.toggleAllAudio.call(virtualclass.user,b))})}g.appendChild(h);a.getElementById(b).getElementsByClassName(c)[0].appendChild(g)},toogleAudioIcon:function(){var b=a.getElementById("contrAudioAllImg");
if(null!=b)return actionToPerform=b.dataset.action,"enable"==b.dataset.action?(b.dataset.action="disable",b.className="icon-all-audio-disable tooltip",b.dataset.title=virtualclass.lang.getString("muteAll")):(b.dataset.action="enable",b.className="icon-all-audio-enable tooltip",b.dataset.title=virtualclass.lang.getString("unmuteAll")),actionToPerform},changeRoleOnFooter:function(b,c){a.getElementById("ml"+b).dataset.role=c}}}})(window,document);(function(c){c.xhr={init:function(){this.httpObj=c.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.httpObj.upload.addEventListener("progress",this.onProgress);this.onReadStateChange();this.httpObj.onerror=function(a){virtualclass.recorder.initMakeAvailDownloadFile();console.log("Error "+a)};this.httpObj.onabort=function(a){console.log("Error abort "+a)}},onProgress:function(a){virtualclass.pbar.currVal=a.loaded;""!=virtualclass.pbar.prvVal&&"undefined"!=typeof virtualclass.pbar.prvVal||
virtualclass.isPlayMode||virtualclass.pbar.progressInit();virtualclass.pbar.renderProgressBar(a.total,a.loaded,"indProgressBar","indProgressValue")},onReadStateChange:function(){var a=this;this.httpObj.onreadystatechange=function(){4==a.httpObj.readyState&&"undefined"!=typeof a.cb&&(200==a.httpObj.status?a.cb(a.httpObj.responseText):a.cb("ERROR"))}},send:function(a,b,c){this.cb=c;this.httpObj.open("POST",b,!0);this.httpObj.send(a)}}})(window);var PopUp=function(c,a){function b(a){this.init(a);return this}function d(a,b){var c={},d;for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(c[d]=b[d]);return c}function f(a){var b=document.createElement("div");b.classList.add("rv-vanilla-modal-overlay");document.querySelector("body").appendChild(b);"function"===typeof a&&a()}"use strict";b.prototype.init=function(a){var b=this;this.settings=d({selector:"[data-rv-vanilla-modal]",
modalSelector:".rv-vanilla-modal",closeSelector:".rv-vanilla-modal-close",showModalClassName:"rv-vanilla-modal-is-open",showOverlay:!0},a);this.modalElements=document.querySelectorAll(this.settings.modalSelector);this.triggers=document.querySelectorAll(this.settings.selector);this.settings.showOverlay&&f(function(){b.overlayElement=document.querySelector(".rv-vanilla-modal-overlay")})};b.prototype.close=function(a){a.classList.remove(this.settings.showModalClassName);this.settings.showOverlay&&this.overlayElement.classList.remove("is-shown")};
b.prototype.open=function(a){document.getElementById("popupContainer").style.display="block";this.sendBackOtherElems();this.closeShownModal();a.classList.add(this.settings.showModalClassName);this.settings.showOverlay&&this.overlayElement.classList.add("is-shown")};b.prototype.each=function(a){[].forEach.call(this.triggers,function(b){"function"===typeof a&&a(b)})};b.prototype.closeShownModal=function(){var a=this.settings.showModalClassName;[].forEach.call(this.modalElements,function(b){b.classList.contains(a)&&
b.classList.remove(a)})};b.prototype.closeElem=function(){console.log("close popup");if(!1==virtualclass.recorder.waitServer){var a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.zIndex=100);a=document.getElementById("stickybar");null!=a&&(a.style.zIndex=2E3);a=document.getElementById("commandToolsWrapper");null!=a&&(a.style.pointerEvents="visible");a=document.getElementById("about-modal");null!=a&&virtualclass.popup.close(a);document.getElementById("sessionEndMsgCont").dataset.displaying=
"false"}};b.prototype.waitBlock=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();document.getElementById("recordPlay").style.display="block";virtualclass.popup.replayWindowAction("none")};b.prototype.waitBlockAction=function(a){document.getElementById("recordPlay").style.display=a};b.prototype.sendBackOtherElems=function(a){a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.zIndex=0);a=document.getElementById("commandToolsWrapper");
null!=a&&(a.style.pointerEvents="none");a=document.getElementById("stickybar");null!=a&&(a.style.zIndex=0);a=document.getElementById("chatrm");null!=a&&(a.style.zIndex=0);a=document.getElementById("audioWidget");null!=a&&(a.style.zIndex=0);a=document.getElementById("audioWidget");null!=a&&(a.style.zIndex=0);a=document.getElementById("memlist");null!=a&&(a.style.zIndex=0)};b.prototype.openProgressBar=function(a){a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();
document.getElementById("recordingContainer").style.display="block"};b.prototype.replayWindow=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();virtualclass.popup.replayWindowAction("block")};b.prototype.sesseionEndWindow=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();a=document.getElementById("sessionEndMsgCont");a.style.display="block";a.dataset.displaying=!0;document.getElementById("sessionEndClose").addEventListener("click",
function(){virtualclass.popup.closeElem()})};b.prototype.replayWindowAction=function(a){document.getElementById("replayContainer").style.display=a};b.prototype.progressBarAction=function(a){document.getElementById("recordingContainer").style.display=a};b.prototype.confirmInput=function(a,b,c){var d=document.getElementById("about-modal");virtualclass.popup.open(d);this.hideAllPopups();d=document.getElementById("confirm");d.style.display="block";var f=d.getElementsByClassName("confirmChild");if(0<f.length)for(;1<=
f.length;)f[0].parentNode.removeChild(f[0]);f=document.createElement("div");f.id="confirmMessage";f.className="confirmChild";f.innerHTML=a;d.appendChild(f);var u=this;a=function(){u.confirmInit(this.id,b,c)};f=document.createElement("div");f.id="confirmOk";f.className="confirmButton confirmChild";f.addEventListener("click",a);var w=document.createElement("button");w.id="confirmOkButton";w.className="icon-check";w.innerHTML=virtualclass.lang.getString("confirmOk");f.appendChild(w);d.appendChild(f);
f=document.createElement("div");f.id="confirmCancel";f.className="confirmButton confirmChild";f.addEventListener("click",a);a=document.createElement("button");a.id="confirmCancelButton";a.className="icon-close";a.innerHTML=virtualclass.lang.getString("confirmCancel");f.appendChild(a);d.appendChild(f)};b.prototype.confirmInit=function(a,b,c){virtualclass.popup.closeElem();a="confirmOk"==a?virtualclass.popup.confirmOk():virtualclass.popup.confirmCancel();b(a,c)};b.prototype.confirmCancel=function(){return!1};
b.prototype.confirmOk=function(){return!0};b.prototype.waitMsg=function(){if("undefined"==typeof virtualclass.vutil||!virtualclass.vutil.sesionEndMsgBoxIsExisting()){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();document.getElementById("waitMsgCont").style.display="block"}};b.prototype.hideAllPopups=function(){for(var a=document.getElementsByClassName("popupWindow"),b=0;b<a.length;b++)a[b].style.display="none"};b.prototype.closePopup=function(){virtualclass.popup.closeElem();
"true"==document.getElementById("sessionEndMsgCont").dataset.displaying&&this.sesseionEndWindow()};return b}(window);(function(c){c.converter=function(){function a(a,b){for(var c=a.replace(/[^A-Za-z0-9\+\/]/g,""),h=c.length,m=b?Math.ceil((3*h+1>>2)/b)*b:3*h+1>>2,n=new Uint8Array(m),q,u=0,w=0,t=0;t<h;t++){q=t&3;var x=c.charCodeAt(t),u=u|(64<x&&91>x?x-65:96<x&&123>x?x-71:47<x&&58>x?x+4:43===x?62:47===x?63:0)<<6*(3-q);if(3===q||1===h-t){for(q=0;3>q&&w<m;q++,w++)n[w]=u>>>(16>>>q&24)&255;u=0}}return n}function b(a){return 26>a?a+65:52>a?a+71:62>a?a-4:62===a?43:63===a?47:65}return{base64EncArrInt:function(a){for(var b=
new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=0>a[c]?-1*a[c]+127:a[c];return this.base64EncArr(b)},base64EncArr:function(a){for(var c=2,g="",h=a.length,m=0,n=0;n<h;n++)if(c=n%3,0<n&&0===4*n/3%76&&(g+="\r\n"),m|=a[n]<<(16>>>c&24),2===c||1===a.length-n)g+=String.fromCharCode(b(m>>>18&63),b(m>>>12&63),b(m>>>6&63),b(m&63)),m=0;return g.substr(0,g.length-2+c)+(2===c?"":1===c?"=":"==")},base64DecToArrInt:function(b){b=a(b);for(var c=new Int8Array(b.length),g=0;g<b.length;g++)c[g]=128<=b[g]?-1*(b[g]-
127):b[g];return c},base64DecToArrclm:function(b){b=a(b);return new Uint8ClampedArray(b.buffer)}}}})(window);var progressBar={prvVal:"",currVal:"",progressInit:function(){var c=this;"undefined"!=typeof prvTimeout&&clearTimeout(prvTimeout);prvTimeout=setTimeout(function(){c.prvVal==c.currVal&&virtualclass.gObj.hasOwnProperty("downloadProgress")?virtualclass.recorder.initMakeAvailDownloadFile():(c.prvVal=c.currVal,c.progressInit())},5E4)},renderProgressBar:function(c,a,b,d){a>c&&(a=c,document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"));c=0==c&&0==a?0:Math.round(100*
a/c);b=document.getElementById(b);null!=b&&(b.style.width=c+"%");b=document.getElementById(d);null!=b&&(b.innerHTML=c+"%");100<=d&&(d=document.getElementById("recordingClose"),recordingClose.style.display="block",d.addEventListener("click",function(){virtualclass.popup.closeElem()}))}};if(!window.YT)var YT={loading:0,loaded:0};if(!window.YTConfig)var YTConfig={host:"http://www.youtube.com"};
YT.loading||(YT.loading=1,function(){var c=[];YT.ready=function(a){YT.loaded?a():c.push(a)};window.onYTReady=function(){YT.loaded=1;for(var a=0;a<c.length;a++)try{c[a]()}catch(b){}};YT.setConfig=function(a){for(var b in a)a.hasOwnProperty(b)&&(YTConfig[b]=a[b])};var a=document.createElement("script");a.type="text/javascript";a.id="www-widgetapi-script";a.src="https://s.ytimg.com/yts/jsbin/www-widgetapi-vfltoz0n9/www-widgetapi.js";a.async=!0;var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,
b)}());(function(c,a){var b=function(c){var f=0,g=-2,h=-1;return{retryForPalyer:1,player:"",init:function(a,b){if("undefined"!=typeof a&&"studentlayout"!=a.init)var c=a.init;if(!roles.hasAdmin()||roles.isEducator())if("undefined"==typeof c&&roles.isStudent())this.UI.defaultLayoutForStudent();else if(this.UI.container(),roles.hasControls()){if("undefined"!=typeof c)this.onYTIframApi(c,b,"fromReload");this.UI.inputURL();ioAdapter.mustSend({yts:{init:"studentlayout"},cf:"yts"})}else"undefined"!=typeof a?a.hasOwnProperty("fromReload")||
("undefined"==typeof c?this.UI.defaultLayoutForStudent():"undefined"==typeof b?this.onYTIframApi(c):this.onYTIframApi(c,b)):this.UI.defaultLayoutForStudent();else{this.UI.container();if("undefined"!=typeof b)this.onYTIframApi(c,b,"fromReload");this.UI.inputURL();ioAdapter.mustSend({yts:{init:"studentlayout"},cf:"yts"})}},destroyYT:function(){"object"==typeof virtualclass.yts.player&&("ScreenShare"==virtualclass.currApp&&ioAdapter.mustSend({yts:"destroyYT",cf:"yts"}),virtualclass.yts.player.destroy(),
virtualclass.yts.player="",virtualclass.yts.hasOwnProperty("tsc")&&clearInterval(virtualclass.yts.tsc))},UI:{id:"virtualclassYts","class":"virtualclass",container:function(){var b=a.getElementById(this.id);null!=b&&b.parentNode.removeChild(b);b=a.createElement("div");b.id=this.id;b.className=this["class"];this.createPlayerTag(b);var c=a.getElementById(virtualclass.rWidgetConfig.id);a.getElementById(virtualclass.html.id).insertBefore(b,c)},createPlayerTag:function(b){var c=a.createElement("div");c.id=
"player";b.appendChild(c)},defaultLayoutForStudent:function(){var b=a.getElementById(this.id);if(null==b){b=a.createElement("div");b.id=this.id;b.className=this["class"];var c=a.getElementById(virtualclass.rWidgetConfig.id);a.getElementById(virtualclass.html.id).insertBefore(b,c)}c=a.getElementById("youtubeUrlContainer");null!=c&&c.parentNode.removeChild(c);null==a.getElementById("messageLayout")&&(c=a.createElement("p"),c.id="messageLayout",c.innerHTML=virtualclass.lang.getString("teachermayshow"),
b.appendChild(c))},inputURL:function(){var b=a.getElementById("messageLayout");null!=b&&b.parentNode.removeChild(b);if(null==a.getElementById("youtubeUrlContainer")){b=a.createElement("div");b.id="youtubeUrlContainer";var c=a.createElement("input");c.id="youtubeurl";c.cols=70;c.rows=3;c.placeholder=virtualclass.lang.getString("youTubeUrl");a.getElementById("virtualclassYts").appendChild(c);b.appendChild(c);c=a.createElement("button");c.id="submitURL";c.innerHTML=virtualclass.lang.getString("shareYouTubeVideo");
b.appendChild(c);var d=a.getElementById("virtualclassYts"),f=a.getElementById("player");d.insertBefore(b,f.nextSibling);c.addEventListener("click",function(){var b=a.getElementById("youtubeurl").value,b=virtualclass.yts.getVideoId(b);"boolean"==typeof b?alert("Invalid YouTube URL."):(virtualclass.yts.videoId=b,virtualclass.yts.onYTIframApi(b),ioAdapter.mustSend({yts:{init:b},cf:"yts"}))})}},removeinputURL:function(){var b=a.getElementById("youtubeUrlContainer");null!=b&&b.parentNode.removeChild(b)}},
getVideoId:function(a){a=a.match(/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|\&v(?:i)?=))([^#\&\?]*).*/);return null!=a&&1<a.length&&(a=a[1].substring(0,11),11==a.length)?a:!1},onmessage:function(a){"string"==typeof a.yts?"play"==a.yts?this.player.playVideo():"pause"==a.yts?this.player.pauseVideo():"mute"==a.yts?this.player.mute():"unmute"==a.yts?this.player.unMute():"destroyYT"==a.yts&&virtualclass.yts.destroyYT():a.yts.hasOwnProperty("init")?virtualclass.makeAppReady("Yts",
void 0,a.yts):(a=parseInt(a.yts.seekto,10),this.player.hasOwnProperty("seekTo")&&this.player.seekTo(a))},onYTIframApi:function(c,d,f){"undefined"!=typeof c&&(this.videoId=c);if("object"==typeof this.player&&roles.hasControls())this.player.loadVideoById(c);else{var g=0;roles.hasControls()&&(g=1);g={playerVars:{autohide:0,disablekb:1,enablejsapi:1,modestbranding:1,controls:g,rel:0,fs:0,showinfo:0,start:"undefined"!=typeof d?Math.round(d):0},videoId:c,events:{onReady:this.onPlayerReady}};"undefined"!=
typeof d&&(g.start=d);console.log("Player object is CREATED");if("undefined"!=typeof f){var h=this;if(b.hasOwnProperty("ytApiReady"))h.player=new YT.Player("player",g);else{console.log("onYouTubeIframeAPIReady is not ready ");setTimeout(function(){h.onYTIframApi(c,d,f)},300);return}}else this.player=new YT.Player("player",g);g=a.getElementById(this.UI.id);g.className+=" youTubeSharing"}},triggerOnSeekChange:function(){console.log("there should happend something after each 2 second");if(0==f||-2==
g||-1==h)f=this.player.getCurrentTime(),g=this.player.getPlayerState(),h=this.player.isMuted();else{var a=Math.abs(this.player.getCurrentTime()-f);f=this.player.getCurrentTime();console.log(f);console.log(this.player.getCurrentTime());4<a&&this.ytOnSeek(this.player.getCurrentTime());this.player.getPlayerState()!=g&&3!=this.player.getPlayerState()&&(this.ytOnSeek(this.player.getCurrentTime()),this.ytOnChange(this.player.getPlayerState()),g=this.player.getPlayerState());this.player.isMuted()!=h&&(this.ytOnMuted(this.player.isMuted()),
h=this.player.isMuted())}},ytOnMuted:function(a){a?ioAdapter.mustSend({yts:"mute",cf:"yts"}):ioAdapter.mustSend({yts:"unmute",cf:"yts"});console.log("MUTED "+a)},ytOnSeek:function(a){ioAdapter.mustSend({yts:{seekto:a},cf:"yts"});console.log("SEEK CHANGED "+a)},ytOnChange:function(a){console.log("STATE CHANGED "+a);1==a?ioAdapter.mustSend({yts:"play",cf:"yts"}):2==a&&ioAdapter.mustSend({yts:"pause",cf:"yts"})},onPlayerReady:function(b){roles.hasControls()&&(a.getElementById("submitURL").innerHTML=
virtualclass.lang.getString("shareAnotherYouTubeVideo"));b.target.playVideo();virtualclass.yts.player.unMute();virtualclass.yts.player.setVolume(40);roles.hasControls()&&virtualclass.yts.seekChangeInterval()},seekChangeInterval:function(){virtualclass.yts.tsc=setInterval(function(){virtualclass.yts.triggerOnSeekChange()},2E3)}}};c.onYouTubeIframeAPIReady=function(){b.ytApiReady=!0;console.log("onYouTubeIframeAPIReady is ready now")};c.yts=b})(window,document);var CodeMirror=function(){function c(N,b){if(!(this instanceof c))return new c(N,b);this.options=b=b?ra(b):{};ra(pf,b,!1);t(b);var d=b.value;"string"==typeof d&&(d=new ka(d,b.mode,null,b.lineSeparator));this.doc=d;var sa=new c.inputStyles[b.inputStyle](this),sa=this.display=new a(N,d,sa);sa.wrapper.CodeMirror=this;n(this);h(this);b.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");b.autofocus&&!Ab&&sa.input.focus();v(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,
delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new Bb,keySeq:null,specialChars:null};var p=this;O&&11>V&&setTimeout(function(){p.display.input.reset(!0)},20);qf(this);Hd||(rf(),Hd=!0);fb(this);this.curOp.forceUpdate=!0;Id(this,d);b.autofocus&&!Ab||p.hasFocus()?setTimeout(Cb(Tc,this),20):Db(this);for(var f in gb)if(gb.hasOwnProperty(f))gb[f](this,b[f],Jd);C(this);b.finishInit&&b.finishInit(this);for(d=0;d<Uc.length;++d)Uc[d](this);hb(this);
aa&&b.lineWrapping&&"optimizelegibility"==getComputedStyle(sa.lineDiv).textRendering&&(sa.lineDiv.style.textRendering="auto")}function a(a,b,c){this.input=c;this.scrollbarFiller=D("div",null,"CodeMirror-scrollbar-filler");this.scrollbarFiller.setAttribute("cm-not-content","true");this.gutterFiller=D("div",null,"CodeMirror-gutter-filler");this.gutterFiller.setAttribute("cm-not-content","true");this.lineDiv=D("div",null,"CodeMirror-code");this.selectionDiv=D("div",null,null,"position: relative; z-index: 1");
this.cursorDiv=D("div",null,"CodeMirror-cursors");this.measure=D("div",null,"CodeMirror-measure");this.lineMeasure=D("div",null,"CodeMirror-measure");this.lineSpace=D("div",[this.measure,this.lineMeasure,this.selectionDiv,this.cursorDiv,this.lineDiv],null,"position: relative; outline: none");this.mover=D("div",[D("div",[this.lineSpace],"CodeMirror-lines")],null,"position: relative");this.sizer=D("div",[this.mover],"CodeMirror-sizer");this.sizerWidth=null;this.heightForcer=D("div",null,null,"position: absolute; height: "+
Kd+"px; width: 1px;");this.gutters=D("div",null,"CodeMirror-gutters");this.lineGutter=null;this.scroller=D("div",[this.sizer,this.heightForcer,this.gutters],"CodeMirror-scroll");this.scroller.setAttribute("tabIndex","-1");this.wrapper=D("div",[this.scrollbarFiller,this.gutterFiller,this.scroller],"CodeMirror");O&&8>V&&(this.gutters.style.zIndex=-1,this.scroller.style.paddingRight=0);aa||Sa&&Ab||(this.scroller.draggable=!0);a&&(a.appendChild?a.appendChild(this.wrapper):a(this.wrapper));this.reportedViewFrom=
this.reportedViewTo=this.viewFrom=this.viewTo=b.first;this.view=[];this.externalMeasured=this.renderedView=null;this.lastWrapHeight=this.lastWrapWidth=this.viewOffset=0;this.updateLineNumbers=null;this.nativeBarWidth=this.barHeight=this.barWidth=0;this.scrollbarsClipped=!1;this.lineNumWidth=this.lineNumInnerWidth=this.lineNumChars=null;this.alignWidgets=!1;this.maxLine=this.cachedCharWidth=this.cachedTextHeight=this.cachedPaddingH=null;this.maxLineLength=0;this.maxLineChanged=!1;this.wheelDX=this.wheelDY=
this.wheelStartX=this.wheelStartY=null;this.shift=!1;this.activeTouch=this.selForContextMenu=null;c.init(this)}function b(a){a.doc.mode=c.getMode(a.options,a.doc.modeOption);d(a)}function d(a){a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null)});a.doc.frontier=a.doc.first;Eb(a,100);a.state.modeGen++;a.curOp&&la(a)}function f(a){var b=Ta(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/Fb(a.display)-3);return function(p){if(Ua(a.doc,
p))return 0;var f=0;if(p.widgets)for(var g=0;g<p.widgets.length;g++)p.widgets[g].height&&(f+=p.widgets[g].height);return c?f+(Math.ceil(p.text.length/d)||1)*b:f+b}}function g(a){var b=a.doc,c=f(a);b.iter(function(a){var N=c(a);N!=a.height&&ya(a,N)})}function h(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-");Gb(a)}function m(a){n(a);la(a);setTimeout(function(){L(a)},20)}function n(a){var b=a.display.gutters,c=a.options.gutters;
Va(b);for(var d=0;d<c.length;++d){var p=c[d],f=b.appendChild(D("div",null,"CodeMirror-gutter "+p));"CodeMirror-linenumbers"==p&&(a.display.lineGutter=f,f.style.width=(a.display.lineNumWidth||1)+"px")}b.style.display=d?"":"none";q(a)}function q(a){a.display.sizer.style.marginLeft=a.display.gutters.offsetWidth+"px"}function u(a){if(0==a.height)return 0;for(var b=a.text.length,c,d=a;c=Wa(d,!0);)c=c.find(0,!0),d=c.from.line,b+=c.from.ch-c.to.ch;for(d=a;c=Wa(d,!1);)c=c.find(0,!0),b-=d.text.length-c.from.ch,
d=c.to.line,b+=d.text.length-c.to.ch;return b}function w(a){var b=a.display;a=a.doc;b.maxLine=E(a,a.first);b.maxLineLength=u(b.maxLine);b.maxLineChanged=!0;a.iter(function(a){var N=u(a);N>b.maxLineLength&&(b.maxLineLength=N,b.maxLine=a)})}function t(a){var b=fa(a.gutters,"CodeMirror-linenumbers");-1==b&&a.lineNumbers?a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):-1<b&&!a.lineNumbers&&(a.gutters=a.gutters.slice(0),a.gutters.splice(b,1))}function x(a){var b=a.display,c=b.gutters.offsetWidth,
d=Math.round(a.doc.height+Vc(a.display));return{clientHeight:b.scroller.clientHeight,viewHeight:b.wrapper.clientHeight,scrollWidth:b.scroller.scrollWidth,clientWidth:b.scroller.clientWidth,viewWidth:b.wrapper.clientWidth,barLeft:a.options.fixedGutter?c:0,docHeight:d,scrollHeight:d+za(a)+b.barHeight,nativeBarWidth:b.nativeBarWidth,gutterWidth:c}}function r(a,b,c){this.cm=c;var d=this.vert=D("div",[D("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),p=this.horiz=D("div",[D("div",null,null,
"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");a(d);a(p);F(d,"scroll",function(){d.clientHeight&&b(d.scrollTop,"vertical")});F(p,"scroll",function(){p.clientWidth&&b(p.scrollLeft,"horizontal")});this.checkedOverlay=!1;O&&8>V&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")}function s(){}function v(a){a.display.scrollbars&&(a.display.scrollbars.clear(),a.display.scrollbars.addClass&&Hb(a.display.wrapper,a.display.scrollbars.addClass));a.display.scrollbars=new c.scrollbarModel[a.options.scrollbarStyle](function(b){a.display.wrapper.insertBefore(b,
a.display.scrollbarFiller);F(b,"mousedown",function(){a.state.focused&&setTimeout(function(){a.display.input.focus()},0)});b.setAttribute("cm-not-content","true")},function(b,c){"horizontal"==c?ib(a,b):Ib(a,b)},a);a.display.scrollbars.addClass&&Jb(a.display.wrapper,a.display.scrollbars.addClass)}function B(a,b){b||(b=x(a));var c=a.display.barWidth,d=a.display.barHeight;K(a,b);for(var p=0;4>p&&c!=a.display.barWidth||d!=a.display.barHeight;p++)c!=a.display.barWidth&&a.options.lineWrapping&&jb(a),K(a,
x(a)),c=a.display.barWidth,d=a.display.barHeight}function K(a,b){var c=a.display,d=c.scrollbars.update(b);c.sizer.style.paddingRight=(c.barWidth=d.right)+"px";c.sizer.style.paddingBottom=(c.barHeight=d.bottom)+"px";d.right&&d.bottom?(c.scrollbarFiller.style.display="block",c.scrollbarFiller.style.height=d.bottom+"px",c.scrollbarFiller.style.width=d.right+"px"):c.scrollbarFiller.style.display="";d.bottom&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(c.gutterFiller.style.display="block",
c.gutterFiller.style.height=d.bottom+"px",c.gutterFiller.style.width=b.gutterWidth+"px"):c.gutterFiller.style.display=""}function J(a,b,c){var d=c&&null!=c.top?Math.max(0,c.top):a.scroller.scrollTop,d=Math.floor(d-a.lineSpace.offsetTop),p=c&&null!=c.bottom?c.bottom:d+a.wrapper.clientHeight,d=Xa(b,d),p=Xa(b,p);if(c&&c.ensure){var f=c.ensure.from.line;c=c.ensure.to.line;f<d?(d=f,p=Xa(b,Aa(E(b,f))+a.wrapper.clientHeight)):Math.min(c,b.lastLine())>=p&&(d=Xa(b,Aa(E(b,c))-a.wrapper.clientHeight),p=c)}return{from:d,
to:Math.max(p,d+1)}}function L(a){var b=a.display,c=b.view;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var d=A(b)-b.scroller.scrollLeft+a.doc.scrollLeft,p=b.gutters.offsetWidth,f=d+"px",g=0;g<c.length;g++)if(!c[g].hidden){a.options.fixedGutter&&c[g].gutter&&(c[g].gutter.style.left=f);var h=c[g].alignable;if(h)for(var m=0;m<h.length;m++)h[m].style.left=f}a.options.fixedGutter&&(b.gutters.style.left=d+p+"px")}}function C(a){if(!a.options.lineNumbers)return!1;var b=a.doc,b=R(a.options,
b.first+b.size-1),c=a.display;if(b.length!=c.lineNumChars){var d=c.measure.appendChild(D("div",[D("div",b)],"CodeMirror-linenumber CodeMirror-gutter-elt")),p=d.firstChild.offsetWidth,d=d.offsetWidth-p;c.lineGutter.style.width="";c.lineNumInnerWidth=Math.max(p,c.lineGutter.offsetWidth-d)+1;c.lineNumWidth=c.lineNumInnerWidth+d;c.lineNumChars=c.lineNumInnerWidth?b.length:-1;c.lineGutter.style.width=c.lineNumWidth+"px";q(a);return!0}return!1}function R(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}
function A(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function T(a,b,c){var d=a.display;this.viewport=b;this.visible=J(d,a.doc,b);this.editorIsHidden=!d.wrapper.offsetWidth;this.wrapperHeight=d.wrapper.clientHeight;this.wrapperWidth=d.wrapper.clientWidth;this.oldDisplayWidth=La(a);this.force=c;this.dims=Kb(a);this.events=[]}function da(a,b){var c=a.display,d=a.doc;if(b.editorIsHidden)return Ma(a),!1;if(!b.force&&b.visible.from>=c.viewFrom&&b.visible.to<=
c.viewTo&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo)&&c.renderedView==c.view&&0==Ld(a))return!1;C(a)&&(Ma(a),b.dims=Kb(a));var p=d.first+d.size,f=Math.max(b.visible.from-a.options.viewportMargin,d.first),g=Math.min(p,b.visible.to+a.options.viewportMargin);c.viewFrom<f&&20>f-c.viewFrom&&(f=Math.max(d.first,c.viewFrom));c.viewTo>g&&20>c.viewTo-g&&(g=Math.min(p,c.viewTo));Na&&(f=Wc(a.doc,f),g=Md(a.doc,g));d=f!=c.viewFrom||g!=c.viewTo||c.lastWrapHeight!=b.wrapperHeight||c.lastWrapWidth!=
b.wrapperWidth;p=a.display;0==p.view.length||f>=p.viewTo||g<=p.viewFrom?(p.view=gc(a,f,g),p.viewFrom=f):(p.viewFrom>f?p.view=gc(a,f,p.viewFrom).concat(p.view):p.viewFrom<f&&(p.view=p.view.slice(Ya(a,f))),p.viewFrom=f,p.viewTo<g?p.view=p.view.concat(gc(a,p.viewTo,g)):p.viewTo>g&&(p.view=p.view.slice(0,Ya(a,g))));p.viewTo=g;c.viewOffset=Aa(E(a.doc,c.viewFrom));a.display.mover.style.top=c.viewOffset+"px";g=Ld(a);if(!d&&0==g&&!b.force&&c.renderedView==c.view&&(null==c.updateLineNumbers||c.updateLineNumbers>=
c.viewTo))return!1;f=Ba();4<g&&(c.lineDiv.style.display="none");Xc(a,c.updateLineNumbers,b.dims);4<g&&(c.lineDiv.style.display="");c.renderedView=c.view;f&&Ba()!=f&&f.offsetHeight&&f.focus();Va(c.cursorDiv);Va(c.selectionDiv);c.gutters.style.height=c.sizer.style.minHeight=0;d&&(c.lastWrapHeight=b.wrapperHeight,c.lastWrapWidth=b.wrapperWidth,Eb(a,400));c.updateLineNumbers=null;return!0}function W(a,b){for(var c=b.viewport,d=!0;;d=!1){if(!d||!a.options.lineWrapping||b.oldDisplayWidth==La(a))if(c&&null!=
c.top&&(c={top:Math.min(a.doc.height+Vc(a.display)-Yc(a),c.top)}),b.visible=J(a.display,a.doc,c),b.visible.from>=a.display.viewFrom&&b.visible.to<=a.display.viewTo)break;if(!da(a,b))break;jb(a);d=x(a);Lb(a);kb(a,d);B(a,d)}b.signal(a,"update",a);if(a.display.viewFrom!=a.display.reportedViewFrom||a.display.viewTo!=a.display.reportedViewTo)b.signal(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo),a.display.reportedViewFrom=a.display.viewFrom,a.display.reportedViewTo=a.display.viewTo}function U(a,
b){var c=new T(a,b);if(da(a,c)){jb(a);W(a,c);var d=x(a);Lb(a);kb(a,d);B(a,d);c.finish()}}function kb(a,b){a.display.sizer.style.minHeight=b.docHeight+"px";var c=b.docHeight+a.display.barHeight;a.display.heightForcer.style.top=c+"px";a.display.gutters.style.height=Math.max(c+za(a),b.clientHeight)+"px"}function jb(a){a=a.display;for(var b=a.lineDiv.offsetTop,c=0;c<a.view.length;c++){var d=a.view[c],p;if(!d.hidden){if(O&&8>V){var f=d.node.offsetTop+d.node.offsetHeight;p=f-b;b=f}else p=d.node.getBoundingClientRect(),
p=p.bottom-p.top;f=d.line.height-p;2>p&&(p=Ta(a));if(.001<f||-.001>f)if(ya(d.line,p),hc(d.line),d.rest)for(p=0;p<d.rest.length;p++)hc(d.rest[p])}}}function hc(a){if(a.widgets)for(var b=0;b<a.widgets.length;++b)a.widgets[b].height=a.widgets[b].node.offsetHeight}function Kb(a){for(var b=a.display,c={},d={},p=b.gutters.clientLeft,f=b.gutters.firstChild,g=0;f;f=f.nextSibling,++g)c[a.options.gutters[g]]=f.offsetLeft+f.clientLeft+p,d[a.options.gutters[g]]=f.clientWidth;return{fixedPos:A(b),gutterTotalWidth:b.gutters.offsetWidth,
gutterLeft:c,gutterWidth:d,wrapperWidth:b.wrapper.clientWidth}}function Xc(a,b,c){function d(b){var c=b.nextSibling;aa&&ta&&a.display.currentWheelTarget==b?b.style.display="none":b.parentNode.removeChild(b);return c}for(var p=a.display,f=a.options.lineNumbers,g=p.lineDiv,h=g.firstChild,m=p.view,p=p.viewFrom,n=0;n<m.length;n++){var r=m[n];if(!r.hidden)if(r.node&&r.node.parentNode==g){for(;h!=r.node;)h=d(h);h=f&&null!=b&&b<=p&&r.lineNumber;r.changes&&(-1<fa(r.changes,"gutter")&&(h=!1),lb(a,r,p,c));
h&&(Va(r.lineNumber),r.lineNumber.appendChild(document.createTextNode(R(a.options,p))));h=r.node.nextSibling}else{var s=sf(a,r,p,c);g.insertBefore(s,h)}p+=r.size}for(;h;)h=d(h)}function lb(a,b,c,d){for(var p=0;p<b.changes.length;p++){var f=b.changes[p];if("text"==f){var f=b,g=f.text.className,h=Oa(a,f);f.text==f.node&&(f.node=h.pre);f.text.parentNode.replaceChild(h.pre,f.text);f.text=h.pre;h.bgClass!=f.bgClass||h.textClass!=f.textClass?(f.bgClass=h.bgClass,f.textClass=h.textClass,Y(f)):g&&(f.text.className=
g)}else if("gutter"==f)Nd(a,b,c,d);else if("class"==f)Y(b);else if("widget"==f){f=a;g=b;h=d;g.alignable&&(g.alignable=null);for(var m=g.node.firstChild,n=void 0;m;m=n)n=m.nextSibling,"CodeMirror-linewidget"==m.className&&g.node.removeChild(m);Od(f,g,h)}}b.changes=null}function Pa(a){a.node==a.text&&(a.node=D("div",null,null,"position: relative"),a.text.parentNode&&a.text.parentNode.replaceChild(a.node,a.text),a.node.appendChild(a.text),O&&8>V&&(a.node.style.zIndex=2));return a.node}function Oa(a,
b){var c=a.display.externalMeasured;return c&&c.line==b.line?(a.display.externalMeasured=null,b.measure=c.measure,c.built):Pd(a,b)}function Y(a){var b=a.bgClass?a.bgClass+" "+(a.line.bgClass||""):a.line.bgClass;b&&(b+=" CodeMirror-linebackground");if(a.background)b?a.background.className=b:(a.background.parentNode.removeChild(a.background),a.background=null);else if(b){var c=Pa(a);a.background=c.insertBefore(D("div",null,b),c.firstChild)}a.line.wrapClass?Pa(a).className=a.line.wrapClass:a.node!=a.text&&
(a.node.className="");a.text.className=(a.textClass?a.textClass+" "+(a.line.textClass||""):a.line.textClass)||""}function Nd(a,b,c,d){b.gutter&&(b.node.removeChild(b.gutter),b.gutter=null);b.gutterBackground&&(b.node.removeChild(b.gutterBackground),b.gutterBackground=null);if(b.line.gutterClass){var p=Pa(b);b.gutterBackground=D("div",null,"CodeMirror-gutter-background "+b.line.gutterClass,"left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px; width: "+d.gutterTotalWidth+"px");p.insertBefore(b.gutterBackground,
b.text)}var f=b.line.gutterMarkers;if(a.options.lineNumbers||f){var p=Pa(b),g=b.gutter=D("div",null,"CodeMirror-gutter-wrapper","left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px");a.display.input.setUneditable(g);p.insertBefore(g,b.text);b.line.gutterClass&&(g.className+=" "+b.line.gutterClass);!a.options.lineNumbers||f&&f["CodeMirror-linenumbers"]||(b.lineNumber=g.appendChild(D("div",R(a.options,c),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+d.gutterLeft["CodeMirror-linenumbers"]+
"px; width: "+a.display.lineNumInnerWidth+"px")));if(f)for(b=0;b<a.options.gutters.length;++b)c=a.options.gutters[b],(p=f.hasOwnProperty(c)&&f[c])&&g.appendChild(D("div",[p],"CodeMirror-gutter-elt","left: "+d.gutterLeft[c]+"px; width: "+d.gutterWidth[c]+"px"))}}function sf(a,b,c,d){var p=Oa(a,b);b.text=b.node=p.pre;p.bgClass&&(b.bgClass=p.bgClass);p.textClass&&(b.textClass=p.textClass);Y(b);Nd(a,b,c,d);Od(a,b,d);return b.node}function Od(a,b,c){Qd(a,b.line,b,c,!0);if(b.rest)for(var d=0;d<b.rest.length;d++)Qd(a,
b.rest[d],b,c,!1)}function Qd(a,b,c,d,p){if(b.widgets){var f=Pa(c),g=0;for(b=b.widgets;g<b.length;++g){var h=b[g],m=D("div",[h.node],"CodeMirror-linewidget");h.handleMouseEvents||m.setAttribute("cm-ignore-events","true");var n=h,r=m,s=d;if(n.noHScroll){(c.alignable||(c.alignable=[])).push(r);var q=s.wrapperWidth;r.style.left=s.fixedPos+"px";n.coverGutter||(q-=s.gutterTotalWidth,r.style.paddingLeft=s.gutterTotalWidth+"px");r.style.width=q+"px"}n.coverGutter&&(r.style.zIndex=5,r.style.position="relative",
n.noHScroll||(r.style.marginLeft=-s.gutterTotalWidth+"px"));a.display.input.setUneditable(m);p&&h.above?f.insertBefore(m,c.gutter||c.text):f.appendChild(m);ga(h,"redraw")}}}function Zc(a){return z(a.line,a.ch)}function ic(a,b){return 0>I(a,b)?b:a}function jc(a,b){return 0>I(a,b)?a:b}function Rd(a){a.state.focused||(a.display.input.focus(),Tc(a))}function kc(a){return a.options.readOnly||a.doc.cantEdit}function lc(a,b,c,d,p){var f=a.doc;a.display.shift=!1;d||(d=f.sel);var g=a.state.pasteIncoming||
"paste"==p,h=f.splitLines(b),m=null;if(g&&1<d.ranges.length)if(oa&&oa.join("\n")==b){if(0==d.ranges.length%oa.length)for(var m=[],n=0;n<oa.length;n++)m.push(f.splitLines(oa[n]))}else h.length==d.ranges.length&&(m=nc(h,function(a){return[a]}));for(n=d.ranges.length-1;0<=n;n--){var r=d.ranges[n],s=r.from(),q=r.to();r.empty()&&(c&&0<c?s=z(s.line,s.ch-c):a.state.overwrite&&!g&&(q=z(q.line,Math.min(E(f,q.line).text.length,q.ch+P(h).length))));r=a.curOp.updateInput;s={from:s,to:q,text:m?m[n%m.length]:h,
origin:p||(g?"paste":a.state.cutIncoming?"cut":"+input")};mb(a.doc,s);ga(a,"inputRead",a,s)}b&&!g&&Sd(a,b);nb(a);a.curOp.updateInput=r;a.curOp.typing=!0;a.state.pasteIncoming=a.state.cutIncoming=!1}function Td(a,b){var c=a.clipboardData&&a.clipboardData.getData("text/plain");if(c)return a.preventDefault(),ma(b,function(){lc(b,c,0,null,"paste")}),!0}function Sd(a,b){if(a.options.electricChars&&a.options.smartIndent)for(var c=a.doc.sel,d=c.ranges.length-1;0<=d;d--){var p=c.ranges[d];if(!(100<p.head.ch||
d&&c.ranges[d-1].head.line==p.head.line)){var f=a.getModeAt(p.head),g=!1;if(f.electricChars)for(var h=0;h<f.electricChars.length;h++){if(-1<b.indexOf(f.electricChars.charAt(h))){g=Mb(a,p.head.line,"smart");break}}else f.electricInput&&f.electricInput.test(E(a.doc,p.head.line).text.slice(0,p.head.ch))&&(g=Mb(a,p.head.line,"smart"));g&&ga(a,"electricInput",a,p.head.line)}}}function Ud(a){for(var b=[],c=[],d=0;d<a.doc.sel.ranges.length;d++){var p=a.doc.sel.ranges[d].head.line,p={anchor:z(p,0),head:z(p+
1,0)};c.push(p);b.push(a.getRange(p.anchor,p.head))}return{text:b,ranges:c}}function Vd(a){a.setAttribute("autocorrect","off");a.setAttribute("autocapitalize","off");a.setAttribute("spellcheck","false")}function $c(a){this.cm=a;this.prevInput="";this.pollingFast=!1;this.polling=new Bb;this.hasSelection=this.inaccurateSelection=!1;this.composing=null}function Wd(){var a=D("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none"),b=D("div",[a],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");
aa?a.style.width="1000px":a.setAttribute("wrap","off");ob&&(a.style.border="1px solid black");Vd(a);return b}function ad(a){this.cm=a;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new Bb;this.gracePeriod=!1}function Xd(a,b){var c=bd(a,b.line);if(!c||c.hidden)return null;var d=E(a.doc,b.line),c=Yd(c,d,b.line),d=ua(d),p="left";d&&(p=oc(d,b.ch)%2?"right":"left");c=Zd(c.map,b.ch,p);c.offset="right"==c.collapse?c.end:c.start;return c}function pb(a,
b){b&&(a.bad=!0);return a}function pc(a,b,c){var d;if(b==a.display.lineDiv){d=a.display.lineDiv.childNodes[c];if(!d)return pb(a.clipPos(z(a.display.viewTo-1)),!0);b=null;c=0}else for(d=b;;d=d.parentNode){if(!d||d==a.display.lineDiv)return null;if(d.parentNode&&d.parentNode==a.display.lineDiv)break}for(var p=0;p<a.display.view.length;p++){var f=a.display.view[p];if(f.node==d)return tf(f,b,c)}}function tf(a,b,c){function d(b,c,M){for(var ca=-1;ca<(n?n.length:0);ca++)for(var sa=0>ca?m.map:n[ca],p=0;p<
sa.length;p+=3){var f=sa[p+2];if(f==b||f==c){c=Q(0>ca?a.line:a.rest[ca]);ca=sa[p]+M;if(0>M||f!=b)ca=sa[p+(M?1:0)];return z(c,ca)}}}var p=a.text.firstChild,f=!1;if(!b||!cd(p,b))return pb(z(Q(a.line),0),!0);if(b==p&&(f=!0,b=p.childNodes[c],c=0,!b))return c=a.rest?P(a.rest):a.line,pb(z(Q(c),c.text.length),f);var g=3==b.nodeType?b:null,h=b;g||1!=b.childNodes.length||3!=b.firstChild.nodeType||(g=b.firstChild,c&&(c=g.nodeValue.length));for(;h.parentNode!=p;)h=h.parentNode;var m=a.measure,n=m.maps;if(b=
d(g,h,c))return pb(b,f);p=h.nextSibling;for(g=g?g.nodeValue.length-c:0;p;p=p.nextSibling){if(b=d(p,p.firstChild,0))return pb(z(b.line,b.ch-g),f);g+=p.textContent.length}h=h.previousSibling;for(g=c;h;h=h.previousSibling){if(b=d(h,h.firstChild,-1))return pb(z(b.line,b.ch+g),f);g+=p.textContent.length}}function uf(a,b,c,d,p){function f(a){return function(b){return b.id==a}}function g(b){if(1==b.nodeType){var c=b.getAttribute("cm-text");if(null!=c)""==c&&(c=b.textContent.replace(/\u200b/g,"")),h+=c;else{var c=
b.getAttribute("cm-marker"),M;if(c)b=a.findMarks(z(d,0),z(p+1,0),f(+c)),b.length&&(M=b[0].find())&&(h+=Za(a.doc,M.from,M.to).join(n));else if("false"!=b.getAttribute("contenteditable")){for(M=0;M<b.childNodes.length;M++)g(b.childNodes[M]);/^(pre|div|p)$/i.test(b.nodeName)&&(m=!0)}}}else 3==b.nodeType&&(b=b.nodeValue)&&(m&&(h+=n,m=!1),h+=b)}for(var h="",m=!1,n=a.doc.lineSeparator();;){g(b);if(b==c)break;b=b.nextSibling}return h}function Ha(a,b){this.ranges=a;this.primIndex=b}function S(a,b){this.anchor=
a;this.head=b}function va(a,b){var c=a[b];a.sort(function(a,b){return I(a.from(),b.from())});b=fa(a,c);for(c=1;c<a.length;c++){var d=a[c],p=a[c-1];if(0<=I(p.to(),d.from())){var f=jc(p.from(),d.from()),g=ic(p.to(),d.to()),d=p.empty()?d.from()==d.head:p.from()==p.head;c<=b&&--b;a.splice(--c,2,new S(d?g:f,d?f:g))}}return new Ha(a,b)}function Ca(a,b){return new Ha([new S(a,b||a)],0)}function H(a,b){if(b.line<a.first)return z(a.first,0);var c=a.first+a.size-1;if(b.line>c)return z(c,E(a,c).text.length);
var c=E(a,b.line).text.length,d=b.ch,c=null==d||d>c?z(b.line,c):0>d?z(b.line,0):b;return c}function Nb(a,b){return b>=a.first&&b<a.first+a.size}function Ob(a,b,c,d){return a.cm&&a.cm.display.shift||a.extend?(a=b.anchor,d&&(b=0>I(c,a),b!=0>I(d,a)?(a=c,c=d):b!=0>I(c,d)&&(c=d)),new S(a,c)):new S(d||c,c)}function qc(a,b,c,d){ba(a,new Ha([Ob(a,a.sel.primary(),b,c)],0),d)}function $d(a,b,c){for(var d=[],p=0;p<a.sel.ranges.length;p++)d[p]=Ob(a,a.sel.ranges[p],b[p],null);b=va(d,a.sel.primIndex);ba(a,b,c)}
function dd(a,b,c,d){var p=a.sel.ranges.slice(0);p[b]=c;ba(a,va(p,a.sel.primIndex),d)}function vf(a,b){var c={ranges:b.ranges,update:function(b){this.ranges=[];for(var c=0;c<b.length;c++)this.ranges[c]=new S(H(a,b[c].anchor),H(a,b[c].head))}};Z(a,"beforeSelectionChange",a,c);a.cm&&Z(a.cm,"beforeSelectionChange",a.cm,c);return c.ranges!=b.ranges?va(c.ranges,c.ranges.length-1):b}function ae(a,b,c){var d=a.history.done,p=P(d);p&&p.ranges?(d[d.length-1]=b,rc(a,b,c)):ba(a,b,c)}function ba(a,b,c){rc(a,
b,c);b=a.sel;var d=a.cm?a.cm.curOp.id:NaN,p=a.history,f=c&&c.origin,g;if(!(g=d==p.lastSelOp)&&(g=f&&p.lastSelOrigin==f)&&!(g=p.lastModTime==p.lastSelTime&&p.lastOrigin==f)){g=P(p.done);var h=f.charAt(0);g="*"==h||"+"==h&&g.ranges.length==b.ranges.length&&g.somethingSelected()==b.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}g?p.done[p.done.length-1]=b:sc(b,p.done);p.lastSelTime=+new Date;p.lastSelOrigin=f;p.lastSelOp=d;c&&!1!==c.clearRedo&&be(p.undone)}
function rc(a,b,c){if(pa(a,"beforeSelectionChange")||a.cm&&pa(a.cm,"beforeSelectionChange"))b=vf(a,b);var d=c&&c.bias||(0>I(b.primary().head,a.sel.primary().head)?-1:1);ce(a,de(a,b,d,!0));c&&!1===c.scroll||!a.cm||nb(a.cm)}function ce(a,b){b.equals(a.sel)||(a.sel=b,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0,ee(a.cm)),ga(a,"cursorActivity",a))}function fe(a){ce(a,de(a,a.sel,null,!1),Da)}function de(a,b,c,d){for(var p,f=0;f<b.ranges.length;f++){var g=b.ranges[f],h=tc(a,g.anchor,c,d),
m=tc(a,g.head,c,d);if(p||h!=g.anchor||m!=g.head)p||(p=b.ranges.slice(0,f)),p[f]=new S(h,m)}return p?va(p,b.primIndex):b}function tc(a,b,c,d){var p=!1,f=b,g=c||1;a.cantEdit=!1;a:for(;;){var h=E(a,f.line);if(h.markedSpans)for(var m=0;m<h.markedSpans.length;++m){var n=h.markedSpans[m],r=n.marker;if((null==n.from||(r.inclusiveLeft?n.from<=f.ch:n.from<f.ch))&&(null==n.to||(r.inclusiveRight?n.to>=f.ch:n.to>f.ch))){if(d&&(Z(r,"beforeCursorEnter"),r.explicitlyCleared))if(h.markedSpans){--m;continue}else break;
if(r.atomic){m=r.find(0>g?-1:1);if(0==I(m,f)&&(m.ch+=g,0>m.ch?m=m.line>a.first?H(a,z(m.line-1)):null:m.ch>h.text.length&&(m=m.line<a.first+a.size-1?z(m.line+1,0):null),!m)){if(p){if(!d)return tc(a,b,c,!0);a.cantEdit=!0;return z(a.first,0)}p=!0;m=b;g=-g}f=m;continue a}}}return f}}function Lb(a){a.display.input.showSelection(a.display.input.prepareSelection())}function ge(a,b){for(var c=a.doc,d={},p=d.cursors=document.createDocumentFragment(),f=d.selection=document.createDocumentFragment(),g=0;g<c.sel.ranges.length;g++)if(!1!==
b||g!=c.sel.primIndex){var h=c.sel.ranges[g],m=h.empty();if(m||a.options.showCursorWhenSelecting){var n=a,r=p,s=Ia(n,h.head,"div",null,null,!n.options.singleCursorHeightPerLine),q=r.appendChild(D("div","\u00a0","CodeMirror-cursor"));q.style.left=s.left+"px";q.style.top=s.top+"px";q.style.height=Math.max(0,s.bottom-s.top)*n.options.cursorHeight+"px";s.other&&(n=r.appendChild(D("div","\u00a0","CodeMirror-cursor CodeMirror-secondarycursor")),n.style.display="",n.style.left=s.other.left+"px",n.style.top=
s.other.top+"px",n.style.height=.85*(s.other.bottom-s.other.top)+"px")}m||wf(a,h,f)}return d}function wf(a,b,c){function d(a,b,N,c){0>b&&(b=0);b=Math.round(b);c=Math.round(c);h.appendChild(D("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+b+"px; width: "+(null==N?r-a:N)+"px; height: "+(c-b)+"px"))}function p(b,c,M){var ca=E(g,b),p=ca.text.length,f,h;xf(ua(ca),c||0,null==M?p:M,function(g,m,ja){var s=uc(a,z(b,g),"div",ca,"left"),q,fc;g==m?(q=s,ja=fc=s.left):(q=uc(a,z(b,m-
1),"div",ca,"right"),"rtl"==ja&&(ja=s,s=q,q=ja),ja=s.left,fc=q.right);null==c&&0==g&&(ja=n);3<q.top-s.top&&(d(ja,s.top,null,s.bottom),ja=n,s.bottom<q.top&&d(ja,s.bottom,null,q.top));null==M&&m==p&&(fc=r);if(!f||s.top<f.top||s.top==f.top&&s.left<f.left)f=s;if(!h||q.bottom>h.bottom||q.bottom==h.bottom&&q.right>h.right)h=q;ja<n+1&&(ja=n);d(ja,q.top,fc-ja,q.bottom)});return{start:f,end:h}}var f=a.display,g=a.doc,h=document.createDocumentFragment(),m=he(a.display),n=m.left,r=Math.max(f.sizerWidth,La(a)-
f.sizer.offsetLeft)-m.right,f=b.from();b=b.to();if(f.line==b.line)p(f.line,f.ch,b.ch);else{var s=E(g,f.line),m=E(g,b.line),m=Ea(s)==Ea(m),f=p(f.line,f.ch,m?s.text.length+1:null).end;b=p(b.line,m?0:null,b.ch).start;m&&(f.top<b.top-2?(d(f.right,f.top,null,f.bottom),d(n,b.top,b.left,b.bottom)):d(f.right,f.top,b.left-f.right,f.bottom));f.bottom<b.top&&d(n,f.bottom,null,b.top)}c.appendChild(h)}function ed(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursorDiv.style.visibility=
"";0<a.options.cursorBlinkRate?b.blinker=setInterval(function(){b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate):0>a.options.cursorBlinkRate&&(b.cursorDiv.style.visibility="hidden")}}function Eb(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.viewTo&&a.state.highlight.set(b,Cb(yf,a))}function yf(a){var b=a.doc;b.frontier<b.first&&(b.frontier=b.first);if(!(b.frontier>=a.display.viewTo)){var c=+new Date+a.options.workTime,d=qb(b.mode,Pb(a,b.frontier)),p=[];b.iter(b.frontier,
Math.min(b.first+b.size,a.display.viewTo+500),function(f){if(b.frontier>=a.display.viewFrom){var g=f.styles,h=ie(a,f,d,!0);f.styles=h.styles;var m=f.styleClasses;(h=h.classes)?f.styleClasses=h:m&&(f.styleClasses=null);m=!g||g.length!=f.styles.length||m!=h&&(!m||!h||m.bgClass!=h.bgClass||m.textClass!=h.textClass);for(h=0;!m&&h<g.length;++h)m=g[h]!=f.styles[h];m&&p.push(b.frontier);f.stateAfter=qb(b.mode,d)}else fd(a,f.text,d),f.stateAfter=0==b.frontier%5?qb(b.mode,d):null;++b.frontier;if(+new Date>
c)return Eb(a,a.options.workDelay),!0});p.length&&ma(a,function(){for(var b=0;b<p.length;b++)Ja(a,p[b],"text")})}}function zf(a,b,c){for(var d,p,f=a.doc,g=c?-1:b-(a.doc.mode.innerMode?1E3:100);b>g;--b){if(b<=f.first)return f.first;var h=E(f,b-1);if(h.stateAfter&&(!c||b<=f.frontier))return b;h=wa(h.text,null,a.options.tabSize);if(null==p||d>h)p=b-1,d=h}return p}function Pb(a,b,c){var d=a.doc,p=a.display;if(!d.mode.startState)return!0;var f=zf(a,b,c),g=f>d.first&&E(d,f-1).stateAfter,g=g?qb(d.mode,g):
Af(d.mode);d.iter(f,b,function(c){fd(a,c.text,g);c.stateAfter=f==b-1||0==f%5||f>=p.viewFrom&&f<p.viewTo?qb(d.mode,g):null;++f});c&&(d.frontier=f);return g}function Vc(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function he(a){if(a.cachedPaddingH)return a.cachedPaddingH;var b=qa(a.measure,D("pre","x")),b=window.getComputedStyle?window.getComputedStyle(b):b.currentStyle,b={left:parseInt(b.paddingLeft),right:parseInt(b.paddingRight)};isNaN(b.left)||isNaN(b.right)||(a.cachedPaddingH=b);return b}
function za(a){return Kd-a.display.nativeBarWidth}function La(a){return a.display.scroller.clientWidth-za(a)-a.display.barWidth}function Yc(a){return a.display.scroller.clientHeight-za(a)-a.display.barHeight}function Yd(a,b,c){if(a.line==b)return{map:a.measure.map,cache:a.measure.cache};for(var d=0;d<a.rest.length;d++)if(a.rest[d]==b)return{map:a.measure.maps[d],cache:a.measure.caches[d]};for(d=0;d<a.rest.length;d++)if(Q(a.rest[d])>c)return{map:a.measure.maps[d],cache:a.measure.caches[d],before:!0}}
function bd(a,b){if(b>=a.display.viewFrom&&b<a.display.viewTo)return a.display.view[Ya(a,b)];var c=a.display.externalMeasured;if(c&&b>=c.lineN&&b<c.lineN+c.size)return c}function vc(a,b){var c=Q(b),d=bd(a,c);d&&!d.text?d=null:d&&d.changes&&(lb(a,d,c,Kb(a)),a.curOp.forceUpdate=!0);if(!d){var p;p=Ea(b);d=Q(p);p=a.display.externalMeasured=new je(a.doc,p,d);p.lineN=d;d=p.built=Pd(a,p);p.text=d.pre;qa(a.display.lineMeasure,d.pre);d=p}c=Yd(d,b,c);return{line:b,view:d,rect:null,map:c.map,cache:c.cache,before:c.before,
hasHeights:!1}}function gd(a,b,c,d,p){b.before&&(c=-1);var f=c+(d||"");if(b.cache.hasOwnProperty(f))a=b.cache[f];else{b.rect||(b.rect=b.view.text.getBoundingClientRect());if(!b.hasHeights){var g=b.view,h=b.rect,m=a.options.lineWrapping,n=m&&La(a);if(!g.measure.heights||m&&g.measure.width!=n){var r=g.measure.heights=[];if(m)for(g.measure.width=n,g=g.text.firstChild.getClientRects(),m=0;m<g.length-1;m++){var n=g[m],s=g[m+1];2<Math.abs(n.bottom-s.bottom)&&r.push((n.bottom+s.top)/2-h.top)}r.push(h.bottom-
h.top)}b.hasHeights=!0}g=d;m=Zd(b.map,c,g);d=m.node;h=m.start;n=m.end;c=m.collapse;var q;if(3==d.nodeType){for(r=0;4>r;r++){for(;h&&Qb(b.line.text.charAt(m.coverStart+h));)--h;for(;m.coverStart+n<m.coverEnd&&Qb(b.line.text.charAt(m.coverStart+n));)++n;if(O&&9>V&&0==h&&n==m.coverEnd-m.coverStart)q=d.parentNode.getBoundingClientRect();else if(O&&a.options.lineWrapping){var v=$a(d,h,n).getClientRects();q=v.length?v["right"==g?v.length-1:0]:hd}else q=$a(d,h,n).getBoundingClientRect()||hd;if(q.left||q.right||
0==h)break;n=h;h-=1;c="right"}if(O&&11>V){if(v=window.screen&&null!=screen.logicalXDPI&&screen.logicalXDPI!=screen.deviceXDPI)null!=id?v=id:(r=qa(a.display.measure,D("span","x")),v=r.getBoundingClientRect(),r=$a(r,0,1).getBoundingClientRect(),v=id=1<Math.abs(v.left-r.left));v&&(v=screen.logicalXDPI/screen.deviceXDPI,r=screen.logicalYDPI/screen.deviceYDPI,q={left:q.left*v,right:q.right*v,top:q.top*r,bottom:q.bottom*r})}}else 0<h&&(c=g="right"),q=a.options.lineWrapping&&1<(v=d.getClientRects()).length?
v["right"==g?v.length-1:0]:d.getBoundingClientRect();!(O&&9>V)||h||q&&(q.left||q.right)||(q=(q=d.parentNode.getClientRects()[0])?{left:q.left,right:q.left+Fb(a.display),top:q.top,bottom:q.bottom}:hd);v=q.top-b.rect.top;d=q.bottom-b.rect.top;h=(v+d)/2;g=b.view.measure.heights;for(r=0;r<g.length-1&&!(h<g[r]);r++);c={left:("right"==c?q.right:q.left)-b.rect.left,right:("left"==c?q.left:q.right)-b.rect.left,top:r?g[r-1]:0,bottom:g[r]};q.left||q.right||(c.bogus=!0);a.options.singleCursorHeightPerLine||
(c.rtop=v,c.rbottom=d);a=c;a.bogus||(b.cache[f]=a)}return{left:a.left,right:a.right,top:p?a.rtop:a.top,bottom:p?a.rbottom:a.bottom}}function Zd(a,b,c){for(var d,p,f,g,h=0;h<a.length;h+=3){var m=a[h],n=a[h+1];if(b<m)p=0,f=1,g="left";else if(b<n)p=b-m,f=p+1;else if(h==a.length-3||b==n&&a[h+3]>b)f=n-m,p=f-1,b>=n&&(g="right");if(null!=p){d=a[h+2];m==n&&c==(d.insertLeft?"left":"right")&&(g=c);if("left"==c&&0==p)for(;h&&a[h-2]==a[h-3]&&a[h-1].insertLeft;)d=a[(h-=3)+2],g="left";if("right"==c&&p==n-m)for(;h<
a.length-3&&a[h+3]==a[h+4]&&!a[h+5].insertLeft;)d=a[(h+=3)+2],g="right";break}}return{node:d,start:p,end:f,collapse:g,coverStart:m,coverEnd:n}}function ke(a){if(a.measure&&(a.measure.cache={},a.measure.heights=null,a.rest))for(var b=0;b<a.rest.length;b++)a.measure.caches[b]={}}function le(a){a.display.externalMeasure=null;Va(a.display.lineMeasure);for(var b=0;b<a.display.view.length;b++)ke(a.display.view[b])}function Gb(a){le(a);a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=
null;a.options.lineWrapping||(a.display.maxLineChanged=!0);a.display.lineNumChars=null}function jd(a,b,c,d){if(b.widgets)for(var p=0;p<b.widgets.length;++p)if(b.widgets[p].above){var f=Rb(b.widgets[p]);c.top+=f;c.bottom+=f}if("line"==d)return c;d||(d="local");b=Aa(b);b="local"==d?b+a.display.lineSpace.offsetTop:b-a.display.viewOffset;if("page"==d||"window"==d)a=a.display.lineSpace.getBoundingClientRect(),b+=a.top+("window"==d?0:window.pageYOffset||(document.documentElement||document.body).scrollTop),
d=a.left+("window"==d?0:window.pageXOffset||(document.documentElement||document.body).scrollLeft),c.left+=d,c.right+=d;c.top+=b;c.bottom+=b;return c}function me(a,b,c){if("div"==c)return b;var d=b.left;b=b.top;"page"==c?(d-=window.pageXOffset||(document.documentElement||document.body).scrollLeft,b-=window.pageYOffset||(document.documentElement||document.body).scrollTop):"local"!=c&&c||(c=a.display.sizer.getBoundingClientRect(),d+=c.left,b+=c.top);a=a.display.lineSpace.getBoundingClientRect();return{left:d-
a.left,top:b-a.top}}function uc(a,b,c,d,p){d||(d=E(a.doc,b.line));var f=d;b=b.ch;d=gd(a,vc(a,d),b,p);return jd(a,f,d,c)}function Ia(a,b,c,d,p,f){function g(b,M){var h=gd(a,p,b,M?"right":"left",f);M?h.left=h.right:h.right=h.left;return jd(a,d,h,c)}function h(a,b){var c=m[b],N=c.level%2;a==kd(c)&&b&&c.level<m[b-1].level?(c=m[--b],a=ld(c)-(c.level%2?0:1),N=!0):a==ld(c)&&b<m.length-1&&c.level<m[b+1].level&&(c=m[++b],a=kd(c)-c.level%2,N=!1);return N&&a==c.to&&a>c.from?g(a-1):g(a,N)}d=d||E(a.doc,b.line);
p||(p=vc(a,d));var m=ua(d);b=b.ch;if(!m)return g(b);var n=oc(m,b),n=h(b,n);null!=Sb&&(n.other=h(b,Sb));return n}function ne(a,b){var c=0;b=H(a.doc,b);a.options.lineWrapping||(c=Fb(a.display)*b.ch);var d=E(a.doc,b.line),p=Aa(d)+a.display.lineSpace.offsetTop;return{left:c,right:c,top:p,bottom:p+d.height}}function wc(a,b,c,d){a=z(a,b);a.xRel=d;c&&(a.outside=!0);return a}function md(a,b,c){var d=a.doc;c+=a.display.viewOffset;if(0>c)return wc(d.first,0,!0,-1);var p=Xa(d,c),f=d.first+d.size-1;if(p>f)return wc(d.first+
d.size-1,E(d,f).text.length,!0,1);0>b&&(b=0);for(d=E(d,p);;)if(p=Bf(a,d,p,b,c),f=(d=Wa(d,!1))&&d.find(0,!0),d&&(p.ch>f.from.ch||p.ch==f.from.ch&&0<p.xRel))p=Q(d=f.to.line);else return p}function Bf(a,b,c,d,p){function f(d){d=Ia(a,z(c,d),"line",b,n);h=!0;if(g>d.bottom)return d.left-m;if(g<d.top)return d.left+m;h=!1;return d.left}var g=p-Aa(b),h=!1,m=2*a.display.wrapper.clientWidth,n=vc(a,b),r=ua(b),q=b.text.length;p=xc(b);var s=yc(b),v=f(p),u=h,t=f(s),w=h;if(d>t)return wc(c,s,w,1);for(;;){if(r?s==
p||s==nd(b,p,1):1>=s-p){r=d<v||d-v<=t-d?p:s;for(d-=r==p?v:t;Qb(b.text.charAt(r));)++r;return wc(c,r,r==p?u:w,-1>d?-1:1<d?1:0)}var x=Math.ceil(q/2),B=p+x;if(r)for(var B=p,Y=0;Y<x;++Y)B=nd(b,B,1);Y=f(B);if(Y>d){s=B;t=Y;if(w=h)t+=1E3;q=x}else p=B,v=Y,u=h,q-=x}}function Ta(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==ab){ab=D("pre");for(var b=0;49>b;++b)ab.appendChild(document.createTextNode("x")),ab.appendChild(D("br"));ab.appendChild(document.createTextNode("x"))}qa(a.measure,ab);
b=ab.offsetHeight/50;3<b&&(a.cachedTextHeight=b);Va(a.measure);return b||1}function Fb(a){if(null!=a.cachedCharWidth)return a.cachedCharWidth;var b=D("span","xxxxxxxxxx"),c=D("pre",[b]);qa(a.measure,c);b=b.getBoundingClientRect();b=(b.right-b.left)/10;2<b&&(a.cachedCharWidth=b);return b||10}function fb(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,
scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Cf};rb?rb.ops.push(a.curOp):a.curOp.ownsGroup=rb={ops:[a.curOp],delayedCallbacks:[]}}function hb(a){if(a=a.curOp.ownsGroup)try{var b=a.delayedCallbacks,c=0;do{for(;c<b.length;c++)b[c].call(null);for(var d=0;d<a.ops.length;d++){var p=a.ops[d];if(p.cursorActivityHandlers)for(;p.cursorActivityCalled<p.cursorActivityHandlers.length;)p.cursorActivityHandlers[p.cursorActivityCalled++].call(null,p.cm)}}while(c<b.length)}finally{rb=null;for(b=
0;b<a.ops.length;b++)a.ops[b].cm.curOp=null;a=a.ops;for(b=0;b<a.length;b++){var p=a[b],c=p.cm,d=c.display,f=c,g=f.display;!g.scrollbarsClipped&&g.scroller.offsetWidth&&(g.nativeBarWidth=g.scroller.offsetWidth-g.scroller.clientWidth,g.heightForcer.style.height=za(f)+"px",g.sizer.style.marginBottom=-g.nativeBarWidth+"px",g.sizer.style.borderRightWidth=za(f)+"px",g.scrollbarsClipped=!0);p.updateMaxLine&&w(c);p.mustUpdate=p.viewChanged||p.forceUpdate||null!=p.scrollTop||p.scrollToPos&&(p.scrollToPos.from.line<
d.viewFrom||p.scrollToPos.to.line>=d.viewTo)||d.maxLineChanged&&c.options.lineWrapping;p.update=p.mustUpdate&&new T(c,p.mustUpdate&&{top:p.scrollTop,ensure:p.scrollToPos},p.forceUpdate)}for(b=0;b<a.length;b++)p=a[b],p.updatedDisplay=p.mustUpdate&&da(p.cm,p.update);for(b=0;b<a.length;b++)if(p=a[b],c=p.cm,d=c.display,p.updatedDisplay&&jb(c),p.barMeasure=x(c),d.maxLineChanged&&!c.options.lineWrapping&&(f=p,g=d.maxLine.text.length,g=gd(c,vc(c,d.maxLine),g,void 0),f.adjustWidthTo=g.left+3,c.display.sizerWidth=
p.adjustWidthTo,p.barMeasure.scrollWidth=Math.max(d.scroller.clientWidth,d.sizer.offsetLeft+p.adjustWidthTo+za(c)+c.display.barWidth),p.maxScrollLeft=Math.max(0,d.sizer.offsetLeft+p.adjustWidthTo-La(c))),p.updatedDisplay||p.selectionChanged)p.preparedSelection=d.input.prepareSelection();for(b=0;b<a.length;b++)p=a[b],c=p.cm,null!=p.adjustWidthTo&&(c.display.sizer.style.minWidth=p.adjustWidthTo+"px",p.maxScrollLeft<c.doc.scrollLeft&&ib(c,Math.min(c.display.scroller.scrollLeft,p.maxScrollLeft),!0),c.display.maxLineChanged=
!1),p.preparedSelection&&c.display.input.showSelection(p.preparedSelection),p.updatedDisplay&&kb(c,p.barMeasure),(p.updatedDisplay||p.startHeight!=c.doc.height)&&B(c,p.barMeasure),p.selectionChanged&&ed(c),c.state.focused&&p.updateInput&&c.display.input.reset(p.typing),p.focus&&p.focus==Ba()&&Rd(p.cm);for(b=0;b<a.length;b++){p=a[b];c=p.cm;d=c.display;f=c.doc;p.updatedDisplay&&W(c,p.update);null==d.wheelStartX||null==p.scrollTop&&null==p.scrollLeft&&!p.scrollToPos||(d.wheelStartX=d.wheelStartY=null);
null==p.scrollTop||d.scroller.scrollTop==p.scrollTop&&!p.forceScroll||(f.scrollTop=Math.max(0,Math.min(d.scroller.scrollHeight-d.scroller.clientHeight,p.scrollTop)),d.scrollbars.setScrollTop(f.scrollTop),d.scroller.scrollTop=f.scrollTop);null==p.scrollLeft||d.scroller.scrollLeft==p.scrollLeft&&!p.forceScroll||(f.scrollLeft=Math.max(0,Math.min(d.scroller.scrollWidth-La(c),p.scrollLeft)),d.scrollbars.setScrollLeft(f.scrollLeft),d.scroller.scrollLeft=f.scrollLeft,L(c));if(p.scrollToPos){var h=void 0,
g=H(f,p.scrollToPos.from),h=H(f,p.scrollToPos.to),m=p.scrollToPos.margin;null==m&&(m=0);for(var n=0;5>n;n++){var r=!1,q=Ia(c,g),s=h&&h!=g?Ia(c,h):q,s=zc(c,Math.min(q.left,s.left),Math.min(q.top,s.top)-m,Math.max(q.left,s.left),Math.max(q.bottom,s.bottom)+m),v=c.doc.scrollTop,u=c.doc.scrollLeft;null!=s.scrollTop&&(Ib(c,s.scrollTop),1<Math.abs(c.doc.scrollTop-v)&&(r=!0));null!=s.scrollLeft&&(ib(c,s.scrollLeft),1<Math.abs(c.doc.scrollLeft-u)&&(r=!0));if(!r)break}h=q;p.scrollToPos.isCursor&&c.state.focused&&
(Fa(c,"scrollCursorIntoView")||(m=c.display,n=m.sizer.getBoundingClientRect(),g=null,0>h.top+n.top?g=!0:h.bottom+n.top>(window.innerHeight||document.documentElement.clientHeight)&&(g=!1),null==g||Df||(h=D("div","\u200b",null,"position: absolute; top: "+(h.top-m.viewOffset-c.display.lineSpace.offsetTop)+"px; height: "+(h.bottom-h.top+za(c)+m.barHeight)+"px; left: "+h.left+"px; width: 2px;"),c.display.lineSpace.appendChild(h),h.scrollIntoView(g),c.display.lineSpace.removeChild(h))))}g=p.maybeHiddenMarkers;
h=p.maybeUnhiddenMarkers;if(g)for(m=0;m<g.length;++m)g[m].lines.length||Z(g[m],"hide");if(h)for(m=0;m<h.length;++m)h[m].lines.length&&Z(h[m],"unhide");d.wrapper.offsetHeight&&(f.scrollTop=c.display.scroller.scrollTop);p.changeObjs&&Z(c,"changes",c,p.changeObjs);p.update&&p.update.finish()}}}function ma(a,b){if(a.curOp)return b();fb(a);try{return b()}finally{hb(a)}}function X(a,b){return function(){if(a.curOp)return b.apply(a,arguments);fb(a);try{return b.apply(a,arguments)}finally{hb(a)}}}function ea(a){return function(){if(this.curOp)return a.apply(this,
arguments);fb(this);try{return a.apply(this,arguments)}finally{hb(this)}}}function ha(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);fb(b);try{return a.apply(this,arguments)}finally{hb(b)}}}function je(a,b,c){for(var d=this.line=b,p;d=Wa(d,!1);)d=d.find(1,!0).line,(p||(p=[])).push(d);this.size=(this.rest=p)?Q(P(this.rest))-c+1:1;this.node=this.text=null;this.hidden=Ua(a,b)}function gc(a,b,c){var d=[],p;for(p=b;p<c;)b=new je(a.doc,E(a.doc,p),p),p+=b.size,d.push(b);
return d}function la(a,b,c,d){null==b&&(b=a.doc.first);null==c&&(c=a.doc.first+a.doc.size);d||(d=0);var p=a.display;d&&c<p.viewTo&&(null==p.updateLineNumbers||p.updateLineNumbers>b)&&(p.updateLineNumbers=b);a.curOp.viewChanged=!0;if(b>=p.viewTo)Na&&Wc(a.doc,b)<p.viewTo&&Ma(a);else if(c<=p.viewFrom)Na&&Md(a.doc,c+d)>p.viewFrom?Ma(a):(p.viewFrom+=d,p.viewTo+=d);else if(b<=p.viewFrom&&c>=p.viewTo)Ma(a);else if(b<=p.viewFrom){var f=Ac(a,c,c+d,1);f?(p.view=p.view.slice(f.index),p.viewFrom=f.lineN,p.viewTo+=
d):Ma(a)}else if(c>=p.viewTo)(f=Ac(a,b,b,-1))?(p.view=p.view.slice(0,f.index),p.viewTo=f.lineN):Ma(a);else{var f=Ac(a,b,b,-1),g=Ac(a,c,c+d,1);f&&g?(p.view=p.view.slice(0,f.index).concat(gc(a,f.lineN,g.lineN)).concat(p.view.slice(g.index)),p.viewTo+=d):Ma(a)}if(a=p.externalMeasured)c<a.lineN?a.lineN+=d:b<a.lineN+a.size&&(p.externalMeasured=null)}function Ja(a,b,c){a.curOp.viewChanged=!0;var d=a.display,p=a.display.externalMeasured;p&&b>=p.lineN&&b<p.lineN+p.size&&(d.externalMeasured=null);b<d.viewFrom||
b>=d.viewTo||(a=d.view[Ya(a,b)],null!=a.node&&(a=a.changes||(a.changes=[]),-1==fa(a,c)&&a.push(c)))}function Ma(a){a.display.viewFrom=a.display.viewTo=a.doc.first;a.display.view=[];a.display.viewOffset=0}function Ya(a,b){if(b>=a.display.viewTo)return null;b-=a.display.viewFrom;if(0>b)return null;for(var c=a.display.view,d=0;d<c.length;d++)if(b-=c[d].size,0>b)return d}function Ac(a,b,c,d){var p=Ya(a,b),f=a.display.view;if(!Na||c==a.doc.first+a.doc.size)return{index:p,lineN:c};for(var g=0,h=a.display.viewFrom;g<
p;g++)h+=f[g].size;if(h!=b){if(0<d){if(p==f.length-1)return null;b=h+f[p].size-b;p++}else b=h-b;c+=b}for(;Wc(a.doc,c)!=c;){if(p==(0>d?0:f.length-1))return null;c+=d*f[p-(0>d?1:0)].size;p+=d}return{index:p,lineN:c}}function Ld(a){a=a.display.view;for(var b=0,c=0;c<a.length;c++){var d=a[c];d.hidden||d.node&&!d.changes||++b}return b}function qf(a){function b(){d.activeTouch&&(p=setTimeout(function(){d.activeTouch=null},1E3),f=d.activeTouch,f.end=+new Date)}function c(a,b){if(null==b.left)return!0;var N=
b.left-a.left,d=b.top-a.top;return 400<N*N+d*d}var d=a.display;F(d.scroller,"mousedown",X(a,oe));O&&11>V?F(d.scroller,"dblclick",X(a,function(b){if(!Fa(a,b)){var c=sb(a,b);!c||od(a,b,"gutterClick",!0,ga)||Ka(a.display,b)||(ia(b),b=a.findWordAt(c),qc(a.doc,b.anchor,b.head))}})):F(d.scroller,"dblclick",function(b){Fa(a,b)||ia(b)});pd||F(d.scroller,"contextmenu",function(b){pe(a,b)});var p,f={end:0};F(d.scroller,"touchstart",function(a){var b;1!=a.touches.length?b=!1:(b=a.touches[0],b=1>=b.radiusX&&
1>=b.radiusY);b||(clearTimeout(p),b=+new Date,d.activeTouch={start:b,moved:!1,prev:300>=b-f.end?f:null},1==a.touches.length&&(d.activeTouch.left=a.touches[0].pageX,d.activeTouch.top=a.touches[0].pageY))});F(d.scroller,"touchmove",function(){d.activeTouch&&(d.activeTouch.moved=!0)});F(d.scroller,"touchend",function(p){var f=d.activeTouch;if(f&&!Ka(d,p)&&null!=f.left&&!f.moved&&300>new Date-f.start){var g=a.coordsChar(d.activeTouch,"page"),f=!f.prev||c(f,f.prev)?new S(g,g):!f.prev.prev||c(f,f.prev.prev)?
a.findWordAt(g):new S(z(g.line,0),H(a.doc,z(g.line+1,0)));a.setSelection(f.anchor,f.head);a.focus();ia(p)}b()});F(d.scroller,"touchcancel",b);F(d.scroller,"scroll",function(){d.scroller.clientHeight&&(Ib(a,d.scroller.scrollTop),ib(a,d.scroller.scrollLeft,!0),Z(a,"scroll",a))});F(d.scroller,"mousewheel",function(b){qe(a,b)});F(d.scroller,"DOMMouseScroll",function(b){qe(a,b)});F(d.wrapper,"scroll",function(){d.wrapper.scrollTop=d.wrapper.scrollLeft=0});d.dragFunctions={simple:function(b){Fa(a,b)||qd(b)},
start:function(b){if(O&&(!a.state.draggingText||100>+new Date-re))qd(b);else if(!Fa(a,b)&&!Ka(a.display,b)&&(b.dataTransfer.setData("Text",a.getSelection()),b.dataTransfer.setDragImage&&!se)){var c=D("img",null,null,"position: fixed; left: 0; top: 0;");c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";xa&&(c.width=c.height=1,a.display.wrapper.appendChild(c),c._top=c.offsetTop);b.dataTransfer.setDragImage(c,0,0);xa&&c.parentNode.removeChild(c)}},drop:X(a,Ef)};var g=
d.input.getField();F(g,"keyup",function(b){te.call(a,b)});F(g,"keydown",X(a,ue));F(g,"keypress",X(a,ve));F(g,"focus",Cb(Tc,a));F(g,"blur",Cb(Db,a))}function Ff(a){var b=a.display;if(b.lastWrapHeight!=b.wrapper.clientHeight||b.lastWrapWidth!=b.wrapper.clientWidth)b.cachedCharWidth=b.cachedTextHeight=b.cachedPaddingH=null,b.scrollbarsClipped=!1,a.setSize()}function Ka(a,b){for(var c=b.target||b.srcElement;c!=a.wrapper;c=c.parentNode)if(!c||1==c.nodeType&&"true"==c.getAttribute("cm-ignore-events")||
c.parentNode==a.sizer&&c!=a.mover)return!0}function sb(a,b,c,d){var p=a.display;if(!c&&"true"==(b.target||b.srcElement).getAttribute("cm-not-content"))return null;var f,g;c=p.lineSpace.getBoundingClientRect();try{f=b.clientX-c.left,g=b.clientY-c.top}catch(h){return null}b=md(a,f,g);var m;d&&1==b.xRel&&(m=E(a.doc,b.line).text).length==b.ch&&(d=wa(m,m.length,a.options.tabSize)-m.length,b=z(b.line,Math.max(0,Math.round((f-he(a.display).left)/Fb(a.display))-d)));return b}function oe(a){var b=this.display;
if(!(b.activeTouch&&b.input.supportsTouch()||Fa(this,a)))if(b.shift=a.shiftKey,Ka(b,a))aa||(b.scroller.draggable=!1,setTimeout(function(){b.scroller.draggable=!0},100));else if(!od(this,a,"gutterClick",!0,ga)){var c=sb(this,a);window.focus();switch(we(a)){case 1:c?Gf(this,a,c):(a.target||a.srcElement)==b.scroller&&ia(a);break;case 2:aa&&(this.state.lastMiddleDown=+new Date);c&&qc(this.doc,c);setTimeout(function(){b.input.focus()},20);ia(a);break;case 3:pd?pe(this,a):Hf(this)}}}function Gf(a,b,c){O?
setTimeout(Cb(Rd,a),0):a.curOp.focus=Ba();var d=+new Date,p;Bc&&Bc.time>d-400&&0==I(Bc.pos,c)?p="triple":Cc&&Cc.time>d-400&&0==I(Cc.pos,c)?(p="double",Bc={time:d,pos:c}):(p="single",Cc={time:d,pos:c});var d=a.doc.sel,f=ta?b.metaKey:b.ctrlKey,g;a.options.dragDrop&&If&&!kc(a)&&"single"==p&&-1<(g=d.contains(c))&&(0>I((g=d.ranges[g]).from(),c)||0<c.xRel)&&(0<I(g.to(),c)||0>c.xRel)?Jf(a,b,c,f):Kf(a,b,c,p,f)}function Jf(a,b,c,d){var p=a.display,f=+new Date,g=X(a,function(h){aa&&(p.scroller.draggable=!1);
a.state.draggingText=!1;Ga(document,"mouseup",g);Ga(p.scroller,"drop",g);10>Math.abs(b.clientX-h.clientX)+Math.abs(b.clientY-h.clientY)&&(ia(h),!d&&+new Date-200<f&&qc(a.doc,c),aa||O&&9==V?setTimeout(function(){document.body.focus();p.input.focus()},20):p.input.focus())});aa&&(p.scroller.draggable=!0);a.state.draggingText=g;p.scroller.dragDrop&&p.scroller.dragDrop();F(document,"mouseup",g);F(p.scroller,"drop",g)}function Kf(a,b,c,d,p){function f(b){if(0!=I(t,b))if(t=b,"rect"==d){for(var M=[],p=a.options.tabSize,
g=wa(E(n,c.line).text,c.ch,p),h=wa(E(n,b.line).text,b.ch,p),m=Math.min(g,h),g=Math.max(g,h),h=Math.min(c.line,b.line),ja=Math.min(a.lastLine(),Math.max(c.line,b.line));h<=ja;h++){var v=E(n,h).text,u=xe(v,m,p);m==g?M.push(new S(z(h,u),z(h,u))):v.length>u&&M.push(new S(z(h,u),z(h,xe(v,g,p))))}M.length||M.push(new S(c,c));ba(n,va(s.ranges.slice(0,q).concat(M),q),{origin:"*mouse",scroll:!1});a.scrollIntoView(b)}else M=r,p=M.anchor,m=b,"single"!=d&&(b="double"==d?a.findWordAt(b):new S(z(b.line,0),H(n,
z(b.line+1,0))),0<I(b.anchor,p)?(m=b.head,p=jc(M.from(),b.anchor)):(m=b.anchor,p=ic(M.to(),b.head))),M=s.ranges.slice(0),M[q]=new S(H(n,p),m),ba(n,va(M,q),rd)}function g(b){var c=++x,M=sb(a,b,!0,"rect"==d);if(M)if(0!=I(M,t)){a.curOp.focus=Ba();f(M);var p=J(m,n);(M.line>=p.to||M.line<p.from)&&setTimeout(X(a,function(){x==c&&g(b)}),150)}else{var ca=b.clientY<w.top?-20:b.clientY>w.bottom?20:0;ca&&setTimeout(X(a,function(){x==c&&(m.scroller.scrollTop+=ca,g(b))}),50)}}function h(a){x=Infinity;ia(a);m.input.focus();
Ga(document,"mousemove",B);Ga(document,"mouseup",Y);n.history.lastSelOrigin=null}var m=a.display,n=a.doc;ia(b);var r,q,s=n.sel,v=s.ranges;p&&!b.shiftKey?(q=n.sel.contains(c),r=-1<q?v[q]:new S(c,c)):(r=n.sel.primary(),q=n.sel.primIndex);if(b.altKey)d="rect",p||(r=new S(c,c)),c=sb(a,b,!0,!0),q=-1;else if("double"==d){var u=a.findWordAt(c);r=a.display.shift||n.extend?Ob(n,r,u.anchor,u.head):u}else"triple"==d?(u=new S(z(c.line,0),H(n,z(c.line+1,0))),r=a.display.shift||n.extend?Ob(n,r,u.anchor,u.head):
u):r=Ob(n,r,c);p?-1==q?(q=v.length,ba(n,va(v.concat([r]),q),{scroll:!1,origin:"*mouse"})):1<v.length&&v[q].empty()&&"single"==d&&!b.shiftKey?(ba(n,va(v.slice(0,q).concat(v.slice(q+1)),0)),s=n.sel):dd(n,q,r,rd):(q=0,ba(n,new Ha([r],0),rd),s=n.sel);var t=c,w=m.wrapper.getBoundingClientRect(),x=0,B=X(a,function(a){we(a)?g(a):h(a)}),Y=X(a,h);F(document,"mousemove",B);F(document,"mouseup",Y)}function od(a,b,c,d,p){try{var f=b.clientX,g=b.clientY}catch(h){return!1}if(f>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;
d&&ia(b);d=a.display;var m=d.lineDiv.getBoundingClientRect();if(g>m.bottom||!pa(a,c))return sd(b);g-=m.top-d.viewOffset;for(m=0;m<a.options.gutters.length;++m){var n=d.gutters.childNodes[m];if(n&&n.getBoundingClientRect().right>=f)return f=Xa(a.doc,g),p(a,c,a,f,a.options.gutters[m],b),sd(b)}}function Ef(a){var b=this;if(!Fa(b,a)&&!Ka(b.display,a)){ia(a);O&&(re=+new Date);var c=sb(b,a,!0),d=a.dataTransfer.files;if(c&&!kc(b))if(d&&d.length&&window.FileReader&&window.File){var p=d.length,f=Array(p),
g=0;a=function(a,d){var N=new FileReader;N.onload=X(b,function(){f[d]=N.result;if(++g==p){c=H(b.doc,c);var a={from:c,to:c,text:b.doc.splitLines(f.join(b.doc.lineSeparator())),origin:"paste"};mb(b.doc,a);ae(b.doc,Ca(c,bb(a)))}});N.readAsText(a)};for(var h=0;h<p;++h)a(d[h],h)}else if(b.state.draggingText&&-1<b.doc.sel.contains(c))b.state.draggingText(a),setTimeout(function(){b.display.input.focus()},20);else try{if(f=a.dataTransfer.getData("Text")){if(b.state.draggingText&&(ta?!a.altKey:!a.ctrlKey))var m=
b.listSelections();rc(b.doc,Ca(c,c));if(m)for(h=0;h<m.length;++h)tb(b.doc,"",m[h].anchor,m[h].head,"drag");b.replaceSelection(f,"around","paste");b.display.input.focus()}}catch(n){}}}function Ib(a,b){2>Math.abs(a.doc.scrollTop-b)||(a.doc.scrollTop=b,Sa||U(a,{top:b}),a.display.scroller.scrollTop!=b&&(a.display.scroller.scrollTop=b),a.display.scrollbars.setScrollTop(b),Sa&&U(a),Eb(a,100))}function ib(a,b,c){(c?b==a.doc.scrollLeft:2>Math.abs(a.doc.scrollLeft-b))||(b=Math.min(b,a.display.scroller.scrollWidth-
a.display.scroller.clientWidth),a.doc.scrollLeft=b,L(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbars.setScrollLeft(b))}function qe(a,b){var c=ye(b),d=c.x,c=c.y,p=a.display,f=p.scroller;if(d&&f.scrollWidth>f.clientWidth||c&&f.scrollHeight>f.clientHeight){if(c&&ta&&aa){var g=b.target,h=p.view;a:for(;g!=f;g=g.parentNode)for(var m=0;m<h.length;m++)if(h[m].node==g){a.display.currentWheelTarget=g;break a}}!d||Sa||xa||null==na?(c&&null!=na&&(g=c*na,h=a.doc.scrollTop,
m=h+p.wrapper.clientHeight,0>g?h=Math.max(0,h+g-50):m=Math.min(a.doc.height,m+g+50),U(a,{top:h,bottom:m})),20>Dc&&(null==p.wheelStartX?(p.wheelStartX=f.scrollLeft,p.wheelStartY=f.scrollTop,p.wheelDX=d,p.wheelDY=c,setTimeout(function(){if(null!=p.wheelStartX){var a=f.scrollLeft-p.wheelStartX,b=f.scrollTop-p.wheelStartY,a=b&&p.wheelDY&&b/p.wheelDY||a&&p.wheelDX&&a/p.wheelDX;p.wheelStartX=p.wheelStartY=null;a&&(na=(na*Dc+a)/(Dc+1),++Dc)}},200)):(p.wheelDX+=d,p.wheelDY+=c))):(c&&Ib(a,Math.max(0,Math.min(f.scrollTop+
c*na,f.scrollHeight-f.clientHeight))),ib(a,Math.max(0,Math.min(f.scrollLeft+d*na,f.scrollWidth-f.clientWidth))),ia(b),p.wheelStartX=null)}}function Ec(a,b,c){if("string"==typeof b&&(b=Fc[b],!b))return!1;a.display.input.ensurePolled();var d=a.display.shift,p=!1;try{kc(a)&&(a.state.suppressEdits=!0),c&&(a.display.shift=!1),p=b(a)!=ze}finally{a.display.shift=d,a.state.suppressEdits=!1}return p}function Lf(a,b,c){for(var d=0;d<a.state.keyMaps.length;d++){var p=Tb(b,a.state.keyMaps[d],c,a);if(p)return p}return a.options.extraKeys&&
Tb(b,a.options.extraKeys,c,a)||Tb(b,a.options.keyMap,c,a)}function Gc(a,b,c,d){var p=a.state.keySeq;if(p){if(Mf(b))return"handled";Nf.set(50,function(){a.state.keySeq==p&&(a.state.keySeq=null,a.display.input.reset())});b=p+" "+b}d=Lf(a,b,d);"multi"==d&&(a.state.keySeq=b);"handled"==d&&ga(a,"keyHandled",a,b,c);if("handled"==d||"multi"==d)ia(c),ed(a);return p&&!d&&/\'$/.test(b)?(ia(c),!0):!!d}function Ae(a,b){var c=Of(b,!0);return c?b.shiftKey&&!a.state.keySeq?Gc(a,"Shift-"+c,b,function(b){return Ec(a,
b,!0)})||Gc(a,c,b,function(b){if("string"==typeof b?/^go[A-Z]/.test(b):b.motion)return Ec(a,b)}):Gc(a,c,b,function(b){return Ec(a,b)}):!1}function Pf(a,b,c){return Gc(a,"'"+c+"'",b,function(b){return Ec(a,b,!0)})}function ue(a){this.curOp.focus=Ba();if(!Fa(this,a)){O&&11>V&&27==a.keyCode&&(a.returnValue=!1);var b=a.keyCode;this.display.shift=16==b||a.shiftKey;var c=Ae(this,a);xa&&(td=c?b:null,!c&&88==b&&!Be&&(ta?a.metaKey:a.ctrlKey)&&this.replaceSelection("",null,"cut"));18!=b||/\bCodeMirror-crosshair\b/.test(this.display.lineDiv.className)||
Qf(this)}}function Qf(a){function b(a){18!=a.keyCode&&a.altKey||(Hb(c,"CodeMirror-crosshair"),Ga(document,"keyup",b),Ga(document,"mouseover",b))}var c=a.display.lineDiv;Jb(c,"CodeMirror-crosshair");F(document,"keyup",b);F(document,"mouseover",b)}function te(a){16==a.keyCode&&(this.doc.sel.shift=!1);Fa(this,a)}function ve(a){if(!(Ka(this.display,a)||Fa(this,a)||a.ctrlKey&&!a.altKey||ta&&a.metaKey)){var b=a.keyCode,c=a.charCode;if(xa&&b==td)td=null,ia(a);else if(!xa||a.which&&!(10>a.which)||!Ae(this,
a))if(b=String.fromCharCode(null==c?b:c),!Pf(this,a,b))this.display.input.onKeyPress(a)}}function Hf(a){a.state.delayingBlurEvent=!0;setTimeout(function(){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1,Db(a))},100)}function Tc(a){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1);"nocursor"!=a.options.readOnly&&(a.state.focused||(Z(a,"focus",a),a.state.focused=!0,Jb(a.display.wrapper,"CodeMirror-focused"),a.curOp||a.display.selForContextMenu==a.doc.sel||(a.display.input.reset(),aa&&
setTimeout(function(){a.display.input.reset(!0)},20)),a.display.input.receivedFocus()),ed(a))}function Db(a){a.state.delayingBlurEvent||(a.state.focused&&(Z(a,"blur",a),a.state.focused=!1,Hb(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||(a.display.shift=!1)},150))}function pe(a,b){var c;(c=Ka(a.display,b))||(c=pa(a,"gutterContextMenu")?od(a,b,"gutterContextMenu",!1,Z):!1);if(!c)a.display.input.onContextMenu(b)}function Ce(a,b){if(0>
I(a,b.from))return a;if(0>=I(a,b.to))return bb(b);var c=a.line+b.text.length-(b.to.line-b.from.line)-1,d=a.ch;a.line==b.to.line&&(d+=bb(b).ch-b.to.ch);return z(c,d)}function ud(a,b){for(var c=[],d=0;d<a.sel.ranges.length;d++){var p=a.sel.ranges[d];c.push(new S(Ce(p.anchor,b),Ce(p.head,b)))}return va(c,a.sel.primIndex)}function De(a,b,c){return a.line==b.line?z(c.line,a.ch-b.ch+c.ch):z(c.line+(a.line-b.line),a.ch)}function Ee(a,b,c){b={canceled:!1,from:b.from,to:b.to,text:b.text,origin:b.origin,cancel:function(){this.canceled=
!0}};c&&(b.update=function(b,c,d,M){b&&(this.from=H(a,b));c&&(this.to=H(a,c));d&&(this.text=d);void 0!==M&&(this.origin=M)});Z(a,"beforeChange",a,b);a.cm&&Z(a.cm,"beforeChange",a.cm,b);return b.canceled?null:{from:b.from,to:b.to,text:b.text,origin:b.origin}}function mb(a,b,c){if(a.cm){if(!a.cm.curOp)return X(a.cm,mb)(a,b,c);if(a.cm.state.suppressEdits)return}if(pa(a,"beforeChange")||a.cm&&pa(a.cm,"beforeChange"))if(b=Ee(a,b,!0),!b)return;if(c=Fe&&!c&&Rf(a,b.from,b.to))for(var d=c.length-1;0<=d;--d)Ge(a,
{from:c[d].from,to:c[d].to,text:d?[""]:b.text});else Ge(a,b)}function Ge(a,b){if(1!=b.text.length||""!=b.text[0]||0!=I(b.from,b.to)){var c=ud(a,b);He(a,b,c,a.cm?a.cm.curOp.id:NaN);Ub(a,b,c,vd(a,b));var d=[];cb(a,function(a,c){c||-1!=fa(d,a.history)||(Ie(a.history,b),d.push(a.history));Ub(a,b,null,vd(a,b))})}}function Hc(a,b,c){if(!a.cm||!a.cm.state.suppressEdits){for(var d=a.history,p,f=a.sel,g="undo"==b?d.done:d.undone,h="undo"==b?d.undone:d.done,m=0;m<g.length&&(p=g[m],c?!p.ranges||p.equals(a.sel):
p.ranges);m++);if(m!=g.length){for(d.lastOrigin=d.lastSelOrigin=null;;)if(p=g.pop(),p.ranges){sc(p,h);if(c&&!p.equals(a.sel)){ba(a,p,{clearRedo:!1});return}f=p}else break;c=[];sc(f,h);h.push({changes:c,generation:d.generation});d.generation=p.generation||++d.maxGeneration;d=pa(a,"beforeChange")||a.cm&&pa(a.cm,"beforeChange");for(m=p.changes.length-1;0<=m;--m){var n=p.changes[m];n.origin=b;if(d&&!Ee(a,n,!1)){g.length=0;break}c.push(wd(a,n));f=m?ud(a,n):P(g);Ub(a,n,f,Je(a,n));!m&&a.cm&&a.cm.scrollIntoView({from:n.from,
to:bb(n)});var r=[];cb(a,function(a,b){b||-1!=fa(r,a.history)||(Ie(a.history,n),r.push(a.history));Ub(a,n,null,Je(a,n))})}}}}function Ke(a,b){if(0!=b&&(a.first+=b,a.sel=new Ha(nc(a.sel.ranges,function(a){return new S(z(a.anchor.line+b,a.anchor.ch),z(a.head.line+b,a.head.ch))}),a.sel.primIndex),a.cm)){la(a.cm,a.first,a.first-b,b);for(var c=a.cm.display,d=c.viewFrom;d<c.viewTo;d++)Ja(a.cm,d,"gutter")}}function Ub(a,b,c,d){if(a.cm&&!a.cm.curOp)return X(a.cm,Ub)(a,b,c,d);if(b.to.line<a.first)Ke(a,b.text.length-
1-(b.to.line-b.from.line));else if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var p=b.text.length-1-(a.first-b.from.line);Ke(a,p);b={from:z(a.first,0),to:z(b.to.line+p,b.to.ch),text:[P(b.text)],origin:b.origin}}p=a.lastLine();b.to.line>p&&(b={from:b.from,to:z(p,E(a,p).text.length),text:[b.text[0]],origin:b.origin});b.removed=Za(a,b.from,b.to);c||(c=ud(a,b));a.cm?Sf(a.cm,b,d):xd(a,b,d);rc(a,c,Da)}}function Sf(a,b,c){var d=a.doc,p=a.display,g=b.from,h=b.to,m=!1,n=g.line;a.options.lineWrapping||
(n=Q(Ea(E(d,g.line))),d.iter(n,h.line+1,function(a){if(a==p.maxLine)return m=!0}));-1<d.sel.contains(b.from,b.to)&&ee(a);xd(d,b,c,f(a));a.options.lineWrapping||(d.iter(n,g.line+b.text.length,function(a){var b=u(a);b>p.maxLineLength&&(p.maxLine=a,p.maxLineLength=b,p.maxLineChanged=!0,m=!1)}),m&&(a.curOp.updateMaxLine=!0));d.frontier=Math.min(d.frontier,g.line);Eb(a,400);c=b.text.length-(h.line-g.line)-1;b.full?la(a):g.line!=h.line||1!=b.text.length||Le(a.doc,b)?la(a,g.line,h.line+1,c):Ja(a,g.line,
"text");c=pa(a,"changes");if((d=pa(a,"change"))||c)b={from:g,to:h,text:b.text,removed:b.removed,origin:b.origin},d&&ga(a,"change",a,b),c&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(b);a.display.selForContextMenu=null}function tb(a,b,c,d,p){d||(d=c);if(0>I(d,c)){var f=d;d=c;c=f}"string"==typeof b&&(b=a.splitLines(b));mb(a,{from:c,to:d,text:b,origin:p})}function zc(a,b,c,d,p){var f=a.display,g=Ta(a.display);0>c&&(c=0);var h=a.curOp&&null!=a.curOp.scrollTop?a.curOp.scrollTop:f.scroller.scrollTop,
m=Yc(a),n={};p-c>m&&(p=c+m);var r=a.doc.height+Vc(f),q=c<g,g=p>r-g;c<h?n.scrollTop=q?0:c:p>h+m&&(c=Math.min(c,(g?r:p)-m),c!=h&&(n.scrollTop=c));h=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:f.scroller.scrollLeft;a=La(a)-(a.options.fixedGutter?f.gutters.offsetWidth:0);(f=d-b>a)&&(d=b+a);10>b?n.scrollLeft=0:b<h?n.scrollLeft=Math.max(0,b-(f?0:10)):d>a+h-3&&(n.scrollLeft=d+(f?0:10)-a);return n}function Ic(a,b,c){null==b&&null==c||Jc(a);null!=b&&(a.curOp.scrollLeft=(null==a.curOp.scrollLeft?a.doc.scrollLeft:
a.curOp.scrollLeft)+b);null!=c&&(a.curOp.scrollTop=(null==a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+c)}function nb(a){Jc(a);var b=a.getCursor(),c=b,d=b;a.options.lineWrapping||(c=b.ch?z(b.line,b.ch-1):b,d=z(b.line,b.ch+1));a.curOp.scrollToPos={from:c,to:d,margin:a.options.cursorScrollMargin,isCursor:!0}}function Jc(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=ne(a,b.from),d=ne(a,b.to),b=zc(a,Math.min(c.left,d.left),Math.min(c.top,d.top)-b.margin,Math.max(c.right,d.right),
Math.max(c.bottom,d.bottom)+b.margin);a.scrollTo(b.scrollLeft,b.scrollTop)}}function Mb(a,b,c,d){var f=a.doc,g;null==c&&(c="add");"smart"==c&&(f.mode.indent?g=Pb(a,b):c="prev");var h=a.options.tabSize,m=E(f,b),n=wa(m.text,null,h);m.stateAfter&&(m.stateAfter=null);var r=m.text.match(/^\s*/)[0],q;if(!d&&!/\S/.test(m.text))q=0,c="not";else if("smart"==c&&(q=f.mode.indent(g,m.text.slice(r.length),m.text),q==ze||150<q)){if(!d)return;c="prev"}"prev"==c?q=b>f.first?wa(E(f,b-1).text,null,h):0:"add"==c?q=
n+a.options.indentUnit:"subtract"==c?q=n-a.options.indentUnit:"number"==typeof c&&(q=n+c);q=Math.max(0,q);c="";d=0;if(a.options.indentWithTabs)for(a=Math.floor(q/h);a;--a)d+=h,c+="\t";d<q&&(c+=Me(q-d));if(c!=r)return tb(f,c,z(b,0),z(b,r.length),"+input"),m.stateAfter=null,!0;for(a=0;a<f.sel.ranges.length;a++)if(h=f.sel.ranges[a],h.head.line==b&&h.head.ch<r.length){d=z(b,r.length);dd(f,a,new S(d,d));break}}function Kc(a,b,c,d){var f=b,g=b;"number"==typeof b?g=E(a,Math.max(a.first,Math.min(b,a.first+
a.size-1))):f=Q(b);if(null==f)return null;d(g,f)&&a.cm&&Ja(a.cm,f,c);return g}function ub(a,b){for(var c=a.doc.sel.ranges,d=[],f=0;f<c.length;f++){for(var g=b(c[f]);d.length&&0>=I(g.from,P(d).to);){var h=d.pop();if(0>I(h.from,g.from)){g.from=h.from;break}}d.push(g)}ma(a,function(){for(var b=d.length-1;0<=b;b--)tb(a.doc,"",d[b].from,d[b].to,"+delete");nb(a)})}function yd(a,b,c,d,f){function g(b){var d=(f?nd:Ne)(r,m,c,!0);if(null==d){if(b=!b)b=h+c,b<a.first||b>=a.first+a.size?b=q=!1:(h=b,b=r=E(a,b));
if(b)m=f?(0>c?yc:xc)(r):0>c?r.text.length:0;else return q=!1}else m=d;return!0}var h=b.line,m=b.ch,n=c,r=E(a,h),q=!0;if("char"==d)g();else if("column"==d)g(!0);else if("word"==d||"group"==d){var s=null;d="group"==d;b=a.cm&&a.cm.getHelper(b,"wordChars");for(var v=!0;!(0>c)||g(!v);v=!1){var u=r.text.charAt(m)||"\n",u=Lc(u,b)?"w":d&&"\n"==u?"n":!d||/\s/.test(u)?null:"p";!d||v||u||(u="s");if(s&&s!=u){0>c&&(c=1,g());break}u&&(s=u);if(0<c&&!g(!v))break}}n=tc(a,z(h,m),n,!0);q||(n.hitSide=!0);return n}function Oe(a,
b,c,d){var f=a.doc,g=b.left,h;"page"==d?(d=Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),h=b.top+c*(d-(0>c?1.5:.5)*Ta(a.display))):"line"==d&&(h=0<c?b.bottom+3:b.top-3);for(;;){var m=md(a,g,h);if(!m.outside)break;if(0>c?0>=h:h>=f.height){m.hitSide=!0;break}h+=5*c}return m}function G(a,b,d,f){c.defaults[a]=b;d&&(gb[a]=f?function(a,b,c){c!=Jd&&d(a,b,c)}:d)}function Tf(a){var b=a.split(/-(?!$)/);a=b[b.length-1];for(var c,d,f,g,h=0;h<b.length-1;h++){var m=
b[h];if(/^(cmd|meta|m)$/i.test(m))g=!0;else if(/^a(lt)?$/i.test(m))c=!0;else if(/^(c|ctrl|control)$/i.test(m))d=!0;else if(/^s(hift)$/i.test(m))f=!0;else throw Error("Unrecognized modifier name: "+m);}c&&(a="Alt-"+a);d&&(a="Ctrl-"+a);g&&(a="Cmd-"+a);f&&(a="Shift-"+a);return a}function Mc(a){return"string"==typeof a?Qa[a]:a}function vb(a,b,c,d,f){if(d&&d.shared)return Uf(a,b,c,d,f);if(a.cm&&!a.cm.curOp)return X(a.cm,vb)(a,b,c,d,f);var g=new db(a,f);f=I(b,c);d&&ra(d,g,!1);if(0<f||0==f&&!1!==g.clearWhenEmpty)return g;
g.replacedWith&&(g.collapsed=!0,g.widgetNode=D("span",[g.replacedWith],"CodeMirror-widget"),d.handleMouseEvents||g.widgetNode.setAttribute("cm-ignore-events","true"),d.insertLeft&&(g.widgetNode.insertLeft=!0));if(g.collapsed){if(Pe(a,b.line,b,c,g)||b.line!=c.line&&Pe(a,c.line,b,c,g))throw Error("Inserting collapsed marker partially overlapping an existing one");Na=!0}g.addToHistory&&He(a,{from:b,to:c,origin:"markText"},a.sel,NaN);var h=b.line,m=a.cm,n;a.iter(h,c.line+1,function(a){m&&g.collapsed&&
!m.options.lineWrapping&&Ea(a)==m.display.maxLine&&(n=!0);g.collapsed&&h!=b.line&&ya(a,0);var d=new Nc(g,h==b.line?b.ch:null,h==c.line?c.ch:null);a.markedSpans=a.markedSpans?a.markedSpans.concat([d]):[d];d.marker.attachLine(a);++h});g.collapsed&&a.iter(b.line,c.line+1,function(b){Ua(a,b)&&ya(b,0)});g.clearOnEnter&&F(g,"beforeCursorEnter",function(){g.clear()});g.readOnly&&(Fe=!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory());g.collapsed&&(g.id=++zd,g.atomic=!0);if(m){n&&(m.curOp.updateMaxLine=
!0);if(g.collapsed)la(m,b.line,c.line+1);else if(g.className||g.title||g.startStyle||g.endStyle||g.css)for(d=b.line;d<=c.line;d++)Ja(m,d,"text");g.atomic&&fe(m.doc);ga(m,"markerAdded",m,g)}return g}function Uf(a,b,c,d,f){d=ra(d);d.shared=!1;var g=[vb(a,b,c,d,f)],h=g[0],m=d.widgetNode;cb(a,function(a){m&&(d.widgetNode=m.cloneNode(!0));g.push(vb(a,H(a,b),H(a,c),d,f));for(var N=0;N<a.linked.length;++N)if(a.linked[N].isParent)return;h=P(g)});return new Oc(g,h)}function Qe(a){return a.findMarks(z(a.first,
0),a.clipPos(z(a.lastLine())),function(a){return a.parent})}function Vf(a){for(var b=0;b<a.length;b++){var c=a[b],d=[c.primary.doc];cb(c.primary.doc,function(a){d.push(a)});for(var f=0;f<c.markers.length;f++){var g=c.markers[f];-1==fa(d,g.doc)&&(g.parent=null,c.markers.splice(f--,1))}}}function Nc(a,b,c){this.marker=a;this.from=b;this.to=c}function Vb(a,b){if(a)for(var c=0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function vd(a,b){if(b.full)return null;var c=Nb(a,b.from.line)&&E(a,b.from.line).markedSpans,
d=Nb(a,b.to.line)&&E(a,b.to.line).markedSpans;if(!c&&!d)return null;var f=b.from.ch,g=b.to.ch,h=0==I(b.from,b.to);if(c)for(var m=0,n;m<c.length;++m){var r=c[m],q=r.marker;if(null==r.from||(q.inclusiveLeft?r.from<=f:r.from<f)||!(r.from!=f||"bookmark"!=q.type||h&&r.marker.insertLeft)){var s=null==r.to||(q.inclusiveRight?r.to>=f:r.to>f);(n||(n=[])).push(new Nc(q,r.from,s?null:r.to))}}c=n;if(d)for(var m=0,v;m<d.length;++m)if(n=d[m],r=n.marker,null==n.to||(r.inclusiveRight?n.to>=g:n.to>g)||n.from==g&&
"bookmark"==r.type&&(!h||n.marker.insertLeft))q=null==n.from||(r.inclusiveLeft?n.from<=g:n.from<g),(v||(v=[])).push(new Nc(r,q?null:n.from-g,null==n.to?null:n.to-g));d=v;h=1==b.text.length;v=P(b.text).length+(h?f:0);if(c)for(g=0;g<c.length;++g)if(m=c[g],null==m.to)(n=Vb(d,m.marker),n)?h&&(m.to=null==n.to?null:n.to+v):m.to=f;if(d)for(g=0;g<d.length;++g)m=d[g],null!=m.to&&(m.to+=v),null==m.from?(n=Vb(c,m.marker),n||(m.from=v,h&&(c||(c=[])).push(m))):(m.from+=v,h&&(c||(c=[])).push(m));c&&(c=Re(c));d&&
d!=c&&(d=Re(d));f=[c];if(!h){var h=b.text.length-2,u;if(0<h&&c)for(g=0;g<c.length;++g)null==c[g].to&&(u||(u=[])).push(new Nc(c[g].marker,null,null));for(g=0;g<h;++g)f.push(u);f.push(d)}return f}function Re(a){for(var b=0;b<a.length;++b){var c=a[b];null!=c.from&&c.from==c.to&&!1!==c.marker.clearWhenEmpty&&a.splice(b--,1)}return a.length?a:null}function Je(a,b){var c;if(c=b["spans_"+a.id]){for(var d=0,f=[];d<b.text.length;++d)f.push(Wf(c[d]));c=f}else c=null;d=vd(a,b);if(!c)return d;if(!d)return c;
for(f=0;f<c.length;++f){var g=c[f],h=d[f];if(g&&h){var m=0;a:for(;m<h.length;++m){for(var n=h[m],r=0;r<g.length;++r)if(g[r].marker==n.marker)continue a;g.push(n)}}else h&&(c[f]=h)}return c}function Rf(a,b,c){var d=null;a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||d&&-1!=fa(d,c)||(d||(d=[])).push(c)}});if(!d)return null;a=[{from:b,to:c}];for(b=0;b<d.length;++b){c=d[b];for(var f=c.find(0),g=0;g<a.length;++g){var h=
a[g];if(!(0>I(h.to,f.from)||0<I(h.from,f.to))){var m=[g,1],n=I(h.from,f.from),r=I(h.to,f.to);(0>n||!c.inclusiveLeft&&!n)&&m.push({from:h.from,to:f.from});(0<r||!c.inclusiveRight&&!r)&&m.push({from:f.to,to:h.to});a.splice.apply(a,m);g+=m.length-1}}}return a}function Se(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function Te(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function Ue(a,b){var c=a.lines.length-
b.lines.length;if(0!=c)return c;var c=a.find(),d=b.find(),f=I(c.from,d.from)||(a.inclusiveLeft?-1:0)-(b.inclusiveLeft?-1:0);return f?-f:(c=I(c.to,d.to)||(a.inclusiveRight?1:0)-(b.inclusiveRight?1:0))?c:b.id-a.id}function Wa(a,b){var c=Na&&a.markedSpans,d;if(c)for(var f,g=0;g<c.length;++g)f=c[g],f.marker.collapsed&&null==(b?f.from:f.to)&&(!d||0>Ue(d,f.marker))&&(d=f.marker);return d}function Pe(a,b,c,d,f){a=E(a,b);if(a=Na&&a.markedSpans)for(b=0;b<a.length;++b){var g=a[b];if(g.marker.collapsed){var h=
g.marker.find(0),m=I(h.from,c)||(g.marker.inclusiveLeft?-1:0)-(f.inclusiveLeft?-1:0),n=I(h.to,d)||(g.marker.inclusiveRight?1:0)-(f.inclusiveRight?1:0);if(!(0<=m&&0>=n||0>=m&&0<=n)&&(0>=m&&(0<I(h.to,c)||g.marker.inclusiveRight&&f.inclusiveLeft)||0<=m&&(0>I(h.from,d)||g.marker.inclusiveLeft&&f.inclusiveRight)))return!0}}}function Ea(a){for(var b;b=Wa(a,!0);)a=b.find(-1,!0).line;return a}function Wc(a,b){var c=E(a,b),d=Ea(c);return c==d?b:Q(d)}function Md(a,b){if(b>a.lastLine())return b;var c=E(a,b),
d;if(!Ua(a,c))return b;for(;d=Wa(c,!1);)c=d.find(1,!0).line;return Q(c)+1}function Ua(a,b){var c=Na&&b.markedSpans;if(c)for(var d,f=0;f<c.length;++f)if(d=c[f],d.marker.collapsed&&(null==d.from||!d.marker.widgetNode&&0==d.from&&d.marker.inclusiveLeft&&Ad(a,b,d)))return!0}function Ad(a,b,c){if(null==c.to)return b=c.marker.find(1,!0),Ad(a,b.line,Vb(b.line.markedSpans,c.marker));if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var d,f=0;f<b.markedSpans.length;++f)if(d=b.markedSpans[f],d.marker.collapsed&&
!d.marker.widgetNode&&d.from==c.to&&(null==d.to||d.to!=c.from)&&(d.marker.inclusiveLeft||c.marker.inclusiveRight)&&Ad(a,b,d))return!0}function Rb(a){if(null!=a.height)return a.height;var b=a.doc.cm;if(!b)return 0;if(!cd(document.body,a.node)){var c="position: relative;";a.coverGutter&&(c+="margin-left: -"+b.display.gutters.offsetWidth+"px;");a.noHScroll&&(c+="width: "+b.display.wrapper.clientWidth+"px;");qa(b.display.measure,D("div",[a.node],null,c))}return a.height=a.node.offsetHeight}function Xf(a,
b,c,d){var f=new Pc(a,c,d),g=a.cm;g&&f.noHScroll&&(g.display.alignWidgets=!0);Kc(a,b,"widget",function(b){var c=b.widgets||(b.widgets=[]);null==f.insertAt?c.push(f):c.splice(Math.min(c.length-1,Math.max(0,f.insertAt)),0,f);f.line=b;g&&!Ua(a,b)&&(c=Aa(b)<a.scrollTop,ya(b,b.height+Rb(f)),c&&Ic(g,null,f.height),g.curOp.forceUpdate=!0);return!0});return f}function Ve(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!c)break;a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var d=
c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:(new RegExp("(?:^|s)"+c[2]+"(?:$|s)")).test(b[d])||(b[d]+=" "+c[2])}return a}function We(a,b){if(a.blankLine)return a.blankLine(b);if(a.innerMode){var d=c.innerMode(a,b);if(d.mode.blankLine)return d.mode.blankLine(d.state)}}function Bd(a,b,d,f){for(var g=0;10>g;g++){f&&(f[0]=c.innerMode(a,d).mode);var h=a.token(b,d);if(b.pos>b.start)return h}throw Error("Mode "+a.name+" failed to advance stream.");}function Xe(a,b,c,d){function f(a){return{start:q.start,
end:q.pos,string:q.current(),type:m||null,state:a?qb(g.mode,r):r}}var g=a.doc,h=g.mode,m;b=H(g,b);var n=E(g,b.line),r=Pb(a,b.line,c),q=new Qc(n.text,a.options.tabSize),s;for(d&&(s=[]);(d||q.pos<b.ch)&&!q.eol();)q.start=q.pos,m=Bd(h,q,r),d&&s.push(f(!0));return d?s:f()}function Ye(a,b,c,d,f,g,h){var m=c.flattenSpans;null==m&&(m=a.options.flattenSpans);var n=0,r=null,q=new Qc(b,a.options.tabSize),s,v=a.options.addModeClass&&[null];for(""==b&&Ve(We(c,d),g);!q.eol();){q.pos>a.options.maxHighlightLength?
(m=!1,h&&fd(a,b,d,q.pos),q.pos=b.length,s=null):s=Ve(Bd(c,q,d,v),g);if(v){var u=v[0].name;u&&(s="m-"+(s?u+" "+s:u))}if(!m||r!=s){for(;n<q.start;)n=Math.min(q.start,n+5E4),f(n,r);r=s}q.start=q.pos}for(;n<q.pos;)a=Math.min(q.pos,n+5E4),f(a,r),n=a}function ie(a,b,c,d){var f=[a.state.modeGen],g={};Ye(a,b.text,a.doc.mode,c,function(a,b){f.push(a,b)},g,d);for(c=0;c<a.state.overlays.length;++c){var h=a.state.overlays[c],m=1,n=0;Ye(a,b.text,h.mode,!0,function(a,b){for(var c=m;n<a;){var d=f[m];d>a&&f.splice(m,
1,a,f[m+1],d);m+=2;n=Math.min(a,d)}if(b)if(h.opaque)f.splice(c,m-c,a,"cm-overlay "+b),m=c+2;else for(;c<m;c+=2)d=f[c+1],f[c+1]=(d?d+" ":"")+"cm-overlay "+b},g)}return{styles:f,classes:g.bgClass||g.textClass?g:null}}function Ze(a,b,c){if(!b.styles||b.styles[0]!=a.state.modeGen){var d=ie(a,b,b.stateAfter=Pb(a,Q(b)));b.styles=d.styles;d.classes?b.styleClasses=d.classes:b.styleClasses&&(b.styleClasses=null);c===a.doc.frontier&&a.doc.frontier++}return b.styles}function fd(a,b,c,d){var f=a.doc.mode,g=new Qc(b,
a.options.tabSize);g.start=g.pos=d||0;for(""==b&&We(f,c);!g.eol()&&g.pos<=a.options.maxHighlightLength;)Bd(f,g,c),g.start=g.pos}function $e(a,b){if(!a||/^\s*$/.test(a))return null;var c=b.addModeClass?Yf:Zf;return c[a]||(c[a]=a.replace(/\S+/g,"cm-$&"))}function Pd(a,b){var c=D("span",null,null,aa?"padding-right: .1px":null),c={pre:D("pre",[c],"CodeMirror-line"),content:c,col:0,pos:0,cm:a,splitSpaces:(O||aa)&&a.getOption("lineWrapping")};b.measure={};for(var d=0;d<=(b.rest?b.rest.length:0);d++){var f=
d?b.rest[d-1]:b.line,g;c.pos=0;c.addToken=$f;var h;if(null!=Cd)h=Cd;else{h=qa(a.display.measure,document.createTextNode("A\u062eA"));var m=$a(h,0,1).getBoundingClientRect();h=m&&m.left!=m.right?Cd=3>$a(h,1,2).getBoundingClientRect().right-m.right:!1}h&&(g=ua(f))&&(c.addToken=ag(c.addToken,g));c.map=[];m=b!=a.display.externalMeasured&&Q(f);a:{h=c;var m=Ze(a,f,m),n=f.markedSpans,r=f.text,q=0;if(n)for(var s=r.length,v=0,u=1,t="",w=void 0,x=void 0,B=0,Y=void 0,J=void 0,Oa=void 0,K=void 0,U=void 0;;){if(B==
v){for(var Y=J=Oa=K=x="",U=null,B=Infinity,L=[],A=0;A<n.length;++A){var z=n[A],C=z.marker;"bookmark"==C.type&&z.from==v&&C.widgetNode?L.push(C):z.from<=v&&(null==z.to||z.to>v||C.collapsed&&z.to==v&&z.from==v)?(null!=z.to&&z.to!=v&&B>z.to&&(B=z.to,J=""),C.className&&(Y+=" "+C.className),C.css&&(x=C.css),C.startStyle&&z.from==v&&(Oa+=" "+C.startStyle),C.endStyle&&z.to==B&&(J+=" "+C.endStyle),C.title&&!K&&(K=C.title),C.collapsed&&(!U||0>Ue(U.marker,C))&&(U=z)):z.from>v&&B>z.from&&(B=z.from)}if(U&&(U.from||
0)==v){af(h,(null==U.to?s+1:U.to)-v,U.marker,null==U.from);if(null==U.to)break a;U.to==v&&(U=!1)}if(!U&&L.length)for(A=0;A<L.length;++A)af(h,0,L[A])}if(v>=s)break;for(L=Math.min(s,B);;){if(t){A=v+t.length;U||(z=A>L?t.slice(0,L-v):t,h.addToken(h,z,w?w+Y:Y,Oa,v+z.length==B?J:"",K,x));if(A>=L){t=t.slice(L-v);v=L;break}v=A;Oa=""}t=r.slice(q,q=m[u++]);w=$e(m[u++],h.cm.options)}}else for(var u=1;u<m.length;u+=2)h.addToken(h,r.slice(q,q=m[u]),$e(m[u+1],h.cm.options))}f.styleClasses&&(f.styleClasses.bgClass&&
(c.bgClass=Dd(f.styleClasses.bgClass,c.bgClass||"")),f.styleClasses.textClass&&(c.textClass=Dd(f.styleClasses.textClass,c.textClass||"")));0==c.map.length&&c.map.push(0,0,c.content.appendChild(bg(a.display.measure)));0==d?(b.measure.map=c.map,b.measure.cache={}):((b.measure.maps||(b.measure.maps=[])).push(c.map),(b.measure.caches||(b.measure.caches=[])).push({}))}aa&&/\bcm-tab\b/.test(c.content.lastChild.className)&&(c.content.className="cm-tab-wrap-hack");Z(a,"renderLine",a,b.line,c.pre);c.pre.className&&
(c.textClass=Dd(c.pre.className,c.textClass||""));return c}function $f(a,b,c,d,f,g,h){if(b){var m=a.splitSpaces?b.replace(/ {3,}/g,cg):b,n=a.cm.state.specialChars,r=!1;if(n.test(b))for(var q=document.createDocumentFragment(),s=0;;){n.lastIndex=s;var v=n.exec(b),u=v?v.index-s:b.length-s;if(u){var t=document.createTextNode(m.slice(s,s+u));O&&9>V?q.appendChild(D("span",[t])):q.appendChild(t);a.map.push(a.pos,a.pos+u,t);a.col+=u;a.pos+=u}if(!v)break;s+=u+1;"\t"==v[0]?(t=a.cm.options.tabSize,v=t-a.col%
t,t=q.appendChild(D("span",Me(v),"cm-tab")),t.setAttribute("role","presentation"),t.setAttribute("cm-text","\t"),a.col+=v):("\r"==v[0]||"\n"==v[0]?(t=q.appendChild(D("span","\r"==v[0]?"\u240d":"\u2424","cm-invalidchar")),t.setAttribute("cm-text",v[0])):(t=a.cm.options.specialCharPlaceholder(v[0]),t.setAttribute("cm-text",v[0]),O&&9>V?q.appendChild(D("span",[t])):q.appendChild(t)),a.col+=1);a.map.push(a.pos,a.pos+1,t);a.pos++}else{a.col+=b.length;var q=document.createTextNode(m);a.map.push(a.pos,a.pos+
b.length,q);O&&9>V&&(r=!0);a.pos+=b.length}if(c||d||f||r||h)return b=c||"",d&&(b+=d),f&&(b+=f),d=D("span",[q],b,h),g&&(d.title=g),a.content.appendChild(d);a.content.appendChild(q)}}function cg(a){for(var b=" ",c=0;c<a.length-2;++c)b+=c%2?" ":"\u00a0";return b+" "}function ag(a,b){return function(c,d,f,g,h,m,n){f=f?f+" cm-force-border":"cm-force-border";for(var r=c.pos,q=r+d.length;;){for(var s=0;s<b.length;s++){var v=b[s];if(v.to>r&&v.from<=r)break}if(v.to>=q)return a(c,d,f,g,h,m,n);a(c,d.slice(0,
v.to-r),f,g,null,m,n);g=null;d=d.slice(v.to-r);r=v.to}}}function af(a,b,c,d){var f=!d&&c.widgetNode;f&&a.map.push(a.pos,a.pos+b,f);!d&&a.cm.display.input.needsContentAttribute&&(f||(f=a.content.appendChild(document.createElement("span"))),f.setAttribute("cm-marker",c.id));f&&(a.cm.display.input.setUneditable(f),a.content.appendChild(f));a.pos+=b}function Le(a,b){return 0==b.from.ch&&0==b.to.ch&&""==P(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function xd(a,b,c,d){function f(a,c,N){a.text=
c;a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null);null!=a.order&&(a.order=null);Se(a);Te(a,N);c=d?d(a):1;c!=a.height&&ya(a,c);ga(a,"change",a,b)}function g(a,b){for(var N=a,f=[];N<b;++N)f.push(new Wb(n[N],c?c[N]:null,d));return f}var h=b.from,m=b.to,n=b.text,r=E(a,h.line),q=E(a,m.line),s=P(n),v=c?c[n.length-1]:null,u=m.line-h.line;if(b.full)a.insert(0,g(0,n.length)),a.remove(n.length,a.size-n.length);else if(Le(a,b)){var t=g(0,n.length-1);f(q,q.text,v);u&&a.remove(h.line,u);t.length&&
a.insert(h.line,t)}else r==q?1==n.length?f(r,r.text.slice(0,h.ch)+s+r.text.slice(m.ch),v):(t=g(1,n.length-1),t.push(new Wb(s+r.text.slice(m.ch),v,d)),f(r,r.text.slice(0,h.ch)+n[0],c?c[0]:null),a.insert(h.line+1,t)):1==n.length?(f(r,r.text.slice(0,h.ch)+n[0]+q.text.slice(m.ch),c?c[0]:null),a.remove(h.line+1,u)):(f(r,r.text.slice(0,h.ch)+n[0],c?c[0]:null),f(q,s+q.text.slice(m.ch),v),t=g(1,n.length-1),1<u&&a.remove(h.line+1,u-1),a.insert(h.line+1,t));ga(a,"change",a,b)}function Xb(a){this.lines=a;this.parent=
null;for(var b=0,c=0;b<a.length;++b)a[b].parent=this,c+=a[b].height;this.height=c}function Yb(a){this.children=a;for(var b=0,c=0,d=0;d<a.length;++d){var f=a[d],b=b+f.chunkSize(),c=c+f.height;f.parent=this}this.size=b;this.height=c;this.parent=null}function cb(a,b,c){function d(a,N,f){if(a.linked)for(var g=0;g<a.linked.length;++g){var h=a.linked[g];if(h.doc!=N){var m=f&&h.sharedHist;if(!c||m)b(h.doc,m),d(h.doc,a,m)}}}d(a,null,!0)}function Id(a,c){if(c.cm)throw Error("This document is already in use.");
a.doc=c;c.cm=a;g(a);b(a);a.options.lineWrapping||w(a);a.options.mode=c.modeOption;la(a)}function E(a,b){b-=a.first;if(0>b||b>=a.size)throw Error("There is no line "+(b+a.first)+" in the document.");for(var c=a;!c.lines;)for(var d=0;;++d){var f=c.children[d],g=f.chunkSize();if(b<g){c=f;break}b-=g}return c.lines[b]}function Za(a,b,c){var d=[],f=b.line;a.iter(b.line,c.line+1,function(a){a=a.text;f==c.line&&(a=a.slice(0,c.ch));f==b.line&&(a=a.slice(b.ch));d.push(a);++f});return d}function Ed(a,b,c){var d=
[];a.iter(b,c,function(a){d.push(a.text)});return d}function ya(a,b){var c=b-a.height;if(c)for(var d=a;d;d=d.parent)d.height+=c}function Q(a){if(null==a.parent)return null;var b=a.parent;a=fa(b.lines,a);for(var c=b.parent;c;b=c,c=c.parent)for(var d=0;c.children[d]!=b;++d)a+=c.children[d].chunkSize();return a+b.first}function Xa(a,b){var c=a.first;a:do{for(var d=0;d<a.children.length;++d){var f=a.children[d],g=f.height;if(b<g){a=f;continue a}b-=g;c+=f.chunkSize()}return c}while(!a.lines);for(d=0;d<
a.lines.length;++d){f=a.lines[d].height;if(b<f)break;b-=f}return c+d}function Aa(a){a=Ea(a);for(var b=0,c=a.parent,d=0;d<c.lines.length;++d){var f=c.lines[d];if(f==a)break;else b+=f.height}for(a=c.parent;a;c=a,a=c.parent)for(d=0;d<a.children.length&&(f=a.children[d],f!=c);++d)b+=f.height;return b}function ua(a){var b=a.order;null==b&&(b=a.order=dg(a.text));return b}function Rc(a){this.done=[];this.undone=[];this.undoDepth=Infinity;this.lastModTime=this.lastSelTime=0;this.lastOrigin=this.lastSelOrigin=
this.lastOp=this.lastSelOp=null;this.generation=this.maxGeneration=a||1}function wd(a,b){var c={from:Zc(b.from),to:bb(b),text:Za(a,b.from,b.to)};bf(a,c,b.from.line,b.to.line+1);cb(a,function(a){bf(a,c,b.from.line,b.to.line+1)},!0);return c}function be(a){for(;a.length;)if(P(a).ranges)a.pop();else break}function He(a,b,c,d){var f=a.history;f.undone.length=0;var g=+new Date,h,m;if(m=f.lastOp==d||f.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&f.lastModTime>g-a.cm.options.historyEventDelay||
"*"==b.origin.charAt(0)))f.lastOp==d?(be(f.done),h=P(f.done)):f.done.length&&!P(f.done).ranges?h=P(f.done):1<f.done.length&&!f.done[f.done.length-2].ranges?(f.done.pop(),h=P(f.done)):h=void 0,m=h;if(m){var n=P(h.changes);0==I(b.from,b.to)&&0==I(b.from,n.to)?n.to=bb(b):h.changes.push(wd(a,b))}else for((h=P(f.done))&&h.ranges||sc(a.sel,f.done),h={changes:[wd(a,b)],generation:f.generation},f.done.push(h);f.done.length>f.undoDepth;)f.done.shift(),f.done[0].ranges||f.done.shift();f.done.push(c);f.generation=
++f.maxGeneration;f.lastModTime=f.lastSelTime=g;f.lastOp=f.lastSelOp=d;f.lastOrigin=f.lastSelOrigin=b.origin;n||Z(a,"historyAdded")}function sc(a,b){var c=P(b);c&&c.ranges&&c.equals(a)||b.push(a)}function bf(a,b,c,d){var f=b["spans_"+a.id],g=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(c){c.markedSpans&&((f||(f=b["spans_"+a.id]={}))[g]=c.markedSpans);++g})}function Wf(a){if(!a)return null;for(var b=0,c;b<a.length;++b)a[b].marker.explicitlyCleared?c||(c=a.slice(0,b)):c&&c.push(a[b]);
return c?c.length?c:null:a}function wb(a,b,c){for(var d=0,f=[];d<a.length;++d){var g=a[d];if(g.ranges)f.push(c?Ha.prototype.deepCopy.call(g):g);else{var g=g.changes,h=[];f.push({changes:h});for(var m=0;m<g.length;++m){var n=g[m],r;h.push({from:n.from,to:n.to,text:n.text});if(b)for(var q in n)(r=q.match(/^spans_(\d+)$/))&&-1<fa(b,Number(r[1]))&&(P(h)[q]=n[q],delete n[q])}}}return f}function cf(a,b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)}function df(a,b,c,d){for(var f=0;f<a.length;++f){var g=
a[f],h=!0;if(g.ranges){g.copied||(g=a[f]=g.deepCopy(),g.copied=!0);for(var m=0;m<g.ranges.length;m++)cf(g.ranges[m].anchor,b,c,d),cf(g.ranges[m].head,b,c,d)}else{for(m=0;m<g.changes.length;++m){var n=g.changes[m];if(c<n.from.line)n.from=z(n.from.line+d,n.from.ch),n.to=z(n.to.line+d,n.to.ch);else if(b<=n.to.line){h=!1;break}}h||(a.splice(0,f+1),f=0)}}}function Ie(a,b){var c=b.from.line,d=b.to.line,f=b.text.length-(d-c)-1;df(a.done,c,d,f);df(a.undone,c,d,f)}function sd(a){return null!=a.defaultPrevented?
a.defaultPrevented:!1==a.returnValue}function we(a){var b=a.which;null==b&&(a.button&1?b=1:a.button&2?b=3:a.button&4&&(b=2));ta&&a.ctrlKey&&1==b&&(b=3);return b}function ga(a,b){function c(a){return function(){a.apply(null,f)}}var d=a._handlers&&a._handlers[b];if(d){var f=Array.prototype.slice.call(arguments,2),g;rb?g=rb.delayedCallbacks:Zb?g=Zb:(g=Zb=[],setTimeout(eg,0));for(var h=0;h<d.length;++h)g.push(c(d[h]))}}function eg(){var a=Zb;Zb=null;for(var b=0;b<a.length;++b)a[b]()}function Fa(a,b,c){"string"==
typeof b&&(b={type:b,preventDefault:function(){this.defaultPrevented=!0}});Z(a,c||b.type,a,b);return sd(b)||b.codemirrorIgnore}function ee(a){var b=a._handlers&&a._handlers.cursorActivity;if(b){a=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=[]);for(var c=0;c<b.length;++c)-1==fa(a,b[c])&&a.push(b[c])}}function pa(a,b){var c=a._handlers&&a._handlers[b];return c&&0<c.length}function xb(a){a.prototype.on=function(a,b){F(this,a,b)};a.prototype.off=function(a,b){Ga(this,a,b)}}function Bb(){this.id=
null}function xe(a,b,c){for(var d=0,f=0;;){var g=a.indexOf("\t",d);-1==g&&(g=a.length);var h=g-d;if(g==a.length||f+h>=b)return d+Math.min(h,b-f);f+=g-d;f+=c-f%c;d=g+1;if(f>=b)return d}}function Me(a){for(;Sc.length<=a;)Sc.push(P(Sc)+" ");return Sc[a]}function P(a){return a[a.length-1]}function fa(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return c;return-1}function nc(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=b(a[d],d);return c}function $b(){}function ef(a,b){var c;Object.create?c=Object.create(a):
($b.prototype=a,c=new $b);b&&ra(b,c);return c}function ra(a,b,c){b||(b={});for(var d in a)!a.hasOwnProperty(d)||!1===c&&b.hasOwnProperty(d)||(b[d]=a[d]);return b}function Cb(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function Lc(a,b){return b?-1<b.source.indexOf("\\w")&&ff(a)?!0:b.test(a):ff(a)}function gf(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function Qb(a){return 768<=a.charCodeAt(0)&&fg.test(a)}function D(a,b,c,d){a=document.createElement(a);
c&&(a.className=c);d&&(a.style.cssText=d);if("string"==typeof b)a.appendChild(document.createTextNode(b));else if(b)for(c=0;c<b.length;++c)a.appendChild(b[c]);return a}function Va(a){for(var b=a.childNodes.length;0<b;--b)a.removeChild(a.firstChild);return a}function qa(a,b){return Va(a).appendChild(b)}function Ba(){for(var a=document.activeElement;a&&a.root&&a.root.activeElement;)a=a.root.activeElement;return a}function ac(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}function Dd(a,b){for(var c=
a.split(" "),d=0;d<c.length;d++)c[d]&&!ac(c[d]).test(b)&&(b+=" "+c[d]);return b}function hf(a){if(document.body.getElementsByClassName)for(var b=document.body.getElementsByClassName("CodeMirror"),c=0;c<b.length;c++){var d=b[c].CodeMirror;d&&a(d)}}function rf(){var a;F(window,"resize",function(){null==a&&(a=setTimeout(function(){a=null;hf(Ff)},100))});F(window,"blur",function(){hf(Db)})}function bg(a){if(null==Fd){var b=D("span","\u200b");qa(a,D("span",[b,document.createTextNode("x")]));0!=a.firstChild.offsetHeight&&
(Fd=1>=b.offsetWidth&&2<b.offsetHeight&&!(O&&8>V))}a=Fd?D("span","\u200b"):D("span","\u00a0",null,"display: inline-block; width: 1px; margin-right: -1px");a.setAttribute("cm-text","");return a}function xf(a,b,c,d){if(!a)return d(b,c,"ltr");for(var f=!1,g=0;g<a.length;++g){var h=a[g];if(h.from<c&&h.to>b||b==c&&h.to==b)d(Math.max(h.from,b),Math.min(h.to,c),1==h.level?"rtl":"ltr"),f=!0}f||d(b,c,"ltr")}function kd(a){return a.level%2?a.to:a.from}function ld(a){return a.level%2?a.from:a.to}function xc(a){return(a=
ua(a))?kd(a[0]):0}function yc(a){var b=ua(a);return b?ld(P(b)):a.text.length}function jf(a,b){var c=E(a.doc,b),d=Ea(c);d!=c&&(b=Q(d));d=(c=ua(d))?c[0].level%2?yc(d):xc(d):0;return z(b,d)}function kf(a,b){var c=jf(a,b.line),d=E(a.doc,c.line),f=ua(d);return f&&0!=f[0].level?c:(d=Math.max(0,d.text.search(/\S/)),z(c.line,b.line==c.line&&b.ch<=d&&b.ch?0:d))}function oc(a,b){Sb=null;for(var c=0,d;c<a.length;++c){var f=a[c];if(f.from<b&&f.to>b)return c;if(f.from==b||f.to==b)if(null==d)d=c;else{var g;g=f.level;
var h=a[d].level,m=a[0].level;g=g==m?!0:h==m?!1:g<h;if(g)return f.from!=f.to&&(Sb=d),c;f.from!=f.to&&(Sb=c);break}}return d}function Gd(a,b,c,d){if(!d)return b+c;do b+=c;while(0<b&&Qb(a.text.charAt(b)));return b}function nd(a,b,c,d){var f=ua(a);if(!f)return Ne(a,b,c,d);var g=oc(f,b),h=f[g];for(b=Gd(a,b,h.level%2?-c:c,d);;){if(b>h.from&&b<h.to)return b;if(b==h.from||b==h.to){if(oc(f,b)==g)return b;h=f[g+c];return 0<c==h.level%2?h.to:h.from}h=f[g+=c];if(!h)return null;b=0<c==h.level%2?Gd(a,h.to,-1,
d):Gd(a,h.from,1,d)}}function Ne(a,b,c,d){b+=c;if(d)for(;0<b&&Qb(a.text.charAt(b));)b+=c;return 0>b||b>a.text.length?null:b}var Sa=/gecko\/\d/i.test(navigator.userAgent),lf=/MSIE \d/.test(navigator.userAgent),mf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),O=lf||mf,V=O&&(lf?document.documentMode||6:mf[1]),aa=/WebKit\//.test(navigator.userAgent),gg=aa&&/Qt\/\d+\.\d+/.test(navigator.userAgent),hg=/Chrome\//.test(navigator.userAgent),xa=/Opera\//.test(navigator.userAgent),se=/Apple Computer/.test(navigator.vendor),
ig=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Df=/PhantomJS/.test(navigator.userAgent),ob=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),Ab=ob||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),ta=ob||/Mac/.test(navigator.platform),jg=/win/i.test(navigator.platform),eb=xa&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);eb&&(eb=Number(eb[1]));eb&&15<=eb&&(xa=!1,aa=!0);var nf=ta&&(gg||xa&&(null==eb||12.11>eb)),pd=Sa||
O&&9<=V,Fe=!1,Na=!1;r.prototype=ra({update:function(a){var b=a.scrollWidth>a.clientWidth+1,c=a.scrollHeight>a.clientHeight+1,d=a.nativeBarWidth;c?(this.vert.style.display="block",this.vert.style.bottom=b?d+"px":"0",this.vert.firstChild.style.height=Math.max(0,a.scrollHeight-a.clientHeight+(a.viewHeight-(b?d:0)))+"px"):(this.vert.style.display="",this.vert.firstChild.style.height="0");b?(this.horiz.style.display="block",this.horiz.style.right=c?d+"px":"0",this.horiz.style.left=a.barLeft+"px",this.horiz.firstChild.style.width=
a.scrollWidth-a.clientWidth+(a.viewWidth-a.barLeft-(c?d:0))+"px"):(this.horiz.style.display="",this.horiz.firstChild.style.width="0");!this.checkedOverlay&&0<a.clientHeight&&(0==d&&this.overlayHack(),this.checkedOverlay=!0);return{right:c?d:0,bottom:b?d:0}},setScrollLeft:function(a){this.horiz.scrollLeft!=a&&(this.horiz.scrollLeft=a)},setScrollTop:function(a){this.vert.scrollTop!=a&&(this.vert.scrollTop=a)},overlayHack:function(){this.horiz.style.minHeight=this.vert.style.minWidth=ta&&!ig?"12px":
"18px";var a=this,b=function(b){(b.target||b.srcElement)!=a.vert&&(b.target||b.srcElement)!=a.horiz&&X(a.cm,oe)(b)};F(this.vert,"mousedown",b);F(this.horiz,"mousedown",b)},clear:function(){var a=this.horiz.parentNode;a.removeChild(this.horiz);a.removeChild(this.vert)}},r.prototype);s.prototype=ra({update:function(){return{bottom:0,right:0}},setScrollLeft:function(){},setScrollTop:function(){},clear:function(){}},s.prototype);c.scrollbarModel={"native":r,"null":s};T.prototype.signal=function(a,b){pa(a,
b)&&this.events.push(arguments)};T.prototype.finish=function(){for(var a=0;a<this.events.length;a++)Z.apply(null,this.events[a])};var z=c.Pos=function(a,b){if(!(this instanceof z))return new z(a,b);this.line=a;this.ch=b},I=c.cmpPos=function(a,b){return a.line-b.line||a.ch-b.ch},oa=null;$c.prototype=ra({init:function(a){function b(a){if(d.somethingSelected())oa=d.getSelections(),c.inaccurateSelection&&(c.prevInput="",c.inaccurateSelection=!1,g.value=oa.join("\n"),yb(g));else if(d.options.lineWiseCopyCut){var f=
Ud(d);oa=f.text;"cut"==a.type?d.setSelections(f.ranges,null,Da):(c.prevInput="",g.value=f.text.join("\n"),yb(g))}else return;"cut"==a.type&&(d.state.cutIncoming=!0)}var c=this,d=this.cm,f=this.wrapper=Wd(),g=this.textarea=f.firstChild;a.wrapper.insertBefore(f,a.wrapper.firstChild);ob&&(g.style.width="0px");F(g,"input",function(){O&&9<=V&&c.hasSelection&&(c.hasSelection=null);c.poll()});F(g,"paste",function(a){if(Td(a,d))return!0;d.state.pasteIncoming=!0;c.fastPoll()});F(g,"cut",b);F(g,"copy",b);F(a.scroller,
"paste",function(b){Ka(a,b)||(d.state.pasteIncoming=!0,c.focus())});F(a.lineSpace,"selectstart",function(b){Ka(a,b)||ia(b)});F(g,"compositionstart",function(){var a=d.getCursor("from");c.composing={start:a,range:d.markText(a,d.getCursor("to"),{className:"CodeMirror-composing"})}});F(g,"compositionend",function(){c.composing&&(c.poll(),c.composing.range.clear(),c.composing=null)})},prepareSelection:function(){var a=this.cm,b=a.display,c=a.doc,d=ge(a);if(a.options.moveInputWithCursor){var a=Ia(a,c.sel.primary().head,
"div"),c=b.wrapper.getBoundingClientRect(),f=b.lineDiv.getBoundingClientRect();d.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,a.top+f.top-c.top));d.teLeft=Math.max(0,Math.min(b.wrapper.clientWidth-10,a.left+f.left-c.left))}return d},showSelection:function(a){var b=this.cm.display;qa(b.cursorDiv,a.cursors);qa(b.selectionDiv,a.selection);null!=a.teTop&&(this.wrapper.style.top=a.teTop+"px",this.wrapper.style.left=a.teLeft+"px")},reset:function(a){if(!this.contextMenuPending){var b,c,d=this.cm,
f=d.doc;d.somethingSelected()?(this.prevInput="",b=f.sel.primary(),c=(b=Be&&(100<b.to().line-b.from().line||1E3<(c=d.getSelection()).length))?"-":c||d.getSelection(),this.textarea.value=c,d.state.focused&&yb(this.textarea),O&&9<=V&&(this.hasSelection=c)):a||(this.prevInput=this.textarea.value="",O&&9<=V&&(this.hasSelection=null));this.inaccurateSelection=b}},getField:function(){return this.textarea},supportsTouch:function(){return!1},focus:function(){if("nocursor"!=this.cm.options.readOnly&&(!Ab||
Ba()!=this.textarea))try{this.textarea.focus()}catch(a){}},blur:function(){this.textarea.blur()},resetPosition:function(){this.wrapper.style.top=this.wrapper.style.left=0},receivedFocus:function(){this.slowPoll()},slowPoll:function(){var a=this;a.pollingFast||a.polling.set(this.cm.options.pollInterval,function(){a.poll();a.cm.state.focused&&a.slowPoll()})},fastPoll:function(){function a(){c.poll()||b?(c.pollingFast=!1,c.slowPoll()):(b=!0,c.polling.set(60,a))}var b=!1,c=this;c.pollingFast=!0;c.polling.set(20,
a)},poll:function(){var a=this.cm,b=this.textarea,c=this.prevInput;if(this.contextMenuPending||!a.state.focused||kg(b)&&!c&&!this.composing||kc(a)||a.options.disableInput||a.state.keySeq)return!1;var d=b.value;if(d==c&&!a.somethingSelected())return!1;if(O&&9<=V&&this.hasSelection===d||ta&&/[\uf700-\uf7ff]/.test(d))return a.display.input.reset(),!1;if(a.doc.sel==a.display.selForContextMenu){var f=d.charCodeAt(0);8203!=f||c||(c="\u200b");if(8666==f)return this.reset(),this.cm.execCommand("undo")}for(var g=
0,f=Math.min(c.length,d.length);g<f&&c.charCodeAt(g)==d.charCodeAt(g);)++g;var h=this;ma(a,function(){lc(a,d.slice(g),c.length-g,null,h.composing?"*compose":null);1E3<d.length||-1<d.indexOf("\n")?b.value=h.prevInput="":h.prevInput=d;h.composing&&(h.composing.range.clear(),h.composing.range=a.markText(h.composing.start,a.getCursor("to"),{className:"CodeMirror-composing"}))});return!0},ensurePolled:function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},onKeyPress:function(){O&&9<=V&&(this.hasSelection=
null);this.fastPoll()},onContextMenu:function(a){function b(){if(null!=h.selectionStart){var a=f.somethingSelected(),c="\u200b"+(a?h.value:"");h.value="\u21da";h.value=c;d.prevInput=a?"":"\u200b";h.selectionStart=1;h.selectionEnd=c.length;g.selForContextMenu=f.doc.sel}}function c(){d.contextMenuPending=!1;d.wrapper.style.position="relative";h.style.cssText=r;O&&9>V&&g.scrollbars.setScrollTop(g.scroller.scrollTop=n);if(null!=h.selectionStart){(!O||O&&9>V)&&b();var a=0,N=function(){g.selForContextMenu==
f.doc.sel&&0==h.selectionStart&&0<h.selectionEnd&&"\u200b"==d.prevInput?X(f,Fc.selectAll)(f):10>a++?g.detectingSelectAll=setTimeout(N,500):g.input.reset()};g.detectingSelectAll=setTimeout(N,200)}}var d=this,f=d.cm,g=f.display,h=d.textarea,m=sb(f,a),n=g.scroller.scrollTop;if(m&&!xa){f.options.resetSelectionOnContextMenu&&-1==f.doc.sel.contains(m)&&X(f,ba)(f.doc,Ca(m),Da);var r=h.style.cssText;d.wrapper.style.position="absolute";h.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(a.clientY-
5)+"px; left: "+(a.clientX-5)+"px; z-index: 1000; background: "+(O?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";if(aa)var q=window.scrollY;g.input.focus();aa&&window.scrollTo(null,q);g.input.reset();f.somethingSelected()||(h.value=d.prevInput=" ");d.contextMenuPending=!0;g.selForContextMenu=f.doc.sel;clearTimeout(g.detectingSelectAll);O&&9<=V&&b();if(pd){qd(a);var s=function(){Ga(window,"mouseup",
s);setTimeout(c,20)};F(window,"mouseup",s)}else setTimeout(c,50)}},setUneditable:$b,needsContentAttribute:!1},$c.prototype);ad.prototype=ra({init:function(a){function b(a){if(d.somethingSelected())oa=d.getSelections(),"cut"==a.type&&d.replaceSelection("",null,"cut");else if(d.options.lineWiseCopyCut){var c=Ud(d);oa=c.text;"cut"==a.type&&d.operation(function(){d.setSelections(c.ranges,0,Da);d.replaceSelection("",null,"cut")})}else return;if(a.clipboardData&&!ob)a.preventDefault(),a.clipboardData.clearData(),
a.clipboardData.setData("text/plain",oa.join("\n"));else{var f=Wd();a=f.firstChild;d.display.lineSpace.insertBefore(f,d.display.lineSpace.firstChild);a.value=oa.join("\n");var g=document.activeElement;yb(a);setTimeout(function(){d.display.lineSpace.removeChild(f);g.focus()},50)}}var c=this,d=c.cm;a=c.div=a.lineDiv;a.contentEditable="true";Vd(a);F(a,"paste",function(a){Td(a,d)});F(a,"compositionstart",function(a){a=a.data;c.composing={sel:d.doc.sel,data:a,startData:a};if(a){var b=d.doc.sel.primary(),
f=d.getLine(b.head.line).indexOf(a,Math.max(0,b.head.ch-a.length));-1<f&&f<=b.head.ch&&(c.composing.sel=Ca(z(b.head.line,f),z(b.head.line,f+a.length)))}});F(a,"compositionupdate",function(a){c.composing.data=a.data});F(a,"compositionend",function(a){var b=c.composing;b&&(a.data==b.startData||/\u200b/.test(a.data)||(b.data=a.data),setTimeout(function(){b.handled||c.applyComposition(b);c.composing==b&&(c.composing=null)},50))});F(a,"touchstart",function(){c.forceCompositionEnd()});F(a,"input",function(){c.composing||
c.pollContent()||ma(c.cm,function(){la(d)})});F(a,"copy",b);F(a,"cut",b)},prepareSelection:function(){var a=ge(this.cm,!1);a.focus=this.cm.state.focused;return a},showSelection:function(a){a&&this.cm.display.view.length&&(a.focus&&this.showPrimarySelection(),this.showMultipleSelections(a))},showPrimarySelection:function(){var a=window.getSelection(),b=this.cm.doc.sel.primary(),c=pc(this.cm,a.anchorNode,a.anchorOffset),d=pc(this.cm,a.focusNode,a.focusOffset);if(!c||c.bad||!d||d.bad||0!=I(jc(c,d),b.from())||
0!=I(ic(c,d),b.to()))if(c=Xd(this.cm,b.from()),d=Xd(this.cm,b.to()),c||d){var f=this.cm.display.view,b=a.rangeCount&&a.getRangeAt(0);c?d||(d=f[f.length-1].measure,d=d.maps?d.maps[d.maps.length-1]:d.map,d={node:d[d.length-1],offset:d[d.length-2]-d[d.length-3]}):c={node:f[0].measure.map[2],offset:0};try{var g=$a(c.node,c.offset,d.offset,d.node)}catch(h){}g&&(a.removeAllRanges(),a.addRange(g),b&&null==a.anchorNode?a.addRange(b):Sa&&this.startGracePeriod());this.rememberSelection()}},startGracePeriod:function(){var a=
this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){a.gracePeriod=!1;a.selectionChanged()&&a.cm.operation(function(){a.cm.curOp.selectionChanged=!0})},20)},showMultipleSelections:function(a){qa(this.cm.display.cursorDiv,a.cursors);qa(this.cm.display.selectionDiv,a.selection)},rememberSelection:function(){var a=window.getSelection();this.lastAnchorNode=a.anchorNode;this.lastAnchorOffset=a.anchorOffset;this.lastFocusNode=a.focusNode;this.lastFocusOffset=a.focusOffset},selectionInEditor:function(){var a=
window.getSelection();if(!a.rangeCount)return!1;a=a.getRangeAt(0).commonAncestorContainer;return cd(this.div,a)},focus:function(){"nocursor"!=this.cm.options.readOnly&&this.div.focus()},blur:function(){this.div.blur()},getField:function(){return this.div},supportsTouch:function(){return!0},receivedFocus:function(){function a(){b.cm.state.focused&&(b.pollSelection(),b.polling.set(b.cm.options.pollInterval,a))}var b=this;this.selectionInEditor()?this.pollSelection():ma(this.cm,function(){b.cm.curOp.selectionChanged=
!0});this.polling.set(this.cm.options.pollInterval,a)},selectionChanged:function(){var a=window.getSelection();return a.anchorNode!=this.lastAnchorNode||a.anchorOffset!=this.lastAnchorOffset||a.focusNode!=this.lastFocusNode||a.focusOffset!=this.lastFocusOffset},pollSelection:function(){if(!this.composing&&!this.gracePeriod&&this.selectionChanged()){var a=window.getSelection(),b=this.cm;this.rememberSelection();var c=pc(b,a.anchorNode,a.anchorOffset),d=pc(b,a.focusNode,a.focusOffset);c&&d&&ma(b,function(){ba(b.doc,
Ca(c,d),Da);if(c.bad||d.bad)b.curOp.selectionChanged=!0})}},pollContent:function(){var a=this.cm,b=a.display,c=a.doc.sel.primary(),d=c.from(),c=c.to();if(d.line<b.viewFrom||c.line>b.viewTo-1)return!1;var f;d.line==b.viewFrom||0==(f=Ya(a,d.line))?(d=Q(b.view[0].line),f=b.view[0].node):(d=Q(b.view[f].line),f=b.view[f-1].node.nextSibling);var g=Ya(a,c.line);g==b.view.length-1?(c=b.viewTo-1,b=b.lineDiv.lastChild):(c=Q(b.view[g+1].line)-1,b=b.view[g+1].node.previousSibling);b=a.doc.splitLines(uf(a,f,b,
d,c));for(f=Za(a.doc,z(d,0),z(c,E(a.doc,c).text.length));1<b.length&&1<f.length;)if(P(b)==P(f))b.pop(),f.pop(),c--;else if(b[0]==f[0])b.shift(),f.shift(),d++;else break;for(var h=0,g=0,m=b[0],n=f[0],r=Math.min(m.length,n.length);h<r&&m.charCodeAt(h)==n.charCodeAt(h);)++h;m=P(b);n=P(f);for(r=Math.min(m.length-(1==b.length?h:0),n.length-(1==f.length?h:0));g<r&&m.charCodeAt(m.length-g-1)==n.charCodeAt(n.length-g-1);)++g;b[b.length-1]=m.slice(0,m.length-g);b[0]=b[0].slice(h);d=z(d,h);c=z(c,f.length?P(f).length-
g:0);if(1<b.length||b[0]||I(d,c))return tb(a.doc,b,d,c,"+input"),!0},ensurePolled:function(){this.forceCompositionEnd()},reset:function(){this.forceCompositionEnd()},forceCompositionEnd:function(){this.composing&&!this.composing.handled&&(this.applyComposition(this.composing),this.composing.handled=!0,this.div.blur(),this.div.focus())},applyComposition:function(a){a.data&&a.data!=a.startData&&X(this.cm,lc)(this.cm,a.data,0,a.sel)},setUneditable:function(a){a.setAttribute("contenteditable","false")},
onKeyPress:function(a){a.preventDefault();X(this.cm,lc)(this.cm,String.fromCharCode(null==a.charCode?a.keyCode:a.charCode),0)},onContextMenu:$b,resetPosition:$b,needsContentAttribute:!0},ad.prototype);c.inputStyles={textarea:$c,contenteditable:ad};Ha.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=a.ranges[b];
if(0!=I(c.anchor,d.anchor)||0!=I(c.head,d.head))return!1}return!0},deepCopy:function(){for(var a=[],b=0;b<this.ranges.length;b++)a[b]=new S(Zc(this.ranges[b].anchor),Zc(this.ranges[b].head));return new Ha(a,this.primIndex)},somethingSelected:function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1},contains:function(a,b){b||(b=a);for(var c=0;c<this.ranges.length;c++){var d=this.ranges[c];if(0<=I(b,d.from())&&0>=I(a,d.to()))return c}return-1}};S.prototype={from:function(){return jc(this.anchor,
this.head)},to:function(){return ic(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var hd={left:0,right:0,top:0,bottom:0},ab,rb=null,Cf=0,Cc,Bc,re=0,Dc=0,na=null;O?na=-.53:Sa?na=15:hg?na=-.7:se&&(na=-1/3);var ye=function(a){var b=a.wheelDeltaX,c=a.wheelDeltaY;null==b&&a.detail&&a.axis==a.HORIZONTAL_AXIS&&(b=a.detail);null==c&&a.detail&&a.axis==a.VERTICAL_AXIS?c=a.detail:null==c&&(c=a.wheelDelta);return{x:b,y:c}};c.wheelEventPixels=
function(a){a=ye(a);a.x*=na;a.y*=na;return a};var Nf=new Bb,td=null,bb=c.changeEnd=function(a){return a.text?z(a.from.line+a.text.length-1,P(a.text).length+(1==a.text.length?a.from.ch:0)):a.to};c.prototype={constructor:c,focus:function(){window.focus();this.display.input.focus()},setOption:function(a,b){var c=this.options,d=c[a];if(c[a]!=b||"mode"==a)c[a]=b,gb.hasOwnProperty(a)&&X(this,gb[a])(this,b,d)},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,
b){this.state.keyMaps[b?"push":"unshift"](Mc(a))},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==a||b[c].name==a)return b.splice(c,1),!0},addOverlay:ea(function(a,b){var d=a.token?a:c.getMode(this.options,a);if(d.startState)throw Error("Overlays may not be stateful.");this.state.overlays.push({mode:d,modeSpec:a,opaque:b&&b.opaque});this.state.modeGen++;la(this)}),removeOverlay:ea(function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var d=b[c].modeSpec;if(d==
a||"string"==typeof a&&d.name==a){b.splice(c,1);this.state.modeGen++;la(this);break}}}),indentLine:ea(function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract");Nb(this.doc,a)&&Mb(this,a,b,c)}),indentSelection:ea(function(a){for(var b=this.doc.sel.ranges,c=-1,d=0;d<b.length;d++){var f=b[d];if(f.empty())f.head.line>c&&(Mb(this,f.head.line,a,!0),c=f.head.line,d==this.doc.sel.primIndex&&nb(this));else{for(var g=f.from(),f=f.to(),h=Math.max(c,
g.line),c=Math.min(this.lastLine(),f.line-(f.ch?0:1))+1,f=h;f<c;++f)Mb(this,f,a);f=this.doc.sel.ranges;0==g.ch&&b.length==f.length&&0<f[d].from().ch&&dd(this.doc,d,new S(g,f[d].to()),Da)}}}),getTokenAt:function(a,b){return Xe(this,a,b)},getLineTokens:function(a,b){return Xe(this,z(a),b,!0)},getTokenTypeAt:function(a){a=H(this.doc,a);var b=Ze(this,E(this.doc,a.line)),c=0,d=(b.length-1)/2;a=a.ch;var f;if(0==a)f=b[2];else for(;;){var g=c+d>>1;if((g?b[2*g-1]:0)>=a)d=g;else if(b[2*g+1]<a)c=g+1;else{f=
b[2*g+2];break}}b=f?f.indexOf("cm-overlay "):-1;return 0>b?f:0==b?null:f.slice(0,b-1)},getModeAt:function(a){var b=this.doc.mode;return b.innerMode?c.innerMode(b,this.getTokenAt(a).state).mode:b},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var c=[];if(!zb.hasOwnProperty(b))return c;var d=zb[b],f=this.getModeAt(a);if("string"==typeof f[b])d[f[b]]&&c.push(d[f[b]]);else if(f[b])for(var g=0;g<f[b].length;g++){var h=d[f[b][g]];h&&c.push(h)}else f.helperType&&d[f.helperType]?
c.push(d[f.helperType]):d[f.name]&&c.push(d[f.name]);for(g=0;g<d._global.length;g++)h=d._global[g],h.pred(f,this)&&-1==fa(c,h.val)&&c.push(h.val);return c},getStateAfter:function(a,b){var c=this.doc;a=Math.max(c.first,Math.min(null==a?c.first+c.size-1:a,c.first+c.size-1));return Pb(this,a+1,b)},cursorCoords:function(a,b){var c;c=this.doc.sel.primary();c=null==a?c.head:"object"==typeof a?H(this.doc,a):a?c.from():c.to();return Ia(this,c,b||"page")},charCoords:function(a,b){return uc(this,H(this.doc,
a),b||"page")},coordsChar:function(a,b){a=me(this,a,b||"page");return md(this,a.left,a.top)},lineAtHeight:function(a,b){a=me(this,{top:a,left:0},b||"page").top;return Xa(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b){var c=!1,d;"number"==typeof a?(d=this.doc.first+this.doc.size-1,a<this.doc.first?a=this.doc.first:a>d&&(a=d,c=!0),d=E(this.doc,a)):d=a;return jd(this,d,{top:0,left:0},b||"page").top+(c?this.doc.height-Aa(d):0)},defaultTextHeight:function(){return Ta(this.display)},defaultCharWidth:function(){return Fb(this.display)},
setGutterMarker:ea(function(a,b,c){return Kc(this.doc,a,"gutter",function(a){var d=a.gutterMarkers||(a.gutterMarkers={});d[b]=c;!c&&gf(d)&&(a.gutterMarkers=null);return!0})}),clearGutter:ea(function(a){var b=this,c=b.doc,d=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&(c.gutterMarkers[a]=null,Ja(b,d,"gutter"),gf(c.gutterMarkers)&&(c.gutterMarkers=null));++d})}),lineInfo:function(a){if("number"==typeof a){if(!Nb(this.doc,a))return null;var b=a;a=E(this.doc,a);if(!a)return null}else if(b=
Q(a),null==b)return null;return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,d,f){var g=this.display;a=Ia(this,H(this.doc,a));var h=a.bottom,m=a.left;b.style.position="absolute";b.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(b);g.sizer.appendChild(b);if("over"==d)h=a.top;
else if("above"==d||"near"==d){var n=Math.max(g.wrapper.clientHeight,this.doc.height),r=Math.max(g.sizer.clientWidth,g.lineSpace.clientWidth);("above"==d||a.bottom+b.offsetHeight>n)&&a.top>b.offsetHeight?h=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=n&&(h=a.bottom);m+b.offsetWidth>r&&(m=r-b.offsetWidth)}b.style.top=h+"px";b.style.left=b.style.right="";"right"==f?(m=g.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==f?m=0:"middle"==f&&(m=(g.sizer.clientWidth-b.offsetWidth)/2),b.style.left=
m+"px");c&&(a=zc(this,m,h,m+b.offsetWidth,h+b.offsetHeight),null!=a.scrollTop&&Ib(this,a.scrollTop),null!=a.scrollLeft&&ib(this,a.scrollLeft))},triggerOnKeyDown:ea(ue),triggerOnKeyPress:ea(ve),triggerOnKeyUp:te,execCommand:function(a){if(Fc.hasOwnProperty(a))return Fc[a].call(null,this)},triggerElectric:ea(function(a){Sd(this,a)}),findPosH:function(a,b,c,d){var f=1;0>b&&(f=-1,b=-b);var g=0;for(a=H(this.doc,a);g<b&&(a=yd(this.doc,a,f,c,d),!a.hitSide);++g);return a},moveH:ea(function(a,b){var c=this;
c.extendSelectionsBy(function(d){return c.display.shift||c.doc.extend||d.empty()?yd(c.doc,d.head,a,b,c.options.rtlMoveVisually):0>a?d.from():d.to()},bc)}),deleteH:ea(function(a,b){var c=this.doc;this.doc.sel.somethingSelected()?c.replaceSelection("",null,"+delete"):ub(this,function(d){var f=yd(c,d.head,a,b,!1);return 0>a?{from:f,to:d.head}:{from:d.head,to:f}})}),findPosV:function(a,b,c,d){var f=1;0>b&&(f=-1,b=-b);var g=0;for(a=H(this.doc,a);g<b&&(a=Ia(this,a,"div"),null==d?d=a.left:a.left=d,a=Oe(this,
a,f,c),!a.hitSide);++g);return a},moveV:ea(function(a,b){var c=this,d=this.doc,f=[],g=!c.display.shift&&!d.extend&&d.sel.somethingSelected();d.extendSelectionsBy(function(h){if(g)return 0>a?h.from():h.to();var m=Ia(c,h.head,"div");null!=h.goalColumn&&(m.left=h.goalColumn);f.push(m.left);var n=Oe(c,m,a,b);"page"==b&&h==d.sel.primary()&&Ic(c,null,uc(c,n,"div").top-m.top);return n},bc);if(f.length)for(var h=0;h<d.sel.ranges.length;h++)d.sel.ranges[h].goalColumn=f[h]}),findWordAt:function(a){var b=E(this.doc,
a.line).text,c=a.ch,d=a.ch;if(b){var f=this.getHelper(a,"wordChars");(0>a.xRel||d==b.length)&&c?--c:++d;for(var g=b.charAt(c),g=Lc(g,f)?function(a){return Lc(a,f)}:/\s/.test(g)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!Lc(a)};0<c&&g(b.charAt(c-1));)--c;for(;d<b.length&&g(b.charAt(d));)++d}return new S(z(a.line,c),z(a.line,d))},toggleOverwrite:function(a){if(null==a||a!=this.state.overwrite)(this.state.overwrite=!this.state.overwrite)?Jb(this.display.cursorDiv,"CodeMirror-overwrite"):
Hb(this.display.cursorDiv,"CodeMirror-overwrite"),Z(this,"overwriteToggle",this,this.state.overwrite)},hasFocus:function(){return this.display.input.getField()==Ba()},scrollTo:ea(function(a,b){null==a&&null==b||Jc(this);null!=a&&(this.curOp.scrollLeft=a);null!=b&&(this.curOp.scrollTop=b)}),getScrollInfo:function(){var a=this.display.scroller;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-za(this)-this.display.barHeight,width:a.scrollWidth-za(this)-this.display.barWidth,clientHeight:Yc(this),
clientWidth:La(this)}},scrollIntoView:ea(function(a,b){null==a?(a={from:this.doc.sel.primary().head,to:null},null==b&&(b=this.options.cursorScrollMargin)):"number"==typeof a?a={from:z(a,0),to:null}:null==a.from&&(a={from:a,to:null});a.to||(a.to=a.from);a.margin=b||0;if(null!=a.from.line)Jc(this),this.curOp.scrollToPos=a;else{var c=zc(this,Math.min(a.from.left,a.to.left),Math.min(a.from.top,a.to.top)-a.margin,Math.max(a.from.right,a.to.right),Math.max(a.from.bottom,a.to.bottom)+a.margin);this.scrollTo(c.scrollLeft,
c.scrollTop)}}),setSize:ea(function(a,b){function c(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a}var d=this;null!=a&&(d.display.wrapper.style.width=c(a));null!=b&&(d.display.wrapper.style.height=c(b));d.options.lineWrapping&&le(this);var f=d.display.viewFrom;d.doc.iter(f,d.display.viewTo,function(a){if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(a.widgets[b].noHScroll){Ja(d,f,"widget");break}++f});d.curOp.forceUpdate=!0;Z(d,"refresh",this)}),operation:function(a){return ma(this,
a)},refresh:ea(function(){var a=this.display.cachedTextHeight;la(this);this.curOp.forceUpdate=!0;Gb(this);this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop);q(this);(null==a||.5<Math.abs(a-Ta(this.display)))&&g(this);Z(this,"refresh",this)}),swapDoc:ea(function(a){var b=this.doc;b.cm=null;Id(this,a);Gb(this);this.display.input.reset();this.scrollTo(a.scrollLeft,a.scrollTop);this.curOp.forceScroll=!0;ga(this,"swapDoc",this,b);return b}),getInputField:function(){return this.display.input.getField()},
getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};xb(c);var pf=c.defaults={},gb=c.optionHandlers={},Jd=c.Init={toString:function(){return"CodeMirror.Init"}};G("value","",function(a,b){a.setValue(b)},!0);G("mode",null,function(a,c){a.doc.modeOption=c;b(a)},!0);G("indentUnit",2,b,!0);G("indentWithTabs",!1);G("smartIndent",!0);G("tabSize",4,function(a){d(a);Gb(a);la(a)},!0);G("lineSeparator",
null,function(a,b){if(a.doc.lineSep=b){var c=[],d=a.doc.first;a.doc.iter(function(a){for(var f=0;;){var g=a.text.indexOf(b,f);if(-1==g)break;f=g+b.length;c.push(z(d,g))}d++});for(var f=c.length-1;0<=f;f--)tb(a.doc,b,c[f],z(c[f].line,c[f].ch+b.length))}});G("specialChars",/[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g,function(a,b,d){a.state.specialChars=new RegExp(b.source+(b.test("\t")?"":"|\t"),"g");d!=c.Init&&a.refresh()});G("specialCharPlaceholder",function(a){var b=D("span","\u2022",
"cm-invalidchar");b.title="\\u"+a.charCodeAt(0).toString(16);b.setAttribute("aria-label",b.title);return b},function(a){a.refresh()},!0);G("electricChars",!0);G("inputStyle",Ab?"contenteditable":"textarea",function(){throw Error("inputStyle can not (yet) be changed in a running editor");},!0);G("rtlMoveVisually",!jg);G("wholeLineUpdateBefore",!0);G("theme","default",function(a){h(a);m(a)},!0);G("keyMap","default",function(a,b,d){b=Mc(b);(d=d!=c.Init&&Mc(d))&&d.detach&&d.detach(a,b);b.attach&&b.attach(a,
d||null)});G("extraKeys",null);G("lineWrapping",!1,function(a){a.options.lineWrapping?(Jb(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth="",a.display.sizerWidth=null):(Hb(a.display.wrapper,"CodeMirror-wrap"),w(a));g(a);la(a);Gb(a);setTimeout(function(){B(a)},100)},!0);G("gutters",[],function(a){t(a.options);m(a)},!0);G("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?A(a.display)+"px":"0";a.refresh()},!0);G("coverGutterNextToScrollbar",!1,function(a){B(a)},!0);G("scrollbarStyle",
"native",function(a){v(a);B(a);a.display.scrollbars.setScrollTop(a.doc.scrollTop);a.display.scrollbars.setScrollLeft(a.doc.scrollLeft)},!0);G("lineNumbers",!1,function(a){t(a.options);m(a)},!0);G("firstLineNumber",1,m,!0);G("lineNumberFormatter",function(a){return a},m,!0);G("showCursorWhenSelecting",!1,Lb,!0);G("resetSelectionOnContextMenu",!0);G("lineWiseCopyCut",!0);G("readOnly",!1,function(a,b){"nocursor"==b?(Db(a),a.display.input.blur(),a.display.disabled=!0):(a.display.disabled=!1,b||a.display.input.reset())});
G("disableInput",!1,function(a,b){b||a.display.input.reset()},!0);G("dragDrop",!0,function(a,b,d){!b!=!(d&&d!=c.Init)&&(d=a.display.dragFunctions,b=b?F:Ga,b(a.display.scroller,"dragstart",d.start),b(a.display.scroller,"dragenter",d.simple),b(a.display.scroller,"dragover",d.simple),b(a.display.scroller,"drop",d.drop))});G("cursorBlinkRate",530);G("cursorScrollMargin",0);G("cursorHeight",1,Lb,!0);G("singleCursorHeightPerLine",!0,Lb,!0);G("workTime",100);G("workDelay",100);G("flattenSpans",!0,d,!0);
G("addModeClass",!1,d,!0);G("pollInterval",100);G("undoDepth",200,function(a,b){a.doc.history.undoDepth=b});G("historyEventDelay",1250);G("viewportMargin",10,function(a){a.refresh()},!0);G("maxHighlightLength",1E4,d,!0);G("moveInputWithCursor",!0,function(a,b){b||a.display.input.resetPosition()});G("tabindex",null,function(a,b){a.display.input.getField().tabIndex=b||""});G("autofocus",null);var of=c.modes={},cc=c.mimeModes={};c.defineMode=function(a,b){c.defaults.mode||"null"==a||(c.defaults.mode=
a);2<arguments.length&&(b.dependencies=Array.prototype.slice.call(arguments,2));of[a]=b};c.defineMIME=function(a,b){cc[a]=b};c.resolveMode=function(a){if("string"==typeof a&&cc.hasOwnProperty(a))a=cc[a];else if(a&&"string"==typeof a.name&&cc.hasOwnProperty(a.name)){var b=cc[a.name];"string"==typeof b&&(b={name:b});a=ef(b,a);a.name=b.name}else if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a))return c.resolveMode("application/xml");return"string"==typeof a?{name:a}:a||{name:"null"}};c.getMode=
function(a,b){b=c.resolveMode(b);var d=of[b.name];if(!d)return c.getMode(a,"text/plain");d=d(a,b);if(dc.hasOwnProperty(b.name)){var f=dc[b.name],g;for(g in f)f.hasOwnProperty(g)&&(d.hasOwnProperty(g)&&(d["_"+g]=d[g]),d[g]=f[g])}d.name=b.name;b.helperType&&(d.helperType=b.helperType);if(b.modeProps)for(g in b.modeProps)d[g]=b.modeProps[g];return d};c.defineMode("null",function(){return{token:function(a){a.skipToEnd()}}});c.defineMIME("text/plain","null");var dc=c.modeExtensions={};c.extendMode=function(a,
b){var c=dc.hasOwnProperty(a)?dc[a]:dc[a]={};ra(b,c)};c.defineExtension=function(a,b){c.prototype[a]=b};c.defineDocExtension=function(a,b){ka.prototype[a]=b};c.defineOption=G;var Uc=[];c.defineInitHook=function(a){Uc.push(a)};var zb=c.helpers={};c.registerHelper=function(a,b,d){zb.hasOwnProperty(a)||(zb[a]=c[a]={_global:[]});zb[a][b]=d};c.registerGlobalHelper=function(a,b,d,f){c.registerHelper(a,b,f);zb[a]._global.push({pred:d,val:f})};var qb=c.copyState=function(a,b){if(!0===b)return b;if(a.copyState)return a.copyState(b);
var c={},d;for(d in b){var f=b[d];f instanceof Array&&(f=f.concat([]));c[d]=f}return c},Af=c.startState=function(a,b,c){return a.startState?a.startState(b,c):!0};c.innerMode=function(a,b){for(;a.innerMode;){var c=a.innerMode(b);if(!c||c.mode==a)break;b=c.state;a=c.mode}return c||{mode:a,state:b}};var Fc=c.commands={selectAll:function(a){a.setSelection(z(a.firstLine(),0),z(a.lastLine()),Da)},singleSelection:function(a){a.setSelection(a.getCursor("anchor"),a.getCursor("head"),Da)},killLine:function(a){ub(a,
function(b){if(b.empty()){var c=E(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?{from:b.head,to:z(b.head.line+1,0)}:{from:b.head,to:z(b.head.line,c)}}return{from:b.from(),to:b.to()}})},deleteLine:function(a){ub(a,function(b){return{from:z(b.from().line,0),to:H(a.doc,z(b.to().line+1,0))}})},delLineLeft:function(a){ub(a,function(a){return{from:z(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){ub(a,function(b){var c=a.charCoords(b.head,"div").top+5;return{from:a.coordsChar({left:0,
top:c},"div"),to:b.from()}})},delWrappedLineRight:function(a){ub(a,function(b){var c=a.charCoords(b.head,"div").top+5,c=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div");return{from:b.from(),to:c}})},undo:function(a){a.undo()},redo:function(a){a.redo()},undoSelection:function(a){a.undoSelection()},redoSelection:function(a){a.redoSelection()},goDocStart:function(a){a.extendSelection(z(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(z(a.lastLine()))},goLineStart:function(a){a.extendSelectionsBy(function(b){return jf(a,
b.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(a){a.extendSelectionsBy(function(b){return kf(a,b.head)},{origin:"+move",bias:1})},goLineEnd:function(a){a.extendSelectionsBy(function(b){b=b.head.line;for(var c,d=E(a.doc,b);c=Wa(d,!1);)d=c.find(1,!0).line,b=null;c=(c=ua(d))?c[0].level%2?xc(d):yc(d):d.text.length;return z(null==b?Q(d):b,c)},{origin:"+move",bias:-1})},goLineRight:function(a){a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+
100,top:b},"div")},bc)},goLineLeft:function(a){a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:0,top:b},"div")},bc)},goLineLeftSmart:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5,c=a.coordsChar({left:0,top:c},"div");return c.ch<a.getLine(c.line).search(/\S/)?kf(a,b.head):c},bc)},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,
"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,"char")},goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,"word")},goGroupRight:function(a){a.moveH(1,"group")},goGroupLeft:function(a){a.moveH(-1,"group")},goWordRight:function(a){a.moveH(1,"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},
delWordAfter:function(a){a.deleteH(1,"word")},delGroupBefore:function(a){a.deleteH(-1,"group")},delGroupAfter:function(a){a.deleteH(1,"group")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("\t")},insertSoftTab:function(a){for(var b=[],c=a.listSelections(),d=a.options.tabSize,f=0;f<c.length;f++){var g=c[f].from(),g=wa(a.getLine(g.line),g.ch,d);b.push(Array(d-
g%d+1).join(" "))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){ma(a,function(){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++){var f=b[d].head,g=E(a.doc,f.line).text;if(g)if(f.ch==g.length&&(f=new z(f.line,f.ch-1)),0<f.ch)f=new z(f.line,f.ch+1),a.replaceRange(g.charAt(f.ch-1)+g.charAt(f.ch-2),z(f.line,f.ch-2),f,"+transpose");else if(f.line>a.doc.first){var h=E(a.doc,f.line-1).text;h&&a.replaceRange(g.charAt(0)+
a.doc.lineSeparator()+h.charAt(h.length-1),z(f.line-1,h.length-1),z(f.line,1),"+transpose")}c.push(new S(f,f))}a.setSelections(c)})},newlineAndIndent:function(a){ma(a,function(){for(var b=a.listSelections().length,c=0;c<b;c++){var d=a.listSelections()[c];a.replaceRange(a.doc.lineSeparator(),d.anchor,d.head,"+input");a.indentLine(d.from().line+1,null,!0);nb(a)}})},toggleOverwrite:function(a){a.toggleOverwrite()}},Qa=c.keyMap={};Qa.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",
End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"};Qa.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft",
"Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"};Qa.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown",
"Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"};Qa.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft",
"Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",
fallthrough:["basic","emacsy"]};Qa["default"]=ta?Qa.macDefault:Qa.pcDefault;c.normalizeKeyMap=function(a){var b={},c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!/^(name|fallthrough|(de|at)tach)$/.test(c)){if("..."!=d)for(var f=nc(c.split(" "),Tf),g=0;g<f.length;g++){var h,m;g==f.length-1?(m=f.join(" "),h=d):(m=f.slice(0,g+1).join(" "),h="...");var n=b[m];if(!n)b[m]=h;else if(n!=h)throw Error("Inconsistent bindings for "+m);}delete a[c]}}for(var r in b)a[r]=b[r];return a};var Tb=c.lookupKey=
function(a,b,c,d){b=Mc(b);var f=b.call?b.call(a,d):b[a];if(!1===f)return"nothing";if("..."===f)return"multi";if(null!=f&&c(f))return"handled";if(b.fallthrough){if("[object Array]"!=Object.prototype.toString.call(b.fallthrough))return Tb(a,b.fallthrough,c,d);for(f=0;f<b.fallthrough.length;f++){var g=Tb(a,b.fallthrough[f],c,d);if(g)return g}}},Mf=c.isModifierKey=function(a){a="string"==typeof a?a:Ra[a.keyCode];return"Ctrl"==a||"Alt"==a||"Shift"==a||"Mod"==a},Of=c.keyName=function(a,b){if(xa&&34==a.keyCode&&
a["char"])return!1;var c=Ra[a.keyCode],d=c;if(null==d||a.altGraphKey)return!1;a.altKey&&"Alt"!=c&&(d="Alt-"+d);(nf?a.metaKey:a.ctrlKey)&&"Ctrl"!=c&&(d="Ctrl-"+d);(nf?a.ctrlKey:a.metaKey)&&"Cmd"!=c&&(d="Cmd-"+d);!b&&a.shiftKey&&"Shift"!=c&&(d="Shift-"+d);return d};c.fromTextArea=function(a,b){function d(){a.value=r.getValue()}b=b?ra(b):{};b.value=a.value;!b.tabindex&&a.tabIndex&&(b.tabindex=a.tabIndex);!b.placeholder&&a.placeholder&&(b.placeholder=a.placeholder);if(null==b.autofocus){var f=Ba();b.autofocus=
f==a||null!=a.getAttribute("autofocus")&&f==document.body}if(a.form&&(F(a.form,"submit",d),!b.leaveSubmitMethodAlone)){var g=a.form,h=g.submit;try{var m=g.submit=function(){d();g.submit=h;g.submit();g.submit=m}}catch(n){}}b.finishInit=function(b){b.save=d;b.getTextArea=function(){return a};b.toTextArea=function(){b.toTextArea=isNaN;d();a.parentNode.removeChild(b.getWrapperElement());a.style.display="";a.form&&(Ga(a.form,"submit",d),"function"==typeof a.form.submit&&(a.form.submit=h))}};a.style.display=
"none";var r=c(function(b){a.parentNode.insertBefore(b,a.nextSibling)},b);return r};var Qc=c.StringStream=function(a,b){this.pos=this.start=0;this.string=a;this.tabSize=b||8;this.lineStart=this.lastColumnPos=this.lastColumnValue=0};Qc.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(a){var b=
this.string.charAt(this.pos);if("string"==typeof a?b==a:b&&(a.test?a.test(b):a(b)))return++this.pos,b},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){a=this.string.indexOf(a,this.pos);if(-1<a)return this.pos=a,!0},backUp:function(a){this.pos-=a},column:function(){this.lastColumnPos<this.start&&
(this.lastColumnValue=wa(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start);return this.lastColumnValue-(this.lineStart?wa(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return wa(this.string,null,this.tabSize)-(this.lineStart?wa(this.string,this.lineStart,this.tabSize):0)},match:function(a,b,c){if("string"==typeof a){var d=function(a){return c?a.toLowerCase():a},f=this.string.substr(this.pos,a.length);if(d(f)==d(a))return!1!==
b&&(this.pos+=a.length),!0}else{if((a=this.string.slice(this.pos).match(a))&&0<a.index)return null;a&&!1!==b&&(this.pos+=a[0].length);return a}},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}}};var zd=0,db=c.TextMarker=function(a,b){this.lines=[];this.type=b;this.doc=a;this.id=++zd};xb(db);db.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;b&&fb(a);if(pa(this,
"clear")){var c=this.find();c&&ga(this,"clear",c.from,c.to)}for(var d=c=null,f=0;f<this.lines.length;++f){var g=this.lines[f],h=Vb(g.markedSpans,this);a&&!this.collapsed?Ja(a,Q(g),"text"):a&&(null!=h.to&&(d=Q(g)),null!=h.from&&(c=Q(g)));for(var m=g,n=g.markedSpans,r=h,q=void 0,s=0;s<n.length;++s)n[s]!=r&&(q||(q=[])).push(n[s]);m.markedSpans=q;null==h.from&&this.collapsed&&!Ua(this.doc,g)&&a&&ya(g,Ta(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(f=0;f<this.lines.length;++f)g=Ea(this.lines[f]),
h=u(g),h>a.display.maxLineLength&&(a.display.maxLine=g,a.display.maxLineLength=h,a.display.maxLineChanged=!0);null!=c&&a&&this.collapsed&&la(a,c,d+1);this.lines.length=0;this.explicitlyCleared=!0;this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&fe(a.doc));a&&ga(a,"markerCleared",a,this);b&&hb(a);this.parent&&this.parent.clear()}};db.prototype.find=function(a,b){null==a&&"bookmark"==this.type&&(a=1);for(var c,d,f=0;f<this.lines.length;++f){var g=this.lines[f],h=Vb(g.markedSpans,this);if(null!=
h.from&&(c=z(b?g:Q(g),h.from),-1==a))return c;if(null!=h.to&&(d=z(b?g:Q(g),h.to),1==a))return d}return c&&{from:c,to:d}};db.prototype.changed=function(){var a=this.find(-1,!0),b=this,c=this.doc.cm;a&&c&&ma(c,function(){var d=a.line,f=Q(a.line);if(f=bd(c,f))ke(f),c.curOp.selectionChanged=c.curOp.forceUpdate=!0;c.curOp.updateMaxLine=!0;Ua(b.doc,d)||null==b.height||(f=b.height,b.height=null,(f=Rb(b)-f)&&ya(d,d.height+f))})};db.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=
this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=fa(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)};db.prototype.detachLine=function(a){this.lines.splice(fa(this.lines,a),1);!this.lines.length&&this.doc.cm&&(a=this.doc.cm.curOp,(a.maybeHiddenMarkers||(a.maybeHiddenMarkers=[])).push(this))};var zd=0,Oc=c.SharedTextMarker=function(a,b){this.markers=a;this.primary=b;for(var c=0;c<a.length;++c)a[c].parent=this};xb(Oc);Oc.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=
!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();ga(this,"clear")}};Oc.prototype.find=function(a,b){return this.primary.find(a,b)};var Pc=c.LineWidget=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.doc=a;this.node=b};xb(Pc);Pc.prototype.clear=function(){var a=this.doc.cm,b=this.line.widgets,c=this.line,d=Q(c);if(null!=d&&b){for(var f=0;f<b.length;++f)b[f]==this&&b.splice(f--,1);b.length||(c.widgets=null);var g=Rb(this);ya(c,Math.max(0,c.height-g));a&&
ma(a,function(){var b=-g;Aa(c)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&Ic(a,null,b);Ja(a,d,"widget")})}};Pc.prototype.changed=function(){var a=this.height,b=this.doc.cm,c=this.line;this.height=null;var d=Rb(this)-a;d&&(ya(c,c.height+d),b&&ma(b,function(){b.curOp.forceUpdate=!0;Aa(c)<(b.curOp&&b.curOp.scrollTop||b.doc.scrollTop)&&Ic(b,null,d)}))};var Wb=c.Line=function(a,b,c){this.text=a;Te(this,b);this.height=c?c(this):1};xb(Wb);Wb.prototype.lineNo=function(){return Q(this)};var Zf={},Yf={};
Xb.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,d=a+b;c<d;++c){var f=this.lines[c];this.height-=f.height;var g=f;g.parent=null;Se(g);ga(f,"delete")}this.lines.splice(a,b)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,b,c){this.height+=c;this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));for(a=0;a<b.length;++a)b[a].parent=this},iterN:function(a,b,c){for(b=a+b;a<b;++a)if(c(this.lines[a]))return!0}};Yb.prototype=
{chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var d=this.children[c],f=d.chunkSize();if(a<f){var g=Math.min(b,f-a),h=d.height;d.removeInner(a,g);this.height-=h-d.height;f==g&&(this.children.splice(c--,1),d.parent=null);if(0==(b-=g))break;a=0}else a-=f}25>this.size-b&&(1<this.children.length||!(this.children[0]instanceof Xb))&&(c=[],this.collapse(c),this.children=[new Xb(c)],this.children[0].parent=this)},collapse:function(a){for(var b=
0;b<this.children.length;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length;this.height+=c;for(var d=0;d<this.children.length;++d){var f=this.children[d],g=f.chunkSize();if(a<=g){f.insertInner(a,b,c);if(f.lines&&50<f.lines.length){for(;50<f.lines.length;)a=f.lines.splice(f.lines.length-25,25),a=new Xb(a),f.height-=a.height,this.children.splice(d+1,0,a),a.parent=this;this.maybeSpill()}break}a-=g}},maybeSpill:function(){if(!(10>=this.children.length)){var a=this;do{var b=
a.children.splice(a.children.length-5,5),b=new Yb(b);if(a.parent){a.size-=b.size;a.height-=b.height;var c=fa(a.parent.children,a);a.parent.children.splice(c+1,0,b)}else c=new Yb(a.children),c.parent=a,a.children=[c,b],a=c;b.parent=a.parent}while(10<a.children.length);a.parent.maybeSpill()}},iterN:function(a,b,c){for(var d=0;d<this.children.length;++d){var f=this.children[d],g=f.chunkSize();if(a<g){g=Math.min(b,g-a);if(f.iterN(a,g,c))return!0;if(0==(b-=g))break;a=0}else a-=g}}};var lg=0,ka=c.Doc=function(a,
b,c,d){if(!(this instanceof ka))return new ka(a,b,c,d);null==c&&(c=0);Yb.call(this,[new Xb([new Wb("",null)])]);this.first=c;this.scrollTop=this.scrollLeft=0;this.cantEdit=!1;this.cleanGeneration=1;this.frontier=c;c=z(c,0);this.sel=Ca(c);this.history=new Rc(null);this.id=++lg;this.modeOption=b;this.lineSep=d;"string"==typeof a&&(a=this.splitLines(a));xd(this,{from:c,to:c,text:a});ba(this,Ca(c),Da)};ka.prototype=ef(Yb.prototype,{constructor:ka,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):
this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,d=0;d<b.length;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=Ed(this,this.first,this.first+this.size);return!1===a?b:b.join(a||this.lineSeparator())},setValue:ha(function(a){var b=z(this.first,0),c=this.first+this.size-1;mb(this,{from:b,to:z(c,E(this,c).text.length),text:this.splitLines(a),origin:"setValue",full:!0},!0);ba(this,
Ca(b))}),replaceRange:function(a,b,c,d){b=H(this,b);c=c?H(this,c):b;tb(this,a,b,c,d)},getRange:function(a,b,c){a=Za(this,H(this,a),H(this,b));return!1===c?a:a.join(c||this.lineSeparator())},getLine:function(a){return(a=this.getLineHandle(a))&&a.text},getLineHandle:function(a){if(Nb(this,a))return E(this,a)},getLineNumber:function(a){return Q(a)},getLineHandleVisualStart:function(a){"number"==typeof a&&(a=E(this,a));return Ea(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},
lastLine:function(){return this.first+this.size-1},clipPos:function(a){return H(this,a)},getCursor:function(a){var b=this.sel.primary();return null==a||"head"==a?b.head:"anchor"==a?b.anchor:"end"==a||"to"==a||!1===a?b.to():b.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:ha(function(a,b,c){a=H(this,"number"==typeof a?z(a,b||0):a);ba(this,Ca(a,null),c)}),setSelection:ha(function(a,b,c){var d=H(this,a);a=H(this,b||
a);ba(this,Ca(d,a),c)}),extendSelection:ha(function(a,b,c){qc(this,H(this,a),b&&H(this,b),c)}),extendSelections:ha(function(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=H(this,a[d]);$d(this,c)}),extendSelectionsBy:ha(function(a,b){$d(this,nc(this.sel.ranges,a),b)}),setSelections:ha(function(a,b,c){if(a.length){for(var d=0,f=[];d<a.length;d++)f[d]=new S(H(this,a[d].anchor),H(this,a[d].head));null==b&&(b=Math.min(a.length-1,this.sel.primIndex));ba(this,va(f,b),c)}}),addSelection:ha(function(a,b,c){var d=
this.sel.ranges.slice(0);d.push(new S(H(this,a),H(this,b||a)));ba(this,va(d,d.length-1),c)}),getSelection:function(a){for(var b=this.sel.ranges,c,d=0;d<b.length;d++){var f=Za(this,b[d].from(),b[d].to());c=c?c.concat(f):f}return!1===a?c:c.join(a||this.lineSeparator())},getSelections:function(a){for(var b=[],c=this.sel.ranges,d=0;d<c.length;d++){var f=Za(this,c[d].from(),c[d].to());!1!==a&&(f=f.join(a||this.lineSeparator()));b[d]=f}return b},replaceSelection:function(a,b,c){for(var d=[],f=0;f<this.sel.ranges.length;f++)d[f]=
a;this.replaceSelections(d,b,c||"+input")},replaceSelections:ha(function(a,b,c){for(var d=[],f=this.sel,g=0;g<f.ranges.length;g++){var h=f.ranges[g];d[g]={from:h.from(),to:h.to(),text:this.splitLines(a[g]),origin:c}}if(g=b&&"end"!=b){g=[];c=a=z(this.first,0);for(f=0;f<d.length;f++){var m=d[f],h=De(m.from,a,c),n=De(bb(m),a,c);a=m.to;c=n;"around"==b?(m=this.sel.ranges[f],m=0>I(m.head,m.anchor),g[f]=new S(m?n:h,m?h:n)):g[f]=new S(h,h)}g=new Ha(g,this.sel.primIndex)}b=g;for(g=d.length-1;0<=g;g--)mb(this,
d[g]);b?ae(this,b):this.cm&&nb(this.cm)}),undo:ha(function(){Hc(this,"undo")}),redo:ha(function(){Hc(this,"redo")}),undoSelection:ha(function(){Hc(this,"undo",!0)}),redoSelection:ha(function(){Hc(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,b=0,c=0,d=0;d<a.done.length;d++)a.done[d].ranges||++b;for(d=0;d<a.undone.length;d++)a.undone[d].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=
new Rc(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null);return this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:wb(this.history.done),undone:wb(this.history.undone)}},setHistory:function(a){var b=this.history=new Rc(this.history.maxGeneration);b.done=wb(a.done.slice(0),
null,!0);b.undone=wb(a.undone.slice(0),null,!0)},addLineClass:ha(function(a,b,c){return Kc(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass";if(a[d]){if(ac(c).test(a[d]))return!1;a[d]+=" "+c}else a[d]=c;return!0})}),removeLineClass:ha(function(a,b,c){return Kc(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass",f=a[d];if(f)if(null==
c)a[d]=null;else{var g=f.match(ac(c));if(!g)return!1;var h=g.index+g[0].length;a[d]=f.slice(0,g.index)+(g.index&&h!=f.length?" ":"")+f.slice(h)||null}else return!1;return!0})}),addLineWidget:ha(function(a,b,c){return Xf(this,a,b,c)}),removeLineWidget:function(a){a.clear()},markText:function(a,b,c){return vb(this,H(this,a),H(this,b),c,"range")},setBookmark:function(a,b){var c={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared,handleMouseEvents:b&&
b.handleMouseEvents};a=H(this,a);return vb(this,a,a,c,"bookmark")},findMarksAt:function(a){a=H(this,a);var b=[],c=E(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var f=c[d];(null==f.from||f.from<=a.ch)&&(null==f.to||f.to>=a.ch)&&b.push(f.marker.parent||f.marker)}return b},findMarks:function(a,b,c){a=H(this,a);b=H(this,b);var d=[],f=a.line;this.iter(a.line,b.line+1,function(g){if(g=g.markedSpans)for(var h=0;h<g.length;h++){var m=g[h];f==a.line&&a.ch>m.to||null==m.from&&f!=a.line||f==b.line&&
m.from>b.ch||c&&!c(m.marker)||d.push(m.marker.parent||m.marker)}++f});return d},getAllMarks:function(){var a=[];this.iter(function(b){if(b=b.markedSpans)for(var c=0;c<b.length;++c)null!=b[c].from&&a.push(b[c].marker)});return a},posFromIndex:function(a){var b,c=this.first;this.iter(function(d){d=d.text.length+1;if(d>a)return b=a,!0;a-=d;++c});return H(this,z(c,b))},indexFromPos:function(a){a=H(this,a);var b=a.ch;if(a.line<this.first||0>a.ch)return 0;this.iter(this.first,a.line,function(a){b+=a.text.length+
1});return b},copy:function(a){var b=new ka(Ed(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep);b.scrollTop=this.scrollTop;b.scrollLeft=this.scrollLeft;b.sel=this.sel;b.extend=!1;a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory()));return b},linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from);null!=a.to&&a.to<c&&(c=a.to);b=new ka(Ed(this,b,c),a.mode||this.modeOption,b,this.lineSep);a.sharedHist&&
(b.history=this.history);(this.linked||(this.linked=[])).push({doc:b,sharedHist:a.sharedHist});b.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}];a=Qe(this);for(c=0;c<a.length;c++){var d=a[c],f=d.find(),g=b.clipPos(f.from),f=b.clipPos(f.to);I(g,f)&&(g=vb(b,g,f,d.primary,d.primary.type),d.markers.push(g),g.parent=d)}return b},unlinkDoc:function(a){a instanceof c&&(a=a.doc);if(this.linked)for(var b=0;b<this.linked.length;++b)if(this.linked[b].doc==a){this.linked.splice(b,1);a.unlinkDoc(this);
Vf(Qe(this));break}if(a.history==this.history){var d=[a.id];cb(a,function(a){d.push(a.id)},!0);a.history=new Rc(null);a.history.done=wb(this.history.done,d);a.history.undone=wb(this.history.undone,d)}},iterLinkedDocs:function(a){cb(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(a){return this.lineSep?a.split(this.lineSep):mg(a)},lineSeparator:function(){return this.lineSep||"\n"}});ka.prototype.eachLine=ka.prototype.iter;var ng="iter insert remove copy getEditor constructor".split(" "),
ec;for(ec in ka.prototype)ka.prototype.hasOwnProperty(ec)&&0>fa(ng,ec)&&(c.prototype[ec]=function(a){return function(){return a.apply(this.doc,arguments)}}(ka.prototype[ec]));xb(ka);var ia=c.e_preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},og=c.e_stopPropagation=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},qd=c.e_stop=function(a){ia(a);og(a)},F=c.on=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+
b,c):(a=a._handlers||(a._handlers={}),(a[b]||(a[b]=[])).push(c))},Ga=c.off=function(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else if(a=a._handlers&&a._handlers[b])for(b=0;b<a.length;++b)if(a[b]==c){a.splice(b,1);break}},Z=c.signal=function(a,b){var c=a._handlers&&a._handlers[b];if(c)for(var d=Array.prototype.slice.call(arguments,2),f=0;f<c.length;++f)c[f].apply(null,d)},Zb=null,Kd=30,ze=c.Pass={toString:function(){return"CodeMirror.Pass"}},
Da={scroll:!1},rd={origin:"*mouse"},bc={origin:"+move"};Bb.prototype.set=function(a,b){clearTimeout(this.id);this.id=setTimeout(b,a)};var wa=c.countColumn=function(a,b,c,d,f){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));d=d||0;for(f=f||0;;){var g=a.indexOf("\t",d);if(0>g||g>=b)return f+(b-d);f+=g-d;f+=c-f%c;d=g+1}},Sc=[""],yb=function(a){a.select()};ob?yb=function(a){a.selectionStart=0;a.selectionEnd=a.value.length}:O&&(yb=function(a){try{a.select()}catch(b){}});var pg=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,
ff=c.isWordChar=function(a){return/\w/.test(a)||"\u0080"<a&&(a.toUpperCase()!=a.toLowerCase()||pg.test(a))},fg=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,
$a;$a=document.createRange?function(a,b,c,d){var f=document.createRange();f.setEnd(d||a,c);f.setStart(a,b);return f}:function(a,b,c){var d=document.body.createTextRange();try{d.moveToElementText(a.parentNode)}catch(f){return d}d.collapse(!0);d.moveEnd("character",c);d.moveStart("character",b);return d};var cd=c.contains=function(a,b){3==b.nodeType&&(b=b.parentNode);if(a.contains)return a.contains(b);do if(11==b.nodeType&&(b=b.host),b==a)return!0;while(b=b.parentNode)};O&&11>V&&(Ba=function(){try{return document.activeElement}catch(a){return document.body}});
var Hb=c.rmClass=function(a,b){var c=a.className,d=ac(b).exec(c);if(d){var f=c.slice(d.index+d[0].length);a.className=c.slice(0,d.index)+(f?d[1]+f:"")}},Jb=c.addClass=function(a,b){var c=a.className;ac(b).test(c)||(a.className+=(c?" ":"")+b)},Hd=!1,If=function(){if(O&&9>V)return!1;var a=D("div");return"draggable"in a||"dragDrop"in a}(),Fd,Cd,mg=c.splitLines=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;b<=d;){var f=a.indexOf("\n",b);-1==f&&(f=a.length);var g=a.slice(b,"\r"==
a.charAt(f-1)?f-1:f),h=g.indexOf("\r");-1!=h?(c.push(g.slice(0,h)),b+=h+1):(c.push(g),b=f+1)}return c}:function(a){return a.split(/\r\n?|\n/)},kg=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(b){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(c){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},Be=function(){var a=D("div");if("oncopy"in a)return!0;a.setAttribute("oncopy","return;");return"function"==typeof a.oncopy}(),
id=null,Ra={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",
63276:"PageUp",63277:"PageDown",63302:"Insert"};c.keyNames=Ra;(function(){for(var a=0;10>a;a++)Ra[a+48]=Ra[a+96]=String(a);for(a=65;90>=a;a++)Ra[a]=String.fromCharCode(a);for(a=1;12>=a;a++)Ra[a+111]=Ra[a+63235]="F"+a})();var Sb,dg=function(){function a(b){return 247>=b?c.charAt(b):1424<=b&&1524>=b?"R":1536<=b&&1773>=b?d.charAt(b-1536):1774<=b&&2220>=b?"r":8192<=b&&8203>=b?"w":8204==b?"b":"L"}function b(a,c,d){this.level=a;this.from=c;this.to=d}var c="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",
d="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm",f=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,g=/[stwN]/,h=/[LRr]/,m=/[Lb1n]/,n=/[1n]/;return function(c){if(!f.test(c))return!1;for(var d=c.length,r=[],q=0,s;q<d;++q)r.push(a(c.charCodeAt(q)));for(var q=0,v="L";q<d;++q)s=r[q],"m"==s?r[q]=v:v=s;q=0;for(v="L";q<
d;++q)s=r[q],"1"==s&&"r"==v?r[q]="n":h.test(s)&&(v=s,"r"==s&&(r[q]="R"));q=1;for(v=r[0];q<d-1;++q)s=r[q],"+"==s&&"1"==v&&"1"==r[q+1]?r[q]="1":","!=s||v!=r[q+1]||"1"!=v&&"n"!=v||(r[q]=v),v=s;for(q=0;q<d;++q)if(s=r[q],","==s)r[q]="N";else if("%"==s){for(v=q+1;v<d&&"%"==r[v];++v);var u=q&&"!"==r[q-1]||v<d&&"1"==r[v]?"1":"N";for(s=q;s<v;++s)r[s]=u;q=v-1}q=0;for(v="L";q<d;++q)s=r[q],"L"==v&&"1"==s?r[q]="L":h.test(s)&&(v=s);for(q=0;q<d;++q)if(g.test(r[q])){for(v=q+1;v<d&&g.test(r[v]);++v);s="L"==(v<d?r[v]:
"L");u="L"==(q?r[q-1]:"L")||s?"L":"R";for(s=q;s<v;++s)r[s]=u;q=v-1}for(var v=[],t,q=0;q<d;)if(m.test(r[q])){s=q;for(++q;q<d&&m.test(r[q]);++q);v.push(new b(0,s,q))}else{var w=q,u=v.length;for(++q;q<d&&"L"!=r[q];++q);for(s=w;s<q;)if(n.test(r[s])){w<s&&v.splice(u,0,new b(1,w,s));w=s;for(++s;s<q&&n.test(r[s]);++s);v.splice(u,0,new b(2,w,s));w=s}else++s;w<q&&v.splice(u,0,new b(1,w,q))}1==v[0].level&&(t=c.match(/^\s+/))&&(v[0].from=t[0].length,v.unshift(new b(0,0,t[0].length)));1==P(v).level&&(t=c.match(/\s+$/))&&
(P(v).to-=t[0].length,v.push(new b(0,d-t[0].length,d)));2==v[0].level&&v.unshift(new b(1,v[0].to,v[0].to));v[0].level!=P(v).level&&v.push(new b(v[0].level,d,d));return v}}();c.version="5.5.1";return c}();(function(c){c(CodeMirror)})(function(c){var a=/^(\s*)(>[> ]*|[*+-]\s|(\d+)([.)]))(\s*)/,b=/^(\s*)(>[> ]*|[*+-]|(\d+)[.)])(\s*)$/,d=/[*+-]\s/;c.commands.newlineAndIndentContinueMarkdownList=function(f){if(f.getOption("disableInput"))return c.Pass;for(var g=f.listSelections(),h=[],m=0;m<g.length;m++){var n=g[m].head,q=f.getStateAfter(n.line),u=!1!==q.list,w=0!==q.quote,t=f.getLine(n.line),q=a.exec(t);if(!g[m].empty()||!u&&!w||!q){f.execCommand("newlineAndIndent");return}b.test(t)?(f.replaceRange("",
{line:n.line,ch:0},{line:n.line,ch:n.ch+1}),h[m]="\n"):(n=q[1],u=q[5],q=d.test(q[2])||0<=q[2].indexOf(">")?q[2]:parseInt(q[3],10)+1+q[4],h[m]="\n"+n+q+u)}f.replaceSelections(h)}});(function(c){c(CodeMirror)})(function(c){c.defineMode("xml",function(a,b){function d(a,b){function c(d){b.tokenize=d;return d(a,b)}var d=a.next();if("<"==d){if(a.eat("!"))return a.eat("[")?a.match("CDATA[")?c(h("atom","]]\x3e")):null:a.match("--")?c(h("comment","--\x3e")):a.match("DOCTYPE",!0,!0)?(a.eatWhile(/[\w\._\-]/),c(m(1))):null;if(a.eat("?"))return a.eatWhile(/[\w\._\-]/),b.tokenize=h("meta","?>"),"meta";da=a.eat("/")?"closeTag":"openTag";b.tokenize=f;return"tag bracket"}if("&"==d)return(a.eat("#")?
a.eat("x")?a.eatWhile(/[a-fA-F\d]/)&&a.eat(";"):a.eatWhile(/[\d]/)&&a.eat(";"):a.eatWhile(/[\w\.\-:]/)&&a.eat(";"))?"atom":"error";a.eatWhile(/[^&<]/);return null}function f(a,b){var c=a.next();if(">"==c||"/"==c&&a.eat(">"))return b.tokenize=d,da=">"==c?"endTag":"selfcloseTag","tag bracket";if("="==c)return da="equals",null;if("<"==c)return b.tokenize=d,b.state=w,b.tagName=b.tagStart=null,(c=b.tokenize(a,b))?c+" tag error":"tag error";if(/[\'\"]/.test(c))return b.tokenize=g(c),b.stringStartCol=a.column(),
b.tokenize(a,b);a.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/);return"word"}function g(a){var b=function(b,c){for(;!b.eol();)if(b.next()==a){c.tokenize=f;break}return"string"};b.isInAttribute=!0;return b}function h(a,b){return function(c,f){for(;!c.eol();){if(c.match(b)){f.tokenize=d;break}c.next()}return a}}function m(a){return function(b,c){for(var f;null!=(f=b.next());){if("<"==f)return c.tokenize=m(a+1),c.tokenize(b,c);if(">"==f)if(1==a){c.tokenize=d;break}else return c.tokenize=m(a-1),c.tokenize(b,
c)}return"meta"}}function n(a,b,c){this.prev=a.context;this.tagName=b;this.indent=a.indented;this.startOfLine=c;if(A.doNotIndent.hasOwnProperty(b)||a.context&&a.context.noIndent)this.noIndent=!0}function q(a){a.context&&(a.context=a.context.prev)}function u(a,b){for(var c;a.context;){c=a.context.tagName;if(!A.contextGrabbers.hasOwnProperty(c)||!A.contextGrabbers[c].hasOwnProperty(b))break;q(a)}}function w(a,b,c){return"openTag"==a?(c.tagStart=b.column(),t):"closeTag"==a?x:w}function t(a,b,c){if("word"==
a)return c.tagName=b.current(),W="tag",v;W="error";return t}function x(a,b,c){if("word"==a){a=b.current();c.context&&c.context.tagName!=a&&A.implicitlyClosed.hasOwnProperty(c.context.tagName)&&q(c);if(c.context&&c.context.tagName==a)return W="tag",r;W="tag error";return s}W="error";return s}function r(a,b,c){if("endTag"!=a)return W="error",r;q(c);return w}function s(a,b,c){W="error";return r(a,b,c)}function v(a,b,c){if("word"==a)return W="attribute",B;if("endTag"==a||"selfcloseTag"==a){b=c.tagName;
var d=c.tagStart;c.tagName=c.tagStart=null;"selfcloseTag"==a||A.autoSelfClosers.hasOwnProperty(b)?u(c,b):(u(c,b),c.context=new n(c,b,d==c.indented));return w}W="error";return v}function B(a,b,c){if("equals"==a)return K;A.allowMissing||(W="error");return v(a,b,c)}function K(a,b,c){if("string"==a)return J;if("word"==a&&A.allowUnquoted)return W="string",v;W="error";return v(a,b,c)}function J(a,b,c){return"string"==a?J:v(a,b,c)}var L=a.indentUnit,C=b.multilineTagIndentFactor||1,R=b.multilineTagIndentPastTag;
null==R&&(R=!0);var A=b.htmlMode?{autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,
footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0}:{autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,caseFold:!1},T=b.alignCDATA,da,W;d.isInText=
!0;return{startState:function(){return{tokenize:d,state:w,indented:0,tagName:null,tagStart:null,context:null}},token:function(a,b){!b.tagName&&a.sol()&&(b.indented=a.indentation());if(a.eatSpace())return null;da=null;var c=b.tokenize(a,b);(c||da)&&"comment"!=c&&(W=null,b.state=b.state(da||c,a,b),W&&(c="error"==W?c+" error":W));return c},indent:function(a,b,g){var h=a.context;if(a.tokenize.isInAttribute)return a.tagStart==a.indented?a.stringStartCol+1:a.indented+L;if(h&&h.noIndent)return c.Pass;if(a.tokenize!=
f&&a.tokenize!=d)return g?g.match(/^(\s*)/)[0].length:0;if(a.tagName)return R?a.tagStart+a.tagName.length+2:a.tagStart+L*C;if(T&&/<!\[CDATA\[/.test(b))return 0;if((a=b&&/^<(\/)?([\w_:\.-]*)/.exec(b))&&a[1])for(;h;)if(h.tagName==a[2]){h=h.prev;break}else if(A.implicitlyClosed.hasOwnProperty(h.tagName))h=h.prev;else break;else if(a)for(;h;)if((b=A.contextGrabbers[h.tagName])&&b.hasOwnProperty(a[2]))h=h.prev;else break;for(;h&&!h.startOfLine;)h=h.prev;return h?h.indent+L:0},electricInput:/<\/[\s\w:]+>$/,
blockCommentStart:"\x3c!--",blockCommentEnd:"--\x3e",configuration:b.htmlMode?"html":"xml",helperType:b.htmlMode?"html":"xml"}});c.defineMIME("text/xml","xml");c.defineMIME("application/xml","xml");c.mimeModes.hasOwnProperty("text/html")||c.defineMIME("text/html",{name:"xml",htmlMode:!0})});(function(c){c(CodeMirror)})(function(c){c.defineMode("markdown",function(a,b){function d(a,b,c){b.f=b.inline=c;return c(a,b)}function f(a){return!a||!/\S/.test(a.string)}function g(a){a.linkTitle=!1;a.em=!1;a.strong=!1;a.strikethrough=!1;a.quote=0;a.indentedCode=!1;L||a.f!=m||(a.f=t,a.block=h);a.trailingSpace=0;a.trailingSpaceNewLine=!1;a.prevLine=a.thisLine;return a.thisLine=null}function h(g,h){var m=g.sol(),q=!1!==h.list,r=h.indentedCode;h.indentedCode=!1;q&&(0<=h.indentationDiff?(4>h.indentationDiff&&
(h.indentation-=h.indentationDiff),h.list=null):0<h.indentation?(h.list=null,h.listDepth=Math.floor(h.indentation/4)):(h.list=!1,h.listDepth=0));var s=null;if(4<=h.indentationDiff)return g.skipToEnd(),r||f(h.prevLine)?(h.indentation-=4,h.indentedCode=!0,A.code):null;if(g.eatSpace())return null;if((s=g.match(jb))&&6>=s[1].length)return h.header=s[1].length,b.highlightFormatting&&(h.formatting="header"),h.f=h.inline,u(h);if(f(h.prevLine)||h.quote||q||r||!(s=g.match(hc))){if(g.eat(">"))return h.quote=
m?1:h.quote+1,b.highlightFormatting&&(h.formatting="quote"),g.eatSpace(),u(h);if("["===g.peek())return d(g,h,v);if(g.match(da,!0))return h.hr=!0,A.hr;if((f(h.prevLine)||q)&&(g.match(W,!1)||g.match(U,!1)))return m=null,g.match(W,!0)?m="ul":(g.match(U,!0),m="ol"),h.indentation=g.column()+g.current().length,h.list=!0,h.listDepth++,b.taskLists&&g.match(kb,!1)&&(h.taskList=!0),h.f=h.inline,b.highlightFormatting&&(h.formatting=["list","list-"+m]),u(h);if(b.fencedCodeBlocks&&(s=g.match(Xc,!0)))return h.fencedChars=
s[1],m=s[2],c.findModeByName&&(q=c.findModeByName(m))&&(m=q.mime||q.mimes[0]),m=c.getMode(a,m),h.localMode="null"==m.name?null:m,h.localMode&&(h.localState=h.localMode.startState()),h.f=h.block=n,b.highlightFormatting&&(h.formatting="code-block"),h.code=!0,u(h)}else return h.header="="==s[0].charAt(0)?1:2,b.highlightFormatting&&(h.formatting="header"),h.f=h.inline,u(h);return d(g,h,h.inline)}function m(a,b){var c=C.token(a,b.htmlState);if(L&&null===b.htmlState.tagStart&&!b.htmlState.context&&b.htmlState.tokenize.isInText||
b.md_inside&&-1<a.current().indexOf(">"))b.f=t,b.block=h,b.htmlState=null;return c}function n(a,b){if(a.sol()&&b.fencedChars&&a.match(b.fencedChars,!1))return b.localMode=b.localState=null,b.f=b.block=q,null;if(b.localMode)return b.localMode.token(a,b.localState);a.skipToEnd();return A.code}function q(a,c){a.match(c.fencedChars);c.block=h;c.f=t;c.fencedChars=null;b.highlightFormatting&&(c.formatting="code-block");c.code=!0;var d=u(c);c.code=!1;return d}function u(a){var c=[];if(a.formatting){c.push(A.formatting);
"string"===typeof a.formatting&&(a.formatting=[a.formatting]);for(var d=0;d<a.formatting.length;d++)c.push(A.formatting+"-"+a.formatting[d]),"header"===a.formatting[d]&&c.push(A.formatting+"-"+a.formatting[d]+"-"+a.header),"quote"===a.formatting[d]&&(!b.maxBlockquoteDepth||b.maxBlockquoteDepth>=a.quote?c.push(A.formatting+"-"+a.formatting[d]+"-"+a.quote):c.push("error"))}if(a.taskOpen)return c.push("meta"),c.length?c.join(" "):null;if(a.taskClosed)return c.push("property"),c.length?c.join(" "):null;
a.linkHref?c.push(A.linkHref,"url"):(a.strong&&c.push(A.strong),a.em&&c.push(A.em),a.strikethrough&&c.push(A.strikethrough),a.linkText&&c.push(A.linkText),a.code&&c.push(A.code));a.header&&c.push(A.header,A.header+"-"+a.header);a.quote&&(c.push(A.quote),!b.maxBlockquoteDepth||b.maxBlockquoteDepth>=a.quote?c.push(A.quote+"-"+a.quote):c.push(A.quote+"-"+b.maxBlockquoteDepth));!1!==a.list&&((d=(a.listDepth-1)%3)?1===d?c.push(A.list2):c.push(A.list3):c.push(A.list1));a.trailingSpaceNewLine?c.push("trailing-space-new-line"):
a.trailingSpace&&c.push("trailing-space-"+(a.trailingSpace%2?"a":"b"));return c.length?c.join(" "):null}function w(a,b){if(a.match(Kb,!0))return u(b)}function t(a,d){var f=d.text(a,d);if("undefined"!==typeof f)return f;if(d.list)return d.list=null,u(d);if(d.taskList)return"x"!==a.match(kb,!0)[1]?d.taskOpen=!0:d.taskClosed=!0,b.highlightFormatting&&(d.formatting="task"),d.taskList=!1,u(d);d.taskOpen=!1;d.taskClosed=!1;if(d.header&&a.match(/^#+$/,!0))return b.highlightFormatting&&(d.formatting="header"),
u(d);var f=a.sol(),g=a.next();if("\\"===g&&(a.next(),b.highlightFormatting))return f=u(d),g=A.formatting+"-escape",f?f+" "+g:g;if(d.linkTitle){d.linkTitle=!1;var h=g;"("===g&&(h=")");h=(h+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");if(a.match(new RegExp("^\\s*(?:[^"+h+"\\\\]+|\\\\\\\\|\\\\.)"+h),!0))return A.linkHref}if("`"===g){f=d.formatting;b.highlightFormatting&&(d.formatting="code");g=u(d);h=a.pos;a.eatWhile("`");h=1+a.pos-h;if(d.code){if(h===R)return d.code=!1,g;d.formatting=f}else R=h,d.code=
!0;return u(d)}if(d.code)return u(d);if("!"===g&&a.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return a.match(/\[[^\]]*\]/),d.inline=d.f=r,A.image;if("["===g&&a.match(/.*\](\(.*\)| ?\[.*\])/,!1))return d.linkText=!0,b.highlightFormatting&&(d.formatting="link"),u(d);if("]"===g&&d.linkText&&a.match(/\(.*\)| ?\[.*\]/,!1))return b.highlightFormatting&&(d.formatting="link"),f=u(d),d.linkText=!1,d.inline=d.f=r,f;if("<"===g&&a.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return d.f=d.inline=x,b.highlightFormatting&&
(d.formatting="link"),f=u(d),(f?f+" ":"")+A.linkInline;if("<"===g&&a.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return d.f=d.inline=x,b.highlightFormatting&&(d.formatting="link"),f=(f=u(d))?f+" ":"",f+A.linkEmail;if("<"===g&&a.match(/^(!--|\w)/,!1))return f=a.string.indexOf(">",a.pos),-1!=f&&(f=a.string.substring(a.start,f),/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(f)&&(d.md_inside=!0)),a.backUp(1),d.htmlState=c.startState(C),f=m,d.f=d.block=f,f(a,d);if("<"===g&&a.match(/^\/\w*?>/))return d.md_inside=
!1,"tag";h=!1;if(!b.underscoresBreakWords&&"_"===g&&"_"!==a.peek()&&a.match(/(\w)/,!1)){var n=a.pos-2;0<=n&&(n=a.string.charAt(n),"_"!==n&&n.match(/(\w)/,!1)&&(h=!0))}if("*"===g||"_"===g&&!h){if(!f||" "!==a.peek()){if(d.strong===g&&a.eat(g))return b.highlightFormatting&&(d.formatting="strong"),g=u(d),d.strong=!1,g;if(!d.strong&&a.eat(g))return d.strong=g,b.highlightFormatting&&(d.formatting="strong"),u(d);if(d.em===g)return b.highlightFormatting&&(d.formatting="em"),g=u(d),d.em=!1,g;if(!d.em)return d.em=
g,b.highlightFormatting&&(d.formatting="em"),u(d)}}else if(" "===g&&(a.eat("*")||a.eat("_"))){if(" "===a.peek())return u(d);a.backUp(1)}if(b.strikethrough)if("~"===g&&a.eatWhile(g)){if(d.strikethrough)return b.highlightFormatting&&(d.formatting="strikethrough"),g=u(d),d.strikethrough=!1,g;if(a.match(/^[^\s]/,!1))return d.strikethrough=!0,b.highlightFormatting&&(d.formatting="strikethrough"),u(d)}else if(" "===g&&a.match(/^~~/,!0)){if(" "===a.peek())return u(d);a.backUp(2)}" "===g&&(a.match(/ +$/,
!1)?d.trailingSpace++:d.trailingSpace&&(d.trailingSpaceNewLine=!0));return u(d)}function x(a,c){if(">"===a.next()){c.f=c.inline=t;b.highlightFormatting&&(c.formatting="link");var d=u(c);return(d?d+" ":"")+A.linkInline}a.match(/^[^>]+/,!0);return A.linkInline}function r(a,c){if(a.eatSpace())return null;var d=a.next();return"("===d||"["===d?(c.f=c.inline=s("("===d?")":"]"),b.highlightFormatting&&(c.formatting="link-string"),c.linkHref=!0,u(c)):"error"}function s(a){return function(c,d){if(c.next()===
a){d.f=d.inline=t;b.highlightFormatting&&(d.formatting="link-string");var f=u(d);d.linkHref=!1;return f}c.match(J(a),!0)&&c.backUp(1);d.linkHref=!0;return u(d)}}function v(a,c){return a.match(/^[^\]]*\]:/,!1)?(c.f=B,a.next(),b.highlightFormatting&&(c.formatting="link"),c.linkText=!0,u(c)):d(a,c,t)}function B(a,c){if(a.match(/^\]:/,!0)){c.f=c.inline=K;b.highlightFormatting&&(c.formatting="link");var d=u(c);c.linkText=!1;return d}a.match(/^[^\]]+/,!0);return A.linkText}function K(a,b){if(a.eatSpace())return null;
a.match(/^[^\s]+/,!0);void 0===a.peek()?b.linkTitle=!0:a.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0);b.f=b.inline=t;return A.linkHref+" url"}function J(a){lb[a]||(a=(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),lb[a]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+a+")"));return lb[a]}var L=c.modes.hasOwnProperty("xml"),C=c.getMode(a,L?{name:"xml",htmlMode:!0}:"text/plain");void 0===b.highlightFormatting&&(b.highlightFormatting=!1);void 0===b.maxBlockquoteDepth&&
(b.maxBlockquoteDepth=0);void 0===b.underscoresBreakWords&&(b.underscoresBreakWords=!0);void 0===b.taskLists&&(b.taskLists=!1);void 0===b.strikethrough&&(b.strikethrough=!1);void 0===b.tokenTypeOverrides&&(b.tokenTypeOverrides={});var R=0,A={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"tag",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"},
T;for(T in A)A.hasOwnProperty(T)&&b.tokenTypeOverrides[T]&&(A[T]=b.tokenTypeOverrides[T]);var da=/^([*\-_])(?:\s*\1){2,}\s*$/,W=/^[*\-+]\s+/,U=/^[0-9]+([.)])\s+/,kb=/^\[(x| )\](?=\s)/,jb=b.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,hc=/^ *(?:\={1,}|-{1,})\s*$/,Kb=/^[^#!\[\]*_\\<>` "'(~]+/,Xc=new RegExp("^("+(!0===b.fencedCodeBlocks?"~~~+|```+":b.fencedCodeBlocks)+")[ \\t]*([\\w+#]*)"),lb=[],Pa={startState:function(){return{f:h,prevLine:null,thisLine:null,block:h,htmlState:null,indentation:0,
inline:t,text:w,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,hr:!1,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,fencedChars:null}},copyState:function(a){return{f:a.f,prevLine:a.prevLine,thisLine:a["this"],block:a.block,htmlState:a.htmlState&&c.copyState(C,a.htmlState),indentation:a.indentation,localMode:a.localMode,localState:a.localMode?c.copyState(a.localMode,a.localState):null,inline:a.inline,text:a.text,formatting:!1,
linkTitle:a.linkTitle,code:a.code,em:a.em,strong:a.strong,strikethrough:a.strikethrough,header:a.header,hr:a.hr,taskList:a.taskList,list:a.list,listDepth:a.listDepth,quote:a.quote,indentedCode:a.indentedCode,trailingSpace:a.trailingSpace,trailingSpaceNewLine:a.trailingSpaceNewLine,md_inside:a.md_inside,fencedChars:a.fencedChars}},token:function(a,b){b.formatting=!1;if(a!=b.thisLine){var c=b.header||b.hr;b.header=0;b.hr=!1;if(a.match(/^\s*$/,!0)||c){g(b);if(!c)return null;b.prevLine=null}b.prevLine=
b.thisLine;b.thisLine=a;b.taskList=!1;b.trailingSpace=0;b.trailingSpaceNewLine=!1;b.f=b.block;var c=a.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,d=4*Math.floor((c-b.indentation)/4);4<d&&(d=4);d=b.indentation+d;b.indentationDiff=d-b.indentation;b.indentation=d;if(0<c)return null}return b.f(a,b)},innerMode:function(a){return a.block==m?{state:a.htmlState,mode:C}:a.localState?{state:a.localState,mode:a.localMode}:{state:a,mode:Pa}},blankLine:g,getType:u,fold:"markdown"};return Pa},"xml");c.defineMIME("text/x-markdown",
"markdown")});Server=function(c){function a(a,c){this.document=a;this.operations=c||[]}a.prototype.receiveOperation=function(a,c){console.log("Operations "+this.operations.length+" Revision "+a);if(0>a||this.operations.length<a)return console.log("operation revision "+a+" not in history"),!1;for(var f=this.operations.slice(a),g=c.constructor.transform,h=0;h<f.length;h++)c=g(c,f[h])[0];this.document=c.apply(this.document);this.operations.push(c);return c};return a}(this);
"object"===typeof module&&(module.exports=ot.Server);(function(c){var a={makeEventEmitter:function(a,c){a.prototype.allowedEvents_=c;a.prototype.on=function(a,b,c){this.validateEventType_(a);this.eventListeners_=this.eventListeners_||{};this.eventListeners_[a]=this.eventListeners_[a]||[];this.eventListeners_[a].push({callback:b,context:c})};a.prototype.off=function(a,b){this.validateEventType_(a);this.eventListeners_=this.eventListeners_||{};for(var c=this.eventListeners_[a]||[],d=0;d<c.length;d++)if(c[d].callback===b){c.splice(d,1);break}};a.prototype.trigger=
function(a){this.eventListeners_=this.eventListeners_||{};for(var b=this.eventListeners_[a]||[],c=0;c<b.length;c++)b[c].callback.apply(b[c].context,Array.prototype.slice.call(arguments,1))};a.prototype.validateEventType_=function(a){if(this.allowedEvents_){for(var b=!1,c=0;c<this.allowedEvents_.length;c++)if(this.allowedEvents_[c]===a){b=!0;break}if(!b)throw Error('Unknown event "'+a+'"');}}},elt:function(b,c,f){b=document.createElement(b);if("string"===typeof c)a.setTextContent(b,c);else if(c)for(var g=
0;g<c.length;++g)b.appendChild(c[g]);for(var h in f||{})b.setAttribute(h,f[h]);return b},setTextContent:function(a,c){a.innerHTML="";a.appendChild(document.createTextNode(c))},on:function(a,c,f,g){a.addEventListener?a.addEventListener(c,f,g||!1):a.attachEvent&&a.attachEvent("on"+c,f)},off:function(a,c,f,g){a.removeEventListener?a.removeEventListener(c,f,g||!1):a.detachEvent&&a.detachEvent("on"+c,f)},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(a){a.stopPropagation?
a.stopPropagation():a.cancelBubble=!0},stopEvent:function(b){a.preventDefault(b);a.stopPropagation(b)},stopEventAnd:function(b){return function(c){b(c);a.stopEvent(c);return!1}},trim:function(a){return a.replace(/^\s+/g,"").replace(/\s+$/g,"")},stringEndsWith:function(a,c){for(var f="string"==typeof c?[c]:c,g=0;g<f.length;g++)if(c=f[g],-1!==a.indexOf(c,a.length-c.length))return!0;return!1},assert:function(a,c){if(!a)throw Error(c||"assertion error");},log:function(){if("undefined"!==typeof console&&
"undefined"!==typeof console.log){for(var a=["Vceditor:"],c=0;c<arguments.length;c++)a.push(arguments[c]);console.log.apply(console,a)}}};c.utils=a})(window);(function(c){var a=function(a){function d(a){this.imageInsertionUI=a;this.element_=this.makeElement_()}var f=c.utils;f.makeEventEmitter(d,"bold italic underline strike font font-size color left center right unordered-list ordered-list todo-list indent-increase indent-decrease undo redo insert-image".split(" "));d.prototype.element=function(){return this.element_};d.prototype.makeButton_=function(a,b){var c=this,d=f.elt("a",[f.elt("span","",{"class":"vceditor-tb-"+(b||a)})],{"class":"vceditor-btn"});
f.on(d,"click",f.stopEventAnd(function(){c.trigger(a)}));return d};d.prototype.makeElement_=function(){var a=this.makeFontDropdown_(),b=this.makeFontSizeDropdown_(),c=this.makeColorDropdown_(),a=[f.elt("div",[a],{"class":"vceditor-btn-group"}),f.elt("div",[b],{"class":"vceditor-btn-group"}),f.elt("div",[c],{"class":"vceditor-btn-group"}),f.elt("div",[this.makeButton_("bold"),this.makeButton_("italic"),this.makeButton_("underline"),this.makeButton_("strike","strikethrough")],{"class":"vceditor-btn-group"}),
f.elt("div",[this.makeButton_("unordered-list","list-2"),this.makeButton_("ordered-list","numbered-list"),this.makeButton_("todo-list","list")],{"class":"vceditor-btn-group"}),f.elt("div",[this.makeButton_("indent-decrease"),this.makeButton_("indent-increase")],{"class":"vceditor-btn-group"}),f.elt("div",[this.makeButton_("left","paragraph-left"),this.makeButton_("center","paragraph-center"),this.makeButton_("right","paragraph-right")],{"class":"vceditor-btn-group"}),f.elt("div",[this.makeButton_("undo"),
this.makeButton_("redo")],{"class":"vceditor-btn-group"})];this.imageInsertionUI&&a.push(f.elt("div",[this.makeButton_("insert-image")],{"class":"vceditor-btn-group"}));a=f.elt("div",a,{"class":"vceditor-toolbar-wrapper"});b=f.elt("div",null,{"class":"vceditor-toolbar"});b.appendChild(a);return b};d.prototype.makeFontDropdown_=function(){for(var a="Arial;Comic Sans MS;Courier New;Impact;Times New Roman;Verdana".split(";"),b=[],c=0;c<a.length;c++){var d=f.elt("span",a[c]);d.setAttribute("style","font-family:"+
a[c]);b.push({content:d,value:a[c]})}return this.makeDropdown_("Font","font",b)};d.prototype.makeFontSizeDropdown_=function(){for(var a=[9,10,12,14,18,24,32,42],b=[],c=0;c<a.length;c++){var d=f.elt("span",a[c].toString());d.setAttribute("style","font-size:"+a[c]+"px; line-height:"+(a[c]-6)+"px;");b.push({content:d,value:a[c]})}return this.makeDropdown_("Size","font-size",b,"px")};d.prototype.makeColorDropdown_=function(){for(var a="black red green blue yellow cyan magenta grey".split(" "),b=[],c=
0;c<a.length;c++){var d=f.elt("div");d.className="vceditor-color-dropdown-item";d.setAttribute("style","background-color:"+a[c]);b.push({content:d,value:a[c]})}return this.makeDropdown_("Color","color",b)};d.prototype.makeDropdown_=function(a,b,c,d){function q(){x&&(t.style.display="",f.off(document,"click",q,!0),x=!1);r=!0;setTimeout(function(){r=!1},0)}function u(a,c){"object"!==typeof a&&(a=document.createTextNode(String(a)));var g=f.elt("a",[a]);f.on(g,"click",f.stopEventAnd(function(){q();w.trigger(b,
c+d)}));t.appendChild(g)}d=d||"";var w=this;a=f.elt("a",a+" \u25be",{"class":"vceditor-btn vceditor-dropdown"});var t=f.elt("ul",[],{"class":"vceditor-dropdown-menu"});a.appendChild(t);for(var x=!1,r=!1,s=0;s<c.length;s++)u(c[s].content,c[s].value);f.on(a,"click",f.stopEventAnd(function(){r||x||(t.style.display="block",f.on(document,"click",q,!0),x=!0)}));return a};return d}();c.RichTextToolbar=a})(window);(function(c){var a=function(){function a(b,c,h){this.type=b;this.attributes=this.text=this.chars=null;"insert"===b?(this.text=c,d.assert("string"===typeof this.text),this.attributes=h||{},d.assert("object"===typeof this.attributes)):"delete"===b?(this.chars=c,d.assert("number"===typeof this.chars)):"retain"===b&&(this.chars=c,d.assert("number"===typeof this.chars),this.attributes=h||{},d.assert("object"===typeof this.attributes))}var d=c.utils;a.prototype.isInsert=function(){return"insert"===this.type};
a.prototype.isDelete=function(){return"delete"===this.type};a.prototype.isRetain=function(){return"retain"===this.type};a.prototype.equals=function(a){return this.type===a.type&&this.text===a.text&&this.chars===a.chars&&this.attributesEqual(a.attributes)};a.prototype.attributesEqual=function(a){for(var b in this.attributes)if(this.attributes[b]!==a[b])return!1;for(b in a)if(this.attributes[b]!==a[b])return!1;return!0};a.prototype.hasEmptyAttributes=function(){var a=!0,b;for(b in this.attributes){a=
!1;break}return a};return a}();c.TextOp=a})(window);(function(c){TextOperation=function(){function a(){if(!this||this.constructor!==a)return new a;this.ops=[];this.targetLength=this.baseLength=0}function b(a){a=a.ops;switch(a.length){case 1:return a[0];case 2:return a[0].isRetain()?a[1]:a[1].isRetain()?a[0]:null;case 3:if(a[0].isRetain()&&a[2].isRetain())return a[1]}return null}function d(a){return a.ops[0].isRetain()?a.ops[0].chars:0}var f=c.TextOp,g=c.utils;a.prototype.equals=function(a){if(this.baseLength!==a.baseLength||this.targetLength!==a.targetLength||
this.ops.length!==a.ops.length)return!1;for(var b=0;b<this.ops.length;b++)if(!this.ops[b].equals(a.ops[b]))return!1;return!0};a.prototype.retain=function(a,b){if("number"!==typeof a||0>a)throw Error("retain expects a positive integer.");if(0===a)return this;this.baseLength+=a;this.targetLength+=a;b=b||{};var c=0<this.ops.length?this.ops[this.ops.length-1]:null;c&&c.isRetain()&&c.attributesEqual(b)?c.chars+=a:this.ops.push(new f("retain",a,b));return this};a.prototype.insert=function(a,b){if("string"!==
typeof a)throw Error("insert expects a string");if(""===a)return this;b=b||{};this.targetLength+=a.length;var c=0<this.ops.length?this.ops[this.ops.length-1]:null,d=1<this.ops.length?this.ops[this.ops.length-2]:null;c&&c.isInsert()&&c.attributesEqual(b)?c.text+=a:c&&c.isDelete()?d&&d.isInsert()&&d.attributesEqual(b)?d.text+=a:(this.ops[this.ops.length-1]=new f("insert",a,b),this.ops.push(c)):this.ops.push(new f("insert",a,b));return this};a.prototype["delete"]=function(a){"string"===typeof a&&(a=
a.length);if("number"!==typeof a||0>a)throw Error("delete expects a positive integer or a string");if(0===a)return this;this.baseLength+=a;var b=0<this.ops.length?this.ops[this.ops.length-1]:null;b&&b.isDelete()?b.chars+=a:this.ops.push(new f("delete",a));return this};a.prototype.isNoop=function(){return 0===this.ops.length||1===this.ops.length&&this.ops[0].isRetain()&&this.ops[0].hasEmptyAttributes()};a.prototype.clone=function(){for(var b=new a,c=0;c<this.ops.length;c++)if(this.ops[c].isRetain())b.retain(this.ops[c].chars,
this.ops[c].attributes);else if(this.ops[c].isInsert())b.insert(this.ops[c].text,this.ops[c].attributes);else b["delete"](this.ops[c].chars);return b};a.prototype.toString=function(){return(Array.prototype.map||function(a){for(var b=[],c=0,d=this.length;c<d;c++)b[c]=a(this[c]);return b}).call(this.ops,function(a){return a.isRetain()?"retain "+a.chars:a.isInsert()?"insert '"+a.text+"'":"delete "+a.chars}).join(", ")};a.prototype.toJSON=function(){for(var a=[],b=0;b<this.ops.length;b++)this.ops[b].hasEmptyAttributes()||
a.push(this.ops[b].attributes),"retain"===this.ops[b].type?a.push(this.ops[b].chars):"insert"===this.ops[b].type?a.push(this.ops[b].text):"delete"===this.ops[b].type&&a.push(-this.ops[b].chars);0===a.length&&a.push(0);return a};a.fromJSON=function(b){for(var c=new a,d=0,f=b.length;d<f;d++){var u=b[d],w={};"object"===typeof u&&(w=u,d++,u=b[d]);if("number"===typeof u)if(0<u)c.retain(u,w);else c["delete"](-u);else g.assert("string"===typeof u),c.insert(u,w)}return c};a.prototype.apply=function(a,b,c){b=
b||[];c=c||[];if(a.length!==this.baseLength)throw Error("The operation's base length must be equal to the string's length.");for(var d=[],f=0,w,t,x=0,r=this.ops,s=0,v=r.length;s<v;s++){var B=r[s];if(B.isRetain()){if(x+B.chars>a.length)throw Error("Operation can't retain more characters than are left in the string.");d[f++]=a.slice(x,x+B.chars);for(w=0;w<B.chars;w++){var K=b[x+w]||{},J={};for(t in K)J[t]=K[t],g.assert(!1!==J[t]);for(t in B.attributes)!1===B.attributes[t]?delete J[t]:J[t]=B.attributes[t],
g.assert(!1!==J[t]);c.push(J)}x+=B.chars}else if(B.isInsert())for(d[f++]=B.text,w=0;w<B.text.length;w++){K={};for(t in B.attributes)K[t]=B.attributes[t],g.assert(!1!==K[t]);c.push(K)}else x+=B.chars}if(x!==a.length)throw Error("The operation didn't operate on the whole string.");a=d.join("");g.assert(a.length===c.length);return a};a.prototype.invert=function(b){for(var c=0,d=new a,f=this.ops,g=0,w=f.length;g<w;g++){var t=f[g];if(t.isRetain())d.retain(t.chars),c+=t.chars;else if(t.isInsert())d["delete"](t.text.length);
else d.insert(b.slice(c,c+t.chars)),c+=t.chars}return d};a.prototype.compose=function(b){function c(a,b,d){var f={},g;for(g in a)f[g]=a[g];for(g in b)d&&!1===b[g]?delete f[g]:f[g]=b[g];return f}if(this.targetLength!==b.baseLength)throw Error("The base length of the second operation has to be the target length of the first operation");var d=new a,f=this.clone().ops;b=b.clone().ops;for(var g=0,w=0,t=f[g++],x=b[w++],r;"undefined"!==typeof t||"undefined"!==typeof x;)if(t&&t.isDelete())d["delete"](t.chars),
t=f[g++];else if(x&&x.isInsert())d.insert(x.text,x.attributes),x=b[w++];else{if("undefined"===typeof t)throw Error("Cannot compose operations: first operation is too short.");if("undefined"===typeof x)throw Error("Cannot compose operations: first operation is too long.");if(t.isRetain()&&x.isRetain())r=c(t.attributes,x.attributes),t.chars>x.chars?(d.retain(x.chars,r),t.chars-=x.chars,x=b[w++]):t.chars===x.chars?(d.retain(t.chars,r),t=f[g++],x=b[w++]):(d.retain(t.chars,r),x.chars-=t.chars,t=f[g++]);
else if(t.isInsert()&&x.isDelete())t.text.length>x.chars?(t.text=t.text.slice(x.chars),x=b[w++]):t.text.length===x.chars?(t=f[g++],x=b[w++]):(x.chars-=t.text.length,t=f[g++]);else if(t.isInsert()&&x.isRetain())r=c(t.attributes,x.attributes,!0),t.text.length>x.chars?(d.insert(t.text.slice(0,x.chars),r),t.text=t.text.slice(x.chars),x=b[w++]):t.text.length===x.chars?(d.insert(t.text,r),t=f[g++],x=b[w++]):(d.insert(t.text,r),x.chars-=t.text.length,t=f[g++]);else if(t.isRetain()&&x.isDelete())t.chars>
x.chars?(d["delete"](x.chars),t.chars-=x.chars,x=b[w++]):t.chars===x.chars?(d["delete"](x.chars),t=f[g++],x=b[w++]):(d["delete"](t.chars),x.chars-=t.chars,t=f[g++]);else throw Error("This shouldn't happen: op1: "+JSON.stringify(t)+", op2: "+JSON.stringify(x));}return d};a.prototype.shouldBeComposedWith=function(a){if(this.isNoop()||a.isNoop())return!0;var c=d(this),f=d(a),g=b(this);a=b(a);return g&&a?g.isInsert()&&a.isInsert()?c+g.text.length===f:g.isDelete()&&a.isDelete()?f+a.chars===c||c===f:!1:
!1};a.prototype.shouldBeComposedWithInverted=function(a){if(this.isNoop()||a.isNoop())return!0;var c=d(this),f=d(a),g=b(this);a=b(a);return g&&a?g.isInsert()&&a.isInsert()?c+g.text.length===f||c===f:g.isDelete()&&a.isDelete()?f+a.chars===c:!1:!1};a.transformAttributes=function(a,b){var c={},d={},f,w={};for(f in a)w[f]=!0;for(f in b)w[f]=!0;for(f in w){var w=a[f],t=b[f];g.assert(null!=w||null!=t);null==w?d[f]=t:null==t?c[f]=w:w!==t&&(c[f]=w)}return[c,d]};a.transform=function(b,c){if(b.baseLength!==
c.baseLength)throw Error("Both operations have to have the same base length");for(var d=new a,f=new a,g=b.clone().ops,w=c.clone().ops,t=0,x=0,r=g[t++],s=w[x++];"undefined"!==typeof r||"undefined"!==typeof s;)if(r&&r.isInsert())d.insert(r.text,r.attributes),f.retain(r.text.length),r=g[t++];else if(s&&s.isInsert())d.retain(s.text.length),f.insert(s.text,s.attributes),s=w[x++];else{if("undefined"===typeof r)throw Error("Cannot transform operations: first operation is too short.");if("undefined"===typeof s)throw Error("Cannot transform operations: first operation is too long.");
var v;if(r.isRetain()&&s.isRetain()){var B=a.transformAttributes(r.attributes,s.attributes);r.chars>s.chars?(v=s.chars,r.chars-=s.chars,s=w[x++]):r.chars===s.chars?(v=s.chars,r=g[t++],s=w[x++]):(v=r.chars,s.chars-=r.chars,r=g[t++]);d.retain(v,B[0]);f.retain(v,B[1])}else if(r.isDelete()&&s.isDelete())r.chars>s.chars?(r.chars-=s.chars,s=w[x++]):r.chars===s.chars?(r=g[t++],s=w[x++]):(s.chars-=r.chars,r=g[t++]);else if(r.isDelete()&&s.isRetain())r.chars>s.chars?(v=s.chars,r.chars-=s.chars,s=w[x++]):r.chars===
s.chars?(v=s.chars,r=g[t++],s=w[x++]):(v=r.chars,s.chars-=r.chars,r=g[t++]),d["delete"](v);else if(r.isRetain()&&s.isDelete())r.chars>s.chars?(v=s.chars,r.chars-=s.chars,s=w[x++]):r.chars===s.chars?(v=r.chars,r=g[t++],s=w[x++]):(v=r.chars,s.chars-=r.chars,r=g[t++]),f["delete"](v);else throw Error("The two operations aren't compatible");}return[d,f]};return a}();c.TextOperation=TextOperation})(window);(function(c){var a=function(a){function c(a,b){this.wrapped=a;this.meta=b}function f(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])}function g(a,b){return a&&"object"===typeof a&&"function"===typeof a.transform?a.transform(b):a}c.prototype.apply=function(){return this.wrapped.apply.apply(this.wrapped,arguments)};c.prototype.invert=function(){var a=this.meta;return new c(this.wrapped.invert.apply(this.wrapped,arguments),a&&"object"===typeof a&&"function"===typeof a.invert?a.invert.apply(a,arguments):
a)};c.prototype.compose=function(a){var b=this.wrapped.compose(a.wrapped),g;g=this.meta;a=a.meta;if(g&&"object"===typeof g)if("function"===typeof g.compose)g=g.compose(a);else{var q={};f(g,q);f(a,q);g=q}else g=a;return new c(b,g)};c.transform=function(a,b){var f=a.wrapped.constructor.transform,f=f(a.wrapped,b.wrapped);return[new c(f[0],g(a.meta,b.wrapped)),new c(f[1],g(b.meta,a.wrapped))]};return c}();c.WrappedOperation=a})(window);(function(c){var a=function(){function a(b,c){this.position=b;this.selectionEnd=c}a.fromJSON=function(c){return new a(c.position,c.selectionEnd)};a.prototype.equals=function(a){return this.position===a.position&&this.selectionEnd===a.selectionEnd};a.prototype.compose=function(a){return a};a.prototype.transform=function(c){function f(a){for(var b=a,f=c.ops,g=0,u=c.ops.length;g<u&&!(f[g].isRetain()?a-=f[g].chars:f[g].isInsert()?b+=f[g].text.length:(b-=Math.min(a,f[g].chars),a-=f[g].chars),0>a);g++);
return b}var g=f(this.position);return this.position===this.selectionEnd?new a(g,g):new a(g,f(this.selectionEnd))};return a}();c.Cursor=a})(window);(function(c){var a=function(){function a(b){this.maxItems=b||50;this.state=f;this.dontCompose=!1;this.undoStack=[];this.redoStack=[]}function c(a,b){for(var d=[],f=b.constructor,q=a.length-1;0<=q;q--){var u=f.transform(a[q],b);"function"===typeof u[0].isNoop&&u[0].isNoop()||d.push(u[0]);b=u[1]}return d.reverse()}var f="normal";a.prototype.add=function(a,b){if("undoing"===this.state)this.redoStack.push(a),this.dontCompose=!0;else if("redoing"===this.state)this.undoStack.push(a),this.dontCompose=!0;
else{var c=this.undoStack;!this.dontCompose&&b&&0<c.length?c.push(a.compose(c.pop())):(c.push(a),c.length>this.maxItems&&c.shift());this.dontCompose=!1;this.redoStack=[]}};a.prototype.transform=function(a){this.undoStack=c(this.undoStack,a);this.redoStack=c(this.redoStack,a)};a.prototype.performUndo=function(a){this.state="undoing";if(0===this.undoStack.length)throw Error("undo not possible");a(this.undoStack.pop());this.state=f};a.prototype.performRedo=function(a){this.state="redoing";if(0===this.redoStack.length)throw Error("redo not possible");
a(this.redoStack.pop());this.state=f};a.prototype.canUndo=function(){return 0!==this.undoStack.length};a.prototype.canRedo=function(){return 0!==this.redoStack.length};a.prototype.isUndoing=function(){return"undoing"===this.state};a.prototype.isRedoing=function(){return"redoing"===this.state};return a}();c.UndoManager=a})(window);(function(c){var a=function(){function a(b){this.revision=b;this.state=h}function c(){}function f(a){this.outstanding=a}function g(a,b){this.outstanding=a;this.buffer=b}a.prototype.setState=function(a){this.state=a};a.prototype.applyClient=function(a){this.setState(this.state.applyClient(this,a))};a.prototype.applyServer=function(a){this.revision++;this.setState(this.state.applyServer(this,a))};a.prototype.serverAck=function(){this.revision++;this.setState(this.state.serverAck(this))};a.prototype.serverRetry=
function(){this.setState(this.state.serverRetry(this))};a.prototype.transformCursor=function(a){return this.state.transformCursor(a)};a.prototype.sendOperation=function(a){throw Error("sendOperation must be defined in child class");};a.prototype.applyOperation=function(a){throw Error("applyOperation must be defined in child class");};a.Synchronized=c;c.prototype.applyClient=function(a,b){a.sendOperation(a.revision,b);return new f(b)};c.prototype.applyServer=function(a,b){a.applyOperation(b);return this};
c.prototype.transformCursor=function(a){return a};c.prototype.serverAck=function(a){throw Error("There is no pending operation.");};c.prototype.serverRetry=function(a){throw Error("There is no pending operation.");};var h=new c;a.AwaitingConfirm=f;f.prototype.applyClient=function(a,b){return new g(this.outstanding,b)};f.prototype.applyServer=function(a,b){var c=b.constructor.transform(this.outstanding,b);a.applyOperation(c[1]);return new f(c[0])};f.prototype.serverAck=function(a){return h};f.prototype.serverRetry=
function(a){a.sendOperation(this.outstanding);return this};f.prototype.transformCursor=function(a){return a.transform(this.outstanding)};a.AwaitingWithBuffer=g;g.prototype.applyClient=function(a,b){var c=this.buffer.compose(b);return new g(this.outstanding,c)};g.prototype.applyServer=function(a,b){var c=b.constructor.transform,d=c(this.outstanding,b),c=c(this.buffer,d[1]);a.applyOperation(c[1]);return new g(d[0],c[0])};g.prototype.serverRetry=function(a){var b=this.outstanding.compose(this.buffer);
a.sendOperation(b);return new f(b)};g.prototype.serverAck=function(a){a.sendOperation(a.revision,this.buffer);return new f(this.buffer)};g.prototype.transformCursor=function(a){return a.transform(this.outstanding).transform(this.buffer)};return a}();c.Client=a})(window);(function(c){var a=function(){function a(b,c){this.cursorBefore=b;this.cursorAfter=c}function d(a,b){this.id=a;this.editorAdapter=b;this.li=document.createElement("li")}function f(a,b,c,d){h.call(this,a);this.serverAdapter=c;this.editorAdapter=d;this.undoManager=new n;this.clients={};var f=this;this.editorAdapter.registerCallbacks({change:function(a,b){f.onChange(a,b)},cursorActivity:function(){f.onCursorActivity()},blur:function(){f.onBlur()},focus:function(){f.onFocus()}});this.editorAdapter.registerUndo(function(){f.undo()});
this.editorAdapter.registerRedo(function(){f.redo()});this.serverAdapter.registerCallbacks({client_left:function(a){f.onClientLeft(a)},set_name:function(a,b){f.getClientObject(a).setName(b)},ack:function(){f.serverAck()},operation:function(a){f.applyServer(q.fromJSON(a))},cursor:function(a,b){b?f.getClientObject(a).updateCursor(f.transformCursor(m.fromJSON(b))):f.getClientObject(a).removeCursor()},clients:function(a){for(var b in f.clients)if(f.clients.hasOwnProperty(b)&&!a.hasOwnProperty(b))f.onClientLeft(b);
for(b in a)if(a.hasOwnProperty(b)){var c=f.getClientObject(b);a[b].name&&c.setName(a[b].name);(c=a[b].selection)?f.clients[b].updateSelection(f.transformSelection(Selection.fromJSON(c))):f.clients[b].removeSelection()}},reconnect:function(){f.serverReconnect()}})}function g(a){return a[a.length-1]}var h=c.Client,m=c.Cursor,n=c.UndoManager,q=c.TextOperation,u=c.WrappedOperation;a.prototype.invert=function(){return new a(this.cursorAfter,this.cursorBefore)};a.prototype.compose=function(c){return new a(this.cursorBefore,
c.cursorAfter)};a.prototype.transform=function(c){return new a(this.cursorBefore?this.cursorBefore.transform(c):null,this.cursorAfter?this.cursorAfter.transform(c):null)};d.prototype.setColor=function(a){this.color=a};d.prototype.updateCursor=function(a){this.color="#86BA7D";this.removeCursor();this.cursor=a;this.mark=this.editorAdapter.setOtherCursor(a,this.color,this.id)};d.prototype.removeCursor=function(){this.mark&&this.mark.clear()};(function(a,b){function c(){}c.prototype=b.prototype;a.prototype=
new c;a.prototype.constructor=a})(f,h);f.prototype.getClientObject=function(a){var b=this.clients[a];return b?b:this.clients[a]=new d(a,this.editorAdapter)};f.prototype.applyUnredo=function(a){this.undoManager.add(this.editorAdapter.invertOperation(a));this.editorAdapter.applyOperation(a.wrapped);(this.cursor=a.meta.cursorAfter)&&this.editorAdapter.setCursor(this.cursor);this.applyClient(a.wrapped)};f.prototype.undo=function(){var a=this;this.undoManager.canUndo()&&this.undoManager.performUndo(function(b){a.applyUnredo(b)})};
f.prototype.redo=function(){var a=this;this.undoManager.canRedo()&&this.undoManager.performRedo(function(b){a.applyUnredo(b)})};f.prototype.onChange=function(c,d){var f=this.cursor;this.updateCursor();var h=0<this.undoManager.undoStack.length&&d.shouldBeComposedWithInverted(g(this.undoManager.undoStack).wrapped),f=new a(this.cursor,f);this.undoManager.add(new u(d,f),h);this.applyClient(c)};f.prototype.updateCursor=function(){this.cursor=this.editorAdapter.getCursor()};f.prototype.onCursorActivity=
function(){var a=this.cursor;this.updateCursor();!this.focused||a&&this.cursor.equals(a)||this.sendCursor(this.cursor)};f.prototype.onBlur=function(){this.cursor=null;this.sendCursor(null);this.focused=!1};f.prototype.onFocus=function(){this.focused=!0;this.onCursorActivity()};f.prototype.sendCursor=function(a){this.state instanceof h.AwaitingWithBuffer||this.serverAdapter.sendCursor(a)};f.prototype.sendOperation=function(a,b){this.serverAdapter.sendOperation(a,b.toJSON(),this.cursor,this.editorAdapter.cm.options.keyMap)};
f.prototype.applyOperation=function(a){this.editorAdapter.applyOperation(a);this.updateCursor();this.undoManager.transform(new u(a,null))};f.prototype.emitStatus=function(){var a=this;setTimeout(function(){a.trigger("synced",a.state instanceof h.Synchronized)},0)};return f}();c.EditorClient=a})(window);(function(c){var a=function(){function a(b,c){this.pos=b;this.length=c}a.prototype.end=function(){return this.pos+this.length};return a}();c.Span=a})(window);(function(c){var a=function(){function a(b,c){if(!b)throw Error("AnnotationList assertion failed"+(c?": "+c:""));}function d(a,b){this.pos=a;this.length=b.length;this.annotation=b.annotation;this.attachedObject_=b.attachedObject}function f(a,b){this.pos=a;this.length=b.length;this.annotation=b.annotation;this.node_=b}function g(a){this.head_=new h(0,n);this.changeHandler_=a}function h(a,b){this.length=a;this.annotation=b;this.next=this.attachedObject=null}var m=c.Span;d.prototype.getAttachedObject=
function(){return this.attachedObject_};f.prototype.attachObject=function(a){this.node_.attachedObject=a};var n={equals:function(){return!1}};g.prototype.insertAnnotatedSpan=function(c,d){this.wrapOperation_(new m(c.pos,0),function(f,g){a(!g||null===g.next);var m=new h(c.length,d);if(g){a(c.pos>f&&c.pos<f+g.length);var r=new h(0,n);r.next=new h(c.pos-f,g.annotation);r.next.next=m;m.next=new h(f+g.length-c.pos,g.annotation);return r.next}return m})};g.prototype.removeSpan=function(c){0!==c.length&&
this.wrapOperation_(c,function(d,f){a(null!==f);var g=new h(0,n),m=g;c.pos>d&&(m.next=new h(c.pos-d,f.annotation),m=m.next);for(;c.end()>d+f.length;)d+=f.length,f=f.next;var r=d+f.length-c.end();0<r&&(m.next=new h(r,f.annotation));return g.next})};g.prototype.updateSpan=function(c,d){0!==c.length&&this.wrapOperation_(c,function(f,g){a(null!==g);var m=new h(0,n),r=m,s=f,v=c.pos-s;a(v<g.length);0<v&&(r.next=new h(v,g.annotation),r=r.next,s+=r.length);for(;null!==g&&c.end()>=f+g.length;)s=f+g.length-
s,r.next=new h(s,d(g.annotation,s)),r=r.next,f+=g.length,g=g.next,s=f;v=c.end()-s;0<v&&(a(v<g.length),r.next=new h(v,d(g.annotation,v)),r=r.next,s+=r.length,r.next=new h(f+g.length-s,g.annotation));return m.next})};g.prototype.wrapOperation_=function(a,b){if(0>a.pos)throw Error("Span start cannot be negative.");var c=[],g=[],m=this.getAffectedNodes_(a),r;null!==m.start?(r=m.end.next,m.end.next=null):r=m.succ;var n=b(m.startPos,m.start),v=!1,B=!1;if(n){this.mergeNodesWithSameAnnotations_(n);var K;
m.pred&&m.pred.annotation.equals(n.annotation)?(v=!0,n.length+=m.pred.length,m.beforePred.next=n,K=m.predPos):(m.beforeStart.next=n,K=m.startPos);for(;n.next;)g.push(new f(K,n)),K+=n.length,n=n.next;m.succ&&m.succ.annotation.equals(n.annotation)?(n.length+=m.succ.length,B=!0,n.next=m.succ.next):n.next=r;g.push(new f(K,n))}else m.pred&&m.succ&&m.pred.annotation.equals(m.succ.annotation)?(B=v=!0,n=new h(m.pred.length+m.succ.length,m.pred.annotation),m.beforePred.next=n,n.next=m.succ.next,g.push(new f(m.startPos-
m.pred.length,n))):m.beforeStart.next=r;v&&c.push(new d(m.predPos,m.pred));r=m.startPos;for(n=m.start;null!==n;)c.push(new d(r,n)),r+=n.length,n=n.next;B&&c.push(new d(r,m.succ));this.changeHandler_(c,g)};g.prototype.getAffectedNodes_=function(a){for(var b={},c=null,d=this.head_,f=d.next,g=0;null!==f&&a.pos>=g+f.length;)g+=f.length,c=d,d=f,f=f.next;if(null===f&&(0!==a.length||a.pos!==g))throw Error("Span start exceeds the bounds of the AnnotationList.");b.startPos=g;b.start=0===a.length&&a.pos===
g?null:f;b.beforeStart=d;g===a.pos&&0<g?(b.pred=d,b.predPos=g-d.length,b.beforePred=c):b.pred=null;for(;null!==f&&a.end()>g;)g+=f.length,d=f,f=f.next;if(a.end()>g)throw Error("Span end exceeds the bounds of the AnnotationList.");0===a.length&&a.end()===g?b.end=null:b.end=d;b.succ=g===a.end()?f:null;return b};g.prototype.mergeNodesWithSameAnnotations_=function(a){if(a)for(var b=null;a;)b&&b.annotation.equals(a.annotation)?(b.length+=a.length,b.next=a.next):b=a,a=a.next};g.prototype.forEach=function(a){for(var b=
this.head_.next;null!==b;)a(b.length,b.annotation,b.attachedObject),b=b.next};g.prototype.getAnnotatedSpansForPos=function(a){for(var b=0,c=this.head_.next,f=null;null!==c&&b+c.length<=a;)b+=c.length,f=c,c=c.next;if(null===c&&b!==a)throw Error("pos exceeds the bounds of the AnnotationList");var g=[];b===a&&f&&g.push(new d(b-f.length,f));c&&g.push(new d(b,c));return g};g.prototype.getAnnotatedSpansForSpan=function(a){if(0===a.length)return[];for(var b=[],c=this.getAffectedNodes_(a),d=c.startPos,c=
c.start;null!==c&&d<a.end();){var f=Math.max(d,a.pos),g=Math.min(d+c.length,a.end()),f=new m(f,g-f);f.annotation=c.annotation;b.push(f);d+=c.length;c=c.next}return b};g.prototype.count=function(){for(var c=0,d=this.head_.next,f=null;null!==d;)f&&a(!f.annotation.equals(d.annotation)),f=d,d=d.next,c++;return c};h.prototype.clone=function(){var a=new h(this.spanLength,this.annotation);a.next=this.next;return a};return g}();c.AnnotationList=a})(window);(function(c){c.AttributeConstants={BOLD:"b",ITALIC:"i",UNDERLINE:"u",STRIKE:"s",FONT:"f",FONT_SIZE:"fs",COLOR:"c",BACKGROUND_COLOR:"bc",ENTITY_SENTINEL:"ent",LINE_SENTINEL:"l",LINE_INDENT:"li",LINE_ALIGN:"la",LIST_TYPE:"lt"}})(window);(function(c){var a=function(){function a(c){if(!(this instanceof a))return new a(c);this.attributes=c||{};this.attributes[d.LINE_SENTINEL]=!0}var d=c.AttributeConstants;a.LIST_TYPE={NONE:!1,ORDERED:"o",UNORDERED:"u",TODO:"t",TODOCHECKED:"tc"};a.prototype.cloneWithNewAttribute_=function(c,d){var h={},m;for(m in this.attributes)h[m]=this.attributes[m];!1===d?delete h[c]:h[c]=d;return new a(h)};a.prototype.indent=function(a){return this.cloneWithNewAttribute_(d.LINE_INDENT,a)};a.prototype.align=function(a){return this.cloneWithNewAttribute_(d.LINE_ALIGN,
a)};a.prototype.listItem=function(a){vceditor.utils.assert(!1===a||"u"===a||"o"===a||"t"===a||"tc"===a);return this.cloneWithNewAttribute_(d.LIST_TYPE,a)};a.prototype.getIndent=function(){return this.attributes[d.LINE_INDENT]||0};a.prototype.getAlign=function(){return this.attributes[d.LINE_ALIGN]||0};a.prototype.getListItem=function(){return this.attributes[d.LIST_TYPE]||!1};return a}();c.LineFormatting=a})(window);(function(c){var a=function(){function a(b){return b===h.ORDERED?"</ol>":"</ul>"}function d(a,b){return a===b||a===h.TODO&&b===h.TODOCHECKED||a===h.TODOCHECKED&&b===h.TODO}var f=c.utils,g=c.AttributeConstants,h=c.LineFormatting.LIST_TYPE;return function(c,n){for(var q="",u=!0,w=[],t=!1,x=!0,r=!0,s=0,v=c.ops[s],B=!1;v;){f.assert(v.isInsert());var K=v.attributes;if(u){var u=!1,J=0,L=null,C="left";g.LINE_SENTINEL in K&&(J=K[g.LINE_INDENT]||0,L=K[g.LIST_TYPE]||null,C=K[g.LINE_ALIGN]||"left");L&&(J=J||
1);t?(q+="</li>",t=!1):x||(r&&(q+="<br/>"),q+="</div>");x=!1;for(f.assert(0<=J,"Indent must not be negative.");w.length>J||J===w.length&&null!==L&&!d(L,w[w.length-1]);)q+=a(w.pop());for(;w.length<J;)r=L||h.UNORDERED,B=L==h.TODO||L==h.TODOCHECKED||B,q+=r===h.ORDERED?"<ol>":r===h.UNORDERED?"<ul>":'<ul class="vceditor-todo">',w.push(r);r="left"!==C?' style="text-align:'+C+'"':"";if(L){t="";switch(L){case h.TODOCHECKED:t=' class="vceditor-checked"';break;case h.TODO:t=' class="vceditor-unchecked"'}q+=
"<li"+t+r+">";t=!0}else q+="<div"+r+">";r=!0}if(g.LINE_SENTINEL in K)v=c.ops[++s];else if(g.ENTITY_SENTINEL in K){for(L=0;L<v.text.length;L++)J=vceditor.Entity.fromAttributes(K),J=n.exportToElement(J),q+=J.outerHTML;v=c.ops[++s]}else{var J=L="",R;for(R in K){var C=K[R],A,T;R===g.BOLD||R===g.ITALIC||R===g.UNDERLINE||R===g.STRIKE?(f.assert(!0===C),A=T=R):R===g.FONT_SIZE?(A='span style="font-size: '+C,A+="string"!==typeof C||-1===C.indexOf("px",C.length-2)?'px"':'"',T="span"):R===g.FONT?(A='span style="font-family: '+
C+'"',T="span"):R===g.COLOR?(A='span style="color: '+C+'"',T="span"):R===g.BACKGROUND_COLOR?(A='span style="background-color: '+C+'"',T="span"):f.log(!1,"Encountered unknown attribute while rendering html: "+R);A&&(L+="<"+A+">");T&&(J="</"+T+">"+J)}var C=v.text,da=C.indexOf("\n");0<=da?(u=!0,v=da<C.length-1?new vceditor.TextOp("insert",C.substr(da+1),K):c.ops[++s],C=C.substr(0,da)):v=c.ops[++s];C=C.replace(/  +/g,function(a){return Array(a.length+1).join("\u00a0")}).replace(/^ /,"\u00a0").replace(/ $/,
"\u00a0");0<C.length&&(r=!1);q+=L+C.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g,"&nbsp;")+J}}t?q+="</li>":x||(r&&(q+="&nbsp;"),q+="</div>");for(;0<w.length;)q+=a(w.pop());B&&(q='<style>ul.vceditor-todo { list-style: none; margin-left: 0; padding-left: 0; } ul.vceditor-todo > li { padding-left: 1em; text-indent: -1em; } ul.vceditor-todo > li:before { content: "\\2610"; padding-right: 5px; } ul.vceditor-todo > li.vceditor-checked:before { content: "\\2611"; padding-right: 5px; }</style>\n'+
q);return q}}();c.SerializeHtml=a})(window);(function(c){var a=function(){function a(b,c,d){this.listType=b||m.UNORDERED;this.lineFormatting=c||vceditor.LineFormatting();this.textFormatting=d||vceditor.Formatting()}function d(){this.lines=[];this.currentLine=[];this.currentLineListItemType=null}function f(a,b,c){if(a.nodeType===q.ELEMENT_NODE){var d=n.fromElement(a);if(d){c.currentLine.push(new vceditor.Text(vceditor.sentinelConstants.ENTITY_SENTINEL_CHARACTER,new vceditor.Formatting(d.toAttributes())));return}}switch(a.nodeType){case q.TEXT_NODE:a=
a.nodeValue.replace(/[ \n\t]+/g," ");c.currentLine.push(vceditor.Text(a,b.textFormatting));break;case q.ELEMENT_NODE:switch(d=a.getAttribute("style")||"",b=h(b,d),a.nodeName.toLowerCase()){case "div":case "h1":case "h2":case "h3":case "p":c.newlineIfNonEmpty(b);g(a,b,c);c.newlineIfNonEmpty(b);break;case "center":b=b.withAlign("center");c.newlineIfNonEmpty(b);g(a,b.withAlign("center"),c);c.newlineIfNonEmpty(b);break;case "b":case "strong":g(a,b.withTextFormatting(b.textFormatting.bold(!0)),c);break;
case "u":g(a,b.withTextFormatting(b.textFormatting.underline(!0)),c);break;case "i":case "em":g(a,b.withTextFormatting(b.textFormatting.italic(!0)),c);break;case "s":g(a,b.withTextFormatting(b.textFormatting.strike(!0)),c);break;case "font":var d=a.getAttribute("face"),f=a.getAttribute("color"),s=parseInt(a.getAttribute("size"));d&&(b=b.withTextFormatting(b.textFormatting.font(d)));f&&(b=b.withTextFormatting(b.textFormatting.color(f)));s&&(b=b.withTextFormatting(b.textFormatting.fontSize(s)));g(a,
b,c);break;case "br":c.newline(b);break;case "ul":c.newlineIfNonEmptyOrListItem(b);d="vceditor-todo"===a.getAttribute("class")?m.TODO:m.UNORDERED;g(a,b.withListType(d).withIncreasedIndent(),c);c.newlineIfNonEmpty(b);break;case "ol":c.newlineIfNonEmptyOrListItem(b);g(a,b.withListType(m.ORDERED).withIncreasedIndent(),c);c.newlineIfNonEmpty(b);break;case "li":c.newlineIfNonEmptyOrListItem(b);d="vceditor-checked"===a.getAttribute("class")?m.TODOCHECKED:b.listType;c.makeListItem(d);d=c.currentLine;g(a,
b,c);(d===c.currentLine||0<c.currentLine.length)&&c.newline(b);break;case "style":break;default:g(a,b,c)}}}function g(a,b,c){if(a.hasChildNodes())for(var d=0;d<a.childNodes.length;d++)f(a.childNodes[d],b,c)}function h(a,b){for(var c=a.textFormatting,d=a.lineFormatting,f=b.split(";"),g=0;g<f.length;g++){var h=f[g].split(":");if(2===h.length){var m=vceditor.utils.trim(h[0]).toLowerCase(),h=vceditor.utils.trim(h[1]).toLowerCase();switch(m){case "text-decoration":m=0<=h.indexOf("underline");h=0<=h.indexOf("line-through");
c=c.underline(m).strike(h);break;case "font-weight":h="bold"===h||600<=parseInt(h);c=c.bold(h);break;case "font-style":c=c.italic("italic"===h||"oblique"===h);break;case "color":c=c.color(h);break;case "background-color":c=c.backgroundColor(h);break;case "text-align":d=d.align(h);break;case "font-size":m=null;vceditor.utils.stringEndsWith(h,"px pt % em xx-small x-small small medium large x-large xx-large smaller larger".split(" "))?m=h:parseInt(h)&&(m=parseInt(h)+"px");m&&(c=c.fontSize(m));break;
case "font-family":h=vceditor.utils.trim(h.split(",")[0]),h=h.replace(/['"]/g,""),h=h.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}),c=c.font(h)}}}return a.withLineFormatting(d).withTextFormatting(c)}var m=c.LineFormatting.LIST_TYPE;a.prototype.withTextFormatting=function(c){return new a(this.listType,this.lineFormatting,c)};a.prototype.withLineFormatting=function(c){return new a(this.listType,c,this.textFormatting)};a.prototype.withListType=function(c){return new a(c,
this.lineFormatting,this.textFormatting)};a.prototype.withIncreasedIndent=function(){var c=this.lineFormatting.indent(this.lineFormatting.getIndent()+1);return new a(this.listType,c,this.textFormatting)};a.prototype.withAlign=function(c){c=this.lineFormatting.align(c);return new a(this.listType,c,this.textFormatting)};d.prototype.newlineIfNonEmpty=function(a){this.cleanLine_();0<this.currentLine.length&&this.newline(a)};d.prototype.newlineIfNonEmptyOrListItem=function(a){this.cleanLine_();(0<this.currentLine.length||
null!==this.currentLineListItemType)&&this.newline(a)};d.prototype.newline=function(a){this.cleanLine_();a=a.lineFormatting;null!==this.currentLineListItemType&&(a=a.listItem(this.currentLineListItemType),this.currentLineListItemType=null);this.lines.push(vceditor.Line(this.currentLine,a));this.currentLine=[]};d.prototype.makeListItem=function(a){this.currentLineListItemType=a};d.prototype.cleanLine_=function(){if(0<this.currentLine.length){var a=this.currentLine.length-1;this.currentLine[0].text=
this.currentLine[0].text.replace(/^ +/,"");this.currentLine[a].text=this.currentLine[a].text.replace(/ +$/g,"");for(a=0;a<this.currentLine.length;a++)this.currentLine[a].text=this.currentLine[a].text.replace(/\u00a0/g," ")}1===this.currentLine.length&&""===this.currentLine[0].text&&(this.currentLine=[])};var n,q=q||{ELEMENT_NODE:1,TEXT_NODE:3};return function(c,g){var h=(vceditor.document||document).createElement("div");h.innerHTML=c;n=g;var m=new d,r=new a;f(h,r,m);return m.lines}}();c.ParseHtml=
a})(window);(function(c){RichTextCodeMirrorAdapter=function(){function a(a){this.rtcm=a;this.cm=a.codeMirror;d(this,"onChange");d(this,"onAttributesChange");d(this,"onCursorActivity");d(this,"onFocus");d(this,"onBlur");this.rtcm.on("change",this.onChange);this.rtcm.on("attributesChange",this.onAttributesChange);this.cm.on("cursorActivity",this.onCursorActivity);this.cm.on("focus",this.onFocus);this.cm.on("blur",this.onBlur)}function b(a){var b=a.lineCount()-1;return a.indexFromPos({line:b,ch:a.getLine(b).length})}
function d(a,b){var c=a[b];a[b]=function(){c.apply(a,arguments)}}function f(a){for(var b in a)return!1;return!0}var g=c.TextOperation,h=c.WrappedOperation,m=c.Cursor;a.prototype.detach=function(){this.rtcm.off("change",this.onChange);this.rtcm.off("attributesChange",this.onAttributesChange);this.cm.off("cursorActivity",this.onCursorActivity);this.cm.off("focus",this.onFocus);this.cm.off("blur",this.onBlur)};a.operationFromCodeMirrorChanges=function(a,c){for(var d=b(c),f=(new g).retain(d),h=(new g).retain(d),
m=a.length-1;0<=m;m--)var r=a[m],s=r.start,v=d-s-r.text.length,f=(new g).retain(s)["delete"](r.removed.length).insert(r.text,r.attributes).retain(v).compose(f),h=h.compose((new g).retain(s)["delete"](r.text.length).insert(r.removed,r.removedAttributes).retain(v)),d=d+(r.removed.length-r.text.length);return[f,h]};a.operationFromAttributesChanges=function(a,c){for(var d=b(c),f=new g,h=new g,m=0,r=0;r<a.length;r++){var s=a[r],m=s.start-m;if(!(0<=m))throw Error("assertion error");f.retain(m);h.retain(m);
m=s.end-s.start;f.retain(m,s.attributes);h.retain(m,s.attributesInverse);m=s.start+m}f.retain(d-m);h.retain(d-m);return[f,h]};a.applyOperationToCodeMirror=function(a,b){10<a.ops.length&&b.codeMirror.getWrapperElement().setAttribute("style","display: none");for(var c=a.ops,d=0,g=0,h=c.length;g<h;g++){var m=c[g];m.isRetain()?(f(m.attributes)||b.updateTextAttributes(d,d+m.chars,function(a){for(var b in m.attributes)!1===m.attributes[b]?delete a[b]:a[b]=m.attributes[b]},"RTCMADAPTER",!0),d+=m.chars):
m.isInsert()?(b.insertText(d,m.text,m.attributes,"RTCMADAPTER"),d+=m.text.length):m.isDelete()&&b.removeText(d,d+m.chars,"RTCMADAPTER")}10<a.ops.length&&(b.codeMirror.getWrapperElement().setAttribute("style",""),b.codeMirror.refresh())};a.prototype.registerCallbacks=function(a){this.callbacks=a};a.prototype.onChange=function(b,c){if("RTCMADAPTER"!==c[0].origin){var d=a.operationFromCodeMirrorChanges(c,this.cm);this.trigger("change",d[0],d[1])}};a.prototype.onAttributesChange=function(b,c){if("RTCMADAPTER"!==
c[0].origin){var d=a.operationFromAttributesChanges(c,this.cm);this.trigger("change",d[0],d[1])}};a.prototype.onCursorActivity=function(){this.trigger("cursorActivity")};a.prototype.onFocus=function(){this.trigger("focus")};a.prototype.onBlur=function(){this.cm.somethingSelected()||this.trigger("blur")};a.prototype.getValue=function(){return this.cm.getValue()};a.prototype.getCursor=function(){var a=this.cm,b=a.getCursor(),c=a.indexFromPos(b);if(a.somethingSelected())var d=a.getCursor(!0),b=0===(b.line<
d.line?-1:b.line>d.line?1:b.ch<d.ch?-1:b.ch>d.ch?1:0)?a.getCursor(!1):d,a=a.indexFromPos(b);else a=c;return new m(c,a)};a.prototype.setCursor=function(a){this.cm.setSelection(this.cm.posFromIndex(a.position),this.cm.posFromIndex(a.selectionEnd))};a.prototype.addStyleRule=function(a){if("undefined"!==typeof document&&null!==document){if(!this.addedStyleRules){this.addedStyleRules={};var b=document.createElement("style");document.documentElement.getElementsByTagName("head")[0].appendChild(b);this.addedStyleSheet=
b.sheet}if(!this.addedStyleRules[a])return this.addedStyleRules[a]=!0,this.addedStyleSheet.insertRule(a,0)}};a.prototype.setOtherCursor=function(a,b,c){var d=this.cm.posFromIndex(a.position);if("string"===typeof b&&b.match(/^#[a-fA-F0-9]{3,6}$/)){var f=this.rtcm.end();if("object"===typeof a&&"number"===typeof a.position&&"number"===typeof a.selectionEnd&&!(0>a.position||a.position>f||0>a.selectionEnd||a.selectionEnd>f)){var g=this.cm.cursorCoords(d),f=document.createElement("span");f.className="other-client";
f.id="cursorId"+c;f.style.borderLeftWidth="3px";f.style.borderLeftStyle="solid";f.style.borderLeftColor=b;f.style.marginLeft=f.style.marginRight="-3px";f.style.height=.9*(g.bottom-g.top)+"px";f.setAttribute("data-clientname",virtualclass.vutil.getUserInfo("name",c,virtualclass.connectedUsers));f.setAttribute("data-clientid",c);f.style.position="relative";g=document.getElementById("cursorId"+c);null!=g&&g.parentNode.removeChild(g);if(c!=virtualclass.gObj.uid){if(a.position===a.selectionEnd)return f.style.zIndex=
0,this.cm.setBookmark(d,{widget:f,insertLeft:!0});this.cm.setBookmark(d,{widget:f,insertLeft:!0});c="selection-"+b.replace("#","");this.addStyleRule("."+c+" { background: "+b+"; }");a.selectionEnd>a.position?(b=d,a=this.cm.posFromIndex(a.selectionEnd)):(b=this.cm.posFromIndex(a.selectionEnd),a=d);return this.cm.markText(b,a,{className:c})}}}};a.prototype.trigger=function(a){var b=Array.prototype.slice.call(arguments,1),c=this.callbacks&&this.callbacks[a];c&&c.apply(this,b)};a.prototype.applyOperation=
function(b){a.applyOperationToCodeMirror(b,this.rtcm)};a.prototype.registerUndo=function(a){this.cm.undo=a};a.prototype.registerRedo=function(a){this.cm.redo=a};a.prototype.invertOperation=function(a){for(var b=0,c=this.rtcm.codeMirror,d,m,x=new g,r=0;r<a.wrapped.ops.length;r++){var s=a.wrapped.ops[r];if(s.isRetain())if(f(s.attributes))x.retain(s.chars),b+=s.chars;else for(d=this.rtcm.getAttributeSpans(b,b+s.chars),m=0;m<d.length;m++){var v={},B;for(B in s.attributes){var K=s.attributes[B],J=d[m].attributes[B];
!1===K?J&&(v[B]=J):K!==J&&(v[B]=J||!1)}x.retain(d[m].length,v);b+=d[m].length}else if(s.isInsert())x["delete"](s.text.length);else if(s.isDelete()){v=c.getRange(c.posFromIndex(b),c.posFromIndex(b+s.chars));d=this.rtcm.getAttributeSpans(b,b+s.chars);for(m=K=0;m<d.length;m++)x.insert(v.substr(K,d[m].length),d[m].attributes),K+=d[m].length;b+=s.chars}}return new h(x,a.meta.invert())};return a}();c.Client=RichTextCodeMirrorAdapter})(window);otAdapter=function(){function c(a,b){b=b.charAt(0).toLowerCase()+b.slice(1);var c=Vceditor.getvcEditor();if(a.operations&&a.revision>a.operations.length){var f=[];f[a.revision-a.operations.length-1]=null;this.operations=f.concat(a.operations)}else this.operations=a.operations?a.operations:[];this.server=new c.Server(a.doc,this.operations);this.trigger=function(a){this.callbacks[a].apply(this,Array.prototype.slice.call(arguments,1))};this.teacherOT=function(a){a=this.doOT(a);"undefined"!=typeof a&&
this.preSend(a,!0)};this.doOT=function(a){if(1!==this.myOTrequestData)try{if("virtualclass-editor-operation"==a.eddata){var b=JSON.parse(a.data),f=new c.WrappedOperation(c.TextOperation.fromJSON(b.operation),b.cursor&&c.Cursor.fromJSON(b.cursor)),n=this.server.receiveOperation(b.revision,f);if(!n){console.log("there is some problem on revision of history");return}a.data=n.wrapped.toJSON();a.meta=n.meta}return a}catch(q){console.log("ERROR "+q),roles.isTeacher()&&(this.myOTrequestData=1,virtualclass[a.et].responseToRequest())}};
this.processOp=function(a){if(1!==this.myrequestData&&1!==this.myOTrequestData)try{var b=a.message;b.hasOwnProperty("edFrom")&&(a.fromUser.userid=b.edFrom);b.hasOwnProperty("eddata")?"virtualclass-editor-cursor"==b.eddata?this.trigger("cursor",a.fromUser.userid,JSON.parse(b.data)):"selection"==b.eddata?this.trigger("selection",virtualclass.gObj.uid,b.data):"virtualclass-editor-operation"==b.eddata&&(this.trigger("operation",b.data),this.trigger("cursor",a.fromUser.userid,b.meta),this.storeOperationIfStudent(b)):
console.log("Editor : processOP - No EDDATA")}catch(c){roles.hasAdmin()?(this.myOTrequestData=1,virtualclass[a.message.et].responseToRequest(),console.log("Teacher : send whlole editor data ")):(this.removeOperations(a),virtualclass[a.message.et].requestData(),this.myrequestData=1,console.log("Student : send whlole editor data "))}};this.storeOperationIfStudent=function(a){if(!roles.hasAdmin()){var b={};b.wrapped=c.TextOperation.fromJSON(a.data);b.meta=a.meta;this.server.operations.push(b)}};this.receivedMessage=
function(a){if(!virtualclass.isPlayMode||""===a.toUser){var b=a.message;if("t"!=a.fromUser.role&&"e"!=a.fromUser.role||b.hasOwnProperty("edFrom"))if(b.hasOwnProperty("edFrom")||"t"==a.fromUser.role||"e"==a.fromUser.role)if(b.edFrom==virtualclass.gObj.uid){if("virtualclass-editor-operation"==b.eddata)try{this.trigger("ack"),this.storeOperationIfStudent(b)}catch(c){1===ioMissingPackets.missRequestFlag&&(virtualclass[b.et].cmClient.revision--,this.processOp(a),console.log("Failed Acknolwdgement processOp()")),
console.log("ACK Too Late "+c)}}else this.processOp(a);else b=this.doOT(b),"undefined"!=typeof b&&(a.message=b,b.edFrom=a.fromUser.userid,this.preSend(b,!0));else if(roles.hasAdmin()){if("virtualclass-editor-operation"==b.eddata)try{this.trigger("ack")}catch(d){console.log("ACK Too Late "+d)}}else this.processOp(a)}};this.removeOperations=function(a){a=a.message.et;this.server.operations=[];this.server.document="";virtualclass[a].cmClient.revision=0;if(null!=b){var b=document.getElementById("virtualclassEditorRichBody");
b.parentNode.removeChild(b)}}}c.myrequestData=0;c.myOTrequestData=0;c.prototype.sendOperation=function(a,b,c,f){if("undefined"!=typeof f)var g="richtext"==f?"editorRich":"editorCode";b={eddata:"virtualclass-editor-operation",data:JSON.stringify({revision:a,operation:b,cursor:c}),et:g,cf:"eddata"};console.log("from send operation "+a);this.beforeSend(b);console.log("send operation")};c.prototype.sendSelection=function(a){this.beforeSend({eddata:"selection",data:JSON.stringify(a),cf:"eddata"})};c.prototype.sendCursor=
function(a){this.beforeSend({eddata:"virtualclass-editor-cursor",data:JSON.stringify(a),cf:"eddata"})};c.prototype.registerCallbacks=function(a){this.callbacks=a};c.prototype.beforeSend=function(a){if(1!=this.myrequestData)if(roles.hasAdmin())this.teacherOT(a);else{var b=virtualclass.vutil.whoIsTeacher();a=this.setEditorTypeOnPacket(a);ioAdapter.mustSendUser(a,b)}};c.prototype.setEditorTypeOnPacket=function(a){if(a.hasOwnProperty("eddata")&&"initVcEditor"!=a.eddata&&"virtualclass-editor-operation"!=
a.eddata)if("EditorRich"==virtualclass.currApp||"editorRich"==virtualclass.currApp)a.et="editorRich";else if("EditorCode"==virtualclass.currApp||"editorCode"==virtualclass.currApp)a.et="editorCode";return a};c.prototype.preSend=function(a,b){a=this.setEditorTypeOnPacket(a);"undefined"==typeof b||!1==b||null==b?ioAdapter.mustSend(a):ioAdapter.mustSendAll(a)};return c}();var Vceditor=function(){var c=c||{};c.utils=window.utils;c=c||{};c.Span=window.Span;c.TextOp=window.TextOp;c.TextOperation=window.TextOperation;"object"===typeof module&&(module.exports=c.TextOperation);c.AnnotationList=window.AnnotationList;c.Cursor=window.Cursor;c.RichTextToolbar=window.RichTextToolbar;c.WrappedOperation=window.WrappedOperation;c.UndoManager=window.UndoManager;c.Client=window.Client;Client=c.Client;c.EditorClient=window.EditorClient;c.utils.makeEventEmitter(c.EditorClient,["synced"]);
c.AttributeConstants=window.AttributeConstants;c.sentinelConstants={LINE_SENTINEL_CHARACTER:"\ue000",ENTITY_SENTINEL_CHARACTER:"\ue001"};c.EntityManager=function(){function a(){this.entities_={};var a="src alt width height style class".split(" ");this.register("img",{render:function(a){b.assert(a.src,"image entity should have 'src'!");for(var c="src alt width height style class".split(" "),d="<img ",m=0;m<c.length;m++){var n=c[m];n in a&&(d+=" "+n+'="'+a[n]+'"')}return d+">"},fromElement:function(b){for(var c=
{},h=0;h<a.length;h++){var m=a[h];b.hasAttribute(m)&&(c[m]=b.getAttribute(m))}return c}})}var b=c.utils;a.prototype.register=function(a,b){c.utils.assert(b.render,"Entity options should include a 'render' function!");c.utils.assert(b.fromElement,"Entity options should include a 'fromElement' function!");this.entities_[a]=b};a.prototype.renderToElement=function(a,b){return this.tryRenderToElement_(a,"render",b)};a.prototype.exportToElement=function(a){var b=this.tryRenderToElement_(a,"export")||this.tryRenderToElement_(a,
"getHtml")||this.tryRenderToElement_(a,"render");b.setAttribute("data-vceditor-entity",a.type);return b};a.prototype.updateElement=function(a,b){var c=a.type,h=a.info;this.entities_[c]&&"undefined"!=typeof this.entities_[c].update&&this.entities_[c].update(h,b)};a.prototype.fromElement=function(a){var b=a.getAttribute("data-vceditor-entity");b||(b=a.nodeName.toLowerCase());if(b&&this.entities_[b])return a=this.entities_[b].fromElement(a),new c.Entity(b,a)};a.prototype.tryRenderToElement_=function(a,
b,g){var h=a.type;a=a.info;if(this.entities_[h]&&this.entities_[h][b]&&(b=this.entities_[h][b](a,g,c.document||window&&window.document))){if("string"===typeof b)return h=(c.document||document).createElement("div"),h.innerHTML=b,h.childNodes[0];if("object"===typeof b)return c.utils.assert("undefined"!==typeof b.nodeType,"Error rendering "+h+" entity.  render() function must return an html string or a DOM element."),b}};a.prototype.entitySupportsUpdate=function(a){return this.entities_[a]&&this.entities_[a].update};
return a}();c=c||{};c.Entity=window.entity;c.Entity=function(){function a(b,c){if(!(this instanceof a))return new a(b,c);this.type=b;this.info=c||{}}var b=c.AttributeConstants.ENTITY_SENTINEL,d=b+"_";a.prototype.toAttributes=function(){var a={};a[b]=this.type;for(var c in this.info)a[d+c]=this.info[c];return a};a.fromAttributes=function(c){var g=c[b],h={},m;for(m in c)0===m.indexOf(d)&&(h[m.substr(d.length)]=c[m]);return new a(g,h)};return a}();c.RichTextCodeMirror=function(){function a(a,b,c){this.codeMirror=
a;this.options_=c||{};this.entityManager_=b;this.currentAttributes_=null;var d=this;this.annotationList_=new h(function(a,b){d.onAnnotationsChanged_(a,b)});this.initAnnotationList_();g(this,"onCodeMirrorBeforeChange_");g(this,"onCodeMirrorChange_");g(this,"onCursorActivity_");if(/^4\./.test(CodeMirror.version))this.codeMirror.on("changes",this.onCodeMirrorChange_);else this.codeMirror.on("change",this.onCodeMirrorChange_);this.codeMirror.on("beforeChange",this.onCodeMirrorBeforeChange_);this.codeMirror.on("cursorActivity",
this.onCursorActivity_);this.changeId_=0;this.outstandingChanges_={};this.dirtyLines_=[]}function b(a,b){return a.line-b.line||a.ch-b.ch}function d(a){if(0===a.length)return 0;for(var b=0,c=0;c<a.length;c++)b+=a[c].length;return b+a.length-1}function f(a){this.attributes=a||{}}function g(a,b){var c=a[b];a[b]=function(){c.apply(a,arguments)}}var h=c.AnnotationList,m=c.Span,n=c.utils,q=c.AttributeConstants,u={c:"color",bc:"background-color",fs:"font-size",li:function(a){return"padding-left: "+40*a+
"px"}},w={};n.makeEventEmitter(a,["change","attributesChange","newLine"]);var t=c.sentinelConstants.LINE_SENTINEL_CHARACTER,x=c.sentinelConstants.ENTITY_SENTINEL_CHARACTER;a.prototype.detach=function(){this.codeMirror.off("beforeChange",this.onCodeMirrorBeforeChange_);this.codeMirror.off("change",this.onCodeMirrorChange_);this.codeMirror.off("changes",this.onCodeMirrorChange_);this.codeMirror.off("cursorActivity",this.onCursorActivity_);this.clearAnnotations_()};a.prototype.toggleAttribute=function(a,
b){var c=b||!0;if(this.emptySelection_()){var d=this.getCurrentAttributes_();d[a]===c?delete d[a]:d[a]=c;this.currentAttributes_=d}else c=this.getCurrentAttributes_()[a]!==c?c:!1,this.setAttribute(a,c)};a.prototype.setAttribute=function(a,b){var c=this.codeMirror;this.emptySelection_()?(c=this.getCurrentAttributes_(),!1===b?delete c[a]:c[a]=b,this.currentAttributes_=c):(this.updateTextAttributes(c.indexFromPos(c.getCursor("start")),c.indexFromPos(c.getCursor("end")),function(c){!1===b?delete c[a]:
c[a]=b}),this.updateCurrentAttributes_())};a.prototype.updateTextAttributes=function(a,b,c,d,g){var h=[],n=a,t=this;this.annotationList_.updateSpan(new m(a,b-a),function(a,b){var m={},r;for(r in a.attributes)m[r]=a.attributes[r];m[q.LINE_SENTINEL]&&!g||c(m);r={};var s={};t.computeChangedAttributes_(a.attributes,m,r,s);var u;a:{for(u in r){u=!1;break a}u=!0}u||h.push({start:n,end:n+b,attributes:r,attributesInverse:s,origin:d});n+=b;return new f(m)});0<h.length&&this.trigger("attributesChange",this,
h)};a.prototype.computeChangedAttributes_=function(a,b,c,d){var f={},g;for(g in a)f[g]=!0;for(g in b)f[g]=!0;for(g in f)g in b?g in a?a[g]!==b[g]&&(c[g]=b[g],d[g]=a[g]):(c[g]=b[g],d[g]=!1):(c[g]=!1,d[g]=a[g])};a.prototype.toggleLineAttribute=function(a,b){var c=this.getCurrentLineAttributes_();this.setLineAttribute(a,a in c&&c[a]===b?!1:b)};a.prototype.setLineAttribute=function(a,b){this.updateLineAttributesForSelection(function(c){!1===b?delete c[a]:c[a]=b})};a.prototype.updateLineAttributesForSelection=
function(a){var b=this.codeMirror,c=b.getCursor("start"),d=b.getCursor("end"),c=c.line,f=d.line,b=b.getLine(f),d=this.areLineSentinelCharacters_(b.substr(0,d.ch));f>c&&d&&f--;this.updateLineAttributes(c,f,a)};a.prototype.updateLineAttributes=function(a,b,c){for(;a<=b;a++){var d=this.codeMirror.getLine(a),f=this.codeMirror.indexFromPos({line:a,ch:0});d[0]!==t?(d={},d[q.LINE_SENTINEL]=!0,c(d),this.insertText(f,t,d)):this.updateTextAttributes(f,f+1,c,null,!0)}};a.prototype.replaceText=function(a,b,c,
d,f){this.changeId_++;var g="cmrt-"+this.changeId_;this.outstandingChanges_[g]={origOrigin:f,attributes:d};d=this.codeMirror;a=d.posFromIndex(a);b="number"===typeof b?d.posFromIndex(b):null;d.replaceRange(c,a,b,g)};a.prototype.insertText=function(a,b,c,d){var f=this.codeMirror,g=f.getCursor(),h="RTCMADAPTER"==d&&!f.somethingSelected()&&a==f.indexFromPos(g);this.replaceText(a,null,b,c,d);h&&f.setCursor(g)};a.prototype.removeText=function(a,b,c){var d=this.codeMirror;d.replaceRange("",d.posFromIndex(a),
d.posFromIndex(b),c)};a.prototype.insertEntityAtCursor=function(a,b,c){var d=this.codeMirror,d=d.indexFromPos(d.getCursor("head"));this.insertEntityAt(d,a,b,c)};a.prototype.insertEntityAt=function(a,b,d,f){this.insertEntity_(a,new c.Entity(b,d),f)};a.prototype.insertEntity_=function(a,b,c){this.replaceText(a,null,x,b.toAttributes(),c)};a.prototype.getAttributeSpans=function(a,b){for(var c=[],d=this.annotationList_.getAnnotatedSpansForSpan(new m(a,b-a)),f=0;f<d.length;f++)c.push({length:d[f].length,
attributes:d[f].annotation.attributes});return c};a.prototype.end=function(){var a=this.codeMirror.lineCount()-1;return this.codeMirror.indexFromPos({line:a,ch:this.codeMirror.getLine(a).length})};a.prototype.getRange=function(a,b){var c=this.codeMirror.posFromIndex(a),d=this.codeMirror.posFromIndex(b);return this.codeMirror.getRange(c,d)};a.prototype.initAnnotationList_=function(){var a=this.end();0!==a&&this.annotationList_.insertAnnotatedSpan(new m(0,a),new f)};a.prototype.onAnnotationsChanged_=
function(a,b){var c,d={};this.tryToUpdateEntitiesInPlace(a,b);for(var f=0;f<a.length;f++)q.LINE_SENTINEL in a[f].annotation.attributes&&(d[this.codeMirror.posFromIndex(a[f].pos).line]=!0),(c=a[f].getAttachedObject())&&c.clear();for(f=0;f<b.length;f++){var g=b[f].annotation,h=q.LINE_SENTINEL in g.attributes,m=q.ENTITY_SENTINEL in g.attributes;c=this.codeMirror.posFromIndex(b[f].pos);h?d[c.line]=!0:m?this.markEntity_(b[f]):(g=this.getClassNameForAttributes_(g.attributes),""!==g&&(h=this.codeMirror.posFromIndex(b[f].pos+
b[f].length),c=this.codeMirror.markText(c,h,{className:g}),b[f].attachObject(c)))}for(var n in d)this.dirtyLines_.push(this.codeMirror.getLineHandle(Number(n))),this.queueLineMarking_()};a.prototype.tryToUpdateEntitiesInPlace=function(a,b){for(var c=a.length;c--;)for(var d=a[c],f=b.length;f--;){var g=b[f];if(d.pos==g.pos&&d.annotation.attributes.ent&&d.annotation.attributes.ent==g.annotation.attributes.ent&&this.entityManager_.entitySupportsUpdate(g.annotation.attributes.ent)){a.splice(c,1);b.splice(f,
1);var h=d.getAttachedObject();h.update(g.annotation.attributes);g.attachObject(h)}}};a.prototype.queueLineMarking_=function(){if(null==this.lineMarkTimeout_){var a=this;this.lineMarkTimeout_=setTimeout(function(){a.lineMarkTimeout_=null;for(var b=[],c=0;c<a.dirtyLines_.length;c++){var d=a.codeMirror.getLineNumber(a.dirtyLines_[c]);b.push(Number(d))}a.dirtyLines_=[];b.sort(function(a,b){return a-b});d=-1;for(c=0;c<b.length;c++){var f=b[c];f>d&&(d=a.markLineSentinelCharactersForChangedLines_(f,f))}},
0)}};a.prototype.addStyleWithCSS_=function(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a));b.appendChild(c)};a.prototype.getClassNameForAttributes_=function(a){var b="",d;for(d in a){var f=a[d];if(d===q.LINE_SENTINEL)c.utils.assert(!0===f,"LINE_SENTINEL attribute should be true if it exists.");else{var g=(this.options_.cssPrefix||"cmrt-")+d;if(!0!==f){d===q.FONT_SIZE&&
"string"!==typeof f&&(f+="px");var h=f.toString().toLowerCase().replace(/[^a-z0-9-_]/g,"-"),g=g+("-"+h);u[d]&&(w[d]||(w[d]={}),w[d][h]||(w[d][h]=!0,h=u[d],f="function"===typeof h?h(f):h+": "+f,this.addStyleWithCSS_((d==q.LINE_INDENT?"pre."+g:"."+g)+" { "+f+" }")))}b=b+" "+g}}return b};a.prototype.markEntity_=function(a){for(var b=c.Entity.fromAttributes(a.annotation.attributes),d=this.codeMirror,f=this,g=[],h=0;h<a.length;h++){var m=d.posFromIndex(a.pos+h),n=d.posFromIndex(a.pos+h+1),q={collapsed:!0,
atomic:!0,inclusiveLeft:!1,inclusiveRight:!1},t=this.createEntityHandle_(b,a.pos),u=this.entityManager_.renderToElement(b,t);u&&(q.replacedWith=u);m=d.markText(m,n,q);g.push(m);t.setMarker(m)}a.attachObject({clear:function(){for(var a=0;a<g.length;a++)g[a].clear()},update:function(a){a=c.Entity.fromAttributes(a);for(var b=0;b<g.length;b++)f.entityManager_.updateElement(a,g[b].replacedWith)}});this.queueRefresh_()};a.prototype.queueRefresh_=function(){var a=this;this.refreshTimer_||(this.refreshTimer_=
setTimeout(function(){a.codeMirror.refresh();a.refreshTimer_=null},0))};a.prototype.createEntityHandle_=function(a,b){function d(){if(f){var a=f.find();return a?g.codeMirror.indexFromPos(a.from):null}return b}var f=null,g=this;return{find:d,remove:function(){var a=d();null!=a&&(g.codeMirror.focus(),g.removeText(a,a+1))},replace:function(b){var f=c.AttributeConstants.ENTITY_SENTINEL,h=f+"_",m=d();g.updateTextAttributes(m,m+1,function(c){for(var d in c)delete c[d];c[f]=a.type;for(var g in b)c[h+g]=
b[g]})},setMarker:function(a){f=a}}};a.prototype.lineClassRemover_=function(a){var b=this.codeMirror,c=b.getLineHandle(a);return{clear:function(){b.removeLineClass(c,"text",".*")}}};a.prototype.emptySelection_=function(){var a=this.codeMirror.getCursor("start"),b=this.codeMirror.getCursor("end");return a.line===b.line&&a.ch===b.ch};a.prototype.onCodeMirrorBeforeChange_=function(a,b){if("+input"===b.origin||"paste"===b.origin){for(var c=[],d=0;d<b.text.length;d++){var f=b.text[d],f=f.replace(new RegExp("["+
t+x+"]","g"),"");c.push(f)}b.update(b.from,b.to,c)}};a.prototype.onCodeMirrorChange_=function(a,b){if("object"===typeof b.from){for(var c=[];b;)c.push(b),b=b.next;b=c}for(var c=this.convertCoordinateSystemForChanges_(b),d=[],g=0;g<c.length;g++){var h=c[g],n=h.start,q=h.text,t=h.removed,u=h.origin;if(0<t.length){for(var w=this.annotationList_.getAnnotatedSpansForSpan(new m(n,t.length)),x=0,W=0;W<w.length;W++){var U=w[W];d.push({start:n,end:n+U.length,removedAttributes:U.annotation.attributes,removed:t.substr(x,
U.length),attributes:{},text:"",origin:h.origin});x+=U.length}this.annotationList_.removeSpan(new m(n,t.length))}0<q.length&&("+input"===h.origin||"paste"===h.origin?h=this.currentAttributes_||{}:u in this.outstandingChanges_?(h=this.outstandingChanges_[u].attributes,u=this.outstandingChanges_[u].origOrigin,delete this.outstandingChanges_[u]):h={},this.annotationList_.insertAnnotatedSpan(new m(n,q.length),new f(h)),d.push({start:n,end:n,removedAttributes:{},removed:"",text:q,attributes:h,origin:u}))}this.markLineSentinelCharactersForChanges_(b);
0<d.length&&this.trigger("change",this,d)};a.prototype.convertCoordinateSystemForChanges_=function(a){function c(a,f){return function(c){if(0>=b(c,f.from))return a(c);if(0>=b(f.to,c)){var g=c.line+f.text.length-1-(f.to.line-f.from.line);if(f.to.line<c.line)c=c.ch;else if(1>=f.text.length)c=c.ch-(f.to.ch-f.from.ch)+d(f.text);else{var h=f.text;c=c.ch-f.to.ch+h[h.length-1].length}return a({line:g,ch:c})+d(f.removed)-d(f.text)}return f.from.line===c.line?a(f.from)+c.ch-f.from.ch:a(f.from)+d(f.removed.slice(0,
c.line-f.from.line))+1+c.ch}}for(var f=this,g=function(a){return f.codeMirror.indexFromPos(a)},h=[],m=a.length-1;0<=m;m--){var n=a[m],g=c(g,n),q=g(n.from),t=n.removed.join("\n"),u=n.text.join("\n");h.unshift({start:q,end:q+t.length,removed:t,text:u,origin:n.origin})}return h};a.prototype.markLineSentinelCharactersForChanges_=function(a){for(var b=Number.MAX_VALUE,c=-1,d=0;d<a.length;d++){var f=a[d],g=f.from.line;if(1<f.removed.length||0<=f.removed[0].indexOf(t))b=Math.min(b,g),c=Math.max(c,g);1<f.text.length?
(b=Math.min(b,g),c=Math.max(c,g+f.text.length-1)):0<=f.text[0].indexOf(t)&&(b=Math.min(b,g),c=Math.max(c,g))}c=Math.min(c,this.codeMirror.lineCount()-1);this.markLineSentinelCharactersForChangedLines_(b,c)};a.prototype.markLineSentinelCharactersForChangedLines_=function(a,b){if(a<Number.MAX_VALUE)for(;0<a&&this.lineIsListItemOrIndented_(a-1);)a--;if(-1<b)for(var c=this.codeMirror.lineCount();b+1<c&&this.lineIsListItemOrIndented_(b+1);)b++;for(var c=[],d=this.codeMirror,f=a;f<=b;f++){var g=d.getLine(f),
h=d.getLineHandle(f);d.removeLineClass(h,"text",".*");if(0<g.length)for(h=g.indexOf(t);0<=h;){for(var m=h;h<g.length&&g[h]===t;){for(var n=d.findMarksAt({line:f,ch:h}),q=0;q<n.length;q++)n[q].isForLineSentinel&&n[q].clear();h++}this.markLineSentinelCharacters_(f,m,h,c);h=g.indexOf(t,h)}else c=[]}return b};a.prototype.markLineSentinelCharacters_=function(a,b,c,d){var f=this.codeMirror,g=null,h=null,m=function(){var a=h.find();return a?a.from.line:null};if(0===b){var n=this.getLineAttributes_(a),t=
n[q.LIST_TYPE],u=n[q.LINE_INDENT]||0;for(t&&0===u&&(u=1);u>=d.length;)d.push(1);"o"===t?(g=this.makeOrderedListElement_(d[u]),d[u]++):"u"===t?(g=this.makeUnorderedListElement_(),d[u]=1):"t"===t?(g=this.makeTodoListElement_(!1,m),d[u]=1):"tc"===t&&(g=this.makeTodoListElement_(!0,m),d[u]=1);m=this.getClassNameForAttributes_(n);""!==m&&this.codeMirror.addLineClass(a,"text",m);d=d.slice(0,u+1)}d={inclusiveLeft:!0,collapsed:!0};g&&(d.replacedWith=g);h=f.markText({line:a,ch:b},{line:a,ch:c},d);h.isForLineSentinel=
!0};a.prototype.makeOrderedListElement_=function(a){return n.elt("div",a+".",{"class":"vceditor-list-left"})};a.prototype.makeUnorderedListElement_=function(){return n.elt("div","\u2022",{"class":"vceditor-list-left"})};a.prototype.toggleTodo=function(a){var b=q.LIST_TYPE,c=this.getCurrentLineAttributes_(),d;b in c&&("t"===c[b]||"tc"===c[b])?"t"===c[b]?d="tc":"tc"===c[b]&&(d=a?"t":!1):d="t";this.setLineAttribute(b,d)};a.prototype.makeTodoListElement_=function(a,b){var c={type:"checkbox","class":"vceditor-todo-left"};
a&&(c.checked=!0);var c=n.elt("input",!1,c),d=this;n.on(c,"click",n.stopEventAnd(function(a){d.codeMirror.setCursor({line:b(),ch:1});d.toggleTodo(!0)}));return c};a.prototype.lineIsListItemOrIndented_=function(a){a=this.getLineAttributes_(a);return!1!==(a[q.LIST_TYPE]||!1)||0!==(a[q.LINE_INDENT]||0)};a.prototype.onCursorActivity_=function(){var a=this;clearTimeout(a.cursorTimeout);a.cursorTimeout=setTimeout(function(){a.updateCurrentAttributes_()},1)};a.prototype.getCurrentAttributes_=function(){this.currentAttributes_||
this.updateCurrentAttributes_();return this.currentAttributes_};a.prototype.updateCurrentAttributes_=function(){var a=this.codeMirror,b=a.indexFromPos(a.getCursor("anchor")),d=a.indexFromPos(a.getCursor("head")),a=d;if(b>d){for(;a<this.end();){b=this.getRange(a,a+1);if("\n"!==b&&b!==t)break;a++}a<this.end()&&a++}else for(;0<a;){b=this.getRange(a-1,a);if("\n"!==b&&b!==t)break;a--}b=this.annotationList_.getAnnotatedSpansForPos(a);this.currentAttributes_={};a={};0<b.length&&!(q.LINE_SENTINEL in b[0].annotation.attributes)?
a=b[0].annotation.attributes:1<b.length&&(c.utils.assert(!(q.LINE_SENTINEL in b[1].annotation.attributes),"Cursor can't be between two line sentinel characters."),a=b[1].annotation.attributes);for(var f in a)"l"!==f&&"lt"!==f&&"li"!==f&&0!==f.indexOf(q.ENTITY_SENTINEL)&&(this.currentAttributes_[f]=a[f])};a.prototype.getCurrentLineAttributes_=function(){var a=this.codeMirror,b=a.getCursor("anchor"),a=a.getCursor("head"),c=a.line;0===a.ch&&b.line<a.line&&c--;return this.getLineAttributes_(c)};a.prototype.getLineAttributes_=
function(a){var b={},d=this.codeMirror.getLine(a);if(0<d.length&&d[0]===t){a=this.codeMirror.indexFromPos({line:a,ch:0});a=this.annotationList_.getAnnotatedSpansForSpan(new m(a,1));c.utils.assert(1===a.length);for(var f in a[0].annotation.attributes)b[f]=a[0].annotation.attributes[f]}return b};a.prototype.clearAnnotations_=function(){this.annotationList_.updateSpan(new m(0,this.end()),function(a,b){return new f({})})};a.prototype.newline=function(){var a=this.codeMirror,b=this;if(this.emptySelection_()){var c=
a.getCursor("head").line,d=this.getLineAttributes_(c),f=d[q.LIST_TYPE];f&&1===a.getLine(c).length?this.updateLineAttributes(c,c,function(a){delete a[q.LIST_TYPE];delete a[q.LINE_INDENT]}):(a.replaceSelection("\n","end","+input"),this.updateLineAttributes(c+1,c+1,function(a){for(var g in d)a[g]=d[g];"tc"===f&&(a[q.LIST_TYPE]="t");b.trigger("newLine",{line:c+1,attr:a})}))}else a.replaceSelection("\n","end","+input")};a.prototype.deleteLeft=function(){var a=this.codeMirror,b=a.getCursor("head"),c=this.getLineAttributes_(b.line),
d=c[q.LIST_TYPE],c=c[q.LINE_INDENT],f=this.emptySelection_()&&1===b.ch;f&&d?this.updateLineAttributes(b.line,b.line,function(a){delete a[q.LIST_TYPE];delete a[q.LINE_INDENT]}):f&&c&&0<c?this.updateLineAttributes(b.line,b.line,function(a){a[q.LINE_INDENT]--}):a.deleteH(-1,"char")};a.prototype.deleteRight=function(){var a=this.codeMirror,b=a.getCursor("head"),c=a.getLine(b.line),c=this.areLineSentinelCharacters_(c),d=b.line+1<a.lineCount()?a.getLine(b.line+1):"";this.emptySelection_()&&c&&d[0]===t?
a.replaceRange("",{line:b.line,ch:0},{line:b.line+1,ch:0},"+input"):a.deleteH(1,"char")};a.prototype.indent=function(){this.updateLineAttributesForSelection(function(a){var b=a[q.LIST_TYPE];a[q.LINE_INDENT]?a[q.LINE_INDENT]++:a[q.LINE_INDENT]=b?2:1})};a.prototype.unindent=function(){this.updateLineAttributesForSelection(function(a){var b=a[q.LINE_INDENT];b&&1<b?a[q.LINE_INDENT]=b-1:(delete a[q.LIST_TYPE],delete a[q.LINE_INDENT])})};a.prototype.getText=function(){return this.codeMirror.getValue().replace(new RegExp(t,
"g"),"")};a.prototype.areLineSentinelCharacters_=function(a){for(var b=0;b<a.length;b++)if(a[b]!==t)return!1;return!0};f.prototype.equals=function(a){if(!(a instanceof f))return!1;for(var b in this.attributes)if(a.attributes[b]!==this.attributes[b])return!1;for(b in a.attributes)if(a.attributes[b]!==this.attributes[b])return!1;return!0};return a}();c=c||{};c.RichTextCodeMirrorAdapter=window.RichTextCodeMirrorAdapter;c=c||{};c.Formatting=function(){function a(b){if(!(this instanceof a))return new a(b);
this.attributes=b||{}}var b=c.AttributeConstants;a.prototype.cloneWithNewAttribute_=function(b,c){var g={},h;for(h in this.attributes)g[h]=this.attributes[h];!1===c?delete g[b]:g[b]=c;return new a(g)};a.prototype.bold=function(a){return this.cloneWithNewAttribute_(b.BOLD,a)};a.prototype.italic=function(a){return this.cloneWithNewAttribute_(b.ITALIC,a)};a.prototype.underline=function(a){return this.cloneWithNewAttribute_(b.UNDERLINE,a)};a.prototype.strike=function(a){return this.cloneWithNewAttribute_(b.STRIKE,
a)};a.prototype.font=function(a){return this.cloneWithNewAttribute_(b.FONT,a)};a.prototype.fontSize=function(a){return this.cloneWithNewAttribute_(b.FONT_SIZE,a)};a.prototype.color=function(a){return this.cloneWithNewAttribute_(b.COLOR,a)};a.prototype.backgroundColor=function(a){return this.cloneWithNewAttribute_(b.BACKGROUND_COLOR,a)};return a}();c=c||{};c.Text=function(){function a(b,d){if(!(this instanceof a))return new a(b,d);this.text=b;this.formatting=d||c.Formatting()}return a}();c.LineFormatting=
window.LineFormatting;c.Line=function(){function a(b,d){if(!(this instanceof a))return new a(b,d);"[object Array]"!==Object.prototype.toString.call(b)&&(b="undefined"===typeof b?[]:[b]);this.textPieces=b;this.formatting=d||c.LineFormatting()}return a}();c.ParseHtml=window.ParseHtml;c.SerializeHtml=window.SerializeHtml;c.textPiecesToInserts=function(a,b){function d(b,d){b instanceof c.Text&&(d=b.formatting.attributes,b=b.text);g.push({string:b,attributes:d});a="\n"===b[b.length-1]}function f(b){a&&
d(c.sentinelConstants.LINE_SENTINEL_CHARACTER,b.formatting.attributes);for(var f=0;f<b.textPieces.length;f++)d(b.textPieces[f]);d("\n")}for(var g=[],h=0;h<b.length;h++)b[h]instanceof c.Line?f(b[h]):d(b[h]);return g};c=c||{};c.Vceditor=function(a){function b(a,c,f,g){if(!(this instanceof b))return new b(a,c,f,g);if(!r&&!s)throw Error("Couldn't find CodeMirror or ACE.  Did you forget to include codemirror.js or ace.js?");if(r&&c instanceof r)this.codeMirror_=this.editor_=c,a=this.codeMirror_.getValue(),
""!==a&&console.log("Can't initialize Vceditor with a CodeMirror instance that already contains text.");else if(s&&c&&c.session instanceof s.EditSession){if(this.ace_=this.editor_=c,a=this.ace_.getValue(),""!==a)throw Error("Can't initialize Vceditor with an ACE instance that already contains text.");}else this.codeMirror_=this.editor_=new r(c);a=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.vcEditorWrapper_=x.elt("div",null,{"class":"vceditor"});a.parentNode.replaceChild(this.vcEditorWrapper_,
a);this.vcEditorWrapper_.appendChild(a);x.on(a,"dragstart",x.stopEvent);this.editor_.vceditor=this;this.options_=f||{};this.getOption("richTextShortcuts",!1)&&(r.keyMap.richtext||this.initializeKeyMap_(),this.codeMirror_.setOption("keyMap","richtext"),this.vcEditorWrapper_.className+=" vceditor-richtext");this.imageInsertionUI=this.getOption("imageInsertionUI",!0);this.getOption("richTextToolbar",!1)&&(this.addToolbar_(),this.vcEditorWrapper_.className+=" vceditor-richtext vceditor-with-toolbar");
this.addPoweredByLogo_();this.codeMirror_&&this.codeMirror_.refresh();this.getOption("userColor",d("JqrwCaZm29-CLg-Pfz2"));this.entityManager_=new w;a=g.revision;c=[];this.codeMirror_?(this.richTextCodeMirror_=new m(this.codeMirror_,this.entityManager_,{cssPrefix:"vceditor-"}),this.editorAdapter_=new h(this.richTextCodeMirror_)):this.editorAdapter_=new q(this.ace_);f.hasOwnProperty("richTextToolbar")?(virtualclass.editorRich.vcAdapter=new otAdapter(g,"EditorRich"),virtualclass.editorRich.cmClient=
new u(a,c,virtualclass.editorRich.vcAdapter,this.editorAdapter_)):(virtualclass.editorCode.vcAdapter=new otAdapter(g,"EditorCode"),virtualclass.editorCode.cmClient=new u(a,c,virtualclass.editorCode.vcAdapter,this.editorAdapter_));"Microsoft Internet Explorer"==navigator.appName&&navigator.userAgent.match(/MSIE 8\./)&&(window.onload=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css";b.styleSheet.cssText=":before,:after{content:none !important;}";
a.appendChild(b);setTimeout(function(){a.removeChild(b)},0)})}function d(a){for(var b=1,c=0;c<a.length;c++)b=17*(b+a.charCodeAt(c))%360;return g(b/360,1,.85)}function f(a,b,c){function d(a){a=Math.round(255*a).toString(16);return 1===a.length?"0"+a:a}return"#"+d(a)+d(b)+d(c)}function g(a,b,c){if(0===b)return f(c,c,c);var d=.5>c?c*(1+b):c+b-b*c,g=2*c-d;b=function(a){0>a&&(a+=1);1<a&&(a-=1);return 1>6*a?g+6*(d-g)*a:1>2*a?d:2>3*a?g+6*(d-g)*(2/3-a):g};return f(b(a+1/3),b(a),b(a-1/3))}if(!c.RichTextCodeMirrorAdapter)throw Error("Oops! It looks like you're trying to include lib/vceditor.js directly.  This is actually one of many source files that make up vceditor.  You want dist/vceditor.js instead.");
var h=c.RichTextCodeMirrorAdapter,m=c.RichTextCodeMirror,n=c.RichTextToolbar,q=c.ACEAdapter,u=c.EditorClient,w=c.EntityManager,t=c.AttributeConstants,x=c.utils,r=a.CodeMirror,s=a.ace;x.makeEventEmitter(b);b.fromCodeMirror=b;b.fromACE=b;b.prototype.dispose=function(){this.zombie_=!0;var a=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.vcEditorWrapper_.removeChild(a);this.vcEditorWrapper_.parentNode.replaceChild(a,this.vcEditorWrapper_);this.editor_.vceditor=null;this.codeMirror_&&
"richtext"===this.codeMirror_.getOption("keyMap")&&this.codeMirror_.setOption("keyMap","default");this.vcAdapter.dispose();this.editorAdapter_.detach();this.richTextCodeMirror_&&this.richTextCodeMirror_.detach()};b.prototype.setUserId=function(a){this.vcAdapter.setUserId(a)};b.prototype.setUserColor=function(a){this.vcAdapter.setColor(a)};b.prototype.getText=function(){this.assertReady_("getText");return this.codeMirror_?this.richTextCodeMirror_.getText():this.ace_.getSession().getDocument().getValue()};
b.prototype.setText=function(a){if(this.ace_)return this.ace_.getSession().getDocument().setValue(a);this.codeMirror_.getWrapperElement().setAttribute("style","display: none");this.codeMirror_.setValue("");this.insertText(0,a);this.codeMirror_.getWrapperElement().setAttribute("style","");this.codeMirror_.refresh()};b.prototype.insertTextAtCursor=function(a){this.insertText(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),a)};b.prototype.insertText=function(a,b){x.assert(!this.ace_,"Not supported for ace yet.");
this.assertReady_("insertText");"[object Array]"!==Object.prototype.toString.call(b)&&(b=[b]);for(var d=c.textPiecesToInserts(0===a,b),f=0;f<d.length;f++){var g=d[f].string;this.richTextCodeMirror_.insertText(a,g,d[f].attributes);a+=g.length}};b.prototype.getOperationForSpan=function(a,b){for(var d=this.richTextCodeMirror_.getRange(a,b),f=this.richTextCodeMirror_.getAttributeSpans(a,b),g=0,h=new c.TextOperation,m=0;m<f.length;m++)h.insert(d.substr(g,f[m].length),f[m].attributes),g+=f[m].length;return h};
b.prototype.getHtml=function(){return this.getHtmlFromRange(null,null)};b.prototype.getHtmlFromSelection=function(){var a=this.codeMirror_.getCursor("start"),b=this.codeMirror_.getCursor("end"),a=this.codeMirror_.indexFromPos(a),b=this.codeMirror_.indexFromPos(b);return this.getHtmlFromRange(a,b)};b.prototype.getHtmlFromRange=function(a,b){var d=null!=a&&null!=b?this.getOperationForSpan(a,b):this.getOperationForSpan(0,this.codeMirror_.getValue().length);return c.SerializeHtml(d,this.entityManager_)};
b.prototype.insertHtml=function(a,b){var d=c.ParseHtml(b,this.entityManager_);this.insertText(a,d)};b.prototype.insertHtmlAtCursor=function(a){this.insertHtml(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),a)};b.prototype.setHtml=function(a){a=c.ParseHtml(a,this.entityManager_);this.setText(a)};b.prototype.isHistoryEmpty=function(){this.assertReady_("isHistoryEmpty");return this.vcAdapter.isHistoryEmpty()};b.prototype.bold=function(){this.richTextCodeMirror_.toggleAttribute(t.BOLD);this.codeMirror_.focus()};
b.prototype.italic=function(){this.richTextCodeMirror_.toggleAttribute(t.ITALIC);this.codeMirror_.focus()};b.prototype.underline=function(){this.richTextCodeMirror_.toggleAttribute(t.UNDERLINE);this.codeMirror_.focus()};b.prototype.strike=function(){this.richTextCodeMirror_.toggleAttribute(t.STRIKE);this.codeMirror_.focus()};b.prototype.fontSize=function(a){this.richTextCodeMirror_.setAttribute(t.FONT_SIZE,a);this.codeMirror_.focus()};b.prototype.font=function(a){this.richTextCodeMirror_.setAttribute(t.FONT,
a);this.codeMirror_.focus()};b.prototype.color=function(a){this.richTextCodeMirror_.setAttribute(t.COLOR,a);this.codeMirror_.focus()};b.prototype.highlight=function(){this.richTextCodeMirror_.toggleAttribute(t.BACKGROUND_COLOR,"rgba(255,255,0,.65)");this.codeMirror_.focus()};b.prototype.align=function(a){if("left"!==a&&"center"!==a&&"right"!==a)throw Error('align() must be passed "left", "center", or "right".');this.richTextCodeMirror_.setLineAttribute(t.LINE_ALIGN,a);this.codeMirror_.focus()};b.prototype.orderedList=
function(){this.richTextCodeMirror_.toggleLineAttribute(t.LIST_TYPE,"o");this.codeMirror_.focus()};b.prototype.unorderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(t.LIST_TYPE,"u");this.codeMirror_.focus()};b.prototype.todo=function(){this.richTextCodeMirror_.toggleTodo();this.codeMirror_.focus()};b.prototype.newline=function(){this.richTextCodeMirror_.newline()};b.prototype.deleteLeft=function(){this.richTextCodeMirror_.deleteLeft()};b.prototype.deleteRight=function(){this.richTextCodeMirror_.deleteRight()};
b.prototype.indent=function(){this.richTextCodeMirror_.indent();this.codeMirror_.focus()};b.prototype.unindent=function(){this.richTextCodeMirror_.unindent();this.codeMirror_.focus()};b.prototype.undo=function(){this.codeMirror_.undo()};b.prototype.redo=function(){this.codeMirror_.redo()};b.prototype.insertEntity=function(a,b,c){this.richTextCodeMirror_.insertEntityAtCursor(a,b,c)};b.prototype.insertEntityAt=function(a,b,c,d){this.richTextCodeMirror_.insertEntityAt(a,b,c,d)};b.prototype.registerEntity=
function(a,b){this.entityManager_.register(a,b)};b.prototype.getOption=function(a,b){return a in this.options_?this.options_[a]:b};b.prototype.assertReady_=function(a){if(!this.ready_)throw Error('You must wait for the "ready" event before calling '+a+".");if(this.zombie_)throw Error("You can't use a Vceditor after calling dispose()!");};b.prototype.makeImageDialog_=function(){this.makeDialog_("img","Insert image url")};b.prototype.makeDialog_=function(a,b){var c=this,d=x.elt("input",null,{"class":"vceditor-dialog-input",
id:a,type:"text",placeholder:b,autofocus:"autofocus"}),f=x.elt("a","Submit",{"class":"vceditor-btn",id:"submitbtn"});x.on(f,"click",x.stopEventAnd(function(){var b=document.getElementById("overlay");b.style.visibility="hidden";var d=document.getElementById(a).value;null!==d&&c.insertEntity(a,{src:d});c.vcEditorWrapper_.removeChild(b)}));var g=x.elt("a","Cancel",{"class":"vceditor-btn"});x.on(g,"click",x.stopEventAnd(function(){var a=document.getElementById("overlay");a.style.visibility="hidden";c.vcEditorWrapper_.removeChild(a)}));
f=x.elt("div",[f,g],{"class":"vceditor-btn-group"});d=x.elt("div",[d,f],{"class":"vceditor-dialog-div"});d=x.elt("div",[d],{"class":"vceditor-dialog",id:"overlay"});this.vcEditorWrapper_.appendChild(d)};b.prototype.addToolbar_=function(){this.toolbar=new n(this.imageInsertionUI);this.toolbar.on("undo",this.undo,this);this.toolbar.on("redo",this.redo,this);this.toolbar.on("bold",this.bold,this);this.toolbar.on("italic",this.italic,this);this.toolbar.on("underline",this.underline,this);this.toolbar.on("strike",
this.strike,this);this.toolbar.on("font-size",this.fontSize,this);this.toolbar.on("font",this.font,this);this.toolbar.on("color",this.color,this);this.toolbar.on("left",function(){this.align("left")},this);this.toolbar.on("center",function(){this.align("center")},this);this.toolbar.on("right",function(){this.align("right")},this);this.toolbar.on("ordered-list",this.orderedList,this);this.toolbar.on("unordered-list",this.unorderedList,this);this.toolbar.on("todo-list",this.todo,this);this.toolbar.on("indent-increase",
this.indent,this);this.toolbar.on("indent-decrease",this.unindent,this);this.toolbar.on("insert-image",this.makeImageDialog_,this);this.vcEditorWrapper_.insertBefore(this.toolbar.element(),this.vcEditorWrapper_.firstChild)};b.prototype.addPoweredByLogo_=function(){};b.prototype.initializeKeyMap_=function(){function a(b){return function(a){setTimeout(function(){b.call(a.vceditor)},0)}}this.getOption("readOnly")?r.keyMap.richtext={fallthrough:["default"]}:r.keyMap.richtext={"Ctrl-B":a(this.bold),"Cmd-B":a(this.bold),
"Ctrl-I":a(this.italic),"Cmd-I":a(this.italic),"Ctrl-U":a(this.underline),"Cmd-U":a(this.underline),"Ctrl-H":a(this.highlight),"Cmd-H":a(this.highlight),Enter:a(this.newline),Delete:a(this.deleteRight),Backspace:a(this.deleteLeft),Tab:a(this.indent),"Shift-Tab":a(this.unindent),fallthrough:["default"]}};return b}(this);c.Vceditor.Formatting=c.Formatting;c.Vceditor.Text=c.Text;c.Vceditor.Entity=c.Entity;c.Vceditor.LineFormatting=c.LineFormatting;c.Vceditor.Line=c.Line;c.Vceditor.TextOperation=c.TextOperation;
c.Vceditor.RichTextCodeMirrorAdapter=c.RichTextCodeMirrorAdapter;c.Server=Server;c.Vceditor.getvcEditor=function(){return c};return c.Vceditor}();window.Vceditor=Vceditor;(function(c){var a=function(a){return a.map(function(a){return{operation:a.wrapped.toJSON()}})},b=function(a){var b=Vceditor.getvcEditor();return a.map(function(a){return new b.WrappedOperation(b.TextOperation.fromJSON(a.operation),a.cursor&&b.Cursor.fromJSON(a.cursor))})};c.editor=function(c,f,g){this.etype=c;if("editorRich"==c)var h={lineWrapping:!0},m={richTextToolbar:!0,richTextShortcuts:!0,readOnly:!1};else h={lineNumbers:!0,mode:"markdown",readOnly:!1},m={defaultText:"Markdown Editor "};return{etype:c,
cm:"",vcAdapter:"",initialised:!1,prvEdRev:0,dataReqTry:0,stroageData:localStorage.getItem(this.etype+"_allEditorOperations"),tempstroageDataRev:localStorage.getItem(this.etype+"_edOperationRev"),readonly:!1,veryInit:function(){if(null!=this.stroageData&&""!=this.stroageData){this.stroageDataRev=null==this.tempstroageDataRev?0:this.tempstroageDataRev;var a=JSON.parse(this.stroageData),a=JSON.parse(a.data);console.log("Current Editor type "+virtualclass.currAppEditorType);virtualclass.hasOwnProperty("currAppEditor")?
virtualclass.currAppEditorType==this.etype?this.initialiseDataWithEditor(a,"displayEditor",virtualclass.currAppEditorType):this.initialiseDataWithEditor(a):this.initialiseDataWithEditor(a)}virtualclass.gObj.editorInitDone++},init:function(a,b,c,d){var f={};"undefined"!=typeof a&&(f.revision=a);"undefined"!=typeof b&&(f.clients=b);"undefined"!=typeof c&&(f.doc=c);"undefined"!=typeof d&&(f.operations=d);this.cm||"object"==typeof this.cm?virtualclass.dispvirtualclassLayout(virtualclass.currApp):(this.codemirrorWithLayout(h),
this.createEditorClient(m,f));roles.hasControls()?(roles.hasAdmin()&&this.createAllEditorController(),ioAdapter.mustSendAll({eddata:"init",et:this.etype,cf:"eddata"})):roles.hasAdmin()&&this.createAllEditorController()},createAllEditorController:function(){var a=this.etype,b="all"+a+"Container";if(null==document.getElementById(b)){console.log("For Enable all, Button is creating");var c="enable",d=document.createElement("div");d.id=b;d["class"]="editorController";var f=document.createElement("a");
f.id=d.id+"Anch";f.href="#";f.innerHTML="Enable All";f.dataset.action=c;d.appendChild(f);a=virtualclass.vutil.capitalizeFirstLetter(a);document.getElementById("virtualclass"+a+"Body").appendChild(d);f.addEventListener("click",function(){var d=document.getElementById(b+"Anch");null!=d&&(c=d.dataset.action,"enable"==d.dataset.action?(d.dataset.action="disable",d.innerHTML="Disable All"):(d.dataset.action="enable",d.innerHTML="Enable All"));virtualclass.user.control.toggleAllEditorController.call(virtualclass.user,
a,c)})}},removeScrollFromFireFox:function(a){a=virtualclass.vutil.capitalizeFirstLetter(a);setTimeout(function(){var b=document.querySelector("#virtualclass"+a+"Body .CodeMirror-vscrollbar"),c=document.querySelector("#virtualclass"+a+"Body .CodeMirror"),d=document.querySelector("#virtualclass"+a+"Body .CodeMirror-code");b.style.display=d.offsetHeight>c.offsetHeight-25?"block":""},20)},createEditorClient:function(a,b){roles.hasAdmin()&&(this.cm.setOption("readOnly",!1),this.createAllEditorController(),
a.readOnly=!1);virtualclass.isPlayMode&&(this.readOnlyMode("enable","notCreateSyncBox"),this.cm.setOption("readOnly","nocursor"));Vceditor.fromCodeMirror({},this.cm,a,b);"Firefox"==virtualclass.system.mybrowser.detection()[0]&&this.removeScrollFromFireFox(this.etype)},disableEditorByOuterLayer:function(){var a=document.querySelector("#virtualclass"+virtualclass.vutil.capitalizeFirstLetter(this.etype)+"Body .CodeMirror.cm-s-default");null!=a&&(a.style.pointerEvents="none");console.log("Disable editor for ios")},
enableEditorByOuterLayer:function(){var a=document.querySelector("#virtualclass"+virtualclass.vutil.capitalizeFirstLetter(this.etype)+"Body .CodeMirror.cm-s-default");null!=a&&(a.style.pointerEvents="visible");console.log("Enable editor for ios")},codemirrorWithLayout:function(a){this.UI.container(this.etype);document.getElementById(this.UI.edId);"object"!=typeof this.cm&&(console.log("Code mirror instance is created "),this.cm=CodeMirror(document.getElementById(this.UI.edId),a))},requestData:function(){var a=
virtualclass.vutil.whoIsTeacher();this.readOnlyMode("enable");ioAdapter.mustSendUser({eddata:"requestForEditorData",et:this.etype,cf:"eddata"},a)},readOnlyMode:function(a,b){"object"==typeof this.cm&&("enable"==a?this.readonly||(this.cm.setOption("readOnly","nocursor"),"undefined"==typeof b&&this.UI.createSynchMessageBox(),this.readonly="nocursor"):this.readonly&&!virtualclass.isPlayMode&&(this.cm.setOption("readOnly",!1),this.readonly=!1,this.UI.hideSynchMessageBox()),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(virtualclass.vutil.smallizeFirstLetter(this.etype)))},
isVcAdapterIsReady:function(a){return virtualclass[a].hasOwnProperty("vcAdapter")&&"object"==typeof virtualclass[a].vcAdapter},receivedOperations:{currAppEditor:function(a){a.fromUser.userid!=virtualclass.gObj.userid&&(console.log("curr app editor"),virtualclass.currAppEditor=!0,virtualclass.currAppEditorType=a.message.et,virtualclass.dispvirtualclassLayout(virtualclass.currAppEditorType))},init:function(a,b){"s"==a.fromUser.role||a.fromUser.userid==virtualclass.gObj.uid&&"1"!=wbUser.virtualclassPlay||
virtualclass.makeAppReady(b)},initVcEditor:function(a){console.log("received whole data");roles.hasView()&&"function"==typeof virtualclass[a.message.et].vcAdapter.removeOperations&&virtualclass[a.message.et].vcAdapter.removeOperations(a);if(!roles.hasControls()||roles.hasControls()&&a.fromUser.userid!=virtualclass.gObj.uid&&(a.message.hasOwnProperty("resFromUser")||a.message.hasOwnProperty("allEdData"))){var b=JSON.parse(a.message.data);a.message.hasOwnProperty("layoutEd")?this.initialiseDataWithEditor(b,
a.message):this.initialiseDataWithEditor(b)}},requestForEditorData:function(a){a.fromUser.userid!=virtualclass.gObj.uid?"object"!=typeof this.vcAdapter||0==this.vcAdapter.operations.length?ioAdapter.mustSendAll({eddata:"noDataForEditor",cf:"eddata"}):this.responseToRequest(a.fromUser.userid):console.log("Cannot send requestForEditorData to self")},noDataForEditor:function(){roles.hasControls()},"virtualclass-editor-operation":function(a){"object"==typeof this.vcAdapter&&(this.readOnlyMode("disable"),
this.vcAdapter.receivedMessage(a))},"virtualclass-editor-cursor":function(a){"object"==typeof this.vcAdapter&&this.vcAdapter.receivedMessage(a)},select:function(){"object"==typeof this.vcAdapter&&this.vcAdapter.receivedMessage(e)}},onmessage:function(a,b){this.receivedOperations[a.message.eddata].call(this,a,b);"object"!=typeof this.vcAdapter&&(roles.hasAdmin()&&"virtualclass-editor-operation"==a.message.eddata&&(virtualclass.makeAppReady(b),this.vcAdapter.receivedMessage(a,onmessage)),console.log("virtualclass adapter is not ready for editor"))},
UI:{id:f,"class":"vmApp virtualclass",edId:g,container:function(a){if(null==document.getElementById(this.id)){var b=document.createElement("div");b.id=this.id;b.className=this["class"]+" "+a;a=document.createElement("div");a.id=this.edId;b.appendChild(a);a=document.getElementById(virtualclass.rWidgetConfig.id);document.getElementById(virtualclass.html.id).insertBefore(b,a)}},createSynchMessageBox:function(){if(null!=document.getElementById("synchMessageBox"))this.showSynchMessageBox();else{var a=
document.createElement("div");a.id="synchMessageBox";a.style.width="340px";a.style.height="15px";var b=document.createElement("p");b.id="readOnlyMsg";b.innerHTML=virtualclass.lang.getString("synchMessage");a.appendChild(b);b=document.getElementById(this.id);b.insertBefore(a,b.firstChild)}},showSynchMessageBox:function(){var a=document.getElementById("synchMessageBox");null!=a&&(a.style.display="block")},hideSynchMessageBox:function(){var a=document.getElementById("synchMessageBox");null!=a&&(a.style.display=
"none")}},responseToRequest:function(a){var b=this.getWrappedOperations(!0);b.layoutEd="1";roles.isTeacher()&&(b.capp=virtualclass.currApp);b.et=this.etype;a?(b.resFromUser=!0,ioAdapter.mustSendUser(b,a),console.log("Sending responseToRequest to "+a)):(b.allEdData=!0,ioAdapter.mustSend(b),console.log("Sending responseToRequest to all"),virtualclass[b.et].vcAdapter.removeOperations({message:{et:b.et}}),a=JSON.parse(b.data),virtualclass[b.et].initialiseDataWithEditor(a),virtualclass[b.et].vcAdapter.myOTrequestData=
0)},isEidtorWithTeacher:function(){return roles.hasControls()&&("EditorRich"==virtualclass.currApp||"EditorCode"==virtualclass.currApp)},getWrappedOperations:function(b){b=this.vcAdapter&&this.vcAdapter.operations?a(this.vcAdapter.operations):[];return{eddata:"initVcEditor",data:JSON.stringify({operations:b}),et:this.etype,cf:"eddata"}},getStudentAllText:function(){return this.cm.getValue("\n")},removeCodeMirror:function(){this.readonly=!1;var a=document.getElementById(this.UI.id);null!=a&&a.parentNode.removeChild(a);
this.cm=""},setReadMode:function(){var a=JSON.parse(localStorage.getItem(this.etype));roles.hasAdmin()||(null!=a?a?(this.cm.setOption("readOnly",!1),a=!0):(this.cm.setOption("readOnly","nocursor"),a=!1):(this.cm.setOption("readOnly","nocursor"),a=!1),virtualclass.user.control.toggleDisplayWriteModeMsgBox(virtualclass.vutil.capitalizeFirstLetter(this.etype),a),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(virtualclass.vutil.smallizeFirstLetter(this.etype)),"iOS"==virtualclass.system.mybrowser.name&&
virtualclass.system.isIPad()&&(a?this.enableEditorByOuterLayer():this.disableEditorByOuterLayer()))},writeBulkDocs:function(a){var c=b(a.operations);a.revision=0;if(this.cm){if(this.cm.getValue()!==a.str||""==a.str)this.vcAdapter=this.cmClient="",a.operations=[],a.doc="";this.createEditorClient(m,a);this.prvEdRev=a.revision}for(a=0;a<c.length;a++)virtualclass[this.etype].vcAdapter.server.receiveOperation(a,c[a]),this.vcAdapter.trigger("operation",c[a].wrapped.toJSON())},initialiseDataWithEditor:function(a,
c){b(a.operations);"undefined"!=typeof c&&c.hasOwnProperty("capp")&&(virtualclass.currApp=virtualclass.vutil.capitalizeFirstLetter(c.capp));this.removeCodeMirror();this.codemirrorWithLayout(h);virtualclass.dispvirtualclassLayout(virtualclass.currApp);this.writeBulkDocs(a);this.cm.refresh();this.setReadMode();var d=virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp);"EditorRich"==d||"EditorCode"==d?(virtualclass.previous="virtualclass"+virtualclass.currApp,virtualclass.system.setAppDimension(virtualclass.currApp)):
(d=document.getElementById("virtualclassEditorRich"),null!=d&&(d.style.display="none"),d=document.getElementById("virtualclassEditorCode"),null!=d&&(d.style.display="none"));d=document.getElementById("virtualclassEditorTool");null!=d&&(d.style.pointerEvents="visible");otAdapter.myrequestData=0},removeEditorData:function(){"object"==typeof this.cm&&("object"==typeof this.vcAdapter&&(this.vcAdapter.operations.length=0),this.removeCodeMirror(),localStorage.removeItem(this.etype+"_allEditorOperations"),
localStorage.removeItem(this.etype+"_edOperationRev"))},saveIntoLocalStorage:function(){if("object"==typeof this.vcAdapter&&0<this.vcAdapter.operations.length){var a=this.getWrappedOperations();localStorage.removeItem(this.etype+"_allEditorOperations");localStorage.setItem(this.etype+"_allEditorOperations",JSON.stringify(a));localStorage.setItem(this.etype+"_edOperationRev",this.cmClient.revision)}}}}})(window);(function(c,a){c.Chat=function(){return{init:function(){this.chatroombox=null;this.counter=0;this.idList=[];a.htab=[];a.htabIndex=[];this.vmstorage={};a("body").footerbar();"false"==localStorage.getItem("init")&&(a("#stickybar").removeClass("maximize").addClass("minimize"),a("#hide_bar input").removeClass("close").addClass("expand"));tabs=a("#tabs").tabs({cache:!0,activeOnAdd:!0});!1==browserSupportsLocalStorage()?alert(lang.sterror):(this.history(),this.UI.privateChatBox.init(),a("ul.tabs").on("click, focus",
"li",function(){a("li[aria-controls='"+a(this).attr("id")+"']").removeClass("ui-state-highlight")}))},history:function(){var a=null;null!=localStorage.getItem(wbUser.sid)&&(displayPvtChatHistory(),a=localStorage.getItem("chatEnable"),null!=a&&"false"==a&&virtualclass.user.control.disbaleAllChatBox(),this.vmstorage=JSON.parse(localStorage.getItem(wbUser.sid)));0<localStorage.length&&(displaycomChatHistory(),virtualclass.chat.removeChatHighLight("chatrm"),null!=a&&"false"==a&&virtualclass.user.control.disableCommonChat())},
UI:{privateChatBox:{init:function(){a("#tabs").delegate("span.icon-close","click",this.close);a("#tabs").on("click","li a",this.toggle)},close:function(){var b=a(this).closest("li").attr("id").substring(5);a("#"+b).chatbox("option").boxClosed(b);a("div#cb"+b+".ui-widget").hide();var c=a(this).closest("li").remove().attr("aria-controls");a("#"+c).remove();delete virtualclass.chat.vmstorage[b]},toggle:function(){var b=a(this).closest("li").attr("id").substring(5);a("#"+b).chatbox("toggleContentbox");
"hidden"==localStorage.getItem(b)?localStorage.removeItem(b):localStorage.setItem(b,"hidden")}}},removedPrvLoggedInDetail:function(){a(".ui-memblist").remove();a(".ui-chatbox").remove();a("div#chatrm").remove();virtualclass.chat.chatroombox=null;for(key in io.uniquesids)key!=io.cfg.userid&&(chatboxManager.delBox(key),a("li#tabcb"+key).remove());this.idList=0;a("#stickybar").removeClass("maximize").addClass("minimize");tabs.tabs("refresh")},removeCookieUserInfo:function(a){document.cookie="auth_user=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";
document.cookie="auth_pass=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";document.cookie="path=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";display_error(a.message)},makeUserListEmpty:function(){a("#user_list .inner_bt #usertab_icon").css({background:"url("+c.whiteboardPath+"images/offline.png)no-repeat top left"});a("#user_list .inner_bt #usertab_text").html("<span id='onlineusertext'>"+lang.whos+" (0) </span> <span id='usertab_toogle_icon' class='icon-arrow-up'></span>");a("#chatroom_bt .inner_bt #chatroom_text").text(lang.chatroom+
" (0)");a("div#memlist").css("display","none")},removeChatHighLight:function(a){a=document.getElementById(a);if(null!=a){a=a.getElementsByClassName("ui-state-highlight");for(var c=0;c<a.length;c++)a[c].classList.remove("ui-state-highlight")}}}}})(window,$);(function(c){c.widget("ui.footerbar",{options:{id:null,offset:0,width:"100%",barscroll:c(window).width()-430,boxClosed:function(a){}},init:function(a){this.elem=a},widget:function(){return this.uiFooterbar},_create:function(){var a=(this.uiFooterbar=c("<div></div>")).appendTo(document.getElementById("stickycontainer")).prop("id","stickybar").addClass("maximize"),b=(this.uiFooterbarchatroomtab=c("<div></div>")).addClass("vmchat_room_bt tooltip").attr("data-title",virtualclass.lang.getString("maxCommonChat")).prop("id",
"chatroom_bt2").appendTo(a),d=(this.uiFooterbarchatroomContent=c('<div class = "inner_bt"></div>')).appendTo(b);uiFooterbarchatroomIcon=(this.uiFooterbarchatroomIcon=c('<div id = "chatroom_icon"><span class="icon-chatroom"></span></div>')).appendTo(d);uiFooterbarchatroomText=(this.uiFooterbarchatroomText=c('<div id = "chatroom_text"></div>')).appendTo(d).html('Chatroom <span id="cc_arrow_button" class="icon-arrow-up"></span>').click(function(){if(virtualclass.chat.chatroombox)toggleCommonChatBox();
else if(0==c("div#chat_room").length){var a=document.createElement("div");a.id="chat_room";document.body.appendChild(a);virtualclass.chat.chatroombox=c("#chat_room").chatroom({id:"chat_room",user:{name:"test"},title:lang.chatroom_header,offset:"20px",messageSent:function(a,b){c("#chat_room").chatroom("option","boxManager").addMsg(a.name,b)}});virtualclass.gObj.hasOwnProperty("chatEnable")&&!virtualclass.gObj.chatEnable&&(a=document.getElementById("chatrm"),null!=a&&virtualclass.user.control.makeElemDisable(a));
a=document.getElementById("cc_arrow_button");a.classList.add("icon-arrow-down");a.classList.remove("icon-arrow-up");b.attr("data-title",virtualclass.lang.getString("minCommonChat"))}});uiFooterbarUserlisttab=(this.uiFooterbarUserlisttab=c("<div></div>")).addClass("vmchat_bar_button").prop("id","user_list").appendTo(a);uiFooterbarUserlistContent=(this.uiFooterbarUserlistContent=c('<div class="inner_bt"></div>')).appendTo(uiFooterbarUserlisttab);uiFooterbarUserlistIcon=(this.uiFooterbarUserlistIcon=
c('<div id="usertab_icon"></div>')).appendTo(uiFooterbarUserlistContent);uiFooterbarUserlistText=(this.uiFooterbarUserlistText=c('<div id="usertab_text" class="tooltip close " data-title="'+virtualclass.lang.getString("maxUserList")+'"></div>')).appendTo(uiFooterbarUserlistContent).text("Private Chat").click(function(){virtualclass.gObj.video.dispAllVideo("chat_div");0<Object.keys(io.uniquesids).length&&(c(this).hasClass("close")?(c(this).addClass("open"),c(this).removeClass("close"),c("#usertab_toogle_icon").addClass("icon-arrow-down"),
c("#usertab_toogle_icon").removeClass("close icon-arrow-up"),c(this).attr("data-title",virtualclass.lang.getString("miniUserList"))):(c(this).addClass("close"),c(this).removeClass("open"),c("#usertab_toogle_icon").addClass("icon-arrow-up"),c("#usertab_toogle_icon").removeClass("icon-arrow-down"),c(this).attr("data-title",virtualclass.lang.getString("maxUserList"))),c("#chat_div").memberlist("option","boxManager").toggleBox())});uiFooterbartabCont=(this.uiFooterbartabCont=c("<div></div>")).attr("id",
"tabs").addClass("tabs-bottom").appendTo(a);uiFooterbartabs=(this.uiFooterbartabs=c('<ul class="tabs"></ul>')).appendTo(uiFooterbartabCont);this._setWidth(this.options.width);this.init(this)},destroy:function(){this.element.remove();this._destroy()},_setWidth:function(a){this.uiFooterbar.width(a+"px")}})})(jQuery);
(function(c){c.fn.clickToggle=function(a,b){var d=[a,b];this.data("toggleclicked",0);this.click(function(){var a=c(this).data(),b=a.toggleclicked;c.proxy(d[b],this)();a.toggleclicked=(b+1)%2});return this}})(jQuery);(function(c){c.widget("ui.memberlist",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,userSent:function(a){this.boxManager.addUsr(a.name)},boxClosed:function(a){},boxManager:{init:function(a){this.elem=a},addUsr:function(a){var b=this.elem.uiChatboxLog,d=document.getElementById("ml"+a.userid);null!=d&&d.parentNode.removeChild(d);d=document.createElement("div");d.className+="userImg";b.append(d);if(a){b=document.createElement("a");b.href="#"+a.userid;b.classList.add("tooltip");
b.setAttribute("data-title","Click to chat");var f=document.createElement("img");f.src=a.img;b.appendChild(f);f=document.createElement("span");void 0==a.lname&&(a.lname="");c(f).text(a.name+" "+a.lname);b.appendChild(f);d.appendChild(b);b=["assign","audio","chat","editorRich","editorCode"];a.userid!=wbUser.id&&(b=virtualclass.user.createControl(a.userid,b),d.appendChild(b),virtualclass.user.control.shouldApply.call(virtualclass.user,a.userid));null==roles.hasControls()||roles.hasAdmin()||a.userid!=
localStorage.getItem("aId")||(b=["assign"],f=document.getElementById(a.userid+"ControlContainer"),null!=f?virtualclass.user.createAssignControl(f,a.userid,!0):(f=document.getElementById("ml"+a.userid),b=virtualclass.user.createControl(a.userid,b),f.appendChild(b)))}c(d).addClass("ui-memblist-usr");c(d).attr("id","ml"+a.userid);c(d).fadeIn();this._scrollToBottom();d=localStorage.getItem("chatEnable");null!=d&&"false"==d&&virtualclass.user.control.disableOnLineUser();virtualclass.gObj.uid==a.userid&&
(a=document.getElementById("ml"+virtualclass.gObj.uid),null!=a&&a.classList.add("mySelf"))},highlightBox:function(){var a=this;a.elem.uiChatboxTitlebar.effect("highlight",{},300);a.elem.uiChatbox.effect("bounce",{times:3},300,function(){a.highlightLock=!1;a._scrollToBottom()})},toggleBox:function(){this.elem.uiChatbox.toggle("slide",{direction:"down"},1E3)},_scrollToBottom:function(){var a=this.elem.uiChatboxLog;a.scrollTop(a.get(0).scrollHeight)}}},toggleContent:function(a){this.uiChatboxContent.toggle();
this.uiChatboxContent.is(":visible")},widget:function(){return this.uiChatbox},_create:function(){var a=this,b=a.options.title||"No Title",d=(a.uiChatbox=c("<div></div>")).appendTo(document.getElementById("chatWidget")).addClass("ui-widget ui-corner-top ui-memblist").attr("id","memlist").css("display","none").focusin(function(){a.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){a.uiChatboxTitlebar.removeClass("ui-state-focus")}),f=(a.uiChatboxTitlebar=c("<div></div>")).addClass("ui-widget-header ui-corner-top ui-memblist-titlebar ui-dialog-header").click(function(a){}).appendTo(d);
(a.uiChatboxTitle=c("<span></span>")).html('<span class="icon-user"> </span>'+b).appendTo(f);var g=(a.uiChatboxTitlebarClose=c('<a href="#"></a>')).addClass("ui-corner-all ui-memblist-icon ").attr("role","button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")});uiChatboxTitlebarMinimize=(a.uiChatboxTitlebarMinimize=c('<a href="#"></a>')).addClass("ui-corner-all ui-memblist-icon").attr("role","button").hover(function(){uiChatboxTitlebarMinimize.addClass("ui-state-hover")},
function(){uiChatboxTitlebarMinimize.removeClass("ui-state-hover")}).click(function(a){c("#chat_div").memberlist("option","boxManager").toggleBox();a=c("#usertab_text");var b=c("#usertab_toogle_icon");a.hasClass("close")?(a.addClass("open"),a.removeClass("close"),a.attr("data-title",virtualclass.lang.getString("miniUserList")),b.addClass("icon-arrow-down"),b.removeClass("close icon-arrow-up")):(a.addClass("close"),a.removeClass("open"),a.attr("data-title",virtualclass.lang.getString("maxUserList")),
b.addClass("icon-arrow-up"),b.removeClass("icon-arrow-down"));return!1}).appendTo(f);uiChatboxTitlebarMinimizeText=c("<span></span>").addClass("ui-icon icon-minus").text("").appendTo(uiChatboxTitlebarMinimize);uiChatboxContent=(a.uiChatboxContent=c("<div></div>")).addClass("ui-widget-content ui-memblist-content ").appendTo(d);uiChatboxLog=(a.uiChatboxLog=a.element).addClass("ui-widget-content ui-memblist-log").appendTo(uiChatboxContent).focusin(function(){var a=c(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)});
f.find("*").add(f).disableSelection();c(document).on("click","#chat_div .ui-memblist-usr a",function(a){a=c(this);var b=a.attr("href");"undefined"!=typeof b&&(b=b.replace("#",""),a=a.find("span").html(),-1==c.inArray(b,virtualclass.chat.idList)&&(virtualclass.chat.counter++,virtualclass.chat.idList.push(b),virtualclass.chat.vmstorage[b]=[],virtualclass.chat.vmstorage[b].push({userid:b,name:a})),chatboxManager.addBox(b,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,first_name:a}),
chatboxManager.init({user:{name:a},messageSent:function(a,b,d){c("#"+a).chatbox("option","boxManager").addMsg(b.name,d)}}),a=b=null)});a._setWidth(a.options.width);a._position(a.options.offset);a.options.boxManager.init(a);roles.hasAdmin()&&virtualclass.user.UIaudioAll("memlist","ui-memblist-titlebar")},_setOption:function(a,b){if(null!=b)switch(a){case "hidden":b?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(b);break;case "width":this._setWidth(b)}c.Widget.prototype._setOption.apply(this,
arguments)},_setWidth:function(a){this.uiChatboxTitlebar.width(a+"px");this.uiChatboxLog.width(a+"px")},_position:function(a){this.uiChatbox.css("right",a)}})})(jQuery);(function(c){c.widget("ui.chatbox",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,messageSent:function(a,b,c){this.boxManager.addMsg(b.name,c)},boxClosed:function(a){},boxManager:{init:function(a){this.elem=a},addMsg:function(a,b){var d=this.elem.uiChatboxLog,f=document.createElement("div");d.append(f);d=!1;if(a){var g=document.createElement("b");c(g).text(a+": ");f.appendChild(g)}else d=!0;d=document.createElement(d?"i":"span");c(d).text(b);f.appendChild(d);c(f).addClass("ui-chatbox-msg");
c(f).fadeIn();this._scrollToBottom();this.elem.uiChatboxTitlebar.hasClass("ui-state-focus")||this.highlightLock||(this.highlightLock=!0,this.highlightBox())},highlightBox:function(){},toggleBox:function(){this.elem.uiChatbox.toggle()},_scrollToBottom:function(){var a=this.elem.uiChatboxLog;a.scrollTop(a.get(0).scrollHeight)}}},toggleContent:function(a){},toggleContentbox:function(a){this.uiChatboxContent.is(":visible")?(this.uiChatboxInputBox.focus(),c(c('#tabs ul li[id = "tabcb'+this.options.id+
'"]')).removeClass("ui-state-active")):c(c('#tabs ul li[id="tabcb'+this.options.id+'"]')).addClass("ui-state-active");this.uiChatbox.toggle("slide",{direction:"down"},1E3)},widget:function(){return this.uiChatbox},_create:function(){createTab(this.options.id,this.options.title);var a=this,b=a.options.title||"No Title",d=(a.uiChatbox=c("<div></div>")).appendTo(document.body).addClass("ui-widget ui-corner-top ui-chatbox").attr("id","cb"+a.options.id).focusin(function(){a.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){a.uiChatboxTitlebar.removeClass("ui-state-focus")}),
f=(a.uiChatboxTitlebar=c("<div></div>")).addClass("ui-widget-header ui-corner-top ui-chatbox-titlebar ui-dialog-header").click(function(a){}).appendTo(d);(a.uiChatboxTitle=c("<span></span>")).html(b).appendTo(f);var g=(a.uiChatboxTitlebarClose=c('<a href="#"></a>')).addClass("ui-corner-all ui-chatbox-icon ").attr("role","button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")}).click(function(b){d.hide();a.options.boxClosed(a.options.id);c("#tabcb"+a.options.id).remove();
delete virtualclass.chat.vmstorage[a.options.id];localStorage.removeItem(a.options.id);return!1}).appendTo(f);c("<span ></span>").addClass("ui-icon icon-close").text("").appendTo(g);var h=(a.uiChatboxTitlebarMinimize=c('<a href = "#"></a>')).addClass("ui-corner-all ui-chatbox-icon").attr("role","button").hover(function(){h.addClass("ui-state-hover")},function(){h.removeClass("ui-state-hover")}).click(function(b){a.toggleContentbox(b);"hidden"==localStorage.getItem(a.options.id)?localStorage.removeItem(a.options.id):
localStorage.setItem(a.options.id,"hidden");return!1}).appendTo(f);c("<span></span>").addClass("ui-icon icon-minus").text("").appendTo(h);b=(a.uiChatboxContent=c("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(d);(a.uiChatboxLog=a.element).addClass("ui-widget-content ui-chatbox-log").appendTo(b);var m=(a.uiChatboxInput=c("<div></div>")).addClass("ui-widget-content ui-chatbox-input").click(function(a){}).appendTo(b),n=(a.uiChatboxInputBox=c("<textarea></textarea>")).addClass("ui-widget-content ui-chatbox-input-box ui-corner-all").prop("id",
"ta"+a.options.id).appendTo(m).keypress(function(b){if(b.keyCode&&b.keyCode==c.ui.keyCode.ENTER){msg=c.trim(c(this).val());if(0<msg.length){ioAdapter.mustSendUser({msg:msg,cf:"msg"},a.options.id);c("li[aria-controls='tabcb"+a.options.id+"']").removeClass("ui-state-highlight");c(this).val("");c("#"+a.options.id).chatbox("option").messageSent(a.options.id,{name:io.cfg.userobj.name},msg);b=a.options.id;"undefined"==typeof virtualclass.chat.vmstorage[b]&&(virtualclass.chat.vmstorage[b]=[]);var d=(new Date).getTime();
virtualclass.chat.vmstorage[b].push({userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:d})}return!1}}).focusin(function(){n.addClass("ui-chatbox-input-focus");var a=c(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)}).focusout(function(){n.removeClass("ui-chatbox-input-focus")});f.find("*").add(f).disableSelection();b.children().click(function(){a.uiChatboxInputBox.focus()});a._setWidth(a.options.width);a._position(a.options.offset);a.options.boxManager.init(a);a.options.hidden||
d.show();c(c('#tabs ul li[id = "tabcb'+a.options.id+'"]')).append(d)},_setOption:function(a,b){if(null!=b)switch(a){case "hidden":b?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(b);break;case "width":this._setWidth(b)}c.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(a){this.uiChatbox.width(a+"px");this.uiChatboxInputBox.css("width",a-14+"px")},_position:function(a){}})})(jQuery);(function(c){c.widget("ui.chatroom",{options:{id:null,title:null,user:null,hidden:!1,offset:20,width:230,messageSent:function(a,b){this.boxManager.addMsg(a.name,b)},boxClosed:function(a){},boxManager:{init:function(a){this.elem=a},addMsg:function(a,b){var d=this.elem.uiChatboxLog,f=document.createElement("div");d.append(f);d=!1;if(a){var g=document.createElement("b");c(g).text(a+": ");f.appendChild(g)}else d=!0;d=document.createElement(d?"i":"span");c(d).text(b);f.appendChild(d);c(f).addClass("ui-chatbox-msg");
c(f).fadeIn();this._scrollToBottom();this.elem.uiChatboxTitlebar.hasClass("ui-state-focus")||this.highlightLock||(this.highlightLock=!0,this.highlightBox())},highlightBox:function(){this.elem.uiChatboxTitlebar.addClass("ui-state-highlight");this.highlightLock=!1;this._scrollToBottom()},toggleBox:function(){this.elem.uiChatbox.toggle("slide",{direction:"down"},1E3)},_scrollToBottom:function(){var a=this.elem.uiChatboxLog;a.scrollTop(a.get(0).scrollHeight)}}},toggleContent:function(a){this.uiChatboxContent.toggle();
this.uiChatboxContent.is(":visible")&&this.uiChatboxInputBox.focus()},widget:function(){return this.uiChatbox},_create:function(){var a=null!=localStorage.getItem("chatEnable")?"true"==localStorage.chatEnable?"enable":"disable":"enable",b=this,d=b.options.title||"No Title",a=(b.uiChatbox=c("<div></div>")).appendTo(document.getElementById("chatWidget")).addClass("ui-widget ui-corner-top ui-chatroom "+a).prop("id","chatrm").focusin(function(){b.uiChatboxTitlebar.removeClass("ui-state-highlight");b.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){b.uiChatboxTitlebar.removeClass("ui-state-focus")}),
f=(b.uiChatboxTitlebar=c("<div></div>")).addClass("ui-widget-header ui-corner-top ui-chatroom-titlebar ui-dialog-header").click(function(a){b.uiChatboxTitlebar.removeClass("ui-state-highlight")}).appendTo(a);(b.uiChatboxTitle=c("<span></span>")).html(d).appendTo(f);var g=(b.uiChatboxTitlebarMinimize=c('<a href="#"></a>')).addClass("ui-corner-all ui-chatbox-icon").prop("role","button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")}).focus(function(){g.addClass("ui-state-focus")}).blur(function(){g.removeClass("ui-state-focus")}).click(function(a){toggleCommonChatBox();
localStorage.setItem("chatroom_status","hidden");return!1}).appendTo(f);c("<span></span>").addClass("ui-icon icon-minus").text("").appendTo(g);d=(b.uiChatboxContent=c("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(a);(b.uiChatboxLog=b.element).addClass("ui-widget-content ui-chatbox-log").appendTo(d);var h=(b.uiChatboxInput=c("<div></div>")).addClass("ui-widget-content ui-chatbox-input").click(function(a){}).appendTo(d),m=(b.uiChatboxInputBox=c("<textarea></textarea>")).addClass("ui-widget-content ui-chatbox-input-box ui-corner-all").prop("id",
"ta_chrm").appendTo(h).keydown(function(a){if(a.keyCode&&a.keyCode==c.ui.keyCode.ENTER){msg=c.trim(c(this).val());a={receiver:"chatroom",msg:msg,cf:"msg"};if(0<msg.length)if(ioAdapter.mustSend(a),c(this).val(""),b.options.messageSent({name:io.cfg.userobj.name},msg),a=(new Date).getTime(),null!=localStorage.getItem("chatroom")){var d=JSON.parse(localStorage.getItem("chatroom"));d.push({userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:a});localStorage.setItem("chatroom",JSON.stringify(d))}else localStorage.setItem("chatroom",
JSON.stringify([{userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:a}]));return!1}}).focusin(function(){m.addClass("ui-chatbox-input-focus");var a=c(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)}).focusout(function(){m.removeClass("ui-chatbox-input-focus")});f.find("*").add(f).disableSelection();d.children().click(function(){b.uiChatboxInputBox.focus()});b._setWidth(b.options.width);b._position(b.options.offset);b.options.boxManager.init(b);b.options.hidden||(a.show(),virtualclass.vutil.isPlayMode()&&
disCommonChatInput())},_setOption:function(a,b){if(null!=b)switch(a){case "hidden":b?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(b);break;case "width":this._setWidth(b)}c.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(a){this.uiChatbox.width(a+"px");this.uiChatboxInputBox.css("width",a-14+"px")},_position:function(a){this.uiChatbox.css("left",a)}})})(jQuery);Array.indexOf||(Array.prototype.indexOf=function(c){for(var a=0;a<this.length;a++)if(this[a]==c)return a;return-1});
var chatboxManager=function(){var c=[],a=[],b={width:230,gap:20,maxBoxes:5,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b,c)}},d=function(d){var f=a.indexOf(d);if(-1!=f)for(a.splice(f,1),c.splice(f,1),diff=b.width+b.gap,d=f;d<a.length;d++)offset=$("#"+a[d]).chatbox("option","offset"),$("#"+a[d]).chatbox("option","offset",offset-diff);else alert("should not happen: "+d)},f=function(a,d,f){c.indexOf(d.userid);b.messageSent(a,d,f)};return{init:function(a){$.extend(b,a)},
addBox:function(g,h,m){m=a.indexOf(g);var n=c.indexOf(g);-1==m&&(-1!=n?($("#"+g).chatbox("option","offset",285+(b.width+b.gap)*a.length),$("#"+g).chatbox("option","boxManager").toggleBox(),a.push(g),h=-1,h=$("#tabs li").index($("#tabcb"+g)),$($(".tabs li")[h]).css("display","list-item"),$("#tabs").tabs("option","active",h),$("#tabs").tabs("show")):(void 0==h.last_name&&(h.last_name=""),m=document.createElement("div"),m.setAttribute("id",g),$(m).chatbox({id:g,user:h,title:h.first_name+" "+h.last_name,
hidden:!1,width:b.width,offset:285+(b.width+b.gap)*a.length,messageSent:f,boxClosed:d}),c.push(g),a.push(g)))},delBox:function(b){a=$.grep(a,function(a){return b!=a});c=$.grep(c,function(a){return b!=a})},dispatch:function(a,b){$("#"+a.userid).chatbox("option","boxManager").addMsg(a.name,b)}}}();function memberUpdate(c,a){var b=c.message,d="undefined"===typeof whiteboardPath?"../images/online.png":window.whiteboardPath+"images/online.png";if(0<b.length){var f=b.length-1;virtualclass.gObj.totalUser=[];for(var g=0;g<b.length;g++)virtualclass.gObj.totalUser.push(b[g].id);virtualclass.gObj.totalUser.sort();$("#user_list .inner_bt #usertab_icon").css({background:"url("+d+")no-repeat top left"})}$("#user_list .inner_bt #usertab_text").html("<span id='onlineusertext'>"+lang.whos+" ( "+f+" )</span> <span id='usertab_toogle_icon' class='icon-arrow-up'></span>");
$("#chatroom_bt .inner_bt #chatroom_text").text(lang.chatroom+" ("+f+")");0<b.length?(document.getElementById("chat_div")||(d=document.createElement("div"),d.id="chat_div",document.body.appendChild(d)),$("#chat_div").memberlist({id:"chat_div",user:b,offset:"7px",title:lang.online,userSent:function(a){$("#chat_div").memberlist("option","boxManager").addUsr(a)}}),$("#chat_div .ui-memblist-usr:not(.mySelf)").remove(),$.each(b,function(b,c){null==document.getElementById("video"+c.userid)&&$("#chat_div").memberlist("option").userSent(c);
if(c.userid==io.cfg.userid&&"undefined"!=typeof a&&"removed"!=a){var d=document.getElementById("video"+c.userid);virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable")||null!=d||virtualclass.gObj.video._handleUserMedia(c.userid)}virtualclass.gObj.video.addUserRole(c.userid,c.role)})):$("div#memlist").length&&$("div#memlist").remove()}
function messageUpdate2(c){var a=$.isPlainObject(c.message)?c.message.msg:c.message,b=c.toUser,d=c.fromUser,f=io.cfg.userid,g=(new Date).getTime();if("chatroom"==c.message.receiver&&(""==b||void 0==b))f==d.userid||virtualclass.chat.chatroombox||0!=$("div#chat_room").length||(c=document.createElement("div"),c.id="chat_room",document.body.appendChild(c),virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:d,title:lang.chatroom_header,messageSent:function(a,b){$("#chat_room").chatroom("option",
"boxManager").addMsg(a.name,b)}})),$("#chat_room").chatroom("option").messageSent(d,a),null!=localStorage.getItem("chatroom")?(c=JSON.parse(localStorage.getItem("chatroom")),c.push({userid:d.userid,name:d.name,msg:a,time:g}),localStorage.setItem("chatroom",JSON.stringify(c))):localStorage.setItem("chatroom",JSON.stringify([{userid:d.userid,name:d.name,msg:a,time:g}]));else if(void 0!=b&&""!=b){if(f==b.userid&&d.userid!=f){-1==$.inArray(d.userid,virtualclass.chat.idList)&&(virtualclass.chat.counter++,
virtualclass.chat.idList.push(d.userid),virtualclass.chat.vmstorage[d.userid]=[],virtualclass.chat.vmstorage[d.userid].push({userid:d.userid,name:d.name+" "+d.lname}));chatboxManager.addBox(d.userid,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,first_name:d.name,last_name:d.lname});chatboxManager.init({user:d,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}});c=localStorage.getItem("chatEnable");null!=c&&"false"==c&&virtualclass.user.control.allChatDisable();
$("#"+d.userid).chatbox("option").messageSent(d.userid,d,a);$("li[aria-controls='tabcb"+d.userid+"']").addClass("ui-state-highlight");var h=d.userid}virtualclass.chat.vmstorage[h].push({userid:d.userid,name:d.name,msg:a,time:g})}}
function messageUpdate(c){var a=$.isPlainObject(c.message)?c.message.msg:c.message,b=c.toUser,d=c.fromUser,f=io.cfg.userid,g=(new Date).getTime();if("chatroom"==c.message.receiver&&(""==b||void 0==b))virtualclass.chat.chatroombox||0!=$("div#chat_room").length||(c=document.createElement("div"),c.id="chat_room",document.body.appendChild(c),virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:d,title:lang.chatroom_header,messageSent:function(a,b){$("#chat_room").chatroom("option",
"boxManager").addMsg(a.name,b)}})),$("#chat_room").chatroom("option").messageSent(d,a),c=localStorage.getItem("chatroom"),null!=c?(c=JSON.parse(c),c.push({userid:d.userid,name:d.name,msg:a,time:g}),localStorage.setItem("chatroom",JSON.stringify(c))):localStorage.setItem("chatroom",JSON.stringify([{userid:d.userid,name:d.name,msg:a,time:g}]));else if(void 0!=b&&""!=b){if(f==b.userid&&d.userid!=f){-1==$.inArray(d.userid,virtualclass.chat.idList)&&(virtualclass.chat.counter++,virtualclass.chat.idList.push(d.userid),
virtualclass.chat.vmstorage[d.userid]=[],virtualclass.chat.vmstorage[d.userid].push({userid:d.userid,name:d.name+" "+d.lname}));chatboxManager.addBox(d.userid,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,first_name:d.name,last_name:d.lname});chatboxManager.init({user:d,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}});c=localStorage.getItem("chatEnable");null!=c&&"false"==c&&virtualclass.user.control.allChatDisable();$("#"+d.userid).chatbox("option").messageSent(d.userid,
d,a);$("li[aria-controls='tabcb"+d.userid+"']").addClass("ui-state-highlight");var h=d.userid}virtualclass.chat.vmstorage[h].push({userid:d.userid,name:d.name,msg:a,time:g})}}function statusUpdate(c,a,b){$("#"+c.userid).length&&($("#"+c.userid).chatbox("option").messageSent(c.userid,c,a),$("#ta"+c.userid).prop("disabled",b))}function common_chatbox_update(c,a){$("div#chat_room").length&&$("#chat_room").chatroom("option").messageSent(c,a)}
function newStatus(c){$.each(c.message,function(a,b){null!=c.newuser&&b.userid==c.newuser&&(statusUpdate(b,"Online",!1),common_chatbox_update(b,"Online"))})}function createTab(c,a){var b=$("#tabs").tabs(),d=$("div#tabs ul li").length;tabId="tabcb"+c;addTab(b,tabId,d,a)}
function addTab(c,a,b,d){var f=$("#tab_content");b=d||"Tab "+b;a=$(("<li id = '"+a+"' class = 'ui-state-default ui-corner-bottom ui-tabs-active ui-state-active' aria-controls = '"+a+"'><a href = '#{href}' class = 'ui-tabs-anchor'>#{label}</a> <a href = '#' role = 'button'class = 'ui-corner-all ui-chatbox-icon'><span class = 'ui-icon icon-close'></span></a></li>").replace(/#\{href\}/g,"#"+a).replace(/#\{label\}/g,b));f.val();c.find(".ui-tabs-nav").append(a)}
function browserSupportsLocalStorage(){return"localStorage"in window&&null!=window.localStorage}
function displaycomChatHistory(){var c=localStorage.getItem("chatroom");if(null!=c){var a=document.createElement("div");a.id="chat_room";document.body.appendChild(a);c=JSON.parse(c);$.each(c,function(a,c){1>a&&(virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:c,title:"Common chat",messageSent:function(a,b){$("#chat_room").chatroom("option","boxManager").addMsg(a.name,b)}}));$("#chat_room").chatroom("option").messageSent(c,c.msg)})}"hidden"==localStorage.getItem("chatroom_status")&&
$("#chatrm").hide()}
function displayPvtChatHistory(){if(null!=localStorage.getItem(wbUser.sid)){var c=JSON.parse(localStorage.getItem(wbUser.sid));$.each(c,function(a,b){virtualclass.chat.counter++;virtualclass.chat.idList.push(a);$.each(b,function(b,c){1>b?(chatboxManager.addBox(a,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,first_name:c.name}),chatboxManager.init({messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}})):$("#"+a).chatbox("option").messageSent(a,c,
c.msg)});"hidden"==localStorage.getItem(a)&&($("#cb"+a).hide(),$("#tabcb"+a).removeClass("ui-state-active"))})}}function display_error(c){$("<div id = 'dialog' title = 'VmChat Error:'></div>").prependTo("#stickybar");$("#dialog").html(c);$("#dialog").dialog()}function clearAllChatBox(){$("#chatWidget .icon-close").trigger("click")}function disCommonChatInput(){var c=document.getElementById("ta_chrm");null!=c&&(c.disabled=!0)}
function toggleCommonChatBox(){var c=$("#chatroom_bt2");"hidden"==localStorage.getItem("chatroom_status")?(localStorage.removeItem("chatroom_status"),c.attr("data-title",virtualclass.lang.getString("minCommonChat"))):(localStorage.setItem("chatroom_status","hidden"),c.attr("data-title",virtualclass.lang.getString("maxCommonChat")));c=document.getElementById("cc_arrow_button");null!=c&&(virtualclass.vutil.elemHasAnyClass("cc_arrow_button")?c.classList.contains("icon-arrow-up")?(c.classList.add("icon-arrow-down"),
c.classList.remove("icon-arrow-up")):(c.classList.add("icon-arrow-up"),c.classList.remove("icon-arrow-down")):c.className="icon-arrow-up");virtualclass.chat.chatroombox.chatroom("option","boxManager").toggleBox()};var lang={online:"Online Users",whos:"Who's online",chatroom:"Chatroom",chatroom_header:"Common Chat",error:"Something bad happend. Sorry!",wserror:"Browser does not support WebSocket",sterror:"This browser doesn't support Web Storage standard"};
